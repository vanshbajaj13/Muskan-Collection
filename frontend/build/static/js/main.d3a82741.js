/*! For license information please see main.d3a82741.js.LICENSE.txt */
(()=>{var g={730:(g,I,e)=>{"use strict";var C=e(43),t=e(853);function l(g){for(var I="https://reactjs.org/docs/error-decoder.html?invariant="+g,e=1;e<arguments.length;e++)I+="&args[]="+encodeURIComponent(arguments[e]);return"Minified React error #"+g+"; visit "+I+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,o={};function a(g,I){i(g,I),i(g+"Capture",I)}function i(g,I){for(o[g]=I,g=0;g<I.length;g++)n.add(I[g])}var A=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),c=Object.prototype.hasOwnProperty,s=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d={},r={};function b(g,I,e,C,t,l,n){this.acceptsBooleans=2===I||3===I||4===I,this.attributeName=C,this.attributeNamespace=t,this.mustUseProperty=e,this.propertyName=g,this.type=I,this.sanitizeURL=l,this.removeEmptyString=n}var u={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(g){u[g]=new b(g,0,!1,g,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(g){var I=g[0];u[I]=new b(I,1,!1,g[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(g){u[g]=new b(g,2,!1,g.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(g){u[g]=new b(g,2,!1,g,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(g){u[g]=new b(g,3,!1,g.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(g){u[g]=new b(g,3,!0,g,null,!1,!1)})),["capture","download"].forEach((function(g){u[g]=new b(g,4,!1,g,null,!1,!1)})),["cols","rows","size","span"].forEach((function(g){u[g]=new b(g,6,!1,g,null,!1,!1)})),["rowSpan","start"].forEach((function(g){u[g]=new b(g,5,!1,g.toLowerCase(),null,!1,!1)}));var m=/[\-:]([a-z])/g;function Z(g){return g[1].toUpperCase()}function h(g,I,e,C){var t=u.hasOwnProperty(I)?u[I]:null;(null!==t?0!==t.type:C||!(2<I.length)||"o"!==I[0]&&"O"!==I[0]||"n"!==I[1]&&"N"!==I[1])&&(function(g,I,e,C){if(null===I||"undefined"===typeof I||function(g,I,e,C){if(null!==e&&0===e.type)return!1;switch(typeof I){case"function":case"symbol":return!0;case"boolean":return!C&&(null!==e?!e.acceptsBooleans:"data-"!==(g=g.toLowerCase().slice(0,5))&&"aria-"!==g);default:return!1}}(g,I,e,C))return!0;if(C)return!1;if(null!==e)switch(e.type){case 3:return!I;case 4:return!1===I;case 5:return isNaN(I);case 6:return isNaN(I)||1>I}return!1}(I,e,t,C)&&(e=null),C||null===t?function(g){return!!c.call(r,g)||!c.call(d,g)&&(s.test(g)?r[g]=!0:(d[g]=!0,!1))}(I)&&(null===e?g.removeAttribute(I):g.setAttribute(I,""+e)):t.mustUseProperty?g[t.propertyName]=null===e?3!==t.type&&"":e:(I=t.attributeName,C=t.attributeNamespace,null===e?g.removeAttribute(I):(e=3===(t=t.type)||4===t&&!0===e?"":""+e,C?g.setAttributeNS(C,I,e):g.setAttribute(I,e))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(g){var I=g.replace(m,Z);u[I]=new b(I,1,!1,g,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(g){var I=g.replace(m,Z);u[I]=new b(I,1,!1,g,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(g){var I=g.replace(m,Z);u[I]=new b(I,1,!1,g,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(g){u[g]=new b(g,1,!1,g.toLowerCase(),null,!1,!1)})),u.xlinkHref=new b("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(g){u[g]=new b(g,1,!1,g.toLowerCase(),null,!0,!0)}));var G=C.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,B=Symbol.for("react.element"),y=Symbol.for("react.portal"),p=Symbol.for("react.fragment"),W=Symbol.for("react.strict_mode"),V=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),X=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),J=Symbol.for("react.suspense"),k=Symbol.for("react.suspense_list"),Y=Symbol.for("react.memo"),f=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var v=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var H=Symbol.iterator;function w(g){return null===g||"object"!==typeof g?null:"function"===typeof(g=H&&g[H]||g["@@iterator"])?g:null}var N,K=Object.assign;function F(g){if(void 0===N)try{throw Error()}catch(e){var I=e.stack.trim().match(/\n( *(at )?)/);N=I&&I[1]||""}return"\n"+N+g}var x=!1;function z(g,I){if(!g||x)return"";x=!0;var e=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(I)if(I=function(){throw Error()},Object.defineProperty(I.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(I,[])}catch(i){var C=i}Reflect.construct(g,[],I)}else{try{I.call()}catch(i){C=i}g.call(I.prototype)}else{try{throw Error()}catch(i){C=i}g()}}catch(i){if(i&&C&&"string"===typeof i.stack){for(var t=i.stack.split("\n"),l=C.stack.split("\n"),n=t.length-1,o=l.length-1;1<=n&&0<=o&&t[n]!==l[o];)o--;for(;1<=n&&0<=o;n--,o--)if(t[n]!==l[o]){if(1!==n||1!==o)do{if(n--,0>--o||t[n]!==l[o]){var a="\n"+t[n].replace(" at new "," at ");return g.displayName&&a.includes("<anonymous>")&&(a=a.replace("<anonymous>",g.displayName)),a}}while(1<=n&&0<=o);break}}}finally{x=!1,Error.prepareStackTrace=e}return(g=g?g.displayName||g.name:"")?F(g):""}function M(g){switch(g.tag){case 5:return F(g.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return g=z(g.type,!1);case 11:return g=z(g.type.render,!1);case 1:return g=z(g.type,!0);default:return""}}function E(g){if(null==g)return null;if("function"===typeof g)return g.displayName||g.name||null;if("string"===typeof g)return g;switch(g){case p:return"Fragment";case y:return"Portal";case V:return"Profiler";case W:return"StrictMode";case J:return"Suspense";case k:return"SuspenseList"}if("object"===typeof g)switch(g.$$typeof){case X:return(g.displayName||"Context")+".Consumer";case S:return(g._context.displayName||"Context")+".Provider";case R:var I=g.render;return(g=g.displayName)||(g=""!==(g=I.displayName||I.name||"")?"ForwardRef("+g+")":"ForwardRef"),g;case Y:return null!==(I=g.displayName||null)?I:E(g.type)||"Memo";case f:I=g._payload,g=g._init;try{return E(g(I))}catch(e){}}return null}function Q(g){var I=g.type;switch(g.tag){case 24:return"Cache";case 9:return(I.displayName||"Context")+".Consumer";case 10:return(I._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return g=(g=I.render).displayName||g.name||"",I.displayName||(""!==g?"ForwardRef("+g+")":"ForwardRef");case 7:return"Fragment";case 5:return I;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return E(I);case 8:return I===W?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof I)return I.displayName||I.name||null;if("string"===typeof I)return I}return null}function U(g){switch(typeof g){case"boolean":case"number":case"string":case"undefined":case"object":return g;default:return""}}function L(g){var I=g.type;return(g=g.nodeName)&&"input"===g.toLowerCase()&&("checkbox"===I||"radio"===I)}function D(g){g._valueTracker||(g._valueTracker=function(g){var I=L(g)?"checked":"value",e=Object.getOwnPropertyDescriptor(g.constructor.prototype,I),C=""+g[I];if(!g.hasOwnProperty(I)&&"undefined"!==typeof e&&"function"===typeof e.get&&"function"===typeof e.set){var t=e.get,l=e.set;return Object.defineProperty(g,I,{configurable:!0,get:function(){return t.call(this)},set:function(g){C=""+g,l.call(this,g)}}),Object.defineProperty(g,I,{enumerable:e.enumerable}),{getValue:function(){return C},setValue:function(g){C=""+g},stopTracking:function(){g._valueTracker=null,delete g[I]}}}}(g))}function T(g){if(!g)return!1;var I=g._valueTracker;if(!I)return!0;var e=I.getValue(),C="";return g&&(C=L(g)?g.checked?"true":"false":g.value),(g=C)!==e&&(I.setValue(g),!0)}function j(g){if("undefined"===typeof(g=g||("undefined"!==typeof document?document:void 0)))return null;try{return g.activeElement||g.body}catch(I){return g.body}}function P(g,I){var e=I.checked;return K({},I,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=e?e:g._wrapperState.initialChecked})}function O(g,I){var e=null==I.defaultValue?"":I.defaultValue,C=null!=I.checked?I.checked:I.defaultChecked;e=U(null!=I.value?I.value:e),g._wrapperState={initialChecked:C,initialValue:e,controlled:"checkbox"===I.type||"radio"===I.type?null!=I.checked:null!=I.value}}function _(g,I){null!=(I=I.checked)&&h(g,"checked",I,!1)}function q(g,I){_(g,I);var e=U(I.value),C=I.type;if(null!=e)"number"===C?(0===e&&""===g.value||g.value!=e)&&(g.value=""+e):g.value!==""+e&&(g.value=""+e);else if("submit"===C||"reset"===C)return void g.removeAttribute("value");I.hasOwnProperty("value")?gg(g,I.type,e):I.hasOwnProperty("defaultValue")&&gg(g,I.type,U(I.defaultValue)),null==I.checked&&null!=I.defaultChecked&&(g.defaultChecked=!!I.defaultChecked)}function $(g,I,e){if(I.hasOwnProperty("value")||I.hasOwnProperty("defaultValue")){var C=I.type;if(!("submit"!==C&&"reset"!==C||void 0!==I.value&&null!==I.value))return;I=""+g._wrapperState.initialValue,e||I===g.value||(g.value=I),g.defaultValue=I}""!==(e=g.name)&&(g.name=""),g.defaultChecked=!!g._wrapperState.initialChecked,""!==e&&(g.name=e)}function gg(g,I,e){"number"===I&&j(g.ownerDocument)===g||(null==e?g.defaultValue=""+g._wrapperState.initialValue:g.defaultValue!==""+e&&(g.defaultValue=""+e))}var Ig=Array.isArray;function eg(g,I,e,C){if(g=g.options,I){I={};for(var t=0;t<e.length;t++)I["$"+e[t]]=!0;for(e=0;e<g.length;e++)t=I.hasOwnProperty("$"+g[e].value),g[e].selected!==t&&(g[e].selected=t),t&&C&&(g[e].defaultSelected=!0)}else{for(e=""+U(e),I=null,t=0;t<g.length;t++){if(g[t].value===e)return g[t].selected=!0,void(C&&(g[t].defaultSelected=!0));null!==I||g[t].disabled||(I=g[t])}null!==I&&(I.selected=!0)}}function Cg(g,I){if(null!=I.dangerouslySetInnerHTML)throw Error(l(91));return K({},I,{value:void 0,defaultValue:void 0,children:""+g._wrapperState.initialValue})}function tg(g,I){var e=I.value;if(null==e){if(e=I.children,I=I.defaultValue,null!=e){if(null!=I)throw Error(l(92));if(Ig(e)){if(1<e.length)throw Error(l(93));e=e[0]}I=e}null==I&&(I=""),e=I}g._wrapperState={initialValue:U(e)}}function lg(g,I){var e=U(I.value),C=U(I.defaultValue);null!=e&&((e=""+e)!==g.value&&(g.value=e),null==I.defaultValue&&g.defaultValue!==e&&(g.defaultValue=e)),null!=C&&(g.defaultValue=""+C)}function ng(g){var I=g.textContent;I===g._wrapperState.initialValue&&""!==I&&null!==I&&(g.value=I)}function og(g){switch(g){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ag(g,I){return null==g||"http://www.w3.org/1999/xhtml"===g?og(I):"http://www.w3.org/2000/svg"===g&&"foreignObject"===I?"http://www.w3.org/1999/xhtml":g}var ig,Ag,cg=(Ag=function(g,I){if("http://www.w3.org/2000/svg"!==g.namespaceURI||"innerHTML"in g)g.innerHTML=I;else{for((ig=ig||document.createElement("div")).innerHTML="<svg>"+I.valueOf().toString()+"</svg>",I=ig.firstChild;g.firstChild;)g.removeChild(g.firstChild);for(;I.firstChild;)g.appendChild(I.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(g,I,e,C){MSApp.execUnsafeLocalFunction((function(){return Ag(g,I)}))}:Ag);function sg(g,I){if(I){var e=g.firstChild;if(e&&e===g.lastChild&&3===e.nodeType)return void(e.nodeValue=I)}g.textContent=I}var dg={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},rg=["Webkit","ms","Moz","O"];function bg(g,I,e){return null==I||"boolean"===typeof I||""===I?"":e||"number"!==typeof I||0===I||dg.hasOwnProperty(g)&&dg[g]?(""+I).trim():I+"px"}function ug(g,I){for(var e in g=g.style,I)if(I.hasOwnProperty(e)){var C=0===e.indexOf("--"),t=bg(e,I[e],C);"float"===e&&(e="cssFloat"),C?g.setProperty(e,t):g[e]=t}}Object.keys(dg).forEach((function(g){rg.forEach((function(I){I=I+g.charAt(0).toUpperCase()+g.substring(1),dg[I]=dg[g]}))}));var mg=K({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Zg(g,I){if(I){if(mg[g]&&(null!=I.children||null!=I.dangerouslySetInnerHTML))throw Error(l(137,g));if(null!=I.dangerouslySetInnerHTML){if(null!=I.children)throw Error(l(60));if("object"!==typeof I.dangerouslySetInnerHTML||!("__html"in I.dangerouslySetInnerHTML))throw Error(l(61))}if(null!=I.style&&"object"!==typeof I.style)throw Error(l(62))}}function hg(g,I){if(-1===g.indexOf("-"))return"string"===typeof I.is;switch(g){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Gg=null;function Bg(g){return(g=g.target||g.srcElement||window).correspondingUseElement&&(g=g.correspondingUseElement),3===g.nodeType?g.parentNode:g}var yg=null,pg=null,Wg=null;function Vg(g){if(g=Zt(g)){if("function"!==typeof yg)throw Error(l(280));var I=g.stateNode;I&&(I=Gt(I),yg(g.stateNode,g.type,I))}}function Sg(g){pg?Wg?Wg.push(g):Wg=[g]:pg=g}function Xg(){if(pg){var g=pg,I=Wg;if(Wg=pg=null,Vg(g),I)for(g=0;g<I.length;g++)Vg(I[g])}}function Rg(g,I){return g(I)}function Jg(){}var kg=!1;function Yg(g,I,e){if(kg)return g(I,e);kg=!0;try{return Rg(g,I,e)}finally{kg=!1,(null!==pg||null!==Wg)&&(Jg(),Xg())}}function fg(g,I){var e=g.stateNode;if(null===e)return null;var C=Gt(e);if(null===C)return null;e=C[I];g:switch(I){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(C=!C.disabled)||(C=!("button"===(g=g.type)||"input"===g||"select"===g||"textarea"===g)),g=!C;break g;default:g=!1}if(g)return null;if(e&&"function"!==typeof e)throw Error(l(231,I,typeof e));return e}var vg=!1;if(A)try{var Hg={};Object.defineProperty(Hg,"passive",{get:function(){vg=!0}}),window.addEventListener("test",Hg,Hg),window.removeEventListener("test",Hg,Hg)}catch(Ag){vg=!1}function wg(g,I,e,C,t,l,n,o,a){var i=Array.prototype.slice.call(arguments,3);try{I.apply(e,i)}catch(A){this.onError(A)}}var Ng=!1,Kg=null,Fg=!1,xg=null,zg={onError:function(g){Ng=!0,Kg=g}};function Mg(g,I,e,C,t,l,n,o,a){Ng=!1,Kg=null,wg.apply(zg,arguments)}function Eg(g){var I=g,e=g;if(g.alternate)for(;I.return;)I=I.return;else{g=I;do{0!==(4098&(I=g).flags)&&(e=I.return),g=I.return}while(g)}return 3===I.tag?e:null}function Qg(g){if(13===g.tag){var I=g.memoizedState;if(null===I&&(null!==(g=g.alternate)&&(I=g.memoizedState)),null!==I)return I.dehydrated}return null}function Ug(g){if(Eg(g)!==g)throw Error(l(188))}function Lg(g){return null!==(g=function(g){var I=g.alternate;if(!I){if(null===(I=Eg(g)))throw Error(l(188));return I!==g?null:g}for(var e=g,C=I;;){var t=e.return;if(null===t)break;var n=t.alternate;if(null===n){if(null!==(C=t.return)){e=C;continue}break}if(t.child===n.child){for(n=t.child;n;){if(n===e)return Ug(t),g;if(n===C)return Ug(t),I;n=n.sibling}throw Error(l(188))}if(e.return!==C.return)e=t,C=n;else{for(var o=!1,a=t.child;a;){if(a===e){o=!0,e=t,C=n;break}if(a===C){o=!0,C=t,e=n;break}a=a.sibling}if(!o){for(a=n.child;a;){if(a===e){o=!0,e=n,C=t;break}if(a===C){o=!0,C=n,e=t;break}a=a.sibling}if(!o)throw Error(l(189))}}if(e.alternate!==C)throw Error(l(190))}if(3!==e.tag)throw Error(l(188));return e.stateNode.current===e?g:I}(g))?Dg(g):null}function Dg(g){if(5===g.tag||6===g.tag)return g;for(g=g.child;null!==g;){var I=Dg(g);if(null!==I)return I;g=g.sibling}return null}var Tg=t.unstable_scheduleCallback,jg=t.unstable_cancelCallback,Pg=t.unstable_shouldYield,Og=t.unstable_requestPaint,_g=t.unstable_now,qg=t.unstable_getCurrentPriorityLevel,$g=t.unstable_ImmediatePriority,gI=t.unstable_UserBlockingPriority,II=t.unstable_NormalPriority,eI=t.unstable_LowPriority,CI=t.unstable_IdlePriority,tI=null,lI=null;var nI=Math.clz32?Math.clz32:function(g){return g>>>=0,0===g?32:31-(oI(g)/aI|0)|0},oI=Math.log,aI=Math.LN2;var iI=64,AI=4194304;function cI(g){switch(g&-g){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&g;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&g;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return g}}function sI(g,I){var e=g.pendingLanes;if(0===e)return 0;var C=0,t=g.suspendedLanes,l=g.pingedLanes,n=268435455&e;if(0!==n){var o=n&~t;0!==o?C=cI(o):0!==(l&=n)&&(C=cI(l))}else 0!==(n=e&~t)?C=cI(n):0!==l&&(C=cI(l));if(0===C)return 0;if(0!==I&&I!==C&&0===(I&t)&&((t=C&-C)>=(l=I&-I)||16===t&&0!==(4194240&l)))return I;if(0!==(4&C)&&(C|=16&e),0!==(I=g.entangledLanes))for(g=g.entanglements,I&=C;0<I;)t=1<<(e=31-nI(I)),C|=g[e],I&=~t;return C}function dI(g,I){switch(g){case 1:case 2:case 4:return I+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return I+5e3;default:return-1}}function rI(g){return 0!==(g=-1073741825&g.pendingLanes)?g:1073741824&g?1073741824:0}function bI(){var g=iI;return 0===(4194240&(iI<<=1))&&(iI=64),g}function uI(g){for(var I=[],e=0;31>e;e++)I.push(g);return I}function mI(g,I,e){g.pendingLanes|=I,536870912!==I&&(g.suspendedLanes=0,g.pingedLanes=0),(g=g.eventTimes)[I=31-nI(I)]=e}function ZI(g,I){var e=g.entangledLanes|=I;for(g=g.entanglements;e;){var C=31-nI(e),t=1<<C;t&I|g[C]&I&&(g[C]|=I),e&=~t}}var hI=0;function GI(g){return 1<(g&=-g)?4<g?0!==(268435455&g)?16:536870912:4:1}var BI,yI,pI,WI,VI,SI=!1,XI=[],RI=null,JI=null,kI=null,YI=new Map,fI=new Map,vI=[],HI="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function wI(g,I){switch(g){case"focusin":case"focusout":RI=null;break;case"dragenter":case"dragleave":JI=null;break;case"mouseover":case"mouseout":kI=null;break;case"pointerover":case"pointerout":YI.delete(I.pointerId);break;case"gotpointercapture":case"lostpointercapture":fI.delete(I.pointerId)}}function NI(g,I,e,C,t,l){return null===g||g.nativeEvent!==l?(g={blockedOn:I,domEventName:e,eventSystemFlags:C,nativeEvent:l,targetContainers:[t]},null!==I&&(null!==(I=Zt(I))&&yI(I)),g):(g.eventSystemFlags|=C,I=g.targetContainers,null!==t&&-1===I.indexOf(t)&&I.push(t),g)}function KI(g){var I=mt(g.target);if(null!==I){var e=Eg(I);if(null!==e)if(13===(I=e.tag)){if(null!==(I=Qg(e)))return g.blockedOn=I,void VI(g.priority,(function(){pI(e)}))}else if(3===I&&e.stateNode.current.memoizedState.isDehydrated)return void(g.blockedOn=3===e.tag?e.stateNode.containerInfo:null)}g.blockedOn=null}function FI(g){if(null!==g.blockedOn)return!1;for(var I=g.targetContainers;0<I.length;){var e=PI(g.domEventName,g.eventSystemFlags,I[0],g.nativeEvent);if(null!==e)return null!==(I=Zt(e))&&yI(I),g.blockedOn=e,!1;var C=new(e=g.nativeEvent).constructor(e.type,e);Gg=C,e.target.dispatchEvent(C),Gg=null,I.shift()}return!0}function xI(g,I,e){FI(g)&&e.delete(I)}function zI(){SI=!1,null!==RI&&FI(RI)&&(RI=null),null!==JI&&FI(JI)&&(JI=null),null!==kI&&FI(kI)&&(kI=null),YI.forEach(xI),fI.forEach(xI)}function MI(g,I){g.blockedOn===I&&(g.blockedOn=null,SI||(SI=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,zI)))}function EI(g){function I(I){return MI(I,g)}if(0<XI.length){MI(XI[0],g);for(var e=1;e<XI.length;e++){var C=XI[e];C.blockedOn===g&&(C.blockedOn=null)}}for(null!==RI&&MI(RI,g),null!==JI&&MI(JI,g),null!==kI&&MI(kI,g),YI.forEach(I),fI.forEach(I),e=0;e<vI.length;e++)(C=vI[e]).blockedOn===g&&(C.blockedOn=null);for(;0<vI.length&&null===(e=vI[0]).blockedOn;)KI(e),null===e.blockedOn&&vI.shift()}var QI=G.ReactCurrentBatchConfig,UI=!0;function LI(g,I,e,C){var t=hI,l=QI.transition;QI.transition=null;try{hI=1,TI(g,I,e,C)}finally{hI=t,QI.transition=l}}function DI(g,I,e,C){var t=hI,l=QI.transition;QI.transition=null;try{hI=4,TI(g,I,e,C)}finally{hI=t,QI.transition=l}}function TI(g,I,e,C){if(UI){var t=PI(g,I,e,C);if(null===t)QC(g,I,C,jI,e),wI(g,C);else if(function(g,I,e,C,t){switch(I){case"focusin":return RI=NI(RI,g,I,e,C,t),!0;case"dragenter":return JI=NI(JI,g,I,e,C,t),!0;case"mouseover":return kI=NI(kI,g,I,e,C,t),!0;case"pointerover":var l=t.pointerId;return YI.set(l,NI(YI.get(l)||null,g,I,e,C,t)),!0;case"gotpointercapture":return l=t.pointerId,fI.set(l,NI(fI.get(l)||null,g,I,e,C,t)),!0}return!1}(t,g,I,e,C))C.stopPropagation();else if(wI(g,C),4&I&&-1<HI.indexOf(g)){for(;null!==t;){var l=Zt(t);if(null!==l&&BI(l),null===(l=PI(g,I,e,C))&&QC(g,I,C,jI,e),l===t)break;t=l}null!==t&&C.stopPropagation()}else QC(g,I,C,null,e)}}var jI=null;function PI(g,I,e,C){if(jI=null,null!==(g=mt(g=Bg(C))))if(null===(I=Eg(g)))g=null;else if(13===(e=I.tag)){if(null!==(g=Qg(I)))return g;g=null}else if(3===e){if(I.stateNode.current.memoizedState.isDehydrated)return 3===I.tag?I.stateNode.containerInfo:null;g=null}else I!==g&&(g=null);return jI=g,null}function OI(g){switch(g){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(qg()){case $g:return 1;case gI:return 4;case II:case eI:return 16;case CI:return 536870912;default:return 16}default:return 16}}var _I=null,qI=null,$I=null;function ge(){if($I)return $I;var g,I,e=qI,C=e.length,t="value"in _I?_I.value:_I.textContent,l=t.length;for(g=0;g<C&&e[g]===t[g];g++);var n=C-g;for(I=1;I<=n&&e[C-I]===t[l-I];I++);return $I=t.slice(g,1<I?1-I:void 0)}function Ie(g){var I=g.keyCode;return"charCode"in g?0===(g=g.charCode)&&13===I&&(g=13):g=I,10===g&&(g=13),32<=g||13===g?g:0}function ee(){return!0}function Ce(){return!1}function te(g){function I(I,e,C,t,l){for(var n in this._reactName=I,this._targetInst=C,this.type=e,this.nativeEvent=t,this.target=l,this.currentTarget=null,g)g.hasOwnProperty(n)&&(I=g[n],this[n]=I?I(t):t[n]);return this.isDefaultPrevented=(null!=t.defaultPrevented?t.defaultPrevented:!1===t.returnValue)?ee:Ce,this.isPropagationStopped=Ce,this}return K(I.prototype,{preventDefault:function(){this.defaultPrevented=!0;var g=this.nativeEvent;g&&(g.preventDefault?g.preventDefault():"unknown"!==typeof g.returnValue&&(g.returnValue=!1),this.isDefaultPrevented=ee)},stopPropagation:function(){var g=this.nativeEvent;g&&(g.stopPropagation?g.stopPropagation():"unknown"!==typeof g.cancelBubble&&(g.cancelBubble=!0),this.isPropagationStopped=ee)},persist:function(){},isPersistent:ee}),I}var le,ne,oe,ae={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(g){return g.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ie=te(ae),Ae=K({},ae,{view:0,detail:0}),ce=te(Ae),se=K({},Ae,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:We,button:0,buttons:0,relatedTarget:function(g){return void 0===g.relatedTarget?g.fromElement===g.srcElement?g.toElement:g.fromElement:g.relatedTarget},movementX:function(g){return"movementX"in g?g.movementX:(g!==oe&&(oe&&"mousemove"===g.type?(le=g.screenX-oe.screenX,ne=g.screenY-oe.screenY):ne=le=0,oe=g),le)},movementY:function(g){return"movementY"in g?g.movementY:ne}}),de=te(se),re=te(K({},se,{dataTransfer:0})),be=te(K({},Ae,{relatedTarget:0})),ue=te(K({},ae,{animationName:0,elapsedTime:0,pseudoElement:0})),me=K({},ae,{clipboardData:function(g){return"clipboardData"in g?g.clipboardData:window.clipboardData}}),Ze=te(me),he=te(K({},ae,{data:0})),Ge={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Be={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ye={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function pe(g){var I=this.nativeEvent;return I.getModifierState?I.getModifierState(g):!!(g=ye[g])&&!!I[g]}function We(){return pe}var Ve=K({},Ae,{key:function(g){if(g.key){var I=Ge[g.key]||g.key;if("Unidentified"!==I)return I}return"keypress"===g.type?13===(g=Ie(g))?"Enter":String.fromCharCode(g):"keydown"===g.type||"keyup"===g.type?Be[g.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:We,charCode:function(g){return"keypress"===g.type?Ie(g):0},keyCode:function(g){return"keydown"===g.type||"keyup"===g.type?g.keyCode:0},which:function(g){return"keypress"===g.type?Ie(g):"keydown"===g.type||"keyup"===g.type?g.keyCode:0}}),Se=te(Ve),Xe=te(K({},se,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Re=te(K({},Ae,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:We})),Je=te(K({},ae,{propertyName:0,elapsedTime:0,pseudoElement:0})),ke=K({},se,{deltaX:function(g){return"deltaX"in g?g.deltaX:"wheelDeltaX"in g?-g.wheelDeltaX:0},deltaY:function(g){return"deltaY"in g?g.deltaY:"wheelDeltaY"in g?-g.wheelDeltaY:"wheelDelta"in g?-g.wheelDelta:0},deltaZ:0,deltaMode:0}),Ye=te(ke),fe=[9,13,27,32],ve=A&&"CompositionEvent"in window,He=null;A&&"documentMode"in document&&(He=document.documentMode);var we=A&&"TextEvent"in window&&!He,Ne=A&&(!ve||He&&8<He&&11>=He),Ke=String.fromCharCode(32),Fe=!1;function xe(g,I){switch(g){case"keyup":return-1!==fe.indexOf(I.keyCode);case"keydown":return 229!==I.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ze(g){return"object"===typeof(g=g.detail)&&"data"in g?g.data:null}var Me=!1;var Ee={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Qe(g){var I=g&&g.nodeName&&g.nodeName.toLowerCase();return"input"===I?!!Ee[g.type]:"textarea"===I}function Ue(g,I,e,C){Sg(C),0<(I=LC(I,"onChange")).length&&(e=new ie("onChange","change",null,e,C),g.push({event:e,listeners:I}))}var Le=null,De=null;function Te(g){KC(g,0)}function je(g){if(T(ht(g)))return g}function Pe(g,I){if("change"===g)return I}var Oe=!1;if(A){var _e;if(A){var qe="oninput"in document;if(!qe){var $e=document.createElement("div");$e.setAttribute("oninput","return;"),qe="function"===typeof $e.oninput}_e=qe}else _e=!1;Oe=_e&&(!document.documentMode||9<document.documentMode)}function gC(){Le&&(Le.detachEvent("onpropertychange",IC),De=Le=null)}function IC(g){if("value"===g.propertyName&&je(De)){var I=[];Ue(I,De,g,Bg(g)),Yg(Te,I)}}function eC(g,I,e){"focusin"===g?(gC(),De=e,(Le=I).attachEvent("onpropertychange",IC)):"focusout"===g&&gC()}function CC(g){if("selectionchange"===g||"keyup"===g||"keydown"===g)return je(De)}function tC(g,I){if("click"===g)return je(I)}function lC(g,I){if("input"===g||"change"===g)return je(I)}var nC="function"===typeof Object.is?Object.is:function(g,I){return g===I&&(0!==g||1/g===1/I)||g!==g&&I!==I};function oC(g,I){if(nC(g,I))return!0;if("object"!==typeof g||null===g||"object"!==typeof I||null===I)return!1;var e=Object.keys(g),C=Object.keys(I);if(e.length!==C.length)return!1;for(C=0;C<e.length;C++){var t=e[C];if(!c.call(I,t)||!nC(g[t],I[t]))return!1}return!0}function aC(g){for(;g&&g.firstChild;)g=g.firstChild;return g}function iC(g,I){var e,C=aC(g);for(g=0;C;){if(3===C.nodeType){if(e=g+C.textContent.length,g<=I&&e>=I)return{node:C,offset:I-g};g=e}g:{for(;C;){if(C.nextSibling){C=C.nextSibling;break g}C=C.parentNode}C=void 0}C=aC(C)}}function AC(g,I){return!(!g||!I)&&(g===I||(!g||3!==g.nodeType)&&(I&&3===I.nodeType?AC(g,I.parentNode):"contains"in g?g.contains(I):!!g.compareDocumentPosition&&!!(16&g.compareDocumentPosition(I))))}function cC(){for(var g=window,I=j();I instanceof g.HTMLIFrameElement;){try{var e="string"===typeof I.contentWindow.location.href}catch(C){e=!1}if(!e)break;I=j((g=I.contentWindow).document)}return I}function sC(g){var I=g&&g.nodeName&&g.nodeName.toLowerCase();return I&&("input"===I&&("text"===g.type||"search"===g.type||"tel"===g.type||"url"===g.type||"password"===g.type)||"textarea"===I||"true"===g.contentEditable)}function dC(g){var I=cC(),e=g.focusedElem,C=g.selectionRange;if(I!==e&&e&&e.ownerDocument&&AC(e.ownerDocument.documentElement,e)){if(null!==C&&sC(e))if(I=C.start,void 0===(g=C.end)&&(g=I),"selectionStart"in e)e.selectionStart=I,e.selectionEnd=Math.min(g,e.value.length);else if((g=(I=e.ownerDocument||document)&&I.defaultView||window).getSelection){g=g.getSelection();var t=e.textContent.length,l=Math.min(C.start,t);C=void 0===C.end?l:Math.min(C.end,t),!g.extend&&l>C&&(t=C,C=l,l=t),t=iC(e,l);var n=iC(e,C);t&&n&&(1!==g.rangeCount||g.anchorNode!==t.node||g.anchorOffset!==t.offset||g.focusNode!==n.node||g.focusOffset!==n.offset)&&((I=I.createRange()).setStart(t.node,t.offset),g.removeAllRanges(),l>C?(g.addRange(I),g.extend(n.node,n.offset)):(I.setEnd(n.node,n.offset),g.addRange(I)))}for(I=[],g=e;g=g.parentNode;)1===g.nodeType&&I.push({element:g,left:g.scrollLeft,top:g.scrollTop});for("function"===typeof e.focus&&e.focus(),e=0;e<I.length;e++)(g=I[e]).element.scrollLeft=g.left,g.element.scrollTop=g.top}}var rC=A&&"documentMode"in document&&11>=document.documentMode,bC=null,uC=null,mC=null,ZC=!1;function hC(g,I,e){var C=e.window===e?e.document:9===e.nodeType?e:e.ownerDocument;ZC||null==bC||bC!==j(C)||("selectionStart"in(C=bC)&&sC(C)?C={start:C.selectionStart,end:C.selectionEnd}:C={anchorNode:(C=(C.ownerDocument&&C.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:C.anchorOffset,focusNode:C.focusNode,focusOffset:C.focusOffset},mC&&oC(mC,C)||(mC=C,0<(C=LC(uC,"onSelect")).length&&(I=new ie("onSelect","select",null,I,e),g.push({event:I,listeners:C}),I.target=bC)))}function GC(g,I){var e={};return e[g.toLowerCase()]=I.toLowerCase(),e["Webkit"+g]="webkit"+I,e["Moz"+g]="moz"+I,e}var BC={animationend:GC("Animation","AnimationEnd"),animationiteration:GC("Animation","AnimationIteration"),animationstart:GC("Animation","AnimationStart"),transitionend:GC("Transition","TransitionEnd")},yC={},pC={};function WC(g){if(yC[g])return yC[g];if(!BC[g])return g;var I,e=BC[g];for(I in e)if(e.hasOwnProperty(I)&&I in pC)return yC[g]=e[I];return g}A&&(pC=document.createElement("div").style,"AnimationEvent"in window||(delete BC.animationend.animation,delete BC.animationiteration.animation,delete BC.animationstart.animation),"TransitionEvent"in window||delete BC.transitionend.transition);var VC=WC("animationend"),SC=WC("animationiteration"),XC=WC("animationstart"),RC=WC("transitionend"),JC=new Map,kC="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function YC(g,I){JC.set(g,I),a(I,[g])}for(var fC=0;fC<kC.length;fC++){var vC=kC[fC];YC(vC.toLowerCase(),"on"+(vC[0].toUpperCase()+vC.slice(1)))}YC(VC,"onAnimationEnd"),YC(SC,"onAnimationIteration"),YC(XC,"onAnimationStart"),YC("dblclick","onDoubleClick"),YC("focusin","onFocus"),YC("focusout","onBlur"),YC(RC,"onTransitionEnd"),i("onMouseEnter",["mouseout","mouseover"]),i("onMouseLeave",["mouseout","mouseover"]),i("onPointerEnter",["pointerout","pointerover"]),i("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var HC="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),wC=new Set("cancel close invalid load scroll toggle".split(" ").concat(HC));function NC(g,I,e){var C=g.type||"unknown-event";g.currentTarget=e,function(g,I,e,C,t,n,o,a,i){if(Mg.apply(this,arguments),Ng){if(!Ng)throw Error(l(198));var A=Kg;Ng=!1,Kg=null,Fg||(Fg=!0,xg=A)}}(C,I,void 0,g),g.currentTarget=null}function KC(g,I){I=0!==(4&I);for(var e=0;e<g.length;e++){var C=g[e],t=C.event;C=C.listeners;g:{var l=void 0;if(I)for(var n=C.length-1;0<=n;n--){var o=C[n],a=o.instance,i=o.currentTarget;if(o=o.listener,a!==l&&t.isPropagationStopped())break g;NC(t,o,i),l=a}else for(n=0;n<C.length;n++){if(a=(o=C[n]).instance,i=o.currentTarget,o=o.listener,a!==l&&t.isPropagationStopped())break g;NC(t,o,i),l=a}}}if(Fg)throw g=xg,Fg=!1,xg=null,g}function FC(g,I){var e=I[rt];void 0===e&&(e=I[rt]=new Set);var C=g+"__bubble";e.has(C)||(EC(I,g,2,!1),e.add(C))}function xC(g,I,e){var C=0;I&&(C|=4),EC(e,g,C,I)}var zC="_reactListening"+Math.random().toString(36).slice(2);function MC(g){if(!g[zC]){g[zC]=!0,n.forEach((function(I){"selectionchange"!==I&&(wC.has(I)||xC(I,!1,g),xC(I,!0,g))}));var I=9===g.nodeType?g:g.ownerDocument;null===I||I[zC]||(I[zC]=!0,xC("selectionchange",!1,I))}}function EC(g,I,e,C){switch(OI(I)){case 1:var t=LI;break;case 4:t=DI;break;default:t=TI}e=t.bind(null,I,e,g),t=void 0,!vg||"touchstart"!==I&&"touchmove"!==I&&"wheel"!==I||(t=!0),C?void 0!==t?g.addEventListener(I,e,{capture:!0,passive:t}):g.addEventListener(I,e,!0):void 0!==t?g.addEventListener(I,e,{passive:t}):g.addEventListener(I,e,!1)}function QC(g,I,e,C,t){var l=C;if(0===(1&I)&&0===(2&I)&&null!==C)g:for(;;){if(null===C)return;var n=C.tag;if(3===n||4===n){var o=C.stateNode.containerInfo;if(o===t||8===o.nodeType&&o.parentNode===t)break;if(4===n)for(n=C.return;null!==n;){var a=n.tag;if((3===a||4===a)&&((a=n.stateNode.containerInfo)===t||8===a.nodeType&&a.parentNode===t))return;n=n.return}for(;null!==o;){if(null===(n=mt(o)))return;if(5===(a=n.tag)||6===a){C=l=n;continue g}o=o.parentNode}}C=C.return}Yg((function(){var C=l,t=Bg(e),n=[];g:{var o=JC.get(g);if(void 0!==o){var a=ie,i=g;switch(g){case"keypress":if(0===Ie(e))break g;case"keydown":case"keyup":a=Se;break;case"focusin":i="focus",a=be;break;case"focusout":i="blur",a=be;break;case"beforeblur":case"afterblur":a=be;break;case"click":if(2===e.button)break g;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":a=de;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":a=re;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":a=Re;break;case VC:case SC:case XC:a=ue;break;case RC:a=Je;break;case"scroll":a=ce;break;case"wheel":a=Ye;break;case"copy":case"cut":case"paste":a=Ze;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":a=Xe}var A=0!==(4&I),c=!A&&"scroll"===g,s=A?null!==o?o+"Capture":null:o;A=[];for(var d,r=C;null!==r;){var b=(d=r).stateNode;if(5===d.tag&&null!==b&&(d=b,null!==s&&(null!=(b=fg(r,s))&&A.push(UC(r,b,d)))),c)break;r=r.return}0<A.length&&(o=new a(o,i,null,e,t),n.push({event:o,listeners:A}))}}if(0===(7&I)){if(a="mouseout"===g||"pointerout"===g,(!(o="mouseover"===g||"pointerover"===g)||e===Gg||!(i=e.relatedTarget||e.fromElement)||!mt(i)&&!i[dt])&&(a||o)&&(o=t.window===t?t:(o=t.ownerDocument)?o.defaultView||o.parentWindow:window,a?(a=C,null!==(i=(i=e.relatedTarget||e.toElement)?mt(i):null)&&(i!==(c=Eg(i))||5!==i.tag&&6!==i.tag)&&(i=null)):(a=null,i=C),a!==i)){if(A=de,b="onMouseLeave",s="onMouseEnter",r="mouse","pointerout"!==g&&"pointerover"!==g||(A=Xe,b="onPointerLeave",s="onPointerEnter",r="pointer"),c=null==a?o:ht(a),d=null==i?o:ht(i),(o=new A(b,r+"leave",a,e,t)).target=c,o.relatedTarget=d,b=null,mt(t)===C&&((A=new A(s,r+"enter",i,e,t)).target=d,A.relatedTarget=c,b=A),c=b,a&&i)g:{for(s=i,r=0,d=A=a;d;d=DC(d))r++;for(d=0,b=s;b;b=DC(b))d++;for(;0<r-d;)A=DC(A),r--;for(;0<d-r;)s=DC(s),d--;for(;r--;){if(A===s||null!==s&&A===s.alternate)break g;A=DC(A),s=DC(s)}A=null}else A=null;null!==a&&TC(n,o,a,A,!1),null!==i&&null!==c&&TC(n,c,i,A,!0)}if("select"===(a=(o=C?ht(C):window).nodeName&&o.nodeName.toLowerCase())||"input"===a&&"file"===o.type)var u=Pe;else if(Qe(o))if(Oe)u=lC;else{u=CC;var m=eC}else(a=o.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(u=tC);switch(u&&(u=u(g,C))?Ue(n,u,e,t):(m&&m(g,o,C),"focusout"===g&&(m=o._wrapperState)&&m.controlled&&"number"===o.type&&gg(o,"number",o.value)),m=C?ht(C):window,g){case"focusin":(Qe(m)||"true"===m.contentEditable)&&(bC=m,uC=C,mC=null);break;case"focusout":mC=uC=bC=null;break;case"mousedown":ZC=!0;break;case"contextmenu":case"mouseup":case"dragend":ZC=!1,hC(n,e,t);break;case"selectionchange":if(rC)break;case"keydown":case"keyup":hC(n,e,t)}var Z;if(ve)g:{switch(g){case"compositionstart":var h="onCompositionStart";break g;case"compositionend":h="onCompositionEnd";break g;case"compositionupdate":h="onCompositionUpdate";break g}h=void 0}else Me?xe(g,e)&&(h="onCompositionEnd"):"keydown"===g&&229===e.keyCode&&(h="onCompositionStart");h&&(Ne&&"ko"!==e.locale&&(Me||"onCompositionStart"!==h?"onCompositionEnd"===h&&Me&&(Z=ge()):(qI="value"in(_I=t)?_I.value:_I.textContent,Me=!0)),0<(m=LC(C,h)).length&&(h=new he(h,g,null,e,t),n.push({event:h,listeners:m}),Z?h.data=Z:null!==(Z=ze(e))&&(h.data=Z))),(Z=we?function(g,I){switch(g){case"compositionend":return ze(I);case"keypress":return 32!==I.which?null:(Fe=!0,Ke);case"textInput":return(g=I.data)===Ke&&Fe?null:g;default:return null}}(g,e):function(g,I){if(Me)return"compositionend"===g||!ve&&xe(g,I)?(g=ge(),$I=qI=_I=null,Me=!1,g):null;switch(g){case"paste":default:return null;case"keypress":if(!(I.ctrlKey||I.altKey||I.metaKey)||I.ctrlKey&&I.altKey){if(I.char&&1<I.char.length)return I.char;if(I.which)return String.fromCharCode(I.which)}return null;case"compositionend":return Ne&&"ko"!==I.locale?null:I.data}}(g,e))&&(0<(C=LC(C,"onBeforeInput")).length&&(t=new he("onBeforeInput","beforeinput",null,e,t),n.push({event:t,listeners:C}),t.data=Z))}KC(n,I)}))}function UC(g,I,e){return{instance:g,listener:I,currentTarget:e}}function LC(g,I){for(var e=I+"Capture",C=[];null!==g;){var t=g,l=t.stateNode;5===t.tag&&null!==l&&(t=l,null!=(l=fg(g,e))&&C.unshift(UC(g,l,t)),null!=(l=fg(g,I))&&C.push(UC(g,l,t))),g=g.return}return C}function DC(g){if(null===g)return null;do{g=g.return}while(g&&5!==g.tag);return g||null}function TC(g,I,e,C,t){for(var l=I._reactName,n=[];null!==e&&e!==C;){var o=e,a=o.alternate,i=o.stateNode;if(null!==a&&a===C)break;5===o.tag&&null!==i&&(o=i,t?null!=(a=fg(e,l))&&n.unshift(UC(e,a,o)):t||null!=(a=fg(e,l))&&n.push(UC(e,a,o))),e=e.return}0!==n.length&&g.push({event:I,listeners:n})}var jC=/\r\n?/g,PC=/\u0000|\uFFFD/g;function OC(g){return("string"===typeof g?g:""+g).replace(jC,"\n").replace(PC,"")}function _C(g,I,e){if(I=OC(I),OC(g)!==I&&e)throw Error(l(425))}function qC(){}var $C=null,gt=null;function It(g,I){return"textarea"===g||"noscript"===g||"string"===typeof I.children||"number"===typeof I.children||"object"===typeof I.dangerouslySetInnerHTML&&null!==I.dangerouslySetInnerHTML&&null!=I.dangerouslySetInnerHTML.__html}var et="function"===typeof setTimeout?setTimeout:void 0,Ct="function"===typeof clearTimeout?clearTimeout:void 0,tt="function"===typeof Promise?Promise:void 0,lt="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof tt?function(g){return tt.resolve(null).then(g).catch(nt)}:et;function nt(g){setTimeout((function(){throw g}))}function ot(g,I){var e=I,C=0;do{var t=e.nextSibling;if(g.removeChild(e),t&&8===t.nodeType)if("/$"===(e=t.data)){if(0===C)return g.removeChild(t),void EI(I);C--}else"$"!==e&&"$?"!==e&&"$!"!==e||C++;e=t}while(e);EI(I)}function at(g){for(;null!=g;g=g.nextSibling){var I=g.nodeType;if(1===I||3===I)break;if(8===I){if("$"===(I=g.data)||"$!"===I||"$?"===I)break;if("/$"===I)return null}}return g}function it(g){g=g.previousSibling;for(var I=0;g;){if(8===g.nodeType){var e=g.data;if("$"===e||"$!"===e||"$?"===e){if(0===I)return g;I--}else"/$"===e&&I++}g=g.previousSibling}return null}var At=Math.random().toString(36).slice(2),ct="__reactFiber$"+At,st="__reactProps$"+At,dt="__reactContainer$"+At,rt="__reactEvents$"+At,bt="__reactListeners$"+At,ut="__reactHandles$"+At;function mt(g){var I=g[ct];if(I)return I;for(var e=g.parentNode;e;){if(I=e[dt]||e[ct]){if(e=I.alternate,null!==I.child||null!==e&&null!==e.child)for(g=it(g);null!==g;){if(e=g[ct])return e;g=it(g)}return I}e=(g=e).parentNode}return null}function Zt(g){return!(g=g[ct]||g[dt])||5!==g.tag&&6!==g.tag&&13!==g.tag&&3!==g.tag?null:g}function ht(g){if(5===g.tag||6===g.tag)return g.stateNode;throw Error(l(33))}function Gt(g){return g[st]||null}var Bt=[],yt=-1;function pt(g){return{current:g}}function Wt(g){0>yt||(g.current=Bt[yt],Bt[yt]=null,yt--)}function Vt(g,I){yt++,Bt[yt]=g.current,g.current=I}var St={},Xt=pt(St),Rt=pt(!1),Jt=St;function kt(g,I){var e=g.type.contextTypes;if(!e)return St;var C=g.stateNode;if(C&&C.__reactInternalMemoizedUnmaskedChildContext===I)return C.__reactInternalMemoizedMaskedChildContext;var t,l={};for(t in e)l[t]=I[t];return C&&((g=g.stateNode).__reactInternalMemoizedUnmaskedChildContext=I,g.__reactInternalMemoizedMaskedChildContext=l),l}function Yt(g){return null!==(g=g.childContextTypes)&&void 0!==g}function ft(){Wt(Rt),Wt(Xt)}function vt(g,I,e){if(Xt.current!==St)throw Error(l(168));Vt(Xt,I),Vt(Rt,e)}function Ht(g,I,e){var C=g.stateNode;if(I=I.childContextTypes,"function"!==typeof C.getChildContext)return e;for(var t in C=C.getChildContext())if(!(t in I))throw Error(l(108,Q(g)||"Unknown",t));return K({},e,C)}function wt(g){return g=(g=g.stateNode)&&g.__reactInternalMemoizedMergedChildContext||St,Jt=Xt.current,Vt(Xt,g),Vt(Rt,Rt.current),!0}function Nt(g,I,e){var C=g.stateNode;if(!C)throw Error(l(169));e?(g=Ht(g,I,Jt),C.__reactInternalMemoizedMergedChildContext=g,Wt(Rt),Wt(Xt),Vt(Xt,g)):Wt(Rt),Vt(Rt,e)}var Kt=null,Ft=!1,xt=!1;function zt(g){null===Kt?Kt=[g]:Kt.push(g)}function Mt(){if(!xt&&null!==Kt){xt=!0;var g=0,I=hI;try{var e=Kt;for(hI=1;g<e.length;g++){var C=e[g];do{C=C(!0)}while(null!==C)}Kt=null,Ft=!1}catch(t){throw null!==Kt&&(Kt=Kt.slice(g+1)),Tg($g,Mt),t}finally{hI=I,xt=!1}}return null}var Et=[],Qt=0,Ut=null,Lt=0,Dt=[],Tt=0,jt=null,Pt=1,Ot="";function _t(g,I){Et[Qt++]=Lt,Et[Qt++]=Ut,Ut=g,Lt=I}function qt(g,I,e){Dt[Tt++]=Pt,Dt[Tt++]=Ot,Dt[Tt++]=jt,jt=g;var C=Pt;g=Ot;var t=32-nI(C)-1;C&=~(1<<t),e+=1;var l=32-nI(I)+t;if(30<l){var n=t-t%5;l=(C&(1<<n)-1).toString(32),C>>=n,t-=n,Pt=1<<32-nI(I)+t|e<<t|C,Ot=l+g}else Pt=1<<l|e<<t|C,Ot=g}function $t(g){null!==g.return&&(_t(g,1),qt(g,1,0))}function gl(g){for(;g===Ut;)Ut=Et[--Qt],Et[Qt]=null,Lt=Et[--Qt],Et[Qt]=null;for(;g===jt;)jt=Dt[--Tt],Dt[Tt]=null,Ot=Dt[--Tt],Dt[Tt]=null,Pt=Dt[--Tt],Dt[Tt]=null}var Il=null,el=null,Cl=!1,tl=null;function ll(g,I){var e=fi(5,null,null,0);e.elementType="DELETED",e.stateNode=I,e.return=g,null===(I=g.deletions)?(g.deletions=[e],g.flags|=16):I.push(e)}function nl(g,I){switch(g.tag){case 5:var e=g.type;return null!==(I=1!==I.nodeType||e.toLowerCase()!==I.nodeName.toLowerCase()?null:I)&&(g.stateNode=I,Il=g,el=at(I.firstChild),!0);case 6:return null!==(I=""===g.pendingProps||3!==I.nodeType?null:I)&&(g.stateNode=I,Il=g,el=null,!0);case 13:return null!==(I=8!==I.nodeType?null:I)&&(e=null!==jt?{id:Pt,overflow:Ot}:null,g.memoizedState={dehydrated:I,treeContext:e,retryLane:1073741824},(e=fi(18,null,null,0)).stateNode=I,e.return=g,g.child=e,Il=g,el=null,!0);default:return!1}}function ol(g){return 0!==(1&g.mode)&&0===(128&g.flags)}function al(g){if(Cl){var I=el;if(I){var e=I;if(!nl(g,I)){if(ol(g))throw Error(l(418));I=at(e.nextSibling);var C=Il;I&&nl(g,I)?ll(C,e):(g.flags=-4097&g.flags|2,Cl=!1,Il=g)}}else{if(ol(g))throw Error(l(418));g.flags=-4097&g.flags|2,Cl=!1,Il=g}}}function il(g){for(g=g.return;null!==g&&5!==g.tag&&3!==g.tag&&13!==g.tag;)g=g.return;Il=g}function Al(g){if(g!==Il)return!1;if(!Cl)return il(g),Cl=!0,!1;var I;if((I=3!==g.tag)&&!(I=5!==g.tag)&&(I="head"!==(I=g.type)&&"body"!==I&&!It(g.type,g.memoizedProps)),I&&(I=el)){if(ol(g))throw cl(),Error(l(418));for(;I;)ll(g,I),I=at(I.nextSibling)}if(il(g),13===g.tag){if(!(g=null!==(g=g.memoizedState)?g.dehydrated:null))throw Error(l(317));g:{for(g=g.nextSibling,I=0;g;){if(8===g.nodeType){var e=g.data;if("/$"===e){if(0===I){el=at(g.nextSibling);break g}I--}else"$"!==e&&"$!"!==e&&"$?"!==e||I++}g=g.nextSibling}el=null}}else el=Il?at(g.stateNode.nextSibling):null;return!0}function cl(){for(var g=el;g;)g=at(g.nextSibling)}function sl(){el=Il=null,Cl=!1}function dl(g){null===tl?tl=[g]:tl.push(g)}var rl=G.ReactCurrentBatchConfig;function bl(g,I){if(g&&g.defaultProps){for(var e in I=K({},I),g=g.defaultProps)void 0===I[e]&&(I[e]=g[e]);return I}return I}var ul=pt(null),ml=null,Zl=null,hl=null;function Gl(){hl=Zl=ml=null}function Bl(g){var I=ul.current;Wt(ul),g._currentValue=I}function yl(g,I,e){for(;null!==g;){var C=g.alternate;if((g.childLanes&I)!==I?(g.childLanes|=I,null!==C&&(C.childLanes|=I)):null!==C&&(C.childLanes&I)!==I&&(C.childLanes|=I),g===e)break;g=g.return}}function pl(g,I){ml=g,hl=Zl=null,null!==(g=g.dependencies)&&null!==g.firstContext&&(0!==(g.lanes&I)&&(Go=!0),g.firstContext=null)}function Wl(g){var I=g._currentValue;if(hl!==g)if(g={context:g,memoizedValue:I,next:null},null===Zl){if(null===ml)throw Error(l(308));Zl=g,ml.dependencies={lanes:0,firstContext:g}}else Zl=Zl.next=g;return I}var Vl=null;function Sl(g){null===Vl?Vl=[g]:Vl.push(g)}function Xl(g,I,e,C){var t=I.interleaved;return null===t?(e.next=e,Sl(I)):(e.next=t.next,t.next=e),I.interleaved=e,Rl(g,C)}function Rl(g,I){g.lanes|=I;var e=g.alternate;for(null!==e&&(e.lanes|=I),e=g,g=g.return;null!==g;)g.childLanes|=I,null!==(e=g.alternate)&&(e.childLanes|=I),e=g,g=g.return;return 3===e.tag?e.stateNode:null}var Jl=!1;function kl(g){g.updateQueue={baseState:g.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Yl(g,I){g=g.updateQueue,I.updateQueue===g&&(I.updateQueue={baseState:g.baseState,firstBaseUpdate:g.firstBaseUpdate,lastBaseUpdate:g.lastBaseUpdate,shared:g.shared,effects:g.effects})}function fl(g,I){return{eventTime:g,lane:I,tag:0,payload:null,callback:null,next:null}}function vl(g,I,e){var C=g.updateQueue;if(null===C)return null;if(C=C.shared,0!==(2&Ja)){var t=C.pending;return null===t?I.next=I:(I.next=t.next,t.next=I),C.pending=I,Rl(g,e)}return null===(t=C.interleaved)?(I.next=I,Sl(C)):(I.next=t.next,t.next=I),C.interleaved=I,Rl(g,e)}function Hl(g,I,e){if(null!==(I=I.updateQueue)&&(I=I.shared,0!==(4194240&e))){var C=I.lanes;e|=C&=g.pendingLanes,I.lanes=e,ZI(g,e)}}function wl(g,I){var e=g.updateQueue,C=g.alternate;if(null!==C&&e===(C=C.updateQueue)){var t=null,l=null;if(null!==(e=e.firstBaseUpdate)){do{var n={eventTime:e.eventTime,lane:e.lane,tag:e.tag,payload:e.payload,callback:e.callback,next:null};null===l?t=l=n:l=l.next=n,e=e.next}while(null!==e);null===l?t=l=I:l=l.next=I}else t=l=I;return e={baseState:C.baseState,firstBaseUpdate:t,lastBaseUpdate:l,shared:C.shared,effects:C.effects},void(g.updateQueue=e)}null===(g=e.lastBaseUpdate)?e.firstBaseUpdate=I:g.next=I,e.lastBaseUpdate=I}function Nl(g,I,e,C){var t=g.updateQueue;Jl=!1;var l=t.firstBaseUpdate,n=t.lastBaseUpdate,o=t.shared.pending;if(null!==o){t.shared.pending=null;var a=o,i=a.next;a.next=null,null===n?l=i:n.next=i,n=a;var A=g.alternate;null!==A&&((o=(A=A.updateQueue).lastBaseUpdate)!==n&&(null===o?A.firstBaseUpdate=i:o.next=i,A.lastBaseUpdate=a))}if(null!==l){var c=t.baseState;for(n=0,A=i=a=null,o=l;;){var s=o.lane,d=o.eventTime;if((C&s)===s){null!==A&&(A=A.next={eventTime:d,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});g:{var r=g,b=o;switch(s=I,d=e,b.tag){case 1:if("function"===typeof(r=b.payload)){c=r.call(d,c,s);break g}c=r;break g;case 3:r.flags=-65537&r.flags|128;case 0:if(null===(s="function"===typeof(r=b.payload)?r.call(d,c,s):r)||void 0===s)break g;c=K({},c,s);break g;case 2:Jl=!0}}null!==o.callback&&0!==o.lane&&(g.flags|=64,null===(s=t.effects)?t.effects=[o]:s.push(o))}else d={eventTime:d,lane:s,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===A?(i=A=d,a=c):A=A.next=d,n|=s;if(null===(o=o.next)){if(null===(o=t.shared.pending))break;o=(s=o).next,s.next=null,t.lastBaseUpdate=s,t.shared.pending=null}}if(null===A&&(a=c),t.baseState=a,t.firstBaseUpdate=i,t.lastBaseUpdate=A,null!==(I=t.shared.interleaved)){t=I;do{n|=t.lane,t=t.next}while(t!==I)}else null===l&&(t.shared.lanes=0);Ka|=n,g.lanes=n,g.memoizedState=c}}function Kl(g,I,e){if(g=I.effects,I.effects=null,null!==g)for(I=0;I<g.length;I++){var C=g[I],t=C.callback;if(null!==t){if(C.callback=null,C=e,"function"!==typeof t)throw Error(l(191,t));t.call(C)}}}var Fl=(new C.Component).refs;function xl(g,I,e,C){e=null===(e=e(C,I=g.memoizedState))||void 0===e?I:K({},I,e),g.memoizedState=e,0===g.lanes&&(g.updateQueue.baseState=e)}var zl={isMounted:function(g){return!!(g=g._reactInternals)&&Eg(g)===g},enqueueSetState:function(g,I,e){g=g._reactInternals;var C=Ii(),t=ei(g),l=fl(C,t);l.payload=I,void 0!==e&&null!==e&&(l.callback=e),null!==(I=vl(g,l,t))&&(Ci(I,g,t,C),Hl(I,g,t))},enqueueReplaceState:function(g,I,e){g=g._reactInternals;var C=Ii(),t=ei(g),l=fl(C,t);l.tag=1,l.payload=I,void 0!==e&&null!==e&&(l.callback=e),null!==(I=vl(g,l,t))&&(Ci(I,g,t,C),Hl(I,g,t))},enqueueForceUpdate:function(g,I){g=g._reactInternals;var e=Ii(),C=ei(g),t=fl(e,C);t.tag=2,void 0!==I&&null!==I&&(t.callback=I),null!==(I=vl(g,t,C))&&(Ci(I,g,C,e),Hl(I,g,C))}};function Ml(g,I,e,C,t,l,n){return"function"===typeof(g=g.stateNode).shouldComponentUpdate?g.shouldComponentUpdate(C,l,n):!I.prototype||!I.prototype.isPureReactComponent||(!oC(e,C)||!oC(t,l))}function El(g,I,e){var C=!1,t=St,l=I.contextType;return"object"===typeof l&&null!==l?l=Wl(l):(t=Yt(I)?Jt:Xt.current,l=(C=null!==(C=I.contextTypes)&&void 0!==C)?kt(g,t):St),I=new I(e,l),g.memoizedState=null!==I.state&&void 0!==I.state?I.state:null,I.updater=zl,g.stateNode=I,I._reactInternals=g,C&&((g=g.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,g.__reactInternalMemoizedMaskedChildContext=l),I}function Ql(g,I,e,C){g=I.state,"function"===typeof I.componentWillReceiveProps&&I.componentWillReceiveProps(e,C),"function"===typeof I.UNSAFE_componentWillReceiveProps&&I.UNSAFE_componentWillReceiveProps(e,C),I.state!==g&&zl.enqueueReplaceState(I,I.state,null)}function Ul(g,I,e,C){var t=g.stateNode;t.props=e,t.state=g.memoizedState,t.refs=Fl,kl(g);var l=I.contextType;"object"===typeof l&&null!==l?t.context=Wl(l):(l=Yt(I)?Jt:Xt.current,t.context=kt(g,l)),t.state=g.memoizedState,"function"===typeof(l=I.getDerivedStateFromProps)&&(xl(g,I,l,e),t.state=g.memoizedState),"function"===typeof I.getDerivedStateFromProps||"function"===typeof t.getSnapshotBeforeUpdate||"function"!==typeof t.UNSAFE_componentWillMount&&"function"!==typeof t.componentWillMount||(I=t.state,"function"===typeof t.componentWillMount&&t.componentWillMount(),"function"===typeof t.UNSAFE_componentWillMount&&t.UNSAFE_componentWillMount(),I!==t.state&&zl.enqueueReplaceState(t,t.state,null),Nl(g,e,t,C),t.state=g.memoizedState),"function"===typeof t.componentDidMount&&(g.flags|=4194308)}function Ll(g,I,e){if(null!==(g=e.ref)&&"function"!==typeof g&&"object"!==typeof g){if(e._owner){if(e=e._owner){if(1!==e.tag)throw Error(l(309));var C=e.stateNode}if(!C)throw Error(l(147,g));var t=C,n=""+g;return null!==I&&null!==I.ref&&"function"===typeof I.ref&&I.ref._stringRef===n?I.ref:(I=function(g){var I=t.refs;I===Fl&&(I=t.refs={}),null===g?delete I[n]:I[n]=g},I._stringRef=n,I)}if("string"!==typeof g)throw Error(l(284));if(!e._owner)throw Error(l(290,g))}return g}function Dl(g,I){throw g=Object.prototype.toString.call(I),Error(l(31,"[object Object]"===g?"object with keys {"+Object.keys(I).join(", ")+"}":g))}function Tl(g){return(0,g._init)(g._payload)}function jl(g){function I(I,e){if(g){var C=I.deletions;null===C?(I.deletions=[e],I.flags|=16):C.push(e)}}function e(e,C){if(!g)return null;for(;null!==C;)I(e,C),C=C.sibling;return null}function C(g,I){for(g=new Map;null!==I;)null!==I.key?g.set(I.key,I):g.set(I.index,I),I=I.sibling;return g}function t(g,I){return(g=Hi(g,I)).index=0,g.sibling=null,g}function n(I,e,C){return I.index=C,g?null!==(C=I.alternate)?(C=C.index)<e?(I.flags|=2,e):C:(I.flags|=2,e):(I.flags|=1048576,e)}function o(I){return g&&null===I.alternate&&(I.flags|=2),I}function a(g,I,e,C){return null===I||6!==I.tag?((I=Fi(e,g.mode,C)).return=g,I):((I=t(I,e)).return=g,I)}function i(g,I,e,C){var l=e.type;return l===p?c(g,I,e.props.children,C,e.key):null!==I&&(I.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===f&&Tl(l)===I.type)?((C=t(I,e.props)).ref=Ll(g,I,e),C.return=g,C):((C=wi(e.type,e.key,e.props,null,g.mode,C)).ref=Ll(g,I,e),C.return=g,C)}function A(g,I,e,C){return null===I||4!==I.tag||I.stateNode.containerInfo!==e.containerInfo||I.stateNode.implementation!==e.implementation?((I=xi(e,g.mode,C)).return=g,I):((I=t(I,e.children||[])).return=g,I)}function c(g,I,e,C,l){return null===I||7!==I.tag?((I=Ni(e,g.mode,C,l)).return=g,I):((I=t(I,e)).return=g,I)}function s(g,I,e){if("string"===typeof I&&""!==I||"number"===typeof I)return(I=Fi(""+I,g.mode,e)).return=g,I;if("object"===typeof I&&null!==I){switch(I.$$typeof){case B:return(e=wi(I.type,I.key,I.props,null,g.mode,e)).ref=Ll(g,null,I),e.return=g,e;case y:return(I=xi(I,g.mode,e)).return=g,I;case f:return s(g,(0,I._init)(I._payload),e)}if(Ig(I)||w(I))return(I=Ni(I,g.mode,e,null)).return=g,I;Dl(g,I)}return null}function d(g,I,e,C){var t=null!==I?I.key:null;if("string"===typeof e&&""!==e||"number"===typeof e)return null!==t?null:a(g,I,""+e,C);if("object"===typeof e&&null!==e){switch(e.$$typeof){case B:return e.key===t?i(g,I,e,C):null;case y:return e.key===t?A(g,I,e,C):null;case f:return d(g,I,(t=e._init)(e._payload),C)}if(Ig(e)||w(e))return null!==t?null:c(g,I,e,C,null);Dl(g,e)}return null}function r(g,I,e,C,t){if("string"===typeof C&&""!==C||"number"===typeof C)return a(I,g=g.get(e)||null,""+C,t);if("object"===typeof C&&null!==C){switch(C.$$typeof){case B:return i(I,g=g.get(null===C.key?e:C.key)||null,C,t);case y:return A(I,g=g.get(null===C.key?e:C.key)||null,C,t);case f:return r(g,I,e,(0,C._init)(C._payload),t)}if(Ig(C)||w(C))return c(I,g=g.get(e)||null,C,t,null);Dl(I,C)}return null}function b(t,l,o,a){for(var i=null,A=null,c=l,b=l=0,u=null;null!==c&&b<o.length;b++){c.index>b?(u=c,c=null):u=c.sibling;var m=d(t,c,o[b],a);if(null===m){null===c&&(c=u);break}g&&c&&null===m.alternate&&I(t,c),l=n(m,l,b),null===A?i=m:A.sibling=m,A=m,c=u}if(b===o.length)return e(t,c),Cl&&_t(t,b),i;if(null===c){for(;b<o.length;b++)null!==(c=s(t,o[b],a))&&(l=n(c,l,b),null===A?i=c:A.sibling=c,A=c);return Cl&&_t(t,b),i}for(c=C(t,c);b<o.length;b++)null!==(u=r(c,t,b,o[b],a))&&(g&&null!==u.alternate&&c.delete(null===u.key?b:u.key),l=n(u,l,b),null===A?i=u:A.sibling=u,A=u);return g&&c.forEach((function(g){return I(t,g)})),Cl&&_t(t,b),i}function u(t,o,a,i){var A=w(a);if("function"!==typeof A)throw Error(l(150));if(null==(a=A.call(a)))throw Error(l(151));for(var c=A=null,b=o,u=o=0,m=null,Z=a.next();null!==b&&!Z.done;u++,Z=a.next()){b.index>u?(m=b,b=null):m=b.sibling;var h=d(t,b,Z.value,i);if(null===h){null===b&&(b=m);break}g&&b&&null===h.alternate&&I(t,b),o=n(h,o,u),null===c?A=h:c.sibling=h,c=h,b=m}if(Z.done)return e(t,b),Cl&&_t(t,u),A;if(null===b){for(;!Z.done;u++,Z=a.next())null!==(Z=s(t,Z.value,i))&&(o=n(Z,o,u),null===c?A=Z:c.sibling=Z,c=Z);return Cl&&_t(t,u),A}for(b=C(t,b);!Z.done;u++,Z=a.next())null!==(Z=r(b,t,u,Z.value,i))&&(g&&null!==Z.alternate&&b.delete(null===Z.key?u:Z.key),o=n(Z,o,u),null===c?A=Z:c.sibling=Z,c=Z);return g&&b.forEach((function(g){return I(t,g)})),Cl&&_t(t,u),A}return function g(C,l,n,a){if("object"===typeof n&&null!==n&&n.type===p&&null===n.key&&(n=n.props.children),"object"===typeof n&&null!==n){switch(n.$$typeof){case B:g:{for(var i=n.key,A=l;null!==A;){if(A.key===i){if((i=n.type)===p){if(7===A.tag){e(C,A.sibling),(l=t(A,n.props.children)).return=C,C=l;break g}}else if(A.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===f&&Tl(i)===A.type){e(C,A.sibling),(l=t(A,n.props)).ref=Ll(C,A,n),l.return=C,C=l;break g}e(C,A);break}I(C,A),A=A.sibling}n.type===p?((l=Ni(n.props.children,C.mode,a,n.key)).return=C,C=l):((a=wi(n.type,n.key,n.props,null,C.mode,a)).ref=Ll(C,l,n),a.return=C,C=a)}return o(C);case y:g:{for(A=n.key;null!==l;){if(l.key===A){if(4===l.tag&&l.stateNode.containerInfo===n.containerInfo&&l.stateNode.implementation===n.implementation){e(C,l.sibling),(l=t(l,n.children||[])).return=C,C=l;break g}e(C,l);break}I(C,l),l=l.sibling}(l=xi(n,C.mode,a)).return=C,C=l}return o(C);case f:return g(C,l,(A=n._init)(n._payload),a)}if(Ig(n))return b(C,l,n,a);if(w(n))return u(C,l,n,a);Dl(C,n)}return"string"===typeof n&&""!==n||"number"===typeof n?(n=""+n,null!==l&&6===l.tag?(e(C,l.sibling),(l=t(l,n)).return=C,C=l):(e(C,l),(l=Fi(n,C.mode,a)).return=C,C=l),o(C)):e(C,l)}}var Pl=jl(!0),Ol=jl(!1),_l={},ql=pt(_l),$l=pt(_l),gn=pt(_l);function In(g){if(g===_l)throw Error(l(174));return g}function en(g,I){switch(Vt(gn,I),Vt($l,g),Vt(ql,_l),g=I.nodeType){case 9:case 11:I=(I=I.documentElement)?I.namespaceURI:ag(null,"");break;default:I=ag(I=(g=8===g?I.parentNode:I).namespaceURI||null,g=g.tagName)}Wt(ql),Vt(ql,I)}function Cn(){Wt(ql),Wt($l),Wt(gn)}function tn(g){In(gn.current);var I=In(ql.current),e=ag(I,g.type);I!==e&&(Vt($l,g),Vt(ql,e))}function ln(g){$l.current===g&&(Wt(ql),Wt($l))}var nn=pt(0);function on(g){for(var I=g;null!==I;){if(13===I.tag){var e=I.memoizedState;if(null!==e&&(null===(e=e.dehydrated)||"$?"===e.data||"$!"===e.data))return I}else if(19===I.tag&&void 0!==I.memoizedProps.revealOrder){if(0!==(128&I.flags))return I}else if(null!==I.child){I.child.return=I,I=I.child;continue}if(I===g)break;for(;null===I.sibling;){if(null===I.return||I.return===g)return null;I=I.return}I.sibling.return=I.return,I=I.sibling}return null}var an=[];function An(){for(var g=0;g<an.length;g++)an[g]._workInProgressVersionPrimary=null;an.length=0}var cn=G.ReactCurrentDispatcher,sn=G.ReactCurrentBatchConfig,dn=0,rn=null,bn=null,un=null,mn=!1,Zn=!1,hn=0,Gn=0;function Bn(){throw Error(l(321))}function yn(g,I){if(null===I)return!1;for(var e=0;e<I.length&&e<g.length;e++)if(!nC(g[e],I[e]))return!1;return!0}function pn(g,I,e,C,t,n){if(dn=n,rn=I,I.memoizedState=null,I.updateQueue=null,I.lanes=0,cn.current=null===g||null===g.memoizedState?no:oo,g=e(C,t),Zn){n=0;do{if(Zn=!1,hn=0,25<=n)throw Error(l(301));n+=1,un=bn=null,I.updateQueue=null,cn.current=ao,g=e(C,t)}while(Zn)}if(cn.current=lo,I=null!==bn&&null!==bn.next,dn=0,un=bn=rn=null,mn=!1,I)throw Error(l(300));return g}function Wn(){var g=0!==hn;return hn=0,g}function Vn(){var g={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===un?rn.memoizedState=un=g:un=un.next=g,un}function Sn(){if(null===bn){var g=rn.alternate;g=null!==g?g.memoizedState:null}else g=bn.next;var I=null===un?rn.memoizedState:un.next;if(null!==I)un=I,bn=g;else{if(null===g)throw Error(l(310));g={memoizedState:(bn=g).memoizedState,baseState:bn.baseState,baseQueue:bn.baseQueue,queue:bn.queue,next:null},null===un?rn.memoizedState=un=g:un=un.next=g}return un}function Xn(g,I){return"function"===typeof I?I(g):I}function Rn(g){var I=Sn(),e=I.queue;if(null===e)throw Error(l(311));e.lastRenderedReducer=g;var C=bn,t=C.baseQueue,n=e.pending;if(null!==n){if(null!==t){var o=t.next;t.next=n.next,n.next=o}C.baseQueue=t=n,e.pending=null}if(null!==t){n=t.next,C=C.baseState;var a=o=null,i=null,A=n;do{var c=A.lane;if((dn&c)===c)null!==i&&(i=i.next={lane:0,action:A.action,hasEagerState:A.hasEagerState,eagerState:A.eagerState,next:null}),C=A.hasEagerState?A.eagerState:g(C,A.action);else{var s={lane:c,action:A.action,hasEagerState:A.hasEagerState,eagerState:A.eagerState,next:null};null===i?(a=i=s,o=C):i=i.next=s,rn.lanes|=c,Ka|=c}A=A.next}while(null!==A&&A!==n);null===i?o=C:i.next=a,nC(C,I.memoizedState)||(Go=!0),I.memoizedState=C,I.baseState=o,I.baseQueue=i,e.lastRenderedState=C}if(null!==(g=e.interleaved)){t=g;do{n=t.lane,rn.lanes|=n,Ka|=n,t=t.next}while(t!==g)}else null===t&&(e.lanes=0);return[I.memoizedState,e.dispatch]}function Jn(g){var I=Sn(),e=I.queue;if(null===e)throw Error(l(311));e.lastRenderedReducer=g;var C=e.dispatch,t=e.pending,n=I.memoizedState;if(null!==t){e.pending=null;var o=t=t.next;do{n=g(n,o.action),o=o.next}while(o!==t);nC(n,I.memoizedState)||(Go=!0),I.memoizedState=n,null===I.baseQueue&&(I.baseState=n),e.lastRenderedState=n}return[n,C]}function kn(){}function Yn(g,I){var e=rn,C=Sn(),t=I(),n=!nC(C.memoizedState,t);if(n&&(C.memoizedState=t,Go=!0),C=C.queue,Qn(Hn.bind(null,e,C,g),[g]),C.getSnapshot!==I||n||null!==un&&1&un.memoizedState.tag){if(e.flags|=2048,Fn(9,vn.bind(null,e,C,t,I),void 0,null),null===ka)throw Error(l(349));0!==(30&dn)||fn(e,I,t)}return t}function fn(g,I,e){g.flags|=16384,g={getSnapshot:I,value:e},null===(I=rn.updateQueue)?(I={lastEffect:null,stores:null},rn.updateQueue=I,I.stores=[g]):null===(e=I.stores)?I.stores=[g]:e.push(g)}function vn(g,I,e,C){I.value=e,I.getSnapshot=C,wn(I)&&Nn(g)}function Hn(g,I,e){return e((function(){wn(I)&&Nn(g)}))}function wn(g){var I=g.getSnapshot;g=g.value;try{var e=I();return!nC(g,e)}catch(C){return!0}}function Nn(g){var I=Rl(g,1);null!==I&&Ci(I,g,1,-1)}function Kn(g){var I=Vn();return"function"===typeof g&&(g=g()),I.memoizedState=I.baseState=g,g={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xn,lastRenderedState:g},I.queue=g,g=g.dispatch=Io.bind(null,rn,g),[I.memoizedState,g]}function Fn(g,I,e,C){return g={tag:g,create:I,destroy:e,deps:C,next:null},null===(I=rn.updateQueue)?(I={lastEffect:null,stores:null},rn.updateQueue=I,I.lastEffect=g.next=g):null===(e=I.lastEffect)?I.lastEffect=g.next=g:(C=e.next,e.next=g,g.next=C,I.lastEffect=g),g}function xn(){return Sn().memoizedState}function zn(g,I,e,C){var t=Vn();rn.flags|=g,t.memoizedState=Fn(1|I,e,void 0,void 0===C?null:C)}function Mn(g,I,e,C){var t=Sn();C=void 0===C?null:C;var l=void 0;if(null!==bn){var n=bn.memoizedState;if(l=n.destroy,null!==C&&yn(C,n.deps))return void(t.memoizedState=Fn(I,e,l,C))}rn.flags|=g,t.memoizedState=Fn(1|I,e,l,C)}function En(g,I){return zn(8390656,8,g,I)}function Qn(g,I){return Mn(2048,8,g,I)}function Un(g,I){return Mn(4,2,g,I)}function Ln(g,I){return Mn(4,4,g,I)}function Dn(g,I){return"function"===typeof I?(g=g(),I(g),function(){I(null)}):null!==I&&void 0!==I?(g=g(),I.current=g,function(){I.current=null}):void 0}function Tn(g,I,e){return e=null!==e&&void 0!==e?e.concat([g]):null,Mn(4,4,Dn.bind(null,I,g),e)}function jn(){}function Pn(g,I){var e=Sn();I=void 0===I?null:I;var C=e.memoizedState;return null!==C&&null!==I&&yn(I,C[1])?C[0]:(e.memoizedState=[g,I],g)}function On(g,I){var e=Sn();I=void 0===I?null:I;var C=e.memoizedState;return null!==C&&null!==I&&yn(I,C[1])?C[0]:(g=g(),e.memoizedState=[g,I],g)}function _n(g,I,e){return 0===(21&dn)?(g.baseState&&(g.baseState=!1,Go=!0),g.memoizedState=e):(nC(e,I)||(e=bI(),rn.lanes|=e,Ka|=e,g.baseState=!0),I)}function qn(g,I){var e=hI;hI=0!==e&&4>e?e:4,g(!0);var C=sn.transition;sn.transition={};try{g(!1),I()}finally{hI=e,sn.transition=C}}function $n(){return Sn().memoizedState}function go(g,I,e){var C=ei(g);if(e={lane:C,action:e,hasEagerState:!1,eagerState:null,next:null},eo(g))Co(I,e);else if(null!==(e=Xl(g,I,e,C))){Ci(e,g,C,Ii()),to(e,I,C)}}function Io(g,I,e){var C=ei(g),t={lane:C,action:e,hasEagerState:!1,eagerState:null,next:null};if(eo(g))Co(I,t);else{var l=g.alternate;if(0===g.lanes&&(null===l||0===l.lanes)&&null!==(l=I.lastRenderedReducer))try{var n=I.lastRenderedState,o=l(n,e);if(t.hasEagerState=!0,t.eagerState=o,nC(o,n)){var a=I.interleaved;return null===a?(t.next=t,Sl(I)):(t.next=a.next,a.next=t),void(I.interleaved=t)}}catch(i){}null!==(e=Xl(g,I,t,C))&&(Ci(e,g,C,t=Ii()),to(e,I,C))}}function eo(g){var I=g.alternate;return g===rn||null!==I&&I===rn}function Co(g,I){Zn=mn=!0;var e=g.pending;null===e?I.next=I:(I.next=e.next,e.next=I),g.pending=I}function to(g,I,e){if(0!==(4194240&e)){var C=I.lanes;e|=C&=g.pendingLanes,I.lanes=e,ZI(g,e)}}var lo={readContext:Wl,useCallback:Bn,useContext:Bn,useEffect:Bn,useImperativeHandle:Bn,useInsertionEffect:Bn,useLayoutEffect:Bn,useMemo:Bn,useReducer:Bn,useRef:Bn,useState:Bn,useDebugValue:Bn,useDeferredValue:Bn,useTransition:Bn,useMutableSource:Bn,useSyncExternalStore:Bn,useId:Bn,unstable_isNewReconciler:!1},no={readContext:Wl,useCallback:function(g,I){return Vn().memoizedState=[g,void 0===I?null:I],g},useContext:Wl,useEffect:En,useImperativeHandle:function(g,I,e){return e=null!==e&&void 0!==e?e.concat([g]):null,zn(4194308,4,Dn.bind(null,I,g),e)},useLayoutEffect:function(g,I){return zn(4194308,4,g,I)},useInsertionEffect:function(g,I){return zn(4,2,g,I)},useMemo:function(g,I){var e=Vn();return I=void 0===I?null:I,g=g(),e.memoizedState=[g,I],g},useReducer:function(g,I,e){var C=Vn();return I=void 0!==e?e(I):I,C.memoizedState=C.baseState=I,g={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:g,lastRenderedState:I},C.queue=g,g=g.dispatch=go.bind(null,rn,g),[C.memoizedState,g]},useRef:function(g){return g={current:g},Vn().memoizedState=g},useState:Kn,useDebugValue:jn,useDeferredValue:function(g){return Vn().memoizedState=g},useTransition:function(){var g=Kn(!1),I=g[0];return g=qn.bind(null,g[1]),Vn().memoizedState=g,[I,g]},useMutableSource:function(){},useSyncExternalStore:function(g,I,e){var C=rn,t=Vn();if(Cl){if(void 0===e)throw Error(l(407));e=e()}else{if(e=I(),null===ka)throw Error(l(349));0!==(30&dn)||fn(C,I,e)}t.memoizedState=e;var n={value:e,getSnapshot:I};return t.queue=n,En(Hn.bind(null,C,n,g),[g]),C.flags|=2048,Fn(9,vn.bind(null,C,n,e,I),void 0,null),e},useId:function(){var g=Vn(),I=ka.identifierPrefix;if(Cl){var e=Ot;I=":"+I+"R"+(e=(Pt&~(1<<32-nI(Pt)-1)).toString(32)+e),0<(e=hn++)&&(I+="H"+e.toString(32)),I+=":"}else I=":"+I+"r"+(e=Gn++).toString(32)+":";return g.memoizedState=I},unstable_isNewReconciler:!1},oo={readContext:Wl,useCallback:Pn,useContext:Wl,useEffect:Qn,useImperativeHandle:Tn,useInsertionEffect:Un,useLayoutEffect:Ln,useMemo:On,useReducer:Rn,useRef:xn,useState:function(){return Rn(Xn)},useDebugValue:jn,useDeferredValue:function(g){return _n(Sn(),bn.memoizedState,g)},useTransition:function(){return[Rn(Xn)[0],Sn().memoizedState]},useMutableSource:kn,useSyncExternalStore:Yn,useId:$n,unstable_isNewReconciler:!1},ao={readContext:Wl,useCallback:Pn,useContext:Wl,useEffect:Qn,useImperativeHandle:Tn,useInsertionEffect:Un,useLayoutEffect:Ln,useMemo:On,useReducer:Jn,useRef:xn,useState:function(){return Jn(Xn)},useDebugValue:jn,useDeferredValue:function(g){var I=Sn();return null===bn?I.memoizedState=g:_n(I,bn.memoizedState,g)},useTransition:function(){return[Jn(Xn)[0],Sn().memoizedState]},useMutableSource:kn,useSyncExternalStore:Yn,useId:$n,unstable_isNewReconciler:!1};function io(g,I){try{var e="",C=I;do{e+=M(C),C=C.return}while(C);var t=e}catch(l){t="\nError generating stack: "+l.message+"\n"+l.stack}return{value:g,source:I,stack:t,digest:null}}function Ao(g,I,e){return{value:g,source:null,stack:null!=e?e:null,digest:null!=I?I:null}}function co(g,I){try{console.error(I.value)}catch(e){setTimeout((function(){throw e}))}}var so="function"===typeof WeakMap?WeakMap:Map;function ro(g,I,e){(e=fl(-1,e)).tag=3,e.payload={element:null};var C=I.value;return e.callback=function(){La||(La=!0,Da=C),co(0,I)},e}function bo(g,I,e){(e=fl(-1,e)).tag=3;var C=g.type.getDerivedStateFromError;if("function"===typeof C){var t=I.value;e.payload=function(){return C(t)},e.callback=function(){co(0,I)}}var l=g.stateNode;return null!==l&&"function"===typeof l.componentDidCatch&&(e.callback=function(){co(0,I),"function"!==typeof C&&(null===Ta?Ta=new Set([this]):Ta.add(this));var g=I.stack;this.componentDidCatch(I.value,{componentStack:null!==g?g:""})}),e}function uo(g,I,e){var C=g.pingCache;if(null===C){C=g.pingCache=new so;var t=new Set;C.set(I,t)}else void 0===(t=C.get(I))&&(t=new Set,C.set(I,t));t.has(e)||(t.add(e),g=Si.bind(null,g,I,e),I.then(g,g))}function mo(g){do{var I;if((I=13===g.tag)&&(I=null===(I=g.memoizedState)||null!==I.dehydrated),I)return g;g=g.return}while(null!==g);return null}function Zo(g,I,e,C,t){return 0===(1&g.mode)?(g===I?g.flags|=65536:(g.flags|=128,e.flags|=131072,e.flags&=-52805,1===e.tag&&(null===e.alternate?e.tag=17:((I=fl(-1,1)).tag=2,vl(e,I,1))),e.lanes|=1),g):(g.flags|=65536,g.lanes=t,g)}var ho=G.ReactCurrentOwner,Go=!1;function Bo(g,I,e,C){I.child=null===g?Ol(I,null,e,C):Pl(I,g.child,e,C)}function yo(g,I,e,C,t){e=e.render;var l=I.ref;return pl(I,t),C=pn(g,I,e,C,l,t),e=Wn(),null===g||Go?(Cl&&e&&$t(I),I.flags|=1,Bo(g,I,C,t),I.child):(I.updateQueue=g.updateQueue,I.flags&=-2053,g.lanes&=~t,Lo(g,I,t))}function po(g,I,e,C,t){if(null===g){var l=e.type;return"function"!==typeof l||vi(l)||void 0!==l.defaultProps||null!==e.compare||void 0!==e.defaultProps?((g=wi(e.type,null,C,I,I.mode,t)).ref=I.ref,g.return=I,I.child=g):(I.tag=15,I.type=l,Wo(g,I,l,C,t))}if(l=g.child,0===(g.lanes&t)){var n=l.memoizedProps;if((e=null!==(e=e.compare)?e:oC)(n,C)&&g.ref===I.ref)return Lo(g,I,t)}return I.flags|=1,(g=Hi(l,C)).ref=I.ref,g.return=I,I.child=g}function Wo(g,I,e,C,t){if(null!==g){var l=g.memoizedProps;if(oC(l,C)&&g.ref===I.ref){if(Go=!1,I.pendingProps=C=l,0===(g.lanes&t))return I.lanes=g.lanes,Lo(g,I,t);0!==(131072&g.flags)&&(Go=!0)}}return Xo(g,I,e,C,t)}function Vo(g,I,e){var C=I.pendingProps,t=C.children,l=null!==g?g.memoizedState:null;if("hidden"===C.mode)if(0===(1&I.mode))I.memoizedState={baseLanes:0,cachePool:null,transitions:null},Vt(Ha,va),va|=e;else{if(0===(1073741824&e))return g=null!==l?l.baseLanes|e:e,I.lanes=I.childLanes=1073741824,I.memoizedState={baseLanes:g,cachePool:null,transitions:null},I.updateQueue=null,Vt(Ha,va),va|=g,null;I.memoizedState={baseLanes:0,cachePool:null,transitions:null},C=null!==l?l.baseLanes:e,Vt(Ha,va),va|=C}else null!==l?(C=l.baseLanes|e,I.memoizedState=null):C=e,Vt(Ha,va),va|=C;return Bo(g,I,t,e),I.child}function So(g,I){var e=I.ref;(null===g&&null!==e||null!==g&&g.ref!==e)&&(I.flags|=512,I.flags|=2097152)}function Xo(g,I,e,C,t){var l=Yt(e)?Jt:Xt.current;return l=kt(I,l),pl(I,t),e=pn(g,I,e,C,l,t),C=Wn(),null===g||Go?(Cl&&C&&$t(I),I.flags|=1,Bo(g,I,e,t),I.child):(I.updateQueue=g.updateQueue,I.flags&=-2053,g.lanes&=~t,Lo(g,I,t))}function Ro(g,I,e,C,t){if(Yt(e)){var l=!0;wt(I)}else l=!1;if(pl(I,t),null===I.stateNode)Uo(g,I),El(I,e,C),Ul(I,e,C,t),C=!0;else if(null===g){var n=I.stateNode,o=I.memoizedProps;n.props=o;var a=n.context,i=e.contextType;"object"===typeof i&&null!==i?i=Wl(i):i=kt(I,i=Yt(e)?Jt:Xt.current);var A=e.getDerivedStateFromProps,c="function"===typeof A||"function"===typeof n.getSnapshotBeforeUpdate;c||"function"!==typeof n.UNSAFE_componentWillReceiveProps&&"function"!==typeof n.componentWillReceiveProps||(o!==C||a!==i)&&Ql(I,n,C,i),Jl=!1;var s=I.memoizedState;n.state=s,Nl(I,C,n,t),a=I.memoizedState,o!==C||s!==a||Rt.current||Jl?("function"===typeof A&&(xl(I,e,A,C),a=I.memoizedState),(o=Jl||Ml(I,e,o,C,s,a,i))?(c||"function"!==typeof n.UNSAFE_componentWillMount&&"function"!==typeof n.componentWillMount||("function"===typeof n.componentWillMount&&n.componentWillMount(),"function"===typeof n.UNSAFE_componentWillMount&&n.UNSAFE_componentWillMount()),"function"===typeof n.componentDidMount&&(I.flags|=4194308)):("function"===typeof n.componentDidMount&&(I.flags|=4194308),I.memoizedProps=C,I.memoizedState=a),n.props=C,n.state=a,n.context=i,C=o):("function"===typeof n.componentDidMount&&(I.flags|=4194308),C=!1)}else{n=I.stateNode,Yl(g,I),o=I.memoizedProps,i=I.type===I.elementType?o:bl(I.type,o),n.props=i,c=I.pendingProps,s=n.context,"object"===typeof(a=e.contextType)&&null!==a?a=Wl(a):a=kt(I,a=Yt(e)?Jt:Xt.current);var d=e.getDerivedStateFromProps;(A="function"===typeof d||"function"===typeof n.getSnapshotBeforeUpdate)||"function"!==typeof n.UNSAFE_componentWillReceiveProps&&"function"!==typeof n.componentWillReceiveProps||(o!==c||s!==a)&&Ql(I,n,C,a),Jl=!1,s=I.memoizedState,n.state=s,Nl(I,C,n,t);var r=I.memoizedState;o!==c||s!==r||Rt.current||Jl?("function"===typeof d&&(xl(I,e,d,C),r=I.memoizedState),(i=Jl||Ml(I,e,i,C,s,r,a)||!1)?(A||"function"!==typeof n.UNSAFE_componentWillUpdate&&"function"!==typeof n.componentWillUpdate||("function"===typeof n.componentWillUpdate&&n.componentWillUpdate(C,r,a),"function"===typeof n.UNSAFE_componentWillUpdate&&n.UNSAFE_componentWillUpdate(C,r,a)),"function"===typeof n.componentDidUpdate&&(I.flags|=4),"function"===typeof n.getSnapshotBeforeUpdate&&(I.flags|=1024)):("function"!==typeof n.componentDidUpdate||o===g.memoizedProps&&s===g.memoizedState||(I.flags|=4),"function"!==typeof n.getSnapshotBeforeUpdate||o===g.memoizedProps&&s===g.memoizedState||(I.flags|=1024),I.memoizedProps=C,I.memoizedState=r),n.props=C,n.state=r,n.context=a,C=i):("function"!==typeof n.componentDidUpdate||o===g.memoizedProps&&s===g.memoizedState||(I.flags|=4),"function"!==typeof n.getSnapshotBeforeUpdate||o===g.memoizedProps&&s===g.memoizedState||(I.flags|=1024),C=!1)}return Jo(g,I,e,C,l,t)}function Jo(g,I,e,C,t,l){So(g,I);var n=0!==(128&I.flags);if(!C&&!n)return t&&Nt(I,e,!1),Lo(g,I,l);C=I.stateNode,ho.current=I;var o=n&&"function"!==typeof e.getDerivedStateFromError?null:C.render();return I.flags|=1,null!==g&&n?(I.child=Pl(I,g.child,null,l),I.child=Pl(I,null,o,l)):Bo(g,I,o,l),I.memoizedState=C.state,t&&Nt(I,e,!0),I.child}function ko(g){var I=g.stateNode;I.pendingContext?vt(0,I.pendingContext,I.pendingContext!==I.context):I.context&&vt(0,I.context,!1),en(g,I.containerInfo)}function Yo(g,I,e,C,t){return sl(),dl(t),I.flags|=256,Bo(g,I,e,C),I.child}var fo,vo,Ho,wo,No={dehydrated:null,treeContext:null,retryLane:0};function Ko(g){return{baseLanes:g,cachePool:null,transitions:null}}function Fo(g,I,e){var C,t=I.pendingProps,n=nn.current,o=!1,a=0!==(128&I.flags);if((C=a)||(C=(null===g||null!==g.memoizedState)&&0!==(2&n)),C?(o=!0,I.flags&=-129):null!==g&&null===g.memoizedState||(n|=1),Vt(nn,1&n),null===g)return al(I),null!==(g=I.memoizedState)&&null!==(g=g.dehydrated)?(0===(1&I.mode)?I.lanes=1:"$!"===g.data?I.lanes=8:I.lanes=1073741824,null):(a=t.children,g=t.fallback,o?(t=I.mode,o=I.child,a={mode:"hidden",children:a},0===(1&t)&&null!==o?(o.childLanes=0,o.pendingProps=a):o=Ki(a,t,0,null),g=Ni(g,t,e,null),o.return=I,g.return=I,o.sibling=g,I.child=o,I.child.memoizedState=Ko(e),I.memoizedState=No,g):xo(I,a));if(null!==(n=g.memoizedState)&&null!==(C=n.dehydrated))return function(g,I,e,C,t,n,o){if(e)return 256&I.flags?(I.flags&=-257,zo(g,I,o,C=Ao(Error(l(422))))):null!==I.memoizedState?(I.child=g.child,I.flags|=128,null):(n=C.fallback,t=I.mode,C=Ki({mode:"visible",children:C.children},t,0,null),(n=Ni(n,t,o,null)).flags|=2,C.return=I,n.return=I,C.sibling=n,I.child=C,0!==(1&I.mode)&&Pl(I,g.child,null,o),I.child.memoizedState=Ko(o),I.memoizedState=No,n);if(0===(1&I.mode))return zo(g,I,o,null);if("$!"===t.data){if(C=t.nextSibling&&t.nextSibling.dataset)var a=C.dgst;return C=a,zo(g,I,o,C=Ao(n=Error(l(419)),C,void 0))}if(a=0!==(o&g.childLanes),Go||a){if(null!==(C=ka)){switch(o&-o){case 4:t=2;break;case 16:t=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:t=32;break;case 536870912:t=268435456;break;default:t=0}0!==(t=0!==(t&(C.suspendedLanes|o))?0:t)&&t!==n.retryLane&&(n.retryLane=t,Rl(g,t),Ci(C,g,t,-1))}return ui(),zo(g,I,o,C=Ao(Error(l(421))))}return"$?"===t.data?(I.flags|=128,I.child=g.child,I=Ri.bind(null,g),t._reactRetry=I,null):(g=n.treeContext,el=at(t.nextSibling),Il=I,Cl=!0,tl=null,null!==g&&(Dt[Tt++]=Pt,Dt[Tt++]=Ot,Dt[Tt++]=jt,Pt=g.id,Ot=g.overflow,jt=I),I=xo(I,C.children),I.flags|=4096,I)}(g,I,a,t,C,n,e);if(o){o=t.fallback,a=I.mode,C=(n=g.child).sibling;var i={mode:"hidden",children:t.children};return 0===(1&a)&&I.child!==n?((t=I.child).childLanes=0,t.pendingProps=i,I.deletions=null):(t=Hi(n,i)).subtreeFlags=14680064&n.subtreeFlags,null!==C?o=Hi(C,o):(o=Ni(o,a,e,null)).flags|=2,o.return=I,t.return=I,t.sibling=o,I.child=t,t=o,o=I.child,a=null===(a=g.child.memoizedState)?Ko(e):{baseLanes:a.baseLanes|e,cachePool:null,transitions:a.transitions},o.memoizedState=a,o.childLanes=g.childLanes&~e,I.memoizedState=No,t}return g=(o=g.child).sibling,t=Hi(o,{mode:"visible",children:t.children}),0===(1&I.mode)&&(t.lanes=e),t.return=I,t.sibling=null,null!==g&&(null===(e=I.deletions)?(I.deletions=[g],I.flags|=16):e.push(g)),I.child=t,I.memoizedState=null,t}function xo(g,I){return(I=Ki({mode:"visible",children:I},g.mode,0,null)).return=g,g.child=I}function zo(g,I,e,C){return null!==C&&dl(C),Pl(I,g.child,null,e),(g=xo(I,I.pendingProps.children)).flags|=2,I.memoizedState=null,g}function Mo(g,I,e){g.lanes|=I;var C=g.alternate;null!==C&&(C.lanes|=I),yl(g.return,I,e)}function Eo(g,I,e,C,t){var l=g.memoizedState;null===l?g.memoizedState={isBackwards:I,rendering:null,renderingStartTime:0,last:C,tail:e,tailMode:t}:(l.isBackwards=I,l.rendering=null,l.renderingStartTime=0,l.last=C,l.tail=e,l.tailMode=t)}function Qo(g,I,e){var C=I.pendingProps,t=C.revealOrder,l=C.tail;if(Bo(g,I,C.children,e),0!==(2&(C=nn.current)))C=1&C|2,I.flags|=128;else{if(null!==g&&0!==(128&g.flags))g:for(g=I.child;null!==g;){if(13===g.tag)null!==g.memoizedState&&Mo(g,e,I);else if(19===g.tag)Mo(g,e,I);else if(null!==g.child){g.child.return=g,g=g.child;continue}if(g===I)break g;for(;null===g.sibling;){if(null===g.return||g.return===I)break g;g=g.return}g.sibling.return=g.return,g=g.sibling}C&=1}if(Vt(nn,C),0===(1&I.mode))I.memoizedState=null;else switch(t){case"forwards":for(e=I.child,t=null;null!==e;)null!==(g=e.alternate)&&null===on(g)&&(t=e),e=e.sibling;null===(e=t)?(t=I.child,I.child=null):(t=e.sibling,e.sibling=null),Eo(I,!1,t,e,l);break;case"backwards":for(e=null,t=I.child,I.child=null;null!==t;){if(null!==(g=t.alternate)&&null===on(g)){I.child=t;break}g=t.sibling,t.sibling=e,e=t,t=g}Eo(I,!0,e,null,l);break;case"together":Eo(I,!1,null,null,void 0);break;default:I.memoizedState=null}return I.child}function Uo(g,I){0===(1&I.mode)&&null!==g&&(g.alternate=null,I.alternate=null,I.flags|=2)}function Lo(g,I,e){if(null!==g&&(I.dependencies=g.dependencies),Ka|=I.lanes,0===(e&I.childLanes))return null;if(null!==g&&I.child!==g.child)throw Error(l(153));if(null!==I.child){for(e=Hi(g=I.child,g.pendingProps),I.child=e,e.return=I;null!==g.sibling;)g=g.sibling,(e=e.sibling=Hi(g,g.pendingProps)).return=I;e.sibling=null}return I.child}function Do(g,I){if(!Cl)switch(g.tailMode){case"hidden":I=g.tail;for(var e=null;null!==I;)null!==I.alternate&&(e=I),I=I.sibling;null===e?g.tail=null:e.sibling=null;break;case"collapsed":e=g.tail;for(var C=null;null!==e;)null!==e.alternate&&(C=e),e=e.sibling;null===C?I||null===g.tail?g.tail=null:g.tail.sibling=null:C.sibling=null}}function To(g){var I=null!==g.alternate&&g.alternate.child===g.child,e=0,C=0;if(I)for(var t=g.child;null!==t;)e|=t.lanes|t.childLanes,C|=14680064&t.subtreeFlags,C|=14680064&t.flags,t.return=g,t=t.sibling;else for(t=g.child;null!==t;)e|=t.lanes|t.childLanes,C|=t.subtreeFlags,C|=t.flags,t.return=g,t=t.sibling;return g.subtreeFlags|=C,g.childLanes=e,I}function jo(g,I,e){var C=I.pendingProps;switch(gl(I),I.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return To(I),null;case 1:case 17:return Yt(I.type)&&ft(),To(I),null;case 3:return C=I.stateNode,Cn(),Wt(Rt),Wt(Xt),An(),C.pendingContext&&(C.context=C.pendingContext,C.pendingContext=null),null!==g&&null!==g.child||(Al(I)?I.flags|=4:null===g||g.memoizedState.isDehydrated&&0===(256&I.flags)||(I.flags|=1024,null!==tl&&(oi(tl),tl=null))),vo(g,I),To(I),null;case 5:ln(I);var t=In(gn.current);if(e=I.type,null!==g&&null!=I.stateNode)Ho(g,I,e,C,t),g.ref!==I.ref&&(I.flags|=512,I.flags|=2097152);else{if(!C){if(null===I.stateNode)throw Error(l(166));return To(I),null}if(g=In(ql.current),Al(I)){C=I.stateNode,e=I.type;var n=I.memoizedProps;switch(C[ct]=I,C[st]=n,g=0!==(1&I.mode),e){case"dialog":FC("cancel",C),FC("close",C);break;case"iframe":case"object":case"embed":FC("load",C);break;case"video":case"audio":for(t=0;t<HC.length;t++)FC(HC[t],C);break;case"source":FC("error",C);break;case"img":case"image":case"link":FC("error",C),FC("load",C);break;case"details":FC("toggle",C);break;case"input":O(C,n),FC("invalid",C);break;case"select":C._wrapperState={wasMultiple:!!n.multiple},FC("invalid",C);break;case"textarea":tg(C,n),FC("invalid",C)}for(var a in Zg(e,n),t=null,n)if(n.hasOwnProperty(a)){var i=n[a];"children"===a?"string"===typeof i?C.textContent!==i&&(!0!==n.suppressHydrationWarning&&_C(C.textContent,i,g),t=["children",i]):"number"===typeof i&&C.textContent!==""+i&&(!0!==n.suppressHydrationWarning&&_C(C.textContent,i,g),t=["children",""+i]):o.hasOwnProperty(a)&&null!=i&&"onScroll"===a&&FC("scroll",C)}switch(e){case"input":D(C),$(C,n,!0);break;case"textarea":D(C),ng(C);break;case"select":case"option":break;default:"function"===typeof n.onClick&&(C.onclick=qC)}C=t,I.updateQueue=C,null!==C&&(I.flags|=4)}else{a=9===t.nodeType?t:t.ownerDocument,"http://www.w3.org/1999/xhtml"===g&&(g=og(e)),"http://www.w3.org/1999/xhtml"===g?"script"===e?((g=a.createElement("div")).innerHTML="<script><\/script>",g=g.removeChild(g.firstChild)):"string"===typeof C.is?g=a.createElement(e,{is:C.is}):(g=a.createElement(e),"select"===e&&(a=g,C.multiple?a.multiple=!0:C.size&&(a.size=C.size))):g=a.createElementNS(g,e),g[ct]=I,g[st]=C,fo(g,I,!1,!1),I.stateNode=g;g:{switch(a=hg(e,C),e){case"dialog":FC("cancel",g),FC("close",g),t=C;break;case"iframe":case"object":case"embed":FC("load",g),t=C;break;case"video":case"audio":for(t=0;t<HC.length;t++)FC(HC[t],g);t=C;break;case"source":FC("error",g),t=C;break;case"img":case"image":case"link":FC("error",g),FC("load",g),t=C;break;case"details":FC("toggle",g),t=C;break;case"input":O(g,C),t=P(g,C),FC("invalid",g);break;case"option":default:t=C;break;case"select":g._wrapperState={wasMultiple:!!C.multiple},t=K({},C,{value:void 0}),FC("invalid",g);break;case"textarea":tg(g,C),t=Cg(g,C),FC("invalid",g)}for(n in Zg(e,t),i=t)if(i.hasOwnProperty(n)){var A=i[n];"style"===n?ug(g,A):"dangerouslySetInnerHTML"===n?null!=(A=A?A.__html:void 0)&&cg(g,A):"children"===n?"string"===typeof A?("textarea"!==e||""!==A)&&sg(g,A):"number"===typeof A&&sg(g,""+A):"suppressContentEditableWarning"!==n&&"suppressHydrationWarning"!==n&&"autoFocus"!==n&&(o.hasOwnProperty(n)?null!=A&&"onScroll"===n&&FC("scroll",g):null!=A&&h(g,n,A,a))}switch(e){case"input":D(g),$(g,C,!1);break;case"textarea":D(g),ng(g);break;case"option":null!=C.value&&g.setAttribute("value",""+U(C.value));break;case"select":g.multiple=!!C.multiple,null!=(n=C.value)?eg(g,!!C.multiple,n,!1):null!=C.defaultValue&&eg(g,!!C.multiple,C.defaultValue,!0);break;default:"function"===typeof t.onClick&&(g.onclick=qC)}switch(e){case"button":case"input":case"select":case"textarea":C=!!C.autoFocus;break g;case"img":C=!0;break g;default:C=!1}}C&&(I.flags|=4)}null!==I.ref&&(I.flags|=512,I.flags|=2097152)}return To(I),null;case 6:if(g&&null!=I.stateNode)wo(g,I,g.memoizedProps,C);else{if("string"!==typeof C&&null===I.stateNode)throw Error(l(166));if(e=In(gn.current),In(ql.current),Al(I)){if(C=I.stateNode,e=I.memoizedProps,C[ct]=I,(n=C.nodeValue!==e)&&null!==(g=Il))switch(g.tag){case 3:_C(C.nodeValue,e,0!==(1&g.mode));break;case 5:!0!==g.memoizedProps.suppressHydrationWarning&&_C(C.nodeValue,e,0!==(1&g.mode))}n&&(I.flags|=4)}else(C=(9===e.nodeType?e:e.ownerDocument).createTextNode(C))[ct]=I,I.stateNode=C}return To(I),null;case 13:if(Wt(nn),C=I.memoizedState,null===g||null!==g.memoizedState&&null!==g.memoizedState.dehydrated){if(Cl&&null!==el&&0!==(1&I.mode)&&0===(128&I.flags))cl(),sl(),I.flags|=98560,n=!1;else if(n=Al(I),null!==C&&null!==C.dehydrated){if(null===g){if(!n)throw Error(l(318));if(!(n=null!==(n=I.memoizedState)?n.dehydrated:null))throw Error(l(317));n[ct]=I}else sl(),0===(128&I.flags)&&(I.memoizedState=null),I.flags|=4;To(I),n=!1}else null!==tl&&(oi(tl),tl=null),n=!0;if(!n)return 65536&I.flags?I:null}return 0!==(128&I.flags)?(I.lanes=e,I):((C=null!==C)!==(null!==g&&null!==g.memoizedState)&&C&&(I.child.flags|=8192,0!==(1&I.mode)&&(null===g||0!==(1&nn.current)?0===wa&&(wa=3):ui())),null!==I.updateQueue&&(I.flags|=4),To(I),null);case 4:return Cn(),vo(g,I),null===g&&MC(I.stateNode.containerInfo),To(I),null;case 10:return Bl(I.type._context),To(I),null;case 19:if(Wt(nn),null===(n=I.memoizedState))return To(I),null;if(C=0!==(128&I.flags),null===(a=n.rendering))if(C)Do(n,!1);else{if(0!==wa||null!==g&&0!==(128&g.flags))for(g=I.child;null!==g;){if(null!==(a=on(g))){for(I.flags|=128,Do(n,!1),null!==(C=a.updateQueue)&&(I.updateQueue=C,I.flags|=4),I.subtreeFlags=0,C=e,e=I.child;null!==e;)g=C,(n=e).flags&=14680066,null===(a=n.alternate)?(n.childLanes=0,n.lanes=g,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=a.childLanes,n.lanes=a.lanes,n.child=a.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=a.memoizedProps,n.memoizedState=a.memoizedState,n.updateQueue=a.updateQueue,n.type=a.type,g=a.dependencies,n.dependencies=null===g?null:{lanes:g.lanes,firstContext:g.firstContext}),e=e.sibling;return Vt(nn,1&nn.current|2),I.child}g=g.sibling}null!==n.tail&&_g()>Qa&&(I.flags|=128,C=!0,Do(n,!1),I.lanes=4194304)}else{if(!C)if(null!==(g=on(a))){if(I.flags|=128,C=!0,null!==(e=g.updateQueue)&&(I.updateQueue=e,I.flags|=4),Do(n,!0),null===n.tail&&"hidden"===n.tailMode&&!a.alternate&&!Cl)return To(I),null}else 2*_g()-n.renderingStartTime>Qa&&1073741824!==e&&(I.flags|=128,C=!0,Do(n,!1),I.lanes=4194304);n.isBackwards?(a.sibling=I.child,I.child=a):(null!==(e=n.last)?e.sibling=a:I.child=a,n.last=a)}return null!==n.tail?(I=n.tail,n.rendering=I,n.tail=I.sibling,n.renderingStartTime=_g(),I.sibling=null,e=nn.current,Vt(nn,C?1&e|2:1&e),I):(To(I),null);case 22:case 23:return si(),C=null!==I.memoizedState,null!==g&&null!==g.memoizedState!==C&&(I.flags|=8192),C&&0!==(1&I.mode)?0!==(1073741824&va)&&(To(I),6&I.subtreeFlags&&(I.flags|=8192)):To(I),null;case 24:case 25:return null}throw Error(l(156,I.tag))}function Po(g,I){switch(gl(I),I.tag){case 1:return Yt(I.type)&&ft(),65536&(g=I.flags)?(I.flags=-65537&g|128,I):null;case 3:return Cn(),Wt(Rt),Wt(Xt),An(),0!==(65536&(g=I.flags))&&0===(128&g)?(I.flags=-65537&g|128,I):null;case 5:return ln(I),null;case 13:if(Wt(nn),null!==(g=I.memoizedState)&&null!==g.dehydrated){if(null===I.alternate)throw Error(l(340));sl()}return 65536&(g=I.flags)?(I.flags=-65537&g|128,I):null;case 19:return Wt(nn),null;case 4:return Cn(),null;case 10:return Bl(I.type._context),null;case 22:case 23:return si(),null;default:return null}}fo=function(g,I){for(var e=I.child;null!==e;){if(5===e.tag||6===e.tag)g.appendChild(e.stateNode);else if(4!==e.tag&&null!==e.child){e.child.return=e,e=e.child;continue}if(e===I)break;for(;null===e.sibling;){if(null===e.return||e.return===I)return;e=e.return}e.sibling.return=e.return,e=e.sibling}},vo=function(){},Ho=function(g,I,e,C){var t=g.memoizedProps;if(t!==C){g=I.stateNode,In(ql.current);var l,n=null;switch(e){case"input":t=P(g,t),C=P(g,C),n=[];break;case"select":t=K({},t,{value:void 0}),C=K({},C,{value:void 0}),n=[];break;case"textarea":t=Cg(g,t),C=Cg(g,C),n=[];break;default:"function"!==typeof t.onClick&&"function"===typeof C.onClick&&(g.onclick=qC)}for(A in Zg(e,C),e=null,t)if(!C.hasOwnProperty(A)&&t.hasOwnProperty(A)&&null!=t[A])if("style"===A){var a=t[A];for(l in a)a.hasOwnProperty(l)&&(e||(e={}),e[l]="")}else"dangerouslySetInnerHTML"!==A&&"children"!==A&&"suppressContentEditableWarning"!==A&&"suppressHydrationWarning"!==A&&"autoFocus"!==A&&(o.hasOwnProperty(A)?n||(n=[]):(n=n||[]).push(A,null));for(A in C){var i=C[A];if(a=null!=t?t[A]:void 0,C.hasOwnProperty(A)&&i!==a&&(null!=i||null!=a))if("style"===A)if(a){for(l in a)!a.hasOwnProperty(l)||i&&i.hasOwnProperty(l)||(e||(e={}),e[l]="");for(l in i)i.hasOwnProperty(l)&&a[l]!==i[l]&&(e||(e={}),e[l]=i[l])}else e||(n||(n=[]),n.push(A,e)),e=i;else"dangerouslySetInnerHTML"===A?(i=i?i.__html:void 0,a=a?a.__html:void 0,null!=i&&a!==i&&(n=n||[]).push(A,i)):"children"===A?"string"!==typeof i&&"number"!==typeof i||(n=n||[]).push(A,""+i):"suppressContentEditableWarning"!==A&&"suppressHydrationWarning"!==A&&(o.hasOwnProperty(A)?(null!=i&&"onScroll"===A&&FC("scroll",g),n||a===i||(n=[])):(n=n||[]).push(A,i))}e&&(n=n||[]).push("style",e);var A=n;(I.updateQueue=A)&&(I.flags|=4)}},wo=function(g,I,e,C){e!==C&&(I.flags|=4)};var Oo=!1,_o=!1,qo="function"===typeof WeakSet?WeakSet:Set,$o=null;function ga(g,I){var e=g.ref;if(null!==e)if("function"===typeof e)try{e(null)}catch(C){Vi(g,I,C)}else e.current=null}function Ia(g,I,e){try{e()}catch(C){Vi(g,I,C)}}var ea=!1;function Ca(g,I,e){var C=I.updateQueue;if(null!==(C=null!==C?C.lastEffect:null)){var t=C=C.next;do{if((t.tag&g)===g){var l=t.destroy;t.destroy=void 0,void 0!==l&&Ia(I,e,l)}t=t.next}while(t!==C)}}function ta(g,I){if(null!==(I=null!==(I=I.updateQueue)?I.lastEffect:null)){var e=I=I.next;do{if((e.tag&g)===g){var C=e.create;e.destroy=C()}e=e.next}while(e!==I)}}function la(g){var I=g.ref;if(null!==I){var e=g.stateNode;g.tag,g=e,"function"===typeof I?I(g):I.current=g}}function na(g){var I=g.alternate;null!==I&&(g.alternate=null,na(I)),g.child=null,g.deletions=null,g.sibling=null,5===g.tag&&(null!==(I=g.stateNode)&&(delete I[ct],delete I[st],delete I[rt],delete I[bt],delete I[ut])),g.stateNode=null,g.return=null,g.dependencies=null,g.memoizedProps=null,g.memoizedState=null,g.pendingProps=null,g.stateNode=null,g.updateQueue=null}function oa(g){return 5===g.tag||3===g.tag||4===g.tag}function aa(g){g:for(;;){for(;null===g.sibling;){if(null===g.return||oa(g.return))return null;g=g.return}for(g.sibling.return=g.return,g=g.sibling;5!==g.tag&&6!==g.tag&&18!==g.tag;){if(2&g.flags)continue g;if(null===g.child||4===g.tag)continue g;g.child.return=g,g=g.child}if(!(2&g.flags))return g.stateNode}}function ia(g,I,e){var C=g.tag;if(5===C||6===C)g=g.stateNode,I?8===e.nodeType?e.parentNode.insertBefore(g,I):e.insertBefore(g,I):(8===e.nodeType?(I=e.parentNode).insertBefore(g,e):(I=e).appendChild(g),null!==(e=e._reactRootContainer)&&void 0!==e||null!==I.onclick||(I.onclick=qC));else if(4!==C&&null!==(g=g.child))for(ia(g,I,e),g=g.sibling;null!==g;)ia(g,I,e),g=g.sibling}function Aa(g,I,e){var C=g.tag;if(5===C||6===C)g=g.stateNode,I?e.insertBefore(g,I):e.appendChild(g);else if(4!==C&&null!==(g=g.child))for(Aa(g,I,e),g=g.sibling;null!==g;)Aa(g,I,e),g=g.sibling}var ca=null,sa=!1;function da(g,I,e){for(e=e.child;null!==e;)ra(g,I,e),e=e.sibling}function ra(g,I,e){if(lI&&"function"===typeof lI.onCommitFiberUnmount)try{lI.onCommitFiberUnmount(tI,e)}catch(o){}switch(e.tag){case 5:_o||ga(e,I);case 6:var C=ca,t=sa;ca=null,da(g,I,e),sa=t,null!==(ca=C)&&(sa?(g=ca,e=e.stateNode,8===g.nodeType?g.parentNode.removeChild(e):g.removeChild(e)):ca.removeChild(e.stateNode));break;case 18:null!==ca&&(sa?(g=ca,e=e.stateNode,8===g.nodeType?ot(g.parentNode,e):1===g.nodeType&&ot(g,e),EI(g)):ot(ca,e.stateNode));break;case 4:C=ca,t=sa,ca=e.stateNode.containerInfo,sa=!0,da(g,I,e),ca=C,sa=t;break;case 0:case 11:case 14:case 15:if(!_o&&(null!==(C=e.updateQueue)&&null!==(C=C.lastEffect))){t=C=C.next;do{var l=t,n=l.destroy;l=l.tag,void 0!==n&&(0!==(2&l)||0!==(4&l))&&Ia(e,I,n),t=t.next}while(t!==C)}da(g,I,e);break;case 1:if(!_o&&(ga(e,I),"function"===typeof(C=e.stateNode).componentWillUnmount))try{C.props=e.memoizedProps,C.state=e.memoizedState,C.componentWillUnmount()}catch(o){Vi(e,I,o)}da(g,I,e);break;case 21:da(g,I,e);break;case 22:1&e.mode?(_o=(C=_o)||null!==e.memoizedState,da(g,I,e),_o=C):da(g,I,e);break;default:da(g,I,e)}}function ba(g){var I=g.updateQueue;if(null!==I){g.updateQueue=null;var e=g.stateNode;null===e&&(e=g.stateNode=new qo),I.forEach((function(I){var C=Ji.bind(null,g,I);e.has(I)||(e.add(I),I.then(C,C))}))}}function ua(g,I){var e=I.deletions;if(null!==e)for(var C=0;C<e.length;C++){var t=e[C];try{var n=g,o=I,a=o;g:for(;null!==a;){switch(a.tag){case 5:ca=a.stateNode,sa=!1;break g;case 3:case 4:ca=a.stateNode.containerInfo,sa=!0;break g}a=a.return}if(null===ca)throw Error(l(160));ra(n,o,t),ca=null,sa=!1;var i=t.alternate;null!==i&&(i.return=null),t.return=null}catch(A){Vi(t,I,A)}}if(12854&I.subtreeFlags)for(I=I.child;null!==I;)ma(I,g),I=I.sibling}function ma(g,I){var e=g.alternate,C=g.flags;switch(g.tag){case 0:case 11:case 14:case 15:if(ua(I,g),Za(g),4&C){try{Ca(3,g,g.return),ta(3,g)}catch(u){Vi(g,g.return,u)}try{Ca(5,g,g.return)}catch(u){Vi(g,g.return,u)}}break;case 1:ua(I,g),Za(g),512&C&&null!==e&&ga(e,e.return);break;case 5:if(ua(I,g),Za(g),512&C&&null!==e&&ga(e,e.return),32&g.flags){var t=g.stateNode;try{sg(t,"")}catch(u){Vi(g,g.return,u)}}if(4&C&&null!=(t=g.stateNode)){var n=g.memoizedProps,o=null!==e?e.memoizedProps:n,a=g.type,i=g.updateQueue;if(g.updateQueue=null,null!==i)try{"input"===a&&"radio"===n.type&&null!=n.name&&_(t,n),hg(a,o);var A=hg(a,n);for(o=0;o<i.length;o+=2){var c=i[o],s=i[o+1];"style"===c?ug(t,s):"dangerouslySetInnerHTML"===c?cg(t,s):"children"===c?sg(t,s):h(t,c,s,A)}switch(a){case"input":q(t,n);break;case"textarea":lg(t,n);break;case"select":var d=t._wrapperState.wasMultiple;t._wrapperState.wasMultiple=!!n.multiple;var r=n.value;null!=r?eg(t,!!n.multiple,r,!1):d!==!!n.multiple&&(null!=n.defaultValue?eg(t,!!n.multiple,n.defaultValue,!0):eg(t,!!n.multiple,n.multiple?[]:"",!1))}t[st]=n}catch(u){Vi(g,g.return,u)}}break;case 6:if(ua(I,g),Za(g),4&C){if(null===g.stateNode)throw Error(l(162));t=g.stateNode,n=g.memoizedProps;try{t.nodeValue=n}catch(u){Vi(g,g.return,u)}}break;case 3:if(ua(I,g),Za(g),4&C&&null!==e&&e.memoizedState.isDehydrated)try{EI(I.containerInfo)}catch(u){Vi(g,g.return,u)}break;case 4:default:ua(I,g),Za(g);break;case 13:ua(I,g),Za(g),8192&(t=g.child).flags&&(n=null!==t.memoizedState,t.stateNode.isHidden=n,!n||null!==t.alternate&&null!==t.alternate.memoizedState||(Ea=_g())),4&C&&ba(g);break;case 22:if(c=null!==e&&null!==e.memoizedState,1&g.mode?(_o=(A=_o)||c,ua(I,g),_o=A):ua(I,g),Za(g),8192&C){if(A=null!==g.memoizedState,(g.stateNode.isHidden=A)&&!c&&0!==(1&g.mode))for($o=g,c=g.child;null!==c;){for(s=$o=c;null!==$o;){switch(r=(d=$o).child,d.tag){case 0:case 11:case 14:case 15:Ca(4,d,d.return);break;case 1:ga(d,d.return);var b=d.stateNode;if("function"===typeof b.componentWillUnmount){C=d,e=d.return;try{I=C,b.props=I.memoizedProps,b.state=I.memoizedState,b.componentWillUnmount()}catch(u){Vi(C,e,u)}}break;case 5:ga(d,d.return);break;case 22:if(null!==d.memoizedState){ya(s);continue}}null!==r?(r.return=d,$o=r):ya(s)}c=c.sibling}g:for(c=null,s=g;;){if(5===s.tag){if(null===c){c=s;try{t=s.stateNode,A?"function"===typeof(n=t.style).setProperty?n.setProperty("display","none","important"):n.display="none":(a=s.stateNode,o=void 0!==(i=s.memoizedProps.style)&&null!==i&&i.hasOwnProperty("display")?i.display:null,a.style.display=bg("display",o))}catch(u){Vi(g,g.return,u)}}}else if(6===s.tag){if(null===c)try{s.stateNode.nodeValue=A?"":s.memoizedProps}catch(u){Vi(g,g.return,u)}}else if((22!==s.tag&&23!==s.tag||null===s.memoizedState||s===g)&&null!==s.child){s.child.return=s,s=s.child;continue}if(s===g)break g;for(;null===s.sibling;){if(null===s.return||s.return===g)break g;c===s&&(c=null),s=s.return}c===s&&(c=null),s.sibling.return=s.return,s=s.sibling}}break;case 19:ua(I,g),Za(g),4&C&&ba(g);case 21:}}function Za(g){var I=g.flags;if(2&I){try{g:{for(var e=g.return;null!==e;){if(oa(e)){var C=e;break g}e=e.return}throw Error(l(160))}switch(C.tag){case 5:var t=C.stateNode;32&C.flags&&(sg(t,""),C.flags&=-33),Aa(g,aa(g),t);break;case 3:case 4:var n=C.stateNode.containerInfo;ia(g,aa(g),n);break;default:throw Error(l(161))}}catch(o){Vi(g,g.return,o)}g.flags&=-3}4096&I&&(g.flags&=-4097)}function ha(g,I,e){$o=g,Ga(g,I,e)}function Ga(g,I,e){for(var C=0!==(1&g.mode);null!==$o;){var t=$o,l=t.child;if(22===t.tag&&C){var n=null!==t.memoizedState||Oo;if(!n){var o=t.alternate,a=null!==o&&null!==o.memoizedState||_o;o=Oo;var i=_o;if(Oo=n,(_o=a)&&!i)for($o=t;null!==$o;)a=(n=$o).child,22===n.tag&&null!==n.memoizedState?pa(t):null!==a?(a.return=n,$o=a):pa(t);for(;null!==l;)$o=l,Ga(l,I,e),l=l.sibling;$o=t,Oo=o,_o=i}Ba(g)}else 0!==(8772&t.subtreeFlags)&&null!==l?(l.return=t,$o=l):Ba(g)}}function Ba(g){for(;null!==$o;){var I=$o;if(0!==(8772&I.flags)){var e=I.alternate;try{if(0!==(8772&I.flags))switch(I.tag){case 0:case 11:case 15:_o||ta(5,I);break;case 1:var C=I.stateNode;if(4&I.flags&&!_o)if(null===e)C.componentDidMount();else{var t=I.elementType===I.type?e.memoizedProps:bl(I.type,e.memoizedProps);C.componentDidUpdate(t,e.memoizedState,C.__reactInternalSnapshotBeforeUpdate)}var n=I.updateQueue;null!==n&&Kl(I,n,C);break;case 3:var o=I.updateQueue;if(null!==o){if(e=null,null!==I.child)switch(I.child.tag){case 5:case 1:e=I.child.stateNode}Kl(I,o,e)}break;case 5:var a=I.stateNode;if(null===e&&4&I.flags){e=a;var i=I.memoizedProps;switch(I.type){case"button":case"input":case"select":case"textarea":i.autoFocus&&e.focus();break;case"img":i.src&&(e.src=i.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===I.memoizedState){var A=I.alternate;if(null!==A){var c=A.memoizedState;if(null!==c){var s=c.dehydrated;null!==s&&EI(s)}}}break;default:throw Error(l(163))}_o||512&I.flags&&la(I)}catch(d){Vi(I,I.return,d)}}if(I===g){$o=null;break}if(null!==(e=I.sibling)){e.return=I.return,$o=e;break}$o=I.return}}function ya(g){for(;null!==$o;){var I=$o;if(I===g){$o=null;break}var e=I.sibling;if(null!==e){e.return=I.return,$o=e;break}$o=I.return}}function pa(g){for(;null!==$o;){var I=$o;try{switch(I.tag){case 0:case 11:case 15:var e=I.return;try{ta(4,I)}catch(a){Vi(I,e,a)}break;case 1:var C=I.stateNode;if("function"===typeof C.componentDidMount){var t=I.return;try{C.componentDidMount()}catch(a){Vi(I,t,a)}}var l=I.return;try{la(I)}catch(a){Vi(I,l,a)}break;case 5:var n=I.return;try{la(I)}catch(a){Vi(I,n,a)}}}catch(a){Vi(I,I.return,a)}if(I===g){$o=null;break}var o=I.sibling;if(null!==o){o.return=I.return,$o=o;break}$o=I.return}}var Wa,Va=Math.ceil,Sa=G.ReactCurrentDispatcher,Xa=G.ReactCurrentOwner,Ra=G.ReactCurrentBatchConfig,Ja=0,ka=null,Ya=null,fa=0,va=0,Ha=pt(0),wa=0,Na=null,Ka=0,Fa=0,xa=0,za=null,Ma=null,Ea=0,Qa=1/0,Ua=null,La=!1,Da=null,Ta=null,ja=!1,Pa=null,Oa=0,_a=0,qa=null,$a=-1,gi=0;function Ii(){return 0!==(6&Ja)?_g():-1!==$a?$a:$a=_g()}function ei(g){return 0===(1&g.mode)?1:0!==(2&Ja)&&0!==fa?fa&-fa:null!==rl.transition?(0===gi&&(gi=bI()),gi):0!==(g=hI)?g:g=void 0===(g=window.event)?16:OI(g.type)}function Ci(g,I,e,C){if(50<_a)throw _a=0,qa=null,Error(l(185));mI(g,e,C),0!==(2&Ja)&&g===ka||(g===ka&&(0===(2&Ja)&&(Fa|=e),4===wa&&ai(g,fa)),ti(g,C),1===e&&0===Ja&&0===(1&I.mode)&&(Qa=_g()+500,Ft&&Mt()))}function ti(g,I){var e=g.callbackNode;!function(g,I){for(var e=g.suspendedLanes,C=g.pingedLanes,t=g.expirationTimes,l=g.pendingLanes;0<l;){var n=31-nI(l),o=1<<n,a=t[n];-1===a?0!==(o&e)&&0===(o&C)||(t[n]=dI(o,I)):a<=I&&(g.expiredLanes|=o),l&=~o}}(g,I);var C=sI(g,g===ka?fa:0);if(0===C)null!==e&&jg(e),g.callbackNode=null,g.callbackPriority=0;else if(I=C&-C,g.callbackPriority!==I){if(null!=e&&jg(e),1===I)0===g.tag?function(g){Ft=!0,zt(g)}(ii.bind(null,g)):zt(ii.bind(null,g)),lt((function(){0===(6&Ja)&&Mt()})),e=null;else{switch(GI(C)){case 1:e=$g;break;case 4:e=gI;break;case 16:default:e=II;break;case 536870912:e=CI}e=ki(e,li.bind(null,g))}g.callbackPriority=I,g.callbackNode=e}}function li(g,I){if($a=-1,gi=0,0!==(6&Ja))throw Error(l(327));var e=g.callbackNode;if(pi()&&g.callbackNode!==e)return null;var C=sI(g,g===ka?fa:0);if(0===C)return null;if(0!==(30&C)||0!==(C&g.expiredLanes)||I)I=mi(g,C);else{I=C;var t=Ja;Ja|=2;var n=bi();for(ka===g&&fa===I||(Ua=null,Qa=_g()+500,di(g,I));;)try{hi();break}catch(a){ri(g,a)}Gl(),Sa.current=n,Ja=t,null!==Ya?I=0:(ka=null,fa=0,I=wa)}if(0!==I){if(2===I&&(0!==(t=rI(g))&&(C=t,I=ni(g,t))),1===I)throw e=Na,di(g,0),ai(g,C),ti(g,_g()),e;if(6===I)ai(g,C);else{if(t=g.current.alternate,0===(30&C)&&!function(g){for(var I=g;;){if(16384&I.flags){var e=I.updateQueue;if(null!==e&&null!==(e=e.stores))for(var C=0;C<e.length;C++){var t=e[C],l=t.getSnapshot;t=t.value;try{if(!nC(l(),t))return!1}catch(o){return!1}}}if(e=I.child,16384&I.subtreeFlags&&null!==e)e.return=I,I=e;else{if(I===g)break;for(;null===I.sibling;){if(null===I.return||I.return===g)return!0;I=I.return}I.sibling.return=I.return,I=I.sibling}}return!0}(t)&&(2===(I=mi(g,C))&&(0!==(n=rI(g))&&(C=n,I=ni(g,n))),1===I))throw e=Na,di(g,0),ai(g,C),ti(g,_g()),e;switch(g.finishedWork=t,g.finishedLanes=C,I){case 0:case 1:throw Error(l(345));case 2:case 5:yi(g,Ma,Ua);break;case 3:if(ai(g,C),(130023424&C)===C&&10<(I=Ea+500-_g())){if(0!==sI(g,0))break;if(((t=g.suspendedLanes)&C)!==C){Ii(),g.pingedLanes|=g.suspendedLanes&t;break}g.timeoutHandle=et(yi.bind(null,g,Ma,Ua),I);break}yi(g,Ma,Ua);break;case 4:if(ai(g,C),(4194240&C)===C)break;for(I=g.eventTimes,t=-1;0<C;){var o=31-nI(C);n=1<<o,(o=I[o])>t&&(t=o),C&=~n}if(C=t,10<(C=(120>(C=_g()-C)?120:480>C?480:1080>C?1080:1920>C?1920:3e3>C?3e3:4320>C?4320:1960*Va(C/1960))-C)){g.timeoutHandle=et(yi.bind(null,g,Ma,Ua),C);break}yi(g,Ma,Ua);break;default:throw Error(l(329))}}}return ti(g,_g()),g.callbackNode===e?li.bind(null,g):null}function ni(g,I){var e=za;return g.current.memoizedState.isDehydrated&&(di(g,I).flags|=256),2!==(g=mi(g,I))&&(I=Ma,Ma=e,null!==I&&oi(I)),g}function oi(g){null===Ma?Ma=g:Ma.push.apply(Ma,g)}function ai(g,I){for(I&=~xa,I&=~Fa,g.suspendedLanes|=I,g.pingedLanes&=~I,g=g.expirationTimes;0<I;){var e=31-nI(I),C=1<<e;g[e]=-1,I&=~C}}function ii(g){if(0!==(6&Ja))throw Error(l(327));pi();var I=sI(g,0);if(0===(1&I))return ti(g,_g()),null;var e=mi(g,I);if(0!==g.tag&&2===e){var C=rI(g);0!==C&&(I=C,e=ni(g,C))}if(1===e)throw e=Na,di(g,0),ai(g,I),ti(g,_g()),e;if(6===e)throw Error(l(345));return g.finishedWork=g.current.alternate,g.finishedLanes=I,yi(g,Ma,Ua),ti(g,_g()),null}function Ai(g,I){var e=Ja;Ja|=1;try{return g(I)}finally{0===(Ja=e)&&(Qa=_g()+500,Ft&&Mt())}}function ci(g){null!==Pa&&0===Pa.tag&&0===(6&Ja)&&pi();var I=Ja;Ja|=1;var e=Ra.transition,C=hI;try{if(Ra.transition=null,hI=1,g)return g()}finally{hI=C,Ra.transition=e,0===(6&(Ja=I))&&Mt()}}function si(){va=Ha.current,Wt(Ha)}function di(g,I){g.finishedWork=null,g.finishedLanes=0;var e=g.timeoutHandle;if(-1!==e&&(g.timeoutHandle=-1,Ct(e)),null!==Ya)for(e=Ya.return;null!==e;){var C=e;switch(gl(C),C.tag){case 1:null!==(C=C.type.childContextTypes)&&void 0!==C&&ft();break;case 3:Cn(),Wt(Rt),Wt(Xt),An();break;case 5:ln(C);break;case 4:Cn();break;case 13:case 19:Wt(nn);break;case 10:Bl(C.type._context);break;case 22:case 23:si()}e=e.return}if(ka=g,Ya=g=Hi(g.current,null),fa=va=I,wa=0,Na=null,xa=Fa=Ka=0,Ma=za=null,null!==Vl){for(I=0;I<Vl.length;I++)if(null!==(C=(e=Vl[I]).interleaved)){e.interleaved=null;var t=C.next,l=e.pending;if(null!==l){var n=l.next;l.next=t,C.next=n}e.pending=C}Vl=null}return g}function ri(g,I){for(;;){var e=Ya;try{if(Gl(),cn.current=lo,mn){for(var C=rn.memoizedState;null!==C;){var t=C.queue;null!==t&&(t.pending=null),C=C.next}mn=!1}if(dn=0,un=bn=rn=null,Zn=!1,hn=0,Xa.current=null,null===e||null===e.return){wa=1,Na=I,Ya=null;break}g:{var n=g,o=e.return,a=e,i=I;if(I=fa,a.flags|=32768,null!==i&&"object"===typeof i&&"function"===typeof i.then){var A=i,c=a,s=c.tag;if(0===(1&c.mode)&&(0===s||11===s||15===s)){var d=c.alternate;d?(c.updateQueue=d.updateQueue,c.memoizedState=d.memoizedState,c.lanes=d.lanes):(c.updateQueue=null,c.memoizedState=null)}var r=mo(o);if(null!==r){r.flags&=-257,Zo(r,o,a,0,I),1&r.mode&&uo(n,A,I),i=A;var b=(I=r).updateQueue;if(null===b){var u=new Set;u.add(i),I.updateQueue=u}else b.add(i);break g}if(0===(1&I)){uo(n,A,I),ui();break g}i=Error(l(426))}else if(Cl&&1&a.mode){var m=mo(o);if(null!==m){0===(65536&m.flags)&&(m.flags|=256),Zo(m,o,a,0,I),dl(io(i,a));break g}}n=i=io(i,a),4!==wa&&(wa=2),null===za?za=[n]:za.push(n),n=o;do{switch(n.tag){case 3:n.flags|=65536,I&=-I,n.lanes|=I,wl(n,ro(0,i,I));break g;case 1:a=i;var Z=n.type,h=n.stateNode;if(0===(128&n.flags)&&("function"===typeof Z.getDerivedStateFromError||null!==h&&"function"===typeof h.componentDidCatch&&(null===Ta||!Ta.has(h)))){n.flags|=65536,I&=-I,n.lanes|=I,wl(n,bo(n,a,I));break g}}n=n.return}while(null!==n)}Bi(e)}catch(G){I=G,Ya===e&&null!==e&&(Ya=e=e.return);continue}break}}function bi(){var g=Sa.current;return Sa.current=lo,null===g?lo:g}function ui(){0!==wa&&3!==wa&&2!==wa||(wa=4),null===ka||0===(268435455&Ka)&&0===(268435455&Fa)||ai(ka,fa)}function mi(g,I){var e=Ja;Ja|=2;var C=bi();for(ka===g&&fa===I||(Ua=null,di(g,I));;)try{Zi();break}catch(t){ri(g,t)}if(Gl(),Ja=e,Sa.current=C,null!==Ya)throw Error(l(261));return ka=null,fa=0,wa}function Zi(){for(;null!==Ya;)Gi(Ya)}function hi(){for(;null!==Ya&&!Pg();)Gi(Ya)}function Gi(g){var I=Wa(g.alternate,g,va);g.memoizedProps=g.pendingProps,null===I?Bi(g):Ya=I,Xa.current=null}function Bi(g){var I=g;do{var e=I.alternate;if(g=I.return,0===(32768&I.flags)){if(null!==(e=jo(e,I,va)))return void(Ya=e)}else{if(null!==(e=Po(e,I)))return e.flags&=32767,void(Ya=e);if(null===g)return wa=6,void(Ya=null);g.flags|=32768,g.subtreeFlags=0,g.deletions=null}if(null!==(I=I.sibling))return void(Ya=I);Ya=I=g}while(null!==I);0===wa&&(wa=5)}function yi(g,I,e){var C=hI,t=Ra.transition;try{Ra.transition=null,hI=1,function(g,I,e,C){do{pi()}while(null!==Pa);if(0!==(6&Ja))throw Error(l(327));e=g.finishedWork;var t=g.finishedLanes;if(null===e)return null;if(g.finishedWork=null,g.finishedLanes=0,e===g.current)throw Error(l(177));g.callbackNode=null,g.callbackPriority=0;var n=e.lanes|e.childLanes;if(function(g,I){var e=g.pendingLanes&~I;g.pendingLanes=I,g.suspendedLanes=0,g.pingedLanes=0,g.expiredLanes&=I,g.mutableReadLanes&=I,g.entangledLanes&=I,I=g.entanglements;var C=g.eventTimes;for(g=g.expirationTimes;0<e;){var t=31-nI(e),l=1<<t;I[t]=0,C[t]=-1,g[t]=-1,e&=~l}}(g,n),g===ka&&(Ya=ka=null,fa=0),0===(2064&e.subtreeFlags)&&0===(2064&e.flags)||ja||(ja=!0,ki(II,(function(){return pi(),null}))),n=0!==(15990&e.flags),0!==(15990&e.subtreeFlags)||n){n=Ra.transition,Ra.transition=null;var o=hI;hI=1;var a=Ja;Ja|=4,Xa.current=null,function(g,I){if($C=UI,sC(g=cC())){if("selectionStart"in g)var e={start:g.selectionStart,end:g.selectionEnd};else g:{var C=(e=(e=g.ownerDocument)&&e.defaultView||window).getSelection&&e.getSelection();if(C&&0!==C.rangeCount){e=C.anchorNode;var t=C.anchorOffset,n=C.focusNode;C=C.focusOffset;try{e.nodeType,n.nodeType}catch(B){e=null;break g}var o=0,a=-1,i=-1,A=0,c=0,s=g,d=null;I:for(;;){for(var r;s!==e||0!==t&&3!==s.nodeType||(a=o+t),s!==n||0!==C&&3!==s.nodeType||(i=o+C),3===s.nodeType&&(o+=s.nodeValue.length),null!==(r=s.firstChild);)d=s,s=r;for(;;){if(s===g)break I;if(d===e&&++A===t&&(a=o),d===n&&++c===C&&(i=o),null!==(r=s.nextSibling))break;d=(s=d).parentNode}s=r}e=-1===a||-1===i?null:{start:a,end:i}}else e=null}e=e||{start:0,end:0}}else e=null;for(gt={focusedElem:g,selectionRange:e},UI=!1,$o=I;null!==$o;)if(g=(I=$o).child,0!==(1028&I.subtreeFlags)&&null!==g)g.return=I,$o=g;else for(;null!==$o;){I=$o;try{var b=I.alternate;if(0!==(1024&I.flags))switch(I.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==b){var u=b.memoizedProps,m=b.memoizedState,Z=I.stateNode,h=Z.getSnapshotBeforeUpdate(I.elementType===I.type?u:bl(I.type,u),m);Z.__reactInternalSnapshotBeforeUpdate=h}break;case 3:var G=I.stateNode.containerInfo;1===G.nodeType?G.textContent="":9===G.nodeType&&G.documentElement&&G.removeChild(G.documentElement);break;default:throw Error(l(163))}}catch(B){Vi(I,I.return,B)}if(null!==(g=I.sibling)){g.return=I.return,$o=g;break}$o=I.return}b=ea,ea=!1}(g,e),ma(e,g),dC(gt),UI=!!$C,gt=$C=null,g.current=e,ha(e,g,t),Og(),Ja=a,hI=o,Ra.transition=n}else g.current=e;if(ja&&(ja=!1,Pa=g,Oa=t),n=g.pendingLanes,0===n&&(Ta=null),function(g){if(lI&&"function"===typeof lI.onCommitFiberRoot)try{lI.onCommitFiberRoot(tI,g,void 0,128===(128&g.current.flags))}catch(I){}}(e.stateNode),ti(g,_g()),null!==I)for(C=g.onRecoverableError,e=0;e<I.length;e++)t=I[e],C(t.value,{componentStack:t.stack,digest:t.digest});if(La)throw La=!1,g=Da,Da=null,g;0!==(1&Oa)&&0!==g.tag&&pi(),n=g.pendingLanes,0!==(1&n)?g===qa?_a++:(_a=0,qa=g):_a=0,Mt()}(g,I,e,C)}finally{Ra.transition=t,hI=C}return null}function pi(){if(null!==Pa){var g=GI(Oa),I=Ra.transition,e=hI;try{if(Ra.transition=null,hI=16>g?16:g,null===Pa)var C=!1;else{if(g=Pa,Pa=null,Oa=0,0!==(6&Ja))throw Error(l(331));var t=Ja;for(Ja|=4,$o=g.current;null!==$o;){var n=$o,o=n.child;if(0!==(16&$o.flags)){var a=n.deletions;if(null!==a){for(var i=0;i<a.length;i++){var A=a[i];for($o=A;null!==$o;){var c=$o;switch(c.tag){case 0:case 11:case 15:Ca(8,c,n)}var s=c.child;if(null!==s)s.return=c,$o=s;else for(;null!==$o;){var d=(c=$o).sibling,r=c.return;if(na(c),c===A){$o=null;break}if(null!==d){d.return=r,$o=d;break}$o=r}}}var b=n.alternate;if(null!==b){var u=b.child;if(null!==u){b.child=null;do{var m=u.sibling;u.sibling=null,u=m}while(null!==u)}}$o=n}}if(0!==(2064&n.subtreeFlags)&&null!==o)o.return=n,$o=o;else g:for(;null!==$o;){if(0!==(2048&(n=$o).flags))switch(n.tag){case 0:case 11:case 15:Ca(9,n,n.return)}var Z=n.sibling;if(null!==Z){Z.return=n.return,$o=Z;break g}$o=n.return}}var h=g.current;for($o=h;null!==$o;){var G=(o=$o).child;if(0!==(2064&o.subtreeFlags)&&null!==G)G.return=o,$o=G;else g:for(o=h;null!==$o;){if(0!==(2048&(a=$o).flags))try{switch(a.tag){case 0:case 11:case 15:ta(9,a)}}catch(y){Vi(a,a.return,y)}if(a===o){$o=null;break g}var B=a.sibling;if(null!==B){B.return=a.return,$o=B;break g}$o=a.return}}if(Ja=t,Mt(),lI&&"function"===typeof lI.onPostCommitFiberRoot)try{lI.onPostCommitFiberRoot(tI,g)}catch(y){}C=!0}return C}finally{hI=e,Ra.transition=I}}return!1}function Wi(g,I,e){g=vl(g,I=ro(0,I=io(e,I),1),1),I=Ii(),null!==g&&(mI(g,1,I),ti(g,I))}function Vi(g,I,e){if(3===g.tag)Wi(g,g,e);else for(;null!==I;){if(3===I.tag){Wi(I,g,e);break}if(1===I.tag){var C=I.stateNode;if("function"===typeof I.type.getDerivedStateFromError||"function"===typeof C.componentDidCatch&&(null===Ta||!Ta.has(C))){I=vl(I,g=bo(I,g=io(e,g),1),1),g=Ii(),null!==I&&(mI(I,1,g),ti(I,g));break}}I=I.return}}function Si(g,I,e){var C=g.pingCache;null!==C&&C.delete(I),I=Ii(),g.pingedLanes|=g.suspendedLanes&e,ka===g&&(fa&e)===e&&(4===wa||3===wa&&(130023424&fa)===fa&&500>_g()-Ea?di(g,0):xa|=e),ti(g,I)}function Xi(g,I){0===I&&(0===(1&g.mode)?I=1:(I=AI,0===(130023424&(AI<<=1))&&(AI=4194304)));var e=Ii();null!==(g=Rl(g,I))&&(mI(g,I,e),ti(g,e))}function Ri(g){var I=g.memoizedState,e=0;null!==I&&(e=I.retryLane),Xi(g,e)}function Ji(g,I){var e=0;switch(g.tag){case 13:var C=g.stateNode,t=g.memoizedState;null!==t&&(e=t.retryLane);break;case 19:C=g.stateNode;break;default:throw Error(l(314))}null!==C&&C.delete(I),Xi(g,e)}function ki(g,I){return Tg(g,I)}function Yi(g,I,e,C){this.tag=g,this.key=e,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=I,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=C,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function fi(g,I,e,C){return new Yi(g,I,e,C)}function vi(g){return!(!(g=g.prototype)||!g.isReactComponent)}function Hi(g,I){var e=g.alternate;return null===e?((e=fi(g.tag,I,g.key,g.mode)).elementType=g.elementType,e.type=g.type,e.stateNode=g.stateNode,e.alternate=g,g.alternate=e):(e.pendingProps=I,e.type=g.type,e.flags=0,e.subtreeFlags=0,e.deletions=null),e.flags=14680064&g.flags,e.childLanes=g.childLanes,e.lanes=g.lanes,e.child=g.child,e.memoizedProps=g.memoizedProps,e.memoizedState=g.memoizedState,e.updateQueue=g.updateQueue,I=g.dependencies,e.dependencies=null===I?null:{lanes:I.lanes,firstContext:I.firstContext},e.sibling=g.sibling,e.index=g.index,e.ref=g.ref,e}function wi(g,I,e,C,t,n){var o=2;if(C=g,"function"===typeof g)vi(g)&&(o=1);else if("string"===typeof g)o=5;else g:switch(g){case p:return Ni(e.children,t,n,I);case W:o=8,t|=8;break;case V:return(g=fi(12,e,I,2|t)).elementType=V,g.lanes=n,g;case J:return(g=fi(13,e,I,t)).elementType=J,g.lanes=n,g;case k:return(g=fi(19,e,I,t)).elementType=k,g.lanes=n,g;case v:return Ki(e,t,n,I);default:if("object"===typeof g&&null!==g)switch(g.$$typeof){case S:o=10;break g;case X:o=9;break g;case R:o=11;break g;case Y:o=14;break g;case f:o=16,C=null;break g}throw Error(l(130,null==g?g:typeof g,""))}return(I=fi(o,e,I,t)).elementType=g,I.type=C,I.lanes=n,I}function Ni(g,I,e,C){return(g=fi(7,g,C,I)).lanes=e,g}function Ki(g,I,e,C){return(g=fi(22,g,C,I)).elementType=v,g.lanes=e,g.stateNode={isHidden:!1},g}function Fi(g,I,e){return(g=fi(6,g,null,I)).lanes=e,g}function xi(g,I,e){return(I=fi(4,null!==g.children?g.children:[],g.key,I)).lanes=e,I.stateNode={containerInfo:g.containerInfo,pendingChildren:null,implementation:g.implementation},I}function zi(g,I,e,C,t){this.tag=I,this.containerInfo=g,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=uI(0),this.expirationTimes=uI(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=uI(0),this.identifierPrefix=C,this.onRecoverableError=t,this.mutableSourceEagerHydrationData=null}function Mi(g,I,e,C,t,l,n,o,a){return g=new zi(g,I,e,o,a),1===I?(I=1,!0===l&&(I|=8)):I=0,l=fi(3,null,null,I),g.current=l,l.stateNode=g,l.memoizedState={element:C,isDehydrated:e,cache:null,transitions:null,pendingSuspenseBoundaries:null},kl(l),g}function Ei(g){if(!g)return St;g:{if(Eg(g=g._reactInternals)!==g||1!==g.tag)throw Error(l(170));var I=g;do{switch(I.tag){case 3:I=I.stateNode.context;break g;case 1:if(Yt(I.type)){I=I.stateNode.__reactInternalMemoizedMergedChildContext;break g}}I=I.return}while(null!==I);throw Error(l(171))}if(1===g.tag){var e=g.type;if(Yt(e))return Ht(g,e,I)}return I}function Qi(g,I,e,C,t,l,n,o,a){return(g=Mi(e,C,!0,g,0,l,0,o,a)).context=Ei(null),e=g.current,(l=fl(C=Ii(),t=ei(e))).callback=void 0!==I&&null!==I?I:null,vl(e,l,t),g.current.lanes=t,mI(g,t,C),ti(g,C),g}function Ui(g,I,e,C){var t=I.current,l=Ii(),n=ei(t);return e=Ei(e),null===I.context?I.context=e:I.pendingContext=e,(I=fl(l,n)).payload={element:g},null!==(C=void 0===C?null:C)&&(I.callback=C),null!==(g=vl(t,I,n))&&(Ci(g,t,n,l),Hl(g,t,n)),n}function Li(g){return(g=g.current).child?(g.child.tag,g.child.stateNode):null}function Di(g,I){if(null!==(g=g.memoizedState)&&null!==g.dehydrated){var e=g.retryLane;g.retryLane=0!==e&&e<I?e:I}}function Ti(g,I){Di(g,I),(g=g.alternate)&&Di(g,I)}Wa=function(g,I,e){if(null!==g)if(g.memoizedProps!==I.pendingProps||Rt.current)Go=!0;else{if(0===(g.lanes&e)&&0===(128&I.flags))return Go=!1,function(g,I,e){switch(I.tag){case 3:ko(I),sl();break;case 5:tn(I);break;case 1:Yt(I.type)&&wt(I);break;case 4:en(I,I.stateNode.containerInfo);break;case 10:var C=I.type._context,t=I.memoizedProps.value;Vt(ul,C._currentValue),C._currentValue=t;break;case 13:if(null!==(C=I.memoizedState))return null!==C.dehydrated?(Vt(nn,1&nn.current),I.flags|=128,null):0!==(e&I.child.childLanes)?Fo(g,I,e):(Vt(nn,1&nn.current),null!==(g=Lo(g,I,e))?g.sibling:null);Vt(nn,1&nn.current);break;case 19:if(C=0!==(e&I.childLanes),0!==(128&g.flags)){if(C)return Qo(g,I,e);I.flags|=128}if(null!==(t=I.memoizedState)&&(t.rendering=null,t.tail=null,t.lastEffect=null),Vt(nn,nn.current),C)break;return null;case 22:case 23:return I.lanes=0,Vo(g,I,e)}return Lo(g,I,e)}(g,I,e);Go=0!==(131072&g.flags)}else Go=!1,Cl&&0!==(1048576&I.flags)&&qt(I,Lt,I.index);switch(I.lanes=0,I.tag){case 2:var C=I.type;Uo(g,I),g=I.pendingProps;var t=kt(I,Xt.current);pl(I,e),t=pn(null,I,C,g,t,e);var n=Wn();return I.flags|=1,"object"===typeof t&&null!==t&&"function"===typeof t.render&&void 0===t.$$typeof?(I.tag=1,I.memoizedState=null,I.updateQueue=null,Yt(C)?(n=!0,wt(I)):n=!1,I.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,kl(I),t.updater=zl,I.stateNode=t,t._reactInternals=I,Ul(I,C,g,e),I=Jo(null,I,C,!0,n,e)):(I.tag=0,Cl&&n&&$t(I),Bo(null,I,t,e),I=I.child),I;case 16:C=I.elementType;g:{switch(Uo(g,I),g=I.pendingProps,C=(t=C._init)(C._payload),I.type=C,t=I.tag=function(g){if("function"===typeof g)return vi(g)?1:0;if(void 0!==g&&null!==g){if((g=g.$$typeof)===R)return 11;if(g===Y)return 14}return 2}(C),g=bl(C,g),t){case 0:I=Xo(null,I,C,g,e);break g;case 1:I=Ro(null,I,C,g,e);break g;case 11:I=yo(null,I,C,g,e);break g;case 14:I=po(null,I,C,bl(C.type,g),e);break g}throw Error(l(306,C,""))}return I;case 0:return C=I.type,t=I.pendingProps,Xo(g,I,C,t=I.elementType===C?t:bl(C,t),e);case 1:return C=I.type,t=I.pendingProps,Ro(g,I,C,t=I.elementType===C?t:bl(C,t),e);case 3:g:{if(ko(I),null===g)throw Error(l(387));C=I.pendingProps,t=(n=I.memoizedState).element,Yl(g,I),Nl(I,C,null,e);var o=I.memoizedState;if(C=o.element,n.isDehydrated){if(n={element:C,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},I.updateQueue.baseState=n,I.memoizedState=n,256&I.flags){I=Yo(g,I,C,e,t=io(Error(l(423)),I));break g}if(C!==t){I=Yo(g,I,C,e,t=io(Error(l(424)),I));break g}for(el=at(I.stateNode.containerInfo.firstChild),Il=I,Cl=!0,tl=null,e=Ol(I,null,C,e),I.child=e;e;)e.flags=-3&e.flags|4096,e=e.sibling}else{if(sl(),C===t){I=Lo(g,I,e);break g}Bo(g,I,C,e)}I=I.child}return I;case 5:return tn(I),null===g&&al(I),C=I.type,t=I.pendingProps,n=null!==g?g.memoizedProps:null,o=t.children,It(C,t)?o=null:null!==n&&It(C,n)&&(I.flags|=32),So(g,I),Bo(g,I,o,e),I.child;case 6:return null===g&&al(I),null;case 13:return Fo(g,I,e);case 4:return en(I,I.stateNode.containerInfo),C=I.pendingProps,null===g?I.child=Pl(I,null,C,e):Bo(g,I,C,e),I.child;case 11:return C=I.type,t=I.pendingProps,yo(g,I,C,t=I.elementType===C?t:bl(C,t),e);case 7:return Bo(g,I,I.pendingProps,e),I.child;case 8:case 12:return Bo(g,I,I.pendingProps.children,e),I.child;case 10:g:{if(C=I.type._context,t=I.pendingProps,n=I.memoizedProps,o=t.value,Vt(ul,C._currentValue),C._currentValue=o,null!==n)if(nC(n.value,o)){if(n.children===t.children&&!Rt.current){I=Lo(g,I,e);break g}}else for(null!==(n=I.child)&&(n.return=I);null!==n;){var a=n.dependencies;if(null!==a){o=n.child;for(var i=a.firstContext;null!==i;){if(i.context===C){if(1===n.tag){(i=fl(-1,e&-e)).tag=2;var A=n.updateQueue;if(null!==A){var c=(A=A.shared).pending;null===c?i.next=i:(i.next=c.next,c.next=i),A.pending=i}}n.lanes|=e,null!==(i=n.alternate)&&(i.lanes|=e),yl(n.return,e,I),a.lanes|=e;break}i=i.next}}else if(10===n.tag)o=n.type===I.type?null:n.child;else if(18===n.tag){if(null===(o=n.return))throw Error(l(341));o.lanes|=e,null!==(a=o.alternate)&&(a.lanes|=e),yl(o,e,I),o=n.sibling}else o=n.child;if(null!==o)o.return=n;else for(o=n;null!==o;){if(o===I){o=null;break}if(null!==(n=o.sibling)){n.return=o.return,o=n;break}o=o.return}n=o}Bo(g,I,t.children,e),I=I.child}return I;case 9:return t=I.type,C=I.pendingProps.children,pl(I,e),C=C(t=Wl(t)),I.flags|=1,Bo(g,I,C,e),I.child;case 14:return t=bl(C=I.type,I.pendingProps),po(g,I,C,t=bl(C.type,t),e);case 15:return Wo(g,I,I.type,I.pendingProps,e);case 17:return C=I.type,t=I.pendingProps,t=I.elementType===C?t:bl(C,t),Uo(g,I),I.tag=1,Yt(C)?(g=!0,wt(I)):g=!1,pl(I,e),El(I,C,t),Ul(I,C,t,e),Jo(null,I,C,!0,g,e);case 19:return Qo(g,I,e);case 22:return Vo(g,I,e)}throw Error(l(156,I.tag))};var ji="function"===typeof reportError?reportError:function(g){console.error(g)};function Pi(g){this._internalRoot=g}function Oi(g){this._internalRoot=g}function _i(g){return!(!g||1!==g.nodeType&&9!==g.nodeType&&11!==g.nodeType)}function qi(g){return!(!g||1!==g.nodeType&&9!==g.nodeType&&11!==g.nodeType&&(8!==g.nodeType||" react-mount-point-unstable "!==g.nodeValue))}function $i(){}function gA(g,I,e,C,t){var l=e._reactRootContainer;if(l){var n=l;if("function"===typeof t){var o=t;t=function(){var g=Li(n);o.call(g)}}Ui(I,n,g,t)}else n=function(g,I,e,C,t){if(t){if("function"===typeof C){var l=C;C=function(){var g=Li(n);l.call(g)}}var n=Qi(I,C,g,0,null,!1,0,"",$i);return g._reactRootContainer=n,g[dt]=n.current,MC(8===g.nodeType?g.parentNode:g),ci(),n}for(;t=g.lastChild;)g.removeChild(t);if("function"===typeof C){var o=C;C=function(){var g=Li(a);o.call(g)}}var a=Mi(g,0,!1,null,0,!1,0,"",$i);return g._reactRootContainer=a,g[dt]=a.current,MC(8===g.nodeType?g.parentNode:g),ci((function(){Ui(I,a,e,C)})),a}(e,I,g,t,C);return Li(n)}Oi.prototype.render=Pi.prototype.render=function(g){var I=this._internalRoot;if(null===I)throw Error(l(409));Ui(g,I,null,null)},Oi.prototype.unmount=Pi.prototype.unmount=function(){var g=this._internalRoot;if(null!==g){this._internalRoot=null;var I=g.containerInfo;ci((function(){Ui(null,g,null,null)})),I[dt]=null}},Oi.prototype.unstable_scheduleHydration=function(g){if(g){var I=WI();g={blockedOn:null,target:g,priority:I};for(var e=0;e<vI.length&&0!==I&&I<vI[e].priority;e++);vI.splice(e,0,g),0===e&&KI(g)}},BI=function(g){switch(g.tag){case 3:var I=g.stateNode;if(I.current.memoizedState.isDehydrated){var e=cI(I.pendingLanes);0!==e&&(ZI(I,1|e),ti(I,_g()),0===(6&Ja)&&(Qa=_g()+500,Mt()))}break;case 13:ci((function(){var I=Rl(g,1);if(null!==I){var e=Ii();Ci(I,g,1,e)}})),Ti(g,1)}},yI=function(g){if(13===g.tag){var I=Rl(g,134217728);if(null!==I)Ci(I,g,134217728,Ii());Ti(g,134217728)}},pI=function(g){if(13===g.tag){var I=ei(g),e=Rl(g,I);if(null!==e)Ci(e,g,I,Ii());Ti(g,I)}},WI=function(){return hI},VI=function(g,I){var e=hI;try{return hI=g,I()}finally{hI=e}},yg=function(g,I,e){switch(I){case"input":if(q(g,e),I=e.name,"radio"===e.type&&null!=I){for(e=g;e.parentNode;)e=e.parentNode;for(e=e.querySelectorAll("input[name="+JSON.stringify(""+I)+'][type="radio"]'),I=0;I<e.length;I++){var C=e[I];if(C!==g&&C.form===g.form){var t=Gt(C);if(!t)throw Error(l(90));T(C),q(C,t)}}}break;case"textarea":lg(g,e);break;case"select":null!=(I=e.value)&&eg(g,!!e.multiple,I,!1)}},Rg=Ai,Jg=ci;var IA={usingClientEntryPoint:!1,Events:[Zt,ht,Gt,Sg,Xg,Ai]},eA={findFiberByHostInstance:mt,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},CA={bundleType:eA.bundleType,version:eA.version,rendererPackageName:eA.rendererPackageName,rendererConfig:eA.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:G.ReactCurrentDispatcher,findHostInstanceByFiber:function(g){return null===(g=Lg(g))?null:g.stateNode},findFiberByHostInstance:eA.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var tA=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!tA.isDisabled&&tA.supportsFiber)try{tI=tA.inject(CA),lI=tA}catch(Ag){}}I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=IA,I.createPortal=function(g,I){var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!_i(I))throw Error(l(200));return function(g,I,e){var C=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:y,key:null==C?null:""+C,children:g,containerInfo:I,implementation:e}}(g,I,null,e)},I.createRoot=function(g,I){if(!_i(g))throw Error(l(299));var e=!1,C="",t=ji;return null!==I&&void 0!==I&&(!0===I.unstable_strictMode&&(e=!0),void 0!==I.identifierPrefix&&(C=I.identifierPrefix),void 0!==I.onRecoverableError&&(t=I.onRecoverableError)),I=Mi(g,1,!1,null,0,e,0,C,t),g[dt]=I.current,MC(8===g.nodeType?g.parentNode:g),new Pi(I)},I.findDOMNode=function(g){if(null==g)return null;if(1===g.nodeType)return g;var I=g._reactInternals;if(void 0===I){if("function"===typeof g.render)throw Error(l(188));throw g=Object.keys(g).join(","),Error(l(268,g))}return g=null===(g=Lg(I))?null:g.stateNode},I.flushSync=function(g){return ci(g)},I.hydrate=function(g,I,e){if(!qi(I))throw Error(l(200));return gA(null,g,I,!0,e)},I.hydrateRoot=function(g,I,e){if(!_i(g))throw Error(l(405));var C=null!=e&&e.hydratedSources||null,t=!1,n="",o=ji;if(null!==e&&void 0!==e&&(!0===e.unstable_strictMode&&(t=!0),void 0!==e.identifierPrefix&&(n=e.identifierPrefix),void 0!==e.onRecoverableError&&(o=e.onRecoverableError)),I=Qi(I,null,g,1,null!=e?e:null,t,0,n,o),g[dt]=I.current,MC(g),C)for(g=0;g<C.length;g++)t=(t=(e=C[g])._getVersion)(e._source),null==I.mutableSourceEagerHydrationData?I.mutableSourceEagerHydrationData=[e,t]:I.mutableSourceEagerHydrationData.push(e,t);return new Oi(I)},I.render=function(g,I,e){if(!qi(I))throw Error(l(200));return gA(null,g,I,!1,e)},I.unmountComponentAtNode=function(g){if(!qi(g))throw Error(l(40));return!!g._reactRootContainer&&(ci((function(){gA(null,null,g,!1,(function(){g._reactRootContainer=null,g[dt]=null}))})),!0)},I.unstable_batchedUpdates=Ai,I.unstable_renderSubtreeIntoContainer=function(g,I,e,C){if(!qi(e))throw Error(l(200));if(null==g||void 0===g._reactInternals)throw Error(l(38));return gA(g,I,e,!1,C)},I.version="18.2.0-next-9e3b772b8-20220608"},391:(g,I,e)=>{"use strict";var C=e(950);I.createRoot=C.createRoot,I.hydrateRoot=C.hydrateRoot},950:(g,I,e)=>{"use strict";!function g(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(g)}catch(I){console.error(I)}}(),g.exports=e(730)},309:function(g,I,e){g.exports=function(g){"use strict";function I(g){if(g&&g.__esModule)return g;var I=Object.create(null);return g&&Object.keys(g).forEach((function(e){if("default"!==e){var C=Object.getOwnPropertyDescriptor(g,e);Object.defineProperty(I,e,C.get?C:{enumerable:!0,get:function(){return g[e]}})}})),I.default=g,Object.freeze(I)}var e=I(g);function C(){return C=Object.assign?Object.assign.bind():function(g){for(var I=1;I<arguments.length;I++){var e=arguments[I];for(var C in e)Object.prototype.hasOwnProperty.call(e,C)&&(g[C]=e[C])}return g},C.apply(this,arguments)}function t(g,I,e){return I in g?Object.defineProperty(g,I,{value:e,enumerable:!0,configurable:!0,writable:!0}):g[I]=e,g}function l(g){if(Array.isArray(g))return g}function n(g,I){var e=null==g?null:"undefined"!==typeof Symbol&&g[Symbol.iterator]||g["@@iterator"];if(null!=e){var C,t,l=[],n=!0,o=!1;try{for(e=e.call(g);!(n=(C=e.next()).done)&&(l.push(C.value),!I||l.length!==I);n=!0);}catch(a){o=!0,t=a}finally{try{n||null==e.return||e.return()}finally{if(o)throw t}}return l}}function o(g,I){(null==I||I>g.length)&&(I=g.length);for(var e=0,C=new Array(I);e<I;e++)C[e]=g[e];return C}function a(g,I){if(g){if("string"===typeof g)return o(g,I);var e=Object.prototype.toString.call(g).slice(8,-1);return"Object"===e&&g.constructor&&(e=g.constructor.name),"Map"===e||"Set"===e?Array.from(g):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?o(g,I):void 0}}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function A(g,I){return l(g)||n(g,I)||a(g,I)||i()}function c(g,I){if(null==g)return{};var e,C,t={},l=Object.keys(g);for(C=0;C<l.length;C++)e=l[C],I.indexOf(e)>=0||(t[e]=g[e]);return t}function s(g,I){if(null==g)return{};var e,C,t=c(g,I);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(g);for(C=0;C<l.length;C++)e=l[C],I.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(g,e)&&(t[e]=g[e])}return t}var d={exports:{}},r={exports:{}},b={},u="function"===typeof Symbol&&Symbol.for,m=u?Symbol.for("react.element"):60103,Z=u?Symbol.for("react.portal"):60106,h=u?Symbol.for("react.fragment"):60107,G=u?Symbol.for("react.strict_mode"):60108,B=u?Symbol.for("react.profiler"):60114,y=u?Symbol.for("react.provider"):60109,p=u?Symbol.for("react.context"):60110,W=u?Symbol.for("react.async_mode"):60111,V=u?Symbol.for("react.concurrent_mode"):60111,S=u?Symbol.for("react.forward_ref"):60112,X=u?Symbol.for("react.suspense"):60113,R=u?Symbol.for("react.suspense_list"):60120,J=u?Symbol.for("react.memo"):60115,k=u?Symbol.for("react.lazy"):60116,Y=u?Symbol.for("react.block"):60121,f=u?Symbol.for("react.fundamental"):60117,v=u?Symbol.for("react.responder"):60118,H=u?Symbol.for("react.scope"):60119;function w(g){if("object"===typeof g&&null!==g){var I=g.$$typeof;switch(I){case m:switch(g=g.type){case W:case V:case h:case B:case G:case X:return g;default:switch(g=g&&g.$$typeof){case p:case S:case k:case J:case y:return g;default:return I}}case Z:return I}}}function N(g){return w(g)===V}b.AsyncMode=W,b.ConcurrentMode=V,b.ContextConsumer=p,b.ContextProvider=y,b.Element=m,b.ForwardRef=S,b.Fragment=h,b.Lazy=k,b.Memo=J,b.Portal=Z,b.Profiler=B,b.StrictMode=G,b.Suspense=X,b.isAsyncMode=function(g){return N(g)||w(g)===W},b.isConcurrentMode=N,b.isContextConsumer=function(g){return w(g)===p},b.isContextProvider=function(g){return w(g)===y},b.isElement=function(g){return"object"===typeof g&&null!==g&&g.$$typeof===m},b.isForwardRef=function(g){return w(g)===S},b.isFragment=function(g){return w(g)===h},b.isLazy=function(g){return w(g)===k},b.isMemo=function(g){return w(g)===J},b.isPortal=function(g){return w(g)===Z},b.isProfiler=function(g){return w(g)===B},b.isStrictMode=function(g){return w(g)===G},b.isSuspense=function(g){return w(g)===X},b.isValidElementType=function(g){return"string"===typeof g||"function"===typeof g||g===h||g===V||g===B||g===G||g===X||g===R||"object"===typeof g&&null!==g&&(g.$$typeof===k||g.$$typeof===J||g.$$typeof===y||g.$$typeof===p||g.$$typeof===S||g.$$typeof===f||g.$$typeof===v||g.$$typeof===H||g.$$typeof===Y)},b.typeOf=w,r.exports=b;Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;function K(){try{if(!Object.assign)return!1;var g=new String("abc");if(g[5]="de","5"===Object.getOwnPropertyNames(g)[0])return!1;for(var I={},e=0;e<10;e++)I["_"+String.fromCharCode(e)]=e;var C=Object.getOwnPropertyNames(I).map((function(g){return I[g]}));if("0123456789"!==C.join(""))return!1;var t={};return"abcdefghijklmnopqrst".split("").forEach((function(g){t[g]=g})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},t)).join("")}catch(l){return!1}}K()&&Object.assign;var F="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";function x(g,I,e,C,t){}Function.call.bind(Object.prototype.hasOwnProperty),x.resetWarningCache=function(){},r.exports;var z=F;function M(){}function E(){}E.resetWarningCache=M;var Q=function(){function g(g,I,e,C,t,l){if(l!==z){var n=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw n.name="Invariant Violation",n}}function I(){return g}g.isRequired=g;var e={array:g,bigint:g,bool:g,func:g,number:g,object:g,string:g,symbol:g,any:g,arrayOf:I,element:g,elementType:g,instanceOf:I,node:g,objectOf:I,oneOf:I,oneOfType:I,shape:I,exact:I,checkPropTypes:E,resetWarningCache:M};return e.PropTypes=e,e};d.exports=Q();var U=d.exports;function L(g,I){var e=atob(g);if(I){for(var C=new Uint8Array(e.length),t=0,l=e.length;t<l;++t)C[t]=e.charCodeAt(t);return String.fromCharCode.apply(null,new Uint16Array(C.buffer))}return e}function D(g,I,e){var C=void 0===I?null:I,t=L(g,void 0!==e&&e),l=t.indexOf("\n",10)+1,n=t.substring(l)+(C?"//# sourceMappingURL="+C:""),o=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(o)}function T(g,I,e){var C;return function(t){return C=C||D(g,I,e),new Worker(C,t)}}var j=T("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewoJJ3VzZSBzdHJpY3QnOwoKCXZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9OwoKCWZ1bmN0aW9uIGdldEF1Z21lbnRlZE5hbWVzcGFjZShuKSB7CgkJaWYgKG4uX19lc01vZHVsZSkgcmV0dXJuIG47CgkJdmFyIGEgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sICdfX2VzTW9kdWxlJywge3ZhbHVlOiB0cnVlfSk7CgkJT2JqZWN0LmtleXMobikuZm9yRWFjaChmdW5jdGlvbiAoaykgewoJCQl2YXIgZCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iobiwgayk7CgkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShhLCBrLCBkLmdldCA/IGQgOiB7CgkJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgkJCQkJcmV0dXJuIG5ba107CgkJCQl9CgkJCX0pOwoJCX0pOwoJCXJldHVybiBhOwoJfQoKCXZhciBCaW5hcnlCaXRtYXAkMSA9IHt9OwoKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBFeGNlcHRpb24kMSA9IHt9OwoKCWZ1bmN0aW9uIGZpeFByb3RvKHRhcmdldCwgcHJvdG90eXBlKSB7CgkgIHZhciBzZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZjsKCSAgc2V0UHJvdG90eXBlT2YgPyBzZXRQcm90b3R5cGVPZih0YXJnZXQsIHByb3RvdHlwZSkgOiB0YXJnZXQuX19wcm90b19fID0gcHJvdG90eXBlOwoJfQoJZnVuY3Rpb24gZml4U3RhY2sodGFyZ2V0LCBmbikgewoJICBpZiAoZm4gPT09IHZvaWQgMCkgewoJICAgIGZuID0gdGFyZ2V0LmNvbnN0cnVjdG9yOwoJICB9CgoJICB2YXIgY2FwdHVyZVN0YWNrVHJhY2UgPSBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZTsKCSAgY2FwdHVyZVN0YWNrVHJhY2UgJiYgY2FwdHVyZVN0YWNrVHJhY2UodGFyZ2V0LCBmbik7Cgl9CgoJdmFyIF9fZXh0ZW5kcyRrID0gZnVuY3Rpb24gKCkgewoJICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCB7CgkgICAgICBfX3Byb3RvX186IFtdCgkgICAgfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICBkLl9fcHJvdG9fXyA9IGI7CgkgICAgfSB8fCBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgZm9yICh2YXIgcCBpbiBiKSB7IGlmIChiLmhhc093blByb3BlcnR5KHApKSB7IGRbcF0gPSBiW3BdOyB9IH0KCSAgICB9OwoKCSAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgfTsKCgkgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgoJICAgIGZ1bmN0aW9uIF9fKCkgewoJICAgICAgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7CgkgICAgfQoKCSAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgIH07Cgl9KCk7CgoJdmFyIEN1c3RvbUVycm9yID0gZnVuY3Rpb24gKF9zdXBlcikgewoJICBfX2V4dGVuZHMkayhDdXN0b21FcnJvciwgX3N1cGVyKTsKCgkgIGZ1bmN0aW9uIEN1c3RvbUVycm9yKG1lc3NhZ2UpIHsKCSAgICB2YXIgX25ld1RhcmdldCA9IHRoaXMuY29uc3RydWN0b3I7CgoJICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIG1lc3NhZ2UpIHx8IHRoaXM7CgoJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShfdGhpcywgJ25hbWUnLCB7CgkgICAgICB2YWx1ZTogX25ld1RhcmdldC5uYW1lLAoJICAgICAgZW51bWVyYWJsZTogZmFsc2UsCgkgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICB9KTsKCSAgICBmaXhQcm90byhfdGhpcywgX25ld1RhcmdldC5wcm90b3R5cGUpOwoJICAgIGZpeFN0YWNrKF90aGlzKTsKCSAgICByZXR1cm4gX3RoaXM7CgkgIH0KCgkgIHJldHVybiBDdXN0b21FcnJvcjsKCX0oRXJyb3IpOwoKCXZhciBfX3NwcmVhZEFycmF5cyA9IGZ1bmN0aW9uICgpIHsKCSAgdmFyIGFyZ3VtZW50cyQxID0gYXJndW1lbnRzOwoKCSAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7IHMgKz0gYXJndW1lbnRzJDFbaV0ubGVuZ3RoOyB9CgoJICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspIHsgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspIHsgcltrXSA9IGFbal07IH0gfQoKCSAgcmV0dXJuIHI7Cgl9OwoJZnVuY3Rpb24gY3VzdG9tRXJyb3JGYWN0b3J5KGZuLCBwYXJlbnQpIHsKCSAgaWYgKHBhcmVudCA9PT0gdm9pZCAwKSB7CgkgICAgcGFyZW50ID0gRXJyb3I7CgkgIH0KCgkgIGZ1bmN0aW9uIEN1c3RvbUVycm9yKCkgewoJICAgIHZhciBhcmd1bWVudHMkMSA9IGFyZ3VtZW50czsKCgkgICAgdmFyIGFyZ3MgPSBbXTsKCgkgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzJDFbX2ldOwoJICAgIH0KCgkgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIEN1c3RvbUVycm9yKSkgeyByZXR1cm4gbmV3IChDdXN0b21FcnJvci5iaW5kLmFwcGx5KEN1c3RvbUVycm9yLCBfX3NwcmVhZEFycmF5cyhbdm9pZCAwXSwgYXJncykpKSgpOyB9CgkgICAgcGFyZW50LmFwcGx5KHRoaXMsIGFyZ3MpOwoJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnbmFtZScsIHsKCSAgICAgIHZhbHVlOiBmbi5uYW1lIHx8IHBhcmVudC5uYW1lLAoJICAgICAgZW51bWVyYWJsZTogZmFsc2UsCgkgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICB9KTsKCSAgICBmbi5hcHBseSh0aGlzLCBhcmdzKTsKCSAgICBmaXhTdGFjayh0aGlzLCBDdXN0b21FcnJvcik7CgkgIH0KCgkgIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhDdXN0b21FcnJvciwgewoJICAgIHByb3RvdHlwZTogewoJICAgICAgdmFsdWU6IE9iamVjdC5jcmVhdGUocGFyZW50LnByb3RvdHlwZSwgewoJICAgICAgICBjb25zdHJ1Y3RvcjogewoJICAgICAgICAgIHZhbHVlOiBDdXN0b21FcnJvciwKCSAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKCSAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICAgICAgfQoJICAgICAgfSkKCSAgICB9CgkgIH0pOwoJfQoKCXZhciBjdXN0b21FcnJvciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKCQlfX3Byb3RvX186IG51bGwsCgkJQ3VzdG9tRXJyb3I6IEN1c3RvbUVycm9yLAoJCWN1c3RvbUVycm9yRmFjdG9yeTogY3VzdG9tRXJyb3JGYWN0b3J5Cgl9KTsKCgl2YXIgcmVxdWlyZSQkMCA9IC8qQF9fUFVSRV9fKi9nZXRBdWdtZW50ZWROYW1lc3BhY2UoY3VzdG9tRXJyb3IpOwoKCXZhciBfX2V4dGVuZHMkaiA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIHRzX2N1c3RvbV9lcnJvcl8xID0gcmVxdWlyZSQkMDsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyRqKEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICAvKioKCSAgICAgKiBBbGxvd3MgRXhjZXB0aW9uIHRvIGJlIGNvbnN0cnVjdGVkIGRpcmVjdGx5CgkgICAgICogd2l0aCBzb21lIG1lc3NhZ2UgYW5kIHByb3RvdHlwZSBkZWZpbml0aW9uLgoJICAgICAqLwoJICAgIGZ1bmN0aW9uIEV4Y2VwdGlvbihtZXNzYWdlKSB7CgkgICAgICAgIGlmIChtZXNzYWdlID09PSB2b2lkIDApIHsgbWVzc2FnZSA9IHVuZGVmaW5lZDsgfQoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBFeGNlcHRpb24ucHJvdG90eXBlLmdldEtpbmQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBleCA9IHRoaXMuY29uc3RydWN0b3I7CgkgICAgICAgIHJldHVybiBleC5raW5kOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogSXQncyB0eXBlZCBhcyBzdHJpbmcgc28gaXQgY2FuIGJlIGV4dGVuZGVkIGFuZCBvdmVycmlkZW4uCgkgICAgICovCgkgICAgRXhjZXB0aW9uLmtpbmQgPSAnRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gRXhjZXB0aW9uOwoJfSh0c19jdXN0b21fZXJyb3JfMS5DdXN0b21FcnJvcikpOwoJRXhjZXB0aW9uJDEuZGVmYXVsdCA9IEV4Y2VwdGlvbjsKCgl2YXIgX19leHRlbmRzJGkgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBFeGNlcHRpb25fMSQ5ID0gRXhjZXB0aW9uJDE7CgkvKioKCSAqIEN1c3RvbSBFcnJvciBjbGFzcyBvZiB0eXBlIEV4Y2VwdGlvbi4KCSAqLwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkaShJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCkgewoJICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7CgkgICAgfQoJICAgIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5raW5kID0gJ0lsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbic7CgkgICAgcmV0dXJuIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbjsKCX0oRXhjZXB0aW9uXzEkOS5kZWZhdWx0KSk7CglJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMS5kZWZhdWx0ID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmluYXJ5Qml0bWFwJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSRhID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7Cgl2YXIgQmluYXJ5Qml0bWFwID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEJpbmFyeUJpdG1hcChiaW5hcml6ZXIpIHsKCSAgICAgICAgdGhpcy5iaW5hcml6ZXIgPSBiaW5hcml6ZXI7CgkgICAgICAgIGlmIChiaW5hcml6ZXIgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSRhLmRlZmF1bHQoJ0JpbmFyaXplciBtdXN0IGJlIG5vbi1udWxsLicpOwoJICAgICAgICB9CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gVGhlIHdpZHRoIG9mIHRoZSBiaXRtYXAuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldFdpZHRoKCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSBoZWlnaHQgb2YgdGhlIGJpdG1hcC4KCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldEhlaWdodCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29udmVydHMgb25lIHJvdyBvZiBsdW1pbmFuY2UgZGF0YSB0byAxIGJpdCBkYXRhLiBNYXkgYWN0dWFsbHkgZG8gdGhlIGNvbnZlcnNpb24sIG9yIHJldHVybgoJICAgICAqIGNhY2hlZCBkYXRhLiBDYWxsZXJzIHNob3VsZCBhc3N1bWUgdGhpcyBtZXRob2QgaXMgZXhwZW5zaXZlIGFuZCBjYWxsIGl0IGFzIHNlbGRvbSBhcyBwb3NzaWJsZS4KCSAgICAgKiBUaGlzIG1ldGhvZCBpcyBpbnRlbmRlZCBmb3IgZGVjb2RpbmcgMUQgYmFyY29kZXMgYW5kIG1heSBjaG9vc2UgdG8gYXBwbHkgc2hhcnBlbmluZy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB5IFRoZSByb3cgdG8gZmV0Y2gsIHdoaWNoIG11c3QgYmUgaW4gWzAsIGJpdG1hcCBoZWlnaHQpCgkgICAgICogQHBhcmFtIHJvdyBBbiBvcHRpb25hbCBwcmVhbGxvY2F0ZWQgYXJyYXkuIElmIG51bGwgb3IgdG9vIHNtYWxsLCBpdCB3aWxsIGJlIGlnbm9yZWQuCgkgICAgICogICAgICAgICAgICBJZiB1c2VkLCB0aGUgQmluYXJpemVyIHdpbGwgY2FsbCBCaXRBcnJheS5jbGVhcigpLiBBbHdheXMgdXNlIHRoZSByZXR1cm5lZCBvYmplY3QuCgkgICAgICogQHJldHVybiBUaGUgYXJyYXkgb2YgYml0cyBmb3IgdGhpcyByb3cgKHRydWUgbWVhbnMgYmxhY2spLgoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgcm93IGNhbid0IGJlIGJpbmFyaXplZAoJICAgICAqLwoJICAgIEJpbmFyeUJpdG1hcC5wcm90b3R5cGUuZ2V0QmxhY2tSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldEJsYWNrUm93KHksIHJvdyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDb252ZXJ0cyBhIDJEIGFycmF5IG9mIGx1bWluYW5jZSBkYXRhIHRvIDEgYml0LiBBcyBhYm92ZSwgYXNzdW1lIHRoaXMgbWV0aG9kIGlzIGV4cGVuc2l2ZQoJICAgICAqIGFuZCBkbyBub3QgY2FsbCBpdCByZXBlYXRlZGx5LiBUaGlzIG1ldGhvZCBpcyBpbnRlbmRlZCBmb3IgZGVjb2RpbmcgMkQgYmFyY29kZXMgYW5kIG1heSBvcgoJICAgICAqIG1heSBub3QgYXBwbHkgc2hhcnBlbmluZy4gVGhlcmVmb3JlLCBhIHJvdyBmcm9tIHRoaXMgbWF0cml4IG1heSBub3QgYmUgaWRlbnRpY2FsIHRvIG9uZQoJICAgICAqIGZldGNoZWQgdXNpbmcgZ2V0QmxhY2tSb3coKSwgc28gZG9uJ3QgbWl4IGFuZCBtYXRjaCBiZXR3ZWVuIHRoZW0uCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIFRoZSAyRCBhcnJheSBvZiBiaXRzIGZvciB0aGUgaW1hZ2UgKHRydWUgbWVhbnMgYmxhY2spLgoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgaW1hZ2UgY2FuJ3QgYmUgYmluYXJpemVkIHRvIG1ha2UgYSBtYXRyaXgKCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmdldEJsYWNrTWF0cml4ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBUaGUgbWF0cml4IGlzIGNyZWF0ZWQgb24gZGVtYW5kIHRoZSBmaXJzdCB0aW1lIGl0IGlzIHJlcXVlc3RlZCwgdGhlbiBjYWNoZWQuIFRoZXJlIGFyZSB0d28KCSAgICAgICAgLy8gcmVhc29ucyBmb3IgdGhpczoKCSAgICAgICAgLy8gMS4gVGhpcyB3b3JrIHdpbGwgbmV2ZXIgYmUgZG9uZSBpZiB0aGUgY2FsbGVyIG9ubHkgaW5zdGFsbHMgMUQgUmVhZGVyIG9iamVjdHMsIG9yIGlmIGEKCSAgICAgICAgLy8gICAgMUQgUmVhZGVyIGZpbmRzIGEgYmFyY29kZSBiZWZvcmUgdGhlIDJEIFJlYWRlcnMgcnVuLgoJICAgICAgICAvLyAyLiBUaGlzIHdvcmsgd2lsbCBvbmx5IGJlIGRvbmUgb25jZSBldmVuIGlmIHRoZSBjYWxsZXIgaW5zdGFsbHMgbXVsdGlwbGUgMkQgUmVhZGVycy4KCSAgICAgICAgaWYgKHRoaXMubWF0cml4ID09PSBudWxsIHx8IHRoaXMubWF0cml4ID09PSB1bmRlZmluZWQpIHsKCSAgICAgICAgICAgIHRoaXMubWF0cml4ID0gdGhpcy5iaW5hcml6ZXIuZ2V0QmxhY2tNYXRyaXgoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5tYXRyaXg7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFdoZXRoZXIgdGhpcyBiaXRtYXAgY2FuIGJlIGNyb3BwZWQuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5pc0Nyb3BTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmJpbmFyaXplci5nZXRMdW1pbmFuY2VTb3VyY2UoKS5pc0Nyb3BTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggY3JvcHBlZCBpbWFnZSBkYXRhLiBJbXBsZW1lbnRhdGlvbnMgbWF5IGtlZXAgYSByZWZlcmVuY2UgdG8gdGhlCgkgICAgICogb3JpZ2luYWwgZGF0YSByYXRoZXIgdGhhbiBhIGNvcHkuIE9ubHkgY2FsbGFibGUgaWYgaXNDcm9wU3VwcG9ydGVkKCkgaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBsZWZ0IFRoZSBsZWZ0IGNvb3JkaW5hdGUsIHdoaWNoIG11c3QgYmUgaW4gWzAsZ2V0V2lkdGgoKSkKCSAgICAgKiBAcGFyYW0gdG9wIFRoZSB0b3AgY29vcmRpbmF0ZSwgd2hpY2ggbXVzdCBiZSBpbiBbMCxnZXRIZWlnaHQoKSkKCSAgICAgKiBAcGFyYW0gd2lkdGggVGhlIHdpZHRoIG9mIHRoZSByZWN0YW5nbGUgdG8gY3JvcC4KCSAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIHJlY3RhbmdsZSB0byBjcm9wLgoJICAgICAqIEByZXR1cm4gQSBjcm9wcGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5jcm9wID0gZnVuY3Rpb24gKGxlZnQgLyppbnQqLywgdG9wIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHZhciBuZXdTb3VyY2UgPSB0aGlzLmJpbmFyaXplci5nZXRMdW1pbmFuY2VTb3VyY2UoKS5jcm9wKGxlZnQsIHRvcCwgd2lkdGgsIGhlaWdodCk7CgkgICAgICAgIHJldHVybiBuZXcgQmluYXJ5Qml0bWFwKHRoaXMuYmluYXJpemVyLmNyZWF0ZUJpbmFyaXplcihuZXdTb3VyY2UpKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIGJpdG1hcCBzdXBwb3J0cyBjb3VudGVyLWNsb2Nrd2lzZSByb3RhdGlvbi4KCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmlzUm90YXRlU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkuaXNSb3RhdGVTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggcm90YXRlZCBpbWFnZSBkYXRhIGJ5IDkwIGRlZ3JlZXMgY291bnRlcmNsb2Nrd2lzZS4KCSAgICAgKiBPbmx5IGNhbGxhYmxlIGlmIHtAbGluayAjaXNSb3RhdGVTdXBwb3J0ZWQoKX0gaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gQSByb3RhdGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3U291cmNlID0gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkucm90YXRlQ291bnRlckNsb2Nrd2lzZSgpOwoJICAgICAgICByZXR1cm4gbmV3IEJpbmFyeUJpdG1hcCh0aGlzLmJpbmFyaXplci5jcmVhdGVCaW5hcml6ZXIobmV3U291cmNlKSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIGEgbmV3IG9iamVjdCB3aXRoIHJvdGF0ZWQgaW1hZ2UgZGF0YSBieSA0NSBkZWdyZWVzIGNvdW50ZXJjbG9ja3dpc2UuCgkgICAgICogT25seSBjYWxsYWJsZSBpZiB7QGxpbmsgI2lzUm90YXRlU3VwcG9ydGVkKCl9IGlzIHRydWUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIEEgcm90YXRlZCB2ZXJzaW9uIG9mIHRoaXMgb2JqZWN0LgoJICAgICAqLwoJICAgIEJpbmFyeUJpdG1hcC5wcm90b3R5cGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3U291cmNlID0gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1KCk7CgkgICAgICAgIHJldHVybiBuZXcgQmluYXJ5Qml0bWFwKHRoaXMuYmluYXJpemVyLmNyZWF0ZUJpbmFyaXplcihuZXdTb3VyY2UpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QmxhY2tNYXRyaXgoKS50b1N0cmluZygpOwoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlIC8qOiBOb3RGb3VuZEV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICByZXR1cm4gJyc7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHJldHVybiBCaW5hcnlCaXRtYXA7Cgl9KCkpOwoJdmFyIF9kZWZhdWx0JDMgPSBCaW5hcnlCaXRtYXAkMS5kZWZhdWx0ID0gQmluYXJ5Qml0bWFwOwoKCXZhciBIeWJyaWRCaW5hcml6ZXIkMSA9IHt9OwoKCXZhciBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMSA9IHt9OwoKCXZhciBCaW5hcml6ZXIkMSA9IHt9OwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmluYXJpemVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogVGhpcyBjbGFzcyBoaWVyYXJjaHkgcHJvdmlkZXMgYSBzZXQgb2YgbWV0aG9kcyB0byBjb252ZXJ0IGx1bWluYW5jZSBkYXRhIHRvIDEgYml0IGRhdGEuCgkgKiBJdCBhbGxvd3MgdGhlIGFsZ29yaXRobSB0byB2YXJ5IHBvbHltb3JwaGljYWxseSwgZm9yIGV4YW1wbGUgYWxsb3dpbmcgYSB2ZXJ5IGV4cGVuc2l2ZQoJICogdGhyZXNob2xkaW5nIHRlY2huaXF1ZSBmb3Igc2VydmVycyBhbmQgYSBmYXN0IG9uZSBmb3IgbW9iaWxlLiBJdCBhbHNvIHBlcm1pdHMgdGhlIGltcGxlbWVudGF0aW9uCgkgKiB0byB2YXJ5LCBlLmcuIGEgSk5JIHZlcnNpb24gZm9yIEFuZHJvaWQgYW5kIGEgSmF2YSBmYWxsYmFjayB2ZXJzaW9uIGZvciBvdGhlciBwbGF0Zm9ybXMuCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqLwoJdmFyIEJpbmFyaXplciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBCaW5hcml6ZXIoc291cmNlKSB7CgkgICAgICAgIHRoaXMuc291cmNlID0gc291cmNlOwoJICAgIH0KCSAgICBCaW5hcml6ZXIucHJvdG90eXBlLmdldEx1bWluYW5jZVNvdXJjZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlOwoJICAgIH07CgkgICAgQmluYXJpemVyLnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlLmdldFdpZHRoKCk7CgkgICAgfTsKCSAgICBCaW5hcml6ZXIucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlLmdldEhlaWdodCgpOwoJICAgIH07CgkgICAgcmV0dXJuIEJpbmFyaXplcjsKCX0oKSk7CglCaW5hcml6ZXIkMS5kZWZhdWx0ID0gQmluYXJpemVyOwoKCXZhciBCaXRBcnJheSQxID0ge307CgoJdmFyIEFycmF5cyQxID0ge307CgoJdmFyIFN5c3RlbSQxID0ge307CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN5c3RlbSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3lzdGVtID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIFN5c3RlbSgpIHsKCSAgICB9CgkgICAgLy8gcHVibGljIHN0YXRpYyB2b2lkIGFycmF5Y29weShPYmplY3Qgc3JjLCBpbnQgc3JjUG9zLCBPYmplY3QgZGVzdCwgaW50IGRlc3RQb3MsIGludCBsZW5ndGgpCgkgICAgLyoqCgkgICAgICogTWFrZXMgYSBjb3B5IG9mIGEgYXJyYXkuCgkgICAgICovCgkgICAgU3lzdGVtLmFycmF5Y29weSA9IGZ1bmN0aW9uIChzcmMsIHNyY1BvcywgZGVzdCwgZGVzdFBvcywgbGVuZ3RoKSB7CgkgICAgICAgIC8vIFRPRE86IGJldHRlciB1c2Ugc3BsaXQgb3Igc2V0PwoJICAgICAgICB3aGlsZSAobGVuZ3RoLS0pIHsKCSAgICAgICAgICAgIGRlc3RbZGVzdFBvcysrXSA9IHNyY1tzcmNQb3MrK107CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIGN1cnJlbnQgdGltZSBpbiBtaWxsaXNlY29uZHMuCgkgICAgICovCgkgICAgU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gRGF0ZS5ub3coKTsKCSAgICB9OwoJICAgIHJldHVybiBTeXN0ZW07Cgl9KCkpOwoJU3lzdGVtJDEuZGVmYXVsdCA9IFN5c3RlbTsKCgl2YXIgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiQxID0ge307CgoJdmFyIF9fZXh0ZW5kcyRoID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDggPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkaChJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbi5raW5kID0gJ0luZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24nOwoJICAgIHJldHVybiBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQ4LmRlZmF1bHQpKTsKCUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMS5kZWZhdWx0ID0gSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbjsKCgl2YXIgX19leHRlbmRzJGcgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uXzEgPSBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDE7CgkvKioKCSAqIEN1c3RvbSBFcnJvciBjbGFzcyBvZiB0eXBlIEV4Y2VwdGlvbi4KCSAqLwoJdmFyIEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZyhBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uKGluZGV4LCBtZXNzYWdlKSB7CgkgICAgICAgIGlmIChpbmRleCA9PT0gdm9pZCAwKSB7IGluZGV4ID0gdW5kZWZpbmVkOyB9CgkgICAgICAgIGlmIChtZXNzYWdlID09PSB2b2lkIDApIHsgbWVzc2FnZSA9IHVuZGVmaW5lZDsgfQoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5pbmRleCA9IGluZGV4OwoJICAgICAgICBfdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24ua2luZCA9ICdBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24nOwoJICAgIHJldHVybiBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb247Cgl9KEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMS5kZWZhdWx0KSk7CglBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMS5kZWZhdWx0ID0gQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uOwoKCXZhciBfX3ZhbHVlcyQ3ID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFycmF5cyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3lzdGVtXzEkNSA9IFN5c3RlbSQxOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDkgPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMSA9IEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiQxOwoJdmFyIEFycmF5cyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBBcnJheXMoKSB7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEFzc2lnbnMgdGhlIHNwZWNpZmllZCBpbnQgdmFsdWUgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBzcGVjaWZpZWQgYXJyYXkKCSAgICAgKiBvZiBpbnRzLgoJICAgICAqCgkgICAgICogQHBhcmFtIGEgdGhlIGFycmF5IHRvIGJlIGZpbGxlZAoJICAgICAqIEBwYXJhbSB2YWwgdGhlIHZhbHVlIHRvIGJlIHN0b3JlZCBpbiBhbGwgZWxlbWVudHMgb2YgdGhlIGFycmF5CgkgICAgICovCgkgICAgQXJyYXlzLmZpbGwgPSBmdW5jdGlvbiAoYSwgdmFsKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBhLmxlbmd0aDsgaSA8IGxlbjsgaSsrKQoJICAgICAgICAgICAgYVtpXSA9IHZhbDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEFzc2lnbnMgdGhlIHNwZWNpZmllZCBpbnQgdmFsdWUgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBzcGVjaWZpZWQKCSAgICAgKiByYW5nZSBvZiB0aGUgc3BlY2lmaWVkIGFycmF5IG9mIGludHMuICBUaGUgcmFuZ2UgdG8gYmUgZmlsbGVkCgkgICAgICogZXh0ZW5kcyBmcm9tIGluZGV4IHtAY29kZSBmcm9tSW5kZXh9LCBpbmNsdXNpdmUsIHRvIGluZGV4CgkgICAgICoge0Bjb2RlIHRvSW5kZXh9LCBleGNsdXNpdmUuICAoSWYge0Bjb2RlIGZyb21JbmRleD09dG9JbmRleH0sIHRoZQoJICAgICAqIHJhbmdlIHRvIGJlIGZpbGxlZCBpcyBlbXB0eS4pCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYSB0aGUgYXJyYXkgdG8gYmUgZmlsbGVkCgkgICAgICogQHBhcmFtIGZyb21JbmRleCB0aGUgaW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgKGluY2x1c2l2ZSkgdG8gYmUKCSAgICAgKiAgICAgICAgZmlsbGVkIHdpdGggdGhlIHNwZWNpZmllZCB2YWx1ZQoJICAgICAqIEBwYXJhbSB0b0luZGV4IHRoZSBpbmRleCBvZiB0aGUgbGFzdCBlbGVtZW50IChleGNsdXNpdmUpIHRvIGJlCgkgICAgICogICAgICAgIGZpbGxlZCB3aXRoIHRoZSBzcGVjaWZpZWQgdmFsdWUKCSAgICAgKiBAcGFyYW0gdmFsIHRoZSB2YWx1ZSB0byBiZSBzdG9yZWQgaW4gYWxsIGVsZW1lbnRzIG9mIHRoZSBhcnJheQoJICAgICAqIEB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlmIHtAY29kZSBmcm9tSW5kZXggPiB0b0luZGV4fQoJICAgICAqIEB0aHJvd3MgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uIGlmIHtAY29kZSBmcm9tSW5kZXggPCAwfSBvcgoJICAgICAqICAgICAgICAge0Bjb2RlIHRvSW5kZXggPiBhLmxlbmd0aH0KCSAgICAgKi8KCSAgICBBcnJheXMuZmlsbFdpdGhpbiA9IGZ1bmN0aW9uIChhLCBmcm9tSW5kZXgsIHRvSW5kZXgsIHZhbCkgewoJICAgICAgICBBcnJheXMucmFuZ2VDaGVjayhhLmxlbmd0aCwgZnJvbUluZGV4LCB0b0luZGV4KTsKCSAgICAgICAgZm9yICh2YXIgaSA9IGZyb21JbmRleDsgaSA8IHRvSW5kZXg7IGkrKykKCSAgICAgICAgICAgIGFbaV0gPSB2YWw7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDaGVja3MgdGhhdCB7QGNvZGUgZnJvbUluZGV4fSBhbmQge0Bjb2RlIHRvSW5kZXh9IGFyZSBpbgoJICAgICAqIHRoZSByYW5nZSBhbmQgdGhyb3dzIGFuIGV4Y2VwdGlvbiBpZiB0aGV5IGFyZW4ndC4KCSAgICAgKi8KCSAgICBBcnJheXMucmFuZ2VDaGVjayA9IGZ1bmN0aW9uIChhcnJheUxlbmd0aCwgZnJvbUluZGV4LCB0b0luZGV4KSB7CgkgICAgICAgIGlmIChmcm9tSW5kZXggPiB0b0luZGV4KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkOS5kZWZhdWx0KCdmcm9tSW5kZXgoJyArIGZyb21JbmRleCArICcpID4gdG9JbmRleCgnICsgdG9JbmRleCArICcpJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGZyb21JbmRleCA8IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMS5kZWZhdWx0KGZyb21JbmRleCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRvSW5kZXggPiBhcnJheUxlbmd0aCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbl8xLmRlZmF1bHQodG9JbmRleCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIEFycmF5cy5hc0xpc3QgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBhcmdzID0gW107CgkgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7CgkgICAgICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGFyZ3M7CgkgICAgfTsKCSAgICBBcnJheXMuY3JlYXRlID0gZnVuY3Rpb24gKHJvd3MsIGNvbHMsIHZhbHVlKSB7CgkgICAgICAgIHZhciBhcnIgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiByb3dzIH0pOwoJICAgICAgICByZXR1cm4gYXJyLm1hcChmdW5jdGlvbiAoeCkgeyByZXR1cm4gQXJyYXkuZnJvbSh7IGxlbmd0aDogY29scyB9KS5maWxsKHZhbHVlKTsgfSk7CgkgICAgfTsKCSAgICBBcnJheXMuY3JlYXRlSW50MzJBcnJheSA9IGZ1bmN0aW9uIChyb3dzLCBjb2xzLCB2YWx1ZSkgewoJICAgICAgICB2YXIgYXJyID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogcm93cyB9KTsKCSAgICAgICAgcmV0dXJuIGFyci5tYXAoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIEludDMyQXJyYXkuZnJvbSh7IGxlbmd0aDogY29scyB9KS5maWxsKHZhbHVlKTsgfSk7CgkgICAgfTsKCSAgICBBcnJheXMuZXF1YWxzID0gZnVuY3Rpb24gKGZpcnN0LCBzZWNvbmQpIHsKCSAgICAgICAgaWYgKCFmaXJzdCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIGlmICghc2Vjb25kKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKCFmaXJzdC5sZW5ndGgpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoIXNlY29uZC5sZW5ndGgpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZmlyc3QubGVuZ3RoICE9PSBzZWNvbmQubGVuZ3RoKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gZmlyc3QubGVuZ3RoOyBpIDwgbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgaWYgKGZpcnN0W2ldICE9PSBzZWNvbmRbaV0pIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICBBcnJheXMuaGFzaENvZGUgPSBmdW5jdGlvbiAoYSkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgaWYgKGEgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiAwOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSAxOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgYV8xID0gX192YWx1ZXMkNyhhKSwgYV8xXzEgPSBhXzEubmV4dCgpOyAhYV8xXzEuZG9uZTsgYV8xXzEgPSBhXzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBhXzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSAzMSAqIHJlc3VsdCArIGVsZW1lbnQ7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChhXzFfMSAmJiAhYV8xXzEuZG9uZSAmJiAoX2EgPSBhXzEucmV0dXJuKSkgX2EuY2FsbChhXzEpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZmluYWxseSB7IGlmIChlXzEpIHRocm93IGVfMS5lcnJvcjsgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCSAgICBBcnJheXMuZmlsbFVpbnQ4QXJyYXkgPSBmdW5jdGlvbiAoYSwgdmFsdWUpIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgIT09IGEubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIGFbaV0gPSB2YWx1ZTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgQXJyYXlzLmNvcHlPZiA9IGZ1bmN0aW9uIChvcmlnaW5hbCwgbmV3TGVuZ3RoKSB7CgkgICAgICAgIHJldHVybiBvcmlnaW5hbC5zbGljZSgwLCBuZXdMZW5ndGgpOwoJICAgIH07CgkgICAgQXJyYXlzLmNvcHlPZlVpbnQ4QXJyYXkgPSBmdW5jdGlvbiAob3JpZ2luYWwsIG5ld0xlbmd0aCkgewoJICAgICAgICBpZiAob3JpZ2luYWwubGVuZ3RoIDw9IG5ld0xlbmd0aCkgewoJICAgICAgICAgICAgdmFyIG5ld0FycmF5ID0gbmV3IFVpbnQ4QXJyYXkobmV3TGVuZ3RoKTsKCSAgICAgICAgICAgIG5ld0FycmF5LnNldChvcmlnaW5hbCk7CgkgICAgICAgICAgICByZXR1cm4gbmV3QXJyYXk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG9yaWdpbmFsLnNsaWNlKDAsIG5ld0xlbmd0aCk7CgkgICAgfTsKCSAgICBBcnJheXMuY29weU9mUmFuZ2UgPSBmdW5jdGlvbiAob3JpZ2luYWwsIGZyb20sIHRvKSB7CgkgICAgICAgIHZhciBuZXdMZW5ndGggPSB0byAtIGZyb207CgkgICAgICAgIHZhciBjb3B5ID0gbmV3IEludDMyQXJyYXkobmV3TGVuZ3RoKTsKCSAgICAgICAgU3lzdGVtXzEkNS5kZWZhdWx0LmFycmF5Y29weShvcmlnaW5hbCwgZnJvbSwgY29weSwgMCwgbmV3TGVuZ3RoKTsKCSAgICAgICAgcmV0dXJuIGNvcHk7CgkgICAgfTsKCSAgICAvKgoJICAgICogUmV0dXJucyB0aGUgaW5kZXggb2Ygb2YgdGhlIGVsZW1lbnQgaW4gYSBzb3J0ZWQgYXJyYXkgb3IgKC1uLTEpIHdoZXJlIG4gaXMgdGhlIGluc2VydGlvbiBwb2ludAoJICAgICogZm9yIHRoZSBuZXcgZWxlbWVudC4KCSAgICAqIFBhcmFtZXRlcnM6CgkgICAgKiAgICAgYXIgLSBBIHNvcnRlZCBhcnJheQoJICAgICogICAgIGVsIC0gQW4gZWxlbWVudCB0byBzZWFyY2ggZm9yCgkgICAgKiAgICAgY29tcGFyYXRvciAtIEEgY29tcGFyYXRvciBmdW5jdGlvbi4gVGhlIGZ1bmN0aW9uIHRha2VzIHR3byBhcmd1bWVudHM6IChhLCBiKSBhbmQgcmV0dXJuczoKCSAgICAqICAgICAgICBhIG5lZ2F0aXZlIG51bWJlciAgaWYgYSBpcyBsZXNzIHRoYW4gYjsKCSAgICAqICAgICAgICAwIGlmIGEgaXMgZXF1YWwgdG8gYjsKCSAgICAqICAgICAgICBhIHBvc2l0aXZlIG51bWJlciBvZiBhIGlzIGdyZWF0ZXIgdGhhbiBiLgoJICAgICogVGhlIGFycmF5IG1heSBjb250YWluIGR1cGxpY2F0ZSBlbGVtZW50cy4gSWYgdGhlcmUgYXJlIG1vcmUgdGhhbiBvbmUgZXF1YWwgZWxlbWVudHMgaW4gdGhlIGFycmF5LAoJICAgICogdGhlIHJldHVybmVkIHZhbHVlIGNhbiBiZSB0aGUgaW5kZXggb2YgYW55IG9uZSBvZiB0aGUgZXF1YWwgZWxlbWVudHMuCgkgICAgKgoJICAgICogaHR0cDovL2pzZmlkZGxlLm5ldC9hcnl6aG92L3BrZnN0NTUwLwoJICAgICovCgkgICAgQXJyYXlzLmJpbmFyeVNlYXJjaCA9IGZ1bmN0aW9uIChhciwgZWwsIGNvbXBhcmF0b3IpIHsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gY29tcGFyYXRvcikgewoJICAgICAgICAgICAgY29tcGFyYXRvciA9IEFycmF5cy5udW1iZXJDb21wYXJhdG9yOwoJICAgICAgICB9CgkgICAgICAgIHZhciBtID0gMDsKCSAgICAgICAgdmFyIG4gPSBhci5sZW5ndGggLSAxOwoJICAgICAgICB3aGlsZSAobSA8PSBuKSB7CgkgICAgICAgICAgICB2YXIgayA9IChuICsgbSkgPj4gMTsKCSAgICAgICAgICAgIHZhciBjbXAgPSBjb21wYXJhdG9yKGVsLCBhcltrXSk7CgkgICAgICAgICAgICBpZiAoY21wID4gMCkgewoJICAgICAgICAgICAgICAgIG0gPSBrICsgMTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKGNtcCA8IDApIHsKCSAgICAgICAgICAgICAgICBuID0gayAtIDE7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gazsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gLW0gLSAxOwoJICAgIH07CgkgICAgQXJyYXlzLm51bWJlckNvbXBhcmF0b3IgPSBmdW5jdGlvbiAoYSwgYikgewoJICAgICAgICByZXR1cm4gYSAtIGI7CgkgICAgfTsKCSAgICByZXR1cm4gQXJyYXlzOwoJfSgpKTsKCUFycmF5cyQxLmRlZmF1bHQgPSBBcnJheXM7CgoJdmFyIEludGVnZXIkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbnRlZ2VyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogUG9ueWZpbGwgZm9yIEphdmEncyBJbnRlZ2VyIGNsYXNzLgoJICovCgl2YXIgSW50ZWdlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBJbnRlZ2VyKCkgewoJICAgIH0KCSAgICBJbnRlZ2VyLm51bWJlck9mVHJhaWxpbmdaZXJvcyA9IGZ1bmN0aW9uIChpKSB7CgkgICAgICAgIHZhciB5OwoJICAgICAgICBpZiAoaSA9PT0gMCkKCSAgICAgICAgICAgIHJldHVybiAzMjsKCSAgICAgICAgdmFyIG4gPSAzMTsKCSAgICAgICAgeSA9IGkgPDwgMTY7CgkgICAgICAgIGlmICh5ICE9PSAwKSB7CgkgICAgICAgICAgICBuIC09IDE2OwoJICAgICAgICAgICAgaSA9IHk7CgkgICAgICAgIH0KCSAgICAgICAgeSA9IGkgPDwgODsKCSAgICAgICAgaWYgKHkgIT09IDApIHsKCSAgICAgICAgICAgIG4gLT0gODsKCSAgICAgICAgICAgIGkgPSB5OwoJICAgICAgICB9CgkgICAgICAgIHkgPSBpIDw8IDQ7CgkgICAgICAgIGlmICh5ICE9PSAwKSB7CgkgICAgICAgICAgICBuIC09IDQ7CgkgICAgICAgICAgICBpID0geTsKCSAgICAgICAgfQoJICAgICAgICB5ID0gaSA8PCAyOwoJICAgICAgICBpZiAoeSAhPT0gMCkgewoJICAgICAgICAgICAgbiAtPSAyOwoJICAgICAgICAgICAgaSA9IHk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG4gLSAoKGkgPDwgMSkgPj4+IDMxKTsKCSAgICB9OwoJICAgIEludGVnZXIubnVtYmVyT2ZMZWFkaW5nWmVyb3MgPSBmdW5jdGlvbiAoaSkgewoJICAgICAgICAvLyBIRCwgRmlndXJlIDUtNgoJICAgICAgICBpZiAoaSA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIDMyOwoJICAgICAgICB9CgkgICAgICAgIHZhciBuID0gMTsKCSAgICAgICAgaWYgKGkgPj4+IDE2ID09PSAwKSB7CgkgICAgICAgICAgICBuICs9IDE2OwoJICAgICAgICAgICAgaSA8PD0gMTY7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGkgPj4+IDI0ID09PSAwKSB7CgkgICAgICAgICAgICBuICs9IDg7CgkgICAgICAgICAgICBpIDw8PSA4OwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID4+PiAyOCA9PT0gMCkgewoJICAgICAgICAgICAgbiArPSA0OwoJICAgICAgICAgICAgaSA8PD0gNDsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaSA+Pj4gMzAgPT09IDApIHsKCSAgICAgICAgICAgIG4gKz0gMjsKCSAgICAgICAgICAgIGkgPDw9IDI7CgkgICAgICAgIH0KCSAgICAgICAgbiAtPSBpID4+PiAzMTsKCSAgICAgICAgcmV0dXJuIG47CgkgICAgfTsKCSAgICBJbnRlZ2VyLnRvSGV4U3RyaW5nID0gZnVuY3Rpb24gKGkpIHsKCSAgICAgICAgcmV0dXJuIGkudG9TdHJpbmcoMTYpOwoJICAgIH07CgkgICAgSW50ZWdlci50b0JpbmFyeVN0cmluZyA9IGZ1bmN0aW9uIChpbnROdW1iZXIpIHsKCSAgICAgICAgcmV0dXJuIFN0cmluZyhwYXJzZUludChTdHJpbmcoaW50TnVtYmVyKSwgMikpOwoJICAgIH07CgkgICAgLy8gUmV0dXJucyB0aGUgbnVtYmVyIG9mIG9uZS1iaXRzIGluIHRoZSB0d28ncyBjb21wbGVtZW50IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3BlY2lmaWVkIGludCB2YWx1ZS4gVGhpcyBmdW5jdGlvbiBpcyBzb21ldGltZXMgcmVmZXJyZWQgdG8gYXMgdGhlIHBvcHVsYXRpb24gY291bnQuCgkgICAgLy8gUmV0dXJuczoKCSAgICAvLyB0aGUgbnVtYmVyIG9mIG9uZS1iaXRzIGluIHRoZSB0d28ncyBjb21wbGVtZW50IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3BlY2lmaWVkIGludCB2YWx1ZS4KCSAgICBJbnRlZ2VyLmJpdENvdW50ID0gZnVuY3Rpb24gKGkpIHsKCSAgICAgICAgLy8gSEQsIEZpZ3VyZSA1LTIKCSAgICAgICAgaSA9IGkgLSAoKGkgPj4+IDEpICYgMHg1NTU1NTU1NSk7CgkgICAgICAgIGkgPSAoaSAmIDB4MzMzMzMzMzMpICsgKChpID4+PiAyKSAmIDB4MzMzMzMzMzMpOwoJICAgICAgICBpID0gKGkgKyAoaSA+Pj4gNCkpICYgMHgwZjBmMGYwZjsKCSAgICAgICAgaSA9IGkgKyAoaSA+Pj4gOCk7CgkgICAgICAgIGkgPSBpICsgKGkgPj4+IDE2KTsKCSAgICAgICAgcmV0dXJuIGkgJiAweDNmOwoJICAgIH07CgkgICAgSW50ZWdlci50cnVuY0RpdmlzaW9uID0gZnVuY3Rpb24gKGRpdmlkZW5kLCBkaXZpc29yKSB7CgkgICAgICAgIHJldHVybiBNYXRoLnRydW5jKGRpdmlkZW5kIC8gZGl2aXNvcik7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDb252ZXJ0cyBBIHN0cmluZyB0byBhbiBpbnRlZ2VyLgoJICAgICAqIEBwYXJhbSBzIEEgc3RyaW5nIHRvIGNvbnZlcnQgaW50byBhIG51bWJlci4KCSAgICAgKiBAcGFyYW0gcmFkaXggQSB2YWx1ZSBiZXR3ZWVuIDIgYW5kIDM2IHRoYXQgc3BlY2lmaWVzIHRoZSBiYXNlIG9mIHRoZSBudW1iZXIgaW4gbnVtU3RyaW5nLiBJZiB0aGlzIGFyZ3VtZW50IGlzIG5vdCBzdXBwbGllZCwgc3RyaW5ncyB3aXRoIGEgcHJlZml4IG9mICcweCcgYXJlIGNvbnNpZGVyZWQgaGV4YWRlY2ltYWwuIEFsbCBvdGhlciBzdHJpbmdzIGFyZSBjb25zaWRlcmVkIGRlY2ltYWwuCgkgICAgICovCgkgICAgSW50ZWdlci5wYXJzZUludCA9IGZ1bmN0aW9uIChudW0sIHJhZGl4KSB7CgkgICAgICAgIGlmIChyYWRpeCA9PT0gdm9pZCAwKSB7IHJhZGl4ID0gdW5kZWZpbmVkOyB9CgkgICAgICAgIHJldHVybiBwYXJzZUludChudW0sIHJhZGl4KTsKCSAgICB9OwoJICAgIEludGVnZXIuTUlOX1ZBTFVFXzMyX0JJVFMgPSAtMjE0NzQ4MzY0ODsKCSAgICBJbnRlZ2VyLk1BWF9WQUxVRSA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSOwoJICAgIHJldHVybiBJbnRlZ2VyOwoJfSgpKTsKCUludGVnZXIkMS5kZWZhdWx0ID0gSW50ZWdlcjsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdEFycmF5JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5czsqLwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDggPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcnJheXNfMSQxID0gQXJyYXlzJDE7Cgl2YXIgSW50ZWdlcl8xJDIgPSBJbnRlZ2VyJDE7Cgl2YXIgU3lzdGVtXzEkNCA9IFN5c3RlbSQxOwoJLyoqCgkgKiA8cD5BIHNpbXBsZSwgZmFzdCBhcnJheSBvZiBiaXRzLCByZXByZXNlbnRlZCBjb21wYWN0bHkgYnkgYW4gYXJyYXkgb2YgaW50cyBpbnRlcm5hbGx5LjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgQml0QXJyYXkgLyppbXBsZW1lbnRzIENsb25lYWJsZSovID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3RvcigpIHsKCSAgICAvLyAgIHRoaXMuc2l6ZSA9IDAKCSAgICAvLyAgIHRoaXMuYml0cyA9IG5ldyBJbnQzMkFycmF5KDEpCgkgICAgLy8gfQoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3RvcihzaXplPzogbnVtYmVyIC8qaW50Ki8pIHsKCSAgICAvLyAgIGlmICh1bmRlZmluZWQgPT09IHNpemUpIHsKCSAgICAvLyAgICAgdGhpcy5zaXplID0gMAoJICAgIC8vICAgfSBlbHNlIHsKCSAgICAvLyAgICAgdGhpcy5zaXplID0gc2l6ZQoJICAgIC8vICAgfQoJICAgIC8vICAgdGhpcy5iaXRzID0gdGhpcy5tYWtlQXJyYXkoc2l6ZSkKCSAgICAvLyB9CgkgICAgLy8gRm9yIHRlc3Rpbmcgb25seQoJICAgIGZ1bmN0aW9uIEJpdEFycmF5KHNpemUgLyppbnQqLywgYml0cykgewoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSBzaXplKSB7CgkgICAgICAgICAgICB0aGlzLnNpemUgPSAwOwoJICAgICAgICAgICAgdGhpcy5iaXRzID0gbmV3IEludDMyQXJyYXkoMSk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICB0aGlzLnNpemUgPSBzaXplOwoJICAgICAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gYml0cyB8fCBudWxsID09PSBiaXRzKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5iaXRzID0gQml0QXJyYXkubWFrZUFycmF5KHNpemUpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhpcy5iaXRzID0gYml0czsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH0KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZ2V0U2l6ZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc2l6ZTsKCSAgICB9OwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXRTaXplSW5CeXRlcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoKHRoaXMuc2l6ZSArIDcpIC8gOCk7CgkgICAgfTsKCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZW5zdXJlQ2FwYWNpdHkgPSBmdW5jdGlvbiAoc2l6ZSAvKmludCovKSB7CgkgICAgICAgIGlmIChzaXplID4gdGhpcy5iaXRzLmxlbmd0aCAqIDMyKSB7CgkgICAgICAgICAgICB2YXIgbmV3Qml0cyA9IEJpdEFycmF5Lm1ha2VBcnJheShzaXplKTsKCSAgICAgICAgICAgIFN5c3RlbV8xJDQuZGVmYXVsdC5hcnJheWNvcHkodGhpcy5iaXRzLCAwLCBuZXdCaXRzLCAwLCB0aGlzLmJpdHMubGVuZ3RoKTsKCSAgICAgICAgICAgIHRoaXMuYml0cyA9IG5ld0JpdHM7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBpIGJpdCB0byBnZXQKCSAgICAgKiBAcmV0dXJuIHRydWUgaWZmIGJpdCBpIGlzIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoaSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiAodGhpcy5iaXRzW01hdGguZmxvb3IoaSAvIDMyKV0gJiAoMSA8PCAoaSAmIDB4MUYpKSkgIT09IDA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGJpdCBpLgoJICAgICAqCgkgICAgICogQHBhcmFtIGkgYml0IHRvIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoaSAvKmludCovKSB7CgkgICAgICAgIHRoaXMuYml0c1tNYXRoLmZsb29yKGkgLyAzMildIHw9IDEgPDwgKGkgJiAweDFGKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEZsaXBzIGJpdCBpLgoJICAgICAqCgkgICAgICogQHBhcmFtIGkgYml0IHRvIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5mbGlwID0gZnVuY3Rpb24gKGkgLyppbnQqLykgewoJICAgICAgICB0aGlzLmJpdHNbTWF0aC5mbG9vcihpIC8gMzIpXSBePSAxIDw8IChpICYgMHgxRik7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gZnJvbSBmaXJzdCBiaXQgdG8gY2hlY2sKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIGZpcnN0IGJpdCB0aGF0IGlzIHNldCwgc3RhcnRpbmcgZnJvbSB0aGUgZ2l2ZW4gaW5kZXgsIG9yIHNpemUgaWYgbm9uZSBhcmUgc2V0CgkgICAgICogIGF0IG9yIGJleW9uZCB0aGlzIGdpdmVuIGluZGV4CgkgICAgICogQHNlZSAjZ2V0TmV4dFVuc2V0KGludCkKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZ2V0TmV4dFNldCA9IGZ1bmN0aW9uIChmcm9tIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIHNpemUgPSB0aGlzLnNpemU7CgkgICAgICAgIGlmIChmcm9tID49IHNpemUpIHsKCSAgICAgICAgICAgIHJldHVybiBzaXplOwoJICAgICAgICB9CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IE1hdGguZmxvb3IoZnJvbSAvIDMyKTsKCSAgICAgICAgdmFyIGN1cnJlbnRCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgLy8gbWFzayBvZmYgbGVzc2VyIGJpdHMgZmlyc3QKCSAgICAgICAgY3VycmVudEJpdHMgJj0gfigoMSA8PCAoZnJvbSAmIDB4MUYpKSAtIDEpOwoJICAgICAgICB2YXIgbGVuZ3RoID0gYml0cy5sZW5ndGg7CgkgICAgICAgIHdoaWxlIChjdXJyZW50Qml0cyA9PT0gMCkgewoJICAgICAgICAgICAgaWYgKCsrYml0c09mZnNldCA9PT0gbGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIHNpemU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjdXJyZW50Qml0cyA9IGJpdHNbYml0c09mZnNldF07CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdCA9IChiaXRzT2Zmc2V0ICogMzIpICsgSW50ZWdlcl8xJDIuZGVmYXVsdC5udW1iZXJPZlRyYWlsaW5nWmVyb3MoY3VycmVudEJpdHMpOwoJICAgICAgICByZXR1cm4gcmVzdWx0ID4gc2l6ZSA/IHNpemUgOiByZXN1bHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gZnJvbSBpbmRleCB0byBzdGFydCBsb29raW5nIGZvciB1bnNldCBiaXQKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIG5leHQgdW5zZXQgYml0LCBvciB7QGNvZGUgc2l6ZX0gaWYgbm9uZSBhcmUgdW5zZXQgdW50aWwgdGhlIGVuZAoJICAgICAqIEBzZWUgI2dldE5leHRTZXQoaW50KQoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXROZXh0VW5zZXQgPSBmdW5jdGlvbiAoZnJvbSAvKmludCovKSB7CgkgICAgICAgIHZhciBzaXplID0gdGhpcy5zaXplOwoJICAgICAgICBpZiAoZnJvbSA+PSBzaXplKSB7CgkgICAgICAgICAgICByZXR1cm4gc2l6ZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgdmFyIGJpdHNPZmZzZXQgPSBNYXRoLmZsb29yKGZyb20gLyAzMik7CgkgICAgICAgIHZhciBjdXJyZW50Qml0cyA9IH5iaXRzW2JpdHNPZmZzZXRdOwoJICAgICAgICAvLyBtYXNrIG9mZiBsZXNzZXIgYml0cyBmaXJzdAoJICAgICAgICBjdXJyZW50Qml0cyAmPSB+KCgxIDw8IChmcm9tICYgMHgxRikpIC0gMSk7CgkgICAgICAgIHZhciBsZW5ndGggPSBiaXRzLmxlbmd0aDsKCSAgICAgICAgd2hpbGUgKGN1cnJlbnRCaXRzID09PSAwKSB7CgkgICAgICAgICAgICBpZiAoKytiaXRzT2Zmc2V0ID09PSBsZW5ndGgpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gc2l6ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGN1cnJlbnRCaXRzID0gfmJpdHNbYml0c09mZnNldF07CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdCA9IChiaXRzT2Zmc2V0ICogMzIpICsgSW50ZWdlcl8xJDIuZGVmYXVsdC5udW1iZXJPZlRyYWlsaW5nWmVyb3MoY3VycmVudEJpdHMpOwoJICAgICAgICByZXR1cm4gcmVzdWx0ID4gc2l6ZSA/IHNpemUgOiByZXN1bHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGEgYmxvY2sgb2YgMzIgYml0cywgc3RhcnRpbmcgYXQgYml0IGkuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gaSBmaXJzdCBiaXQgdG8gc2V0CgkgICAgICogQHBhcmFtIG5ld0JpdHMgdGhlIG5ldyB2YWx1ZSBvZiB0aGUgbmV4dCAzMiBiaXRzLiBOb3RlIGFnYWluIHRoYXQgdGhlIGxlYXN0LXNpZ25pZmljYW50IGJpdAoJICAgICAqIGNvcnJlc3BvbmRzIHRvIGJpdCBpLCB0aGUgbmV4dC1sZWFzdC1zaWduaWZpY2FudCB0byBpKzEsIGFuZCBzbyBvbi4KCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuc2V0QnVsayA9IGZ1bmN0aW9uIChpIC8qaW50Ki8sIG5ld0JpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLmJpdHNbTWF0aC5mbG9vcihpIC8gMzIpXSA9IG5ld0JpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGEgcmFuZ2Ugb2YgYml0cy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGFydCBzdGFydCBvZiByYW5nZSwgaW5jbHVzaXZlLgoJICAgICAqIEBwYXJhbSBlbmQgZW5kIG9mIHJhbmdlLCBleGNsdXNpdmUKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuc2V0UmFuZ2UgPSBmdW5jdGlvbiAoc3RhcnQgLyppbnQqLywgZW5kIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGVuZCA8IHN0YXJ0IHx8IHN0YXJ0IDwgMCB8fCBlbmQgPiB0aGlzLnNpemUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ4LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZW5kID09PSBzdGFydCkgewoJICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICB9CgkgICAgICAgIGVuZC0tOyAvLyB3aWxsIGJlIGVhc2llciB0byB0cmVhdCB0aGlzIGFzIHRoZSBsYXN0IGFjdHVhbGx5IHNldCBiaXQgLS0gaW5jbHVzaXZlCgkgICAgICAgIHZhciBmaXJzdEludCA9IE1hdGguZmxvb3Ioc3RhcnQgLyAzMik7CgkgICAgICAgIHZhciBsYXN0SW50ID0gTWF0aC5mbG9vcihlbmQgLyAzMik7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICBmb3IgKHZhciBpID0gZmlyc3RJbnQ7IGkgPD0gbGFzdEludDsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgZmlyc3RCaXQgPSBpID4gZmlyc3RJbnQgPyAwIDogc3RhcnQgJiAweDFGOwoJICAgICAgICAgICAgdmFyIGxhc3RCaXQgPSBpIDwgbGFzdEludCA/IDMxIDogZW5kICYgMHgxRjsKCSAgICAgICAgICAgIC8vIE9uZXMgZnJvbSBmaXJzdEJpdCB0byBsYXN0Qml0LCBpbmNsdXNpdmUKCSAgICAgICAgICAgIHZhciBtYXNrID0gKDIgPDwgbGFzdEJpdCkgLSAoMSA8PCBmaXJzdEJpdCk7CgkgICAgICAgICAgICBiaXRzW2ldIHw9IG1hc2s7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIENsZWFycyBhbGwgYml0cyAoc2V0cyB0byBmYWxzZSkuCgkgICAgICovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbWF4ID0gdGhpcy5iaXRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWF4OyBpKyspIHsKCSAgICAgICAgICAgIGJpdHNbaV0gPSAwOwoJICAgICAgICB9CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBFZmZpY2llbnQgbWV0aG9kIHRvIGNoZWNrIGlmIGEgcmFuZ2Ugb2YgYml0cyBpcyBzZXQsIG9yIG5vdCBzZXQuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gc3RhcnQgc3RhcnQgb2YgcmFuZ2UsIGluY2x1c2l2ZS4KCSAgICAgKiBAcGFyYW0gZW5kIGVuZCBvZiByYW5nZSwgZXhjbHVzaXZlCgkgICAgICogQHBhcmFtIHZhbHVlIGlmIHRydWUsIGNoZWNrcyB0aGF0IGJpdHMgaW4gcmFuZ2UgYXJlIHNldCwgb3RoZXJ3aXNlIGNoZWNrcyB0aGF0IHRoZXkgYXJlIG5vdCBzZXQKCSAgICAgKiBAcmV0dXJuIHRydWUgaWZmIGFsbCBiaXRzIGFyZSBzZXQgb3Igbm90IHNldCBpbiByYW5nZSwgYWNjb3JkaW5nIHRvIHZhbHVlIGFyZ3VtZW50CgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgZW5kIGlzIGxlc3MgdGhhbiBzdGFydCBvciB0aGUgcmFuZ2UgaXMgbm90IGNvbnRhaW5lZCBpbiB0aGUgYXJyYXkKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuaXNSYW5nZSA9IGZ1bmN0aW9uIChzdGFydCAvKmludCovLCBlbmQgLyppbnQqLywgdmFsdWUpIHsKCSAgICAgICAgaWYgKGVuZCA8IHN0YXJ0IHx8IHN0YXJ0IDwgMCB8fCBlbmQgPiB0aGlzLnNpemUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ4LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZW5kID09PSBzdGFydCkgewoJICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIGVtcHR5IHJhbmdlIG1hdGNoZXMKCSAgICAgICAgfQoJICAgICAgICBlbmQtLTsgLy8gd2lsbCBiZSBlYXNpZXIgdG8gdHJlYXQgdGhpcyBhcyB0aGUgbGFzdCBhY3R1YWxseSBzZXQgYml0IC0tIGluY2x1c2l2ZQoJICAgICAgICB2YXIgZmlyc3RJbnQgPSBNYXRoLmZsb29yKHN0YXJ0IC8gMzIpOwoJICAgICAgICB2YXIgbGFzdEludCA9IE1hdGguZmxvb3IoZW5kIC8gMzIpOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgaSA9IGZpcnN0SW50OyBpIDw9IGxhc3RJbnQ7IGkrKykgewoJICAgICAgICAgICAgdmFyIGZpcnN0Qml0ID0gaSA+IGZpcnN0SW50ID8gMCA6IHN0YXJ0ICYgMHgxRjsKCSAgICAgICAgICAgIHZhciBsYXN0Qml0ID0gaSA8IGxhc3RJbnQgPyAzMSA6IGVuZCAmIDB4MUY7CgkgICAgICAgICAgICAvLyBPbmVzIGZyb20gZmlyc3RCaXQgdG8gbGFzdEJpdCwgaW5jbHVzaXZlCgkgICAgICAgICAgICB2YXIgbWFzayA9ICgyIDw8IGxhc3RCaXQpIC0gKDEgPDwgZmlyc3RCaXQpICYgMHhGRkZGRkZGRjsKCSAgICAgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiAmIDB4RkZGRkZGRkYgYWRkZWQgdG8gZGlzY2FyZCBhbnl0aGluZyBhZnRlciAzMiBiaXRzLCBhcyBFUyBoYXMgNTMgYml0cwoJICAgICAgICAgICAgLy8gUmV0dXJuIGZhbHNlIGlmIHdlJ3JlIGxvb2tpbmcgZm9yIDFzIGFuZCB0aGUgbWFza2VkIGJpdHNbaV0gaXNuJ3QgYWxsIDFzIChpczogdGhhdCwKCSAgICAgICAgICAgIC8vIGVxdWFscyB0aGUgbWFzaywgb3Igd2UncmUgbG9va2luZyBmb3IgMHMgYW5kIHRoZSBtYXNrZWQgcG9ydGlvbiBpcyBub3QgYWxsIDBzCgkgICAgICAgICAgICBpZiAoKGJpdHNbaV0gJiBtYXNrKSAhPT0gKHZhbHVlID8gbWFzayA6IDApKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0cnVlOwoJICAgIH07CgkgICAgQml0QXJyYXkucHJvdG90eXBlLmFwcGVuZEJpdCA9IGZ1bmN0aW9uIChiaXQpIHsKCSAgICAgICAgdGhpcy5lbnN1cmVDYXBhY2l0eSh0aGlzLnNpemUgKyAxKTsKCSAgICAgICAgaWYgKGJpdCkgewoJICAgICAgICAgICAgdGhpcy5iaXRzW01hdGguZmxvb3IodGhpcy5zaXplIC8gMzIpXSB8PSAxIDw8ICh0aGlzLnNpemUgJiAweDFGKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLnNpemUrKzsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEFwcGVuZHMgdGhlIGxlYXN0LXNpZ25pZmljYW50IGJpdHMsIGZyb20gdmFsdWUsIGluIG9yZGVyIGZyb20gbW9zdC1zaWduaWZpY2FudCB0bwoJICAgICAqIGxlYXN0LXNpZ25pZmljYW50LiBGb3IgZXhhbXBsZSwgYXBwZW5kaW5nIDYgYml0cyBmcm9tIDB4MDAwMDAxRSB3aWxsIGFwcGVuZCB0aGUgYml0cwoJICAgICAqIDAsIDEsIDEsIDEsIDEsIDAgaW4gdGhhdCBvcmRlci4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB2YWx1ZSB7QGNvZGUgaW50fSBjb250YWluaW5nIGJpdHMgdG8gYXBwZW5kCgkgICAgICogQHBhcmFtIG51bUJpdHMgYml0cyBmcm9tIHZhbHVlIHRvIGFwcGVuZAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5hcHBlbmRCaXRzID0gZnVuY3Rpb24gKHZhbHVlIC8qaW50Ki8sIG51bUJpdHMgLyppbnQqLykgewoJICAgICAgICBpZiAobnVtQml0cyA8IDAgfHwgbnVtQml0cyA+IDMyKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkOC5kZWZhdWx0KCdOdW0gYml0cyBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMzInKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLmVuc3VyZUNhcGFjaXR5KHRoaXMuc2l6ZSArIG51bUJpdHMpOwoJICAgICAgICAvLyBjb25zdCBhcHBlbmRCaXQgPSB0aGlzLmFwcGVuZEJpdDsKCSAgICAgICAgZm9yICh2YXIgbnVtQml0c0xlZnQgPSBudW1CaXRzOyBudW1CaXRzTGVmdCA+IDA7IG51bUJpdHNMZWZ0LS0pIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kQml0KCgodmFsdWUgPj4gKG51bUJpdHNMZWZ0IC0gMSkpICYgMHgwMSkgPT09IDEpOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBCaXRBcnJheS5wcm90b3R5cGUuYXBwZW5kQml0QXJyYXkgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgdmFyIG90aGVyU2l6ZSA9IG90aGVyLnNpemU7CgkgICAgICAgIHRoaXMuZW5zdXJlQ2FwYWNpdHkodGhpcy5zaXplICsgb3RoZXJTaXplKTsKCSAgICAgICAgLy8gY29uc3QgYXBwZW5kQml0ID0gdGhpcy5hcHBlbmRCaXQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3RoZXJTaXplOyBpKyspIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kQml0KG90aGVyLmdldChpKSk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS54b3IgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKHRoaXMuc2l6ZSAhPT0gb3RoZXIuc2l6ZSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDguZGVmYXVsdCgnU2l6ZXMgZG9uXCd0IG1hdGNoJyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IGJpdHMubGVuZ3RoOyBpIDwgbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgLy8gVGhlIGxhc3QgaW50IGNvdWxkIGJlIGluY29tcGxldGUgKGkuZS4gbm90IGhhdmUgMzIgYml0cyBpbgoJICAgICAgICAgICAgLy8gaXQpIGJ1dCB0aGVyZSBpcyBubyBwcm9ibGVtIHNpbmNlIDAgWE9SIDAgPT0gMC4KCSAgICAgICAgICAgIGJpdHNbaV0gXj0gb3RoZXIuYml0c1tpXTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYml0T2Zmc2V0IGZpcnN0IGJpdCB0byBzdGFydCB3cml0aW5nCgkgICAgICogQHBhcmFtIGFycmF5IGFycmF5IHRvIHdyaXRlIGludG8uIEJ5dGVzIGFyZSB3cml0dGVuIG1vc3Qtc2lnbmlmaWNhbnQgYnl0ZSBmaXJzdC4gVGhpcyBpcyB0aGUgb3Bwb3NpdGUKCSAgICAgKiAgb2YgdGhlIGludGVybmFsIHJlcHJlc2VudGF0aW9uLCB3aGljaCBpcyBleHBvc2VkIGJ5IHtAbGluayAjZ2V0Qml0QXJyYXkoKX0KCSAgICAgKiBAcGFyYW0gb2Zmc2V0IHBvc2l0aW9uIGluIGFycmF5IHRvIHN0YXJ0IHdyaXRpbmcKCSAgICAgKiBAcGFyYW0gbnVtQnl0ZXMgaG93IG1hbnkgYnl0ZXMgdG8gd3JpdGUKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUudG9CeXRlcyA9IGZ1bmN0aW9uIChiaXRPZmZzZXQgLyppbnQqLywgYXJyYXksIG9mZnNldCAvKmludCovLCBudW1CeXRlcyAvKmludCovKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtQnl0ZXM7IGkrKykgewoJICAgICAgICAgICAgdmFyIHRoZUJ5dGUgPSAwOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCA4OyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5nZXQoYml0T2Zmc2V0KSkgewoJICAgICAgICAgICAgICAgICAgICB0aGVCeXRlIHw9IDEgPDwgKDcgLSBqKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgYml0T2Zmc2V0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBhcnJheVtvZmZzZXQgKyBpXSA9IC8qKGJ5dGUpKi8gdGhlQnl0ZTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB1bmRlcmx5aW5nIGFycmF5IG9mIGludHMuIFRoZSBmaXJzdCBlbGVtZW50IGhvbGRzIHRoZSBmaXJzdCAzMiBiaXRzLCBhbmQgdGhlIGxlYXN0CgkgICAgICogICAgICAgICBzaWduaWZpY2FudCBiaXQgaXMgYml0IDAuCgkgICAgICovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLmdldEJpdEFycmF5ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRzOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV2ZXJzZXMgYWxsIGJpdHMgaW4gdGhlIGFycmF5LgoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5yZXZlcnNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3Qml0cyA9IG5ldyBJbnQzMkFycmF5KHRoaXMuYml0cy5sZW5ndGgpOwoJICAgICAgICAvLyByZXZlcnNlIGFsbCBpbnQncyBmaXJzdAoJICAgICAgICB2YXIgbGVuID0gTWF0aC5mbG9vcigodGhpcy5zaXplIC0gMSkgLyAzMik7CgkgICAgICAgIHZhciBvbGRCaXRzTGVuID0gbGVuICsgMTsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2xkQml0c0xlbjsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgeCA9IGJpdHNbaV07CgkgICAgICAgICAgICB4ID0gKCh4ID4+IDEpICYgMHg1NTU1NTU1NSkgfCAoKHggJiAweDU1NTU1NTU1KSA8PCAxKTsKCSAgICAgICAgICAgIHggPSAoKHggPj4gMikgJiAweDMzMzMzMzMzKSB8ICgoeCAmIDB4MzMzMzMzMzMpIDw8IDIpOwoJICAgICAgICAgICAgeCA9ICgoeCA+PiA0KSAmIDB4MGYwZjBmMGYpIHwgKCh4ICYgMHgwZjBmMGYwZikgPDwgNCk7CgkgICAgICAgICAgICB4ID0gKCh4ID4+IDgpICYgMHgwMGZmMDBmZikgfCAoKHggJiAweDAwZmYwMGZmKSA8PCA4KTsKCSAgICAgICAgICAgIHggPSAoKHggPj4gMTYpICYgMHgwMDAwZmZmZikgfCAoKHggJiAweDAwMDBmZmZmKSA8PCAxNik7CgkgICAgICAgICAgICBuZXdCaXRzW2xlbiAtIGldID0gLyooaW50KSovIHg7CgkgICAgICAgIH0KCSAgICAgICAgLy8gbm93IGNvcnJlY3QgdGhlIGludCdzIGlmIHRoZSBiaXQgc2l6ZSBpc24ndCBhIG11bHRpcGxlIG9mIDMyCgkgICAgICAgIGlmICh0aGlzLnNpemUgIT09IG9sZEJpdHNMZW4gKiAzMikgewoJICAgICAgICAgICAgdmFyIGxlZnRPZmZzZXQgPSBvbGRCaXRzTGVuICogMzIgLSB0aGlzLnNpemU7CgkgICAgICAgICAgICB2YXIgY3VycmVudEludCA9IG5ld0JpdHNbMF0gPj4+IGxlZnRPZmZzZXQ7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IG9sZEJpdHNMZW47IGkrKykgewoJICAgICAgICAgICAgICAgIHZhciBuZXh0SW50ID0gbmV3Qml0c1tpXTsKCSAgICAgICAgICAgICAgICBjdXJyZW50SW50IHw9IG5leHRJbnQgPDwgKDMyIC0gbGVmdE9mZnNldCk7CgkgICAgICAgICAgICAgICAgbmV3Qml0c1tpIC0gMV0gPSBjdXJyZW50SW50OwoJICAgICAgICAgICAgICAgIGN1cnJlbnRJbnQgPSBuZXh0SW50ID4+PiBsZWZ0T2Zmc2V0OwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgbmV3Qml0c1tvbGRCaXRzTGVuIC0gMV0gPSBjdXJyZW50SW50OwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0cyA9IG5ld0JpdHM7CgkgICAgfTsKCSAgICBCaXRBcnJheS5tYWtlQXJyYXkgPSBmdW5jdGlvbiAoc2l6ZSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiBuZXcgSW50MzJBcnJheShNYXRoLmZsb29yKChzaXplICsgMzEpIC8gMzIpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG8pIHsKCSAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIEJpdEFycmF5KSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLnNpemUgPT09IG90aGVyLnNpemUgJiYgQXJyYXlzXzEkMS5kZWZhdWx0LmVxdWFscyh0aGlzLmJpdHMsIG90aGVyLmJpdHMpOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDMxICogdGhpcy5zaXplICsgQXJyYXlzXzEkMS5kZWZhdWx0Lmhhc2hDb2RlKHRoaXMuYml0cyk7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgcmVzdWx0ID0gJyc7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBzaXplID0gdGhpcy5zaXplOyBpIDwgc2l6ZTsgaSsrKSB7CgkgICAgICAgICAgICBpZiAoKGkgJiAweDA3KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnICc7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQgKz0gdGhpcy5nZXQoaSkgPyAnWCcgOiAnLic7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgQml0QXJyYXkodGhpcy5zaXplLCB0aGlzLmJpdHMuc2xpY2UoKSk7CgkgICAgfTsKCSAgICByZXR1cm4gQml0QXJyYXk7Cgl9KCkpOwoJQml0QXJyYXkkMS5kZWZhdWx0ID0gQml0QXJyYXk7CgoJdmFyIEJpdE1hdHJpeCQxID0ge307CgoJdmFyIFN0cmluZ0J1aWxkZXIkMSA9IHt9OwoKCXZhciBTdHJpbmdVdGlscyQxID0ge307CgoJdmFyIERlY29kZUhpbnRUeXBlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KERlY29kZUhpbnRUeXBlJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcgeyovCgkvKioKCSAqIEVuY2Fwc3VsYXRlcyBhIHR5cGUgb2YgaGludCB0aGF0IGEgY2FsbGVyIG1heSBwYXNzIHRvIGEgYmFyY29kZSByZWFkZXIgdG8gaGVscCBpdAoJICogbW9yZSBxdWlja2x5IG9yIGFjY3VyYXRlbHkgZGVjb2RlIGl0LiBJdCBpcyB1cCB0byBpbXBsZW1lbnRhdGlvbnMgdG8gZGVjaWRlIHdoYXQsCgkgKiBpZiBhbnl0aGluZywgdG8gZG8gd2l0aCB0aGUgaW5mb3JtYXRpb24gdGhhdCBpcyBzdXBwbGllZC4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBzZWUgUmVhZGVyI2RlY29kZShCaW5hcnlCaXRtYXAsamF2YS51dGlsLk1hcCkKCSAqLwoJdmFyIERlY29kZUhpbnRUeXBlOwoJKGZ1bmN0aW9uIChEZWNvZGVIaW50VHlwZSkgewoJICAgIC8qKgoJICAgICAqIFVuc3BlY2lmaWVkLCBhcHBsaWNhdGlvbi1zcGVjaWZpYyBoaW50LiBNYXBzIHRvIGFuIHVuc3BlY2lmaWVkIHtAbGluayBPYmplY3R9LgoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJPVEhFUiJdID0gMF0gPSAiT1RIRVIiOyAvKihPYmplY3QuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBJbWFnZSBpcyBhIHB1cmUgbW9ub2Nocm9tZSBpbWFnZSBvZiBhIGJhcmNvZGUuIERvZXNuJ3QgbWF0dGVyIHdoYXQgaXQgbWFwcyB0bzsKCSAgICAgKiB1c2Uge0BsaW5rIEJvb2xlYW4jVFJVRX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIlBVUkVfQkFSQ09ERSJdID0gMV0gPSAiUFVSRV9CQVJDT0RFIjsgLyooVm9pZC5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIEltYWdlIGlzIGtub3duIHRvIGJlIG9mIG9uZSBvZiBhIGZldyBwb3NzaWJsZSBmb3JtYXRzLgoJICAgICAqIE1hcHMgdG8gYSB7QGxpbmsgTGlzdH0gb2Yge0BsaW5rIEJhcmNvZGVGb3JtYXR9cy4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiUE9TU0lCTEVfRk9STUFUUyJdID0gMl0gPSAiUE9TU0lCTEVfRk9STUFUUyI7IC8qKExpc3QuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBTcGVuZCBtb3JlIHRpbWUgdG8gdHJ5IHRvIGZpbmQgYSBiYXJjb2RlOyBvcHRpbWl6ZSBmb3IgYWNjdXJhY3ksIG5vdCBzcGVlZC4KCSAgICAgKiBEb2Vzbid0IG1hdHRlciB3aGF0IGl0IG1hcHMgdG87IHVzZSB7QGxpbmsgQm9vbGVhbiNUUlVFfS4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiVFJZX0hBUkRFUiJdID0gM10gPSAiVFJZX0hBUkRFUiI7IC8qKFZvaWQuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBTcGVjaWZpZXMgd2hhdCBjaGFyYWN0ZXIgZW5jb2RpbmcgdG8gdXNlIHdoZW4gZGVjb2RpbmcsIHdoZXJlIGFwcGxpY2FibGUgKHR5cGUgU3RyaW5nKQoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJDSEFSQUNURVJfU0VUIl0gPSA0XSA9ICJDSEFSQUNURVJfU0VUIjsgLyooU3RyaW5nLmNsYXNzKSovCgkgICAgLyoqCgkgICAgICogQWxsb3dlZCBsZW5ndGhzIG9mIGVuY29kZWQgZGF0YSAtLSByZWplY3QgYW55dGhpbmcgZWxzZS4gTWFwcyB0byBhbiB7QGNvZGUgSW50MzJBcnJheX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIkFMTE9XRURfTEVOR1RIUyJdID0gNV0gPSAiQUxMT1dFRF9MRU5HVEhTIjsgLyooSW50MzJBcnJheS5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIEFzc3VtZSBDb2RlIDM5IGNvZGVzIGVtcGxveSBhIGNoZWNrIGRpZ2l0LiBEb2Vzbid0IG1hdHRlciB3aGF0IGl0IG1hcHMgdG87CgkgICAgICogdXNlIHtAbGluayBCb29sZWFuI1RSVUV9LgoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJBU1NVTUVfQ09ERV8zOV9DSEVDS19ESUdJVCJdID0gNl0gPSAiQVNTVU1FX0NPREVfMzlfQ0hFQ0tfRElHSVQiOyAvKihWb2lkLmNsYXNzKSovCgkgICAgLyoqCgkgICAgICogQXNzdW1lIHRoZSBiYXJjb2RlIGlzIGJlaW5nIHByb2Nlc3NlZCBhcyBhIEdTMSBiYXJjb2RlLCBhbmQgbW9kaWZ5IGJlaGF2aW9yIGFzIG5lZWRlZC4KCSAgICAgKiBGb3IgZXhhbXBsZSB0aGlzIGFmZmVjdHMgRk5DMSBoYW5kbGluZyBmb3IgQ29kZSAxMjggKGFrYSBHUzEtMTI4KS4gRG9lc24ndCBtYXR0ZXIgd2hhdCBpdCBtYXBzIHRvOwoJICAgICAqIHVzZSB7QGxpbmsgQm9vbGVhbiNUUlVFfS4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiQVNTVU1FX0dTMSJdID0gN10gPSAiQVNTVU1FX0dTMSI7IC8qKFZvaWQuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBJZiB0cnVlLCByZXR1cm4gdGhlIHN0YXJ0IGFuZCBlbmQgZGlnaXRzIGluIGEgQ29kYWJhciBiYXJjb2RlIGluc3RlYWQgb2Ygc3RyaXBwaW5nIHRoZW0uIFRoZXkKCSAgICAgKiBhcmUgYWxwaGEsIHdoZXJlYXMgdGhlIHJlc3QgYXJlIG51bWVyaWMuIEJ5IGRlZmF1bHQsIHRoZXkgYXJlIHN0cmlwcGVkLCBidXQgdGhpcyBjYXVzZXMgdGhlbQoJICAgICAqIHRvIG5vdCBiZS4gRG9lc24ndCBtYXR0ZXIgd2hhdCBpdCBtYXBzIHRvOyB1c2Uge0BsaW5rIEJvb2xlYW4jVFJVRX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIlJFVFVSTl9DT0RBQkFSX1NUQVJUX0VORCJdID0gOF0gPSAiUkVUVVJOX0NPREFCQVJfU1RBUlRfRU5EIjsgLyooVm9pZC5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIFRoZSBjYWxsZXIgbmVlZHMgdG8gYmUgbm90aWZpZWQgdmlhIGNhbGxiYWNrIHdoZW4gYSBwb3NzaWJsZSB7QGxpbmsgUmVzdWx0UG9pbnR9CgkgICAgICogaXMgZm91bmQuIE1hcHMgdG8gYSB7QGxpbmsgUmVzdWx0UG9pbnRDYWxsYmFja30uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIk5FRURfUkVTVUxUX1BPSU5UX0NBTExCQUNLIl0gPSA5XSA9ICJORUVEX1JFU1VMVF9QT0lOVF9DQUxMQkFDSyI7IC8qKFJlc3VsdFBvaW50Q2FsbGJhY2suY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBBbGxvd2VkIGV4dGVuc2lvbiBsZW5ndGhzIGZvciBFQU4gb3IgVVBDIGJhcmNvZGVzLiBPdGhlciBmb3JtYXRzIHdpbGwgaWdub3JlIHRoaXMuCgkgICAgICogTWFwcyB0byBhbiB7QGNvZGUgSW50MzJBcnJheX0gb2YgdGhlIGFsbG93ZWQgZXh0ZW5zaW9uIGxlbmd0aHMsIGZvciBleGFtcGxlIFsyXSwgWzVdLCBvciBbMiwgNV0uCgkgICAgICogSWYgaXQgaXMgb3B0aW9uYWwgdG8gaGF2ZSBhbiBleHRlbnNpb24sIGRvIG5vdCBzZXQgdGhpcyBoaW50LiBJZiB0aGlzIGlzIHNldCwKCSAgICAgKiBhbmQgYSBVUEMgb3IgRUFOIGJhcmNvZGUgaXMgZm91bmQgYnV0IGFuIGV4dGVuc2lvbiBpcyBub3QsIHRoZW4gbm8gcmVzdWx0IHdpbGwgYmUgcmV0dXJuZWQKCSAgICAgKiBhdCBhbGwuCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIkFMTE9XRURfRUFOX0VYVEVOU0lPTlMiXSA9IDEwXSA9ICJBTExPV0VEX0VBTl9FWFRFTlNJT05TIjsgLyooSW50MzJBcnJheS5jbGFzcykqLwoJICAgIC8vIEVuZCBvZiBlbnVtZXJhdGlvbiB2YWx1ZXMuCgkgICAgLyoqCgkgICAgICogRGF0YSB0eXBlIHRoZSBoaW50IGlzIGV4cGVjdGluZy4KCSAgICAgKiBBbW9uZyB0aGUgcG9zc2libGUgdmFsdWVzIHRoZSB7QGxpbmsgVm9pZH0gc3RhbmRzIG91dCBhcyBiZWluZyB1c2VkIGZvcgoJICAgICAqIGhpbnRzIHRoYXQgZG8gbm90IGV4cGVjdCBhIHZhbHVlIHRvIGJlIHN1cHBsaWVkIChmbGFnIGhpbnRzKS4gU3VjaCBoaW50cwoJICAgICAqIHdpbGwgcG9zc2libHkgaGF2ZSB0aGVpciB2YWx1ZSBpZ25vcmVkLCBvciByZXBsYWNlZCBieSBhCgkgICAgICoge0BsaW5rIEJvb2xlYW4jVFJVRX0uIEhpbnQgc3VwcGxpZXJzIHNob3VsZCBwcm9iYWJseSB1c2UKCSAgICAgKiB7QGxpbmsgQm9vbGVhbiNUUlVFfSBhcyBkaXJlY3RlZCBieSB0aGUgYWN0dWFsIGhpbnQgZG9jdW1lbnRhdGlvbi4KCSAgICAgKi8KCSAgICAvLyBwcml2YXRlIHZhbHVlVHlwZTogQ2xhc3M8Pz4KCSAgICAvLyBEZWNvZGVIaW50VHlwZSh2YWx1ZVR5cGU6IENsYXNzPD8+KSB7CgkgICAgLy8gICB0aGlzLnZhbHVlVHlwZSA9IHZhbHVlVHlwZQoJICAgIC8vIH0KCSAgICAvLyBwdWJsaWMgZ2V0VmFsdWVUeXBlKCk6IENsYXNzPD8+IHsKCSAgICAvLyAgIHJldHVybiB2YWx1ZVR5cGUKCSAgICAvLyB9Cgl9KShEZWNvZGVIaW50VHlwZSB8fCAoRGVjb2RlSGludFR5cGUgPSB7fSkpOwoJRGVjb2RlSGludFR5cGUkMS5kZWZhdWx0ID0gRGVjb2RlSGludFR5cGU7CgoJdmFyIENoYXJhY3RlclNldEVDSSA9IHt9OwoKCXZhciBGb3JtYXRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZiA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShGb3JtYXRFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDcgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgRm9ybWF0RXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyRmKEZvcm1hdEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBGb3JtYXRFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgRm9ybWF0RXhjZXB0aW9uLmdldEZvcm1hdEluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEZvcm1hdEV4Y2VwdGlvbigpOwoJICAgIH07CgkgICAgRm9ybWF0RXhjZXB0aW9uLmtpbmQgPSAnRm9ybWF0RXhjZXB0aW9uJzsKCSAgICByZXR1cm4gRm9ybWF0RXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQ3LmRlZmF1bHQpKTsKCUZvcm1hdEV4Y2VwdGlvbiQxLmRlZmF1bHQgPSBGb3JtYXRFeGNlcHRpb247CgoJKGZ1bmN0aW9uIChleHBvcnRzKSB7CgkvKgoJICogQ29weXJpZ2h0IDIwMDggWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCWV4cG9ydHMuQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycyA9IHZvaWQgMDsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xID0gRm9ybWF0RXhjZXB0aW9uJDE7CgkvKmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsqLwoJLyppbXBvcnQgamF2YS51dGlsLk1hcDsqLwoJdmFyIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnM7CgkoZnVuY3Rpb24gKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMpIHsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkNwNDM3Il0gPSAwXSA9ICJDcDQzNyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEiXSA9IDFdID0gIklTTzg4NTlfMSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzIiXSA9IDJdID0gIklTTzg4NTlfMiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzMiXSA9IDNdID0gIklTTzg4NTlfMyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzQiXSA9IDRdID0gIklTTzg4NTlfNCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzUiXSA9IDVdID0gIklTTzg4NTlfNSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzYiXSA9IDZdID0gIklTTzg4NTlfNiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzciXSA9IDddID0gIklTTzg4NTlfNyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzgiXSA9IDhdID0gIklTTzg4NTlfOCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzkiXSA9IDldID0gIklTTzg4NTlfOSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEwIl0gPSAxMF0gPSAiSVNPODg1OV8xMCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzExIl0gPSAxMV0gPSAiSVNPODg1OV8xMSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEzIl0gPSAxMl0gPSAiSVNPODg1OV8xMyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE0Il0gPSAxM10gPSAiSVNPODg1OV8xNCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE1Il0gPSAxNF0gPSAiSVNPODg1OV8xNSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE2Il0gPSAxNV0gPSAiSVNPODg1OV8xNiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJTSklTIl0gPSAxNl0gPSAiU0pJUyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJDcDEyNTAiXSA9IDE3XSA9ICJDcDEyNTAiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siQ3AxMjUxIl0gPSAxOF0gPSAiQ3AxMjUxIjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkNwMTI1MiJdID0gMTldID0gIkNwMTI1MiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJDcDEyNTYiXSA9IDIwXSA9ICJDcDEyNTYiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siVW5pY29kZUJpZ1VubWFya2VkIl0gPSAyMV0gPSAiVW5pY29kZUJpZ1VubWFya2VkIjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIlVURjgiXSA9IDIyXSA9ICJVVEY4IjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkFTQ0lJIl0gPSAyM10gPSAiQVNDSUkiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siQmlnNSJdID0gMjRdID0gIkJpZzUiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siR0IxODAzMCJdID0gMjVdID0gIkdCMTgwMzAiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siRVVDX0tSIl0gPSAyNl0gPSAiRVVDX0tSIjsKCX0pKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMgPSBleHBvcnRzLkNoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMgfHwgKGV4cG9ydHMuQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycyA9IHt9KSk7CgkvKioKCSAqIEVuY2Fwc3VsYXRlcyBhIENoYXJhY3RlciBTZXQgRUNJLCBhY2NvcmRpbmcgdG8gIkV4dGVuZGVkIENoYW5uZWwgSW50ZXJwcmV0YXRpb25zIiA1LjMuMS4xCgkgKiBvZiBJU08gMTgwMDQuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIENoYXJhY3RlclNldEVDSSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBDaGFyYWN0ZXJTZXRFQ0kodmFsdWVJZGVudGlmaWVyLCB2YWx1ZXNQYXJhbSwgbmFtZSkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIG90aGVyRW5jb2RpbmdOYW1lcyA9IFtdOwoJICAgICAgICBmb3IgKHZhciBfaSA9IDM7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJICAgICAgICAgICAgb3RoZXJFbmNvZGluZ05hbWVzW19pIC0gM10gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMudmFsdWVJZGVudGlmaWVyID0gdmFsdWVJZGVudGlmaWVyOwoJICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOwoJICAgICAgICBpZiAodHlwZW9mIHZhbHVlc1BhcmFtID09PSAnbnVtYmVyJykgewoJICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSBJbnQzMkFycmF5LmZyb20oW3ZhbHVlc1BhcmFtXSk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICB0aGlzLnZhbHVlcyA9IHZhbHVlc1BhcmFtOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMub3RoZXJFbmNvZGluZ05hbWVzID0gb3RoZXJFbmNvZGluZ05hbWVzOwoJICAgICAgICBDaGFyYWN0ZXJTZXRFQ0kuVkFMVUVfSURFTlRJRklFUl9UT19FQ0kuc2V0KHZhbHVlSWRlbnRpZmllciwgdGhpcyk7CgkgICAgICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSS5zZXQobmFtZSwgdGhpcyk7CgkgICAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLnZhbHVlczsKCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gdmFsdWVzLmxlbmd0aDsgaSAhPT0gbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgdmFyIHYgPSB2YWx1ZXNbaV07CgkgICAgICAgICAgICBDaGFyYWN0ZXJTZXRFQ0kuVkFMVUVTX1RPX0VDSS5zZXQodiwgdGhpcyk7CgkgICAgICAgIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIG90aGVyRW5jb2RpbmdOYW1lc18xID0gX192YWx1ZXMob3RoZXJFbmNvZGluZ05hbWVzKSwgb3RoZXJFbmNvZGluZ05hbWVzXzFfMSA9IG90aGVyRW5jb2RpbmdOYW1lc18xLm5leHQoKTsgIW90aGVyRW5jb2RpbmdOYW1lc18xXzEuZG9uZTsgb3RoZXJFbmNvZGluZ05hbWVzXzFfMSA9IG90aGVyRW5jb2RpbmdOYW1lc18xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgIHZhciBvdGhlck5hbWUgPSBvdGhlckVuY29kaW5nTmFtZXNfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSS5zZXQob3RoZXJOYW1lLCB0aGlzKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKG90aGVyRW5jb2RpbmdOYW1lc18xXzEgJiYgIW90aGVyRW5jb2RpbmdOYW1lc18xXzEuZG9uZSAmJiAoX2EgPSBvdGhlckVuY29kaW5nTmFtZXNfMS5yZXR1cm4pKSBfYS5jYWxsKG90aGVyRW5jb2RpbmdOYW1lc18xKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgIH0KCSAgICAvLyBDaGFyYWN0ZXJTZXRFQ0kodmFsdWU6IG51bWJlciAvKmludCovKSB7CgkgICAgLy8gICB0aGlzKG5ldyBJbnQzMkFycmF5IHt2YWx1ZX0pCgkgICAgLy8gfQoJICAgIC8vIENoYXJhY3RlclNldEVDSSh2YWx1ZTogbnVtYmVyIC8qaW50Ki8sIFN0cmluZy4uLiBvdGhlckVuY29kaW5nTmFtZXMpIHsKCSAgICAvLyAgIHRoaXMudmFsdWVzID0gbmV3IEludDMyQXJyYXkge3ZhbHVlfQoJICAgIC8vICAgdGhpcy5vdGhlckVuY29kaW5nTmFtZXMgPSBvdGhlckVuY29kaW5nTmFtZXMKCSAgICAvLyB9CgkgICAgLy8gQ2hhcmFjdGVyU2V0RUNJKHZhbHVlczogSW50MzJBcnJheSwgU3RyaW5nLi4uIG90aGVyRW5jb2RpbmdOYW1lcykgewoJICAgIC8vICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXMKCSAgICAvLyAgIHRoaXMub3RoZXJFbmNvZGluZ05hbWVzID0gb3RoZXJFbmNvZGluZ05hbWVzCgkgICAgLy8gfQoJICAgIENoYXJhY3RlclNldEVDSS5wcm90b3R5cGUuZ2V0VmFsdWVJZGVudGlmaWVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZUlkZW50aWZpZXI7CgkgICAgfTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kucHJvdG90eXBlLmdldE5hbWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm5hbWU7CgkgICAgfTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZXNbMF07CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gdmFsdWUgY2hhcmFjdGVyIHNldCBFQ0kgdmFsdWUKCSAgICAgKiBAcmV0dXJuIHtAY29kZSBDaGFyYWN0ZXJTZXRFQ0l9IHJlcHJlc2VudGluZyBFQ0kgb2YgZ2l2ZW4gdmFsdWUsIG9yIG51bGwgaWYgaXQgaXMgbGVnYWwgYnV0CgkgICAgICogICB1bnN1cHBvcnRlZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIEVDSSB2YWx1ZSBpcyBpbnZhbGlkCgkgICAgICovCgkgICAgQ2hhcmFjdGVyU2V0RUNJLmdldENoYXJhY3RlclNldEVDSUJ5VmFsdWUgPSBmdW5jdGlvbiAodmFsdWUgLyppbnQqLykgewoJICAgICAgICBpZiAodmFsdWUgPCAwIHx8IHZhbHVlID49IDkwMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoJ2luY29yZWN0IHZhbHVlJyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGNoYXJhY3RlclNldCA9IENoYXJhY3RlclNldEVDSS5WQUxVRVNfVE9fRUNJLmdldCh2YWx1ZSk7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGNoYXJhY3RlclNldCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoJ2luY29yZWN0IHZhbHVlJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGNoYXJhY3RlclNldDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBuYW1lIGNoYXJhY3RlciBzZXQgRUNJIGVuY29kaW5nIG5hbWUKCSAgICAgKiBAcmV0dXJuIENoYXJhY3RlclNldEVDSSByZXByZXNlbnRpbmcgRUNJIGZvciBjaGFyYWN0ZXIgZW5jb2RpbmcsIG9yIG51bGwgaWYgaXQgaXMgbGVnYWwKCSAgICAgKiAgIGJ1dCB1bnN1cHBvcnRlZAoJICAgICAqLwoJICAgIENoYXJhY3RlclNldEVDSS5nZXRDaGFyYWN0ZXJTZXRFQ0lCeU5hbWUgPSBmdW5jdGlvbiAobmFtZSkgewoJICAgICAgICB2YXIgY2hhcmFjdGVyU2V0ID0gQ2hhcmFjdGVyU2V0RUNJLk5BTUVfVE9fRUNJLmdldChuYW1lKTsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gY2hhcmFjdGVyU2V0KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgnaW5jb3JlY3QgdmFsdWUnKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gY2hhcmFjdGVyU2V0OwoJICAgIH07CgkgICAgQ2hhcmFjdGVyU2V0RUNJLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgQ2hhcmFjdGVyU2V0RUNJKSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLmdldE5hbWUoKSA9PT0gb3RoZXIuZ2V0TmFtZSgpOwoJICAgIH07CgkgICAgQ2hhcmFjdGVyU2V0RUNJLlZBTFVFX0lERU5USUZJRVJfVE9fRUNJID0gbmV3IE1hcCgpOwoJICAgIENoYXJhY3RlclNldEVDSS5WQUxVRVNfVE9fRUNJID0gbmV3IE1hcCgpOwoJICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSSA9IG5ldyBNYXAoKTsKCSAgICAvLyBFbnVtIG5hbWUgaXMgYSBKYXZhIGVuY29kaW5nIHZhbGlkIGZvciBqYXZhLmxhbmcgYW5kIGphdmEuaW8KCSAgICAvLyBUWVBFU0NSSVBUUE9SVDogY2hhbmdlZCB0aGUgbWFpbiBsYWJlbCBmb3IgSVNPIGFzIHRoZSBUZXh0RW5jb2RlciBkaWQgbm90IHJlY29nbml6ZWQgdGhlbSBpbiB0aGUgZm9ybSBmcm9tIGphdmEKCSAgICAvLyAoZWcgSVNPODg1OV8xIG11c3QgYmUgSVNPODg1OTEgb3IgSVNPODg1OS0xIG9yIElTTy04ODU5LTEpCgkgICAgLy8gbGF0ZXIgb246IHdlbGwsIGV4Y2VwdCAxNiB3aWNoIGRvZXMgbm90IHdvcmsgd2l0aCBJU084ODU5MTYgc28gdXNlZCBJU08tODg1OS0xIGZvcm0gZm9yIGRlZmF1bHQKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuQ3A0MzcgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQ3A0MzcsIEludDMyQXJyYXkuZnJvbShbMCwgMl0pLCAnQ3A0MzcnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMSwgSW50MzJBcnJheS5mcm9tKFsxLCAzXSksICdJU08tODg1OS0xJywgJ0lTTzg4NTkxJywgJ0lTTzg4NTlfMScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzIgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8yLCA0LCAnSVNPLTg4NTktMicsICdJU084ODU5MicsICdJU084ODU5XzInKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8zID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMywgNSwgJ0lTTy04ODU5LTMnLCAnSVNPODg1OTMnLCAnSVNPODg1OV8zJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfNCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzQsIDYsICdJU08tODg1OS00JywgJ0lTTzg4NTk0JywgJ0lTTzg4NTlfNCcpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV81LCA3LCAnSVNPLTg4NTktNScsICdJU084ODU5NScsICdJU084ODU5XzUnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV82ID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfNiwgOCwgJ0lTTy04ODU5LTYnLCAnSVNPODg1OTYnLCAnSVNPODg1OV82Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfNyA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzcsIDksICdJU08tODg1OS03JywgJ0lTTzg4NTk3JywgJ0lTTzg4NTlfNycpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzggPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV84LCAxMCwgJ0lTTy04ODU5LTgnLCAnSVNPODg1OTgnLCAnSVNPODg1OV84Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfOSA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzksIDExLCAnSVNPLTg4NTktOScsICdJU084ODU5OScsICdJU084ODU5XzknKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xMCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzEwLCAxMiwgJ0lTTy04ODU5LTEwJywgJ0lTTzg4NTkxMCcsICdJU084ODU5XzEwJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfMTEgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8xMSwgMTMsICdJU08tODg1OS0xMScsICdJU084ODU5MTEnLCAnSVNPODg1OV8xMScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzEzID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMTMsIDE1LCAnSVNPLTg4NTktMTMnLCAnSVNPODg1OTEzJywgJ0lTTzg4NTlfMTMnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xNCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzE0LCAxNiwgJ0lTTy04ODU5LTE0JywgJ0lTTzg4NTkxNCcsICdJU084ODU5XzE0Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfMTUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8xNSwgMTcsICdJU08tODg1OS0xNScsICdJU084ODU5MTUnLCAnSVNPODg1OV8xNScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzE2ID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMTYsIDE4LCAnSVNPLTg4NTktMTYnLCAnSVNPODg1OTE2JywgJ0lTTzg4NTlfMTYnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuU0pJUyA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5TSklTLCAyMCwgJ1NKSVMnLCAnU2hpZnRfSklTJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkNwMTI1MCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5DcDEyNTAsIDIxLCAnQ3AxMjUwJywgJ3dpbmRvd3MtMTI1MCcpOwoJICAgIENoYXJhY3RlclNldEVDSS5DcDEyNTEgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQ3AxMjUxLCAyMiwgJ0NwMTI1MScsICd3aW5kb3dzLTEyNTEnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuQ3AxMjUyID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLkNwMTI1MiwgMjMsICdDcDEyNTInLCAnd2luZG93cy0xMjUyJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkNwMTI1NiA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5DcDEyNTYsIDI0LCAnQ3AxMjU2JywgJ3dpbmRvd3MtMTI1NicpOwoJICAgIENoYXJhY3RlclNldEVDSS5Vbmljb2RlQmlnVW5tYXJrZWQgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuVW5pY29kZUJpZ1VubWFya2VkLCAyNSwgJ1VuaWNvZGVCaWdVbm1hcmtlZCcsICdVVEYtMTZCRScsICdVbmljb2RlQmlnJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLlVURjggPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuVVRGOCwgMjYsICdVVEY4JywgJ1VURi04Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkFTQ0lJID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLkFTQ0lJLCBJbnQzMkFycmF5LmZyb20oWzI3LCAxNzBdKSwgJ0FTQ0lJJywgJ1VTLUFTQ0lJJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkJpZzUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQmlnNSwgMjgsICdCaWc1Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkdCMTgwMzAgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuR0IxODAzMCwgMjksICdHQjE4MDMwJywgJ0dCMjMxMicsICdFVUNfQ04nLCAnR0JLJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkVVQ19LUiA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5FVUNfS1IsIDMwLCAnRVVDX0tSJywgJ0VVQy1LUicpOwoJICAgIHJldHVybiBDaGFyYWN0ZXJTZXRFQ0k7Cgl9KCkpOwoJZXhwb3J0cy5kZWZhdWx0ID0gQ2hhcmFjdGVyU2V0RUNJOwoKCX0oQ2hhcmFjdGVyU2V0RUNJKSk7CgoJdmFyIFN0cmluZ0VuY29kaW5nJDEgPSB7fTsKCgl2YXIgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNiA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZShVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbi5raW5kID0gJ1Vuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDYuZGVmYXVsdCkpOwoJVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24kMS5kZWZhdWx0ID0gVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb247CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZ0VuY29kaW5nJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbl8xJDEgPSBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiQxOwoJdmFyIENoYXJhY3RlclNldEVDSV8xJDIgPSBDaGFyYWN0ZXJTZXRFQ0k7CgkvKioKCSAqIFJlc3BvbnNpYmxlIGZvciBlbi9kZWNvZGluZyBzdHJpbmdzLgoJICovCgl2YXIgU3RyaW5nRW5jb2RpbmcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nRW5jb2RpbmcoKSB7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIERlY29kZXMgc29tZSBVaW50OEFycmF5IHRvIGEgc3RyaW5nIGZvcm1hdC4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5kZWNvZGUgPSBmdW5jdGlvbiAoYnl0ZXMsIGVuY29kaW5nKSB7CgkgICAgICAgIHZhciBlbmNvZGluZ05hbWUgPSB0aGlzLmVuY29kaW5nTmFtZShlbmNvZGluZyk7CgkgICAgICAgIGlmICh0aGlzLmN1c3RvbURlY29kZXIpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmN1c3RvbURlY29kZXIoYnl0ZXMsIGVuY29kaW5nTmFtZSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gSW5jcmVhc2VzIGJyb3dzZXIgc3VwcG9ydC4KCSAgICAgICAgaWYgKHR5cGVvZiBUZXh0RGVjb2RlciA9PT0gJ3VuZGVmaW5lZCcgfHwgdGhpcy5zaG91bGREZWNvZGVPbkZhbGxiYWNrKGVuY29kaW5nTmFtZSkpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUZhbGxiYWNrKGJ5dGVzLCBlbmNvZGluZ05hbWUpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgVGV4dERlY29kZXIoZW5jb2RpbmdOYW1lKS5kZWNvZGUoYnl0ZXMpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ2hlY2tzIGlmIHRoZSBkZWNvZGluZyBtZXRob2Qgc2hvdWxkIHVzZSB0aGUgZmFsbGJhY2sgZm9yIGRlY29kaW5nCgkgICAgICogb25jZSBOb2RlIFRleHREZWNvZGVyIGRvZXNuJ3Qgc3VwcG9ydCBhbGwgZW5jb2RpbmcgZm9ybWF0cy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBlbmNvZGluZ05hbWUKCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5zaG91bGREZWNvZGVPbkZhbGxiYWNrID0gZnVuY3Rpb24gKGVuY29kaW5nTmFtZSkgewoJICAgICAgICByZXR1cm4gIVN0cmluZ0VuY29kaW5nLmlzQnJvd3NlcigpICYmIGVuY29kaW5nTmFtZSA9PT0gJ0lTTy04ODU5LTEnOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRW5jb2RlcyBzb21lIHN0cmluZyBpbnRvIGEgVWludDhBcnJheS4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5lbmNvZGUgPSBmdW5jdGlvbiAocywgZW5jb2RpbmcpIHsKCSAgICAgICAgdmFyIGVuY29kaW5nTmFtZSA9IHRoaXMuZW5jb2RpbmdOYW1lKGVuY29kaW5nKTsKCSAgICAgICAgaWYgKHRoaXMuY3VzdG9tRW5jb2RlcikgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tRW5jb2RlcihzLCBlbmNvZGluZ05hbWUpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEluY3JlYXNlcyBicm93c2VyIHN1cHBvcnQuCgkgICAgICAgIGlmICh0eXBlb2YgVGV4dEVuY29kZXIgPT09ICd1bmRlZmluZWQnKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5lbmNvZGVGYWxsYmFjayhzKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBUZXh0RW5jb2RlciBvbmx5IGVuY29kZXMgdG8gVVRGOCBieSBkZWZhdWx0IGFzIHNwZWNpZmllZCBieSBlbmNvZGluZy5zcGVjLndoYXR3Zy5vcmcKCSAgICAgICAgcmV0dXJuIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShzKTsKCSAgICB9OwoJICAgIFN0cmluZ0VuY29kaW5nLmlzQnJvd3NlciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB7fS50b1N0cmluZy5jYWxsKHdpbmRvdykgPT09ICdbb2JqZWN0IFdpbmRvd10nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIHN0cmluZyB2YWx1ZSBmcm9tIHNvbWUgZW5jb2RpbmcgY2hhcmFjdGVyIHNldC4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5lbmNvZGluZ05hbWUgPSBmdW5jdGlvbiAoZW5jb2RpbmcpIHsKCSAgICAgICAgcmV0dXJuIHR5cGVvZiBlbmNvZGluZyA9PT0gJ3N0cmluZycKCSAgICAgICAgICAgID8gZW5jb2RpbmcKCSAgICAgICAgICAgIDogZW5jb2RpbmcuZ2V0TmFtZSgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV0dXJucyBjaGFyYWN0ZXIgc2V0IGZyb20gc29tZSBlbmNvZGluZyBjaGFyYWN0ZXIgc2V0LgoJICAgICAqLwoJICAgIFN0cmluZ0VuY29kaW5nLmVuY29kaW5nQ2hhcmFjdGVyU2V0ID0gZnVuY3Rpb24gKGVuY29kaW5nKSB7CgkgICAgICAgIGlmIChlbmNvZGluZyBpbnN0YW5jZW9mIENoYXJhY3RlclNldEVDSV8xJDIuZGVmYXVsdCkgewoJICAgICAgICAgICAgcmV0dXJuIGVuY29kaW5nOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuZ2V0Q2hhcmFjdGVyU2V0RUNJQnlOYW1lKGVuY29kaW5nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJ1bnMgYSBmYWxsYmFjayBmb3IgdGhlIG5hdGl2ZSBkZWNvZGluZyBmdW5jaW9uLgoJICAgICAqLwoJICAgIFN0cmluZ0VuY29kaW5nLmRlY29kZUZhbGxiYWNrID0gZnVuY3Rpb24gKGJ5dGVzLCBlbmNvZGluZykgewoJICAgICAgICB2YXIgY2hhcmFjdGVyU2V0ID0gdGhpcy5lbmNvZGluZ0NoYXJhY3RlclNldChlbmNvZGluZyk7CgkgICAgICAgIGlmIChTdHJpbmdFbmNvZGluZy5pc0RlY29kZUZhbGxiYWNrU3VwcG9ydGVkKGNoYXJhY3RlclNldCkpIHsKCSAgICAgICAgICAgIHZhciBzID0gJyc7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoXzEgPSBieXRlcy5sZW5ndGg7IGkgPCBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGggPSBieXRlc1tpXS50b1N0cmluZygxNik7CgkgICAgICAgICAgICAgICAgaWYgKGgubGVuZ3RoIDwgMikgewoJICAgICAgICAgICAgICAgICAgICBoID0gJzAnICsgaDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcyArPSAnJScgKyBoOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChzKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuVW5pY29kZUJpZ1VubWFya2VkKSkgewoJICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgbmV3IFVpbnQxNkFycmF5KGJ5dGVzLmJ1ZmZlcikpOwoJICAgICAgICB9CgkgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgiRW5jb2RpbmcgIiArIHRoaXMuZW5jb2RpbmdOYW1lKGVuY29kaW5nKSArICIgbm90IHN1cHBvcnRlZCBieSBmYWxsYmFjay4iKTsKCSAgICB9OwoJICAgIFN0cmluZ0VuY29kaW5nLmlzRGVjb2RlRmFsbGJhY2tTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoY2hhcmFjdGVyU2V0KSB7CgkgICAgICAgIHJldHVybiBjaGFyYWN0ZXJTZXQuZXF1YWxzKENoYXJhY3RlclNldEVDSV8xJDIuZGVmYXVsdC5VVEY4KSB8fAoJICAgICAgICAgICAgY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuSVNPODg1OV8xKSB8fAoJICAgICAgICAgICAgY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuQVNDSUkpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUnVucyBhIGZhbGxiYWNrIGZvciB0aGUgbmF0aXZlIGVuY29kaW5nIGZ1bmNpb24uCgkgICAgICoKCSAgICAgKiBAc2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xNzE5Mjg0NS80MzY3NjgzCgkgICAgICovCgkgICAgU3RyaW5nRW5jb2RpbmcuZW5jb2RlRmFsbGJhY2sgPSBmdW5jdGlvbiAocykgewoJICAgICAgICB2YXIgZW5jb2RlZFVSSXN0cmluZyA9IGJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHMpKSk7CgkgICAgICAgIHZhciBjaGFyTGlzdCA9IGVuY29kZWRVUklzdHJpbmcuc3BsaXQoJycpOwoJICAgICAgICB2YXIgdWludEFycmF5ID0gW107CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhckxpc3QubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHVpbnRBcnJheS5wdXNoKGNoYXJMaXN0W2ldLmNoYXJDb2RlQXQoMCkpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSh1aW50QXJyYXkpOwoJICAgIH07CgkgICAgcmV0dXJuIFN0cmluZ0VuY29kaW5nOwoJfSgpKTsKCVN0cmluZ0VuY29kaW5nJDEuZGVmYXVsdCA9IFN0cmluZ0VuY29kaW5nOwoKCS8qCgkgKiBDb3B5cmlnaHQgKEMpIDIwMTAgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZ1V0aWxzJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS5uaW8uY2hhcnNldC5DaGFyc2V0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgl2YXIgRGVjb2RlSGludFR5cGVfMSQzID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBDaGFyYWN0ZXJTZXRFQ0lfMSQxID0gQ2hhcmFjdGVyU2V0RUNJOwoJdmFyIFN0cmluZ0VuY29kaW5nXzEkMSA9IFN0cmluZ0VuY29kaW5nJDE7CgkvKioKCSAqIENvbW1vbiBzdHJpbmctcmVsYXRlZCBmdW5jdGlvbnMuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBhdXRob3IgQWxleCBEdXByZQoJICovCgl2YXIgU3RyaW5nVXRpbHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nVXRpbHMoKSB7CgkgICAgfQoJICAgIC8vIFNISUZUX0pJUy5lcXVhbHNJZ25vcmVDYXNlKFBMQVRGT1JNX0RFRkFVTFRfRU5DT0RJTkcpIHx8CgkgICAgLy8gRVVDX0pQLmVxdWFsc0lnbm9yZUNhc2UoUExBVEZPUk1fREVGQVVMVF9FTkNPRElORyk7CgkgICAgU3RyaW5nVXRpbHMuY2FzdEFzTm9uVXRmOENoYXIgPSBmdW5jdGlvbiAoY29kZSwgZW5jb2RpbmcpIHsKCSAgICAgICAgaWYgKGVuY29kaW5nID09PSB2b2lkIDApIHsgZW5jb2RpbmcgPSBudWxsOyB9CgkgICAgICAgIC8vIElTTyA4ODU5LTEgaXMgdGhlIEphdmEgZGVmYXVsdCBhcyBVVEYtOCBpcyBKYXZhU2NyaXB0cwoJICAgICAgICAvLyB5b3UgY2FuIHNlZSB0aGlzIG1ldGhvZCBhcyBhIEphdmEgdmVyc2lvbiBvZiBTdHJpbmcuZnJvbUNoYXJDb2RlCgkgICAgICAgIHZhciBlID0gZW5jb2RpbmcgPyBlbmNvZGluZy5nZXROYW1lKCkgOiB0aGlzLklTTzg4NTkxOwoJICAgICAgICAvLyB1c2UgcGFzc2VkIGZvcm1hdCAoZnJvbUNoYXJDb2RlIHdpbGwgcmV0dXJuIFVURjggZW5jb2RpbmcpCgkgICAgICAgIHJldHVybiBTdHJpbmdFbmNvZGluZ18xJDEuZGVmYXVsdC5kZWNvZGUobmV3IFVpbnQ4QXJyYXkoW2NvZGVdKSwgZSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYnl0ZXMgYnl0ZXMgZW5jb2RpbmcgYSBzdHJpbmcsIHdob3NlIGVuY29kaW5nIHNob3VsZCBiZSBndWVzc2VkCgkgICAgICogQHBhcmFtIGhpbnRzIGRlY29kZSBoaW50cyBpZiBhcHBsaWNhYmxlCgkgICAgICogQHJldHVybiBuYW1lIG9mIGd1ZXNzZWQgZW5jb2Rpbmc7IGF0IHRoZSBtb21lbnQgd2lsbCBvbmx5IGd1ZXNzIG9uZSBvZjoKCSAgICAgKiAge0BsaW5rICNTSElGVF9KSVN9LCB7QGxpbmsgI1VURjh9LCB7QGxpbmsgI0lTTzg4NTkxfSwgb3IgdGhlIHBsYXRmb3JtCgkgICAgICogIGRlZmF1bHQgZW5jb2RpbmcgaWYgbm9uZSBvZiB0aGVzZSBjYW4gcG9zc2libHkgYmUgY29ycmVjdAoJICAgICAqLwoJICAgIFN0cmluZ1V0aWxzLmd1ZXNzRW5jb2RpbmcgPSBmdW5jdGlvbiAoYnl0ZXMsIGhpbnRzKSB7CgkgICAgICAgIGlmIChoaW50cyAhPT0gbnVsbCAmJiBoaW50cyAhPT0gdW5kZWZpbmVkICYmIHVuZGVmaW5lZCAhPT0gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEkMy5kZWZhdWx0LkNIQVJBQ1RFUl9TRVQpKSB7CgkgICAgICAgICAgICByZXR1cm4gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEkMy5kZWZhdWx0LkNIQVJBQ1RFUl9TRVQpLnRvU3RyaW5nKCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRm9yIG5vdywgbWVyZWx5IHRyaWVzIHRvIGRpc3Rpbmd1aXNoIElTTy04ODU5LTEsIFVURi04IGFuZCBTaGlmdF9KSVMsCgkgICAgICAgIC8vIHdoaWNoIHNob3VsZCBiZSBieSBmYXIgdGhlIG1vc3QgY29tbW9uIGVuY29kaW5ncy4KCSAgICAgICAgdmFyIGxlbmd0aCA9IGJ5dGVzLmxlbmd0aDsKCSAgICAgICAgdmFyIGNhbkJlSVNPODg1OTEgPSB0cnVlOwoJICAgICAgICB2YXIgY2FuQmVTaGlmdEpJUyA9IHRydWU7CgkgICAgICAgIHZhciBjYW5CZVVURjggPSB0cnVlOwoJICAgICAgICB2YXIgdXRmOEJ5dGVzTGVmdCA9IDA7CgkgICAgICAgIC8vIGludCB1dGY4TG93Q2hhcnMgPSAwCgkgICAgICAgIHZhciB1dGYyQnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciB1dGYzQnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciB1dGY0Qnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciBzamlzQnl0ZXNMZWZ0ID0gMDsKCSAgICAgICAgLy8gaW50IHNqaXNMb3dDaGFycyA9IDAKCSAgICAgICAgdmFyIHNqaXNLYXRha2FuYUNoYXJzID0gMDsKCSAgICAgICAgLy8gaW50IHNqaXNEb3VibGVCeXRlc0NoYXJzID0gMAoJICAgICAgICB2YXIgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgIHZhciBzamlzQ3VyRG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gMDsKCSAgICAgICAgdmFyIHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPSAwOwoJICAgICAgICB2YXIgc2ppc01heERvdWJsZUJ5dGVzV29yZExlbmd0aCA9IDA7CgkgICAgICAgIC8vIGludCBpc29Mb3dDaGFycyA9IDAKCSAgICAgICAgLy8gaW50IGlzb0hpZ2hDaGFycyA9IDAKCSAgICAgICAgdmFyIGlzb0hpZ2hPdGhlciA9IDA7CgkgICAgICAgIHZhciB1dGY4Ym9tID0gYnl0ZXMubGVuZ3RoID4gMyAmJgoJICAgICAgICAgICAgYnl0ZXNbMF0gPT09IC8qKGJ5dGUpICovIDB4RUYgJiYKCSAgICAgICAgICAgIGJ5dGVzWzFdID09PSAvKihieXRlKSAqLyAweEJCICYmCgkgICAgICAgICAgICBieXRlc1syXSA9PT0gLyooYnl0ZSkgKi8gMHhCRjsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGggJiYgKGNhbkJlSVNPODg1OTEgfHwgY2FuQmVTaGlmdEpJUyB8fCBjYW5CZVVURjgpOyBpKyspIHsKCSAgICAgICAgICAgIHZhciB2YWx1ZSA9IGJ5dGVzW2ldICYgMHhGRjsKCSAgICAgICAgICAgIC8vIFVURi04IHN0dWZmCgkgICAgICAgICAgICBpZiAoY2FuQmVVVEY4KSB7CgkgICAgICAgICAgICAgICAgaWYgKHV0ZjhCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDgwKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgY2FuQmVVVEY4ID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0LS07CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAoKHZhbHVlICYgMHg4MCkgIT09IDApIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCh2YWx1ZSAmIDB4NDApID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjYW5CZVVURjggPSBmYWxzZTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjhCeXRlc0xlZnQrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDIwKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjJCeXRlc0NoYXJzKys7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh2YWx1ZSAmIDB4MTApID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjNCeXRlc0NoYXJzKys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDA4KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRmNEJ5dGVzQ2hhcnMrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbkJlVVRGOCA9IGZhbHNlOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfSAvLyBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyB1dGY4TG93Q2hhcnMrKwoJICAgICAgICAgICAgICAgIC8vIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIElTTy04ODU5LTEgc3R1ZmYKCSAgICAgICAgICAgIGlmIChjYW5CZUlTTzg4NTkxKSB7CgkgICAgICAgICAgICAgICAgaWYgKHZhbHVlID4gMHg3RiAmJiB2YWx1ZSA8IDB4QTApIHsKCSAgICAgICAgICAgICAgICAgICAgY2FuQmVJU084ODU5MSA9IGZhbHNlOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSA+IDB4OUYpIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlIDwgMHhDMCB8fCB2YWx1ZSA9PT0gMHhENyB8fCB2YWx1ZSA9PT0gMHhGNykgewoJICAgICAgICAgICAgICAgICAgICAgICAgaXNvSGlnaE90aGVyKys7CgkgICAgICAgICAgICAgICAgICAgIH0gLy8gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIGlzb0hpZ2hDaGFycysrCgkgICAgICAgICAgICAgICAgICAgIC8vIH0KCSAgICAgICAgICAgICAgICB9IC8vIGVsc2UgewoJICAgICAgICAgICAgICAgIC8vIGlzb0xvd0NoYXJzKysKCSAgICAgICAgICAgICAgICAvLyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBTaGlmdF9KSVMgc3R1ZmYKCSAgICAgICAgICAgIGlmIChjYW5CZVNoaWZ0SklTKSB7CgkgICAgICAgICAgICAgICAgaWYgKHNqaXNCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8IDB4NDAgfHwgdmFsdWUgPT09IDB4N0YgfHwgdmFsdWUgPiAweEZDKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjYW5CZVNoaWZ0SklTID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzamlzQnl0ZXNMZWZ0LS07CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPT09IDB4ODAgfHwgdmFsdWUgPT09IDB4QTAgfHwgdmFsdWUgPiAweEVGKSB7CgkgICAgICAgICAgICAgICAgICAgIGNhbkJlU2hpZnRKSVMgPSBmYWxzZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPiAweEEwICYmIHZhbHVlIDwgMHhFMCkgewoJICAgICAgICAgICAgICAgICAgICBzamlzS2F0YWthbmFDaGFycysrOwoJICAgICAgICAgICAgICAgICAgICBzamlzQ3VyRG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gMDsKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCsrOwoJICAgICAgICAgICAgICAgICAgICBpZiAoc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA+IHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGgpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPSBzamlzQ3VyS2F0YWthbmFXb3JkTGVuZ3RoOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlID4gMHg3RikgewoJICAgICAgICAgICAgICAgICAgICBzamlzQnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgIC8vIHNqaXNEb3VibGVCeXRlc0NoYXJzKysKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgICAgICAgICAgICAgIHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGgrKzsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGggPiBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gc2ppc0N1ckRvdWJsZUJ5dGVzV29yZExlbmd0aDsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gc2ppc0xvd0NoYXJzKysKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgICAgICAgICAgICAgIHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGggPSAwOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBpZiAoY2FuQmVVVEY4ICYmIHV0ZjhCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICBjYW5CZVVURjggPSBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY2FuQmVTaGlmdEpJUyAmJiBzamlzQnl0ZXNMZWZ0ID4gMCkgewoJICAgICAgICAgICAgY2FuQmVTaGlmdEpJUyA9IGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIEVhc3kgLS0gaWYgdGhlcmUgaXMgQk9NIG9yIGF0IGxlYXN0IDEgdmFsaWQgbm90LXNpbmdsZSBieXRlIGNoYXJhY3RlciAoYW5kIG5vIGV2aWRlbmNlIGl0IGNhbid0IGJlIFVURi04KSwgZG9uZQoJICAgICAgICBpZiAoY2FuQmVVVEY4ICYmICh1dGY4Ym9tIHx8IHV0ZjJCeXRlc0NoYXJzICsgdXRmM0J5dGVzQ2hhcnMgKyB1dGY0Qnl0ZXNDaGFycyA+IDApKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuVVRGODsKCSAgICAgICAgfQoJICAgICAgICAvLyBFYXN5IC0tIGlmIGFzc3VtaW5nIFNoaWZ0X0pJUyBvciBhdCBsZWFzdCAzIHZhbGlkIGNvbnNlY3V0aXZlIG5vdC1hc2NpaSBjaGFyYWN0ZXJzIChhbmQgbm8gZXZpZGVuY2UgaXQgY2FuJ3QgYmUpLCBkb25lCgkgICAgICAgIGlmIChjYW5CZVNoaWZ0SklTICYmIChTdHJpbmdVdGlscy5BU1NVTUVfU0hJRlRfSklTIHx8IHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPj0gMyB8fCBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoID49IDMpKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuU0hJRlRfSklTOwoJICAgICAgICB9CgkgICAgICAgIC8vIERpc3Rpbmd1aXNoaW5nIFNoaWZ0X0pJUyBhbmQgSVNPLTg4NTktMSBjYW4gYmUgYSBsaXR0bGUgdG91Z2ggZm9yIHNob3J0IHdvcmRzLiBUaGUgY3J1ZGUgaGV1cmlzdGljIGlzOgoJICAgICAgICAvLyAtIElmIHdlIHNhdwoJICAgICAgICAvLyAgIC0gb25seSB0d28gY29uc2VjdXRpdmUga2F0YWthbmEgY2hhcnMgaW4gdGhlIHdob2xlIHRleHQsIG9yCgkgICAgICAgIC8vICAgLSBhdCBsZWFzdCAxMCUgb2YgYnl0ZXMgdGhhdCBjb3VsZCBiZSAidXBwZXIiIG5vdC1hbHBoYW51bWVyaWMgTGF0aW4xLAoJICAgICAgICAvLyAtIHRoZW4gd2UgY29uY2x1ZGUgU2hpZnRfSklTLCBlbHNlIElTTy04ODU5LTEKCSAgICAgICAgaWYgKGNhbkJlSVNPODg1OTEgJiYgY2FuQmVTaGlmdEpJUykgewoJICAgICAgICAgICAgcmV0dXJuIChzamlzTWF4S2F0YWthbmFXb3JkTGVuZ3RoID09PSAyICYmIHNqaXNLYXRha2FuYUNoYXJzID09PSAyKSB8fCBpc29IaWdoT3RoZXIgKiAxMCA+PSBsZW5ndGgKCSAgICAgICAgICAgICAgICA/IFN0cmluZ1V0aWxzLlNISUZUX0pJUyA6IFN0cmluZ1V0aWxzLklTTzg4NTkxOwoJICAgICAgICB9CgkgICAgICAgIC8vIE90aGVyd2lzZSwgdHJ5IGluIG9yZGVyIElTTy04ODU5LTEsIFNoaWZ0IEpJUywgVVRGLTggYW5kIGZhbGwgYmFjayB0byBkZWZhdWx0IHBsYXRmb3JtIGVuY29kaW5nCgkgICAgICAgIGlmIChjYW5CZUlTTzg4NTkxKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuSVNPODg1OTE7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNhbkJlU2hpZnRKSVMpIHsKCSAgICAgICAgICAgIHJldHVybiBTdHJpbmdVdGlscy5TSElGVF9KSVM7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNhbkJlVVRGOCkgewoJICAgICAgICAgICAgcmV0dXJuIFN0cmluZ1V0aWxzLlVURjg7CgkgICAgICAgIH0KCSAgICAgICAgLy8gT3RoZXJ3aXNlLCB3ZSB0YWtlIGEgd2lsZCBndWVzcyB3aXRoIHBsYXRmb3JtIGVuY29kaW5nCgkgICAgICAgIHJldHVybiBTdHJpbmdVdGlscy5QTEFURk9STV9ERUZBVUxUX0VOQ09ESU5HOwoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKiBAc2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xMzQzOTcxMS80MzY3NjgzCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYXBwZW5kIFRoZSBuZXcgc3RyaW5nIHRvIGFwcGVuZC4KCSAgICAgKiBAcGFyYW0gYXJncyBBcmd1bWV0cyB2YWx1ZXMgdG8gYmUgZm9ybWF0ZWQuCgkgICAgICovCgkgICAgU3RyaW5nVXRpbHMuZm9ybWF0ID0gZnVuY3Rpb24gKGFwcGVuZCkgewoJICAgICAgICB2YXIgYXJncyA9IFtdOwoJICAgICAgICBmb3IgKHZhciBfaSA9IDE7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJICAgICAgICAgICAgYXJnc1tfaSAtIDFdID0gYXJndW1lbnRzW19pXTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgaSA9IC0xOwoJICAgICAgICBmdW5jdGlvbiBjYWxsYmFjayhleHAsIHAwLCBwMSwgcDIsIHAzLCBwNCkgewoJICAgICAgICAgICAgaWYgKGV4cCA9PT0gJyUlJykKCSAgICAgICAgICAgICAgICByZXR1cm4gJyUnOwoJICAgICAgICAgICAgaWYgKGFyZ3NbKytpXSA9PT0gdW5kZWZpbmVkKQoJICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CgkgICAgICAgICAgICBleHAgPSBwMiA/IHBhcnNlSW50KHAyLnN1YnN0cigxKSkgOiB1bmRlZmluZWQ7CgkgICAgICAgICAgICB2YXIgYmFzZSA9IHAzID8gcGFyc2VJbnQocDMuc3Vic3RyKDEpKSA6IHVuZGVmaW5lZDsKCSAgICAgICAgICAgIHZhciB2YWw7CgkgICAgICAgICAgICBzd2l0Y2ggKHA0KSB7CgkgICAgICAgICAgICAgICAgY2FzZSAncyc6CgkgICAgICAgICAgICAgICAgICAgIHZhbCA9IGFyZ3NbaV07CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ2MnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBhcmdzW2ldWzBdOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlICdmJzoKCSAgICAgICAgICAgICAgICAgICAgdmFsID0gcGFyc2VGbG9hdChhcmdzW2ldKS50b0ZpeGVkKGV4cCk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ3AnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KGFyZ3NbaV0pLnRvUHJlY2lzaW9uKGV4cCk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ2UnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KGFyZ3NbaV0pLnRvRXhwb25lbnRpYWwoZXhwKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAneCc6CgkgICAgICAgICAgICAgICAgICAgIHZhbCA9IHBhcnNlSW50KGFyZ3NbaV0pLnRvU3RyaW5nKGJhc2UgPyBiYXNlIDogMTYpOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlICdkJzoKCSAgICAgICAgICAgICAgICAgICAgdmFsID0gcGFyc2VGbG9hdChwYXJzZUludChhcmdzW2ldLCBiYXNlID8gYmFzZSA6IDEwKS50b1ByZWNpc2lvbihleHApKS50b0ZpeGVkKDApOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhbCA9IHR5cGVvZiB2YWwgPT09ICdvYmplY3QnID8gSlNPTi5zdHJpbmdpZnkodmFsKSA6ICgrdmFsKS50b1N0cmluZyhiYXNlKTsKCSAgICAgICAgICAgIHZhciBzaXplID0gcGFyc2VJbnQocDEpOyAvKiBwYWRkaW5nIHNpemUgKi8KCSAgICAgICAgICAgIHZhciBjaCA9IHAxICYmIChwMVswXSArICcnKSA9PT0gJzAnID8gJzAnIDogJyAnOyAvKiBpc251bGw/ICovCgkgICAgICAgICAgICB3aGlsZSAodmFsLmxlbmd0aCA8IHNpemUpCgkgICAgICAgICAgICAgICAgdmFsID0gcDAgIT09IHVuZGVmaW5lZCA/IHZhbCArIGNoIDogY2ggKyB2YWw7IC8qIGlzbWludXM/ICovCgkgICAgICAgICAgICByZXR1cm4gdmFsOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZWdleCA9IC8lKC0pPygwP1swLTldKyk/KFsuXVswLTldKyk/KFsjXVswLTldKyk/KFtzY2ZwZXhkJV0pL2c7CgkgICAgICAgIHJldHVybiBhcHBlbmQucmVwbGFjZShyZWdleCwgY2FsbGJhY2spOwoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKi8KCSAgICBTdHJpbmdVdGlscy5nZXRCeXRlcyA9IGZ1bmN0aW9uIChzdHIsIGVuY29kaW5nKSB7CgkgICAgICAgIHJldHVybiBTdHJpbmdFbmNvZGluZ18xJDEuZGVmYXVsdC5lbmNvZGUoc3RyLCBlbmNvZGluZyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIHRoZSBjaGFyY29kZSBhdCB0aGUgc3BlY2lmaWVkIGluZGV4IG9yIGF0IGluZGV4IHplcm8uCgkgICAgICovCgkgICAgU3RyaW5nVXRpbHMuZ2V0Q2hhckNvZGUgPSBmdW5jdGlvbiAoc3RyLCBpbmRleCkgewoJICAgICAgICBpZiAoaW5kZXggPT09IHZvaWQgMCkgeyBpbmRleCA9IDA7IH0KCSAgICAgICAgcmV0dXJuIHN0ci5jaGFyQ29kZUF0KGluZGV4KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgY2hhciBmb3IgZ2l2ZW4gY2hhcmNvZGUKCSAgICAgKi8KCSAgICBTdHJpbmdVdGlscy5nZXRDaGFyQXQgPSBmdW5jdGlvbiAoY2hhckNvZGUpIHsKCSAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY2hhckNvZGUpOwoJICAgIH07CgkgICAgU3RyaW5nVXRpbHMuU0hJRlRfSklTID0gQ2hhcmFjdGVyU2V0RUNJXzEkMS5kZWZhdWx0LlNKSVMuZ2V0TmFtZSgpOyAvLyAiU0pJUyIKCSAgICBTdHJpbmdVdGlscy5HQjIzMTIgPSAnR0IyMzEyJzsKCSAgICBTdHJpbmdVdGlscy5JU084ODU5MSA9IENoYXJhY3RlclNldEVDSV8xJDEuZGVmYXVsdC5JU084ODU5XzEuZ2V0TmFtZSgpOyAvLyAiSVNPODg1OV8xIgoJICAgIFN0cmluZ1V0aWxzLkVVQ19KUCA9ICdFVUNfSlAnOwoJICAgIFN0cmluZ1V0aWxzLlVURjggPSBDaGFyYWN0ZXJTZXRFQ0lfMSQxLmRlZmF1bHQuVVRGOC5nZXROYW1lKCk7IC8vICJVVEY4IgoJICAgIFN0cmluZ1V0aWxzLlBMQVRGT1JNX0RFRkFVTFRfRU5DT0RJTkcgPSBTdHJpbmdVdGlscy5VVEY4OyAvLyAiVVRGOCIvL0NoYXJzZXQuZGVmYXVsdENoYXJzZXQoKS5uYW1lKCkKCSAgICBTdHJpbmdVdGlscy5BU1NVTUVfU0hJRlRfSklTID0gZmFsc2U7CgkgICAgcmV0dXJuIFN0cmluZ1V0aWxzOwoJfSgpKTsKCVN0cmluZ1V0aWxzJDEuZGVmYXVsdCA9IFN0cmluZ1V0aWxzOwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmdCdWlsZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBTdHJpbmdVdGlsc18xJDEgPSBTdHJpbmdVdGlscyQxOwoJdmFyIFN0cmluZ0J1aWxkZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nQnVpbGRlcih2YWx1ZSkgewoJICAgICAgICBpZiAodmFsdWUgPT09IHZvaWQgMCkgeyB2YWx1ZSA9ICcnOyB9CgkgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKCSAgICB9CgkgICAgU3RyaW5nQnVpbGRlci5wcm90b3R5cGUuZW5hYmxlRGVjb2RpbmcgPSBmdW5jdGlvbiAoZW5jb2RpbmcpIHsKCSAgICAgICAgdGhpcy5lbmNvZGluZyA9IGVuY29kaW5nOwoJICAgICAgICByZXR1cm4gdGhpczsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmFwcGVuZCA9IGZ1bmN0aW9uIChzKSB7CgkgICAgICAgIGlmICh0eXBlb2YgcyA9PT0gJ3N0cmluZycpIHsKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gcy50b1N0cmluZygpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgaWYgKHRoaXMuZW5jb2RpbmcpIHsKCSAgICAgICAgICAgIC8vIHVzZSBwYXNzZWQgZm9ybWF0IChmcm9tQ2hhckNvZGUgd2lsbCByZXR1cm4gVVRGOCBlbmNvZGluZykKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gU3RyaW5nVXRpbHNfMSQxLmRlZmF1bHQuY2FzdEFzTm9uVXRmOENoYXIocywgdGhpcy5lbmNvZGluZyk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAvLyBjb3JyZWN0bHkgY29udmVydHMgZnJvbSBVVEYtOCwgYnV0IG5vdCBvdGhlciBlbmNvZGluZ3MKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShzKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpczsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmFwcGVuZENoYXJzID0gZnVuY3Rpb24gKHN0ciwgb2Zmc2V0LCBsZW4pIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IG9mZnNldDsgb2Zmc2V0IDwgb2Zmc2V0ICsgbGVuOyBpKyspIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kKHN0cltpXSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgfTsKCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5sZW5ndGggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLmxlbmd0aDsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmNoYXJBdCA9IGZ1bmN0aW9uIChuKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLmNoYXJBdChuKTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmRlbGV0ZUNoYXJBdCA9IGZ1bmN0aW9uIChuKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIHRoaXMudmFsdWUuc3Vic3RyaW5nKG4gKyAxKTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLnNldENoYXJBdCA9IGZ1bmN0aW9uIChuLCBjKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIGMgKyB0aGlzLnZhbHVlLnN1YnN0cihuICsgMSk7CgkgICAgfTsKCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5zdWJzdHJpbmcgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZS5zdWJzdHJpbmcoc3RhcnQsIGVuZCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAbm90ZSBoZWxwZXIgbWV0aG9kIGZvciBSU1MgRXhwYW5kZWQKCSAgICAgKi8KCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5zZXRMZW5ndGhUb1plcm8gPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSAnJzsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmluc2VydCA9IGZ1bmN0aW9uIChuLCBjKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIGMgKyB0aGlzLnZhbHVlLnN1YnN0cihuICsgYy5sZW5ndGgpOwoJICAgIH07CgkgICAgcmV0dXJuIFN0cmluZ0J1aWxkZXI7Cgl9KCkpOwoJU3RyaW5nQnVpbGRlciQxLmRlZmF1bHQgPSBTdHJpbmdCdWlsZGVyOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQml0TWF0cml4JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5czsqLwoJdmFyIEJpdEFycmF5XzEkMSA9IEJpdEFycmF5JDE7Cgl2YXIgU3lzdGVtXzEkMyA9IFN5c3RlbSQxOwoJdmFyIEFycmF5c18xID0gQXJyYXlzJDE7Cgl2YXIgU3RyaW5nQnVpbGRlcl8xJDIgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNyA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5SZXByZXNlbnRzIGEgMkQgbWF0cml4IG9mIGJpdHMuIEluIGZ1bmN0aW9uIGFyZ3VtZW50cyBiZWxvdywgYW5kIHRocm91Z2hvdXQgdGhlIGNvbW1vbgoJICogbW9kdWxlLCB4IGlzIHRoZSBjb2x1bW4gcG9zaXRpb24sIGFuZCB5IGlzIHRoZSByb3cgcG9zaXRpb24uIFRoZSBvcmRlcmluZyBpcyBhbHdheXMgeCwgeS4KCSAqIFRoZSBvcmlnaW4gaXMgYXQgdGhlIHRvcC1sZWZ0LjwvcD4KCSAqCgkgKiA8cD5JbnRlcm5hbGx5IHRoZSBiaXRzIGFyZSByZXByZXNlbnRlZCBpbiBhIDEtRCBhcnJheSBvZiAzMi1iaXQgaW50cy4gSG93ZXZlciwgZWFjaCByb3cgYmVnaW5zCgkgKiB3aXRoIGEgbmV3IGludC4gVGhpcyBpcyBkb25lIGludGVudGlvbmFsbHkgc28gdGhhdCB3ZSBjYW4gY29weSBvdXQgYSByb3cgaW50byBhIEJpdEFycmF5IHZlcnkKCSAqIGVmZmljaWVudGx5LjwvcD4KCSAqCgkgKiA8cD5UaGUgb3JkZXJpbmcgb2YgYml0cyBpcyByb3ctbWFqb3IuIFdpdGhpbiBlYWNoIGludCwgdGhlIGxlYXN0IHNpZ25pZmljYW50IGJpdHMgYXJlIHVzZWQgZmlyc3QsCgkgKiBtZWFuaW5nIHRoZXkgcmVwcmVzZW50IGxvd2VyIHggdmFsdWVzLiBUaGlzIGlzIGNvbXBhdGlibGUgd2l0aCBCaXRBcnJheSdzIGltcGxlbWVudGF0aW9uLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqLwoJdmFyIEJpdE1hdHJpeCAvKmltcGxlbWVudHMgQ2xvbmVhYmxlKi8gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQ3JlYXRlcyBhbiBlbXB0eSBzcXVhcmUge0BsaW5rIEJpdE1hdHJpeH0uCgkgICAgICoKCSAgICAgKiBAcGFyYW0gZGltZW5zaW9uIGhlaWdodCBhbmQgd2lkdGgKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IoZGltZW5zaW9uOiBudW1iZXIgLyppbnQqLykgewoJICAgIC8vICAgdGhpcyhkaW1lbnNpb24sIGRpbWVuc2lvbikKCSAgICAvLyB9CgkgICAgLyoqCgkgICAgICogQ3JlYXRlcyBhbiBlbXB0eSB7QGxpbmsgQml0TWF0cml4fS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB3aWR0aCBiaXQgbWF0cml4IHdpZHRoCgkgICAgICogQHBhcmFtIGhlaWdodCBiaXQgbWF0cml4IGhlaWdodAoJICAgICAqLwoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3Rvcih3aWR0aDogbnVtYmVyIC8qaW50Ki8sIGhlaWdodDogbnVtYmVyIC8qaW50Ki8pIHsKCSAgICAvLyAgIGlmICh3aWR0aCA8IDEgfHwgaGVpZ2h0IDwgMSkgewoJICAgIC8vICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJCb3RoIGRpbWVuc2lvbnMgbXVzdCBiZSBncmVhdGVyIHRoYW4gMCIpCgkgICAgLy8gICB9CgkgICAgLy8gICB0aGlzLndpZHRoID0gd2lkdGgKCSAgICAvLyAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0CgkgICAgLy8gICB0aGlzLnJvd1NpemUgPSAod2lkdGggKyAzMSkgLyAzMgoJICAgIC8vICAgYml0cyA9IG5ldyBpbnRbcm93U2l6ZSAqIGhlaWdodF07CgkgICAgLy8gfQoJICAgIGZ1bmN0aW9uIEJpdE1hdHJpeCh3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLywgcm93U2l6ZSAvKmludCovLCBiaXRzKSB7CgkgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDsKCSAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CgkgICAgICAgIHRoaXMucm93U2l6ZSA9IHJvd1NpemU7CgkgICAgICAgIHRoaXMuYml0cyA9IGJpdHM7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGhlaWdodCB8fCBudWxsID09PSBoZWlnaHQpIHsKCSAgICAgICAgICAgIGhlaWdodCA9IHdpZHRoOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwoJICAgICAgICBpZiAod2lkdGggPCAxIHx8IGhlaWdodCA8IDEpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ0JvdGggZGltZW5zaW9ucyBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAwJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gcm93U2l6ZSB8fCBudWxsID09PSByb3dTaXplKSB7CgkgICAgICAgICAgICByb3dTaXplID0gTWF0aC5mbG9vcigod2lkdGggKyAzMSkgLyAzMik7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yb3dTaXplID0gcm93U2l6ZTsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gYml0cyB8fCBudWxsID09PSBiaXRzKSB7CgkgICAgICAgICAgICB0aGlzLmJpdHMgPSBuZXcgSW50MzJBcnJheSh0aGlzLnJvd1NpemUgKiB0aGlzLmhlaWdodCk7CgkgICAgICAgIH0KCSAgICB9CgkgICAgLyoqCgkgICAgICogSW50ZXJwcmV0cyBhIDJEIGFycmF5IG9mIGJvb2xlYW5zIGFzIGEge0BsaW5rIEJpdE1hdHJpeH0sIHdoZXJlICJ0cnVlIiBtZWFucyBhbiAib24iIGJpdC4KCSAgICAgKgoJICAgICAqIEBmdW5jdGlvbiBwYXJzZQoJICAgICAqIEBwYXJhbSBpbWFnZSBiaXRzIG9mIHRoZSBpbWFnZSwgYXMgYSByb3ctbWFqb3IgMkQgYXJyYXkuIEVsZW1lbnRzIGFyZSBhcnJheXMgcmVwcmVzZW50aW5nIHJvd3MKCSAgICAgKiBAcmV0dXJuIHtAbGluayBCaXRNYXRyaXh9IHJlcHJlc2VudGF0aW9uIG9mIGltYWdlCgkgICAgICovCgkgICAgQml0TWF0cml4LnBhcnNlRnJvbUJvb2xlYW5BcnJheSA9IGZ1bmN0aW9uIChpbWFnZSkgewoJICAgICAgICB2YXIgaGVpZ2h0ID0gaW1hZ2UubGVuZ3RoOwoJICAgICAgICB2YXIgd2lkdGggPSBpbWFnZVswXS5sZW5ndGg7CgkgICAgICAgIHZhciBiaXRzID0gbmV3IEJpdE1hdHJpeCh3aWR0aCwgaGVpZ2h0KTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewoJICAgICAgICAgICAgdmFyIGltYWdlSSA9IGltYWdlW2ldOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB3aWR0aDsgaisrKSB7CgkgICAgICAgICAgICAgICAgaWYgKGltYWdlSVtqXSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLnNldChqLCBpKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKgoJICAgICAqIEBmdW5jdGlvbiBwYXJzZQoJICAgICAqIEBwYXJhbSBzdHJpbmdSZXByZXNlbnRhdGlvbgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcKCSAgICAgKiBAcGFyYW0gdW5zZXRTdHJpbmcKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucGFyc2VGcm9tU3RyaW5nID0gZnVuY3Rpb24gKHN0cmluZ1JlcHJlc2VudGF0aW9uLCBzZXRTdHJpbmcsIHVuc2V0U3RyaW5nKSB7CgkgICAgICAgIGlmIChzdHJpbmdSZXByZXNlbnRhdGlvbiA9PT0gbnVsbCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnc3RyaW5nUmVwcmVzZW50YXRpb24gY2Fubm90IGJlIG51bGwnKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IG5ldyBBcnJheShzdHJpbmdSZXByZXNlbnRhdGlvbi5sZW5ndGgpOwoJICAgICAgICB2YXIgYml0c1BvcyA9IDA7CgkgICAgICAgIHZhciByb3dTdGFydFBvcyA9IDA7CgkgICAgICAgIHZhciByb3dMZW5ndGggPSAtMTsKCSAgICAgICAgdmFyIG5Sb3dzID0gMDsKCSAgICAgICAgdmFyIHBvcyA9IDA7CgkgICAgICAgIHdoaWxlIChwb3MgPCBzdHJpbmdSZXByZXNlbnRhdGlvbi5sZW5ndGgpIHsKCSAgICAgICAgICAgIGlmIChzdHJpbmdSZXByZXNlbnRhdGlvbi5jaGFyQXQocG9zKSA9PT0gJ1xuJyB8fAoJICAgICAgICAgICAgICAgIHN0cmluZ1JlcHJlc2VudGF0aW9uLmNoYXJBdChwb3MpID09PSAnXHInKSB7CgkgICAgICAgICAgICAgICAgaWYgKGJpdHNQb3MgPiByb3dTdGFydFBvcykgewoJICAgICAgICAgICAgICAgICAgICBpZiAocm93TGVuZ3RoID09PSAtMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcm93TGVuZ3RoID0gYml0c1BvcyAtIHJvd1N0YXJ0UG9zOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJpdHNQb3MgLSByb3dTdGFydFBvcyAhPT0gcm93TGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdyb3cgbGVuZ3RocyBkbyBub3QgbWF0Y2gnKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICByb3dTdGFydFBvcyA9IGJpdHNQb3M7CgkgICAgICAgICAgICAgICAgICAgIG5Sb3dzKys7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHBvcysrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSBpZiAoc3RyaW5nUmVwcmVzZW50YXRpb24uc3Vic3RyaW5nKHBvcywgcG9zICsgc2V0U3RyaW5nLmxlbmd0aCkgPT09IHNldFN0cmluZykgewoJICAgICAgICAgICAgICAgIHBvcyArPSBzZXRTdHJpbmcubGVuZ3RoOwoJICAgICAgICAgICAgICAgIGJpdHNbYml0c1Bvc10gPSB0cnVlOwoJICAgICAgICAgICAgICAgIGJpdHNQb3MrKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHN0cmluZ1JlcHJlc2VudGF0aW9uLnN1YnN0cmluZyhwb3MsIHBvcyArIHVuc2V0U3RyaW5nLmxlbmd0aCkgPT09IHVuc2V0U3RyaW5nKSB7CgkgICAgICAgICAgICAgICAgcG9zICs9IHVuc2V0U3RyaW5nLmxlbmd0aDsKCSAgICAgICAgICAgICAgICBiaXRzW2JpdHNQb3NdID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgYml0c1BvcysrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnaWxsZWdhbCBjaGFyYWN0ZXIgZW5jb3VudGVyZWQ6ICcgKyBzdHJpbmdSZXByZXNlbnRhdGlvbi5zdWJzdHJpbmcocG9zKSk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gbm8gRU9MIGF0IGVuZD8KCSAgICAgICAgaWYgKGJpdHNQb3MgPiByb3dTdGFydFBvcykgewoJICAgICAgICAgICAgaWYgKHJvd0xlbmd0aCA9PT0gLTEpIHsKCSAgICAgICAgICAgICAgICByb3dMZW5ndGggPSBiaXRzUG9zIC0gcm93U3RhcnRQb3M7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIGlmIChiaXRzUG9zIC0gcm93U3RhcnRQb3MgIT09IHJvd0xlbmd0aCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ3JvdyBsZW5ndGhzIGRvIG5vdCBtYXRjaCcpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgblJvd3MrKzsKCSAgICAgICAgfQoJICAgICAgICB2YXIgbWF0cml4ID0gbmV3IEJpdE1hdHJpeChyb3dMZW5ndGgsIG5Sb3dzKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiaXRzUG9zOyBpKyspIHsKCSAgICAgICAgICAgIGlmIChiaXRzW2ldKSB7CgkgICAgICAgICAgICAgICAgbWF0cml4LnNldChNYXRoLmZsb29yKGkgJSByb3dMZW5ndGgpLCBNYXRoLmZsb29yKGkgLyByb3dMZW5ndGgpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbWF0cml4OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+R2V0cyB0aGUgcmVxdWVzdGVkIGJpdCwgd2hlcmUgdHJ1ZSBtZWFucyBibGFjay48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0geCBUaGUgaG9yaXpvbnRhbCBjb21wb25lbnQgKGkuZS4gd2hpY2ggY29sdW1uKQoJICAgICAqIEBwYXJhbSB5IFRoZSB2ZXJ0aWNhbCBjb21wb25lbnQgKGkuZS4gd2hpY2ggcm93KQoJICAgICAqIEByZXR1cm4gdmFsdWUgb2YgZ2l2ZW4gYml0IGluIG1hdHJpeAoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKHggLyppbnQqLywgeSAvKmludCovKSB7CgkgICAgICAgIHZhciBvZmZzZXQgPSB5ICogdGhpcy5yb3dTaXplICsgTWF0aC5mbG9vcih4IC8gMzIpOwoJICAgICAgICByZXR1cm4gKCh0aGlzLmJpdHNbb2Zmc2V0XSA+Pj4gKHggJiAweDFmKSkgJiAxKSAhPT0gMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlNldHMgdGhlIGdpdmVuIGJpdCB0byB0cnVlLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB4IFRoZSBob3Jpem9udGFsIGNvbXBvbmVudCAoaS5lLiB3aGljaCBjb2x1bW4pCgkgICAgICogQHBhcmFtIHkgVGhlIHZlcnRpY2FsIGNvbXBvbmVudCAoaS5lLiB3aGljaCByb3cpCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdIHw9ICgxIDw8ICh4ICYgMHgxZikpICYgMHhGRkZGRkZGRjsKCSAgICB9OwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUudW5zZXQgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdICY9IH4oKDEgPDwgKHggJiAweDFmKSkgJiAweEZGRkZGRkZGKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkZsaXBzIHRoZSBnaXZlbiBiaXQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIHggVGhlIGhvcml6b250YWwgY29tcG9uZW50IChpLmUuIHdoaWNoIGNvbHVtbikKCSAgICAgKiBAcGFyYW0geSBUaGUgdmVydGljYWwgY29tcG9uZW50IChpLmUuIHdoaWNoIHJvdykKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmZsaXAgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdIF49ICgoMSA8PCAoeCAmIDB4MWYpKSAmIDB4RkZGRkZGRkYpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRXhjbHVzaXZlLW9yIChYT1IpOiBGbGlwIHRoZSBiaXQgaW4gdGhpcyB7QGNvZGUgQml0TWF0cml4fSBpZiB0aGUgY29ycmVzcG9uZGluZwoJICAgICAqIG1hc2sgYml0IGlzIHNldC4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBtYXNrIFhPUiBtYXNrCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS54b3IgPSBmdW5jdGlvbiAobWFzaykgewoJICAgICAgICBpZiAodGhpcy53aWR0aCAhPT0gbWFzay5nZXRXaWR0aCgpIHx8IHRoaXMuaGVpZ2h0ICE9PSBtYXNrLmdldEhlaWdodCgpCgkgICAgICAgICAgICB8fCB0aGlzLnJvd1NpemUgIT09IG1hc2suZ2V0Um93U2l6ZSgpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdpbnB1dCBtYXRyaXggZGltZW5zaW9ucyBkbyBub3QgbWF0Y2gnKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcm93QXJyYXkgPSBuZXcgQml0QXJyYXlfMSQxLmRlZmF1bHQoTWF0aC5mbG9vcih0aGlzLndpZHRoIC8gMzIpICsgMSk7CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgeSA9IDAsIGhlaWdodCA9IHRoaXMuaGVpZ2h0OyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIHZhciBvZmZzZXQgPSB5ICogcm93U2l6ZTsKCSAgICAgICAgICAgIHZhciByb3cgPSBtYXNrLmdldFJvdyh5LCByb3dBcnJheSkuZ2V0Qml0QXJyYXkoKTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgcm93U2l6ZTsgeCsrKSB7CgkgICAgICAgICAgICAgICAgYml0c1tvZmZzZXQgKyB4XSBePSByb3dbeF07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIENsZWFycyBhbGwgYml0cyAoc2V0cyB0byBmYWxzZSkuCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIHZhciBtYXggPSBiaXRzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXg7IGkrKykgewoJICAgICAgICAgICAgYml0c1tpXSA9IDA7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlNldHMgYSBzcXVhcmUgcmVnaW9uIG9mIHRoZSBiaXQgbWF0cml4IHRvIHRydWUuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGxlZnQgVGhlIGhvcml6b250YWwgcG9zaXRpb24gdG8gYmVnaW4gYXQgKGluY2x1c2l2ZSkKCSAgICAgKiBAcGFyYW0gdG9wIFRoZSB2ZXJ0aWNhbCBwb3NpdGlvbiB0byBiZWdpbiBhdCAoaW5jbHVzaXZlKQoJICAgICAqIEBwYXJhbSB3aWR0aCBUaGUgd2lkdGggb2YgdGhlIHJlZ2lvbgoJICAgICAqIEBwYXJhbSBoZWlnaHQgVGhlIGhlaWdodCBvZiB0aGUgcmVnaW9uCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5zZXRSZWdpb24gPSBmdW5jdGlvbiAobGVmdCAvKmludCovLCB0b3AgLyppbnQqLywgd2lkdGggLyppbnQqLywgaGVpZ2h0IC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKHRvcCA8IDAgfHwgbGVmdCA8IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ0xlZnQgYW5kIHRvcCBtdXN0IGJlIG5vbm5lZ2F0aXZlJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGhlaWdodCA8IDEgfHwgd2lkdGggPCAxKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdIZWlnaHQgYW5kIHdpZHRoIG11c3QgYmUgYXQgbGVhc3QgMScpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByaWdodCA9IGxlZnQgKyB3aWR0aDsKCSAgICAgICAgdmFyIGJvdHRvbSA9IHRvcCArIGhlaWdodDsKCSAgICAgICAgaWYgKGJvdHRvbSA+IHRoaXMuaGVpZ2h0IHx8IHJpZ2h0ID4gdGhpcy53aWR0aCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnVGhlIHJlZ2lvbiBtdXN0IGZpdCBpbnNpZGUgdGhlIG1hdHJpeCcpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgeSA9IHRvcDsgeSA8IGJvdHRvbTsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb2Zmc2V0ID0geSAqIHJvd1NpemU7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gbGVmdDsgeCA8IHJpZ2h0OyB4KyspIHsKCSAgICAgICAgICAgICAgICBiaXRzW29mZnNldCArIE1hdGguZmxvb3IoeCAvIDMyKV0gfD0gKCgxIDw8ICh4ICYgMHgxZikpICYgMHhGRkZGRkZGRik7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEEgZmFzdCBtZXRob2QgdG8gcmV0cmlldmUgb25lIHJvdyBvZiBkYXRhIGZyb20gdGhlIG1hdHJpeCBhcyBhIEJpdEFycmF5LgoJICAgICAqCgkgICAgICogQHBhcmFtIHkgVGhlIHJvdyB0byByZXRyaWV2ZQoJICAgICAqIEBwYXJhbSByb3cgQW4gb3B0aW9uYWwgY2FsbGVyLWFsbG9jYXRlZCBCaXRBcnJheSwgd2lsbCBiZSBhbGxvY2F0ZWQgaWYgbnVsbCBvciB0b28gc21hbGwKCSAgICAgKiBAcmV0dXJuIFRoZSByZXN1bHRpbmcgQml0QXJyYXkgLSB0aGlzIHJlZmVyZW5jZSBzaG91bGQgYWx3YXlzIGJlIHVzZWQgZXZlbiB3aGVuIHBhc3NpbmcKCSAgICAgKiAgICAgICAgIHlvdXIgb3duIHJvdwoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0Um93ID0gZnVuY3Rpb24gKHkgLyppbnQqLywgcm93KSB7CgkgICAgICAgIGlmIChyb3cgPT09IG51bGwgfHwgcm93ID09PSB1bmRlZmluZWQgfHwgcm93LmdldFNpemUoKSA8IHRoaXMud2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBCaXRBcnJheV8xJDEuZGVmYXVsdCh0aGlzLndpZHRoKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHJvdy5jbGVhcigpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiByb3dTaXplOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHJvd1NpemU7IHgrKykgewoJICAgICAgICAgICAgcm93LnNldEJ1bGsoeCAqIDMyLCBiaXRzW29mZnNldCArIHhdKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcm93OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIHkgcm93IHRvIHNldAoJICAgICAqIEBwYXJhbSByb3cge0BsaW5rIEJpdEFycmF5fSB0byBjb3B5IGZyb20KCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLnNldFJvdyA9IGZ1bmN0aW9uICh5IC8qaW50Ki8sIHJvdykgewoJICAgICAgICBTeXN0ZW1fMSQzLmRlZmF1bHQuYXJyYXljb3B5KHJvdy5nZXRCaXRBcnJheSgpLCAwLCB0aGlzLmJpdHMsIHkgKiB0aGlzLnJvd1NpemUsIHRoaXMucm93U2l6ZSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBNb2RpZmllcyB0aGlzIHtAY29kZSBCaXRNYXRyaXh9IHRvIHJlcHJlc2VudCB0aGUgc2FtZSBidXQgcm90YXRlZCAxODAgZGVncmVlcwoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUucm90YXRlMTgwID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgd2lkdGggPSB0aGlzLmdldFdpZHRoKCk7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgdG9wUm93ID0gbmV3IEJpdEFycmF5XzEkMS5kZWZhdWx0KHdpZHRoKTsKCSAgICAgICAgdmFyIGJvdHRvbVJvdyA9IG5ldyBCaXRBcnJheV8xJDEuZGVmYXVsdCh3aWR0aCk7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IE1hdGguZmxvb3IoKGhlaWdodCArIDEpIC8gMik7IGkgPCBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICB0b3BSb3cgPSB0aGlzLmdldFJvdyhpLCB0b3BSb3cpOwoJICAgICAgICAgICAgYm90dG9tUm93ID0gdGhpcy5nZXRSb3coaGVpZ2h0IC0gMSAtIGksIGJvdHRvbVJvdyk7CgkgICAgICAgICAgICB0b3BSb3cucmV2ZXJzZSgpOwoJICAgICAgICAgICAgYm90dG9tUm93LnJldmVyc2UoKTsKCSAgICAgICAgICAgIHRoaXMuc2V0Um93KGksIGJvdHRvbVJvdyk7CgkgICAgICAgICAgICB0aGlzLnNldFJvdyhoZWlnaHQgLSAxIC0gaSwgdG9wUm93KTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICogVGhpcyBpcyB1c2VmdWwgaW4gZGV0ZWN0aW5nIHRoZSBlbmNsb3NpbmcgcmVjdGFuZ2xlIG9mIGEgJ3B1cmUnIGJhcmNvZGUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtAY29kZSBsZWZ0LHRvcCx3aWR0aCxoZWlnaHR9IGVuY2xvc2luZyByZWN0YW5nbGUgb2YgYWxsIDEgYml0cywgb3IgbnVsbCBpZiBpdCBpcyBhbGwgd2hpdGUKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmdldEVuY2xvc2luZ1JlY3RhbmdsZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aDsKCSAgICAgICAgdmFyIGhlaWdodCA9IHRoaXMuaGVpZ2h0OwoJICAgICAgICB2YXIgcm93U2l6ZSA9IHRoaXMucm93U2l6ZTsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIHZhciBsZWZ0ID0gd2lkdGg7CgkgICAgICAgIHZhciB0b3AgPSBoZWlnaHQ7CgkgICAgICAgIHZhciByaWdodCA9IC0xOwoJICAgICAgICB2YXIgYm90dG9tID0gLTE7CgkgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIHgzMiA9IDA7IHgzMiA8IHJvd1NpemU7IHgzMisrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHRoZUJpdHMgPSBiaXRzW3kgKiByb3dTaXplICsgeDMyXTsKCSAgICAgICAgICAgICAgICBpZiAodGhlQml0cyAhPT0gMCkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoeSA8IHRvcCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgdG9wID0geTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBpZiAoeSA+IGJvdHRvbSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgYm90dG9tID0geTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBpZiAoeDMyICogMzIgPCBsZWZ0KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYml0ID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgoKHRoZUJpdHMgPDwgKDMxIC0gYml0KSkgJiAweEZGRkZGRkZGKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdCsrOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh4MzIgKiAzMiArIGJpdCkgPCBsZWZ0KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdCA9IHgzMiAqIDMyICsgYml0OwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGlmICh4MzIgKiAzMiArIDMxID4gcmlnaHQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiaXQgPSAzMTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgodGhlQml0cyA+Pj4gYml0KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdC0tOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh4MzIgKiAzMiArIGJpdCkgPiByaWdodCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0ID0geDMyICogMzIgKyBiaXQ7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHJpZ2h0IDwgbGVmdCB8fCBib3R0b20gPCB0b3ApIHsKCSAgICAgICAgICAgIHJldHVybiBudWxsOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW2xlZnQsIHRvcCwgcmlnaHQgLSBsZWZ0ICsgMSwgYm90dG9tIC0gdG9wICsgMV0pOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogVGhpcyBpcyB1c2VmdWwgaW4gZGV0ZWN0aW5nIGEgY29ybmVyIG9mIGEgJ3B1cmUnIGJhcmNvZGUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtAY29kZSB4LHl9IGNvb3JkaW5hdGUgb2YgdG9wLWxlZnQtbW9zdCAxIGJpdCwgb3IgbnVsbCBpZiBpdCBpcyBhbGwgd2hpdGUKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmdldFRvcExlZnRPbkJpdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJvd1NpemUgPSB0aGlzLnJvd1NpemU7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IDA7CgkgICAgICAgIHdoaWxlIChiaXRzT2Zmc2V0IDwgYml0cy5sZW5ndGggJiYgYml0c1tiaXRzT2Zmc2V0XSA9PT0gMCkgewoJICAgICAgICAgICAgYml0c09mZnNldCsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChiaXRzT2Zmc2V0ID09PSBiaXRzLmxlbmd0aCkgewoJICAgICAgICAgICAgcmV0dXJuIG51bGw7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHkgPSBiaXRzT2Zmc2V0IC8gcm93U2l6ZTsKCSAgICAgICAgdmFyIHggPSAoYml0c09mZnNldCAlIHJvd1NpemUpICogMzI7CgkgICAgICAgIHZhciB0aGVCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgdmFyIGJpdCA9IDA7CgkgICAgICAgIHdoaWxlICgoKHRoZUJpdHMgPDwgKDMxIC0gYml0KSkgJiAweEZGRkZGRkZGKSA9PT0gMCkgewoJICAgICAgICAgICAgYml0Kys7CgkgICAgICAgIH0KCSAgICAgICAgeCArPSBiaXQ7CgkgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW3gsIHldKTsKCSAgICB9OwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0Qm90dG9tUmlnaHRPbkJpdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJvd1NpemUgPSB0aGlzLnJvd1NpemU7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IGJpdHMubGVuZ3RoIC0gMTsKCSAgICAgICAgd2hpbGUgKGJpdHNPZmZzZXQgPj0gMCAmJiBiaXRzW2JpdHNPZmZzZXRdID09PSAwKSB7CgkgICAgICAgICAgICBiaXRzT2Zmc2V0LS07CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGJpdHNPZmZzZXQgPCAwKSB7CgkgICAgICAgICAgICByZXR1cm4gbnVsbDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgeSA9IE1hdGguZmxvb3IoYml0c09mZnNldCAvIHJvd1NpemUpOwoJICAgICAgICB2YXIgeCA9IE1hdGguZmxvb3IoYml0c09mZnNldCAlIHJvd1NpemUpICogMzI7CgkgICAgICAgIHZhciB0aGVCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgdmFyIGJpdCA9IDMxOwoJICAgICAgICB3aGlsZSAoKHRoZUJpdHMgPj4+IGJpdCkgPT09IDApIHsKCSAgICAgICAgICAgIGJpdC0tOwoJICAgICAgICB9CgkgICAgICAgIHggKz0gYml0OwoJICAgICAgICByZXR1cm4gSW50MzJBcnJheS5mcm9tKFt4LCB5XSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSB3aWR0aCBvZiB0aGUgbWF0cml4CgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMud2lkdGg7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSBoZWlnaHQgb2YgdGhlIG1hdHJpeAoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0SGVpZ2h0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5oZWlnaHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSByb3cgc2l6ZSBvZiB0aGUgbWF0cml4CgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5nZXRSb3dTaXplID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yb3dTaXplOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG8pIHsKCSAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIEJpdE1hdHJpeCkpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgb3RoZXIgPSBvOwoJICAgICAgICByZXR1cm4gdGhpcy53aWR0aCA9PT0gb3RoZXIud2lkdGggJiYgdGhpcy5oZWlnaHQgPT09IG90aGVyLmhlaWdodCAmJiB0aGlzLnJvd1NpemUgPT09IG90aGVyLnJvd1NpemUgJiYKCSAgICAgICAgICAgIEFycmF5c18xLmRlZmF1bHQuZXF1YWxzKHRoaXMuYml0cywgb3RoZXIuYml0cyk7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGhhc2ggPSB0aGlzLndpZHRoOwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgdGhpcy53aWR0aDsKCSAgICAgICAgaGFzaCA9IDMxICogaGFzaCArIHRoaXMuaGVpZ2h0OwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgdGhpcy5yb3dTaXplOwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgQXJyYXlzXzEuZGVmYXVsdC5oYXNoQ29kZSh0aGlzLmJpdHMpOwoJICAgICAgICByZXR1cm4gaGFzaDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIHVzaW5nICJYIiBmb3Igc2V0IGFuZCAiICIgZm9yIHVuc2V0IGJpdHMKCSAgICAgKi8KCSAgICAvKkBPdmVycmlkZSovCgkgICAgLy8gcHVibGljIHRvU3RyaW5nKCk6IHN0cmluZyB7CgkgICAgLy8gICByZXR1cm4gdG9TdHJpbmcoIjogIlgsICIgICIpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBzZXQgYml0CgkgICAgICogQHBhcmFtIHVuc2V0U3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIHVuc2V0IGJpdAoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGVudGlyZSBtYXRyaXggdXRpbGl6aW5nIGdpdmVuIHN0cmluZ3MKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgdG9TdHJpbmcoc2V0U3RyaW5nOiBzdHJpbmcgPSAiWCAiLCB1bnNldFN0cmluZzogc3RyaW5nID0gIiAgIik6IHN0cmluZyB7CgkgICAgLy8gICByZXR1cm4gdGhpcy5idWlsZFRvU3RyaW5nKHNldFN0cmluZywgdW5zZXRTdHJpbmcsICJcbiIpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBzZXQgYml0CgkgICAgICogQHBhcmFtIHVuc2V0U3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIHVuc2V0IGJpdAoJICAgICAqIEBwYXJhbSBsaW5lU2VwYXJhdG9yIG5ld2xpbmUgY2hhcmFjdGVyIGluIHN0cmluZyByZXByZXNlbnRhdGlvbgoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGVudGlyZSBtYXRyaXggdXRpbGl6aW5nIGdpdmVuIHN0cmluZ3MgYW5kIGxpbmUgc2VwYXJhdG9yCgkgICAgICogQGRlcHJlY2F0ZWQgY2FsbCB7QGxpbmsgI3RvU3RyaW5nKFN0cmluZyxTdHJpbmcpfSBvbmx5LCB3aGljaCB1c2VzIFxuIGxpbmUgc2VwYXJhdG9yIGFsd2F5cwoJICAgICAqLwoJICAgIC8vIEBEZXByZWNhdGVkCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uIChzZXRTdHJpbmcsIHVuc2V0U3RyaW5nLCBsaW5lU2VwYXJhdG9yKSB7CgkgICAgICAgIGlmIChzZXRTdHJpbmcgPT09IHZvaWQgMCkgeyBzZXRTdHJpbmcgPSAnWCAnOyB9CgkgICAgICAgIGlmICh1bnNldFN0cmluZyA9PT0gdm9pZCAwKSB7IHVuc2V0U3RyaW5nID0gJyAgJzsgfQoJICAgICAgICBpZiAobGluZVNlcGFyYXRvciA9PT0gdm9pZCAwKSB7IGxpbmVTZXBhcmF0b3IgPSAnXG4nOyB9CgkgICAgICAgIHJldHVybiB0aGlzLmJ1aWxkVG9TdHJpbmcoc2V0U3RyaW5nLCB1bnNldFN0cmluZywgbGluZVNlcGFyYXRvcik7CgkgICAgfTsKCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmJ1aWxkVG9TdHJpbmcgPSBmdW5jdGlvbiAoc2V0U3RyaW5nLCB1bnNldFN0cmluZywgbGluZVNlcGFyYXRvcikgewoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1aWxkZXJfMSQyLmRlZmF1bHQoKTsKCSAgICAgICAgLy8gcmVzdWx0LmFwcGVuZChsaW5lU2VwYXJhdG9yKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDAsIGhlaWdodCA9IHRoaXMuaGVpZ2h0OyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwLCB3aWR0aCA9IHRoaXMud2lkdGg7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LmFwcGVuZCh0aGlzLmdldCh4LCB5KSA/IHNldFN0cmluZyA6IHVuc2V0U3RyaW5nKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQobGluZVNlcGFyYXRvcik7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdC50b1N0cmluZygpOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgQml0TWF0cml4KHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LCB0aGlzLnJvd1NpemUsIHRoaXMuYml0cy5zbGljZSgpKTsKCSAgICB9OwoJICAgIHJldHVybiBCaXRNYXRyaXg7Cgl9KCkpOwoJQml0TWF0cml4JDEuZGVmYXVsdCA9IEJpdE1hdHJpeDsKCgl2YXIgTm90Rm91bmRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShOb3RGb3VuZEV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNSA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBOb3RGb3VuZEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZChOb3RGb3VuZEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBOb3RGb3VuZEV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBOb3RGb3VuZEV4Y2VwdGlvbi5nZXROb3RGb3VuZEluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCk7CgkgICAgfTsKCSAgICBOb3RGb3VuZEV4Y2VwdGlvbi5raW5kID0gJ05vdEZvdW5kRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gTm90Rm91bmRFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDUuZGVmYXVsdCkpOwoJTm90Rm91bmRFeGNlcHRpb24kMS5kZWZhdWx0ID0gTm90Rm91bmRFeGNlcHRpb247CgoJLyoKCSAqIENvcHlyaWdodCAyMDA5IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMkYyA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5jb21tb24geyovCgl2YXIgQmluYXJpemVyXzEgPSBCaW5hcml6ZXIkMTsKCXZhciBCaXRBcnJheV8xID0gQml0QXJyYXkkMTsKCXZhciBCaXRNYXRyaXhfMSQ1ID0gQml0TWF0cml4JDE7Cgl2YXIgTm90Rm91bmRFeGNlcHRpb25fMSQ2ID0gTm90Rm91bmRFeGNlcHRpb24kMTsKCS8qKgoJICogVGhpcyBCaW5hcml6ZXIgaW1wbGVtZW50YXRpb24gdXNlcyB0aGUgb2xkIFpYaW5nIGdsb2JhbCBoaXN0b2dyYW0gYXBwcm9hY2guIEl0IGlzIHN1aXRhYmxlCgkgKiBmb3IgbG93LWVuZCBtb2JpbGUgZGV2aWNlcyB3aGljaCBkb24ndCBoYXZlIGVub3VnaCBDUFUgb3IgbWVtb3J5IHRvIHVzZSBhIGxvY2FsIHRocmVzaG9sZGluZwoJICogYWxnb3JpdGhtLiBIb3dldmVyLCBiZWNhdXNlIGl0IHBpY2tzIGEgZ2xvYmFsIGJsYWNrIHBvaW50LCBpdCBjYW5ub3QgaGFuZGxlIGRpZmZpY3VsdCBzaGFkb3dzCgkgKiBhbmQgZ3JhZGllbnRzLgoJICoKCSAqIEZhc3RlciBtb2JpbGUgZGV2aWNlcyBhbmQgYWxsIGRlc2t0b3AgYXBwbGljYXRpb25zIHNob3VsZCBwcm9iYWJseSB1c2UgSHlicmlkQmluYXJpemVyIGluc3RlYWQuCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGMoR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcihzb3VyY2UpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgc291cmNlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5sdW1pbmFuY2VzID0gR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkVNUFRZOwoJICAgICAgICBfdGhpcy5idWNrZXRzID0gbmV3IEludDMyQXJyYXkoR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkxVTUlOQU5DRV9CVUNLRVRTKTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICAvLyBBcHBsaWVzIHNpbXBsZSBzaGFycGVuaW5nIHRvIHRoZSByb3cgZGF0YSB0byBpbXByb3ZlIHBlcmZvcm1hbmNlIG9mIHRoZSAxRCBSZWFkZXJzLgoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIucHJvdG90eXBlLmdldEJsYWNrUm93ID0gZnVuY3Rpb24gKHkgLyppbnQqLywgcm93KSB7CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgaWYgKHJvdyA9PT0gdW5kZWZpbmVkIHx8IHJvdyA9PT0gbnVsbCB8fCByb3cuZ2V0U2l6ZSgpIDwgd2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBCaXRBcnJheV8xLmRlZmF1bHQod2lkdGgpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgcm93LmNsZWFyKCk7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5pbml0QXJyYXlzKHdpZHRoKTsKCSAgICAgICAgdmFyIGxvY2FsTHVtaW5hbmNlcyA9IHNvdXJjZS5nZXRSb3coeSwgdGhpcy5sdW1pbmFuY2VzKTsKCSAgICAgICAgdmFyIGxvY2FsQnVja2V0cyA9IHRoaXMuYnVja2V0czsKCSAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICBsb2NhbEJ1Y2tldHNbKGxvY2FsTHVtaW5hbmNlc1t4XSAmIDB4ZmYpID4+IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfU0hJRlRdKys7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGJsYWNrUG9pbnQgPSBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuZXN0aW1hdGVCbGFja1BvaW50KGxvY2FsQnVja2V0cyk7CgkgICAgICAgIGlmICh3aWR0aCA8IDMpIHsKCSAgICAgICAgICAgIC8vIFNwZWNpYWwgY2FzZSBmb3IgdmVyeSBzbWFsbCBpbWFnZXMKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgd2lkdGg7IHgrKykgewoJICAgICAgICAgICAgICAgIGlmICgobG9jYWxMdW1pbmFuY2VzW3hdICYgMHhmZikgPCBibGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgIHJvdy5zZXQoeCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdmFyIGxlZnQgPSBsb2NhbEx1bWluYW5jZXNbMF0gJiAweGZmOwoJICAgICAgICAgICAgdmFyIGNlbnRlciA9IGxvY2FsTHVtaW5hbmNlc1sxXSAmIDB4ZmY7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMTsgeCA8IHdpZHRoIC0gMTsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHJpZ2h0ID0gbG9jYWxMdW1pbmFuY2VzW3ggKyAxXSAmIDB4ZmY7CgkgICAgICAgICAgICAgICAgLy8gQSBzaW1wbGUgLTEgNCAtMSBib3ggZmlsdGVyIHdpdGggYSB3ZWlnaHQgb2YgMi4KCSAgICAgICAgICAgICAgICBpZiAoKChjZW50ZXIgKiA0KSAtIGxlZnQgLSByaWdodCkgLyAyIDwgYmxhY2tQb2ludCkgewoJICAgICAgICAgICAgICAgICAgICByb3cuc2V0KHgpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBsZWZ0ID0gY2VudGVyOwoJICAgICAgICAgICAgICAgIGNlbnRlciA9IHJpZ2h0OwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByb3c7CgkgICAgfTsKCSAgICAvLyBEb2VzIG5vdCBzaGFycGVuIHRoZSBkYXRhLCBhcyB0aGlzIGNhbGwgaXMgaW50ZW5kZWQgdG8gb25seSBiZSB1c2VkIGJ5IDJEIFJlYWRlcnMuCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5wcm90b3R5cGUuZ2V0QmxhY2tNYXRyaXggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IHNvdXJjZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIG1hdHJpeCA9IG5ldyBCaXRNYXRyaXhfMSQ1LmRlZmF1bHQod2lkdGgsIGhlaWdodCk7CgkgICAgICAgIC8vIFF1aWNrbHkgY2FsY3VsYXRlcyB0aGUgaGlzdG9ncmFtIGJ5IHNhbXBsaW5nIGZvdXIgcm93cyBmcm9tIHRoZSBpbWFnZS4gVGhpcyBwcm92ZWQgdG8gYmUKCSAgICAgICAgLy8gbW9yZSByb2J1c3Qgb24gdGhlIGJsYWNrYm94IHRlc3RzIHRoYW4gc2FtcGxpbmcgYSBkaWFnb25hbCBhcyB3ZSB1c2VkIHRvIGRvLgoJICAgICAgICB0aGlzLmluaXRBcnJheXMod2lkdGgpOwoJICAgICAgICB2YXIgbG9jYWxCdWNrZXRzID0gdGhpcy5idWNrZXRzOwoJICAgICAgICBmb3IgKHZhciB5ID0gMTsgeSA8IDU7IHkrKykgewoJICAgICAgICAgICAgdmFyIHJvdyA9IE1hdGguZmxvb3IoKGhlaWdodCAqIHkpIC8gNSk7CgkgICAgICAgICAgICB2YXIgbG9jYWxMdW1pbmFuY2VzXzEgPSBzb3VyY2UuZ2V0Um93KHJvdywgdGhpcy5sdW1pbmFuY2VzKTsKCSAgICAgICAgICAgIHZhciByaWdodCA9IE1hdGguZmxvb3IoKHdpZHRoICogNCkgLyA1KTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSBNYXRoLmZsb29yKHdpZHRoIC8gNSk7IHggPCByaWdodDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBpeGVsID0gbG9jYWxMdW1pbmFuY2VzXzFbeF0gJiAweGZmOwoJICAgICAgICAgICAgICAgIGxvY2FsQnVja2V0c1twaXhlbCA+PiBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUXSsrOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciBibGFja1BvaW50ID0gR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLmVzdGltYXRlQmxhY2tQb2ludChsb2NhbEJ1Y2tldHMpOwoJICAgICAgICAvLyBXZSBkZWxheSByZWFkaW5nIHRoZSBlbnRpcmUgaW1hZ2UgbHVtaW5hbmNlIHVudGlsIHRoZSBibGFjayBwb2ludCBlc3RpbWF0aW9uIHN1Y2NlZWRzLgoJICAgICAgICAvLyBBbHRob3VnaCB3ZSBlbmQgdXAgcmVhZGluZyBmb3VyIHJvd3MgdHdpY2UsIGl0IGlzIGNvbnNpc3RlbnQgd2l0aCBvdXIgbW90dG8gb2YKCSAgICAgICAgLy8gImZhaWwgcXVpY2tseSIgd2hpY2ggaXMgbmVjZXNzYXJ5IGZvciBjb250aW51b3VzIHNjYW5uaW5nLgoJICAgICAgICB2YXIgbG9jYWxMdW1pbmFuY2VzID0gc291cmNlLmdldE1hdHJpeCgpOwoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb2Zmc2V0ID0geSAqIHdpZHRoOwoJICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBpeGVsID0gbG9jYWxMdW1pbmFuY2VzW29mZnNldCArIHhdICYgMHhmZjsKCSAgICAgICAgICAgICAgICBpZiAocGl4ZWwgPCBibGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgIG1hdHJpeC5zZXQoeCwgeSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBtYXRyaXg7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLnByb3RvdHlwZS5jcmVhdGVCaW5hcml6ZXIgPSBmdW5jdGlvbiAoc291cmNlKSB7CgkgICAgICAgIHJldHVybiBuZXcgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyKHNvdXJjZSk7CgkgICAgfTsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIucHJvdG90eXBlLmluaXRBcnJheXMgPSBmdW5jdGlvbiAobHVtaW5hbmNlU2l6ZSAvKmludCovKSB7CgkgICAgICAgIGlmICh0aGlzLmx1bWluYW5jZXMubGVuZ3RoIDwgbHVtaW5hbmNlU2l6ZSkgewoJICAgICAgICAgICAgdGhpcy5sdW1pbmFuY2VzID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGx1bWluYW5jZVNpemUpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBidWNrZXRzID0gdGhpcy5idWNrZXRzOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQlVDS0VUUzsgeCsrKSB7CgkgICAgICAgICAgICBidWNrZXRzW3hdID0gMDsKCSAgICAgICAgfQoJICAgIH07CgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLmVzdGltYXRlQmxhY2tQb2ludCA9IGZ1bmN0aW9uIChidWNrZXRzKSB7CgkgICAgICAgIC8vIEZpbmQgdGhlIHRhbGxlc3QgcGVhayBpbiB0aGUgaGlzdG9ncmFtLgoJICAgICAgICB2YXIgbnVtQnVja2V0cyA9IGJ1Y2tldHMubGVuZ3RoOwoJICAgICAgICB2YXIgbWF4QnVja2V0Q291bnQgPSAwOwoJICAgICAgICB2YXIgZmlyc3RQZWFrID0gMDsKCSAgICAgICAgdmFyIGZpcnN0UGVha1NpemUgPSAwOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG51bUJ1Y2tldHM7IHgrKykgewoJICAgICAgICAgICAgaWYgKGJ1Y2tldHNbeF0gPiBmaXJzdFBlYWtTaXplKSB7CgkgICAgICAgICAgICAgICAgZmlyc3RQZWFrID0geDsKCSAgICAgICAgICAgICAgICBmaXJzdFBlYWtTaXplID0gYnVja2V0c1t4XTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChidWNrZXRzW3hdID4gbWF4QnVja2V0Q291bnQpIHsKCSAgICAgICAgICAgICAgICBtYXhCdWNrZXRDb3VudCA9IGJ1Y2tldHNbeF07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gRmluZCB0aGUgc2Vjb25kLXRhbGxlc3QgcGVhayB3aGljaCBpcyBzb21ld2hhdCBmYXIgZnJvbSB0aGUgdGFsbGVzdCBwZWFrLgoJICAgICAgICB2YXIgc2Vjb25kUGVhayA9IDA7CgkgICAgICAgIHZhciBzZWNvbmRQZWFrU2NvcmUgPSAwOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG51bUJ1Y2tldHM7IHgrKykgewoJICAgICAgICAgICAgdmFyIGRpc3RhbmNlVG9CaWdnZXN0ID0geCAtIGZpcnN0UGVhazsKCSAgICAgICAgICAgIC8vIEVuY291cmFnZSBtb3JlIGRpc3RhbnQgc2Vjb25kIHBlYWtzIGJ5IG11bHRpcGx5aW5nIGJ5IHNxdWFyZSBvZiBkaXN0YW5jZS4KCSAgICAgICAgICAgIHZhciBzY29yZSA9IGJ1Y2tldHNbeF0gKiBkaXN0YW5jZVRvQmlnZ2VzdCAqIGRpc3RhbmNlVG9CaWdnZXN0OwoJICAgICAgICAgICAgaWYgKHNjb3JlID4gc2Vjb25kUGVha1Njb3JlKSB7CgkgICAgICAgICAgICAgICAgc2Vjb25kUGVhayA9IHg7CgkgICAgICAgICAgICAgICAgc2Vjb25kUGVha1Njb3JlID0gc2NvcmU7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTWFrZSBzdXJlIGZpcnN0UGVhayBjb3JyZXNwb25kcyB0byB0aGUgYmxhY2sgcGVhay4KCSAgICAgICAgaWYgKGZpcnN0UGVhayA+IHNlY29uZFBlYWspIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gZmlyc3RQZWFrOwoJICAgICAgICAgICAgZmlyc3RQZWFrID0gc2Vjb25kUGVhazsKCSAgICAgICAgICAgIHNlY29uZFBlYWsgPSB0ZW1wOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHRoZXJlIGlzIHRvbyBsaXR0bGUgY29udHJhc3QgaW4gdGhlIGltYWdlIHRvIHBpY2sgYSBtZWFuaW5nZnVsIGJsYWNrIHBvaW50LCB0aHJvdyByYXRoZXIKCSAgICAgICAgLy8gdGhhbiB3YXN0ZSB0aW1lIHRyeWluZyB0byBkZWNvZGUgdGhlIGltYWdlLCBhbmQgcmlzayBmYWxzZSBwb3NpdGl2ZXMuCgkgICAgICAgIGlmIChzZWNvbmRQZWFrIC0gZmlyc3RQZWFrIDw9IG51bUJ1Y2tldHMgLyAxNikgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRmluZCBhIHZhbGxleSBiZXR3ZWVuIHRoZW0gdGhhdCBpcyBsb3cgYW5kIGNsb3NlciB0byB0aGUgd2hpdGUgcGVhay4KCSAgICAgICAgdmFyIGJlc3RWYWxsZXkgPSBzZWNvbmRQZWFrIC0gMTsKCSAgICAgICAgdmFyIGJlc3RWYWxsZXlTY29yZSA9IC0xOwoJICAgICAgICBmb3IgKHZhciB4ID0gc2Vjb25kUGVhayAtIDE7IHggPiBmaXJzdFBlYWs7IHgtLSkgewoJICAgICAgICAgICAgdmFyIGZyb21GaXJzdCA9IHggLSBmaXJzdFBlYWs7CgkgICAgICAgICAgICB2YXIgc2NvcmUgPSBmcm9tRmlyc3QgKiBmcm9tRmlyc3QgKiAoc2Vjb25kUGVhayAtIHgpICogKG1heEJ1Y2tldENvdW50IC0gYnVja2V0c1t4XSk7CgkgICAgICAgICAgICBpZiAoc2NvcmUgPiBiZXN0VmFsbGV5U2NvcmUpIHsKCSAgICAgICAgICAgICAgICBiZXN0VmFsbGV5ID0geDsKCSAgICAgICAgICAgICAgICBiZXN0VmFsbGV5U2NvcmUgPSBzY29yZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gYmVzdFZhbGxleSA8PCBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUOwoJICAgIH07CgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkxVTUlOQU5DRV9CSVRTID0gNTsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUID0gOCAtIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQklUUzsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX0JVQ0tFVFMgPSAxIDw8IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQklUUzsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuRU1QVFkgPSBVaW50OENsYW1wZWRBcnJheS5mcm9tKFswXSk7CgkgICAgcmV0dXJuIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcjsKCX0oQmluYXJpemVyXzEuZGVmYXVsdCkpOwoJR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyJDEuZGVmYXVsdCA9IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcjsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fZXh0ZW5kcyRiID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEh5YnJpZEJpbmFyaXplciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyXzEgPSBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMTsKCXZhciBCaXRNYXRyaXhfMSQ0ID0gQml0TWF0cml4JDE7CgkvKioKCSAqIFRoaXMgY2xhc3MgaW1wbGVtZW50cyBhIGxvY2FsIHRocmVzaG9sZGluZyBhbGdvcml0aG0sIHdoaWNoIHdoaWxlIHNsb3dlciB0aGFuIHRoZQoJICogR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLCBpcyBmYWlybHkgZWZmaWNpZW50IGZvciB3aGF0IGl0IGRvZXMuIEl0IGlzIGRlc2lnbmVkIGZvcgoJICogaGlnaCBmcmVxdWVuY3kgaW1hZ2VzIG9mIGJhcmNvZGVzIHdpdGggYmxhY2sgZGF0YSBvbiB3aGl0ZSBiYWNrZ3JvdW5kcy4gRm9yIHRoaXMgYXBwbGljYXRpb24sCgkgKiBpdCBkb2VzIGEgbXVjaCBiZXR0ZXIgam9iIHRoYW4gYSBnbG9iYWwgYmxhY2twb2ludCB3aXRoIHNldmVyZSBzaGFkb3dzIGFuZCBncmFkaWVudHMuCgkgKiBIb3dldmVyIGl0IHRlbmRzIHRvIHByb2R1Y2UgYXJ0aWZhY3RzIG9uIGxvd2VyIGZyZXF1ZW5jeSBpbWFnZXMgYW5kIGlzIHRoZXJlZm9yZSBub3QKCSAqIGEgZ29vZCBnZW5lcmFsIHB1cnBvc2UgYmluYXJpemVyIGZvciB1c2VzIG91dHNpZGUgWlhpbmcuCgkgKgoJICogVGhpcyBjbGFzcyBleHRlbmRzIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplciwgdXNpbmcgdGhlIG9sZGVyIGhpc3RvZ3JhbSBhcHByb2FjaCBmb3IgMUQgcmVhZGVycywKCSAqIGFuZCB0aGUgbmV3ZXIgbG9jYWwgYXBwcm9hY2ggZm9yIDJEIHJlYWRlcnMuIDFEIGRlY29kaW5nIHVzaW5nIGEgcGVyLXJvdyBoaXN0b2dyYW0gaXMgYWxyZWFkeQoJICogaW5oZXJlbnRseSBsb2NhbCwgYW5kIG9ubHkgZmFpbHMgZm9yIGhvcml6b250YWwgZ3JhZGllbnRzLiBXZSBjYW4gcmV2aXNpdCB0aGF0IHByb2JsZW0gbGF0ZXIsCgkgKiBidXQgZm9yIG5vdyBpdCB3YXMgbm90IGEgd2luIHRvIHVzZSBsb2NhbCBibG9ja3MgZm9yIDFELgoJICoKCSAqIFRoaXMgQmluYXJpemVyIGlzIHRoZSBkZWZhdWx0IGZvciB0aGUgdW5pdCB0ZXN0cyBhbmQgdGhlIHJlY29tbWVuZGVkIGNsYXNzIGZvciBsaWJyYXJ5IHVzZXJzLgoJICoKCSAqIEBhdXRob3IgZHN3aXRraW5AZ29vZ2xlLmNvbSAoRGFuaWVsIFN3aXRraW4pCgkgKi8KCXZhciBIeWJyaWRCaW5hcml6ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGIoSHlicmlkQmluYXJpemVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEh5YnJpZEJpbmFyaXplcihzb3VyY2UpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgc291cmNlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5tYXRyaXggPSBudWxsOwoJICAgICAgICByZXR1cm4gX3RoaXM7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIENhbGN1bGF0ZXMgdGhlIGZpbmFsIEJpdE1hdHJpeCBvbmNlIGZvciBhbGwgcmVxdWVzdHMuIFRoaXMgY291bGQgYmUgY2FsbGVkIG9uY2UgZnJvbSB0aGUKCSAgICAgKiBjb25zdHJ1Y3RvciBpbnN0ZWFkLCBidXQgdGhlcmUgYXJlIHNvbWUgYWR2YW50YWdlcyB0byBkb2luZyBpdCBsYXppbHksIHN1Y2ggYXMgbWFraW5nCgkgICAgICogcHJvZmlsaW5nIGVhc2llciwgYW5kIG5vdCBkb2luZyBoZWF2eSBsaWZ0aW5nIHdoZW4gY2FsbGVycyBkb24ndCBleHBlY3QgaXQuCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEh5YnJpZEJpbmFyaXplci5wcm90b3R5cGUuZ2V0QmxhY2tNYXRyaXggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLm1hdHJpeCAhPT0gbnVsbCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0cml4OwoJICAgICAgICB9CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IHNvdXJjZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgaWYgKHdpZHRoID49IEh5YnJpZEJpbmFyaXplci5NSU5JTVVNX0RJTUVOU0lPTiAmJiBoZWlnaHQgPj0gSHlicmlkQmluYXJpemVyLk1JTklNVU1fRElNRU5TSU9OKSB7CgkgICAgICAgICAgICB2YXIgbHVtaW5hbmNlcyA9IHNvdXJjZS5nZXRNYXRyaXgoKTsKCSAgICAgICAgICAgIHZhciBzdWJXaWR0aCA9IHdpZHRoID4+IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKCh3aWR0aCAmIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0spICE9PSAwKSB7CgkgICAgICAgICAgICAgICAgc3ViV2lkdGgrKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhciBzdWJIZWlnaHQgPSBoZWlnaHQgPj4gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7CgkgICAgICAgICAgICBpZiAoKGhlaWdodCAmIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0spICE9PSAwKSB7CgkgICAgICAgICAgICAgICAgc3ViSGVpZ2h0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgYmxhY2tQb2ludHMgPSBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlQmxhY2tQb2ludHMobHVtaW5hbmNlcywgc3ViV2lkdGgsIHN1YkhlaWdodCwgd2lkdGgsIGhlaWdodCk7CgkgICAgICAgICAgICB2YXIgbmV3TWF0cml4ID0gbmV3IEJpdE1hdHJpeF8xJDQuZGVmYXVsdCh3aWR0aCwgaGVpZ2h0KTsKCSAgICAgICAgICAgIEh5YnJpZEJpbmFyaXplci5jYWxjdWxhdGVUaHJlc2hvbGRGb3JCbG9jayhsdW1pbmFuY2VzLCBzdWJXaWR0aCwgc3ViSGVpZ2h0LCB3aWR0aCwgaGVpZ2h0LCBibGFja1BvaW50cywgbmV3TWF0cml4KTsKCSAgICAgICAgICAgIHRoaXMubWF0cml4ID0gbmV3TWF0cml4OwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgLy8gSWYgdGhlIGltYWdlIGlzIHRvbyBzbWFsbCwgZmFsbCBiYWNrIHRvIHRoZSBnbG9iYWwgaGlzdG9ncmFtIGFwcHJvYWNoLgoJICAgICAgICAgICAgdGhpcy5tYXRyaXggPSBfc3VwZXIucHJvdG90eXBlLmdldEJsYWNrTWF0cml4LmNhbGwodGhpcyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMubWF0cml4OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEh5YnJpZEJpbmFyaXplci5wcm90b3R5cGUuY3JlYXRlQmluYXJpemVyID0gZnVuY3Rpb24gKHNvdXJjZSkgewoJICAgICAgICByZXR1cm4gbmV3IEh5YnJpZEJpbmFyaXplcihzb3VyY2UpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRm9yIGVhY2ggYmxvY2sgaW4gdGhlIGltYWdlLCBjYWxjdWxhdGUgdGhlIGF2ZXJhZ2UgYmxhY2sgcG9pbnQgdXNpbmcgYSA1eDUgZ3JpZAoJICAgICAqIG9mIHRoZSBibG9ja3MgYXJvdW5kIGl0LiBBbHNvIGhhbmRsZXMgdGhlIGNvcm5lciBjYXNlcyAoZnJhY3Rpb25hbCBibG9ja3MgYXJlIGNvbXB1dGVkIGJhc2VkCgkgICAgICogb24gdGhlIGxhc3QgcGl4ZWxzIGluIHRoZSByb3cvY29sdW1uIHdoaWNoIGFyZSBhbHNvIHVzZWQgaW4gdGhlIHByZXZpb3VzIGJsb2NrKS4KCSAgICAgKi8KCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlVGhyZXNob2xkRm9yQmxvY2sgPSBmdW5jdGlvbiAobHVtaW5hbmNlcywgc3ViV2lkdGggLyppbnQqLywgc3ViSGVpZ2h0IC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovLCBibGFja1BvaW50cywgbWF0cml4KSB7CgkgICAgICAgIHZhciBtYXhZT2Zmc2V0ID0gaGVpZ2h0IC0gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7CgkgICAgICAgIHZhciBtYXhYT2Zmc2V0ID0gd2lkdGggLSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBzdWJIZWlnaHQ7IHkrKykgewoJICAgICAgICAgICAgdmFyIHlvZmZzZXQgPSB5IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKHlvZmZzZXQgPiBtYXhZT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgeW9mZnNldCA9IG1heFlPZmZzZXQ7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgdG9wXzEgPSBIeWJyaWRCaW5hcml6ZXIuY2FwKHksIDIsIHN1YkhlaWdodCAtIDMpOwoJICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBzdWJXaWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHhvZmZzZXQgPSB4IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgICAgIGlmICh4b2Zmc2V0ID4gbWF4WE9mZnNldCkgewoJICAgICAgICAgICAgICAgICAgICB4b2Zmc2V0ID0gbWF4WE9mZnNldDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgdmFyIGxlZnQgPSBIeWJyaWRCaW5hcml6ZXIuY2FwKHgsIDIsIHN1YldpZHRoIC0gMyk7CgkgICAgICAgICAgICAgICAgdmFyIHN1bSA9IDA7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgeiA9IC0yOyB6IDw9IDI7IHorKykgewoJICAgICAgICAgICAgICAgICAgICB2YXIgYmxhY2tSb3cgPSBibGFja1BvaW50c1t0b3BfMSArIHpdOwoJICAgICAgICAgICAgICAgICAgICBzdW0gKz0gYmxhY2tSb3dbbGVmdCAtIDJdICsgYmxhY2tSb3dbbGVmdCAtIDFdICsgYmxhY2tSb3dbbGVmdF0gKyBibGFja1Jvd1tsZWZ0ICsgMV0gKyBibGFja1Jvd1tsZWZ0ICsgMl07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHZhciBhdmVyYWdlID0gc3VtIC8gMjU7CgkgICAgICAgICAgICAgICAgSHlicmlkQmluYXJpemVyLnRocmVzaG9sZEJsb2NrKGx1bWluYW5jZXMsIHhvZmZzZXQsIHlvZmZzZXQsIGF2ZXJhZ2UsIHdpZHRoLCBtYXRyaXgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FwID0gZnVuY3Rpb24gKHZhbHVlIC8qaW50Ki8sIG1pbiAvKmludCovLCBtYXggLyppbnQqLykgewoJICAgICAgICByZXR1cm4gdmFsdWUgPCBtaW4gPyBtaW4gOiB2YWx1ZSA+IG1heCA/IG1heCA6IHZhbHVlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQXBwbGllcyBhIHNpbmdsZSB0aHJlc2hvbGQgdG8gYSBibG9jayBvZiBwaXhlbHMuCgkgICAgICovCgkgICAgSHlicmlkQmluYXJpemVyLnRocmVzaG9sZEJsb2NrID0gZnVuY3Rpb24gKGx1bWluYW5jZXMsIHhvZmZzZXQgLyppbnQqLywgeW9mZnNldCAvKmludCovLCB0aHJlc2hvbGQgLyppbnQqLywgc3RyaWRlIC8qaW50Ki8sIG1hdHJpeCkgewoJICAgICAgICBmb3IgKHZhciB5ID0gMCwgb2Zmc2V0ID0geW9mZnNldCAqIHN0cmlkZSArIHhvZmZzZXQ7IHkgPCBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsgeSsrLCBvZmZzZXQgKz0gc3RyaWRlKSB7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFOyB4KyspIHsKCSAgICAgICAgICAgICAgICAvLyBDb21wYXJpc29uIG5lZWRzIHRvIGJlIDw9IHNvIHRoYXQgYmxhY2sgPT0gMCBwaXhlbHMgYXJlIGJsYWNrIGV2ZW4gaWYgdGhlIHRocmVzaG9sZCBpcyAwLgoJICAgICAgICAgICAgICAgIGlmICgobHVtaW5hbmNlc1tvZmZzZXQgKyB4XSAmIDB4RkYpIDw9IHRocmVzaG9sZCkgewoJICAgICAgICAgICAgICAgICAgICBtYXRyaXguc2V0KHhvZmZzZXQgKyB4LCB5b2Zmc2V0ICsgeSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDYWxjdWxhdGVzIGEgc2luZ2xlIGJsYWNrIHBvaW50IGZvciBlYWNoIGJsb2NrIG9mIHBpeGVscyBhbmQgc2F2ZXMgaXQgYXdheS4KCSAgICAgKiBTZWUgdGhlIGZvbGxvd2luZyB0aHJlYWQgZm9yIGEgZGlzY3Vzc2lvbiBvZiB0aGlzIGFsZ29yaXRobToKCSAgICAgKiAgaHR0cDovL2dyb3Vwcy5nb29nbGUuY29tL2dyb3VwL3p4aW5nL2Jyb3dzZV90aHJlYWQvdGhyZWFkL2QwNmVmYTJjMzVhN2RkYzAKCSAgICAgKi8KCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlQmxhY2tQb2ludHMgPSBmdW5jdGlvbiAobHVtaW5hbmNlcywgc3ViV2lkdGggLyppbnQqLywgc3ViSGVpZ2h0IC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHZhciBtYXhZT2Zmc2V0ID0gaGVpZ2h0IC0gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7CgkgICAgICAgIHZhciBtYXhYT2Zmc2V0ID0gd2lkdGggLSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsKCSAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOndoaXRlc3BhY2UKCSAgICAgICAgdmFyIGJsYWNrUG9pbnRzID0gbmV3IEFycmF5KHN1YkhlaWdodCk7IC8vIHN1YldpZHRoCgkgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgc3ViSGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGJsYWNrUG9pbnRzW3ldID0gbmV3IEludDMyQXJyYXkoc3ViV2lkdGgpOwoJICAgICAgICAgICAgdmFyIHlvZmZzZXQgPSB5IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKHlvZmZzZXQgPiBtYXhZT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgeW9mZnNldCA9IG1heFlPZmZzZXQ7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHN1YldpZHRoOyB4KyspIHsKCSAgICAgICAgICAgICAgICB2YXIgeG9mZnNldCA9IHggPDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7CgkgICAgICAgICAgICAgICAgaWYgKHhvZmZzZXQgPiBtYXhYT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgICAgIHhvZmZzZXQgPSBtYXhYT2Zmc2V0OwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB2YXIgc3VtID0gMDsKCSAgICAgICAgICAgICAgICB2YXIgbWluID0gMHhGRjsKCSAgICAgICAgICAgICAgICB2YXIgbWF4ID0gMDsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciB5eSA9IDAsIG9mZnNldCA9IHlvZmZzZXQgKiB3aWR0aCArIHhvZmZzZXQ7IHl5IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHl5KyssIG9mZnNldCArPSB3aWR0aCkgewoJICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB4eCA9IDA7IHh4IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHh4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwaXhlbCA9IGx1bWluYW5jZXNbb2Zmc2V0ICsgeHhdICYgMHhGRjsKCSAgICAgICAgICAgICAgICAgICAgICAgIHN1bSArPSBwaXhlbDsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0aWxsIGxvb2tpbmcgZm9yIGdvb2QgY29udHJhc3QKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwaXhlbCA8IG1pbikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbiA9IHBpeGVsOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBpeGVsID4gbWF4KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4ID0gcGl4ZWw7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgLy8gc2hvcnQtY2lyY3VpdCBtaW4vbWF4IHRlc3RzIG9uY2UgZHluYW1pYyByYW5nZSBpcyBtZXQKCSAgICAgICAgICAgICAgICAgICAgaWYgKG1heCAtIG1pbiA+IEh5YnJpZEJpbmFyaXplci5NSU5fRFlOQU1JQ19SQU5HRSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmluaXNoIHRoZSByZXN0IG9mIHRoZSByb3dzIHF1aWNrbHkKCSAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoeXkrKywgb2Zmc2V0ICs9IHdpZHRoOyB5eSA8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFOyB5eSsrLCBvZmZzZXQgKz0gd2lkdGgpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB4eCA9IDA7IHh4IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHh4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VtICs9IGx1bWluYW5jZXNbb2Zmc2V0ICsgeHhdICYgMHhGRjsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgLy8gVGhlIGRlZmF1bHQgZXN0aW1hdGUgaXMgdGhlIGF2ZXJhZ2Ugb2YgdGhlIHZhbHVlcyBpbiB0aGUgYmxvY2suCgkgICAgICAgICAgICAgICAgdmFyIGF2ZXJhZ2UgPSBzdW0gPj4gKEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSICogMik7CgkgICAgICAgICAgICAgICAgaWYgKG1heCAtIG1pbiA8PSBIeWJyaWRCaW5hcml6ZXIuTUlOX0RZTkFNSUNfUkFOR0UpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gSWYgdmFyaWF0aW9uIHdpdGhpbiB0aGUgYmxvY2sgaXMgbG93LCBhc3N1bWUgdGhpcyBpcyBhIGJsb2NrIHdpdGggb25seSBsaWdodCBvciBvbmx5CgkgICAgICAgICAgICAgICAgICAgIC8vIGRhcmsgcGl4ZWxzLiBJbiB0aGF0IGNhc2Ugd2UgZG8gbm90IHdhbnQgdG8gdXNlIHRoZSBhdmVyYWdlLCBhcyBpdCB3b3VsZCBkaXZpZGUgdGhpcwoJICAgICAgICAgICAgICAgICAgICAvLyBsb3cgY29udHJhc3QgYXJlYSBpbnRvIGJsYWNrIGFuZCB3aGl0ZSBwaXhlbHMsIGVzc2VudGlhbGx5IGNyZWF0aW5nIGRhdGEgb3V0IG9mIG5vaXNlLgoJICAgICAgICAgICAgICAgICAgICAvLwoJICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZGVmYXVsdCBhc3N1bXB0aW9uIGlzIHRoYXQgdGhlIGJsb2NrIGlzIGxpZ2h0L2JhY2tncm91bmQuIFNpbmNlIG5vIGVzdGltYXRlIGZvcgoJICAgICAgICAgICAgICAgICAgICAvLyB0aGUgbGV2ZWwgb2YgZGFyayBwaXhlbHMgZXhpc3RzIGxvY2FsbHksIHVzZSBoYWxmIHRoZSBtaW4gZm9yIHRoZSBibG9jay4KCSAgICAgICAgICAgICAgICAgICAgYXZlcmFnZSA9IG1pbiAvIDI7CgkgICAgICAgICAgICAgICAgICAgIGlmICh5ID4gMCAmJiB4ID4gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29ycmVjdCB0aGUgIndoaXRlIGJhY2tncm91bmQiIGFzc3VtcHRpb24gZm9yIGJsb2NrcyB0aGF0IGhhdmUgbmVpZ2hib3JzIGJ5IGNvbXBhcmluZwoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHBpeGVscyBpbiB0aGlzIGJsb2NrIHRvIHRoZSBwcmV2aW91c2x5IGNhbGN1bGF0ZWQgYmxhY2sgcG9pbnRzLiBUaGlzIGlzIGJhc2VkIG9uCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgZmFjdCB0aGF0IGRhcmsgYmFyY29kZSBzeW1ib2xvZ3kgaXMgYWx3YXlzIHN1cnJvdW5kZWQgYnkgc29tZSBhbW91bnQgb2YgbGlnaHQKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJhY2tncm91bmQgZm9yIHdoaWNoIHJlYXNvbmFibGUgYmxhY2sgcG9pbnQgZXN0aW1hdGVzIHdlcmUgbWFkZS4gVGhlIGJwIGVzdGltYXRlZCBhdAoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGJvdW5kYXJpZXMgaXMgdXNlZCBmb3IgdGhlIGludGVyaW9yLgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIChtaW4gPCBicCkgaXMgYXJiaXRyYXJ5IGJ1dCB3b3JrcyBiZXR0ZXIgdGhhbiBvdGhlciBoZXVyaXN0aWNzIHRoYXQgd2VyZSB0cmllZC4KCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdmVyYWdlTmVpZ2hib3JCbGFja1BvaW50ID0gKGJsYWNrUG9pbnRzW3kgLSAxXVt4XSArICgyICogYmxhY2tQb2ludHNbeV1beCAtIDFdKSArIGJsYWNrUG9pbnRzW3kgLSAxXVt4IC0gMV0pIC8gNDsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtaW4gPCBhdmVyYWdlTmVpZ2hib3JCbGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZlcmFnZSA9IGF2ZXJhZ2VOZWlnaGJvckJsYWNrUG9pbnQ7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgYmxhY2tQb2ludHNbeV1beF0gPSBhdmVyYWdlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBibGFja1BvaW50czsKCSAgICB9OwoJICAgIC8vIFRoaXMgY2xhc3MgdXNlcyA1eDUgYmxvY2tzIHRvIGNvbXB1dGUgbG9jYWwgbHVtaW5hbmNlLCB3aGVyZSBlYWNoIGJsb2NrIGlzIDh4OCBwaXhlbHMuCgkgICAgLy8gU28gdGhpcyBpcyB0aGUgc21hbGxlc3QgZGltZW5zaW9uIGluIGVhY2ggYXhpcyB3ZSBjYW4gYWNjZXB0LgoJICAgIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSID0gMzsKCSAgICBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRSA9IDEgPDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7IC8vIC4uLjAxMDAuLi4wMAoJICAgIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0sgPSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRSAtIDE7IC8vIC4uLjAwMTEuLi4xMQoJICAgIEh5YnJpZEJpbmFyaXplci5NSU5JTVVNX0RJTUVOU0lPTiA9IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFICogNTsKCSAgICBIeWJyaWRCaW5hcml6ZXIuTUlOX0RZTkFNSUNfUkFOR0UgPSAyNDsKCSAgICByZXR1cm4gSHlicmlkQmluYXJpemVyOwoJfShHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXJfMS5kZWZhdWx0KSk7Cgl2YXIgX2RlZmF1bHQkMiA9IEh5YnJpZEJpbmFyaXplciQxLmRlZmF1bHQgPSBIeWJyaWRCaW5hcml6ZXI7CgoJdmFyIFJHQkx1bWluYW5jZVNvdXJjZSQxID0ge307CgoJdmFyIEludmVydGVkTHVtaW5hbmNlU291cmNlJDEgPSB7fTsKCgl2YXIgTHVtaW5hbmNlU291cmNlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEx1bWluYW5jZVNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3RyaW5nQnVpbGRlcl8xJDEgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMSA9IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uJDE7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nIHsqLwoJLyoqCgkgKiBUaGUgcHVycG9zZSBvZiB0aGlzIGNsYXNzIGhpZXJhcmNoeSBpcyB0byBhYnN0cmFjdCBkaWZmZXJlbnQgYml0bWFwIGltcGxlbWVudGF0aW9ucyBhY3Jvc3MKCSAqIHBsYXRmb3JtcyBpbnRvIGEgc3RhbmRhcmQgaW50ZXJmYWNlIGZvciByZXF1ZXN0aW5nIGdyZXlzY2FsZSBsdW1pbmFuY2UgdmFsdWVzLiBUaGUgaW50ZXJmYWNlCgkgKiBvbmx5IHByb3ZpZGVzIGltbXV0YWJsZSBtZXRob2RzOyB0aGVyZWZvcmUgY3JvcCBhbmQgcm90YXRpb24gY3JlYXRlIGNvcGllcy4gVGhpcyBpcyB0byBlbnN1cmUKCSAqIHRoYXQgb25lIFJlYWRlciBkb2VzIG5vdCBtb2RpZnkgdGhlIG9yaWdpbmFsIGx1bWluYW5jZSBzb3VyY2UgYW5kIGxlYXZlIGl0IGluIGFuIHVua25vd24gc3RhdGUKCSAqIGZvciBvdGhlciBSZWFkZXJzIGluIHRoZSBjaGFpbi4KCSAqCgkgKiBAYXV0aG9yIGRzd2l0a2luQGdvb2dsZS5jb20gKERhbmllbCBTd2l0a2luKQoJICovCgl2YXIgTHVtaW5hbmNlU291cmNlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEx1bWluYW5jZVNvdXJjZSh3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7CgkgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwoJICAgIH0KCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSB3aWR0aCBvZiB0aGUgYml0bWFwLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuZ2V0V2lkdGggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLndpZHRoOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBUaGUgaGVpZ2h0IG9mIHRoZSBiaXRtYXAuCgkgICAgICovCgkgICAgTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRIZWlnaHQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmhlaWdodDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIHN1YmNsYXNzIHN1cHBvcnRzIGNyb3BwaW5nLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNDcm9wU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIGEgbmV3IG9iamVjdCB3aXRoIGNyb3BwZWQgaW1hZ2UgZGF0YS4gSW1wbGVtZW50YXRpb25zIG1heSBrZWVwIGEgcmVmZXJlbmNlIHRvIHRoZQoJICAgICAqIG9yaWdpbmFsIGRhdGEgcmF0aGVyIHRoYW4gYSBjb3B5LiBPbmx5IGNhbGxhYmxlIGlmIGlzQ3JvcFN1cHBvcnRlZCgpIGlzIHRydWUuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gbGVmdCBUaGUgbGVmdCBjb29yZGluYXRlLCB3aGljaCBtdXN0IGJlIGluIFswLGdldFdpZHRoKCkpCgkgICAgICogQHBhcmFtIHRvcCBUaGUgdG9wIGNvb3JkaW5hdGUsIHdoaWNoIG11c3QgYmUgaW4gWzAsZ2V0SGVpZ2h0KCkpCgkgICAgICogQHBhcmFtIHdpZHRoIFRoZSB3aWR0aCBvZiB0aGUgcmVjdGFuZ2xlIHRvIGNyb3AuCgkgICAgICogQHBhcmFtIGhlaWdodCBUaGUgaGVpZ2h0IG9mIHRoZSByZWN0YW5nbGUgdG8gY3JvcC4KCSAgICAgKiBAcmV0dXJuIEEgY3JvcHBlZCB2ZXJzaW9uIG9mIHRoaXMgb2JqZWN0LgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuY3JvcCA9IGZ1bmN0aW9uIChsZWZ0IC8qaW50Ki8sIHRvcCAvKmludCovLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMS5kZWZhdWx0KCdUaGlzIGx1bWluYW5jZSBzb3VyY2UgZG9lcyBub3Qgc3VwcG9ydCBjcm9wcGluZy4nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIHN1YmNsYXNzIHN1cHBvcnRzIGNvdW50ZXItY2xvY2t3aXNlIHJvdGF0aW9uLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNSb3RhdGVTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggcm90YXRlZCBpbWFnZSBkYXRhIGJ5IDkwIGRlZ3JlZXMgY291bnRlcmNsb2Nrd2lzZS4KCSAgICAgKiBPbmx5IGNhbGxhYmxlIGlmIHtAbGluayAjaXNSb3RhdGVTdXBwb3J0ZWQoKX0gaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gQSByb3RhdGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMS5kZWZhdWx0KCdUaGlzIGx1bWluYW5jZSBzb3VyY2UgZG9lcyBub3Qgc3VwcG9ydCByb3RhdGlvbiBieSA5MCBkZWdyZWVzLicpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV0dXJucyBhIG5ldyBvYmplY3Qgd2l0aCByb3RhdGVkIGltYWdlIGRhdGEgYnkgNDUgZGVncmVlcyBjb3VudGVyY2xvY2t3aXNlLgoJICAgICAqIE9ubHkgY2FsbGFibGUgaWYge0BsaW5rICNpc1JvdGF0ZVN1cHBvcnRlZCgpfSBpcyB0cnVlLgoJICAgICAqCgkgICAgICogQHJldHVybiBBIHJvdGF0ZWQgdmVyc2lvbiBvZiB0aGlzIG9iamVjdC4KCSAgICAgKi8KCSAgICBMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLnJvdGF0ZUNvdW50ZXJDbG9ja3dpc2U0NSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uXzEuZGVmYXVsdCgnVGhpcyBsdW1pbmFuY2Ugc291cmNlIGRvZXMgbm90IHN1cHBvcnQgcm90YXRpb24gYnkgNDUgZGVncmVlcy4nKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgcm93ID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHRoaXMud2lkdGgpOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1aWxkZXJfMSQxLmRlZmF1bHQoKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCB0aGlzLmhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgc291cmNlUm93ID0gdGhpcy5nZXRSb3coeSwgcm93KTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgdGhpcy53aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGx1bWluYW5jZSA9IHNvdXJjZVJvd1t4XSAmIDB4RkY7CgkgICAgICAgICAgICAgICAgdmFyIGMgPSB2b2lkIDA7CgkgICAgICAgICAgICAgICAgaWYgKGx1bWluYW5jZSA8IDB4NDApIHsKCSAgICAgICAgICAgICAgICAgICAgYyA9ICcjJzsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAobHVtaW5hbmNlIDwgMHg4MCkgewoJICAgICAgICAgICAgICAgICAgICBjID0gJysnOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIGlmIChsdW1pbmFuY2UgPCAweEMwKSB7CgkgICAgICAgICAgICAgICAgICAgIGMgPSAnLic7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICBjID0gJyAnOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICByZXN1bHQuYXBwZW5kKGMpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZCgnXG4nKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0LnRvU3RyaW5nKCk7CgkgICAgfTsKCSAgICByZXR1cm4gTHVtaW5hbmNlU291cmNlOwoJfSgpKTsKCUx1bWluYW5jZVNvdXJjZSQxLmRlZmF1bHQgPSBMdW1pbmFuY2VTb3VyY2U7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA5IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMkYSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbnZlcnRlZEx1bWluYW5jZVNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgTHVtaW5hbmNlU291cmNlXzEkMSA9IEx1bWluYW5jZVNvdXJjZSQxOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogQSB3cmFwcGVyIGltcGxlbWVudGF0aW9uIG9mIHtAbGluayBMdW1pbmFuY2VTb3VyY2V9IHdoaWNoIGludmVydHMgdGhlIGx1bWluYW5jZXMgaXQgcmV0dXJucyAtLSBibGFjayBiZWNvbWVzCgkgKiB3aGl0ZSBhbmQgdmljZSB2ZXJzYSwgYW5kIGVhY2ggdmFsdWUgYmVjb21lcyAoMjU1LXZhbHVlKS4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGEoSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UsIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UoZGVsZWdhdGUpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgZGVsZWdhdGUuZ2V0V2lkdGgoKSwgZGVsZWdhdGUuZ2V0SGVpZ2h0KCkpIHx8IHRoaXM7CgkgICAgICAgIF90aGlzLmRlbGVnYXRlID0gZGVsZWdhdGU7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgdmFyIHNvdXJjZVJvdyA9IHRoaXMuZGVsZWdhdGUuZ2V0Um93KHksIHJvdyk7CgkgICAgICAgIHZhciB3aWR0aCA9IHRoaXMuZ2V0V2lkdGgoKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3aWR0aDsgaSsrKSB7CgkgICAgICAgICAgICBzb3VyY2VSb3dbaV0gPSAvKihieXRlKSovICgyNTUgLSAoc291cmNlUm93W2ldICYgMHhGRikpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBzb3VyY2VSb3c7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLmdldE1hdHJpeCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIG1hdHJpeCA9IHRoaXMuZGVsZWdhdGUuZ2V0TWF0cml4KCk7CgkgICAgICAgIHZhciBsZW5ndGggPSB0aGlzLmdldFdpZHRoKCkgKiB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgaW52ZXJ0ZWRNYXRyaXggPSBuZXcgVWludDhDbGFtcGVkQXJyYXkobGVuZ3RoKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewoJICAgICAgICAgICAgaW52ZXJ0ZWRNYXRyaXhbaV0gPSAvKihieXRlKSovICgyNTUgLSAobWF0cml4W2ldICYgMHhGRikpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBpbnZlcnRlZE1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNDcm9wU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5kZWxlZ2F0ZS5pc0Nyb3BTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuY3JvcCA9IGZ1bmN0aW9uIChsZWZ0IC8qaW50Ki8sIHRvcCAvKmludCovLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUuY3JvcChsZWZ0LCB0b3AsIHdpZHRoLCBoZWlnaHQpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNSb3RhdGVTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlbGVnYXRlLmlzUm90YXRlU3VwcG9ydGVkKCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIG9yaWdpbmFsIGRlbGVnYXRlIHtAbGluayBMdW1pbmFuY2VTb3VyY2V9IHNpbmNlIGludmVydCB1bmRvZXMgaXRzZWxmCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5pbnZlcnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlbGVnYXRlOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUucm90YXRlQ291bnRlckNsb2Nrd2lzZSgpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1KCkpOwoJICAgIH07CgkgICAgcmV0dXJuIEludmVydGVkTHVtaW5hbmNlU291cmNlOwoJfShMdW1pbmFuY2VTb3VyY2VfMSQxLmRlZmF1bHQpKTsKCUludmVydGVkTHVtaW5hbmNlU291cmNlJDEuZGVmYXVsdCA9IEludmVydGVkTHVtaW5hbmNlU291cmNlOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDkgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoUkdCTHVtaW5hbmNlU291cmNlJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcgeyovCgkgLy8gcmVxdWlyZWQgYmVjYXVzZSBvZiBjaXJjdWxhciBkZXBlbmRlbmNpZXMgYmV0d2VlbiBMdW1pbmFuY2VTb3VyY2UgYW5kIEludmVydGVkTHVtaW5hbmNlU291cmNlCgl2YXIgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2VfMSA9IEludmVydGVkTHVtaW5hbmNlU291cmNlJDE7Cgl2YXIgTHVtaW5hbmNlU291cmNlXzEgPSBMdW1pbmFuY2VTb3VyY2UkMTsKCXZhciBTeXN0ZW1fMSQyID0gU3lzdGVtJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNiA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBUaGlzIGNsYXNzIGlzIHVzZWQgdG8gaGVscCBkZWNvZGUgaW1hZ2VzIGZyb20gZmlsZXMgd2hpY2ggYXJyaXZlIGFzIFJHQiBkYXRhIGZyb20KCSAqIGFuIEFSR0IgcGl4ZWwgYXJyYXkuIEl0IGRvZXMgbm90IHN1cHBvcnQgcm90YXRpb24uCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBhdXRob3IgQmV0YW1pbm9zCgkgKi8KCXZhciBSR0JMdW1pbmFuY2VTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDkoUkdCTHVtaW5hbmNlU291cmNlLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIFJHQkx1bWluYW5jZVNvdXJjZShsdW1pbmFuY2VzLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLywgZGF0YVdpZHRoIC8qaW50Ki8sIGRhdGFIZWlnaHQgLyppbnQqLywgbGVmdCAvKmludCovLCB0b3AgLyppbnQqLykgewoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCB3aWR0aCwgaGVpZ2h0KSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5kYXRhV2lkdGggPSBkYXRhV2lkdGg7CgkgICAgICAgIF90aGlzLmRhdGFIZWlnaHQgPSBkYXRhSGVpZ2h0OwoJICAgICAgICBfdGhpcy5sZWZ0ID0gbGVmdDsKCSAgICAgICAgX3RoaXMudG9wID0gdG9wOwoJICAgICAgICBpZiAobHVtaW5hbmNlcy5CWVRFU19QRVJfRUxFTUVOVCA9PT0gNCkgeyAvLyBJbnQzMkFycmF5CgkgICAgICAgICAgICB2YXIgc2l6ZSA9IHdpZHRoICogaGVpZ2h0OwoJICAgICAgICAgICAgdmFyIGx1bWluYW5jZXNVaW50OEFycmF5ID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHNpemUpOwoJICAgICAgICAgICAgZm9yICh2YXIgb2Zmc2V0ID0gMDsgb2Zmc2V0IDwgc2l6ZTsgb2Zmc2V0KyspIHsKCSAgICAgICAgICAgICAgICB2YXIgcGl4ZWwgPSBsdW1pbmFuY2VzW29mZnNldF07CgkgICAgICAgICAgICAgICAgdmFyIHIgPSAocGl4ZWwgPj4gMTYpICYgMHhmZjsgLy8gcmVkCgkgICAgICAgICAgICAgICAgdmFyIGcyID0gKHBpeGVsID4+IDcpICYgMHgxZmU7IC8vIDIgKiBncmVlbgoJICAgICAgICAgICAgICAgIHZhciBiID0gcGl4ZWwgJiAweGZmOyAvLyBibHVlCgkgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGdyZWVuLWZhdm91cmluZyBhdmVyYWdlIGNoZWFwbHkKCSAgICAgICAgICAgICAgICBsdW1pbmFuY2VzVWludDhBcnJheVtvZmZzZXRdID0gLyooYnl0ZSkgKi8gKChyICsgZzIgKyBiKSAvIDQpICYgMHhGRjsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIF90aGlzLmx1bWluYW5jZXMgPSBsdW1pbmFuY2VzVWludDhBcnJheTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIF90aGlzLmx1bWluYW5jZXMgPSBsdW1pbmFuY2VzOwoJICAgICAgICB9CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGRhdGFXaWR0aCkgewoJICAgICAgICAgICAgX3RoaXMuZGF0YVdpZHRoID0gd2lkdGg7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gZGF0YUhlaWdodCkgewoJICAgICAgICAgICAgX3RoaXMuZGF0YUhlaWdodCA9IGhlaWdodDsKCSAgICAgICAgfQoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSBsZWZ0KSB7CgkgICAgICAgICAgICBfdGhpcy5sZWZ0ID0gMDsKCSAgICAgICAgfQoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSB0b3ApIHsKCSAgICAgICAgICAgIF90aGlzLnRvcCA9IDA7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKF90aGlzLmxlZnQgKyB3aWR0aCA+IF90aGlzLmRhdGFXaWR0aCB8fCBfdGhpcy50b3AgKyBoZWlnaHQgPiBfdGhpcy5kYXRhSGVpZ2h0KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNi5kZWZhdWx0KCdDcm9wIHJlY3RhbmdsZSBkb2VzIG5vdCBmaXQgd2l0aGluIGltYWdlIGRhdGEuJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICAvKkBPdmVycmlkZSovCgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgaWYgKHkgPCAwIHx8IHkgPj0gdGhpcy5nZXRIZWlnaHQoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDYuZGVmYXVsdCgnUmVxdWVzdGVkIHJvdyBpcyBvdXRzaWRlIHRoZSBpbWFnZTogJyArIHkpOwoJICAgICAgICB9CgkgICAgICAgIHZhciB3aWR0aCA9IHRoaXMuZ2V0V2lkdGgoKTsKCSAgICAgICAgaWYgKHJvdyA9PT0gbnVsbCB8fCByb3cgPT09IHVuZGVmaW5lZCB8fCByb3cubGVuZ3RoIDwgd2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBVaW50OENsYW1wZWRBcnJheSh3aWR0aCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG9mZnNldCA9ICh5ICsgdGhpcy50b3ApICogdGhpcy5kYXRhV2lkdGggKyB0aGlzLmxlZnQ7CgkgICAgICAgIFN5c3RlbV8xJDIuZGVmYXVsdC5hcnJheWNvcHkodGhpcy5sdW1pbmFuY2VzLCBvZmZzZXQsIHJvdywgMCwgd2lkdGgpOwoJICAgICAgICByZXR1cm4gcm93OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJHQkx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuZ2V0TWF0cml4ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgd2lkdGggPSB0aGlzLmdldFdpZHRoKCk7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICAvLyBJZiB0aGUgY2FsbGVyIGFza3MgZm9yIHRoZSBlbnRpcmUgdW5kZXJseWluZyBpbWFnZSwgc2F2ZSB0aGUgY29weSBhbmQgZ2l2ZSB0aGVtIHRoZQoJICAgICAgICAvLyBvcmlnaW5hbCBkYXRhLiBUaGUgZG9jcyBzcGVjaWZpY2FsbHkgd2FybiB0aGF0IHJlc3VsdC5sZW5ndGggbXVzdCBiZSBpZ25vcmVkLgoJICAgICAgICBpZiAod2lkdGggPT09IHRoaXMuZGF0YVdpZHRoICYmIGhlaWdodCA9PT0gdGhpcy5kYXRhSGVpZ2h0KSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5sdW1pbmFuY2VzOwoJICAgICAgICB9CgkgICAgICAgIHZhciBhcmVhID0gd2lkdGggKiBoZWlnaHQ7CgkgICAgICAgIHZhciBtYXRyaXggPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoYXJlYSk7CgkgICAgICAgIHZhciBpbnB1dE9mZnNldCA9IHRoaXMudG9wICogdGhpcy5kYXRhV2lkdGggKyB0aGlzLmxlZnQ7CgkgICAgICAgIC8vIElmIHRoZSB3aWR0aCBtYXRjaGVzIHRoZSBmdWxsIHdpZHRoIG9mIHRoZSB1bmRlcmx5aW5nIGRhdGEsIHBlcmZvcm0gYSBzaW5nbGUgY29weS4KCSAgICAgICAgaWYgKHdpZHRoID09PSB0aGlzLmRhdGFXaWR0aCkgewoJICAgICAgICAgICAgU3lzdGVtXzEkMi5kZWZhdWx0LmFycmF5Y29weSh0aGlzLmx1bWluYW5jZXMsIGlucHV0T2Zmc2V0LCBtYXRyaXgsIDAsIGFyZWEpOwoJICAgICAgICAgICAgcmV0dXJuIG1hdHJpeDsKCSAgICAgICAgfQoJICAgICAgICAvLyBPdGhlcndpc2UgY29weSBvbmUgY3JvcHBlZCByb3cgYXQgYSB0aW1lLgoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb3V0cHV0T2Zmc2V0ID0geSAqIHdpZHRoOwoJICAgICAgICAgICAgU3lzdGVtXzEkMi5kZWZhdWx0LmFycmF5Y29weSh0aGlzLmx1bWluYW5jZXMsIGlucHV0T2Zmc2V0LCBtYXRyaXgsIG91dHB1dE9mZnNldCwgd2lkdGgpOwoJICAgICAgICAgICAgaW5wdXRPZmZzZXQgKz0gdGhpcy5kYXRhV2lkdGg7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBSR0JMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLmlzQ3JvcFN1cHBvcnRlZCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5jcm9wID0gZnVuY3Rpb24gKGxlZnQgLyppbnQqLywgdG9wIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHJldHVybiBuZXcgUkdCTHVtaW5hbmNlU291cmNlKHRoaXMubHVtaW5hbmNlcywgd2lkdGgsIGhlaWdodCwgdGhpcy5kYXRhV2lkdGgsIHRoaXMuZGF0YUhlaWdodCwgdGhpcy5sZWZ0ICsgbGVmdCwgdGhpcy50b3AgKyB0b3ApOwoJICAgIH07CgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5pbnZlcnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2VfMS5kZWZhdWx0KHRoaXMpOwoJICAgIH07CgkgICAgcmV0dXJuIFJHQkx1bWluYW5jZVNvdXJjZTsKCX0oTHVtaW5hbmNlU291cmNlXzEuZGVmYXVsdCkpOwoJdmFyIF9kZWZhdWx0JDEgPSBSR0JMdW1pbmFuY2VTb3VyY2UkMS5kZWZhdWx0ID0gUkdCTHVtaW5hbmNlU291cmNlOwoKCXZhciBRUkNvZGVSZWFkZXIkMSA9IHt9OwoKCXZhciBCYXJjb2RlRm9ybWF0JDEgPSB7fTsKCgkvKgoJICogRGlyZWN0IHBvcnQgdG8gVHlwZVNjcmlwdCBvZiBaWGluZyBieSBBZHJpYW4gVG/ImWPEgwoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmFyY29kZUZvcm1hdCQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogRW51bWVyYXRlcyBiYXJjb2RlIGZvcm1hdHMga25vd24gdG8gdGhpcyBwYWNrYWdlLiBQbGVhc2Uga2VlcCBhbHBoYWJldGl6ZWQuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEJhcmNvZGVGb3JtYXQ7CgkoZnVuY3Rpb24gKEJhcmNvZGVGb3JtYXQpIHsKCSAgICAvKiogQXp0ZWMgMkQgYmFyY29kZSBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJBWlRFQyJdID0gMF0gPSAiQVpURUMiOwoJICAgIC8qKiBDT0RBQkFSIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREFCQVIiXSA9IDFdID0gIkNPREFCQVIiOwoJICAgIC8qKiBDb2RlIDM5IDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREVfMzkiXSA9IDJdID0gIkNPREVfMzkiOwoJICAgIC8qKiBDb2RlIDkzIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREVfOTMiXSA9IDNdID0gIkNPREVfOTMiOwoJICAgIC8qKiBDb2RlIDEyOCAxRCBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJDT0RFXzEyOCJdID0gNF0gPSAiQ09ERV8xMjgiOwoJICAgIC8qKiBEYXRhIE1hdHJpeCAyRCBiYXJjb2RlIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkRBVEFfTUFUUklYIl0gPSA1XSA9ICJEQVRBX01BVFJJWCI7CgkgICAgLyoqIEVBTi04IDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkVBTl84Il0gPSA2XSA9ICJFQU5fOCI7CgkgICAgLyoqIEVBTi0xMyAxRCBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJFQU5fMTMiXSA9IDddID0gIkVBTl8xMyI7CgkgICAgLyoqIElURiAoSW50ZXJsZWF2ZWQgVHdvIG9mIEZpdmUpIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIklURiJdID0gOF0gPSAiSVRGIjsKCSAgICAvKiogTWF4aUNvZGUgMkQgYmFyY29kZSBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJNQVhJQ09ERSJdID0gOV0gPSAiTUFYSUNPREUiOwoJICAgIC8qKiBQREY0MTcgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUERGXzQxNyJdID0gMTBdID0gIlBERl80MTciOwoJICAgIC8qKiBRUiBDb2RlIDJEIGJhcmNvZGUgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUVJfQ09ERSJdID0gMTFdID0gIlFSX0NPREUiOwoJICAgIC8qKiBSU1MgMTQgKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlJTU18xNCJdID0gMTJdID0gIlJTU18xNCI7CgkgICAgLyoqIFJTUyBFWFBBTkRFRCAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUlNTX0VYUEFOREVEIl0gPSAxM10gPSAiUlNTX0VYUEFOREVEIjsKCSAgICAvKiogVVBDLUEgMUQgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiVVBDX0EiXSA9IDE0XSA9ICJVUENfQSI7CgkgICAgLyoqIFVQQy1FIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlVQQ19FIl0gPSAxNV0gPSAiVVBDX0UiOwoJICAgIC8qKiBVUEMvRUFOIGV4dGVuc2lvbiBmb3JtYXQuIE5vdCBhIHN0YW5kLWFsb25lIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlVQQ19FQU5fRVhURU5TSU9OIl0gPSAxNl0gPSAiVVBDX0VBTl9FWFRFTlNJT04iOwoJfSkoQmFyY29kZUZvcm1hdCB8fCAoQmFyY29kZUZvcm1hdCA9IHt9KSk7CglCYXJjb2RlRm9ybWF0JDEuZGVmYXVsdCA9IEJhcmNvZGVGb3JtYXQ7CgoJdmFyIFJlc3VsdCQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZXN1bHQkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIFN5c3RlbV8xJDEgPSBTeXN0ZW0kMTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGVjb2RpbmcgYSBiYXJjb2RlIHdpdGhpbiBhbiBpbWFnZS48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFJlc3VsdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IocHJpdmF0ZSB0ZXh0OiBzdHJpbmcsCgkgICAgLy8gICAgICAgICAgICAgICBVaW50OEFycmF5IHJhd0J5dGVzLAoJICAgIC8vICAgICAgICAgICAgICAgUmVzdWx0UG9jb25zdCByZXN1bHRQb2ludHM6IEludDMyQXJyYXksCgkgICAgLy8gICAgICAgICAgICAgICBCYXJjb2RlRm9ybWF0IGZvcm1hdCkgewoJICAgIC8vICAgdGhpcyh0ZXh0LCByYXdCeXRlcywgcmVzdWx0UG9pbnRzLCBmb3JtYXQsIFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpKQoJICAgIC8vIH0KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IodGV4dDogc3RyaW5nLAoJICAgIC8vICAgICAgICAgICAgICAgVWludDhBcnJheSByYXdCeXRlcywKCSAgICAvLyAgICAgICAgICAgICAgIFJlc3VsdFBvY29uc3QgcmVzdWx0UG9pbnRzOiBJbnQzMkFycmF5LAoJICAgIC8vICAgICAgICAgICAgICAgQmFyY29kZUZvcm1hdCBmb3JtYXQsCgkgICAgLy8gICAgICAgICAgICAgICBsb25nIHRpbWVzdGFtcCkgewoJICAgIC8vICAgdGhpcyh0ZXh0LCByYXdCeXRlcywgcmF3Qnl0ZXMgPT0gbnVsbCA/IDAgOiA4ICogcmF3Qnl0ZXMubGVuZ3RoLAoJICAgIC8vICAgICAgICByZXN1bHRQb2ludHMsIGZvcm1hdCwgdGltZXN0YW1wKQoJICAgIC8vIH0KCSAgICBmdW5jdGlvbiBSZXN1bHQodGV4dCwgcmF3Qnl0ZXMsIG51bUJpdHMsIHJlc3VsdFBvaW50cywgZm9ybWF0LCB0aW1lc3RhbXApIHsKCSAgICAgICAgaWYgKG51bUJpdHMgPT09IHZvaWQgMCkgeyBudW1CaXRzID0gcmF3Qnl0ZXMgPT0gbnVsbCA/IDAgOiA4ICogcmF3Qnl0ZXMubGVuZ3RoOyB9CgkgICAgICAgIGlmICh0aW1lc3RhbXAgPT09IHZvaWQgMCkgeyB0aW1lc3RhbXAgPSBTeXN0ZW1fMSQxLmRlZmF1bHQuY3VycmVudFRpbWVNaWxsaXMoKTsgfQoJICAgICAgICB0aGlzLnRleHQgPSB0ZXh0OwoJICAgICAgICB0aGlzLnJhd0J5dGVzID0gcmF3Qnl0ZXM7CgkgICAgICAgIHRoaXMubnVtQml0cyA9IG51bUJpdHM7CgkgICAgICAgIHRoaXMucmVzdWx0UG9pbnRzID0gcmVzdWx0UG9pbnRzOwoJICAgICAgICB0aGlzLmZvcm1hdCA9IGZvcm1hdDsKCSAgICAgICAgdGhpcy50aW1lc3RhbXAgPSB0aW1lc3RhbXA7CgkgICAgICAgIHRoaXMudGV4dCA9IHRleHQ7CgkgICAgICAgIHRoaXMucmF3Qnl0ZXMgPSByYXdCeXRlczsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gbnVtQml0cyB8fCBudWxsID09PSBudW1CaXRzKSB7CgkgICAgICAgICAgICB0aGlzLm51bUJpdHMgPSAocmF3Qnl0ZXMgPT09IG51bGwgfHwgcmF3Qnl0ZXMgPT09IHVuZGVmaW5lZCkgPyAwIDogOCAqIHJhd0J5dGVzLmxlbmd0aDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHRoaXMubnVtQml0cyA9IG51bUJpdHM7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludHMgPSByZXN1bHRQb2ludHM7CgkgICAgICAgIHRoaXMuZm9ybWF0ID0gZm9ybWF0OwoJICAgICAgICB0aGlzLnJlc3VsdE1ldGFkYXRhID0gbnVsbDsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gdGltZXN0YW1wIHx8IG51bGwgPT09IHRpbWVzdGFtcCkgewoJICAgICAgICAgICAgdGhpcy50aW1lc3RhbXAgPSBTeXN0ZW1fMSQxLmRlZmF1bHQuY3VycmVudFRpbWVNaWxsaXMoKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHRoaXMudGltZXN0YW1wID0gdGltZXN0YW1wOwoJICAgICAgICB9CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcmF3IHRleHQgZW5jb2RlZCBieSB0aGUgYmFyY29kZQoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0VGV4dCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMudGV4dDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcmF3IGJ5dGVzIGVuY29kZWQgYnkgdGhlIGJhcmNvZGUsIGlmIGFwcGxpY2FibGUsIG90aGVyd2lzZSB7QGNvZGUgbnVsbH0KCSAgICAgKi8KCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFJhd0J5dGVzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yYXdCeXRlczsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaG93IG1hbnkgYml0cyBvZiB7QGxpbmsgI2dldFJhd0J5dGVzKCl9IGFyZSB2YWxpZDsgdHlwaWNhbGx5IDggdGltZXMgaXRzIGxlbmd0aAoJICAgICAqIEBzaW5jZSAzLjMuMAoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0TnVtQml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMubnVtQml0czsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcG9pbnRzIHJlbGF0ZWQgdG8gdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLiBUaGVzZSBhcmUgdHlwaWNhbGx5IHBvaW50cwoJICAgICAqICAgICAgICAgaWRlbnRpZnlpbmcgZmluZGVyIHBhdHRlcm5zIG9yIHRoZSBjb3JuZXJzIG9mIHRoZSBiYXJjb2RlLiBUaGUgZXhhY3QgbWVhbmluZyBpcwoJICAgICAqICAgICAgICAgc3BlY2lmaWMgdG8gdGhlIHR5cGUgb2YgYmFyY29kZSB0aGF0IHdhcyBkZWNvZGVkLgoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0UmVzdWx0UG9pbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRQb2ludHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHtAbGluayBCYXJjb2RlRm9ybWF0fSByZXByZXNlbnRpbmcgdGhlIGZvcm1hdCBvZiB0aGUgYmFyY29kZSB0aGF0IHdhcyBkZWNvZGVkCgkgICAgICovCgkgICAgUmVzdWx0LnByb3RvdHlwZS5nZXRCYXJjb2RlRm9ybWF0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHtAbGluayBNYXB9IG1hcHBpbmcge0BsaW5rIFJlc3VsdE1ldGFkYXRhVHlwZX0ga2V5cyB0byB2YWx1ZXMuIE1heSBiZQoJICAgICAqICAge0Bjb2RlIG51bGx9LiBUaGlzIGNvbnRhaW5zIG9wdGlvbmFsIG1ldGFkYXRhIGFib3V0IHdoYXQgd2FzIGRldGVjdGVkIGFib3V0IHRoZSBiYXJjb2RlLAoJICAgICAqICAgbGlrZSBvcmllbnRhdGlvbi4KCSAgICAgKi8KCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFJlc3VsdE1ldGFkYXRhID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRNZXRhZGF0YTsKCSAgICB9OwoJICAgIFJlc3VsdC5wcm90b3R5cGUucHV0TWV0YWRhdGEgPSBmdW5jdGlvbiAodHlwZSwgdmFsdWUpIHsKCSAgICAgICAgaWYgKHRoaXMucmVzdWx0TWV0YWRhdGEgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHRoaXMucmVzdWx0TWV0YWRhdGEgPSBuZXcgTWFwKCk7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YS5zZXQodHlwZSwgdmFsdWUpOwoJICAgIH07CgkgICAgUmVzdWx0LnByb3RvdHlwZS5wdXRBbGxNZXRhZGF0YSA9IGZ1bmN0aW9uIChtZXRhZGF0YSkgewoJICAgICAgICBpZiAobWV0YWRhdGEgIT09IG51bGwpIHsKCSAgICAgICAgICAgIGlmICh0aGlzLnJlc3VsdE1ldGFkYXRhID09PSBudWxsKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YSA9IG1ldGFkYXRhOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YSA9IG5ldyBNYXAobWV0YWRhdGEpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZXN1bHQucHJvdG90eXBlLmFkZFJlc3VsdFBvaW50cyA9IGZ1bmN0aW9uIChuZXdQb2ludHMpIHsKCSAgICAgICAgdmFyIG9sZFBvaW50cyA9IHRoaXMucmVzdWx0UG9pbnRzOwoJICAgICAgICBpZiAob2xkUG9pbnRzID09PSBudWxsKSB7CgkgICAgICAgICAgICB0aGlzLnJlc3VsdFBvaW50cyA9IG5ld1BvaW50czsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChuZXdQb2ludHMgIT09IG51bGwgJiYgbmV3UG9pbnRzLmxlbmd0aCA+IDApIHsKCSAgICAgICAgICAgIHZhciBhbGxQb2ludHMgPSBuZXcgQXJyYXkob2xkUG9pbnRzLmxlbmd0aCArIG5ld1BvaW50cy5sZW5ndGgpOwoJICAgICAgICAgICAgU3lzdGVtXzEkMS5kZWZhdWx0LmFycmF5Y29weShvbGRQb2ludHMsIDAsIGFsbFBvaW50cywgMCwgb2xkUG9pbnRzLmxlbmd0aCk7CgkgICAgICAgICAgICBTeXN0ZW1fMSQxLmRlZmF1bHQuYXJyYXljb3B5KG5ld1BvaW50cywgMCwgYWxsUG9pbnRzLCBvbGRQb2ludHMubGVuZ3RoLCBuZXdQb2ludHMubGVuZ3RoKTsKCSAgICAgICAgICAgIHRoaXMucmVzdWx0UG9pbnRzID0gYWxsUG9pbnRzOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFRpbWVzdGFtcCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMudGltZXN0YW1wOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnRleHQ7CgkgICAgfTsKCSAgICByZXR1cm4gUmVzdWx0OwoJfSgpKTsKCVJlc3VsdCQxLmRlZmF1bHQgPSBSZXN1bHQ7CgoJdmFyIFJlc3VsdE1ldGFkYXRhVHlwZSQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA4IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZXN1bHRNZXRhZGF0YVR5cGUkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogUmVwcmVzZW50cyBzb21lIHR5cGUgb2YgbWV0YWRhdGEgYWJvdXQgdGhlIHJlc3VsdCBvZiB0aGUgZGVjb2RpbmcgdGhhdCB0aGUgZGVjb2RlcgoJICogd2lzaGVzIHRvIGNvbW11bmljYXRlIGJhY2sgdG8gdGhlIGNhbGxlci4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUmVzdWx0TWV0YWRhdGFUeXBlOwoJKGZ1bmN0aW9uIChSZXN1bHRNZXRhZGF0YVR5cGUpIHsKCSAgICAvKioKCSAgICAgKiBVbnNwZWNpZmllZCwgYXBwbGljYXRpb24tc3BlY2lmaWMgbWV0YWRhdGEuIE1hcHMgdG8gYW4gdW5zcGVjaWZpZWQge0BsaW5rIE9iamVjdH0uCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiT1RIRVIiXSA9IDBdID0gIk9USEVSIjsKCSAgICAvKioKCSAgICAgKiBEZW5vdGVzIHRoZSBsaWtlbHkgYXBwcm94aW1hdGUgb3JpZW50YXRpb24gb2YgdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLiBUaGlzIHZhbHVlCgkgICAgICogaXMgZ2l2ZW4gYXMgZGVncmVlcyByb3RhdGVkIGNsb2Nrd2lzZSBmcm9tIHRoZSBub3JtYWwsIHVwcmlnaHQgb3JpZW50YXRpb24uCgkgICAgICogRm9yIGV4YW1wbGUgYSAxRCBiYXJjb2RlIHdoaWNoIHdhcyBmb3VuZCBieSByZWFkaW5nIHRvcC10by1ib3R0b20gd291bGQgYmUKCSAgICAgKiBzYWlkIHRvIGhhdmUgb3JpZW50YXRpb24gIjkwIi4gVGhpcyBrZXkgbWFwcyB0byBhbiB7QGxpbmsgSW50ZWdlcn0gd2hvc2UKCSAgICAgKiB2YWx1ZSBpcyBpbiB0aGUgcmFuZ2UgWzAsMzYwKS4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJPUklFTlRBVElPTiJdID0gMV0gPSAiT1JJRU5UQVRJT04iOwoJICAgIC8qKgoJICAgICAqIDxwPjJEIGJhcmNvZGUgZm9ybWF0cyB0eXBpY2FsbHkgZW5jb2RlIHRleHQsIGJ1dCBhbGxvdyBmb3IgYSBzb3J0IG9mICdieXRlIG1vZGUnCgkgICAgICogd2hpY2ggaXMgc29tZXRpbWVzIHVzZWQgdG8gZW5jb2RlIGJpbmFyeSBkYXRhLiBXaGlsZSB7QGxpbmsgUmVzdWx0fSBtYWtlcyBhdmFpbGFibGUKCSAgICAgKiB0aGUgY29tcGxldGUgcmF3IGJ5dGVzIGluIHRoZSBiYXJjb2RlIGZvciB0aGVzZSBmb3JtYXRzLCBpdCBkb2VzIG5vdCBvZmZlciB0aGUgYnl0ZXMKCSAgICAgKiBmcm9tIHRoZSBieXRlIHNlZ21lbnRzIGFsb25lLjwvcD4KCSAgICAgKgoJICAgICAqIDxwPlRoaXMgbWFwcyB0byBhIHtAbGluayBqYXZhLnV0aWwuTGlzdH0gb2YgYnl0ZSBhcnJheXMgY29ycmVzcG9uZGluZyB0byB0aGUKCSAgICAgKiByYXcgYnl0ZXMgaW4gdGhlIGJ5dGUgc2VnbWVudHMgaW4gdGhlIGJhcmNvZGUsIGluIG9yZGVyLjwvcD4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJCWVRFX1NFR01FTlRTIl0gPSAyXSA9ICJCWVRFX1NFR01FTlRTIjsKCSAgICAvKioKCSAgICAgKiBFcnJvciBjb3JyZWN0aW9uIGxldmVsIHVzZWQsIGlmIGFwcGxpY2FibGUuIFRoZSB2YWx1ZSB0eXBlIGRlcGVuZHMgb24gdGhlCgkgICAgICogZm9ybWF0LCBidXQgaXMgdHlwaWNhbGx5IGEgU3RyaW5nLgoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwiXSA9IDNdID0gIkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwiOwoJICAgIC8qKgoJICAgICAqIEZvciBzb21lIHBlcmlvZGljYWxzLCBpbmRpY2F0ZXMgdGhlIGlzc3VlIG51bWJlciBhcyBhbiB7QGxpbmsgSW50ZWdlcn0uCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiSVNTVUVfTlVNQkVSIl0gPSA0XSA9ICJJU1NVRV9OVU1CRVIiOwoJICAgIC8qKgoJICAgICAqIEZvciBzb21lIHByb2R1Y3RzLCBpbmRpY2F0ZXMgdGhlIHN1Z2dlc3RlZCByZXRhaWwgcHJpY2UgaW4gdGhlIGJhcmNvZGUgYXMgYQoJICAgICAqIGZvcm1hdHRlZCB7QGxpbmsgU3RyaW5nfS4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJTVUdHRVNURURfUFJJQ0UiXSA9IDVdID0gIlNVR0dFU1RFRF9QUklDRSI7CgkgICAgLyoqCgkgICAgICogRm9yIHNvbWUgcHJvZHVjdHMsIHRoZSBwb3NzaWJsZSBjb3VudHJ5IG9mIG1hbnVmYWN0dXJlIGFzIGEge0BsaW5rIFN0cmluZ30gZGVub3RpbmcgdGhlCgkgICAgICogSVNPIGNvdW50cnkgY29kZS4gU29tZSBtYXAgdG8gbXVsdGlwbGUgcG9zc2libGUgY291bnRyaWVzLCBsaWtlICJVUy9DQSIuCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiUE9TU0lCTEVfQ09VTlRSWSJdID0gNl0gPSAiUE9TU0lCTEVfQ09VTlRSWSI7CgkgICAgLyoqCgkgICAgICogRm9yIHNvbWUgcHJvZHVjdHMsIHRoZSBleHRlbnNpb24gdGV4dAoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIlVQQ19FQU5fRVhURU5TSU9OIl0gPSA3XSA9ICJVUENfRUFOX0VYVEVOU0lPTiI7CgkgICAgLyoqCgkgICAgICogUERGNDE3LXNwZWNpZmljIG1ldGFkYXRhCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiUERGNDE3X0VYVFJBX01FVEFEQVRBIl0gPSA4XSA9ICJQREY0MTdfRVhUUkFfTUVUQURBVEEiOwoJICAgIC8qKgoJICAgICAqIElmIHRoZSBjb2RlIGZvcm1hdCBzdXBwb3J0cyBzdHJ1Y3R1cmVkIGFwcGVuZCBhbmQgdGhlIGN1cnJlbnQgc2Nhbm5lZCBjb2RlIGlzIHBhcnQgb2Ygb25lIHRoZW4gdGhlCgkgICAgICogc2VxdWVuY2UgbnVtYmVyIGlzIGdpdmVuIHdpdGggaXQuCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiU1RSVUNUVVJFRF9BUFBFTkRfU0VRVUVOQ0UiXSA9IDldID0gIlNUUlVDVFVSRURfQVBQRU5EX1NFUVVFTkNFIjsKCSAgICAvKioKCSAgICAgKiBJZiB0aGUgY29kZSBmb3JtYXQgc3VwcG9ydHMgc3RydWN0dXJlZCBhcHBlbmQgYW5kIHRoZSBjdXJyZW50IHNjYW5uZWQgY29kZSBpcyBwYXJ0IG9mIG9uZSB0aGVuIHRoZQoJICAgICAqIHBhcml0eSBpcyBnaXZlbiB3aXRoIGl0LgoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIlNUUlVDVFVSRURfQVBQRU5EX1BBUklUWSJdID0gMTBdID0gIlNUUlVDVFVSRURfQVBQRU5EX1BBUklUWSI7Cgl9KShSZXN1bHRNZXRhZGF0YVR5cGUgfHwgKFJlc3VsdE1ldGFkYXRhVHlwZSA9IHt9KSk7CglSZXN1bHRNZXRhZGF0YVR5cGUkMS5kZWZhdWx0ID0gUmVzdWx0TWV0YWRhdGFUeXBlOwoKCXZhciBEZWNvZGVyJDEgPSB7fTsKCgl2YXIgQ2hlY2tzdW1FeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkOCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShDaGVja3N1bUV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNCA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBDaGVja3N1bUV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkOChDaGVja3N1bUV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBDaGVja3N1bUV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBDaGVja3N1bUV4Y2VwdGlvbi5nZXRDaGVja3N1bUluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IENoZWNrc3VtRXhjZXB0aW9uKCk7CgkgICAgfTsKCSAgICBDaGVja3N1bUV4Y2VwdGlvbi5raW5kID0gJ0NoZWNrc3VtRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gQ2hlY2tzdW1FeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDQuZGVmYXVsdCkpOwoJQ2hlY2tzdW1FeGNlcHRpb24kMS5kZWZhdWx0ID0gQ2hlY2tzdW1FeGNlcHRpb247CgoJdmFyIEdlbmVyaWNHRiQxID0ge307CgoJdmFyIEdlbmVyaWNHRlBvbHkkMSA9IHt9OwoKCXZhciBBYnN0cmFjdEdlbmVyaWNHRiQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShBYnN0cmFjdEdlbmVyaWNHRiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5UaGlzIGNsYXNzIGNvbnRhaW5zIHV0aWxpdHkgbWV0aG9kcyBmb3IgcGVyZm9ybWluZyBtYXRoZW1hdGljYWwgb3BlcmF0aW9ucyBvdmVyCgkgKiB0aGUgR2Fsb2lzIEZpZWxkcy4gT3BlcmF0aW9ucyB1c2UgYSBnaXZlbiBwcmltaXRpdmUgcG9seW5vbWlhbCBpbiBjYWxjdWxhdGlvbnMuPC9wPgoJICoKCSAqIDxwPlRocm91Z2hvdXQgdGhpcyBwYWNrYWdlLCBlbGVtZW50cyBvZiB0aGUgR0YgYXJlIHJlcHJlc2VudGVkIGFzIGFuIHtAY29kZSBpbnR9CgkgKiBmb3IgY29udmVuaWVuY2UgYW5kIHNwZWVkIChidXQgYXQgdGhlIGNvc3Qgb2YgbWVtb3J5KS4KCSAqIDwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBEYXZpZCBPbGl2aWVyCgkgKi8KCXZhciBBYnN0cmFjdEdlbmVyaWNHRiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBBYnN0cmFjdEdlbmVyaWNHRigpIHsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiAyIHRvIHRoZSBwb3dlciBvZiBhIGluIEdGKHNpemUpCgkgICAgICovCgkgICAgQWJzdHJhY3RHZW5lcmljR0YucHJvdG90eXBlLmV4cCA9IGZ1bmN0aW9uIChhKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmV4cFRhYmxlW2FdOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBiYXNlIDIgbG9nIG9mIGEgaW4gR0Yoc2l6ZSkKCSAgICAgKi8KCSAgICBBYnN0cmFjdEdlbmVyaWNHRi5wcm90b3R5cGUubG9nID0gZnVuY3Rpb24gKGEgLyppbnQqLykgewoJICAgICAgICBpZiAoYSA9PT0gMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDUuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0aGlzLmxvZ1RhYmxlW2FdOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogSW1wbGVtZW50cyBib3RoIGFkZGl0aW9uIGFuZCBzdWJ0cmFjdGlvbiAtLSB0aGV5IGFyZSB0aGUgc2FtZSBpbiBHRihzaXplKS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gc3VtL2RpZmZlcmVuY2Ugb2YgYSBhbmQgYgoJICAgICAqLwoJICAgIEFic3RyYWN0R2VuZXJpY0dGLmFkZE9yU3VidHJhY3QgPSBmdW5jdGlvbiAoYSAvKmludCovLCBiIC8qaW50Ki8pIHsKCSAgICAgICAgcmV0dXJuIGEgXiBiOwoJICAgIH07CgkgICAgcmV0dXJuIEFic3RyYWN0R2VuZXJpY0dGOwoJfSgpKTsKCUFic3RyYWN0R2VuZXJpY0dGJDEuZGVmYXVsdCA9IEFic3RyYWN0R2VuZXJpY0dGOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoR2VuZXJpY0dGUG9seSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbi5yZWVkc29sb21vbiB7Ki8KCXZhciBBYnN0cmFjdEdlbmVyaWNHRl8xJDEgPSBBYnN0cmFjdEdlbmVyaWNHRiQxOwoJdmFyIFN5c3RlbV8xID0gU3lzdGVtJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNCA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5SZXByZXNlbnRzIGEgcG9seW5vbWlhbCB3aG9zZSBjb2VmZmljaWVudHMgYXJlIGVsZW1lbnRzIG9mIGEgR0YuCgkgKiBJbnN0YW5jZXMgb2YgdGhpcyBjbGFzcyBhcmUgaW1tdXRhYmxlLjwvcD4KCSAqCgkgKiA8cD5NdWNoIGNyZWRpdCBpcyBkdWUgdG8gV2lsbGlhbSBSdWNrbGlkZ2Ugc2luY2UgcG9ydGlvbnMgb2YgdGhpcyBjb2RlIGFyZSBhbiBpbmRpcmVjdAoJICogcG9ydCBvZiBoaXMgQysrIFJlZWQtU29sb21vbiBpbXBsZW1lbnRhdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEdlbmVyaWNHRlBvbHkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGZpZWxkIHRoZSB7QGxpbmsgR2VuZXJpY0dGfSBpbnN0YW5jZSByZXByZXNlbnRpbmcgdGhlIGZpZWxkIHRvIHVzZQoJICAgICAqIHRvIHBlcmZvcm0gY29tcHV0YXRpb25zCgkgICAgICogQHBhcmFtIGNvZWZmaWNpZW50cyBjb2VmZmljaWVudHMgYXMgaW50cyByZXByZXNlbnRpbmcgZWxlbWVudHMgb2YgR0Yoc2l6ZSksIGFycmFuZ2VkCgkgICAgICogZnJvbSBtb3N0IHNpZ25pZmljYW50IChoaWdoZXN0LXBvd2VyIHRlcm0pIGNvZWZmaWNpZW50IHRvIGxlYXN0IHNpZ25pZmljYW50CgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgYXJndW1lbnQgaXMgbnVsbCBvciBlbXB0eSwKCSAgICAgKiBvciBpZiBsZWFkaW5nIGNvZWZmaWNpZW50IGlzIDAgYW5kIHRoaXMgaXMgbm90IGEKCSAgICAgKiBjb25zdGFudCBwb2x5bm9taWFsICh0aGF0IGlzLCBpdCBpcyBub3QgdGhlIG1vbm9taWFsICIwIikKCSAgICAgKi8KCSAgICBmdW5jdGlvbiBHZW5lcmljR0ZQb2x5KGZpZWxkLCBjb2VmZmljaWVudHMpIHsKCSAgICAgICAgaWYgKGNvZWZmaWNpZW50cy5sZW5ndGggPT09IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLmZpZWxkID0gZmllbGQ7CgkgICAgICAgIHZhciBjb2VmZmljaWVudHNMZW5ndGggPSBjb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICBpZiAoY29lZmZpY2llbnRzTGVuZ3RoID4gMSAmJiBjb2VmZmljaWVudHNbMF0gPT09IDApIHsKCSAgICAgICAgICAgIC8vIExlYWRpbmcgdGVybSBtdXN0IGJlIG5vbi16ZXJvIGZvciBhbnl0aGluZyBleGNlcHQgdGhlIGNvbnN0YW50IHBvbHlub21pYWwgIjAiCgkgICAgICAgICAgICB2YXIgZmlyc3ROb25aZXJvID0gMTsKCSAgICAgICAgICAgIHdoaWxlIChmaXJzdE5vblplcm8gPCBjb2VmZmljaWVudHNMZW5ndGggJiYgY29lZmZpY2llbnRzW2ZpcnN0Tm9uWmVyb10gPT09IDApIHsKCSAgICAgICAgICAgICAgICBmaXJzdE5vblplcm8rKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChmaXJzdE5vblplcm8gPT09IGNvZWZmaWNpZW50c0xlbmd0aCkgewoJICAgICAgICAgICAgICAgIHRoaXMuY29lZmZpY2llbnRzID0gSW50MzJBcnJheS5mcm9tKFswXSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICB0aGlzLmNvZWZmaWNpZW50cyA9IG5ldyBJbnQzMkFycmF5KGNvZWZmaWNpZW50c0xlbmd0aCAtIGZpcnN0Tm9uWmVybyk7CgkgICAgICAgICAgICAgICAgU3lzdGVtXzEuZGVmYXVsdC5hcnJheWNvcHkoY29lZmZpY2llbnRzLCBmaXJzdE5vblplcm8sIHRoaXMuY29lZmZpY2llbnRzLCAwLCB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdGhpcy5jb2VmZmljaWVudHMgPSBjb2VmZmljaWVudHM7CgkgICAgICAgIH0KCSAgICB9CgkgICAgR2VuZXJpY0dGUG9seS5wcm90b3R5cGUuZ2V0Q29lZmZpY2llbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGRlZ3JlZSBvZiB0aGlzIHBvbHlub21pYWwKCSAgICAgKi8KCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5nZXREZWdyZWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGggLSAxOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGlzIHBvbHlub21pYWwgaXMgdGhlIG1vbm9taWFsICIwIgoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmlzWmVybyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY29lZmZpY2llbnRzWzBdID09PSAwOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBjb2VmZmljaWVudCBvZiB4XmRlZ3JlZSB0ZXJtIGluIHRoaXMgcG9seW5vbWlhbAoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmdldENvZWZmaWNpZW50ID0gZnVuY3Rpb24gKGRlZ3JlZSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvZWZmaWNpZW50c1t0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGggLSAxIC0gZGVncmVlXTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gZXZhbHVhdGlvbiBvZiB0aGlzIHBvbHlub21pYWwgYXQgYSBnaXZlbiBwb2ludAoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmV2YWx1YXRlQXQgPSBmdW5jdGlvbiAoYSAvKmludCovKSB7CgkgICAgICAgIGlmIChhID09PSAwKSB7CgkgICAgICAgICAgICAvLyBKdXN0IHJldHVybiB0aGUgeF4wIGNvZWZmaWNpZW50CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRDb2VmZmljaWVudCgwKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgY29lZmZpY2llbnRzID0gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciByZXN1bHQ7CgkgICAgICAgIGlmIChhID09PSAxKSB7CgkgICAgICAgICAgICAvLyBKdXN0IHRoZSBzdW0gb2YgdGhlIGNvZWZmaWNpZW50cwoJICAgICAgICAgICAgcmVzdWx0ID0gMDsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IGNvZWZmaWNpZW50cy5sZW5ndGg7IGkgIT09IGxlbmd0aF8xOyBpKyspIHsKCSAgICAgICAgICAgICAgICB2YXIgY29lZmZpY2llbnQgPSBjb2VmZmljaWVudHNbaV07CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gQWJzdHJhY3RHZW5lcmljR0ZfMSQxLmRlZmF1bHQuYWRkT3JTdWJ0cmFjdChyZXN1bHQsIGNvZWZmaWNpZW50KTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0KCSAgICAgICAgcmVzdWx0ID0gY29lZmZpY2llbnRzWzBdOwoJICAgICAgICB2YXIgc2l6ZSA9IGNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgc2l6ZTsgaSsrKSB7CgkgICAgICAgICAgICByZXN1bHQgPSBBYnN0cmFjdEdlbmVyaWNHRl8xJDEuZGVmYXVsdC5hZGRPclN1YnRyYWN0KGZpZWxkLm11bHRpcGx5KGEsIHJlc3VsdCksIGNvZWZmaWNpZW50c1tpXSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmFkZE9yU3VidHJhY3QgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKCF0aGlzLmZpZWxkLmVxdWFscyhvdGhlci5maWVsZCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoJ0dlbmVyaWNHRlBvbHlzIGRvIG5vdCBoYXZlIHNhbWUgR2VuZXJpY0dGIGZpZWxkJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRoaXMuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHJldHVybiBvdGhlcjsKCSAgICAgICAgfQoJICAgICAgICBpZiAob3RoZXIuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzbWFsbGVyQ29lZmZpY2llbnRzID0gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciBsYXJnZXJDb2VmZmljaWVudHMgPSBvdGhlci5jb2VmZmljaWVudHM7CgkgICAgICAgIGlmIChzbWFsbGVyQ29lZmZpY2llbnRzLmxlbmd0aCA+IGxhcmdlckNvZWZmaWNpZW50cy5sZW5ndGgpIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gc21hbGxlckNvZWZmaWNpZW50czsKCSAgICAgICAgICAgIHNtYWxsZXJDb2VmZmljaWVudHMgPSBsYXJnZXJDb2VmZmljaWVudHM7CgkgICAgICAgICAgICBsYXJnZXJDb2VmZmljaWVudHMgPSB0ZW1wOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzdW1EaWZmID0gbmV3IEludDMyQXJyYXkobGFyZ2VyQ29lZmZpY2llbnRzLmxlbmd0aCk7CgkgICAgICAgIHZhciBsZW5ndGhEaWZmID0gbGFyZ2VyQ29lZmZpY2llbnRzLmxlbmd0aCAtIHNtYWxsZXJDb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICAvLyBDb3B5IGhpZ2gtb3JkZXIgdGVybXMgb25seSBmb3VuZCBpbiBoaWdoZXItZGVncmVlIHBvbHlub21pYWwncyBjb2VmZmljaWVudHMKCSAgICAgICAgU3lzdGVtXzEuZGVmYXVsdC5hcnJheWNvcHkobGFyZ2VyQ29lZmZpY2llbnRzLCAwLCBzdW1EaWZmLCAwLCBsZW5ndGhEaWZmKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IGxlbmd0aERpZmY7IGkgPCBsYXJnZXJDb2VmZmljaWVudHMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHN1bURpZmZbaV0gPSBBYnN0cmFjdEdlbmVyaWNHRl8xJDEuZGVmYXVsdC5hZGRPclN1YnRyYWN0KHNtYWxsZXJDb2VmZmljaWVudHNbaSAtIGxlbmd0aERpZmZdLCBsYXJnZXJDb2VmZmljaWVudHNbaV0pOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seSh0aGlzLmZpZWxkLCBzdW1EaWZmKTsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLm11bHRpcGx5ID0gZnVuY3Rpb24gKG90aGVyKSB7CgkgICAgICAgIGlmICghdGhpcy5maWVsZC5lcXVhbHMob3RoZXIuZmllbGQpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNC5kZWZhdWx0KCdHZW5lcmljR0ZQb2x5cyBkbyBub3QgaGF2ZSBzYW1lIEdlbmVyaWNHRiBmaWVsZCcpOwoJICAgICAgICB9CgkgICAgICAgIGlmICh0aGlzLmlzWmVybygpIHx8IG90aGVyLmlzWmVybygpKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5maWVsZC5nZXRaZXJvKCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGFDb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgdmFyIGFMZW5ndGggPSBhQ29lZmZpY2llbnRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGJDb2VmZmljaWVudHMgPSBvdGhlci5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciBiTGVuZ3RoID0gYkNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBwcm9kdWN0ID0gbmV3IEludDMyQXJyYXkoYUxlbmd0aCArIGJMZW5ndGggLSAxKTsKCSAgICAgICAgdmFyIGZpZWxkID0gdGhpcy5maWVsZDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhTGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHZhciBhQ29lZmYgPSBhQ29lZmZpY2llbnRzW2ldOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBiTGVuZ3RoOyBqKyspIHsKCSAgICAgICAgICAgICAgICBwcm9kdWN0W2kgKyBqXSA9IEFic3RyYWN0R2VuZXJpY0dGXzEkMS5kZWZhdWx0LmFkZE9yU3VidHJhY3QocHJvZHVjdFtpICsgal0sIGZpZWxkLm11bHRpcGx5KGFDb2VmZiwgYkNvZWZmaWNpZW50c1tqXSkpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seShmaWVsZCwgcHJvZHVjdCk7CgkgICAgfTsKCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5tdWx0aXBseVNjYWxhciA9IGZ1bmN0aW9uIChzY2FsYXIgLyppbnQqLykgewoJICAgICAgICBpZiAoc2NhbGFyID09PSAwKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5maWVsZC5nZXRaZXJvKCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHNjYWxhciA9PT0gMSkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHNpemUgPSB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIHZhciBwcm9kdWN0ID0gbmV3IEludDMyQXJyYXkoc2l6ZSk7CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKCSAgICAgICAgICAgIHByb2R1Y3RbaV0gPSBmaWVsZC5tdWx0aXBseShjb2VmZmljaWVudHNbaV0sIHNjYWxhcik7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG5ldyBHZW5lcmljR0ZQb2x5KGZpZWxkLCBwcm9kdWN0KTsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLm11bHRpcGx5QnlNb25vbWlhbCA9IGZ1bmN0aW9uIChkZWdyZWUgLyppbnQqLywgY29lZmZpY2llbnQgLyppbnQqLykgewoJICAgICAgICBpZiAoZGVncmVlIDwgMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDQuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChjb2VmZmljaWVudCA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmllbGQuZ2V0WmVybygpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgdmFyIHNpemUgPSBjb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICB2YXIgcHJvZHVjdCA9IG5ldyBJbnQzMkFycmF5KHNpemUgKyBkZWdyZWUpOwoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7IGkrKykgewoJICAgICAgICAgICAgcHJvZHVjdFtpXSA9IGZpZWxkLm11bHRpcGx5KGNvZWZmaWNpZW50c1tpXSwgY29lZmZpY2llbnQpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seShmaWVsZCwgcHJvZHVjdCk7CgkgICAgfTsKCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5kaXZpZGUgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKCF0aGlzLmZpZWxkLmVxdWFscyhvdGhlci5maWVsZCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoJ0dlbmVyaWNHRlBvbHlzIGRvIG5vdCBoYXZlIHNhbWUgR2VuZXJpY0dGIGZpZWxkJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKG90aGVyLmlzWmVybygpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNC5kZWZhdWx0KCdEaXZpZGUgYnkgMCcpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIHZhciBxdW90aWVudCA9IGZpZWxkLmdldFplcm8oKTsKCSAgICAgICAgdmFyIHJlbWFpbmRlciA9IHRoaXM7CgkgICAgICAgIHZhciBkZW5vbWluYXRvckxlYWRpbmdUZXJtID0gb3RoZXIuZ2V0Q29lZmZpY2llbnQob3RoZXIuZ2V0RGVncmVlKCkpOwoJICAgICAgICB2YXIgaW52ZXJzZURlbm9taW5hdG9yTGVhZGluZ1Rlcm0gPSBmaWVsZC5pbnZlcnNlKGRlbm9taW5hdG9yTGVhZGluZ1Rlcm0pOwoJICAgICAgICB3aGlsZSAocmVtYWluZGVyLmdldERlZ3JlZSgpID49IG90aGVyLmdldERlZ3JlZSgpICYmICFyZW1haW5kZXIuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHZhciBkZWdyZWVEaWZmZXJlbmNlID0gcmVtYWluZGVyLmdldERlZ3JlZSgpIC0gb3RoZXIuZ2V0RGVncmVlKCk7CgkgICAgICAgICAgICB2YXIgc2NhbGUgPSBmaWVsZC5tdWx0aXBseShyZW1haW5kZXIuZ2V0Q29lZmZpY2llbnQocmVtYWluZGVyLmdldERlZ3JlZSgpKSwgaW52ZXJzZURlbm9taW5hdG9yTGVhZGluZ1Rlcm0pOwoJICAgICAgICAgICAgdmFyIHRlcm0gPSBvdGhlci5tdWx0aXBseUJ5TW9ub21pYWwoZGVncmVlRGlmZmVyZW5jZSwgc2NhbGUpOwoJICAgICAgICAgICAgdmFyIGl0ZXJhdGlvblF1b3RpZW50ID0gZmllbGQuYnVpbGRNb25vbWlhbChkZWdyZWVEaWZmZXJlbmNlLCBzY2FsZSk7CgkgICAgICAgICAgICBxdW90aWVudCA9IHF1b3RpZW50LmFkZE9yU3VidHJhY3QoaXRlcmF0aW9uUXVvdGllbnQpOwoJICAgICAgICAgICAgcmVtYWluZGVyID0gcmVtYWluZGVyLmFkZE9yU3VidHJhY3QodGVybSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIFtxdW90aWVudCwgcmVtYWluZGVyXTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJlc3VsdCA9ICcnOwoJICAgICAgICBmb3IgKHZhciBkZWdyZWUgPSB0aGlzLmdldERlZ3JlZSgpOyBkZWdyZWUgPj0gMDsgZGVncmVlLS0pIHsKCSAgICAgICAgICAgIHZhciBjb2VmZmljaWVudCA9IHRoaXMuZ2V0Q29lZmZpY2llbnQoZGVncmVlKTsKCSAgICAgICAgICAgIGlmIChjb2VmZmljaWVudCAhPT0gMCkgewoJICAgICAgICAgICAgICAgIGlmIChjb2VmZmljaWVudCA8IDApIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICcgLSAnOwoJICAgICAgICAgICAgICAgICAgICBjb2VmZmljaWVudCA9IC1jb2VmZmljaWVudDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICcgKyAnOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmIChkZWdyZWUgPT09IDAgfHwgY29lZmZpY2llbnQgIT09IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGFscGhhUG93ZXIgPSB0aGlzLmZpZWxkLmxvZyhjb2VmZmljaWVudCk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChhbHBoYVBvd2VyID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gJzEnOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFscGhhUG93ZXIgPT09IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnYSc7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gJ2FeJzsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBhbHBoYVBvd2VyOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmIChkZWdyZWUgIT09IDApIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKGRlZ3JlZSA9PT0gMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICd4JzsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAneF4nOwoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGRlZ3JlZTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgcmV0dXJuIEdlbmVyaWNHRlBvbHk7Cgl9KCkpOwoJR2VuZXJpY0dGUG9seSQxLmRlZmF1bHQgPSBHZW5lcmljR0ZQb2x5OwoKCXZhciBBcml0aG1ldGljRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgX19leHRlbmRzJDcgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJpdGhtZXRpY0V4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkMyA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBBcml0aG1ldGljRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyQ3KEFyaXRobWV0aWNFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gQXJpdGhtZXRpY0V4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBBcml0aG1ldGljRXhjZXB0aW9uLmtpbmQgPSAnQXJpdGhtZXRpY0V4Y2VwdGlvbic7CgkgICAgcmV0dXJuIEFyaXRobWV0aWNFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDMuZGVmYXVsdCkpOwoJQXJpdGhtZXRpY0V4Y2VwdGlvbiQxLmRlZmF1bHQgPSBBcml0aG1ldGljRXhjZXB0aW9uOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDYgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoR2VuZXJpY0dGJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uLnJlZWRzb2xvbW9uIHsqLwoJdmFyIEdlbmVyaWNHRlBvbHlfMSQxID0gR2VuZXJpY0dGUG9seSQxOwoJdmFyIEFic3RyYWN0R2VuZXJpY0dGXzEgPSBBYnN0cmFjdEdlbmVyaWNHRiQxOwoJdmFyIEludGVnZXJfMSQxID0gSW50ZWdlciQxOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDMgPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcml0aG1ldGljRXhjZXB0aW9uXzEgPSBBcml0aG1ldGljRXhjZXB0aW9uJDE7CgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgY29udGFpbnMgdXRpbGl0eSBtZXRob2RzIGZvciBwZXJmb3JtaW5nIG1hdGhlbWF0aWNhbCBvcGVyYXRpb25zIG92ZXIKCSAqIHRoZSBHYWxvaXMgRmllbGRzLiBPcGVyYXRpb25zIHVzZSBhIGdpdmVuIHByaW1pdGl2ZSBwb2x5bm9taWFsIGluIGNhbGN1bGF0aW9ucy48L3A+CgkgKgoJICogPHA+VGhyb3VnaG91dCB0aGlzIHBhY2thZ2UsIGVsZW1lbnRzIG9mIHRoZSBHRiBhcmUgcmVwcmVzZW50ZWQgYXMgYW4ge0Bjb2RlIGludH0KCSAqIGZvciBjb252ZW5pZW5jZSBhbmQgc3BlZWQgKGJ1dCBhdCB0aGUgY29zdCBvZiBtZW1vcnkpLgoJICogPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKiBAYXV0aG9yIERhdmlkIE9saXZpZXIKCSAqLwoJdmFyIEdlbmVyaWNHRiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkNihHZW5lcmljR0YsIF9zdXBlcik7CgkgICAgLyoqCgkgICAgICogQ3JlYXRlIGEgcmVwcmVzZW50YXRpb24gb2YgR0Yoc2l6ZSkgdXNpbmcgdGhlIGdpdmVuIHByaW1pdGl2ZSBwb2x5bm9taWFsLgoJICAgICAqCgkgICAgICogQHBhcmFtIHByaW1pdGl2ZSBpcnJlZHVjaWJsZSBwb2x5bm9taWFsIHdob3NlIGNvZWZmaWNpZW50cyBhcmUgcmVwcmVzZW50ZWQgYnkKCSAgICAgKiAgdGhlIGJpdHMgb2YgYW4gaW50LCB3aGVyZSB0aGUgbGVhc3Qtc2lnbmlmaWNhbnQgYml0IHJlcHJlc2VudHMgdGhlIGNvbnN0YW50CgkgICAgICogIGNvZWZmaWNpZW50CgkgICAgICogQHBhcmFtIHNpemUgdGhlIHNpemUgb2YgdGhlIGZpZWxkCgkgICAgICogQHBhcmFtIGIgdGhlIGZhY3RvciBiIGluIHRoZSBnZW5lcmF0b3IgcG9seW5vbWlhbCBjYW4gYmUgMC0gb3IgMS1iYXNlZAoJICAgICAqICAoZyh4KSA9ICh4K2FeYikoeCthXihiKzEpKS4uLih4K2FeKGIrMnQtMSkpKS4KCSAgICAgKiAgSW4gbW9zdCBjYXNlcyBpdCBzaG91bGQgYmUgMSwgYnV0IGZvciBRUiBjb2RlIGl0IGlzIDAuCgkgICAgICovCgkgICAgZnVuY3Rpb24gR2VuZXJpY0dGKHByaW1pdGl2ZSAvKmludCovLCBzaXplIC8qaW50Ki8sIGdlbmVyYXRvckJhc2UgLyppbnQqLykgewoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5wcmltaXRpdmUgPSBwcmltaXRpdmU7CgkgICAgICAgIF90aGlzLnNpemUgPSBzaXplOwoJICAgICAgICBfdGhpcy5nZW5lcmF0b3JCYXNlID0gZ2VuZXJhdG9yQmFzZTsKCSAgICAgICAgdmFyIGV4cFRhYmxlID0gbmV3IEludDMyQXJyYXkoc2l6ZSk7CgkgICAgICAgIHZhciB4ID0gMTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKCSAgICAgICAgICAgIGV4cFRhYmxlW2ldID0geDsKCSAgICAgICAgICAgIHggKj0gMjsgLy8gd2UncmUgYXNzdW1pbmcgdGhlIGdlbmVyYXRvciBhbHBoYSBpcyAyCgkgICAgICAgICAgICBpZiAoeCA+PSBzaXplKSB7CgkgICAgICAgICAgICAgICAgeCBePSBwcmltaXRpdmU7CgkgICAgICAgICAgICAgICAgeCAmPSBzaXplIC0gMTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBfdGhpcy5leHBUYWJsZSA9IGV4cFRhYmxlOwoJICAgICAgICB2YXIgbG9nVGFibGUgPSBuZXcgSW50MzJBcnJheShzaXplKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplIC0gMTsgaSsrKSB7CgkgICAgICAgICAgICBsb2dUYWJsZVtleHBUYWJsZVtpXV0gPSBpOwoJICAgICAgICB9CgkgICAgICAgIF90aGlzLmxvZ1RhYmxlID0gbG9nVGFibGU7CgkgICAgICAgIC8vIGxvZ1RhYmxlWzBdID09IDAgYnV0IHRoaXMgc2hvdWxkIG5ldmVyIGJlIHVzZWQKCSAgICAgICAgX3RoaXMuemVybyA9IG5ldyBHZW5lcmljR0ZQb2x5XzEkMS5kZWZhdWx0KF90aGlzLCBJbnQzMkFycmF5LmZyb20oWzBdKSk7CgkgICAgICAgIF90aGlzLm9uZSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEkMS5kZWZhdWx0KF90aGlzLCBJbnQzMkFycmF5LmZyb20oWzFdKSk7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5nZXRaZXJvID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy56ZXJvOwoJICAgIH07CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5nZXRPbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm9uZTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gdGhlIG1vbm9taWFsIHJlcHJlc2VudGluZyBjb2VmZmljaWVudCAqIHheZGVncmVlCgkgICAgICovCgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5idWlsZE1vbm9taWFsID0gZnVuY3Rpb24gKGRlZ3JlZSAvKmludCovLCBjb2VmZmljaWVudCAvKmludCovKSB7CgkgICAgICAgIGlmIChkZWdyZWUgPCAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkMy5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvZWZmaWNpZW50ID09PSAwKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy56ZXJvOwoJICAgICAgICB9CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSBuZXcgSW50MzJBcnJheShkZWdyZWUgKyAxKTsKCSAgICAgICAgY29lZmZpY2llbnRzWzBdID0gY29lZmZpY2llbnQ7CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seV8xJDEuZGVmYXVsdCh0aGlzLCBjb2VmZmljaWVudHMpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBtdWx0aXBsaWNhdGl2ZSBpbnZlcnNlIG9mIGEKCSAgICAgKi8KCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmludmVyc2UgPSBmdW5jdGlvbiAoYSAvKmludCovKSB7CgkgICAgICAgIGlmIChhID09PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgQXJpdGhtZXRpY0V4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5leHBUYWJsZVt0aGlzLnNpemUgLSB0aGlzLmxvZ1RhYmxlW2FdIC0gMV07CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHByb2R1Y3Qgb2YgYSBhbmQgYiBpbiBHRihzaXplKQoJICAgICAqLwoJICAgIEdlbmVyaWNHRi5wcm90b3R5cGUubXVsdGlwbHkgPSBmdW5jdGlvbiAoYSAvKmludCovLCBiIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGEgPT09IDAgfHwgYiA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIDA7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMuZXhwVGFibGVbKHRoaXMubG9nVGFibGVbYV0gKyB0aGlzLmxvZ1RhYmxlW2JdKSAlICh0aGlzLnNpemUgLSAxKV07CgkgICAgfTsKCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmdldFNpemUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnNpemU7CgkgICAgfTsKCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmdldEdlbmVyYXRvckJhc2UgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRvckJhc2U7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICgnR0YoMHgnICsgSW50ZWdlcl8xJDEuZGVmYXVsdC50b0hleFN0cmluZyh0aGlzLnByaW1pdGl2ZSkgKyAnLCcgKyB0aGlzLnNpemUgKyAnKScpOwoJICAgIH07CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICByZXR1cm4gbyA9PT0gdGhpczsKCSAgICB9OwoJICAgIEdlbmVyaWNHRi5BWlRFQ19EQVRBXzEyID0gbmV3IEdlbmVyaWNHRigweDEwNjksIDQwOTYsIDEpOyAvLyB4XjEyICsgeF42ICsgeF41ICsgeF4zICsgMQoJICAgIEdlbmVyaWNHRi5BWlRFQ19EQVRBXzEwID0gbmV3IEdlbmVyaWNHRigweDQwOSwgMTAyNCwgMSk7IC8vIHheMTAgKyB4XjMgKyAxCgkgICAgR2VuZXJpY0dGLkFaVEVDX0RBVEFfNiA9IG5ldyBHZW5lcmljR0YoMHg0MywgNjQsIDEpOyAvLyB4XjYgKyB4ICsgMQoJICAgIEdlbmVyaWNHRi5BWlRFQ19QQVJBTSA9IG5ldyBHZW5lcmljR0YoMHgxMywgMTYsIDEpOyAvLyB4XjQgKyB4ICsgMQoJICAgIEdlbmVyaWNHRi5RUl9DT0RFX0ZJRUxEXzI1NiA9IG5ldyBHZW5lcmljR0YoMHgwMTFkLCAyNTYsIDApOyAvLyB4XjggKyB4XjQgKyB4XjMgKyB4XjIgKyAxCgkgICAgR2VuZXJpY0dGLkRBVEFfTUFUUklYX0ZJRUxEXzI1NiA9IG5ldyBHZW5lcmljR0YoMHgwMTJkLCAyNTYsIDEpOyAvLyB4XjggKyB4XjUgKyB4XjMgKyB4XjIgKyAxCgkgICAgR2VuZXJpY0dGLkFaVEVDX0RBVEFfOCA9IEdlbmVyaWNHRi5EQVRBX01BVFJJWF9GSUVMRF8yNTY7CgkgICAgR2VuZXJpY0dGLk1BWElDT0RFX0ZJRUxEXzY0ID0gR2VuZXJpY0dGLkFaVEVDX0RBVEFfNjsKCSAgICByZXR1cm4gR2VuZXJpY0dGOwoJfShBYnN0cmFjdEdlbmVyaWNHRl8xLmRlZmF1bHQpKTsKCUdlbmVyaWNHRiQxLmRlZmF1bHQgPSBHZW5lcmljR0Y7CgoJdmFyIFJlZWRTb2xvbW9uRGVjb2RlciQxID0ge307CgoJdmFyIFJlZWRTb2xvbW9uRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgX19leHRlbmRzJDUgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVlZFNvbG9tb25FeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDIgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgUmVlZFNvbG9tb25FeGNlcHRpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDUoUmVlZFNvbG9tb25FeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gUmVlZFNvbG9tb25FeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgUmVlZFNvbG9tb25FeGNlcHRpb24ua2luZCA9ICdSZWVkU29sb21vbkV4Y2VwdGlvbic7CgkgICAgcmV0dXJuIFJlZWRTb2xvbW9uRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQyLmRlZmF1bHQpKTsKCVJlZWRTb2xvbW9uRXhjZXB0aW9uJDEuZGVmYXVsdCA9IFJlZWRTb2xvbW9uRXhjZXB0aW9uOwoKCXZhciBJbGxlZ2FsU3RhdGVFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkNCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbGxlZ2FsU3RhdGVFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDEgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgSWxsZWdhbFN0YXRlRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyQ0KElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgSWxsZWdhbFN0YXRlRXhjZXB0aW9uLmtpbmQgPSAnSWxsZWdhbFN0YXRlRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gSWxsZWdhbFN0YXRlRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQxLmRlZmF1bHQpKTsKCUlsbGVnYWxTdGF0ZUV4Y2VwdGlvbiQxLmRlZmF1bHQgPSBJbGxlZ2FsU3RhdGVFeGNlcHRpb247CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZWVkU29sb21vbkRlY29kZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5jb21tb24ucmVlZHNvbG9tb24geyovCgl2YXIgR2VuZXJpY0dGXzEkMSA9IEdlbmVyaWNHRiQxOwoJdmFyIEdlbmVyaWNHRlBvbHlfMSA9IEdlbmVyaWNHRlBvbHkkMTsKCXZhciBSZWVkU29sb21vbkV4Y2VwdGlvbl8xID0gUmVlZFNvbG9tb25FeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsU3RhdGVFeGNlcHRpb25fMSA9IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5JbXBsZW1lbnRzIFJlZWQtU29sb21vbiBkZWNvZGluZywgYXMgdGhlIG5hbWUgaW1wbGllcy48L3A+CgkgKgoJICogPHA+VGhlIGFsZ29yaXRobSB3aWxsIG5vdCBiZSBleHBsYWluZWQgaGVyZSwgYnV0IHRoZSBmb2xsb3dpbmcgcmVmZXJlbmNlcyB3ZXJlIGhlbHBmdWwKCSAqIGluIGNyZWF0aW5nIHRoaXMgaW1wbGVtZW50YXRpb246PC9wPgoJICoKCSAqIDx1bD4KCSAqIDxsaT5CcnVjZSBNYWdncy4KCSAqIDxhIGhyZWY9Imh0dHA6Ly93d3cuY3MuY211LmVkdS9hZnMvY3MuY211LmVkdS9wcm9qZWN0L3BzY2ljby1ndXliL3JlYWx3b3JsZC93d3cvcnNfZGVjb2RlLnBzIj4KCSAqICJEZWNvZGluZyBSZWVkLVNvbG9tb24gQ29kZXMiPC9hPiAoc2VlIGRpc2N1c3Npb24gb2YgRm9ybmV5J3MgRm9ybXVsYSk8L2xpPgoJICogPGxpPkouSS4gSGFsbC4gPGEgaHJlZj0id3d3Lm10aC5tc3UuZWR1L35qaGFsbC9jbGFzc2VzL2NvZGVub3Rlcy9HUlMucGRmIj4KCSAqICJDaGFwdGVyIDUuIEdlbmVyYWxpemVkIFJlZWQtU29sb21vbiBDb2RlcyI8L2E+CgkgKiAoc2VlIGRpc2N1c3Npb24gb2YgRXVjbGlkZWFuIGFsZ29yaXRobSk8L2xpPgoJICogPC91bD4KCSAqCgkgKiA8cD5NdWNoIGNyZWRpdCBpcyBkdWUgdG8gV2lsbGlhbSBSdWNrbGlkZ2Ugc2luY2UgcG9ydGlvbnMgb2YgdGhpcyBjb2RlIGFyZSBhbiBpbmRpcmVjdAoJICogcG9ydCBvZiBoaXMgQysrIFJlZWQtU29sb21vbiBpbXBsZW1lbnRhdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBhdXRob3IgV2lsbGlhbSBSdWNrbGlkZ2UKCSAqIEBhdXRob3Igc2FuZm9yZHNxdWlyZXMKCSAqLwoJdmFyIFJlZWRTb2xvbW9uRGVjb2RlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBSZWVkU29sb21vbkRlY29kZXIoZmllbGQpIHsKCSAgICAgICAgdGhpcy5maWVsZCA9IGZpZWxkOwoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5EZWNvZGVzIGdpdmVuIHNldCBvZiByZWNlaXZlZCBjb2Rld29yZHMsIHdoaWNoIGluY2x1ZGUgYm90aCBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uCgkgICAgICogY29kZXdvcmRzLiBSZWFsbHksIHRoaXMgbWVhbnMgaXQgdXNlcyBSZWVkLVNvbG9tb24gdG8gZGV0ZWN0IGFuZCBjb3JyZWN0IGVycm9ycywgaW4tcGxhY2UsCgkgICAgICogaW4gdGhlIGlucHV0LjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSByZWNlaXZlZCBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcwoJICAgICAqIEBwYXJhbSB0d29TIG51bWJlciBvZiBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyBhdmFpbGFibGUKCSAgICAgKiBAdGhyb3dzIFJlZWRTb2xvbW9uRXhjZXB0aW9uIGlmIGRlY29kaW5nIGZhaWxzIGZvciBhbnkgcmVhc29uCgkgICAgICovCgkgICAgUmVlZFNvbG9tb25EZWNvZGVyLnByb3RvdHlwZS5kZWNvZGUgPSBmdW5jdGlvbiAocmVjZWl2ZWQsIHR3b1MgLyppbnQqLykgewoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICB2YXIgcG9seSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEuZGVmYXVsdChmaWVsZCwgcmVjZWl2ZWQpOwoJICAgICAgICB2YXIgc3luZHJvbWVDb2VmZmljaWVudHMgPSBuZXcgSW50MzJBcnJheSh0d29TKTsKCSAgICAgICAgdmFyIG5vRXJyb3IgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHR3b1M7IGkrKykgewoJICAgICAgICAgICAgdmFyIGV2YWxSZXN1bHQgPSBwb2x5LmV2YWx1YXRlQXQoZmllbGQuZXhwKGkgKyBmaWVsZC5nZXRHZW5lcmF0b3JCYXNlKCkpKTsKCSAgICAgICAgICAgIHN5bmRyb21lQ29lZmZpY2llbnRzW3N5bmRyb21lQ29lZmZpY2llbnRzLmxlbmd0aCAtIDEgLSBpXSA9IGV2YWxSZXN1bHQ7CgkgICAgICAgICAgICBpZiAoZXZhbFJlc3VsdCAhPT0gMCkgewoJICAgICAgICAgICAgICAgIG5vRXJyb3IgPSBmYWxzZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBpZiAobm9FcnJvcikgewoJICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzeW5kcm9tZSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEuZGVmYXVsdChmaWVsZCwgc3luZHJvbWVDb2VmZmljaWVudHMpOwoJICAgICAgICB2YXIgc2lnbWFPbWVnYSA9IHRoaXMucnVuRXVjbGlkZWFuQWxnb3JpdGhtKGZpZWxkLmJ1aWxkTW9ub21pYWwodHdvUywgMSksIHN5bmRyb21lLCB0d29TKTsKCSAgICAgICAgdmFyIHNpZ21hID0gc2lnbWFPbWVnYVswXTsKCSAgICAgICAgdmFyIG9tZWdhID0gc2lnbWFPbWVnYVsxXTsKCSAgICAgICAgdmFyIGVycm9yTG9jYXRpb25zID0gdGhpcy5maW5kRXJyb3JMb2NhdGlvbnMoc2lnbWEpOwoJICAgICAgICB2YXIgZXJyb3JNYWduaXR1ZGVzID0gdGhpcy5maW5kRXJyb3JNYWduaXR1ZGVzKG9tZWdhLCBlcnJvckxvY2F0aW9ucyk7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXJyb3JMb2NhdGlvbnMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IHJlY2VpdmVkLmxlbmd0aCAtIDEgLSBmaWVsZC5sb2coZXJyb3JMb2NhdGlvbnNbaV0pOwoJICAgICAgICAgICAgaWYgKHBvc2l0aW9uIDwgMCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBSZWVkU29sb21vbkV4Y2VwdGlvbl8xLmRlZmF1bHQoJ0JhZCBlcnJvciBsb2NhdGlvbicpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVjZWl2ZWRbcG9zaXRpb25dID0gR2VuZXJpY0dGXzEkMS5kZWZhdWx0LmFkZE9yU3VidHJhY3QocmVjZWl2ZWRbcG9zaXRpb25dLCBlcnJvck1hZ25pdHVkZXNbaV0pOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZWVkU29sb21vbkRlY29kZXIucHJvdG90eXBlLnJ1bkV1Y2xpZGVhbkFsZ29yaXRobSA9IGZ1bmN0aW9uIChhLCBiLCBSIC8qaW50Ki8pIHsKCSAgICAgICAgLy8gQXNzdW1lIGEncyBkZWdyZWUgaXMgPj0gYidzCgkgICAgICAgIGlmIChhLmdldERlZ3JlZSgpIDwgYi5nZXREZWdyZWUoKSkgewoJICAgICAgICAgICAgdmFyIHRlbXAgPSBhOwoJICAgICAgICAgICAgYSA9IGI7CgkgICAgICAgICAgICBiID0gdGVtcDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICB2YXIgckxhc3QgPSBhOwoJICAgICAgICB2YXIgciA9IGI7CgkgICAgICAgIHZhciB0TGFzdCA9IGZpZWxkLmdldFplcm8oKTsKCSAgICAgICAgdmFyIHQgPSBmaWVsZC5nZXRPbmUoKTsKCSAgICAgICAgLy8gUnVuIEV1Y2xpZGVhbiBhbGdvcml0aG0gdW50aWwgcidzIGRlZ3JlZSBpcyBsZXNzIHRoYW4gUi8yCgkgICAgICAgIHdoaWxlIChyLmdldERlZ3JlZSgpID49IChSIC8gMiB8IDApKSB7CgkgICAgICAgICAgICB2YXIgckxhc3RMYXN0ID0gckxhc3Q7CgkgICAgICAgICAgICB2YXIgdExhc3RMYXN0ID0gdExhc3Q7CgkgICAgICAgICAgICByTGFzdCA9IHI7CgkgICAgICAgICAgICB0TGFzdCA9IHQ7CgkgICAgICAgICAgICAvLyBEaXZpZGUgckxhc3RMYXN0IGJ5IHJMYXN0LCB3aXRoIHF1b3RpZW50IGluIHEgYW5kIHJlbWFpbmRlciBpbiByCgkgICAgICAgICAgICBpZiAockxhc3QuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgICAgICAvLyBPb3BzLCBFdWNsaWRlYW4gYWxnb3JpdGhtIGFscmVhZHkgdGVybWluYXRlZD8KCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmVlZFNvbG9tb25FeGNlcHRpb25fMS5kZWZhdWx0KCdyX3tpLTF9IHdhcyB6ZXJvJyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByID0gckxhc3RMYXN0OwoJICAgICAgICAgICAgdmFyIHEgPSBmaWVsZC5nZXRaZXJvKCk7CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3JMZWFkaW5nVGVybSA9IHJMYXN0LmdldENvZWZmaWNpZW50KHJMYXN0LmdldERlZ3JlZSgpKTsKCSAgICAgICAgICAgIHZhciBkbHRJbnZlcnNlID0gZmllbGQuaW52ZXJzZShkZW5vbWluYXRvckxlYWRpbmdUZXJtKTsKCSAgICAgICAgICAgIHdoaWxlIChyLmdldERlZ3JlZSgpID49IHJMYXN0LmdldERlZ3JlZSgpICYmICFyLmlzWmVybygpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRlZ3JlZURpZmYgPSByLmdldERlZ3JlZSgpIC0gckxhc3QuZ2V0RGVncmVlKCk7CgkgICAgICAgICAgICAgICAgdmFyIHNjYWxlID0gZmllbGQubXVsdGlwbHkoci5nZXRDb2VmZmljaWVudChyLmdldERlZ3JlZSgpKSwgZGx0SW52ZXJzZSk7CgkgICAgICAgICAgICAgICAgcSA9IHEuYWRkT3JTdWJ0cmFjdChmaWVsZC5idWlsZE1vbm9taWFsKGRlZ3JlZURpZmYsIHNjYWxlKSk7CgkgICAgICAgICAgICAgICAgciA9IHIuYWRkT3JTdWJ0cmFjdChyTGFzdC5tdWx0aXBseUJ5TW9ub21pYWwoZGVncmVlRGlmZiwgc2NhbGUpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHQgPSBxLm11bHRpcGx5KHRMYXN0KS5hZGRPclN1YnRyYWN0KHRMYXN0TGFzdCk7CgkgICAgICAgICAgICBpZiAoci5nZXREZWdyZWUoKSA+PSByTGFzdC5nZXREZWdyZWUoKSkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb25fMS5kZWZhdWx0KCdEaXZpc2lvbiBhbGdvcml0aG0gZmFpbGVkIHRvIHJlZHVjZSBwb2x5bm9taWFsPycpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciBzaWdtYVRpbGRlQXRaZXJvID0gdC5nZXRDb2VmZmljaWVudCgwKTsKCSAgICAgICAgaWYgKHNpZ21hVGlsZGVBdFplcm8gPT09IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBSZWVkU29sb21vbkV4Y2VwdGlvbl8xLmRlZmF1bHQoJ3NpZ21hVGlsZGUoMCkgd2FzIHplcm8nKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgaW52ZXJzZSA9IGZpZWxkLmludmVyc2Uoc2lnbWFUaWxkZUF0WmVybyk7CgkgICAgICAgIHZhciBzaWdtYSA9IHQubXVsdGlwbHlTY2FsYXIoaW52ZXJzZSk7CgkgICAgICAgIHZhciBvbWVnYSA9IHIubXVsdGlwbHlTY2FsYXIoaW52ZXJzZSk7CgkgICAgICAgIHJldHVybiBbc2lnbWEsIG9tZWdhXTsKCSAgICB9OwoJICAgIFJlZWRTb2xvbW9uRGVjb2Rlci5wcm90b3R5cGUuZmluZEVycm9yTG9jYXRpb25zID0gZnVuY3Rpb24gKGVycm9yTG9jYXRvcikgewoJICAgICAgICAvLyBUaGlzIGlzIGEgZGlyZWN0IGFwcGxpY2F0aW9uIG9mIENoaWVuJ3Mgc2VhcmNoCgkgICAgICAgIHZhciBudW1FcnJvcnMgPSBlcnJvckxvY2F0b3IuZ2V0RGVncmVlKCk7CgkgICAgICAgIGlmIChudW1FcnJvcnMgPT09IDEpIHsgLy8gc2hvcnRjdXQKCSAgICAgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW2Vycm9yTG9jYXRvci5nZXRDb2VmZmljaWVudCgxKV0pOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSBuZXcgSW50MzJBcnJheShudW1FcnJvcnMpOwoJICAgICAgICB2YXIgZSA9IDA7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgZmllbGQuZ2V0U2l6ZSgpICYmIGUgPCBudW1FcnJvcnM7IGkrKykgewoJICAgICAgICAgICAgaWYgKGVycm9yTG9jYXRvci5ldmFsdWF0ZUF0KGkpID09PSAwKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0W2VdID0gZmllbGQuaW52ZXJzZShpKTsKCSAgICAgICAgICAgICAgICBlKys7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGUgIT09IG51bUVycm9ycykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IFJlZWRTb2xvbW9uRXhjZXB0aW9uXzEuZGVmYXVsdCgnRXJyb3IgbG9jYXRvciBkZWdyZWUgZG9lcyBub3QgbWF0Y2ggbnVtYmVyIG9mIHJvb3RzJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIFJlZWRTb2xvbW9uRGVjb2Rlci5wcm90b3R5cGUuZmluZEVycm9yTWFnbml0dWRlcyA9IGZ1bmN0aW9uIChlcnJvckV2YWx1YXRvciwgZXJyb3JMb2NhdGlvbnMpIHsKCSAgICAgICAgLy8gVGhpcyBpcyBkaXJlY3RseSBhcHBseWluZyBGb3JuZXkncyBGb3JtdWxhCgkgICAgICAgIHZhciBzID0gZXJyb3JMb2NhdGlvbnMubGVuZ3RoOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IEludDMyQXJyYXkocyk7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgczsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgeGlJbnZlcnNlID0gZmllbGQuaW52ZXJzZShlcnJvckxvY2F0aW9uc1tpXSk7CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3IgPSAxOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzOyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAoaSAhPT0gaikgewoJICAgICAgICAgICAgICAgICAgICAvLyBkZW5vbWluYXRvciA9IGZpZWxkLm11bHRpcGx5KGRlbm9taW5hdG9yLAoJICAgICAgICAgICAgICAgICAgICAvLyAgICBHZW5lcmljR0YuYWRkT3JTdWJ0cmFjdCgxLCBmaWVsZC5tdWx0aXBseShlcnJvckxvY2F0aW9uc1tqXSwgeGlJbnZlcnNlKSkpCgkgICAgICAgICAgICAgICAgICAgIC8vIEFib3ZlIHNob3VsZCB3b3JrIGJ1dCBmYWlscyBvbiBzb21lIEFwcGxlIGFuZCBMaW51eCBKREtzIGR1ZSB0byBhIEhvdHNwb3QgYnVnLgoJICAgICAgICAgICAgICAgICAgICAvLyBCZWxvdyBpcyBhIGZ1bm55LWxvb2tpbmcgd29ya2Fyb3VuZCBmcm9tIFN0ZXZlbiBQYXJrZXMKCSAgICAgICAgICAgICAgICAgICAgdmFyIHRlcm0gPSBmaWVsZC5tdWx0aXBseShlcnJvckxvY2F0aW9uc1tqXSwgeGlJbnZlcnNlKTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIHRlcm1QbHVzMSA9ICh0ZXJtICYgMHgxKSA9PT0gMCA/IHRlcm0gfCAxIDogdGVybSAmIH4xOwoJICAgICAgICAgICAgICAgICAgICBkZW5vbWluYXRvciA9IGZpZWxkLm11bHRpcGx5KGRlbm9taW5hdG9yLCB0ZXJtUGx1czEpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdFtpXSA9IGZpZWxkLm11bHRpcGx5KGVycm9yRXZhbHVhdG9yLmV2YWx1YXRlQXQoeGlJbnZlcnNlKSwgZmllbGQuaW52ZXJzZShkZW5vbWluYXRvcikpOwoJICAgICAgICAgICAgaWYgKGZpZWxkLmdldEdlbmVyYXRvckJhc2UoKSAhPT0gMCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdFtpXSA9IGZpZWxkLm11bHRpcGx5KHJlc3VsdFtpXSwgeGlJbnZlcnNlKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgcmV0dXJuIFJlZWRTb2xvbW9uRGVjb2RlcjsKCX0oKSk7CglSZWVkU29sb21vbkRlY29kZXIkMS5kZWZhdWx0ID0gUmVlZFNvbG9tb25EZWNvZGVyOwoKCXZhciBCaXRNYXRyaXhQYXJzZXIkMSA9IHt9OwoKCXZhciBWZXJzaW9uJDEgPSB7fTsKCgl2YXIgRm9ybWF0SW5mb3JtYXRpb24kMSA9IHt9OwoKCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbCA9IHt9OwoKCXZhciBBcmd1bWVudEV4Y2VwdGlvbiQxID0ge307CgoJdmFyIF9fZXh0ZW5kcyQzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFyZ3VtZW50RXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBFeGNlcHRpb25fMSA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBBcmd1bWVudEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkMyhBcmd1bWVudEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBBcmd1bWVudEV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBBcmd1bWVudEV4Y2VwdGlvbi5raW5kID0gJ0FyZ3VtZW50RXhjZXB0aW9uJzsKCSAgICByZXR1cm4gQXJndW1lbnRFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xLmRlZmF1bHQpKTsKCUFyZ3VtZW50RXhjZXB0aW9uJDEuZGVmYXVsdCA9IEFyZ3VtZW50RXhjZXB0aW9uOwoKCShmdW5jdGlvbiAoZXhwb3J0cykgewoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CglleHBvcnRzLkVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzID0gdm9pZCAwOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBBcmd1bWVudEV4Y2VwdGlvbl8xID0gQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJdmFyIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzOwoJKGZ1bmN0aW9uIChFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcykgewoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzW0Vycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzWyJMIl0gPSAwXSA9ICJMIjsKCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlc1tFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlc1siTSJdID0gMV0gPSAiTSI7CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXNbRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXNbIlEiXSA9IDJdID0gIlEiOwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzW0Vycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzWyJIIl0gPSAzXSA9ICJIIjsKCX0pKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzID0gZXhwb3J0cy5FcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcyB8fCAoZXhwb3J0cy5FcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcyA9IHt9KSk7CgkvKioKCSAqIDxwPlNlZSBJU08gMTgwMDQ6MjAwNiwgNi41LjEuIFRoaXMgZW51bSBlbmNhcHN1bGF0ZXMgdGhlIGZvdXIgZXJyb3IgY29ycmVjdGlvbiBsZXZlbHMKCSAqIGRlZmluZWQgYnkgdGhlIFFSIGNvZGUgc3RhbmRhcmQuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBFcnJvckNvcnJlY3Rpb25MZXZlbCh2YWx1ZSwgc3RyaW5nVmFsdWUsIGJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuc3RyaW5nVmFsdWUgPSBzdHJpbmdWYWx1ZTsKCSAgICAgICAgdGhpcy5iaXRzID0gYml0czsKCSAgICAgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuc2V0KGJpdHMsIHRoaXMpOwoJICAgICAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5GT1JfVkFMVUUuc2V0KHZhbHVlLCB0aGlzKTsKCSAgICB9CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTsKCSAgICB9OwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsLnByb3RvdHlwZS5nZXRCaXRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRzOwoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuZnJvbVN0cmluZyA9IGZ1bmN0aW9uIChzKSB7CgkgICAgICAgIHN3aXRjaCAocykgewoJICAgICAgICAgICAgY2FzZSAnTCc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5MOwoJICAgICAgICAgICAgY2FzZSAnTSc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5NOwoJICAgICAgICAgICAgY2FzZSAnUSc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5ROwoJICAgICAgICAgICAgY2FzZSAnSCc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5IOwoJICAgICAgICAgICAgZGVmYXVsdDogdGhyb3cgbmV3IEFyZ3VtZW50RXhjZXB0aW9uXzEuZGVmYXVsdChzICsgJ25vdCBhdmFpbGFibGUnKTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdWYWx1ZTsKCSAgICB9OwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgRXJyb3JDb3JyZWN0aW9uTGV2ZWwpKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG90aGVyID0gbzsKCSAgICAgICAgcmV0dXJuIHRoaXMudmFsdWUgPT09IG90aGVyLnZhbHVlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJpdHMgaW50IGNvbnRhaW5pbmcgdGhlIHR3byBiaXRzIGVuY29kaW5nIGEgUVIgQ29kZSdzIGVycm9yIGNvcnJlY3Rpb24gbGV2ZWwKCSAgICAgKiBAcmV0dXJuIEVycm9yQ29ycmVjdGlvbkxldmVsIHJlcHJlc2VudGluZyB0aGUgZW5jb2RlZCBlcnJvciBjb3JyZWN0aW9uIGxldmVsCgkgICAgICovCgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuZm9yQml0cyA9IGZ1bmN0aW9uIChiaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGJpdHMgPCAwIHx8IGJpdHMgPj0gRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuc2l6ZSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuZ2V0KGJpdHMpOwoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMgPSBuZXcgTWFwKCk7CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX1ZBTFVFID0gbmV3IE1hcCgpOwoJICAgIC8qKiBMID0gfjclIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5MID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLkwsICdMJywgMHgwMSk7CgkgICAgLyoqIE0gPSB+MTUlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5NID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLk0sICdNJywgMHgwMCk7CgkgICAgLyoqIFEgPSB+MjUlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5RID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLlEsICdRJywgMHgwMyk7CgkgICAgLyoqIEggPSB+MzAlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5IID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLkgsICdIJywgMHgwMik7CgkgICAgcmV0dXJuIEVycm9yQ29ycmVjdGlvbkxldmVsOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IEVycm9yQ29ycmVjdGlvbkxldmVsOwoKCX0oRXJyb3JDb3JyZWN0aW9uTGV2ZWwpKTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDYgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRm9ybWF0SW5mb3JtYXRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbF8xID0gRXJyb3JDb3JyZWN0aW9uTGV2ZWw7Cgl2YXIgSW50ZWdlcl8xID0gSW50ZWdlciQxOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgYSBRUiBDb2RlJ3MgZm9ybWF0IGluZm9ybWF0aW9uLCBpbmNsdWRpbmcgdGhlIGRhdGEgbWFzayB1c2VkIGFuZAoJICogZXJyb3IgY29ycmVjdGlvbiBsZXZlbC48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBzZWUgRGF0YU1hc2sKCSAqIEBzZWUgRXJyb3JDb3JyZWN0aW9uTGV2ZWwKCSAqLwoJdmFyIEZvcm1hdEluZm9ybWF0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEZvcm1hdEluZm9ybWF0aW9uKGZvcm1hdEluZm8gLyppbnQqLykgewoJICAgICAgICAvLyBCaXRzIDMsNAoJICAgICAgICB0aGlzLmVycm9yQ29ycmVjdGlvbkxldmVsID0gRXJyb3JDb3JyZWN0aW9uTGV2ZWxfMS5kZWZhdWx0LmZvckJpdHMoKGZvcm1hdEluZm8gPj4gMykgJiAweDAzKTsKCSAgICAgICAgLy8gQm90dG9tIDMgYml0cwoJICAgICAgICB0aGlzLmRhdGFNYXNrID0gLyooYnl0ZSkgKi8gKGZvcm1hdEluZm8gJiAweDA3KTsKCSAgICB9CgkgICAgRm9ybWF0SW5mb3JtYXRpb24ubnVtQml0c0RpZmZlcmluZyA9IGZ1bmN0aW9uIChhIC8qaW50Ki8sIGIgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gSW50ZWdlcl8xLmRlZmF1bHQuYml0Q291bnQoYSBeIGIpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIG1hc2tlZEZvcm1hdEluZm8xIGZvcm1hdCBpbmZvIGluZGljYXRvciwgd2l0aCBtYXNrIHN0aWxsIGFwcGxpZWQKCSAgICAgKiBAcGFyYW0gbWFza2VkRm9ybWF0SW5mbzIgc2Vjb25kIGNvcHkgb2Ygc2FtZSBpbmZvOyBib3RoIGFyZSBjaGVja2VkIGF0IHRoZSBzYW1lIHRpbWUKCSAgICAgKiAgdG8gZXN0YWJsaXNoIGJlc3QgbWF0Y2gKCSAgICAgKiBAcmV0dXJuIGluZm9ybWF0aW9uIGFib3V0IHRoZSBmb3JtYXQgaXQgc3BlY2lmaWVzLCBvciB7QGNvZGUgbnVsbH0KCSAgICAgKiAgaWYgZG9lc24ndCBzZWVtIHRvIG1hdGNoIGFueSBrbm93biBwYXR0ZXJuCgkgICAgICovCgkgICAgRm9ybWF0SW5mb3JtYXRpb24uZGVjb2RlRm9ybWF0SW5mb3JtYXRpb24gPSBmdW5jdGlvbiAobWFza2VkRm9ybWF0SW5mbzEgLyppbnQqLywgbWFza2VkRm9ybWF0SW5mbzIgLyppbnQqLykgewoJICAgICAgICB2YXIgZm9ybWF0SW5mbyA9IEZvcm1hdEluZm9ybWF0aW9uLmRvRGVjb2RlRm9ybWF0SW5mb3JtYXRpb24obWFza2VkRm9ybWF0SW5mbzEsIG1hc2tlZEZvcm1hdEluZm8yKTsKCSAgICAgICAgaWYgKGZvcm1hdEluZm8gIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiBmb3JtYXRJbmZvOwoJICAgICAgICB9CgkgICAgICAgIC8vIFNob3VsZCByZXR1cm4gbnVsbCwgYnV0LCBzb21lIFFSIGNvZGVzIGFwcGFyZW50bHkKCSAgICAgICAgLy8gZG8gbm90IG1hc2sgdGhpcyBpbmZvLiBUcnkgYWdhaW4gYnkgYWN0dWFsbHkgbWFza2luZyB0aGUgcGF0dGVybgoJICAgICAgICAvLyBmaXJzdAoJICAgICAgICByZXR1cm4gRm9ybWF0SW5mb3JtYXRpb24uZG9EZWNvZGVGb3JtYXRJbmZvcm1hdGlvbihtYXNrZWRGb3JtYXRJbmZvMSBeIEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX01BU0tfUVIsIG1hc2tlZEZvcm1hdEluZm8yIF4gRm9ybWF0SW5mb3JtYXRpb24uRk9STUFUX0lORk9fTUFTS19RUik7CgkgICAgfTsKCSAgICBGb3JtYXRJbmZvcm1hdGlvbi5kb0RlY29kZUZvcm1hdEluZm9ybWF0aW9uID0gZnVuY3Rpb24gKG1hc2tlZEZvcm1hdEluZm8xIC8qaW50Ki8sIG1hc2tlZEZvcm1hdEluZm8yIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGVfMSwgX2E7CgkgICAgICAgIC8vIEZpbmQgdGhlIGludCBpbiBGT1JNQVRfSU5GT19ERUNPREVfTE9PS1VQIHdpdGggZmV3ZXN0IGJpdHMgZGlmZmVyaW5nCgkgICAgICAgIHZhciBiZXN0RGlmZmVyZW5jZSA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSOwoJICAgICAgICB2YXIgYmVzdEZvcm1hdEluZm8gPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgX2IgPSBfX3ZhbHVlcyQ2KEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX0RFQ09ERV9MT09LVVApLCBfYyA9IF9iLm5leHQoKTsgIV9jLmRvbmU7IF9jID0gX2IubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRlY29kZUluZm8gPSBfYy52YWx1ZTsKCSAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0SW5mbyA9IGRlY29kZUluZm9bMF07CgkgICAgICAgICAgICAgICAgaWYgKHRhcmdldEluZm8gPT09IG1hc2tlZEZvcm1hdEluZm8xIHx8IHRhcmdldEluZm8gPT09IG1hc2tlZEZvcm1hdEluZm8yKSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIEZvdW5kIGFuIGV4YWN0IG1hdGNoCgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRm9ybWF0SW5mb3JtYXRpb24oZGVjb2RlSW5mb1sxXSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHZhciBiaXRzRGlmZmVyZW5jZSA9IEZvcm1hdEluZm9ybWF0aW9uLm51bUJpdHNEaWZmZXJpbmcobWFza2VkRm9ybWF0SW5mbzEsIHRhcmdldEluZm8pOwoJICAgICAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgICAgIGJlc3RGb3JtYXRJbmZvID0gZGVjb2RlSW5mb1sxXTsKCSAgICAgICAgICAgICAgICAgICAgYmVzdERpZmZlcmVuY2UgPSBiaXRzRGlmZmVyZW5jZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKG1hc2tlZEZvcm1hdEluZm8xICE9PSBtYXNrZWRGb3JtYXRJbmZvMikgewoJICAgICAgICAgICAgICAgICAgICAvLyBhbHNvIHRyeSB0aGUgb3RoZXIgb3B0aW9uCgkgICAgICAgICAgICAgICAgICAgIGJpdHNEaWZmZXJlbmNlID0gRm9ybWF0SW5mb3JtYXRpb24ubnVtQml0c0RpZmZlcmluZyhtYXNrZWRGb3JtYXRJbmZvMiwgdGFyZ2V0SW5mbyk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBiZXN0Rm9ybWF0SW5mbyA9IGRlY29kZUluZm9bMV07CgkgICAgICAgICAgICAgICAgICAgICAgICBiZXN0RGlmZmVyZW5jZSA9IGJpdHNEaWZmZXJlbmNlOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzFfMSkgeyBlXzEgPSB7IGVycm9yOiBlXzFfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2MgJiYgIV9jLmRvbmUgJiYgKF9hID0gX2IucmV0dXJuKSkgX2EuY2FsbChfYik7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gSGFtbWluZyBkaXN0YW5jZSBvZiB0aGUgMzIgbWFza2VkIGNvZGVzIGlzIDcsIGJ5IGNvbnN0cnVjdGlvbiwgc28gPD0gMyBiaXRzCgkgICAgICAgIC8vIGRpZmZlcmluZyBtZWFucyB3ZSBmb3VuZCBhIG1hdGNoCgkgICAgICAgIGlmIChiZXN0RGlmZmVyZW5jZSA8PSAzKSB7CgkgICAgICAgICAgICByZXR1cm4gbmV3IEZvcm1hdEluZm9ybWF0aW9uKGJlc3RGb3JtYXRJbmZvKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbnVsbDsKCSAgICB9OwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLnByb3RvdHlwZS5nZXRFcnJvckNvcnJlY3Rpb25MZXZlbCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZXJyb3JDb3JyZWN0aW9uTGV2ZWw7CgkgICAgfTsKCSAgICBGb3JtYXRJbmZvcm1hdGlvbi5wcm90b3R5cGUuZ2V0RGF0YU1hc2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRhdGFNYXNrOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICh0aGlzLmVycm9yQ29ycmVjdGlvbkxldmVsLmdldEJpdHMoKSA8PCAzKSB8IHRoaXMuZGF0YU1hc2s7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgRm9ybWF0SW5mb3JtYXRpb24ucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChvKSB7CgkgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBGb3JtYXRJbmZvcm1hdGlvbikpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgb3RoZXIgPSBvOwoJICAgICAgICByZXR1cm4gdGhpcy5lcnJvckNvcnJlY3Rpb25MZXZlbCA9PT0gb3RoZXIuZXJyb3JDb3JyZWN0aW9uTGV2ZWwgJiYKCSAgICAgICAgICAgIHRoaXMuZGF0YU1hc2sgPT09IG90aGVyLmRhdGFNYXNrOwoJICAgIH07CgkgICAgRm9ybWF0SW5mb3JtYXRpb24uRk9STUFUX0lORk9fTUFTS19RUiA9IDB4NTQxMjsKCSAgICAvKioKCSAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYsIEFubmV4IEMsIFRhYmxlIEMuMQoJICAgICAqLwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX0RFQ09ERV9MT09LVVAgPSBbCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1NDEyLCAweDAwXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1MTI1LCAweDAxXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1RTdDLCAweDAyXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1QjRCLCAweDAzXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0NUY5LCAweDA0XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0MENFLCAweDA1XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0Rjk3LCAweDA2XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0QUEwLCAweDA3XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3N0M0LCAweDA4XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3MkYzLCAweDA5XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3REFBLCAweDBBXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3ODlELCAweDBCXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2NjJGLCAweDBDXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2MzE4LCAweDBEXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2QzQxLCAweDBFXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2OTc2LCAweDBGXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxNjg5LCAweDEwXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxM0JFLCAweDExXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxQ0U3LCAweDEyXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxOUQwLCAweDEzXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwNzYyLCAweDE0XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwMjU1LCAweDE1XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwRDBDLCAweDE2XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwODNCLCAweDE3XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzNTVGLCAweDE4XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzMDY4LCAweDE5XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzRjMxLCAweDFBXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzQTA2LCAweDFCXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyNEI0LCAweDFDXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyMTgzLCAweDFEXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyRURBLCAweDFFXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyQkVELCAweDFGXSksCgkgICAgXTsKCSAgICByZXR1cm4gRm9ybWF0SW5mb3JtYXRpb247Cgl9KCkpOwoJRm9ybWF0SW5mb3JtYXRpb24kMS5kZWZhdWx0ID0gRm9ybWF0SW5mb3JtYXRpb247CgoJdmFyIEVDQmxvY2tzJDEgPSB7fTsKCgl2YXIgX192YWx1ZXMkNSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX3ZhbHVlcykgfHwgZnVuY3Rpb24obykgewoJICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwOwoJICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pOwoJICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHJldHVybiB7CgkgICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7CgkgICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/ICJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLiIgOiAiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpOwoJfTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFQ0Jsb2NrcyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIHNldCBvZiBlcnJvci1jb3JyZWN0aW9uIGJsb2NrcyBpbiBvbmUgc3ltYm9sIHZlcnNpb24uIE1vc3QgdmVyc2lvbnMgd2lsbAoJICogdXNlIGJsb2NrcyBvZiBkaWZmZXJpbmcgc2l6ZXMgd2l0aGluIG9uZSB2ZXJzaW9uLCBzbywgdGhpcyBlbmNhcHN1bGF0ZXMgdGhlIHBhcmFtZXRlcnMgZm9yCgkgKiBlYWNoIHNldCBvZiBibG9ja3MuIEl0IGFsc28gaG9sZHMgdGhlIG51bWJlciBvZiBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyBwZXIgYmxvY2sgc2luY2UgaXQKCSAqIHdpbGwgYmUgdGhlIHNhbWUgYWNyb3NzIGFsbCBibG9ja3Mgd2l0aGluIG9uZSB2ZXJzaW9uLjwvcD4KCSAqLwoJdmFyIEVDQmxvY2tzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEVDQmxvY2tzKGVjQ29kZXdvcmRzUGVyQmxvY2sgLyppbnQqLykgewoJICAgICAgICB2YXIgZWNCbG9ja3MgPSBbXTsKCSAgICAgICAgZm9yICh2YXIgX2kgPSAxOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgIGVjQmxvY2tzW19pIC0gMV0gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuZWNDb2Rld29yZHNQZXJCbG9jayA9IGVjQ29kZXdvcmRzUGVyQmxvY2s7CgkgICAgICAgIHRoaXMuZWNCbG9ja3MgPSBlY0Jsb2NrczsKCSAgICB9CgkgICAgRUNCbG9ja3MucHJvdG90eXBlLmdldEVDQ29kZXdvcmRzUGVyQmxvY2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmVjQ29kZXdvcmRzUGVyQmxvY2s7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0TnVtQmxvY2tzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIHRvdGFsID0gMDsKCSAgICAgICAgdmFyIGVjQmxvY2tzID0gdGhpcy5lY0Jsb2NrczsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIGVjQmxvY2tzXzEgPSBfX3ZhbHVlcyQ1KGVjQmxvY2tzKSwgZWNCbG9ja3NfMV8xID0gZWNCbG9ja3NfMS5uZXh0KCk7ICFlY0Jsb2Nrc18xXzEuZG9uZTsgZWNCbG9ja3NfMV8xID0gZWNCbG9ja3NfMS5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZWNCbG9jayA9IGVjQmxvY2tzXzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbCArPSBlY0Jsb2NrLmdldENvdW50KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChlY0Jsb2Nrc18xXzEgJiYgIWVjQmxvY2tzXzFfMS5kb25lICYmIChfYSA9IGVjQmxvY2tzXzEucmV0dXJuKSkgX2EuY2FsbChlY0Jsb2Nrc18xKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdG90YWw7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0VG90YWxFQ0NvZGV3b3JkcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZWNDb2Rld29yZHNQZXJCbG9jayAqIHRoaXMuZ2V0TnVtQmxvY2tzKCk7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0RUNCbG9ja3MgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmVjQmxvY2tzOwoJICAgIH07CgkgICAgcmV0dXJuIEVDQmxvY2tzOwoJfSgpKTsKCUVDQmxvY2tzJDEuZGVmYXVsdCA9IEVDQmxvY2tzOwoKCXZhciBFQ0IkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFQ0IkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgdGhlIHBhcmFtZXRlcnMgZm9yIG9uZSBlcnJvci1jb3JyZWN0aW9uIGJsb2NrIGluIG9uZSBzeW1ib2wgdmVyc2lvbi4KCSAqIFRoaXMgaW5jbHVkZXMgdGhlIG51bWJlciBvZiBkYXRhIGNvZGV3b3JkcywgYW5kIHRoZSBudW1iZXIgb2YgdGltZXMgYSBibG9jayB3aXRoIHRoZXNlCgkgKiBwYXJhbWV0ZXJzIGlzIHVzZWQgY29uc2VjdXRpdmVseSBpbiB0aGUgUVIgY29kZSB2ZXJzaW9uJ3MgZm9ybWF0LjwvcD4KCSAqLwoJdmFyIEVDQiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBFQ0IoY291bnQgLyppbnQqLywgZGF0YUNvZGV3b3JkcyAvKmludCovKSB7CgkgICAgICAgIHRoaXMuY291bnQgPSBjb3VudDsKCSAgICAgICAgdGhpcy5kYXRhQ29kZXdvcmRzID0gZGF0YUNvZGV3b3JkczsKCSAgICB9CgkgICAgRUNCLnByb3RvdHlwZS5nZXRDb3VudCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY291bnQ7CgkgICAgfTsKCSAgICBFQ0IucHJvdG90eXBlLmdldERhdGFDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRhdGFDb2Rld29yZHM7CgkgICAgfTsKCSAgICByZXR1cm4gRUNCOwoJfSgpKTsKCUVDQiQxLmRlZmF1bHQgPSBFQ0I7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX3ZhbHVlcyQ0ID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFZlcnNpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBCaXRNYXRyaXhfMSQzID0gQml0TWF0cml4JDE7Cgl2YXIgRm9ybWF0SW5mb3JtYXRpb25fMSQxID0gRm9ybWF0SW5mb3JtYXRpb24kMTsKCXZhciBFQ0Jsb2Nrc18xID0gRUNCbG9ja3MkMTsKCXZhciBFQ0JfMSA9IEVDQiQxOwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xJDIgPSBGb3JtYXRFeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQyID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7CgkvKioKCSAqIFNlZSBJU08gMTgwMDQ6MjAwNiBBbm5leCBECgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFZlcnNpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gVmVyc2lvbih2ZXJzaW9uTnVtYmVyIC8qaW50Ki8sIGFsaWdubWVudFBhdHRlcm5DZW50ZXJzKSB7CgkgICAgICAgIHZhciBlXzEsIF9hOwoJICAgICAgICB2YXIgZWNCbG9ja3MgPSBbXTsKCSAgICAgICAgZm9yICh2YXIgX2kgPSAyOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgIGVjQmxvY2tzW19pIC0gMl0gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMudmVyc2lvbk51bWJlciA9IHZlcnNpb25OdW1iZXI7CgkgICAgICAgIHRoaXMuYWxpZ25tZW50UGF0dGVybkNlbnRlcnMgPSBhbGlnbm1lbnRQYXR0ZXJuQ2VudGVyczsKCSAgICAgICAgdGhpcy5lY0Jsb2NrcyA9IGVjQmxvY2tzOwoJICAgICAgICB2YXIgdG90YWwgPSAwOwoJICAgICAgICB2YXIgZWNDb2Rld29yZHMgPSBlY0Jsb2Nrc1swXS5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCk7CgkgICAgICAgIHZhciBlY2JBcnJheSA9IGVjQmxvY2tzWzBdLmdldEVDQmxvY2tzKCk7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICBmb3IgKHZhciBlY2JBcnJheV8xID0gX192YWx1ZXMkNChlY2JBcnJheSksIGVjYkFycmF5XzFfMSA9IGVjYkFycmF5XzEubmV4dCgpOyAhZWNiQXJyYXlfMV8xLmRvbmU7IGVjYkFycmF5XzFfMSA9IGVjYkFycmF5XzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGVjQmxvY2sgPSBlY2JBcnJheV8xXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgdG90YWwgKz0gZWNCbG9jay5nZXRDb3VudCgpICogKGVjQmxvY2suZ2V0RGF0YUNvZGV3b3JkcygpICsgZWNDb2Rld29yZHMpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzFfMSkgeyBlXzEgPSB7IGVycm9yOiBlXzFfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoZWNiQXJyYXlfMV8xICYmICFlY2JBcnJheV8xXzEuZG9uZSAmJiAoX2EgPSBlY2JBcnJheV8xLnJldHVybikpIF9hLmNhbGwoZWNiQXJyYXlfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy50b3RhbENvZGV3b3JkcyA9IHRvdGFsOwoJICAgIH0KCSAgICBWZXJzaW9uLnByb3RvdHlwZS5nZXRWZXJzaW9uTnVtYmVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52ZXJzaW9uTnVtYmVyOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0QWxpZ25tZW50UGF0dGVybkNlbnRlcnMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0VG90YWxDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnRvdGFsQ29kZXdvcmRzOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0RGltZW5zaW9uRm9yVmVyc2lvbiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDE3ICsgNCAqIHRoaXMudmVyc2lvbk51bWJlcjsKCSAgICB9OwoJICAgIFZlcnNpb24ucHJvdG90eXBlLmdldEVDQmxvY2tzRm9yTGV2ZWwgPSBmdW5jdGlvbiAoZWNMZXZlbCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lY0Jsb2Nrc1tlY0xldmVsLmdldFZhbHVlKCldOwoJICAgICAgICAvLyBUWVBFU0NSSVBUUE9SVDogb3JpZ2luYWwgd2FzIHVzaW5nIG9yZGluYWwsIGFuZCB1c2luZyB0aGUgb3JkZXIgb2YgbGV2ZWxzIGFzIGRlZmluZWQgaW4gRXJyb3JDb3JyZWN0aW9uTGV2ZWwgZW51bSAoTE1RSCkKCSAgICAgICAgLy8gSSB3aWxsIHVzZSB0aGUgZGlyZWN0IHZhbHVlIGZyb20gRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXMgZW51bSB3aGljaCBpbiB0eXBlc2NyaXB0IGdvZXMgdG8gYSBudW1iZXIKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkRlZHVjZXMgdmVyc2lvbiBpbmZvcm1hdGlvbiBwdXJlbHkgZnJvbSBRUiBDb2RlIGRpbWVuc2lvbnMuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGRpbWVuc2lvbiBkaW1lbnNpb24gaW4gbW9kdWxlcwoJICAgICAqIEByZXR1cm4gVmVyc2lvbiBmb3IgYSBRUiBDb2RlIG9mIHRoYXQgZGltZW5zaW9uCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgZGltZW5zaW9uIGlzIG5vdCAxIG1vZCA0CgkgICAgICovCgkgICAgVmVyc2lvbi5nZXRQcm92aXNpb25hbFZlcnNpb25Gb3JEaW1lbnNpb24gPSBmdW5jdGlvbiAoZGltZW5zaW9uIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGRpbWVuc2lvbiAlIDQgIT09IDEpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMSQyLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmVyc2lvbkZvck51bWJlcigoZGltZW5zaW9uIC0gMTcpIC8gNCk7CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlnbm9yZWQgLyo6IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEkMi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFZlcnNpb24uZ2V0VmVyc2lvbkZvck51bWJlciA9IGZ1bmN0aW9uICh2ZXJzaW9uTnVtYmVyIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKHZlcnNpb25OdW1iZXIgPCAxIHx8IHZlcnNpb25OdW1iZXIgPiA0MCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDIuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBWZXJzaW9uLlZFUlNJT05TW3ZlcnNpb25OdW1iZXIgLSAxXTsKCSAgICB9OwoJICAgIFZlcnNpb24uZGVjb2RlVmVyc2lvbkluZm9ybWF0aW9uID0gZnVuY3Rpb24gKHZlcnNpb25CaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGJlc3REaWZmZXJlbmNlID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgICAgIHZhciBiZXN0VmVyc2lvbiA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgVmVyc2lvbi5WRVJTSU9OX0RFQ09ERV9JTkZPLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgdGFyZ2V0VmVyc2lvbiA9IFZlcnNpb24uVkVSU0lPTl9ERUNPREVfSU5GT1tpXTsKCSAgICAgICAgICAgIC8vIERvIHRoZSB2ZXJzaW9uIGluZm8gYml0cyBtYXRjaCBleGFjdGx5PyBkb25lLgoJICAgICAgICAgICAgaWYgKHRhcmdldFZlcnNpb24gPT09IHZlcnNpb25CaXRzKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIFZlcnNpb24uZ2V0VmVyc2lvbkZvck51bWJlcihpICsgNyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBPdGhlcndpc2Ugc2VlIGlmIHRoaXMgaXMgdGhlIGNsb3Nlc3QgdG8gYSByZWFsIHZlcnNpb24gaW5mbyBiaXQgc3RyaW5nCgkgICAgICAgICAgICAvLyB3ZSBoYXZlIHNlZW4gc28gZmFyCgkgICAgICAgICAgICB2YXIgYml0c0RpZmZlcmVuY2UgPSBGb3JtYXRJbmZvcm1hdGlvbl8xJDEuZGVmYXVsdC5udW1CaXRzRGlmZmVyaW5nKHZlcnNpb25CaXRzLCB0YXJnZXRWZXJzaW9uKTsKCSAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgYmVzdFZlcnNpb24gPSBpICsgNzsKCSAgICAgICAgICAgICAgICBiZXN0RGlmZmVyZW5jZSA9IGJpdHNEaWZmZXJlbmNlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIFdlIGNhbiB0b2xlcmF0ZSB1cCB0byAzIGJpdHMgb2YgZXJyb3Igc2luY2Ugbm8gdHdvIHZlcnNpb24gaW5mbyBjb2Rld29yZHMgd2lsbAoJICAgICAgICAvLyBkaWZmZXIgaW4gbGVzcyB0aGFuIDggYml0cy4KCSAgICAgICAgaWYgKGJlc3REaWZmZXJlbmNlIDw9IDMpIHsKCSAgICAgICAgICAgIHJldHVybiBWZXJzaW9uLmdldFZlcnNpb25Gb3JOdW1iZXIoYmVzdFZlcnNpb24pOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHdlIGRpZG4ndCBmaW5kIGEgY2xvc2UgZW5vdWdoIG1hdGNoLCBmYWlsCgkgICAgICAgIHJldHVybiBudWxsOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogU2VlIElTTyAxODAwNDoyMDA2IEFubmV4IEUKCSAgICAgKi8KCSAgICBWZXJzaW9uLnByb3RvdHlwZS5idWlsZEZ1bmN0aW9uUGF0dGVybiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuZ2V0RGltZW5zaW9uRm9yVmVyc2lvbigpOwoJICAgICAgICB2YXIgYml0TWF0cml4ID0gbmV3IEJpdE1hdHJpeF8xJDMuZGVmYXVsdChkaW1lbnNpb24pOwoJICAgICAgICAvLyBUb3AgbGVmdCBmaW5kZXIgcGF0dGVybiArIHNlcGFyYXRvciArIGZvcm1hdAoJICAgICAgICBiaXRNYXRyaXguc2V0UmVnaW9uKDAsIDAsIDksIDkpOwoJICAgICAgICAvLyBUb3AgcmlnaHQgZmluZGVyIHBhdHRlcm4gKyBzZXBhcmF0b3IgKyBmb3JtYXQKCSAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbihkaW1lbnNpb24gLSA4LCAwLCA4LCA5KTsKCSAgICAgICAgLy8gQm90dG9tIGxlZnQgZmluZGVyIHBhdHRlcm4gKyBzZXBhcmF0b3IgKyBmb3JtYXQKCSAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbigwLCBkaW1lbnNpb24gLSA4LCA5LCA4KTsKCSAgICAgICAgLy8gQWxpZ25tZW50IHBhdHRlcm5zCgkgICAgICAgIHZhciBtYXggPSB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBtYXg7IHgrKykgewoJICAgICAgICAgICAgdmFyIGkgPSB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzW3hdIC0gMjsKCSAgICAgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgbWF4OyB5KyspIHsKCSAgICAgICAgICAgICAgICBpZiAoKHggPT09IDAgJiYgKHkgPT09IDAgfHwgeSA9PT0gbWF4IC0gMSkpIHx8ICh4ID09PSBtYXggLSAxICYmIHkgPT09IDApKSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIE5vIGFsaWdubWVudCBwYXR0ZXJucyBuZWFyIHRoZSB0aHJlZSBmaW5kZXIgcGF0dGVybnMKCSAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24odGhpcy5hbGlnbm1lbnRQYXR0ZXJuQ2VudGVyc1t5XSAtIDIsIGksIDUsIDUpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIFZlcnRpY2FsIHRpbWluZyBwYXR0ZXJuCgkgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oNiwgOSwgMSwgZGltZW5zaW9uIC0gMTcpOwoJICAgICAgICAvLyBIb3Jpem9udGFsIHRpbWluZyBwYXR0ZXJuCgkgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oOSwgNiwgZGltZW5zaW9uIC0gMTcsIDEpOwoJICAgICAgICBpZiAodGhpcy52ZXJzaW9uTnVtYmVyID4gNikgewoJICAgICAgICAgICAgLy8gVmVyc2lvbiBpbmZvLCB0b3AgcmlnaHQKCSAgICAgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oZGltZW5zaW9uIC0gMTEsIDAsIDMsIDYpOwoJICAgICAgICAgICAgLy8gVmVyc2lvbiBpbmZvLCBib3R0b20gbGVmdAoJICAgICAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbigwLCBkaW1lbnNpb24gLSAxMSwgNiwgMyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdE1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBWZXJzaW9uLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICcnICsgdGhpcy52ZXJzaW9uTnVtYmVyOwoJICAgIH07CgkgICAgLyoqCgkgICAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYgQW5uZXggRC4KCSAgICAgICAqIEVsZW1lbnQgaSByZXByZXNlbnRzIHRoZSByYXcgdmVyc2lvbiBiaXRzIHRoYXQgc3BlY2lmeSB2ZXJzaW9uIGkgKyA3CgkgICAgICAgKi8KCSAgICBWZXJzaW9uLlZFUlNJT05fREVDT0RFX0lORk8gPSBJbnQzMkFycmF5LmZyb20oWwoJICAgICAgICAweDA3Qzk0LCAweDA4NUJDLCAweDA5QTk5LCAweDBBNEQzLCAweDBCQkY2LAoJICAgICAgICAweDBDNzYyLCAweDBEODQ3LCAweDBFNjBELCAweDBGOTI4LCAweDEwQjc4LAoJICAgICAgICAweDExNDVELCAweDEyQTE3LCAweDEzNTMyLCAweDE0OUE2LCAweDE1NjgzLAoJICAgICAgICAweDE2OEM5LCAweDE3N0VDLCAweDE4RUM0LCAweDE5MUUxLCAweDFBRkFCLAoJICAgICAgICAweDFCMDhFLCAweDFDQzFBLCAweDFEMzNGLCAweDFFRDc1LCAweDFGMjUwLAoJICAgICAgICAweDIwOUQ1LCAweDIxNkYwLCAweDIyOEJBLCAweDIzNzlGLCAweDI0QjBCLAoJICAgICAgICAweDI1NDJFLCAweDI2QTY0LCAweDI3NTQxLCAweDI4QzY5CgkgICAgXSk7CgkgICAgLyoqCgkgICAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYgNi41LjEgVGFibGUgOQoJICAgICAgICovCgkgICAgVmVyc2lvbi5WRVJTSU9OUyA9IFsKCSAgICAgICAgbmV3IFZlcnNpb24oMSwgbmV3IEludDMyQXJyYXkoMCksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoNywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxMCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxMywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxNywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgOSkpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMiwgSW50MzJBcnJheS5mcm9tKFs2LCAxOF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDEwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAzNCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE2LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAyOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAyMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMywgSW50MzJBcnJheS5mcm9tKFs2LCAyMl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE1LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA1NSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA0NCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oNCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA4MCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAyNCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA5KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbig1LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDEwOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCA0MykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExKSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTIpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDYsIEludDMyQXJyYXkuZnJvbShbNiwgMzRdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgNjgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDcsIEludDMyQXJyYXkuZnJvbShbNiwgMjIsIDM4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDc4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDMxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTMpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxNCkpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oOCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNCwgNDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgOTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMzgpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzOSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxOCksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE5KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDksIEludDMyQXJyYXkuZnJvbShbNiwgMjYsIDQ2XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCAzNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDM3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTAsIEludDMyQXJyYXkuZnJvbShbNiwgMjgsIDUwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDY4KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgNjkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDMpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA0NCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxOSksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDIwKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDExLCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIwLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA4MSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA1MCksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDUxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTIpLCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTIsIEludDMyQXJyYXkuZnJvbShbNiwgMzIsIDU4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDkyKSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgOTMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMzYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAyMCksIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDEzLCBJbnQzMkFycmF5LmZyb20oWzYsIDM0LCA2Ml0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMzcpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAzOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAyMCksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDEyLCAxMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDEyKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNDYsIDY2XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA0MCksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDQxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDE3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNSwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNDgsIDcwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDg3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgODgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgNDEpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCA0MikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNiwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTAsIDc0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDk4KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgOTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNywgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCA0NikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMTkpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAyMCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTcsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU0LCA3OF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxMDcpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAxMDgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjIpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDE4LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NiwgODJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgMTIwKSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDksIDQzKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxOSwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDE5LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1OCwgODZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTEzKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTE0KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDQ0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDQ1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDE3LCAyMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDksIDEzKSwgbmV3IEVDQl8xLmRlZmF1bHQoMTYsIDE0KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyMCwgSW50MzJBcnJheS5mcm9tKFs2LCAzNCwgNjIsIDkwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDEwNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDEwOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgzLCA0MSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCA0MikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDIxLCBJbnQzMkFycmF5LmZyb20oWzYsIDI4LCA1MCwgNzIsIDk0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgNDIpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDIyLCBJbnQzMkFycmF5LmZyb20oWzYsIDI2LCA1MCwgNzQsIDk4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDExMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNywgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNiwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMzQsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyMywgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTQsIDc4LCAxMDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIxKSwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgMTIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTQsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNiwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDI0LCBJbnQzMkFycmF5LmZyb20oWzYsIDI4LCA1NCwgODAsIDEwNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMTcpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMTgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTYsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMwLCAxNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE3KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyNSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMiwgNTgsIDg0LCAxMTBdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMTA2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTA3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDgsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjIsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMjYsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU4LCA4NiwgMTE0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAxMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxMTUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjgsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMzMsIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDI3LCBJbnQzMkFycmF5LmZyb20oWzYsIDM0LCA2MiwgOTAsIDExOF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAxMjIpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjIsIDQ1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMjMpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNiwgMjQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTIsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjgsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyOCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTAsIDc0LCA5OCwgMTIyXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDExNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAxMTgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgzMSwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzEsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyOSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTQsIDc4LCAxMDIsIDEyNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCAxMTYpLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCAxMTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjEsIDQ1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjMpLCBuZXcgRUNCXzEuZGVmYXVsdCgzNywgMjQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjYsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzMCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTIsIDc4LCAxMDQsIDEzMF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAxMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMTE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCA0NyksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCA0OCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNSwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjMsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjUsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzMSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTYsIDgyLCAxMDgsIDEzNF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxMywgMTE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjksIDQ3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQyLCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIzLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDI4LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzIsIEludDMyQXJyYXkuZnJvbShbNiwgMzQsIDYwLCA4NiwgMTEyLCAxMzhdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDExNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzUsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDM1LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzMsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU4LCA4NiwgMTE0LCAxNDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMSwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjksIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQ2LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzQsIEludDMyQXJyYXkuZnJvbShbNiwgMzQsIDYyLCA5MCwgMTE4LCAxNDZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNDQsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNywgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNTksIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDM1LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NCwgNzgsIDEwMiwgMTI2LCAxNTBdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTIsIDEyMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDEyMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxMiwgNDcpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNiwgNDgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMzksIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTQsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQxLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzYsIEludDMyQXJyYXkuZnJvbShbNiwgMjQsIDUwLCA3NiwgMTAyLCAxMjgsIDE1NF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMjEpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgMTIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzQsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQ2LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDY0LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzcsIEludDMyQXJyYXkuZnJvbShbNiwgMjgsIDU0LCA4MCwgMTA2LCAxMzIsIDE1OF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgMTIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIzKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDI5LCA0NiksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCA0NykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0OSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjQsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNDYsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzOCwgSW50MzJBcnJheS5mcm9tKFs2LCAzMiwgNTgsIDg0LCAxMTAsIDEzNiwgMTYyXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDEyMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDE4LCAxMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzIsIDQ3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQ4LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0MiwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgzMiwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDM5LCBJbnQzMkFycmF5LmZyb20oWzYsIDI2LCA1NCwgODIsIDExMCwgMTM4LCAxNjZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjAsIDExNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCg0MCwgNDcpLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCA0OCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0MywgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMiwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNjcsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbig0MCwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTgsIDg2LCAxMTQsIDE0MiwgMTcwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCAxMTgpLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTgsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzEsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDM0LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDM0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgyMCwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCg2MSwgMTYpKSkKCSAgICBdOwoJICAgIHJldHVybiBWZXJzaW9uOwoJfSgpKTsKCVZlcnNpb24kMS5kZWZhdWx0ID0gVmVyc2lvbjsKCgl2YXIgRGF0YU1hc2sgPSB7fTsKCgkoZnVuY3Rpb24gKGV4cG9ydHMpIHsKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJZXhwb3J0cy5EYXRhTWFza1ZhbHVlcyA9IHZvaWQgMDsKCXZhciBEYXRhTWFza1ZhbHVlczsKCShmdW5jdGlvbiAoRGF0YU1hc2tWYWx1ZXMpIHsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzAwMCJdID0gMF0gPSAiREFUQV9NQVNLXzAwMCI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18wMDEiXSA9IDFdID0gIkRBVEFfTUFTS18wMDEiOwoJICAgIERhdGFNYXNrVmFsdWVzW0RhdGFNYXNrVmFsdWVzWyJEQVRBX01BU0tfMDEwIl0gPSAyXSA9ICJEQVRBX01BU0tfMDEwIjsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzAxMSJdID0gM10gPSAiREFUQV9NQVNLXzAxMSI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18xMDAiXSA9IDRdID0gIkRBVEFfTUFTS18xMDAiOwoJICAgIERhdGFNYXNrVmFsdWVzW0RhdGFNYXNrVmFsdWVzWyJEQVRBX01BU0tfMTAxIl0gPSA1XSA9ICJEQVRBX01BU0tfMTAxIjsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzExMCJdID0gNl0gPSAiREFUQV9NQVNLXzExMCI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18xMTEiXSA9IDddID0gIkRBVEFfTUFTS18xMTEiOwoJfSkoRGF0YU1hc2tWYWx1ZXMgPSBleHBvcnRzLkRhdGFNYXNrVmFsdWVzIHx8IChleHBvcnRzLkRhdGFNYXNrVmFsdWVzID0ge30pKTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGRhdGEgbWFza3MgZm9yIHRoZSBkYXRhIGJpdHMgaW4gYSBRUiBjb2RlLCBwZXIgSVNPIDE4MDA0OjIwMDYgNi44LiBJbXBsZW1lbnRhdGlvbnMKCSAqIG9mIHRoaXMgY2xhc3MgY2FuIHVuLW1hc2sgYSByYXcgQml0TWF0cml4LiBGb3Igc2ltcGxpY2l0eSwgdGhleSB3aWxsIHVubWFzayB0aGUgZW50aXJlIEJpdE1hdHJpeCwKCSAqIGluY2x1ZGluZyBhcmVhcyB1c2VkIGZvciBmaW5kZXIgcGF0dGVybnMsIHRpbWluZyBwYXR0ZXJucywgZXRjLiBUaGVzZSBhcmVhcyBzaG91bGQgYmUgdW51c2VkCgkgKiBhZnRlciB0aGUgcG9pbnQgdGhleSBhcmUgdW5tYXNrZWQgYW55d2F5LjwvcD4KCSAqCgkgKiA8cD5Ob3RlIHRoYXQgdGhlIGRpYWdyYW0gaW4gc2VjdGlvbiA2LjguMSBpcyBtaXNsZWFkaW5nIHNpbmNlIGl0IGluZGljYXRlcyB0aGF0IGkgaXMgY29sdW1uIHBvc2l0aW9uCgkgKiBhbmQgaiBpcyByb3cgcG9zaXRpb24uIEluIGZhY3QsIGFzIHRoZSB0ZXh0IHNheXMsIGkgaXMgcm93IHBvc2l0aW9uIGFuZCBqIGlzIGNvbHVtbiBwb3NpdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERhdGFNYXNrID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8vIFNlZSBJU08gMTgwMDQ6MjAwNiA2LjguMQoJICAgIGZ1bmN0aW9uIERhdGFNYXNrKHZhbHVlLCBpc01hc2tlZCkgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuaXNNYXNrZWQgPSBpc01hc2tlZDsKCSAgICB9CgkgICAgLy8gRW5kIG9mIGVudW0gY29uc3RhbnRzLgoJICAgIC8qKgoJICAgICAqIDxwPkltcGxlbWVudGF0aW9ucyBvZiB0aGlzIG1ldGhvZCByZXZlcnNlIHRoZSBkYXRhIG1hc2tpbmcgcHJvY2VzcyBhcHBsaWVkIHRvIGEgUVIgQ29kZSBhbmQKCSAgICAgKiBtYWtlIGl0cyBiaXRzIHJlYWR5IHRvIHJlYWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGJpdHMgcmVwcmVzZW50YXRpb24gb2YgUVIgQ29kZSBiaXRzCgkgICAgICogQHBhcmFtIGRpbWVuc2lvbiBkaW1lbnNpb24gb2YgUVIgQ29kZSwgcmVwcmVzZW50ZWQgYnkgYml0cywgYmVpbmcgdW5tYXNrZWQKCSAgICAgKi8KCSAgICBEYXRhTWFzay5wcm90b3R5cGUudW5tYXNrQml0TWF0cml4ID0gZnVuY3Rpb24gKGJpdHMsIGRpbWVuc2lvbiAvKmludCovKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGltZW5zaW9uOyBpKyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgZGltZW5zaW9uOyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5pc01hc2tlZChpLCBqKSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLmZsaXAoaiwgaSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBEYXRhTWFzay52YWx1ZXMgPSBuZXcgTWFwKFsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIDAwMDogbWFzayBiaXRzIGZvciB3aGljaCAoeCArIHkpIG1vZCAyID09IDAKCSAgICAgICAgICovCgkgICAgICAgIFtEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMDAwLCBuZXcgRGF0YU1hc2soRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAwMCwgZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovKSB7IHJldHVybiAoKGkgKyBqKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAwMDE6IG1hc2sgYml0cyBmb3Igd2hpY2ggeCBtb2QgMiA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAwMSwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMDEsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKGkgJiAweDAxKSA9PT0gMDsgfSldLAoJICAgICAgICAvKioKCSAgICAgICAgICogMDEwOiBtYXNrIGJpdHMgZm9yIHdoaWNoIHkgbW9kIDMgPT0gMAoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMTAsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMDEwLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuIGogJSAzID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAwMTE6IG1hc2sgYml0cyBmb3Igd2hpY2ggKHggKyB5KSBtb2QgMyA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAxMSwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMTEsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKGkgKyBqKSAlIDMgPT09IDA7IH0pXSwKCSAgICAgICAgLyoqCgkgICAgICAgICAqIDEwMDogbWFzayBiaXRzIGZvciB3aGljaCAoeC8yICsgeS8zKSBtb2QgMiA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzEwMCwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMDAsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKChNYXRoLmZsb29yKGkgLyAyKSArIE1hdGguZmxvb3IoaiAvIDMpKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAxMDE6IG1hc2sgYml0cyBmb3Igd2hpY2ggeHkgbW9kIDIgKyB4eSBtb2QgMyA9PSAwCgkgICAgICAgICAqIGVxdWl2YWxlbnRseSwgc3VjaCB0aGF0IHh5IG1vZCA2ID09IDAKCSAgICAgICAgICovCgkgICAgICAgIFtEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTAxLCBuZXcgRGF0YU1hc2soRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzEwMSwgZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovKSB7IHJldHVybiAoaSAqIGopICUgNiA9PT0gMDsgfSldLAoJICAgICAgICAvKioKCSAgICAgICAgICogMTEwOiBtYXNrIGJpdHMgZm9yIHdoaWNoICh4eSBtb2QgMiArIHh5IG1vZCAzKSBtb2QgMiA9PSAwCgkgICAgICAgICAqIGVxdWl2YWxlbnRseSwgc3VjaCB0aGF0IHh5IG1vZCA2IDwgMwoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMTAsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTEwLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuICgoaSAqIGopICUgNikgPCAzOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAxMTE6IG1hc2sgYml0cyBmb3Igd2hpY2ggKCh4K3kpbW9kIDIgKyB4eSBtb2QgMykgbW9kIDIgPT0gMAoJICAgICAgICAgKiBlcXVpdmFsZW50bHksIHN1Y2ggdGhhdCAoeCArIHkgKyB4eSBtb2QgMykgbW9kIDIgPT0gMAoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMTEsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTExLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuICgoaSArIGogKyAoKGkgKiBqKSAlIDMpKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgXSk7CgkgICAgcmV0dXJuIERhdGFNYXNrOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IERhdGFNYXNrOwoKCX0oRGF0YU1hc2spKTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdE1hdHJpeFBhcnNlciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgVmVyc2lvbl8xJDEgPSBWZXJzaW9uJDE7Cgl2YXIgRm9ybWF0SW5mb3JtYXRpb25fMSA9IEZvcm1hdEluZm9ybWF0aW9uJDE7Cgl2YXIgRGF0YU1hc2tfMSA9IERhdGFNYXNrOwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xJDEgPSBGb3JtYXRFeGNlcHRpb24kMTsKCS8qKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEJpdE1hdHJpeFBhcnNlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYml0TWF0cml4IHtAbGluayBCaXRNYXRyaXh9IHRvIHBhcnNlCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgZGltZW5zaW9uIGlzIG5vdCA+PSAyMSBhbmQgMSBtb2QgNAoJICAgICAqLwoJICAgIGZ1bmN0aW9uIEJpdE1hdHJpeFBhcnNlcihiaXRNYXRyaXgpIHsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IGJpdE1hdHJpeC5nZXRIZWlnaHQoKTsKCSAgICAgICAgaWYgKGRpbWVuc2lvbiA8IDIxIHx8IChkaW1lbnNpb24gJiAweDAzKSAhPT0gMSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0TWF0cml4ID0gYml0TWF0cml4OwoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5SZWFkcyBmb3JtYXQgaW5mb3JtYXRpb24gZnJvbSBvbmUgb2YgaXRzIHR3byBsb2NhdGlvbnMgd2l0aGluIHRoZSBRUiBDb2RlLjwvcD4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEZvcm1hdEluZm9ybWF0aW9ufSBlbmNhcHN1bGF0aW5nIHRoZSBRUiBDb2RlJ3MgZm9ybWF0IGluZm8KCSAgICAgKiBAdGhyb3dzIEZvcm1hdEV4Y2VwdGlvbiBpZiBib3RoIGZvcm1hdCBpbmZvcm1hdGlvbiBsb2NhdGlvbnMgY2Fubm90IGJlIHBhcnNlZCBhcwoJICAgICAqIHRoZSB2YWxpZCBlbmNvZGluZyBvZiBmb3JtYXQgaW5mb3JtYXRpb24KCSAgICAgKi8KCSAgICBCaXRNYXRyaXhQYXJzZXIucHJvdG90eXBlLnJlYWRGb3JtYXRJbmZvcm1hdGlvbiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgaWYgKHRoaXMucGFyc2VkRm9ybWF0SW5mbyAhPT0gbnVsbCAmJiB0aGlzLnBhcnNlZEZvcm1hdEluZm8gIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VkRm9ybWF0SW5mbzsKCSAgICAgICAgfQoJICAgICAgICAvLyBSZWFkIHRvcC1sZWZ0IGZvcm1hdCBpbmZvIGJpdHMKCSAgICAgICAgdmFyIGZvcm1hdEluZm9CaXRzMSA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNjsgaSsrKSB7CgkgICAgICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoaSwgOCwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgfQoJICAgICAgICAvLyAuLiBhbmQgc2tpcCBhIGJpdCBpbiB0aGUgdGltaW5nIHBhdHRlcm4gLi4uCgkgICAgICAgIGZvcm1hdEluZm9CaXRzMSA9IHRoaXMuY29weUJpdCg3LCA4LCBmb3JtYXRJbmZvQml0czEpOwoJICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoOCwgOCwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgZm9ybWF0SW5mb0JpdHMxID0gdGhpcy5jb3B5Qml0KDgsIDcsIGZvcm1hdEluZm9CaXRzMSk7CgkgICAgICAgIC8vIC4uIGFuZCBza2lwIGEgYml0IGluIHRoZSB0aW1pbmcgcGF0dGVybiAuLi4KCSAgICAgICAgZm9yICh2YXIgaiA9IDU7IGogPj0gMDsgai0tKSB7CgkgICAgICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoOCwgaiwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBSZWFkIHRoZSB0b3AtcmlnaHQvYm90dG9tLWxlZnQgcGF0dGVybiB0b28KCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgZm9ybWF0SW5mb0JpdHMyID0gMDsKCSAgICAgICAgdmFyIGpNaW4gPSBkaW1lbnNpb24gLSA3OwoJICAgICAgICBmb3IgKHZhciBqID0gZGltZW5zaW9uIC0gMTsgaiA+PSBqTWluOyBqLS0pIHsKCSAgICAgICAgICAgIGZvcm1hdEluZm9CaXRzMiA9IHRoaXMuY29weUJpdCg4LCBqLCBmb3JtYXRJbmZvQml0czIpOwoJICAgICAgICB9CgkgICAgICAgIGZvciAodmFyIGkgPSBkaW1lbnNpb24gLSA4OyBpIDwgZGltZW5zaW9uOyBpKyspIHsKCSAgICAgICAgICAgIGZvcm1hdEluZm9CaXRzMiA9IHRoaXMuY29weUJpdChpLCA4LCBmb3JtYXRJbmZvQml0czIpOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMucGFyc2VkRm9ybWF0SW5mbyA9IEZvcm1hdEluZm9ybWF0aW9uXzEuZGVmYXVsdC5kZWNvZGVGb3JtYXRJbmZvcm1hdGlvbihmb3JtYXRJbmZvQml0czEsIGZvcm1hdEluZm9CaXRzMik7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZEZvcm1hdEluZm8gIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlZEZvcm1hdEluZm87CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+UmVhZHMgdmVyc2lvbiBpbmZvcm1hdGlvbiBmcm9tIG9uZSBvZiBpdHMgdHdvIGxvY2F0aW9ucyB3aXRoaW4gdGhlIFFSIENvZGUuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiB7QGxpbmsgVmVyc2lvbn0gZW5jYXBzdWxhdGluZyB0aGUgUVIgQ29kZSdzIHZlcnNpb24KCSAgICAgKiBAdGhyb3dzIEZvcm1hdEV4Y2VwdGlvbiBpZiBib3RoIHZlcnNpb24gaW5mb3JtYXRpb24gbG9jYXRpb25zIGNhbm5vdCBiZSBwYXJzZWQgYXMKCSAgICAgKiB0aGUgdmFsaWQgZW5jb2Rpbmcgb2YgdmVyc2lvbiBpbmZvcm1hdGlvbgoJICAgICAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUucmVhZFZlcnNpb24gPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZFZlcnNpb24gIT09IG51bGwgJiYgdGhpcy5wYXJzZWRWZXJzaW9uICE9PSB1bmRlZmluZWQpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgcHJvdmlzaW9uYWxWZXJzaW9uID0gTWF0aC5mbG9vcigoZGltZW5zaW9uIC0gMTcpIC8gNCk7CgkgICAgICAgIGlmIChwcm92aXNpb25hbFZlcnNpb24gPD0gNikgewoJICAgICAgICAgICAgcmV0dXJuIFZlcnNpb25fMSQxLmRlZmF1bHQuZ2V0VmVyc2lvbkZvck51bWJlcihwcm92aXNpb25hbFZlcnNpb24pOwoJICAgICAgICB9CgkgICAgICAgIC8vIFJlYWQgdG9wLXJpZ2h0IHZlcnNpb24gaW5mbzogMyB3aWRlIGJ5IDYgdGFsbAoJICAgICAgICB2YXIgdmVyc2lvbkJpdHMgPSAwOwoJICAgICAgICB2YXIgaWpNaW4gPSBkaW1lbnNpb24gLSAxMTsKCSAgICAgICAgZm9yICh2YXIgaiA9IDU7IGogPj0gMDsgai0tKSB7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gZGltZW5zaW9uIC0gOTsgaSA+PSBpak1pbjsgaS0tKSB7CgkgICAgICAgICAgICAgICAgdmVyc2lvbkJpdHMgPSB0aGlzLmNvcHlCaXQoaSwgaiwgdmVyc2lvbkJpdHMpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciB0aGVQYXJzZWRWZXJzaW9uID0gVmVyc2lvbl8xJDEuZGVmYXVsdC5kZWNvZGVWZXJzaW9uSW5mb3JtYXRpb24odmVyc2lvbkJpdHMpOwoJICAgICAgICBpZiAodGhlUGFyc2VkVmVyc2lvbiAhPT0gbnVsbCAmJiB0aGVQYXJzZWRWZXJzaW9uLmdldERpbWVuc2lvbkZvclZlcnNpb24oKSA9PT0gZGltZW5zaW9uKSB7CgkgICAgICAgICAgICB0aGlzLnBhcnNlZFZlcnNpb24gPSB0aGVQYXJzZWRWZXJzaW9uOwoJICAgICAgICAgICAgcmV0dXJuIHRoZVBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgLy8gSG1tLCBmYWlsZWQuIFRyeSBib3R0b20gbGVmdDogNiB3aWRlIGJ5IDMgdGFsbAoJICAgICAgICB2ZXJzaW9uQml0cyA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSA1OyBpID49IDA7IGktLSkgewoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IGRpbWVuc2lvbiAtIDk7IGogPj0gaWpNaW47IGotLSkgewoJICAgICAgICAgICAgICAgIHZlcnNpb25CaXRzID0gdGhpcy5jb3B5Qml0KGksIGosIHZlcnNpb25CaXRzKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICB0aGVQYXJzZWRWZXJzaW9uID0gVmVyc2lvbl8xJDEuZGVmYXVsdC5kZWNvZGVWZXJzaW9uSW5mb3JtYXRpb24odmVyc2lvbkJpdHMpOwoJICAgICAgICBpZiAodGhlUGFyc2VkVmVyc2lvbiAhPT0gbnVsbCAmJiB0aGVQYXJzZWRWZXJzaW9uLmdldERpbWVuc2lvbkZvclZlcnNpb24oKSA9PT0gZGltZW5zaW9uKSB7CgkgICAgICAgICAgICB0aGlzLnBhcnNlZFZlcnNpb24gPSB0aGVQYXJzZWRWZXJzaW9uOwoJICAgICAgICAgICAgcmV0dXJuIHRoZVBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgQml0TWF0cml4UGFyc2VyLnByb3RvdHlwZS5jb3B5Qml0ID0gZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovLCB2ZXJzaW9uQml0cyAvKmludCovKSB7CgkgICAgICAgIHZhciBiaXQgPSB0aGlzLmlzTWlycm9yID8gdGhpcy5iaXRNYXRyaXguZ2V0KGosIGkpIDogdGhpcy5iaXRNYXRyaXguZ2V0KGksIGopOwoJICAgICAgICByZXR1cm4gYml0ID8gKHZlcnNpb25CaXRzIDw8IDEpIHwgMHgxIDogdmVyc2lvbkJpdHMgPDwgMTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlJlYWRzIHRoZSBiaXRzIGluIHRoZSB7QGxpbmsgQml0TWF0cml4fSByZXByZXNlbnRpbmcgdGhlIGZpbmRlciBwYXR0ZXJuIGluIHRoZQoJICAgICAqIGNvcnJlY3Qgb3JkZXIgaW4gb3JkZXIgdG8gcmVjb25zdHJ1Y3QgdGhlIGNvZGV3b3JkcyBieXRlcyBjb250YWluZWQgd2l0aGluIHRoZQoJICAgICAqIFFSIENvZGUuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiBieXRlcyBlbmNvZGVkIHdpdGhpbiB0aGUgUVIgQ29kZQoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIHRoZSBleGFjdCBudW1iZXIgb2YgYnl0ZXMgZXhwZWN0ZWQgaXMgbm90IHJlYWQKCSAgICAgKi8KCSAgICBCaXRNYXRyaXhQYXJzZXIucHJvdG90eXBlLnJlYWRDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBmb3JtYXRJbmZvID0gdGhpcy5yZWFkRm9ybWF0SW5mb3JtYXRpb24oKTsKCSAgICAgICAgdmFyIHZlcnNpb24gPSB0aGlzLnJlYWRWZXJzaW9uKCk7CgkgICAgICAgIC8vIEdldCB0aGUgZGF0YSBtYXNrIGZvciB0aGUgZm9ybWF0IHVzZWQgaW4gdGhpcyBRUiBDb2RlLiBUaGlzIHdpbGwgZXhjbHVkZQoJICAgICAgICAvLyBzb21lIGJpdHMgZnJvbSByZWFkaW5nIGFzIHdlIHdpbmQgdGhyb3VnaCB0aGUgYml0IG1hdHJpeC4KCSAgICAgICAgdmFyIGRhdGFNYXNrID0gRGF0YU1hc2tfMS5kZWZhdWx0LnZhbHVlcy5nZXQoZm9ybWF0SW5mby5nZXREYXRhTWFzaygpKTsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICBkYXRhTWFzay51bm1hc2tCaXRNYXRyaXgodGhpcy5iaXRNYXRyaXgsIGRpbWVuc2lvbik7CgkgICAgICAgIHZhciBmdW5jdGlvblBhdHRlcm4gPSB2ZXJzaW9uLmJ1aWxkRnVuY3Rpb25QYXR0ZXJuKCk7CgkgICAgICAgIHZhciByZWFkaW5nVXAgPSB0cnVlOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkodmVyc2lvbi5nZXRUb3RhbENvZGV3b3JkcygpKTsKCSAgICAgICAgdmFyIHJlc3VsdE9mZnNldCA9IDA7CgkgICAgICAgIHZhciBjdXJyZW50Qnl0ZSA9IDA7CgkgICAgICAgIHZhciBiaXRzUmVhZCA9IDA7CgkgICAgICAgIC8vIFJlYWQgY29sdW1ucyBpbiBwYWlycywgZnJvbSByaWdodCB0byBsZWZ0CgkgICAgICAgIGZvciAodmFyIGogPSBkaW1lbnNpb24gLSAxOyBqID4gMDsgaiAtPSAyKSB7CgkgICAgICAgICAgICBpZiAoaiA9PT0gNikgewoJICAgICAgICAgICAgICAgIC8vIFNraXAgd2hvbGUgY29sdW1uIHdpdGggdmVydGljYWwgYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgICAgICAgICAgICAvLyBzYXZlcyB0aW1lIGFuZCBtYWtlcyB0aGUgb3RoZXIgY29kZSBwcm9jZWVkIG1vcmUgY2xlYW5seQoJICAgICAgICAgICAgICAgIGotLTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIFJlYWQgYWx0ZXJuYXRpbmdseSBmcm9tIGJvdHRvbSB0byB0b3AgdGhlbiB0b3AgdG8gYm90dG9tCgkgICAgICAgICAgICBmb3IgKHZhciBjb3VudCA9IDA7IGNvdW50IDwgZGltZW5zaW9uOyBjb3VudCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGkgPSByZWFkaW5nVXAgPyBkaW1lbnNpb24gLSAxIC0gY291bnQgOiBjb3VudDsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCAyOyBjb2wrKykgewoJICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgYml0cyBjb3ZlcmVkIGJ5IHRoZSBmdW5jdGlvbiBwYXR0ZXJuCgkgICAgICAgICAgICAgICAgICAgIGlmICghZnVuY3Rpb25QYXR0ZXJuLmdldChqIC0gY29sLCBpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVhZCBhIGJpdAoJICAgICAgICAgICAgICAgICAgICAgICAgYml0c1JlYWQrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCeXRlIDw8PSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYml0TWF0cml4LmdldChqIC0gY29sLCBpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCeXRlIHw9IDE7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB3ZSd2ZSBtYWRlIGEgd2hvbGUgYnl0ZSwgc2F2ZSBpdCBvZmYKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiaXRzUmVhZCA9PT0gOCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRPZmZzZXQrK10gPSAvKihieXRlKSAqLyBjdXJyZW50Qnl0ZTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaXRzUmVhZCA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEJ5dGUgPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVhZGluZ1VwID0gIXJlYWRpbmdVcDsgLy8gcmVhZGluZ1VwIF49IHRydWU7IC8vIHJlYWRpbmdVcCA9ICFyZWFkaW5nVXA7IC8vIHN3aXRjaCBkaXJlY3Rpb25zCgkgICAgICAgIH0KCSAgICAgICAgaWYgKHJlc3VsdE9mZnNldCAhPT0gdmVyc2lvbi5nZXRUb3RhbENvZGV3b3JkcygpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEkMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldmVydCB0aGUgbWFzayByZW1vdmFsIGRvbmUgd2hpbGUgcmVhZGluZyB0aGUgY29kZSB3b3Jkcy4gVGhlIGJpdCBtYXRyaXggc2hvdWxkIHJldmVydCB0byBpdHMgb3JpZ2luYWwgc3RhdGUuCgkgICAgICovCgkgICAgQml0TWF0cml4UGFyc2VyLnByb3RvdHlwZS5yZW1hc2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZEZvcm1hdEluZm8gPT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybjsgLy8gV2UgaGF2ZSBubyBmb3JtYXQgaW5mb3JtYXRpb24sIGFuZCBoYXZlIG5vIGRhdGEgbWFzawoJICAgICAgICB9CgkgICAgICAgIHZhciBkYXRhTWFzayA9IERhdGFNYXNrXzEuZGVmYXVsdC52YWx1ZXNbdGhpcy5wYXJzZWRGb3JtYXRJbmZvLmdldERhdGFNYXNrKCldOwoJICAgICAgICB2YXIgZGltZW5zaW9uID0gdGhpcy5iaXRNYXRyaXguZ2V0SGVpZ2h0KCk7CgkgICAgICAgIGRhdGFNYXNrLnVubWFza0JpdE1hdHJpeCh0aGlzLmJpdE1hdHJpeCwgZGltZW5zaW9uKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFByZXBhcmUgdGhlIHBhcnNlciBmb3IgYSBtaXJyb3JlZCBvcGVyYXRpb24uCgkgICAgICogVGhpcyBmbGFnIGhhcyBlZmZlY3Qgb25seSBvbiB0aGUge0BsaW5rICNyZWFkRm9ybWF0SW5mb3JtYXRpb24oKX0gYW5kIHRoZQoJICAgICAqIHtAbGluayAjcmVhZFZlcnNpb24oKX0uIEJlZm9yZSBwcm9jZWVkaW5nIHdpdGgge0BsaW5rICNyZWFkQ29kZXdvcmRzKCl9IHRoZQoJICAgICAqIHtAbGluayAjbWlycm9yKCl9IG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkLgoJICAgICAqCgkgICAgICogQHBhcmFtIG1pcnJvciBXaGV0aGVyIHRvIHJlYWQgdmVyc2lvbiBhbmQgZm9ybWF0IGluZm9ybWF0aW9uIG1pcnJvcmVkLgoJICAgICAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUuc2V0TWlycm9yID0gZnVuY3Rpb24gKGlzTWlycm9yKSB7CgkgICAgICAgIHRoaXMucGFyc2VkVmVyc2lvbiA9IG51bGw7CgkgICAgICAgIHRoaXMucGFyc2VkRm9ybWF0SW5mbyA9IG51bGw7CgkgICAgICAgIHRoaXMuaXNNaXJyb3IgPSBpc01pcnJvcjsKCSAgICB9OwoJICAgIC8qKiBNaXJyb3IgdGhlIGJpdCBtYXRyaXggaW4gb3JkZXIgdG8gYXR0ZW1wdCBhIHNlY29uZCByZWFkaW5nLiAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUubWlycm9yID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgYml0TWF0cml4ID0gdGhpcy5iaXRNYXRyaXg7CgkgICAgICAgIGZvciAodmFyIHggPSAwLCB3aWR0aCA9IGJpdE1hdHJpeC5nZXRXaWR0aCgpOyB4IDwgd2lkdGg7IHgrKykgewoJICAgICAgICAgICAgZm9yICh2YXIgeSA9IHggKyAxLCBoZWlnaHQgPSBiaXRNYXRyaXguZ2V0SGVpZ2h0KCk7IHkgPCBoZWlnaHQ7IHkrKykgewoJICAgICAgICAgICAgICAgIGlmIChiaXRNYXRyaXguZ2V0KHgsIHkpICE9PSBiaXRNYXRyaXguZ2V0KHksIHgpKSB7CgkgICAgICAgICAgICAgICAgICAgIGJpdE1hdHJpeC5mbGlwKHksIHgpOwoJICAgICAgICAgICAgICAgICAgICBiaXRNYXRyaXguZmxpcCh4LCB5KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHJldHVybiBCaXRNYXRyaXhQYXJzZXI7Cgl9KCkpOwoJQml0TWF0cml4UGFyc2VyJDEuZGVmYXVsdCA9IEJpdE1hdHJpeFBhcnNlcjsKCgl2YXIgRGF0YUJsb2NrJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDMgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGF0YUJsb2NrJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQxID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIGJsb2NrIG9mIGRhdGEgd2l0aGluIGEgUVIgQ29kZS4gUVIgQ29kZXMgbWF5IHNwbGl0IHRoZWlyIGRhdGEgaW50bwoJICogbXVsdGlwbGUgYmxvY2tzLCBlYWNoIG9mIHdoaWNoIGlzIGEgdW5pdCBvZiBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3Jkcy4gRWFjaAoJICogaXMgcmVwcmVzZW50ZWQgYnkgYW4gaW5zdGFuY2Ugb2YgdGhpcyBjbGFzcy48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERhdGFCbG9jayA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBEYXRhQmxvY2sobnVtRGF0YUNvZGV3b3JkcyAvKmludCovLCBjb2Rld29yZHMpIHsKCSAgICAgICAgdGhpcy5udW1EYXRhQ29kZXdvcmRzID0gbnVtRGF0YUNvZGV3b3JkczsKCSAgICAgICAgdGhpcy5jb2Rld29yZHMgPSBjb2Rld29yZHM7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIDxwPldoZW4gUVIgQ29kZXMgdXNlIG11bHRpcGxlIGRhdGEgYmxvY2tzLCB0aGV5IGFyZSBhY3R1YWxseSBpbnRlcmxlYXZlZC4KCSAgICAgKiBUaGF0IGlzLCB0aGUgZmlyc3QgYnl0ZSBvZiBkYXRhIGJsb2NrIDEgdG8gbiBpcyB3cml0dGVuLCB0aGVuIHRoZSBzZWNvbmQgYnl0ZXMsIGFuZCBzbyBvbi4gVGhpcwoJICAgICAqIG1ldGhvZCB3aWxsIHNlcGFyYXRlIHRoZSBkYXRhIGludG8gb3JpZ2luYWwgYmxvY2tzLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSByYXdDb2Rld29yZHMgYnl0ZXMgYXMgcmVhZCBkaXJlY3RseSBmcm9tIHRoZSBRUiBDb2RlCgkgICAgICogQHBhcmFtIHZlcnNpb24gdmVyc2lvbiBvZiB0aGUgUVIgQ29kZQoJICAgICAqIEBwYXJhbSBlY0xldmVsIGVycm9yLWNvcnJlY3Rpb24gbGV2ZWwgb2YgdGhlIFFSIENvZGUKCSAgICAgKiBAcmV0dXJuIERhdGFCbG9ja3MgY29udGFpbmluZyBvcmlnaW5hbCBieXRlcywgImRlLWludGVybGVhdmVkIiBmcm9tIHJlcHJlc2VudGF0aW9uIGluIHRoZQoJICAgICAqICAgICAgICAgUVIgQ29kZQoJICAgICAqLwoJICAgIERhdGFCbG9jay5nZXREYXRhQmxvY2tzID0gZnVuY3Rpb24gKHJhd0NvZGV3b3JkcywgdmVyc2lvbiwgZWNMZXZlbCkgewoJICAgICAgICB2YXIgZV8xLCBfYSwgZV8yLCBfYjsKCSAgICAgICAgaWYgKHJhd0NvZGV3b3Jkcy5sZW5ndGggIT09IHZlcnNpb24uZ2V0VG90YWxDb2Rld29yZHMoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEZpZ3VyZSBvdXQgdGhlIG51bWJlciBhbmQgc2l6ZSBvZiBkYXRhIGJsb2NrcyB1c2VkIGJ5IHRoaXMgdmVyc2lvbiBhbmQKCSAgICAgICAgLy8gZXJyb3IgY29ycmVjdGlvbiBsZXZlbAoJICAgICAgICB2YXIgZWNCbG9ja3MgPSB2ZXJzaW9uLmdldEVDQmxvY2tzRm9yTGV2ZWwoZWNMZXZlbCk7CgkgICAgICAgIC8vIEZpcnN0IGNvdW50IHRoZSB0b3RhbCBudW1iZXIgb2YgZGF0YSBibG9ja3MKCSAgICAgICAgdmFyIHRvdGFsQmxvY2tzID0gMDsKCSAgICAgICAgdmFyIGVjQmxvY2tBcnJheSA9IGVjQmxvY2tzLmdldEVDQmxvY2tzKCk7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICBmb3IgKHZhciBlY0Jsb2NrQXJyYXlfMSA9IF9fdmFsdWVzJDMoZWNCbG9ja0FycmF5KSwgZWNCbG9ja0FycmF5XzFfMSA9IGVjQmxvY2tBcnJheV8xLm5leHQoKTsgIWVjQmxvY2tBcnJheV8xXzEuZG9uZTsgZWNCbG9ja0FycmF5XzFfMSA9IGVjQmxvY2tBcnJheV8xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgIHZhciBlY0Jsb2NrID0gZWNCbG9ja0FycmF5XzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbEJsb2NrcyArPSBlY0Jsb2NrLmdldENvdW50KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChlY0Jsb2NrQXJyYXlfMV8xICYmICFlY0Jsb2NrQXJyYXlfMV8xLmRvbmUgJiYgKF9hID0gZWNCbG9ja0FycmF5XzEucmV0dXJuKSkgX2EuY2FsbChlY0Jsb2NrQXJyYXlfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTm93IGVzdGFibGlzaCBEYXRhQmxvY2tzIG9mIHRoZSBhcHByb3ByaWF0ZSBzaXplIGFuZCBudW1iZXIgb2YgZGF0YSBjb2Rld29yZHMKCSAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBBcnJheSh0b3RhbEJsb2Nrcyk7CgkgICAgICAgIHZhciBudW1SZXN1bHRCbG9ja3MgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgZWNCbG9ja0FycmF5XzIgPSBfX3ZhbHVlcyQzKGVjQmxvY2tBcnJheSksIGVjQmxvY2tBcnJheV8yXzEgPSBlY0Jsb2NrQXJyYXlfMi5uZXh0KCk7ICFlY0Jsb2NrQXJyYXlfMl8xLmRvbmU7IGVjQmxvY2tBcnJheV8yXzEgPSBlY0Jsb2NrQXJyYXlfMi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZWNCbG9jayA9IGVjQmxvY2tBcnJheV8yXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlY0Jsb2NrLmdldENvdW50KCk7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICB2YXIgbnVtRGF0YUNvZGV3b3JkcyA9IGVjQmxvY2suZ2V0RGF0YUNvZGV3b3JkcygpOwoJICAgICAgICAgICAgICAgICAgICB2YXIgbnVtQmxvY2tDb2Rld29yZHMgPSBlY0Jsb2Nrcy5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCkgKyBudW1EYXRhQ29kZXdvcmRzOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHRbbnVtUmVzdWx0QmxvY2tzKytdID0gbmV3IERhdGFCbG9jayhudW1EYXRhQ29kZXdvcmRzLCBuZXcgVWludDhBcnJheShudW1CbG9ja0NvZGV3b3JkcykpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8yXzEpIHsgZV8yID0geyBlcnJvcjogZV8yXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGVjQmxvY2tBcnJheV8yXzEgJiYgIWVjQmxvY2tBcnJheV8yXzEuZG9uZSAmJiAoX2IgPSBlY0Jsb2NrQXJyYXlfMi5yZXR1cm4pKSBfYi5jYWxsKGVjQmxvY2tBcnJheV8yKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8yKSB0aHJvdyBlXzIuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICAvLyBBbGwgYmxvY2tzIGhhdmUgdGhlIHNhbWUgYW1vdW50IG9mIGRhdGEsIGV4Y2VwdCB0aGF0IHRoZSBsYXN0IG4KCSAgICAgICAgLy8gKHdoZXJlIG4gbWF5IGJlIDApIGhhdmUgMSBtb3JlIGJ5dGUuIEZpZ3VyZSBvdXQgd2hlcmUgdGhlc2Ugc3RhcnQuCgkgICAgICAgIHZhciBzaG9ydGVyQmxvY2tzVG90YWxDb2Rld29yZHMgPSByZXN1bHRbMF0uY29kZXdvcmRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGxvbmdlckJsb2Nrc1N0YXJ0QXQgPSByZXN1bHQubGVuZ3RoIC0gMTsKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IGNoZWNrIGxlbmd0aCBpcyBjb3JyZWN0IGhlcmUKCSAgICAgICAgd2hpbGUgKGxvbmdlckJsb2Nrc1N0YXJ0QXQgPj0gMCkgewoJICAgICAgICAgICAgdmFyIG51bUNvZGV3b3JkcyA9IHJlc3VsdFtsb25nZXJCbG9ja3NTdGFydEF0XS5jb2Rld29yZHMubGVuZ3RoOwoJICAgICAgICAgICAgaWYgKG51bUNvZGV3b3JkcyA9PT0gc2hvcnRlckJsb2Nrc1RvdGFsQ29kZXdvcmRzKSB7CgkgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBsb25nZXJCbG9ja3NTdGFydEF0LS07CgkgICAgICAgIH0KCSAgICAgICAgbG9uZ2VyQmxvY2tzU3RhcnRBdCsrOwoJICAgICAgICB2YXIgc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHMgPSBzaG9ydGVyQmxvY2tzVG90YWxDb2Rld29yZHMgLSBlY0Jsb2Nrcy5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCk7CgkgICAgICAgIC8vIFRoZSBsYXN0IGVsZW1lbnRzIG9mIHJlc3VsdCBtYXkgYmUgMSBlbGVtZW50IGxvbmdlcgoJICAgICAgICAvLyBmaXJzdCBmaWxsIG91dCBhcyBtYW55IGVsZW1lbnRzIGFzIGFsbCBvZiB0aGVtIGhhdmUKCSAgICAgICAgdmFyIHJhd0NvZGV3b3Jkc09mZnNldCA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHM7IGkrKykgewoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBudW1SZXN1bHRCbG9ja3M7IGorKykgewoJICAgICAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbaV0gPSByYXdDb2Rld29yZHNbcmF3Q29kZXdvcmRzT2Zmc2V0KytdOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIEZpbGwgb3V0IHRoZSBsYXN0IGRhdGEgYmxvY2sgaW4gdGhlIGxvbmdlciBvbmVzCgkgICAgICAgIGZvciAodmFyIGogPSBsb25nZXJCbG9ja3NTdGFydEF0OyBqIDwgbnVtUmVzdWx0QmxvY2tzOyBqKyspIHsKCSAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHNdID0gcmF3Q29kZXdvcmRzW3Jhd0NvZGV3b3Jkc09mZnNldCsrXTsKCSAgICAgICAgfQoJICAgICAgICAvLyBOb3cgYWRkIGluIGVycm9yIGNvcnJlY3Rpb24gYmxvY2tzCgkgICAgICAgIHZhciBtYXggPSByZXN1bHRbMF0uY29kZXdvcmRzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IHNob3J0ZXJCbG9ja3NOdW1EYXRhQ29kZXdvcmRzOyBpIDwgbWF4OyBpKyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbnVtUmVzdWx0QmxvY2tzOyBqKyspIHsKCSAgICAgICAgICAgICAgICB2YXIgaU9mZnNldCA9IGogPCBsb25nZXJCbG9ja3NTdGFydEF0ID8gaSA6IGkgKyAxOwoJICAgICAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbaU9mZnNldF0gPSByYXdDb2Rld29yZHNbcmF3Q29kZXdvcmRzT2Zmc2V0KytdOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCSAgICBEYXRhQmxvY2sucHJvdG90eXBlLmdldE51bURhdGFDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm51bURhdGFDb2Rld29yZHM7CgkgICAgfTsKCSAgICBEYXRhQmxvY2sucHJvdG90eXBlLmdldENvZGV3b3JkcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY29kZXdvcmRzOwoJICAgIH07CgkgICAgcmV0dXJuIERhdGFCbG9jazsKCX0oKSk7CglEYXRhQmxvY2skMS5kZWZhdWx0ID0gRGF0YUJsb2NrOwoKCXZhciBEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEgPSB7fTsKCgl2YXIgQml0U291cmNlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdFNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbiB7Ki8KCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5UaGlzIHByb3ZpZGVzIGFuIGVhc3kgYWJzdHJhY3Rpb24gdG8gcmVhZCBiaXRzIGF0IGEgdGltZSBmcm9tIGEgc2VxdWVuY2Ugb2YgYnl0ZXMsIHdoZXJlIHRoZQoJICogbnVtYmVyIG9mIGJpdHMgcmVhZCBpcyBub3Qgb2Z0ZW4gYSBtdWx0aXBsZSBvZiA4LjwvcD4KCSAqCgkgKiA8cD5UaGlzIGNsYXNzIGlzIHRocmVhZC1zYWZlIGJ1dCBub3QgcmVlbnRyYW50IC0tIHVubGVzcyB0aGUgY2FsbGVyIG1vZGlmaWVzIHRoZSBieXRlcyBhcnJheQoJICogaXQgcGFzc2VkIGluLCBpbiB3aGljaCBjYXNlIGFsbCBiZXRzIGFyZSBvZmYuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBCaXRTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJ5dGVzIGJ5dGVzIGZyb20gd2hpY2ggdGhpcyB3aWxsIHJlYWQgYml0cy4gQml0cyB3aWxsIGJlIHJlYWQgZnJvbSB0aGUgZmlyc3QgYnl0ZSBmaXJzdC4KCSAgICAgKiBCaXRzIGFyZSByZWFkIHdpdGhpbiBhIGJ5dGUgZnJvbSBtb3N0LXNpZ25pZmljYW50IHRvIGxlYXN0LXNpZ25pZmljYW50IGJpdC4KCSAgICAgKi8KCSAgICBmdW5jdGlvbiBCaXRTb3VyY2UoYnl0ZXMpIHsKCSAgICAgICAgdGhpcy5ieXRlcyA9IGJ5dGVzOwoJICAgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSAwOwoJICAgICAgICB0aGlzLmJpdE9mZnNldCA9IDA7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaW5kZXggb2YgbmV4dCBiaXQgaW4gY3VycmVudCBieXRlIHdoaWNoIHdvdWxkIGJlIHJlYWQgYnkgdGhlIG5leHQgY2FsbCB0byB7QGxpbmsgI3JlYWRCaXRzKGludCl9LgoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuZ2V0Qml0T2Zmc2V0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRPZmZzZXQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIG5leHQgYnl0ZSBpbiBpbnB1dCBieXRlIGFycmF5IHdoaWNoIHdvdWxkIGJlIHJlYWQgYnkgdGhlIG5leHQgY2FsbCB0byB7QGxpbmsgI3JlYWRCaXRzKGludCl9LgoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuZ2V0Qnl0ZU9mZnNldCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZU9mZnNldDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBudW1CaXRzIG51bWJlciBvZiBiaXRzIHRvIHJlYWQKCSAgICAgKiBAcmV0dXJuIGludCByZXByZXNlbnRpbmcgdGhlIGJpdHMgcmVhZC4gVGhlIGJpdHMgd2lsbCBhcHBlYXIgYXMgdGhlIGxlYXN0LXNpZ25pZmljYW50CgkgICAgICogICAgICAgICBiaXRzIG9mIHRoZSBpbnQKCSAgICAgKiBAdGhyb3dzIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiBpZiBudW1CaXRzIGlzbid0IGluIFsxLDMyXSBvciBtb3JlIHRoYW4gaXMgYXZhaWxhYmxlCgkgICAgICovCgkgICAgQml0U291cmNlLnByb3RvdHlwZS5yZWFkQml0cyA9IGZ1bmN0aW9uIChudW1CaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKG51bUJpdHMgPCAxIHx8IG51bUJpdHMgPiAzMiB8fCBudW1CaXRzID4gdGhpcy5hdmFpbGFibGUoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xLmRlZmF1bHQoJycgKyBudW1CaXRzKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcmVzdWx0ID0gMDsKCSAgICAgICAgdmFyIGJpdE9mZnNldCA9IHRoaXMuYml0T2Zmc2V0OwoJICAgICAgICB2YXIgYnl0ZU9mZnNldCA9IHRoaXMuYnl0ZU9mZnNldDsKCSAgICAgICAgdmFyIGJ5dGVzID0gdGhpcy5ieXRlczsKCSAgICAgICAgLy8gRmlyc3QsIHJlYWQgcmVtYWluZGVyIGZyb20gY3VycmVudCBieXRlCgkgICAgICAgIGlmIChiaXRPZmZzZXQgPiAwKSB7CgkgICAgICAgICAgICB2YXIgYml0c0xlZnQgPSA4IC0gYml0T2Zmc2V0OwoJICAgICAgICAgICAgdmFyIHRvUmVhZCA9IG51bUJpdHMgPCBiaXRzTGVmdCA/IG51bUJpdHMgOiBiaXRzTGVmdDsKCSAgICAgICAgICAgIHZhciBiaXRzVG9Ob3RSZWFkID0gYml0c0xlZnQgLSB0b1JlYWQ7CgkgICAgICAgICAgICB2YXIgbWFzayA9ICgweEZGID4+ICg4IC0gdG9SZWFkKSkgPDwgYml0c1RvTm90UmVhZDsKCSAgICAgICAgICAgIHJlc3VsdCA9IChieXRlc1tieXRlT2Zmc2V0XSAmIG1hc2spID4+IGJpdHNUb05vdFJlYWQ7CgkgICAgICAgICAgICBudW1CaXRzIC09IHRvUmVhZDsKCSAgICAgICAgICAgIGJpdE9mZnNldCArPSB0b1JlYWQ7CgkgICAgICAgICAgICBpZiAoYml0T2Zmc2V0ID09PSA4KSB7CgkgICAgICAgICAgICAgICAgYml0T2Zmc2V0ID0gMDsKCSAgICAgICAgICAgICAgICBieXRlT2Zmc2V0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTmV4dCByZWFkIHdob2xlIGJ5dGVzCgkgICAgICAgIGlmIChudW1CaXRzID4gMCkgewoJICAgICAgICAgICAgd2hpbGUgKG51bUJpdHMgPj0gOCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IChyZXN1bHQgPDwgOCkgfCAoYnl0ZXNbYnl0ZU9mZnNldF0gJiAweEZGKTsKCSAgICAgICAgICAgICAgICBieXRlT2Zmc2V0Kys7CgkgICAgICAgICAgICAgICAgbnVtQml0cyAtPSA4OwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gRmluYWxseSByZWFkIGEgcGFydGlhbCBieXRlCgkgICAgICAgICAgICBpZiAobnVtQml0cyA+IDApIHsKCSAgICAgICAgICAgICAgICB2YXIgYml0c1RvTm90UmVhZCA9IDggLSBudW1CaXRzOwoJICAgICAgICAgICAgICAgIHZhciBtYXNrID0gKDB4RkYgPj4gYml0c1RvTm90UmVhZCkgPDwgYml0c1RvTm90UmVhZDsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSAocmVzdWx0IDw8IG51bUJpdHMpIHwgKChieXRlc1tieXRlT2Zmc2V0XSAmIG1hc2spID4+IGJpdHNUb05vdFJlYWQpOwoJICAgICAgICAgICAgICAgIGJpdE9mZnNldCArPSBudW1CaXRzOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0T2Zmc2V0ID0gYml0T2Zmc2V0OwoJICAgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSBieXRlT2Zmc2V0OwoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgYml0cyB0aGF0IGNhbiBiZSByZWFkIHN1Y2Nlc3NmdWxseQoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuYXZhaWxhYmxlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gOCAqICh0aGlzLmJ5dGVzLmxlbmd0aCAtIHRoaXMuYnl0ZU9mZnNldCkgLSB0aGlzLmJpdE9mZnNldDsKCSAgICB9OwoJICAgIHJldHVybiBCaXRTb3VyY2U7Cgl9KCkpOwoJQml0U291cmNlJDEuZGVmYXVsdCA9IEJpdFNvdXJjZTsKCgl2YXIgRGVjb2RlclJlc3VsdCQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShEZWNvZGVyUmVzdWx0JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkxpc3Q7Ki8KCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGVjb2RpbmcgYSBtYXRyaXggb2YgYml0cy4gVGhpcyB0eXBpY2FsbHkKCSAqIGFwcGxpZXMgdG8gMkQgYmFyY29kZSBmb3JtYXRzLiBGb3Igbm93IGl0IGNvbnRhaW5zIHRoZSByYXcgYnl0ZXMgb2J0YWluZWQsCgkgKiBhcyB3ZWxsIGFzIGEgU3RyaW5nIGludGVycHJldGF0aW9uIG9mIHRob3NlIGJ5dGVzLCBpZiBhcHBsaWNhYmxlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGVjb2RlclJlc3VsdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IocmF3Qnl0ZXM6IFVpbnQ4QXJyYXksCgkgICAgLy8gICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyaW5nLAoJICAgIC8vICAgICAgICAgICAgICAgICAgICAgIExpc3Q8VWludDhBcnJheT4gYnl0ZVNlZ21lbnRzLAoJICAgIC8vICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyBlY0xldmVsKSB7CgkgICAgLy8gICB0aGlzKHJhd0J5dGVzLCB0ZXh0LCBieXRlU2VnbWVudHMsIGVjTGV2ZWwsIC0xLCAtMSkKCSAgICAvLyB9CgkgICAgZnVuY3Rpb24gRGVjb2RlclJlc3VsdChyYXdCeXRlcywgdGV4dCwgYnl0ZVNlZ21lbnRzLCBlY0xldmVsLCBzdHJ1Y3R1cmVkQXBwZW5kU2VxdWVuY2VOdW1iZXIsIHN0cnVjdHVyZWRBcHBlbmRQYXJpdHkpIHsKCSAgICAgICAgaWYgKHN0cnVjdHVyZWRBcHBlbmRTZXF1ZW5jZU51bWJlciA9PT0gdm9pZCAwKSB7IHN0cnVjdHVyZWRBcHBlbmRTZXF1ZW5jZU51bWJlciA9IC0xOyB9CgkgICAgICAgIGlmIChzdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5ID09PSB2b2lkIDApIHsgc3RydWN0dXJlZEFwcGVuZFBhcml0eSA9IC0xOyB9CgkgICAgICAgIHRoaXMucmF3Qnl0ZXMgPSByYXdCeXRlczsKCSAgICAgICAgdGhpcy50ZXh0ID0gdGV4dDsKCSAgICAgICAgdGhpcy5ieXRlU2VnbWVudHMgPSBieXRlU2VnbWVudHM7CgkgICAgICAgIHRoaXMuZWNMZXZlbCA9IGVjTGV2ZWw7CgkgICAgICAgIHRoaXMuc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID0gc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyOwoJICAgICAgICB0aGlzLnN0cnVjdHVyZWRBcHBlbmRQYXJpdHkgPSBzdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5OwoJICAgICAgICB0aGlzLm51bUJpdHMgPSAocmF3Qnl0ZXMgPT09IHVuZGVmaW5lZCB8fCByYXdCeXRlcyA9PT0gbnVsbCkgPyAwIDogOCAqIHJhd0J5dGVzLmxlbmd0aDsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiByYXcgYnl0ZXMgcmVwcmVzZW50aW5nIHRoZSByZXN1bHQsIG9yIHtAY29kZSBudWxsfSBpZiBub3QgYXBwbGljYWJsZQoJICAgICAqLwoJICAgIERlY29kZXJSZXN1bHQucHJvdG90eXBlLmdldFJhd0J5dGVzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yYXdCeXRlczsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaG93IG1hbnkgYml0cyBvZiB7QGxpbmsgI2dldFJhd0J5dGVzKCl9IGFyZSB2YWxpZDsgdHlwaWNhbGx5IDggdGltZXMgaXRzIGxlbmd0aAoJICAgICAqIEBzaW5jZSAzLjMuMAoJICAgICAqLwoJICAgIERlY29kZXJSZXN1bHQucHJvdG90eXBlLmdldE51bUJpdHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm51bUJpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gbnVtQml0cyBvdmVycmlkZXMgdGhlIG51bWJlciBvZiBiaXRzIHRoYXQgYXJlIHZhbGlkIGluIHtAbGluayAjZ2V0UmF3Qnl0ZXMoKX0KCSAgICAgKiBAc2luY2UgMy4zLjAKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXROdW1CaXRzID0gZnVuY3Rpb24gKG51bUJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLm51bUJpdHMgPSBudW1CaXRzOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSByZXN1bHQKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRUZXh0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50ZXh0OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBsaXN0IG9mIGJ5dGUgc2VnbWVudHMgaW4gdGhlIHJlc3VsdCwgb3Ige0Bjb2RlIG51bGx9IGlmIG5vdCBhcHBsaWNhYmxlCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0Qnl0ZVNlZ21lbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5ieXRlU2VnbWVudHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIG5hbWUgb2YgZXJyb3IgY29ycmVjdGlvbiBsZXZlbCB1c2VkLCBvciB7QGNvZGUgbnVsbH0gaWYgbm90IGFwcGxpY2FibGUKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRFQ0xldmVsID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lY0xldmVsOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgZXJyb3JzIGNvcnJlY3RlZCwgb3Ige0Bjb2RlIG51bGx9IGlmIG5vdCBhcHBsaWNhYmxlCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0RXJyb3JzQ29ycmVjdGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lcnJvcnNDb3JyZWN0ZWQ7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXRFcnJvcnNDb3JyZWN0ZWQgPSBmdW5jdGlvbiAoZXJyb3JzQ29ycmVjdGVkIC8qSW50ZWdlciovKSB7CgkgICAgICAgIHRoaXMuZXJyb3JzQ29ycmVjdGVkID0gZXJyb3JzQ29ycmVjdGVkOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgZXJhc3VyZXMgY29ycmVjdGVkLCBvciB7QGNvZGUgbnVsbH0gaWYgbm90IGFwcGxpY2FibGUKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRFcmFzdXJlcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZXJhc3VyZXM7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXRFcmFzdXJlcyA9IGZ1bmN0aW9uIChlcmFzdXJlcyAvKkludGVnZXIqLykgewoJICAgICAgICB0aGlzLmVyYXN1cmVzID0gZXJhc3VyZXM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGFyYml0cmFyeSBhZGRpdGlvbmFsIG1ldGFkYXRhCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0T3RoZXIgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm90aGVyOwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuc2V0T3RoZXIgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgdGhpcy5vdGhlciA9IG90aGVyOwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuaGFzU3RydWN0dXJlZEFwcGVuZCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc3RydWN0dXJlZEFwcGVuZFBhcml0eSA+PSAwICYmIHRoaXMuc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID49IDA7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRTdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5OwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0U3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJ1Y3R1cmVkQXBwZW5kU2VxdWVuY2VOdW1iZXI7CgkgICAgfTsKCSAgICByZXR1cm4gRGVjb2RlclJlc3VsdDsKCX0oKSk7CglEZWNvZGVyUmVzdWx0JDEuZGVmYXVsdCA9IERlY29kZXJSZXN1bHQ7CgoJdmFyIE1vZGUgPSB7fTsKCgkoZnVuY3Rpb24gKGV4cG9ydHMpIHsKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJZXhwb3J0cy5Nb2RlVmFsdWVzID0gdm9pZCAwOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7Cgl2YXIgTW9kZVZhbHVlczsKCShmdW5jdGlvbiAoTW9kZVZhbHVlcykgewoJICAgIE1vZGVWYWx1ZXNbTW9kZVZhbHVlc1siVEVSTUlOQVRPUiJdID0gMF0gPSAiVEVSTUlOQVRPUiI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJOVU1FUklDIl0gPSAxXSA9ICJOVU1FUklDIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkFMUEhBTlVNRVJJQyJdID0gMl0gPSAiQUxQSEFOVU1FUklDIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIlNUUlVDVFVSRURfQVBQRU5EIl0gPSAzXSA9ICJTVFJVQ1RVUkVEX0FQUEVORCI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJCWVRFIl0gPSA0XSA9ICJCWVRFIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkVDSSJdID0gNV0gPSAiRUNJIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIktBTkpJIl0gPSA2XSA9ICJLQU5KSSI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJGTkMxX0ZJUlNUX1BPU0lUSU9OIl0gPSA3XSA9ICJGTkMxX0ZJUlNUX1BPU0lUSU9OIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkZOQzFfU0VDT05EX1BPU0lUSU9OIl0gPSA4XSA9ICJGTkMxX1NFQ09ORF9QT1NJVElPTiI7CgkgICAgLyoqIFNlZSBHQlQgMTgyODQtMjAwMDsgIkhhbnppIiBpcyBhIHRyYW5zbGl0ZXJhdGlvbiBvZiB0aGlzIG1vZGUgbmFtZS4gKi8KCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkhBTlpJIl0gPSA5XSA9ICJIQU5aSSI7Cgl9KShNb2RlVmFsdWVzID0gZXhwb3J0cy5Nb2RlVmFsdWVzIHx8IChleHBvcnRzLk1vZGVWYWx1ZXMgPSB7fSkpOwoJLyoqCgkgKiA8cD5TZWUgSVNPIDE4MDA0OjIwMDYsIDYuNC4xLCBUYWJsZXMgMiBhbmQgMy4gVGhpcyBlbnVtIGVuY2Fwc3VsYXRlcyB0aGUgdmFyaW91cyBtb2RlcyBpbiB3aGljaAoJICogZGF0YSBjYW4gYmUgZW5jb2RlZCB0byBiaXRzIGluIHRoZSBRUiBjb2RlIHN0YW5kYXJkLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgTW9kZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBNb2RlKHZhbHVlLCBzdHJpbmdWYWx1ZSwgY2hhcmFjdGVyQ291bnRCaXRzRm9yVmVyc2lvbnMsIGJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuc3RyaW5nVmFsdWUgPSBzdHJpbmdWYWx1ZTsKCSAgICAgICAgdGhpcy5jaGFyYWN0ZXJDb3VudEJpdHNGb3JWZXJzaW9ucyA9IGNoYXJhY3RlckNvdW50Qml0c0ZvclZlcnNpb25zOwoJICAgICAgICB0aGlzLmJpdHMgPSBiaXRzOwoJICAgICAgICBNb2RlLkZPUl9CSVRTLnNldChiaXRzLCB0aGlzKTsKCSAgICAgICAgTW9kZS5GT1JfVkFMVUUuc2V0KHZhbHVlLCB0aGlzKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJpdHMgZm91ciBiaXRzIGVuY29kaW5nIGEgUVIgQ29kZSBkYXRhIG1vZGUKCSAgICAgKiBAcmV0dXJuIE1vZGUgZW5jb2RlZCBieSB0aGVzZSBiaXRzCgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgYml0cyBkbyBub3QgY29ycmVzcG9uZCB0byBhIGtub3duIG1vZGUKCSAgICAgKi8KCSAgICBNb2RlLmZvckJpdHMgPSBmdW5jdGlvbiAoYml0cyAvKmludCovKSB7CgkgICAgICAgIHZhciBtb2RlID0gTW9kZS5GT1JfQklUUy5nZXQoYml0cyk7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IG1vZGUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG1vZGU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gdmVyc2lvbiB2ZXJzaW9uIGluIHF1ZXN0aW9uCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgYml0cyB1c2VkLCBpbiB0aGlzIFFSIENvZGUgc3ltYm9sIHtAbGluayBWZXJzaW9ufSwgdG8gZW5jb2RlIHRoZQoJICAgICAqICAgICAgICAgY291bnQgb2YgY2hhcmFjdGVycyB0aGF0IHdpbGwgZm9sbG93IGVuY29kZWQgaW4gdGhpcyBNb2RlCgkgICAgICovCgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0Q2hhcmFjdGVyQ291bnRCaXRzID0gZnVuY3Rpb24gKHZlcnNpb24pIHsKCSAgICAgICAgdmFyIHZlcnNpb25OdW1iZXIgPSB2ZXJzaW9uLmdldFZlcnNpb25OdW1iZXIoKTsKCSAgICAgICAgdmFyIG9mZnNldDsKCSAgICAgICAgaWYgKHZlcnNpb25OdW1iZXIgPD0gOSkgewoJICAgICAgICAgICAgb2Zmc2V0ID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmICh2ZXJzaW9uTnVtYmVyIDw9IDI2KSB7CgkgICAgICAgICAgICBvZmZzZXQgPSAxOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgb2Zmc2V0ID0gMjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5jaGFyYWN0ZXJDb3VudEJpdHNGb3JWZXJzaW9uc1tvZmZzZXRdOwoJICAgIH07CgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlOwoJICAgIH07CgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0Qml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYml0czsKCSAgICB9OwoJICAgIE1vZGUucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChvKSB7CgkgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBNb2RlKSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlID09PSBvdGhlci52YWx1ZTsKCSAgICB9OwoJICAgIE1vZGUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdWYWx1ZTsKCSAgICB9OwoJICAgIE1vZGUuRk9SX0JJVFMgPSBuZXcgTWFwKCk7CgkgICAgTW9kZS5GT1JfVkFMVUUgPSBuZXcgTWFwKCk7CgkgICAgTW9kZS5URVJNSU5BVE9SID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5URVJNSU5BVE9SLCAnVEVSTUlOQVRPUicsIEludDMyQXJyYXkuZnJvbShbMCwgMCwgMF0pLCAweDAwKTsgLy8gTm90IHJlYWxseSBhIG1vZGUuLi4KCSAgICBNb2RlLk5VTUVSSUMgPSBuZXcgTW9kZShNb2RlVmFsdWVzLk5VTUVSSUMsICdOVU1FUklDJywgSW50MzJBcnJheS5mcm9tKFsxMCwgMTIsIDE0XSksIDB4MDEpOwoJICAgIE1vZGUuQUxQSEFOVU1FUklDID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5BTFBIQU5VTUVSSUMsICdBTFBIQU5VTUVSSUMnLCBJbnQzMkFycmF5LmZyb20oWzksIDExLCAxM10pLCAweDAyKTsKCSAgICBNb2RlLlNUUlVDVFVSRURfQVBQRU5EID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5TVFJVQ1RVUkVEX0FQUEVORCwgJ1NUUlVDVFVSRURfQVBQRU5EJywgSW50MzJBcnJheS5mcm9tKFswLCAwLCAwXSksIDB4MDMpOyAvLyBOb3Qgc3VwcG9ydGVkCgkgICAgTW9kZS5CWVRFID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5CWVRFLCAnQllURScsIEludDMyQXJyYXkuZnJvbShbOCwgMTYsIDE2XSksIDB4MDQpOwoJICAgIE1vZGUuRUNJID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5FQ0ksICdFQ0knLCBJbnQzMkFycmF5LmZyb20oWzAsIDAsIDBdKSwgMHgwNyk7IC8vIGNoYXJhY3RlciBjb3VudHMgZG9uJ3QgYXBwbHkKCSAgICBNb2RlLktBTkpJID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5LQU5KSSwgJ0tBTkpJJywgSW50MzJBcnJheS5mcm9tKFs4LCAxMCwgMTJdKSwgMHgwOCk7CgkgICAgTW9kZS5GTkMxX0ZJUlNUX1BPU0lUSU9OID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5GTkMxX0ZJUlNUX1BPU0lUSU9OLCAnRk5DMV9GSVJTVF9QT1NJVElPTicsIEludDMyQXJyYXkuZnJvbShbMCwgMCwgMF0pLCAweDA1KTsKCSAgICBNb2RlLkZOQzFfU0VDT05EX1BPU0lUSU9OID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5GTkMxX1NFQ09ORF9QT1NJVElPTiwgJ0ZOQzFfU0VDT05EX1BPU0lUSU9OJywgSW50MzJBcnJheS5mcm9tKFswLCAwLCAwXSksIDB4MDkpOwoJICAgIC8qKiBTZWUgR0JUIDE4Mjg0LTIwMDA7ICJIYW56aSIgaXMgYSB0cmFuc2xpdGVyYXRpb24gb2YgdGhpcyBtb2RlIG5hbWUuICovCgkgICAgTW9kZS5IQU5aSSA9IG5ldyBNb2RlKE1vZGVWYWx1ZXMuSEFOWkksICdIQU5aSScsIEludDMyQXJyYXkuZnJvbShbOCwgMTAsIDEyXSksIDB4MEQpOwoJICAgIHJldHVybiBNb2RlOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IE1vZGU7CgoJfShNb2RlKSk7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcucXJjb2RlLmRlY29kZXIgeyovCgl2YXIgQml0U291cmNlXzEgPSBCaXRTb3VyY2UkMTsKCXZhciBDaGFyYWN0ZXJTZXRFQ0lfMSA9IENoYXJhY3RlclNldEVDSTsKCXZhciBEZWNvZGVyUmVzdWx0XzEgPSBEZWNvZGVyUmVzdWx0JDE7Cgl2YXIgU3RyaW5nVXRpbHNfMSA9IFN0cmluZ1V0aWxzJDE7Cgl2YXIgRm9ybWF0RXhjZXB0aW9uXzEgPSBGb3JtYXRFeGNlcHRpb24kMTsKCXZhciBTdHJpbmdCdWlsZGVyXzEgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgU3RyaW5nRW5jb2RpbmdfMSA9IFN0cmluZ0VuY29kaW5nJDE7Cgl2YXIgTW9kZV8xID0gTW9kZTsKCS8qaW1wb3J0IGphdmEuaW8uVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbjsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsqLwoJLyppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlFSIENvZGVzIGNhbiBlbmNvZGUgdGV4dCBhcyBiaXRzIGluIG9uZSBvZiBzZXZlcmFsIG1vZGVzLCBhbmQgY2FuIHVzZSBtdWx0aXBsZSBtb2RlcwoJICogaW4gb25lIFFSIENvZGUuIFRoaXMgY2xhc3MgZGVjb2RlcyB0aGUgYml0cyBiYWNrIGludG8gdGV4dC48L3A+CgkgKgoJICogPHA+U2VlIElTTyAxODAwNDoyMDA2LCA2LjQuMyAtIDYuNC43PC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBEZWNvZGVkQml0U3RyZWFtUGFyc2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIERlY29kZWRCaXRTdHJlYW1QYXJzZXIoKSB7CgkgICAgfQoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlID0gZnVuY3Rpb24gKGJ5dGVzLCB2ZXJzaW9uLCBlY0xldmVsLCBoaW50cykgewoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRTb3VyY2VfMS5kZWZhdWx0KGJ5dGVzKTsKCSAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBTdHJpbmdCdWlsZGVyXzEuZGVmYXVsdCgpOwoJICAgICAgICB2YXIgYnl0ZVNlZ21lbnRzID0gbmV3IEFycmF5KCk7IC8vIDEKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IEkgZG8gbm90IHVzZSBjb25zdHJ1Y3RvciB3aXRoIHNpemUgMSBhcyBpbiBvcmlnaW5hbCBKYXZhIG1lYW5zIGNhcGFjaXR5IGFuZCB0aGUgYXJyYXkgbGVuZ3RoIGlzIGNoZWNrZWQgYmVsb3cKCSAgICAgICAgdmFyIHN5bWJvbFNlcXVlbmNlID0gLTE7CgkgICAgICAgIHZhciBwYXJpdHlEYXRhID0gLTE7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICB2YXIgY3VycmVudENoYXJhY3RlclNldEVDSSA9IG51bGw7CgkgICAgICAgICAgICB2YXIgZmMxSW5FZmZlY3QgPSBmYWxzZTsKCSAgICAgICAgICAgIHZhciBtb2RlID0gdm9pZCAwOwoJICAgICAgICAgICAgZG8gewoJICAgICAgICAgICAgICAgIC8vIFdoaWxlIHN0aWxsIGFub3RoZXIgc2VnbWVudCB0byByZWFkLi4uCgkgICAgICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCA0KSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIE9LLCBhc3N1bWUgd2UncmUgZG9uZS4gUmVhbGx5LCBhIFRFUk1JTkFUT1IgbW9kZSBzaG91bGQgaGF2ZSBiZWVuIHJlY29yZGVkIGhlcmUKCSAgICAgICAgICAgICAgICAgICAgbW9kZSA9IE1vZGVfMS5kZWZhdWx0LlRFUk1JTkFUT1I7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICB2YXIgbW9kZUJpdHMgPSBiaXRzLnJlYWRCaXRzKDQpOwoJICAgICAgICAgICAgICAgICAgICBtb2RlID0gTW9kZV8xLmRlZmF1bHQuZm9yQml0cyhtb2RlQml0cyk7IC8vIG1vZGUgaXMgZW5jb2RlZCBieSA0IGJpdHMKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgc3dpdGNoIChtb2RlKSB7CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuVEVSTUlOQVRPUjoKCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LkZOQzFfRklSU1RfUE9TSVRJT046CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuRk5DMV9TRUNPTkRfUE9TSVRJT046CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBkbyBsaXR0bGUgd2l0aCBGTkMxIGV4Y2VwdCBhbHRlciB0aGUgcGFyc2VkIHJlc3VsdCBhIGJpdCBhY2NvcmRpbmcgdG8gdGhlIHNwZWMKCSAgICAgICAgICAgICAgICAgICAgICAgIGZjMUluRWZmZWN0ID0gdHJ1ZTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LlNUUlVDVFVSRURfQVBQRU5EOgoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCAxNikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXF1ZW5jZSBudW1iZXIgYW5kIHBhcml0eSBpcyBhZGRlZCBsYXRlciB0byB0aGUgcmVzdWx0IG1ldGFkYXRhCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWFkIG5leHQgOCBiaXRzIChzeW1ib2wgc2VxdWVuY2UgIykgYW5kIDggYml0cyAoZGF0YTogcGFyaXR5KSwgdGhlbiBjb250aW51ZQoJICAgICAgICAgICAgICAgICAgICAgICAgc3ltYm9sU2VxdWVuY2UgPSBiaXRzLnJlYWRCaXRzKDgpOwoJICAgICAgICAgICAgICAgICAgICAgICAgcGFyaXR5RGF0YSA9IGJpdHMucmVhZEJpdHMoOCk7CgkgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RlXzEuZGVmYXVsdC5FQ0k6CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBDb3VudCBkb2Vzbid0IGFwcGx5IHRvIEVDSQoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5wYXJzZUVDSVZhbHVlKGJpdHMpOwoJICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENoYXJhY3RlclNldEVDSSA9IENoYXJhY3RlclNldEVDSV8xLmRlZmF1bHQuZ2V0Q2hhcmFjdGVyU2V0RUNJQnlWYWx1ZSh2YWx1ZSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudENoYXJhY3RlclNldEVDSSA9PT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RlXzEuZGVmYXVsdC5IQU5aSToKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZpcnN0IGhhbmRsZSBIYW56aSBtb2RlIHdoaWNoIGRvZXMgbm90IHN0YXJ0IHdpdGggY2hhcmFjdGVyIGNvdW50CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGluZXNlIG1vZGUgY29udGFpbnMgYSBzdWIgc2V0IGluZGljYXRvciByaWdodCBhZnRlciBtb2RlIGluZGljYXRvcgoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1YnNldCA9IGJpdHMucmVhZEJpdHMoNCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY291bnRIYW56aSA9IGJpdHMucmVhZEJpdHMobW9kZS5nZXRDaGFyYWN0ZXJDb3VudEJpdHModmVyc2lvbikpOwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1YnNldCA9PT0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5HQjIzMTJfU1VCU0VUKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVIYW56aVNlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudEhhbnppKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gIk5vcm1hbCIgUVIgY29kZSBtb2RlczoKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhvdyBtYW55IGNoYXJhY3RlcnMgd2lsbCBmb2xsb3csIGVuY29kZWQgaW4gdGhpcyBtb2RlPwoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvdW50ID0gYml0cy5yZWFkQml0cyhtb2RlLmdldENoYXJhY3RlckNvdW50Qml0cyh2ZXJzaW9uKSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG1vZGUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0Lk5VTUVSSUM6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlTnVtZXJpY1NlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuQUxQSEFOVU1FUklDOgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLmRlY29kZUFscGhhbnVtZXJpY1NlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCwgZmMxSW5FZmZlY3QpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LkJZVEU6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlQnl0ZVNlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCwgY3VycmVudENoYXJhY3RlclNldEVDSSwgYnl0ZVNlZ21lbnRzLCBoaW50cyk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuS0FOSkk6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlS2FuamlTZWdtZW50KGJpdHMsIHJlc3VsdCwgY291bnQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSB3aGlsZSAobW9kZSAhPT0gTW9kZV8xLmRlZmF1bHQuVEVSTUlOQVRPUik7CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlhZSAvKjogSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgIC8vIGZyb20gcmVhZEJpdHMoKSBjYWxscwoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbmV3IERlY29kZXJSZXN1bHRfMS5kZWZhdWx0KGJ5dGVzLCByZXN1bHQudG9TdHJpbmcoKSwgYnl0ZVNlZ21lbnRzLmxlbmd0aCA9PT0gMCA/IG51bGwgOiBieXRlU2VnbWVudHMsIGVjTGV2ZWwgPT09IG51bGwgPyBudWxsIDogZWNMZXZlbC50b1N0cmluZygpLCBzeW1ib2xTZXF1ZW5jZSwgcGFyaXR5RGF0YSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZWUgc3BlY2lmaWNhdGlvbiBHQlQgMTgyODQtMjAwMAoJICAgICAqLwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlSGFuemlTZWdtZW50ID0gZnVuY3Rpb24gKGJpdHMsIHJlc3VsdCwgY291bnQgLyppbnQqLykgewoJICAgICAgICAvLyBEb24ndCBjcmFzaCB0cnlpbmcgdG8gcmVhZCBtb3JlIGJpdHMgdGhhbiB3ZSBoYXZlIGF2YWlsYWJsZS4KCSAgICAgICAgaWYgKGNvdW50ICogMTMgPiBiaXRzLmF2YWlsYWJsZSgpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEVhY2ggY2hhcmFjdGVyIHdpbGwgcmVxdWlyZSAyIGJ5dGVzLiBSZWFkIHRoZSBjaGFyYWN0ZXJzIGFzIDItYnl0ZSBwYWlycwoJICAgICAgICAvLyBhbmQgZGVjb2RlIGFzIEdCMjMxMiBhZnRlcndhcmRzCgkgICAgICAgIHZhciBidWZmZXIgPSBuZXcgVWludDhBcnJheSgyICogY291bnQpOwoJICAgICAgICB2YXIgb2Zmc2V0ID0gMDsKCSAgICAgICAgd2hpbGUgKGNvdW50ID4gMCkgewoJICAgICAgICAgICAgLy8gRWFjaCAxMyBiaXRzIGVuY29kZXMgYSAyLWJ5dGUgY2hhcmFjdGVyCgkgICAgICAgICAgICB2YXIgdHdvQnl0ZXMgPSBiaXRzLnJlYWRCaXRzKDEzKTsKCSAgICAgICAgICAgIHZhciBhc3NlbWJsZWRUd29CeXRlcyA9ICgoKHR3b0J5dGVzIC8gMHgwNjApIDw8IDgpICYgMHhGRkZGRkZGRikgfCAodHdvQnl0ZXMgJSAweDA2MCk7CgkgICAgICAgICAgICBpZiAoYXNzZW1ibGVkVHdvQnl0ZXMgPCAweDAwM0JGKSB7CgkgICAgICAgICAgICAgICAgLy8gSW4gdGhlIDB4QTFBMSB0byAweEFBRkUgcmFuZ2UKCSAgICAgICAgICAgICAgICBhc3NlbWJsZWRUd29CeXRlcyArPSAweDBBMUExOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgLy8gSW4gdGhlIDB4QjBBMSB0byAweEZBRkUgcmFuZ2UKCSAgICAgICAgICAgICAgICBhc3NlbWJsZWRUd29CeXRlcyArPSAweDBBNkExOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgYnVmZmVyW29mZnNldF0gPSAvKihieXRlKSAqLyAoKGFzc2VtYmxlZFR3b0J5dGVzID4+IDgpICYgMHhGRik7CgkgICAgICAgICAgICBidWZmZXJbb2Zmc2V0ICsgMV0gPSAvKihieXRlKSAqLyAoYXNzZW1ibGVkVHdvQnl0ZXMgJiAweEZGKTsKCSAgICAgICAgICAgIG9mZnNldCArPSAyOwoJICAgICAgICAgICAgY291bnQtLTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChTdHJpbmdFbmNvZGluZ18xLmRlZmF1bHQuZGVjb2RlKGJ1ZmZlciwgU3RyaW5nVXRpbHNfMS5kZWZhdWx0LkdCMjMxMikpOwoJICAgICAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IFRPRE86IGltcGxlbWVudCBHQjIzMTIgZGVjb2RlLiBTdHJpbmdWaWV3IGZyb20gTUROIGNvdWxkIGJlIGEgc3RhcnRpbmcgcG9pbnQKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoaWdub3JlZCAvKjogVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdChpZ25vcmVkKTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVLYW5qaVNlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovKSB7CgkgICAgICAgIC8vIERvbid0IGNyYXNoIHRyeWluZyB0byByZWFkIG1vcmUgYml0cyB0aGFuIHdlIGhhdmUgYXZhaWxhYmxlLgoJICAgICAgICBpZiAoY291bnQgKiAxMyA+IGJpdHMuYXZhaWxhYmxlKCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRWFjaCBjaGFyYWN0ZXIgd2lsbCByZXF1aXJlIDIgYnl0ZXMuIFJlYWQgdGhlIGNoYXJhY3RlcnMgYXMgMi1ieXRlIHBhaXJzCgkgICAgICAgIC8vIGFuZCBkZWNvZGUgYXMgU2hpZnRfSklTIGFmdGVyd2FyZHMKCSAgICAgICAgdmFyIGJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KDIgKiBjb3VudCk7CgkgICAgICAgIHZhciBvZmZzZXQgPSAwOwoJICAgICAgICB3aGlsZSAoY291bnQgPiAwKSB7CgkgICAgICAgICAgICAvLyBFYWNoIDEzIGJpdHMgZW5jb2RlcyBhIDItYnl0ZSBjaGFyYWN0ZXIKCSAgICAgICAgICAgIHZhciB0d29CeXRlcyA9IGJpdHMucmVhZEJpdHMoMTMpOwoJICAgICAgICAgICAgdmFyIGFzc2VtYmxlZFR3b0J5dGVzID0gKCgodHdvQnl0ZXMgLyAweDBDMCkgPDwgOCkgJiAweEZGRkZGRkZGKSB8ICh0d29CeXRlcyAlIDB4MEMwKTsKCSAgICAgICAgICAgIGlmIChhc3NlbWJsZWRUd29CeXRlcyA8IDB4MDFGMDApIHsKCSAgICAgICAgICAgICAgICAvLyBJbiB0aGUgMHg4MTQwIHRvIDB4OUZGQyByYW5nZQoJICAgICAgICAgICAgICAgIGFzc2VtYmxlZFR3b0J5dGVzICs9IDB4MDgxNDA7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyBJbiB0aGUgMHhFMDQwIHRvIDB4RUJCRiByYW5nZQoJICAgICAgICAgICAgICAgIGFzc2VtYmxlZFR3b0J5dGVzICs9IDB4MEMxNDA7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBidWZmZXJbb2Zmc2V0XSA9IC8qKGJ5dGUpICovIChhc3NlbWJsZWRUd29CeXRlcyA+PiA4KTsKCSAgICAgICAgICAgIGJ1ZmZlcltvZmZzZXQgKyAxXSA9IC8qKGJ5dGUpICovIGFzc2VtYmxlZFR3b0J5dGVzOwoJICAgICAgICAgICAgb2Zmc2V0ICs9IDI7CgkgICAgICAgICAgICBjb3VudC0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIFNoaWZ0X0pJUyBtYXkgbm90IGJlIHN1cHBvcnRlZCBpbiBzb21lIGVudmlyb25tZW50czoKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoU3RyaW5nRW5jb2RpbmdfMS5kZWZhdWx0LmRlY29kZShidWZmZXIsIFN0cmluZ1V0aWxzXzEuZGVmYXVsdC5TSElGVF9KSVMpKTsKCSAgICAgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiBUT0RPOiBpbXBsZW1lbnQgU0hJRlRfSklTIGRlY29kZS4gU3RyaW5nVmlldyBmcm9tIE1ETiBjb3VsZCBiZSBhIHN0YXJ0aW5nIHBvaW50CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlnbm9yZWQgLyo6IFVuc3VwcG9ydGVkRW5jb2RpbmdFeGNlcHRpb24qLykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoaWdub3JlZCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlQnl0ZVNlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovLCBjdXJyZW50Q2hhcmFjdGVyU2V0RUNJLCBieXRlU2VnbWVudHMsIGhpbnRzKSB7CgkgICAgICAgIC8vIERvbid0IGNyYXNoIHRyeWluZyB0byByZWFkIG1vcmUgYml0cyB0aGFuIHdlIGhhdmUgYXZhaWxhYmxlLgoJICAgICAgICBpZiAoOCAqIGNvdW50ID4gYml0cy5hdmFpbGFibGUoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcmVhZEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoY291bnQpOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKCSAgICAgICAgICAgIHJlYWRCeXRlc1tpXSA9IC8qKGJ5dGUpICovIGJpdHMucmVhZEJpdHMoOCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGVuY29kaW5nOwoJICAgICAgICBpZiAoY3VycmVudENoYXJhY3RlclNldEVDSSA9PT0gbnVsbCkgewoJICAgICAgICAgICAgLy8gVGhlIHNwZWMgaXNuJ3QgY2xlYXIgb24gdGhpcyBtb2RlOyBzZWUKCSAgICAgICAgICAgIC8vIHNlY3Rpb24gNi40LjU6IHQgZG9lcyBub3Qgc2F5IHdoaWNoIGVuY29kaW5nIHRvIGFzc3VtaW5nCgkgICAgICAgICAgICAvLyB1cG9uIGRlY29kaW5nLiBJIGhhdmUgc2VlbiBJU08tODg1OS0xIHVzZWQgYXMgd2VsbCBhcwoJICAgICAgICAgICAgLy8gU2hpZnRfSklTIC0tIHdpdGhvdXQgYW55dGhpbmcgbGlrZSBhbiBFQ0kgZGVzaWduYXRvciB0bwoJICAgICAgICAgICAgLy8gZ2l2ZSBhIGhpbnQuCgkgICAgICAgICAgICBlbmNvZGluZyA9IFN0cmluZ1V0aWxzXzEuZGVmYXVsdC5ndWVzc0VuY29kaW5nKHJlYWRCeXRlcywgaGludHMpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgZW5jb2RpbmcgPSBjdXJyZW50Q2hhcmFjdGVyU2V0RUNJLmdldE5hbWUoKTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChTdHJpbmdFbmNvZGluZ18xLmRlZmF1bHQuZGVjb2RlKHJlYWRCeXRlcywgZW5jb2RpbmcpKTsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoaWdub3JlZCAvKjogVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdChpZ25vcmVkKTsKCSAgICAgICAgfQoJICAgICAgICBieXRlU2VnbWVudHMucHVzaChyZWFkQnl0ZXMpOwoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIgPSBmdW5jdGlvbiAodmFsdWUgLyppbnQqLykgewoJICAgICAgICBpZiAodmFsdWUgPj0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5BTFBIQU5VTUVSSUNfQ0hBUlMubGVuZ3RoKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLkFMUEhBTlVNRVJJQ19DSEFSU1t2YWx1ZV07CgkgICAgfTsKCSAgICBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLmRlY29kZUFscGhhbnVtZXJpY1NlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovLCBmYzFJbkVmZmVjdCkgewoJICAgICAgICAvLyBSZWFkIHR3byBjaGFyYWN0ZXJzIGF0IGEgdGltZQoJICAgICAgICB2YXIgc3RhcnQgPSByZXN1bHQubGVuZ3RoKCk7CgkgICAgICAgIHdoaWxlIChjb3VudCA+IDEpIHsKCSAgICAgICAgICAgIGlmIChiaXRzLmF2YWlsYWJsZSgpIDwgMTEpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIG5leHRUd29DaGFyc0JpdHMgPSBiaXRzLnJlYWRCaXRzKDExKTsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoTWF0aC5mbG9vcihuZXh0VHdvQ2hhcnNCaXRzIC8gNDUpKSk7CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKG5leHRUd29DaGFyc0JpdHMgJSA0NSkpOwoJICAgICAgICAgICAgY291bnQgLT0gMjsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY291bnQgPT09IDEpIHsKCSAgICAgICAgICAgIC8vIHNwZWNpYWwgY2FzZTogb25lIGNoYXJhY3RlciBsZWZ0CgkgICAgICAgICAgICBpZiAoYml0cy5hdmFpbGFibGUoKSA8IDYpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChEZWNvZGVkQml0U3RyZWFtUGFyc2VyLnRvQWxwaGFOdW1lcmljQ2hhcihiaXRzLnJlYWRCaXRzKDYpKSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gU2VlIHNlY3Rpb24gNi40LjguMSwgNi40LjguMgoJICAgICAgICBpZiAoZmMxSW5FZmZlY3QpIHsKCSAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gbWFzc2FnZSB0aGUgcmVzdWx0IGEgYml0IGlmIGluIGFuIEZOQzEgbW9kZToKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IHJlc3VsdC5sZW5ndGgoKTsgaSsrKSB7CgkgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5jaGFyQXQoaSkgPT09ICclJykgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaSA8IHJlc3VsdC5sZW5ndGgoKSAtIDEgJiYgcmVzdWx0LmNoYXJBdChpICsgMSkgPT09ICclJykgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gJSUgaXMgcmVuZGVyZWQgYXMgJQoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRlbGV0ZUNoYXJBdChpICsgMSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbiBhbHBoYSBtb2RlLCAlIHNob3VsZCBiZSBjb252ZXJ0ZWQgdG8gRk5DMSBzZXBhcmF0b3IgMHgxRAoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnNldENoYXJBdChpLCBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4MUQpKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVOdW1lcmljU2VnbWVudCA9IGZ1bmN0aW9uIChiaXRzLCByZXN1bHQsIGNvdW50IC8qaW50Ki8pIHsKCSAgICAgICAgLy8gUmVhZCB0aHJlZSBkaWdpdHMgYXQgYSB0aW1lCgkgICAgICAgIHdoaWxlIChjb3VudCA+PSAzKSB7CgkgICAgICAgICAgICAvLyBFYWNoIDEwIGJpdHMgZW5jb2RlcyB0aHJlZSBkaWdpdHMKCSAgICAgICAgICAgIGlmIChiaXRzLmF2YWlsYWJsZSgpIDwgMTApIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIHRocmVlRGlnaXRzQml0cyA9IGJpdHMucmVhZEJpdHMoMTApOwoJICAgICAgICAgICAgaWYgKHRocmVlRGlnaXRzQml0cyA+PSAxMDAwKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoTWF0aC5mbG9vcih0aHJlZURpZ2l0c0JpdHMgLyAxMDApKSk7CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKE1hdGguZmxvb3IodGhyZWVEaWdpdHNCaXRzIC8gMTApICUgMTApKTsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIodGhyZWVEaWdpdHNCaXRzICUgMTApKTsKCSAgICAgICAgICAgIGNvdW50IC09IDM7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvdW50ID09PSAyKSB7CgkgICAgICAgICAgICAvLyBUd28gZGlnaXRzIGxlZnQgb3ZlciB0byByZWFkLCBlbmNvZGVkIGluIDcgYml0cwoJICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCA3KSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhciB0d29EaWdpdHNCaXRzID0gYml0cy5yZWFkQml0cyg3KTsKCSAgICAgICAgICAgIGlmICh0d29EaWdpdHNCaXRzID49IDEwMCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKE1hdGguZmxvb3IodHdvRGlnaXRzQml0cyAvIDEwKSkpOwoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChEZWNvZGVkQml0U3RyZWFtUGFyc2VyLnRvQWxwaGFOdW1lcmljQ2hhcih0d29EaWdpdHNCaXRzICUgMTApKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChjb3VudCA9PT0gMSkgewoJICAgICAgICAgICAgLy8gT25lIGRpZ2l0IGxlZnQgb3ZlciB0byByZWFkCgkgICAgICAgICAgICBpZiAoYml0cy5hdmFpbGFibGUoKSA8IDQpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIGRpZ2l0Qml0cyA9IGJpdHMucmVhZEJpdHMoNCk7CgkgICAgICAgICAgICBpZiAoZGlnaXRCaXRzID49IDEwKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoZGlnaXRCaXRzKSk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIucGFyc2VFQ0lWYWx1ZSA9IGZ1bmN0aW9uIChiaXRzKSB7CgkgICAgICAgIHZhciBmaXJzdEJ5dGUgPSBiaXRzLnJlYWRCaXRzKDgpOwoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4ODApID09PSAwKSB7CgkgICAgICAgICAgICAvLyBqdXN0IG9uZSBieXRlCgkgICAgICAgICAgICByZXR1cm4gZmlyc3RCeXRlICYgMHg3RjsKCSAgICAgICAgfQoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4QzApID09PSAweDgwKSB7CgkgICAgICAgICAgICAvLyB0d28gYnl0ZXMKCSAgICAgICAgICAgIHZhciBzZWNvbmRCeXRlID0gYml0cy5yZWFkQml0cyg4KTsKCSAgICAgICAgICAgIHJldHVybiAoKChmaXJzdEJ5dGUgJiAweDNGKSA8PCA4KSAmIDB4RkZGRkZGRkYpIHwgc2Vjb25kQnl0ZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4RTApID09PSAweEMwKSB7CgkgICAgICAgICAgICAvLyB0aHJlZSBieXRlcwoJICAgICAgICAgICAgdmFyIHNlY29uZFRoaXJkQnl0ZXMgPSBiaXRzLnJlYWRCaXRzKDE2KTsKCSAgICAgICAgICAgIHJldHVybiAoKChmaXJzdEJ5dGUgJiAweDFGKSA8PCAxNikgJiAweEZGRkZGRkZGKSB8IHNlY29uZFRoaXJkQnl0ZXM7CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFNlZSBJU08gMTgwMDQ6MjAwNiwgNi40LjQgVGFibGUgNQoJICAgICAqLwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuQUxQSEFOVU1FUklDX0NIQVJTID0gJzAxMjM0NTY3ODlBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWiAkJSorLS4vOic7CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5HQjIzMTJfU1VCU0VUID0gMTsKCSAgICByZXR1cm4gRGVjb2RlZEJpdFN0cmVhbVBhcnNlcjsKCX0oKSk7CglEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEuZGVmYXVsdCA9IERlY29kZWRCaXRTdHJlYW1QYXJzZXI7CgoJdmFyIFFSQ29kZURlY29kZXJNZXRhRGF0YSQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDEzIFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShRUkNvZGVEZWNvZGVyTWV0YURhdGEkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLyoqCgkgKiBNZXRhLWRhdGEgY29udGFpbmVyIGZvciBRUiBDb2RlIGRlY29kaW5nLiBJbnN0YW5jZXMgb2YgdGhpcyBjbGFzcyBtYXkgYmUgdXNlZCB0byBjb252ZXkgaW5mb3JtYXRpb24gYmFjayB0byB0aGUKCSAqIGRlY29kaW5nIGNhbGxlci4gQ2FsbGVycyBhcmUgZXhwZWN0ZWQgdG8gcHJvY2VzcyB0aGlzLgoJICoKCSAqIEBzZWUgY29tLmdvb2dsZS56eGluZy5jb21tb24uRGVjb2RlclJlc3VsdCNnZXRPdGhlcigpCgkgKi8KCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGEgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUVJDb2RlRGVjb2Rlck1ldGFEYXRhKG1pcnJvcmVkKSB7CgkgICAgICAgIHRoaXMubWlycm9yZWQgPSBtaXJyb3JlZDsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBRUiBDb2RlIHdhcyBtaXJyb3JlZC4KCSAgICAgKi8KCSAgICBRUkNvZGVEZWNvZGVyTWV0YURhdGEucHJvdG90eXBlLmlzTWlycm9yZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm1pcnJvcmVkOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQXBwbHkgdGhlIHJlc3VsdCBwb2ludHMnIG9yZGVyIGNvcnJlY3Rpb24gZHVlIHRvIG1pcnJvcmluZy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBwb2ludHMgQXJyYXkgb2YgcG9pbnRzIHRvIGFwcGx5IG1pcnJvciBjb3JyZWN0aW9uIHRvLgoJICAgICAqLwoJICAgIFFSQ29kZURlY29kZXJNZXRhRGF0YS5wcm90b3R5cGUuYXBwbHlNaXJyb3JlZENvcnJlY3Rpb24gPSBmdW5jdGlvbiAocG9pbnRzKSB7CgkgICAgICAgIGlmICghdGhpcy5taXJyb3JlZCB8fCBwb2ludHMgPT09IG51bGwgfHwgcG9pbnRzLmxlbmd0aCA8IDMpIHsKCSAgICAgICAgICAgIHJldHVybjsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYm90dG9tTGVmdCA9IHBvaW50c1swXTsKCSAgICAgICAgcG9pbnRzWzBdID0gcG9pbnRzWzJdOwoJICAgICAgICBwb2ludHNbMl0gPSBib3R0b21MZWZ0OwoJICAgICAgICAvLyBObyBuZWVkIHRvICdmaXgnIHRvcC1sZWZ0IGFuZCBhbGlnbm1lbnQgcGF0dGVybi4KCSAgICB9OwoJICAgIHJldHVybiBRUkNvZGVEZWNvZGVyTWV0YURhdGE7Cgl9KCkpOwoJUVJDb2RlRGVjb2Rlck1ldGFEYXRhJDEuZGVmYXVsdCA9IFFSQ29kZURlY29kZXJNZXRhRGF0YTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDIgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGVjb2RlciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLnFyY29kZS5kZWNvZGVyIHsqLwoJdmFyIENoZWNrc3VtRXhjZXB0aW9uXzEgPSBDaGVja3N1bUV4Y2VwdGlvbiQxOwoJdmFyIEJpdE1hdHJpeF8xJDIgPSBCaXRNYXRyaXgkMTsKCXZhciBHZW5lcmljR0ZfMSA9IEdlbmVyaWNHRiQxOwoJdmFyIFJlZWRTb2xvbW9uRGVjb2Rlcl8xID0gUmVlZFNvbG9tb25EZWNvZGVyJDE7Cgl2YXIgQml0TWF0cml4UGFyc2VyXzEgPSBCaXRNYXRyaXhQYXJzZXIkMTsKCXZhciBEYXRhQmxvY2tfMSA9IERhdGFCbG9jayQxOwoJdmFyIERlY29kZWRCaXRTdHJlYW1QYXJzZXJfMSA9IERlY29kZWRCaXRTdHJlYW1QYXJzZXIkMTsKCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSQxID0gUVJDb2RlRGVjb2Rlck1ldGFEYXRhJDE7CgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlRoZSBtYWluIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgUVIgQ29kZSBkZWNvZGluZyAtLSBhcyBvcHBvc2VkIHRvIGxvY2F0aW5nIGFuZCBleHRyYWN0aW5nCgkgKiB0aGUgUVIgQ29kZSBmcm9tIGFuIGltYWdlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGVjb2RlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBEZWNvZGVyKCkgewoJICAgICAgICB0aGlzLnJzRGVjb2RlciA9IG5ldyBSZWVkU29sb21vbkRlY29kZXJfMS5kZWZhdWx0KEdlbmVyaWNHRl8xLmRlZmF1bHQuUVJfQ09ERV9GSUVMRF8yNTYpOwoJICAgIH0KCSAgICAvLyBwdWJsaWMgZGVjb2RlKGltYWdlOiBib29sZWFuW11bXSk6IERlY29kZXJSZXN1bHQgLyp0aHJvd3MgQ2hlY2tzdW1FeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiovIHsKCSAgICAvLyAgIHJldHVybiBkZWNvZGUoaW1hZ2UsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIDxwPkNvbnZlbmllbmNlIG1ldGhvZCB0aGF0IGNhbiBkZWNvZGUgYSBRUiBDb2RlIHJlcHJlc2VudGVkIGFzIGEgMkQgYXJyYXkgb2YgYm9vbGVhbnMuCgkgICAgICogInRydWUiIGlzIHRha2VuIHRvIG1lYW4gYSBibGFjayBtb2R1bGUuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGltYWdlIGJvb2xlYW5zIHJlcHJlc2VudGluZyB3aGl0ZS9ibGFjayBRUiBDb2RlIG1vZHVsZXMKCSAgICAgKiBAcGFyYW0gaGludHMgZGVjb2RpbmcgaGludHMgdGhhdCBzaG91bGQgYmUgdXNlZCB0byBpbmZsdWVuY2UgZGVjb2RpbmcKCSAgICAgKiBAcmV0dXJuIHRleHQgYW5kIGJ5dGVzIGVuY29kZWQgd2l0aGluIHRoZSBRUiBDb2RlCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgdGhlIFFSIENvZGUgY2Fubm90IGJlIGRlY29kZWQKCSAgICAgKiBAdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uIGlmIGVycm9yIGNvcnJlY3Rpb24gZmFpbHMKCSAgICAgKi8KCSAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGVCb29sZWFuQXJyYXkgPSBmdW5jdGlvbiAoaW1hZ2UsIGhpbnRzKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUJpdE1hdHJpeChCaXRNYXRyaXhfMSQyLmRlZmF1bHQucGFyc2VGcm9tQm9vbGVhbkFycmF5KGltYWdlKSwgaGludHMpOwoJICAgIH07CgkgICAgLy8gcHVibGljIGRlY29kZUJpdE1hdHJpeChiaXRzOiBCaXRNYXRyaXgpOiBEZWNvZGVyUmVzdWx0IC8qdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uLCBGb3JtYXRFeGNlcHRpb24qLyB7CgkgICAgLy8gICByZXR1cm4gZGVjb2RlKGJpdHMsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIDxwPkRlY29kZXMgYSBRUiBDb2RlIHJlcHJlc2VudGVkIGFzIGEge0BsaW5rIEJpdE1hdHJpeH0uIEEgMSBvciAidHJ1ZSIgaXMgdGFrZW4gdG8gbWVhbiBhIGJsYWNrIG1vZHVsZS48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0gYml0cyBib29sZWFucyByZXByZXNlbnRpbmcgd2hpdGUvYmxhY2sgUVIgQ29kZSBtb2R1bGVzCgkgICAgICogQHBhcmFtIGhpbnRzIGRlY29kaW5nIGhpbnRzIHRoYXQgc2hvdWxkIGJlIHVzZWQgdG8gaW5mbHVlbmNlIGRlY29kaW5nCgkgICAgICogQHJldHVybiB0ZXh0IGFuZCBieXRlcyBlbmNvZGVkIHdpdGhpbiB0aGUgUVIgQ29kZQoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIHRoZSBRUiBDb2RlIGNhbm5vdCBiZSBkZWNvZGVkCgkgICAgICogQHRocm93cyBDaGVja3N1bUV4Y2VwdGlvbiBpZiBlcnJvciBjb3JyZWN0aW9uIGZhaWxzCgkgICAgICovCgkgICAgRGVjb2Rlci5wcm90b3R5cGUuZGVjb2RlQml0TWF0cml4ID0gZnVuY3Rpb24gKGJpdHMsIGhpbnRzKSB7CgkgICAgICAgIC8vIENvbnN0cnVjdCBhIHBhcnNlciBhbmQgcmVhZCB2ZXJzaW9uLCBlcnJvci1jb3JyZWN0aW9uIGxldmVsCgkgICAgICAgIHZhciBwYXJzZXIgPSBuZXcgQml0TWF0cml4UGFyc2VyXzEuZGVmYXVsdChiaXRzKTsKCSAgICAgICAgdmFyIGV4ID0gbnVsbDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUJpdE1hdHJpeFBhcnNlcihwYXJzZXIsIGhpbnRzKTsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZSAvKjogRm9ybWF0RXhjZXB0aW9uLCBDaGVja3N1bUV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICBleCA9IGU7CgkgICAgICAgIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIC8vIFJldmVydCB0aGUgYml0IG1hdHJpeAoJICAgICAgICAgICAgcGFyc2VyLnJlbWFzaygpOwoJICAgICAgICAgICAgLy8gV2lsbCBiZSBhdHRlbXB0aW5nIGEgbWlycm9yZWQgcmVhZGluZyBvZiB0aGUgdmVyc2lvbiBhbmQgZm9ybWF0IGluZm8uCgkgICAgICAgICAgICBwYXJzZXIuc2V0TWlycm9yKHRydWUpOwoJICAgICAgICAgICAgLy8gUHJlZW1wdGl2ZWx5IHJlYWQgdGhlIHZlcnNpb24uCgkgICAgICAgICAgICBwYXJzZXIucmVhZFZlcnNpb24oKTsKCSAgICAgICAgICAgIC8vIFByZWVtcHRpdmVseSByZWFkIHRoZSBmb3JtYXQgaW5mb3JtYXRpb24uCgkgICAgICAgICAgICBwYXJzZXIucmVhZEZvcm1hdEluZm9ybWF0aW9uKCk7CgkgICAgICAgICAgICAvKgoJICAgICAgICAgICAgICogU2luY2Ugd2UncmUgaGVyZSwgdGhpcyBtZWFucyB3ZSBoYXZlIHN1Y2Nlc3NmdWxseSBkZXRlY3RlZCBzb21lIGtpbmQKCSAgICAgICAgICAgICAqIG9mIHZlcnNpb24gYW5kIGZvcm1hdCBpbmZvcm1hdGlvbiB3aGVuIG1pcnJvcmVkLiBUaGlzIGlzIGEgZ29vZCBzaWduLAoJICAgICAgICAgICAgICogdGhhdCB0aGUgUVIgY29kZSBtYXkgYmUgbWlycm9yZWQsIGFuZCB3ZSBzaG91bGQgdHJ5IG9uY2UgbW9yZSB3aXRoIGEKCSAgICAgICAgICAgICAqIG1pcnJvcmVkIGNvbnRlbnQuCgkgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgIC8vIFByZXBhcmUgZm9yIGEgbWlycm9yZWQgcmVhZGluZy4KCSAgICAgICAgICAgIHBhcnNlci5taXJyb3IoKTsKCSAgICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLmRlY29kZUJpdE1hdHJpeFBhcnNlcihwYXJzZXIsIGhpbnRzKTsKCSAgICAgICAgICAgIC8vIFN1Y2Nlc3MhIE5vdGlmeSB0aGUgY2FsbGVyIHRoYXQgdGhlIGNvZGUgd2FzIG1pcnJvcmVkLgoJICAgICAgICAgICAgcmVzdWx0LnNldE90aGVyKG5ldyBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSQxLmRlZmF1bHQodHJ1ZSkpOwoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZSAvKkZvcm1hdEV4Y2VwdGlvbiB8IENoZWNrc3VtRXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgIC8vIFRocm93IHRoZSBleGNlcHRpb24gZnJvbSB0aGUgb3JpZ2luYWwgcmVhZGluZwoJICAgICAgICAgICAgaWYgKGV4ICE9PSBudWxsKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgZXg7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0aHJvdyBlOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGVCaXRNYXRyaXhQYXJzZXIgPSBmdW5jdGlvbiAocGFyc2VyLCBoaW50cykgewoJICAgICAgICB2YXIgZV8xLCBfYSwgZV8yLCBfYjsKCSAgICAgICAgdmFyIHZlcnNpb24gPSBwYXJzZXIucmVhZFZlcnNpb24oKTsKCSAgICAgICAgdmFyIGVjTGV2ZWwgPSBwYXJzZXIucmVhZEZvcm1hdEluZm9ybWF0aW9uKCkuZ2V0RXJyb3JDb3JyZWN0aW9uTGV2ZWwoKTsKCSAgICAgICAgLy8gUmVhZCBjb2Rld29yZHMKCSAgICAgICAgdmFyIGNvZGV3b3JkcyA9IHBhcnNlci5yZWFkQ29kZXdvcmRzKCk7CgkgICAgICAgIC8vIFNlcGFyYXRlIGludG8gZGF0YSBibG9ja3MKCSAgICAgICAgdmFyIGRhdGFCbG9ja3MgPSBEYXRhQmxvY2tfMS5kZWZhdWx0LmdldERhdGFCbG9ja3MoY29kZXdvcmRzLCB2ZXJzaW9uLCBlY0xldmVsKTsKCSAgICAgICAgLy8gQ291bnQgdG90YWwgbnVtYmVyIG9mIGRhdGEgYnl0ZXMKCSAgICAgICAgdmFyIHRvdGFsQnl0ZXMgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgZGF0YUJsb2Nrc18xID0gX192YWx1ZXMkMihkYXRhQmxvY2tzKSwgZGF0YUJsb2Nrc18xXzEgPSBkYXRhQmxvY2tzXzEubmV4dCgpOyAhZGF0YUJsb2Nrc18xXzEuZG9uZTsgZGF0YUJsb2Nrc18xXzEgPSBkYXRhQmxvY2tzXzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRhdGFCbG9jayA9IGRhdGFCbG9ja3NfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgIHRvdGFsQnl0ZXMgKz0gZGF0YUJsb2NrLmdldE51bURhdGFDb2Rld29yZHMoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGRhdGFCbG9ja3NfMV8xICYmICFkYXRhQmxvY2tzXzFfMS5kb25lICYmIChfYSA9IGRhdGFCbG9ja3NfMS5yZXR1cm4pKSBfYS5jYWxsKGRhdGFCbG9ja3NfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkodG90YWxCeXRlcyk7CgkgICAgICAgIHZhciByZXN1bHRPZmZzZXQgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgLy8gRXJyb3ItY29ycmVjdCBhbmQgY29weSBkYXRhIGJsb2NrcyB0b2dldGhlciBpbnRvIGEgc3RyZWFtIG9mIGJ5dGVzCgkgICAgICAgICAgICBmb3IgKHZhciBkYXRhQmxvY2tzXzIgPSBfX3ZhbHVlcyQyKGRhdGFCbG9ja3MpLCBkYXRhQmxvY2tzXzJfMSA9IGRhdGFCbG9ja3NfMi5uZXh0KCk7ICFkYXRhQmxvY2tzXzJfMS5kb25lOyBkYXRhQmxvY2tzXzJfMSA9IGRhdGFCbG9ja3NfMi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZGF0YUJsb2NrID0gZGF0YUJsb2Nrc18yXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgdmFyIGNvZGV3b3JkQnl0ZXMgPSBkYXRhQmxvY2suZ2V0Q29kZXdvcmRzKCk7CgkgICAgICAgICAgICAgICAgdmFyIG51bURhdGFDb2Rld29yZHMgPSBkYXRhQmxvY2suZ2V0TnVtRGF0YUNvZGV3b3JkcygpOwoJICAgICAgICAgICAgICAgIHRoaXMuY29ycmVjdEVycm9ycyhjb2Rld29yZEJ5dGVzLCBudW1EYXRhQ29kZXdvcmRzKTsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bURhdGFDb2Rld29yZHM7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHRCeXRlc1tyZXN1bHRPZmZzZXQrK10gPSBjb2Rld29yZEJ5dGVzW2ldOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8yXzEpIHsgZV8yID0geyBlcnJvcjogZV8yXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGRhdGFCbG9ja3NfMl8xICYmICFkYXRhQmxvY2tzXzJfMS5kb25lICYmIChfYiA9IGRhdGFCbG9ja3NfMi5yZXR1cm4pKSBfYi5jYWxsKGRhdGFCbG9ja3NfMik7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMikgdGhyb3cgZV8yLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gRGVjb2RlIHRoZSBjb250ZW50cyBvZiB0aGF0IHN0cmVhbSBvZiBieXRlcwoJICAgICAgICByZXR1cm4gRGVjb2RlZEJpdFN0cmVhbVBhcnNlcl8xLmRlZmF1bHQuZGVjb2RlKHJlc3VsdEJ5dGVzLCB2ZXJzaW9uLCBlY0xldmVsLCBoaW50cyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5HaXZlbiBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyByZWNlaXZlZCwgcG9zc2libHkgY29ycnVwdGVkIGJ5IGVycm9ycywgYXR0ZW1wdHMgdG8KCSAgICAgKiBjb3JyZWN0IHRoZSBlcnJvcnMgaW4tcGxhY2UgdXNpbmcgUmVlZC1Tb2xvbW9uIGVycm9yIGNvcnJlY3Rpb24uPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGNvZGV3b3JkQnl0ZXMgZGF0YSBhbmQgZXJyb3IgY29ycmVjdGlvbiBjb2Rld29yZHMKCSAgICAgKiBAcGFyYW0gbnVtRGF0YUNvZGV3b3JkcyBudW1iZXIgb2YgY29kZXdvcmRzIHRoYXQgYXJlIGRhdGEgYnl0ZXMKCSAgICAgKiBAdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uIGlmIGVycm9yIGNvcnJlY3Rpb24gZmFpbHMKCSAgICAgKi8KCSAgICBEZWNvZGVyLnByb3RvdHlwZS5jb3JyZWN0RXJyb3JzID0gZnVuY3Rpb24gKGNvZGV3b3JkQnl0ZXMsIG51bURhdGFDb2Rld29yZHMgLyppbnQqLykgewoJICAgICAgICAvLyBjb25zdCBudW1Db2Rld29yZHMgPSBjb2Rld29yZEJ5dGVzLmxlbmd0aDsKCSAgICAgICAgLy8gRmlyc3QgcmVhZCBpbnRvIGFuIGFycmF5IG9mIGludHMKCSAgICAgICAgdmFyIGNvZGV3b3Jkc0ludHMgPSBuZXcgSW50MzJBcnJheShjb2Rld29yZEJ5dGVzKTsKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IG5vdCByZWFseSBuZWNlc3NhcnkgdG8gdHJhbnNmb3JtIHRvIGludHM/IGNvdWxkIHJlZGVzaWduIGV2ZXJ5dGhpbmcgdG8gd29yayB3aXRoIHVuc2lnbmVkIGJ5dGVzPwoJICAgICAgICAvLyBjb25zdCBjb2Rld29yZHNJbnRzID0gbmV3IEludDMyQXJyYXkobnVtQ29kZXdvcmRzKQoJICAgICAgICAvLyBmb3IgKGxldCBpID0gMDsgaSA8IG51bUNvZGV3b3JkczsgaSsrKSB7CgkgICAgICAgIC8vICAgY29kZXdvcmRzSW50c1tpXSA9IGNvZGV3b3JkQnl0ZXNbaV0gJiAweEZGCgkgICAgICAgIC8vIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHRoaXMucnNEZWNvZGVyLmRlY29kZShjb2Rld29yZHNJbnRzLCBjb2Rld29yZEJ5dGVzLmxlbmd0aCAtIG51bURhdGFDb2Rld29yZHMpOwoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChpZ25vcmVkIC8qOiBSZWVkU29sb21vbkV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgQ2hlY2tzdW1FeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29weSBiYWNrIGludG8gYXJyYXkgb2YgYnl0ZXMgLS0gb25seSBuZWVkIHRvIHdvcnJ5IGFib3V0IHRoZSBieXRlcyB0aGF0IHdlcmUgZGF0YQoJICAgICAgICAvLyBXZSBkb24ndCBjYXJlIGFib3V0IGVycm9ycyBpbiB0aGUgZXJyb3ItY29ycmVjdGlvbiBjb2Rld29yZHMKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1EYXRhQ29kZXdvcmRzOyBpKyspIHsKCSAgICAgICAgICAgIGNvZGV3b3JkQnl0ZXNbaV0gPSAvKihieXRlKSAqLyBjb2Rld29yZHNJbnRzW2ldOwoJICAgICAgICB9CgkgICAgfTsKCSAgICByZXR1cm4gRGVjb2RlcjsKCX0oKSk7CglEZWNvZGVyJDEuZGVmYXVsdCA9IERlY29kZXI7CgoJdmFyIERldGVjdG9yJDEgPSB7fTsKCgl2YXIgTWF0aFV0aWxzJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMTIgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KE1hdGhVdGlscyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbi5kZXRlY3RvciB7Ki8KCS8qKgoJICogR2VuZXJhbCBtYXRoLXJlbGF0ZWQgYW5kIG51bWVyaWMgdXRpbGl0eSBmdW5jdGlvbnMuCgkgKi8KCXZhciBNYXRoVXRpbHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gTWF0aFV0aWxzKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiBFbmRzIHVwIGJlaW5nIGEgYml0IGZhc3RlciB0aGFuIHtAbGluayBNYXRoI3JvdW5kKGZsb2F0KX0uIFRoaXMgbWVyZWx5IHJvdW5kcyBpdHMKCSAgICAgKiBhcmd1bWVudCB0byB0aGUgbmVhcmVzdCBpbnQsIHdoZXJlIHguNSByb3VuZHMgdXAgdG8geCsxLiBTZW1hbnRpY3Mgb2YgdGhpcyBzaG9ydGN1dAoJICAgICAqIGRpZmZlciBzbGlnaHRseSBmcm9tIHtAbGluayBNYXRoI3JvdW5kKGZsb2F0KX0gaW4gdGhhdCBoYWxmIHJvdW5kcyBkb3duIGZvciBuZWdhdGl2ZQoJICAgICAqIHZhbHVlcy4gLTIuNSByb3VuZHMgdG8gLTMsIG5vdCAtMi4gRm9yIHB1cnBvc2VzIGhlcmUgaXQgbWFrZXMgbm8gZGlmZmVyZW5jZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBkIHJlYWwgdmFsdWUgdG8gcm91bmQKCSAgICAgKiBAcmV0dXJuIG5lYXJlc3Qge0Bjb2RlIGludH0KCSAgICAgKi8KCSAgICBNYXRoVXRpbHMucm91bmQgPSBmdW5jdGlvbiAoZCAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE5hTiA9PT0gZCkKCSAgICAgICAgICAgIHJldHVybiAwOwoJICAgICAgICBpZiAoZCA8PSBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUikKCSAgICAgICAgICAgIHJldHVybiBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUjsKCSAgICAgICAgaWYgKGQgPj0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIpCgkgICAgICAgICAgICByZXR1cm4gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgICAgIHJldHVybiAvKihpbnQpICovIChkICsgKGQgPCAwLjAgPyAtMC41IDogMC41KSkgfCAwOwoJICAgIH07CgkgICAgLy8gVFlQRVNDUklQVFBPUlQ6IG1heWJlIHJlbW92ZSByb3VuZCBtZXRob2QgYW5kIGNhbGwgZGlyZWN0bHkgTWF0aC5yb3VuZCwgaXQgbG9va3MgbGlrZSBpdCBkb2Vzbid0IG1ha2Ugc2Vuc2UgZm9yIGpzCgkgICAgLyoqCgkgICAgICogQHBhcmFtIGFYIHBvaW50IEEgeCBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGFZIHBvaW50IEEgeSBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGJYIHBvaW50IEIgeCBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGJZIHBvaW50IEIgeSBjb29yZGluYXRlCgkgICAgICogQHJldHVybiBFdWNsaWRlYW4gZGlzdGFuY2UgYmV0d2VlbiBwb2ludHMgQSBhbmQgQgoJICAgICAqLwoJICAgIE1hdGhVdGlscy5kaXN0YW5jZSA9IGZ1bmN0aW9uIChhWCAvKmZsb2F0fGludCovLCBhWSAvKmZsb2F0fGludCovLCBiWCAvKmZsb2F0fGludCovLCBiWSAvKmZsb2F0fGludCovKSB7CgkgICAgICAgIHZhciB4RGlmZiA9IGFYIC0gYlg7CgkgICAgICAgIHZhciB5RGlmZiA9IGFZIC0gYlk7CgkgICAgICAgIHJldHVybiAvKihmbG9hdCkgKi8gTWF0aC5zcXJ0KHhEaWZmICogeERpZmYgKyB5RGlmZiAqIHlEaWZmKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBhWCBwb2ludCBBIHggY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBhWSBwb2ludCBBIHkgY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBiWCBwb2ludCBCIHggY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBiWSBwb2ludCBCIHkgY29vcmRpbmF0ZQoJICAgICAqIEByZXR1cm4gRXVjbGlkZWFuIGRpc3RhbmNlIGJldHdlZW4gcG9pbnRzIEEgYW5kIEIKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgc3RhdGljIGRpc3RhbmNlKGFYOiBudW1iZXIgLyppbnQqLywgYVk6IG51bWJlciAvKmludCovLCBiWDogbnVtYmVyIC8qaW50Ki8sIGJZOiBudW1iZXIgLyppbnQqLyk6IGZsb2F0IHsKCSAgICAvLyAgIGNvbnN0IHhEaWZmID0gYVggLSBiWAoJICAgIC8vICAgY29uc3QgeURpZmYgPSBhWSAtIGJZCgkgICAgLy8gICByZXR1cm4gKGZsb2F0KSBNYXRoLnNxcnQoeERpZmYgKiB4RGlmZiArIHlEaWZmICogeURpZmYpOwoJICAgIC8vIH0KCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYXJyYXkgdmFsdWVzIHRvIHN1bQoJICAgICAqIEByZXR1cm4gc3VtIG9mIHZhbHVlcyBpbiBhcnJheQoJICAgICAqLwoJICAgIE1hdGhVdGlscy5zdW0gPSBmdW5jdGlvbiAoYXJyYXkpIHsKCSAgICAgICAgdmFyIGNvdW50ID0gMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gYXJyYXkubGVuZ3RoOyBpICE9PSBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgYSA9IGFycmF5W2ldOwoJICAgICAgICAgICAgY291bnQgKz0gYTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gY291bnQ7CgkgICAgfTsKCSAgICByZXR1cm4gTWF0aFV0aWxzOwoJfSgpKTsKCU1hdGhVdGlscyQxLmRlZmF1bHQgPSBNYXRoVXRpbHM7CgoJdmFyIERldGVjdG9yUmVzdWx0JDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KERldGVjdG9yUmVzdWx0JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGV0ZWN0aW5nIGEgYmFyY29kZSBpbiBhbiBpbWFnZS4gVGhpcyBpbmNsdWRlcyB0aGUgcmF3CgkgKiBtYXRyaXggb2YgYmxhY2svd2hpdGUgcGl4ZWxzIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGJhcmNvZGUsIGFuZCBwb3NzaWJseSBwb2ludHMgb2YgaW50ZXJlc3QKCSAqIGluIHRoZSBpbWFnZSwgbGlrZSB0aGUgbG9jYXRpb24gb2YgZmluZGVyIHBhdHRlcm5zIG9yIGNvcm5lcnMgb2YgdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGV0ZWN0b3JSZXN1bHQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gRGV0ZWN0b3JSZXN1bHQoYml0cywgcG9pbnRzKSB7CgkgICAgICAgIHRoaXMuYml0cyA9IGJpdHM7CgkgICAgICAgIHRoaXMucG9pbnRzID0gcG9pbnRzOwoJICAgIH0KCSAgICBEZXRlY3RvclJlc3VsdC5wcm90b3R5cGUuZ2V0Qml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYml0czsKCSAgICB9OwoJICAgIERldGVjdG9yUmVzdWx0LnByb3RvdHlwZS5nZXRQb2ludHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnBvaW50czsKCSAgICB9OwoJICAgIHJldHVybiBEZXRlY3RvclJlc3VsdDsKCX0oKSk7CglEZXRlY3RvclJlc3VsdCQxLmRlZmF1bHQgPSBEZXRlY3RvclJlc3VsdDsKCgl2YXIgR3JpZFNhbXBsZXJJbnN0YW5jZSQxID0ge307CgoJdmFyIERlZmF1bHRHcmlkU2FtcGxlciQxID0ge307CgoJdmFyIEdyaWRTYW1wbGVyJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEdyaWRTYW1wbGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDUgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBJbXBsZW1lbnRhdGlvbnMgb2YgdGhpcyBjbGFzcyBjYW4sIGdpdmVuIGxvY2F0aW9ucyBvZiBmaW5kZXIgcGF0dGVybnMgZm9yIGEgUVIgY29kZSBpbiBhbgoJICogaW1hZ2UsIHNhbXBsZSB0aGUgcmlnaHQgcG9pbnRzIGluIHRoZSBpbWFnZSB0byByZWNvbnN0cnVjdCB0aGUgUVIgY29kZSwgYWNjb3VudGluZyBmb3IKCSAqIHBlcnNwZWN0aXZlIGRpc3RvcnRpb24uIEl0IGlzIGFic3RyYWN0ZWQgc2luY2UgaXQgaXMgcmVsYXRpdmVseSBleHBlbnNpdmUgYW5kIHNob3VsZCBiZSBhbGxvd2VkCgkgKiB0byB0YWtlIGFkdmFudGFnZSBvZiBwbGF0Zm9ybS1zcGVjaWZpYyBvcHRpbWl6ZWQgaW1wbGVtZW50YXRpb25zLCBsaWtlIFN1bidzIEphdmEgQWR2YW5jZWQKCSAqIEltYWdpbmcgbGlicmFyeSwgYnV0IHdoaWNoIG1heSBub3QgYmUgYXZhaWxhYmxlIGluIG90aGVyIGVudmlyb25tZW50cyBzdWNoIGFzIEoyTUUsIGFuZCB2aWNlCgkgKiB2ZXJzYS4KCSAqCgkgKiBUaGUgaW1wbGVtZW50YXRpb24gdXNlZCBjYW4gYmUgY29udHJvbGxlZCBieSBjYWxsaW5nIHtAbGluayAjc2V0R3JpZFNhbXBsZXIoR3JpZFNhbXBsZXIpfQoJICogd2l0aCBhbiBpbnN0YW5jZSBvZiBhIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgdGhpcyBpbnRlcmZhY2UuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEdyaWRTYW1wbGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEdyaWRTYW1wbGVyKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5DaGVja3MgYSBzZXQgb2YgcG9pbnRzIHRoYXQgaGF2ZSBiZWVuIHRyYW5zZm9ybWVkIHRvIHNhbXBsZSBwb2ludHMgb24gYW4gaW1hZ2UgYWdhaW5zdAoJICAgICAqIHRoZSBpbWFnZSdzIGRpbWVuc2lvbnMgdG8gc2VlIGlmIHRoZSBwb2ludCBhcmUgZXZlbiB3aXRoaW4gdGhlIGltYWdlLjwvcD4KCSAgICAgKgoJICAgICAqIDxwPlRoaXMgbWV0aG9kIHdpbGwgYWN0dWFsbHkgIm51ZGdlIiB0aGUgZW5kcG9pbnRzIGJhY2sgb250byB0aGUgaW1hZ2UgaWYgdGhleSBhcmUgZm91bmQgdG8gYmUKCSAgICAgKiBiYXJlbHkgKGxlc3MgdGhhbiAxIHBpeGVsKSBvZmYgdGhlIGltYWdlLiBUaGlzIGFjY291bnRzIGZvciBpbXBlcmZlY3QgZGV0ZWN0aW9uIG9mIGZpbmRlcgoJICAgICAqIHBhdHRlcm5zIGluIGFuIGltYWdlIHdoZXJlIHRoZSBRUiBDb2RlIHJ1bnMgYWxsIHRoZSB3YXkgdG8gdGhlIGltYWdlIGJvcmRlci48L3A+CgkgICAgICoKCSAgICAgKiA8cD5Gb3IgZWZmaWNpZW5jeSwgdGhlIG1ldGhvZCB3aWxsIGNoZWNrIHBvaW50cyBmcm9tIGVpdGhlciBlbmQgb2YgdGhlIGxpbmUgdW50aWwgb25lIGlzIGZvdW5kCgkgICAgICogdG8gYmUgd2l0aGluIHRoZSBpbWFnZS4gQmVjYXVzZSB0aGUgc2V0IG9mIHBvaW50cyBhcmUgYXNzdW1lZCB0byBiZSBsaW5lYXIsIHRoaXMgaXMgdmFsaWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGltYWdlIGltYWdlIGludG8gd2hpY2ggdGhlIHBvaW50cyBzaG91bGQgbWFwCgkgICAgICogQHBhcmFtIHBvaW50cyBhY3R1YWwgcG9pbnRzIGluIHgxLHkxLC4uLix4bix5biBmb3JtCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBhbiBlbmRwb2ludCBpcyBsaWVzIG91dHNpZGUgdGhlIGltYWdlIGJvdW5kYXJpZXMKCSAgICAgKi8KCSAgICBHcmlkU2FtcGxlci5jaGVja0FuZE51ZGdlUG9pbnRzID0gZnVuY3Rpb24gKGltYWdlLCBwb2ludHMpIHsKCSAgICAgICAgdmFyIHdpZHRoID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IGltYWdlLmdldEhlaWdodCgpOwoJICAgICAgICAvLyBDaGVjayBhbmQgbnVkZ2UgcG9pbnRzIGZyb20gc3RhcnQgdW50aWwgd2Ugc2VlIHNvbWUgdGhhdCBhcmUgT0s6CgkgICAgICAgIHZhciBudWRnZWQgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBvZmZzZXQgPSAwOyBvZmZzZXQgPCBwb2ludHMubGVuZ3RoICYmIG51ZGdlZDsgb2Zmc2V0ICs9IDIpIHsKCSAgICAgICAgICAgIHZhciB4ID0gTWF0aC5mbG9vcihwb2ludHNbb2Zmc2V0XSk7CgkgICAgICAgICAgICB2YXIgeSA9IE1hdGguZmxvb3IocG9pbnRzW29mZnNldCArIDFdKTsKCSAgICAgICAgICAgIGlmICh4IDwgLTEgfHwgeCA+IHdpZHRoIHx8IHkgPCAtMSB8fCB5ID4gaGVpZ2h0KSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBudWRnZWQgPSBmYWxzZTsKCSAgICAgICAgICAgIGlmICh4ID09PSAtMSkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXRdID0gMC4wOwoJICAgICAgICAgICAgICAgIG51ZGdlZCA9IHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIGlmICh4ID09PSB3aWR0aCkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXRdID0gd2lkdGggLSAxOwoJICAgICAgICAgICAgICAgIG51ZGdlZCA9IHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAoeSA9PT0gLTEpIHsKCSAgICAgICAgICAgICAgICBwb2ludHNbb2Zmc2V0ICsgMV0gPSAwLjA7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHkgPT09IGhlaWdodCkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXQgKyAxXSA9IGhlaWdodCAtIDE7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICAvLyBDaGVjayBhbmQgbnVkZ2UgcG9pbnRzIGZyb20gZW5kOgoJICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBvZmZzZXQgPSBwb2ludHMubGVuZ3RoIC0gMjsgb2Zmc2V0ID49IDAgJiYgbnVkZ2VkOyBvZmZzZXQgLT0gMikgewoJICAgICAgICAgICAgdmFyIHggPSBNYXRoLmZsb29yKHBvaW50c1tvZmZzZXRdKTsKCSAgICAgICAgICAgIHZhciB5ID0gTWF0aC5mbG9vcihwb2ludHNbb2Zmc2V0ICsgMV0pOwoJICAgICAgICAgICAgaWYgKHggPCAtMSB8fCB4ID4gd2lkdGggfHwgeSA8IC0xIHx8IHkgPiBoZWlnaHQpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQ1LmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIG51ZGdlZCA9IGZhbHNlOwoJICAgICAgICAgICAgaWYgKHggPT09IC0xKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldF0gPSAwLjA7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHggPT09IHdpZHRoKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldF0gPSB3aWR0aCAtIDE7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmICh5ID09PSAtMSkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXQgKyAxXSA9IDAuMDsKCSAgICAgICAgICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSBpZiAoeSA9PT0gaGVpZ2h0KSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldCArIDFdID0gaGVpZ2h0IC0gMTsKCSAgICAgICAgICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICByZXR1cm4gR3JpZFNhbXBsZXI7Cgl9KCkpOwoJR3JpZFNhbXBsZXIkMS5kZWZhdWx0ID0gR3JpZFNhbXBsZXI7CgoJdmFyIFBlcnNwZWN0aXZlVHJhbnNmb3JtJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFBlcnNwZWN0aXZlVHJhbnNmb3JtJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyoqCgkgKiA8cD5UaGlzIGNsYXNzIGltcGxlbWVudHMgYSBwZXJzcGVjdGl2ZSB0cmFuc2Zvcm0gaW4gdHdvIGRpbWVuc2lvbnMuIEdpdmVuIGZvdXIgc291cmNlIGFuZCBmb3VyCgkgKiBkZXN0aW5hdGlvbiBwb2ludHMsIGl0IHdpbGwgY29tcHV0ZSB0aGUgdHJhbnNmb3JtYXRpb24gaW1wbGllZCBiZXR3ZWVuIHRoZW0uIFRoZSBjb2RlIGlzIGJhc2VkCgkgKiBkaXJlY3RseSB1cG9uIHNlY3Rpb24gMy40LjIgb2YgR2VvcmdlIFdvbGJlcmcncyAiRGlnaXRhbCBJbWFnZSBXYXJwaW5nIjsgc2VlIHBhZ2VzIDU0LTU2LjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUGVyc3BlY3RpdmVUcmFuc2Zvcm0gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUGVyc3BlY3RpdmVUcmFuc2Zvcm0oYTExIC8qZmxvYXQqLywgYTIxIC8qZmxvYXQqLywgYTMxIC8qZmxvYXQqLywgYTEyIC8qZmxvYXQqLywgYTIyIC8qZmxvYXQqLywgYTMyIC8qZmxvYXQqLywgYTEzIC8qZmxvYXQqLywgYTIzIC8qZmxvYXQqLywgYTMzIC8qZmxvYXQqLykgewoJICAgICAgICB0aGlzLmExMSA9IGExMTsKCSAgICAgICAgdGhpcy5hMjEgPSBhMjE7CgkgICAgICAgIHRoaXMuYTMxID0gYTMxOwoJICAgICAgICB0aGlzLmExMiA9IGExMjsKCSAgICAgICAgdGhpcy5hMjIgPSBhMjI7CgkgICAgICAgIHRoaXMuYTMyID0gYTMyOwoJICAgICAgICB0aGlzLmExMyA9IGExMzsKCSAgICAgICAgdGhpcy5hMjMgPSBhMjM7CgkgICAgICAgIHRoaXMuYTMzID0gYTMzOwoJICAgIH0KCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5xdWFkcmlsYXRlcmFsVG9RdWFkcmlsYXRlcmFsID0gZnVuY3Rpb24gKHgwIC8qZmxvYXQqLywgeTAgLypmbG9hdCovLCB4MSAvKmZsb2F0Ki8sIHkxIC8qZmxvYXQqLywgeDIgLypmbG9hdCovLCB5MiAvKmZsb2F0Ki8sIHgzIC8qZmxvYXQqLywgeTMgLypmbG9hdCovLCB4MHAgLypmbG9hdCovLCB5MHAgLypmbG9hdCovLCB4MXAgLypmbG9hdCovLCB5MXAgLypmbG9hdCovLCB4MnAgLypmbG9hdCovLCB5MnAgLypmbG9hdCovLCB4M3AgLypmbG9hdCovLCB5M3AgLypmbG9hdCovKSB7CgkgICAgICAgIHZhciBxVG9TID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm0ucXVhZHJpbGF0ZXJhbFRvU3F1YXJlKHgwLCB5MCwgeDEsIHkxLCB4MiwgeTIsIHgzLCB5Myk7CgkgICAgICAgIHZhciBzVG9RID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm0uc3F1YXJlVG9RdWFkcmlsYXRlcmFsKHgwcCwgeTBwLCB4MXAsIHkxcCwgeDJwLCB5MnAsIHgzcCwgeTNwKTsKCSAgICAgICAgcmV0dXJuIHNUb1EudGltZXMocVRvUyk7CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5wcm90b3R5cGUudHJhbnNmb3JtUG9pbnRzID0gZnVuY3Rpb24gKHBvaW50cykgewoJICAgICAgICB2YXIgbWF4ID0gcG9pbnRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGExMSA9IHRoaXMuYTExOwoJICAgICAgICB2YXIgYTEyID0gdGhpcy5hMTI7CgkgICAgICAgIHZhciBhMTMgPSB0aGlzLmExMzsKCSAgICAgICAgdmFyIGEyMSA9IHRoaXMuYTIxOwoJICAgICAgICB2YXIgYTIyID0gdGhpcy5hMjI7CgkgICAgICAgIHZhciBhMjMgPSB0aGlzLmEyMzsKCSAgICAgICAgdmFyIGEzMSA9IHRoaXMuYTMxOwoJICAgICAgICB2YXIgYTMyID0gdGhpcy5hMzI7CgkgICAgICAgIHZhciBhMzMgPSB0aGlzLmEzMzsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXg7IGkgKz0gMikgewoJICAgICAgICAgICAgdmFyIHggPSBwb2ludHNbaV07CgkgICAgICAgICAgICB2YXIgeSA9IHBvaW50c1tpICsgMV07CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3IgPSBhMTMgKiB4ICsgYTIzICogeSArIGEzMzsKCSAgICAgICAgICAgIHBvaW50c1tpXSA9IChhMTEgKiB4ICsgYTIxICogeSArIGEzMSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHBvaW50c1tpICsgMV0gPSAoYTEyICogeCArIGEyMiAqIHkgKyBhMzIpIC8gZGVub21pbmF0b3I7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnByb3RvdHlwZS50cmFuc2Zvcm1Qb2ludHNXaXRoVmFsdWVzID0gZnVuY3Rpb24gKHhWYWx1ZXMsIHlWYWx1ZXMpIHsKCSAgICAgICAgdmFyIGExMSA9IHRoaXMuYTExOwoJICAgICAgICB2YXIgYTEyID0gdGhpcy5hMTI7CgkgICAgICAgIHZhciBhMTMgPSB0aGlzLmExMzsKCSAgICAgICAgdmFyIGEyMSA9IHRoaXMuYTIxOwoJICAgICAgICB2YXIgYTIyID0gdGhpcy5hMjI7CgkgICAgICAgIHZhciBhMjMgPSB0aGlzLmEyMzsKCSAgICAgICAgdmFyIGEzMSA9IHRoaXMuYTMxOwoJICAgICAgICB2YXIgYTMyID0gdGhpcy5hMzI7CgkgICAgICAgIHZhciBhMzMgPSB0aGlzLmEzMzsKCSAgICAgICAgdmFyIG4gPSB4VmFsdWVzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHsKCSAgICAgICAgICAgIHZhciB4ID0geFZhbHVlc1tpXTsKCSAgICAgICAgICAgIHZhciB5ID0geVZhbHVlc1tpXTsKCSAgICAgICAgICAgIHZhciBkZW5vbWluYXRvciA9IGExMyAqIHggKyBhMjMgKiB5ICsgYTMzOwoJICAgICAgICAgICAgeFZhbHVlc1tpXSA9IChhMTEgKiB4ICsgYTIxICogeSArIGEzMSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHlWYWx1ZXNbaV0gPSAoYTEyICogeCArIGEyMiAqIHkgKyBhMzIpIC8gZGVub21pbmF0b3I7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnNxdWFyZVRvUXVhZHJpbGF0ZXJhbCA9IGZ1bmN0aW9uICh4MCAvKmZsb2F0Ki8sIHkwIC8qZmxvYXQqLywgeDEgLypmbG9hdCovLCB5MSAvKmZsb2F0Ki8sIHgyIC8qZmxvYXQqLywgeTIgLypmbG9hdCovLCB4MyAvKmZsb2F0Ki8sIHkzIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgZHgzID0geDAgLSB4MSArIHgyIC0geDM7CgkgICAgICAgIHZhciBkeTMgPSB5MCAtIHkxICsgeTIgLSB5MzsKCSAgICAgICAgaWYgKGR4MyA9PT0gMC4wICYmIGR5MyA9PT0gMC4wKSB7CgkgICAgICAgICAgICAvLyBBZmZpbmUKCSAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc3BlY3RpdmVUcmFuc2Zvcm0oeDEgLSB4MCwgeDIgLSB4MSwgeDAsIHkxIC0geTAsIHkyIC0geTEsIHkwLCAwLjAsIDAuMCwgMS4wKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHZhciBkeDEgPSB4MSAtIHgyOwoJICAgICAgICAgICAgdmFyIGR4MiA9IHgzIC0geDI7CgkgICAgICAgICAgICB2YXIgZHkxID0geTEgLSB5MjsKCSAgICAgICAgICAgIHZhciBkeTIgPSB5MyAtIHkyOwoJICAgICAgICAgICAgdmFyIGRlbm9taW5hdG9yID0gZHgxICogZHkyIC0gZHgyICogZHkxOwoJICAgICAgICAgICAgdmFyIGExMyA9IChkeDMgKiBkeTIgLSBkeDIgKiBkeTMpIC8gZGVub21pbmF0b3I7CgkgICAgICAgICAgICB2YXIgYTIzID0gKGR4MSAqIGR5MyAtIGR4MyAqIGR5MSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc3BlY3RpdmVUcmFuc2Zvcm0oeDEgLSB4MCArIGExMyAqIHgxLCB4MyAtIHgwICsgYTIzICogeDMsIHgwLCB5MSAtIHkwICsgYTEzICogeTEsIHkzIC0geTAgKyBhMjMgKiB5MywgeTAsIGExMywgYTIzLCAxLjApOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5xdWFkcmlsYXRlcmFsVG9TcXVhcmUgPSBmdW5jdGlvbiAoeDAgLypmbG9hdCovLCB5MCAvKmZsb2F0Ki8sIHgxIC8qZmxvYXQqLywgeTEgLypmbG9hdCovLCB4MiAvKmZsb2F0Ki8sIHkyIC8qZmxvYXQqLywgeDMgLypmbG9hdCovLCB5MyAvKmZsb2F0Ki8pIHsKCSAgICAgICAgLy8gSGVyZSwgdGhlIGFkam9pbnQgc2VydmVzIGFzIHRoZSBpbnZlcnNlOgoJICAgICAgICByZXR1cm4gUGVyc3BlY3RpdmVUcmFuc2Zvcm0uc3F1YXJlVG9RdWFkcmlsYXRlcmFsKHgwLCB5MCwgeDEsIHkxLCB4MiwgeTIsIHgzLCB5MykuYnVpbGRBZGpvaW50KCk7CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5wcm90b3R5cGUuYnVpbGRBZGpvaW50ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBBZGpvaW50IGlzIHRoZSB0cmFuc3Bvc2Ugb2YgdGhlIGNvZmFjdG9yIG1hdHJpeDoKCSAgICAgICAgcmV0dXJuIG5ldyBQZXJzcGVjdGl2ZVRyYW5zZm9ybSh0aGlzLmEyMiAqIHRoaXMuYTMzIC0gdGhpcy5hMjMgKiB0aGlzLmEzMiwgdGhpcy5hMjMgKiB0aGlzLmEzMSAtIHRoaXMuYTIxICogdGhpcy5hMzMsIHRoaXMuYTIxICogdGhpcy5hMzIgLSB0aGlzLmEyMiAqIHRoaXMuYTMxLCB0aGlzLmExMyAqIHRoaXMuYTMyIC0gdGhpcy5hMTIgKiB0aGlzLmEzMywgdGhpcy5hMTEgKiB0aGlzLmEzMyAtIHRoaXMuYTEzICogdGhpcy5hMzEsIHRoaXMuYTEyICogdGhpcy5hMzEgLSB0aGlzLmExMSAqIHRoaXMuYTMyLCB0aGlzLmExMiAqIHRoaXMuYTIzIC0gdGhpcy5hMTMgKiB0aGlzLmEyMiwgdGhpcy5hMTMgKiB0aGlzLmEyMSAtIHRoaXMuYTExICogdGhpcy5hMjMsIHRoaXMuYTExICogdGhpcy5hMjIgLSB0aGlzLmExMiAqIHRoaXMuYTIxKTsKCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnByb3RvdHlwZS50aW1lcyA9IGZ1bmN0aW9uIChvdGhlcikgewoJICAgICAgICByZXR1cm4gbmV3IFBlcnNwZWN0aXZlVHJhbnNmb3JtKHRoaXMuYTExICogb3RoZXIuYTExICsgdGhpcy5hMjEgKiBvdGhlci5hMTIgKyB0aGlzLmEzMSAqIG90aGVyLmExMywgdGhpcy5hMTEgKiBvdGhlci5hMjEgKyB0aGlzLmEyMSAqIG90aGVyLmEyMiArIHRoaXMuYTMxICogb3RoZXIuYTIzLCB0aGlzLmExMSAqIG90aGVyLmEzMSArIHRoaXMuYTIxICogb3RoZXIuYTMyICsgdGhpcy5hMzEgKiBvdGhlci5hMzMsIHRoaXMuYTEyICogb3RoZXIuYTExICsgdGhpcy5hMjIgKiBvdGhlci5hMTIgKyB0aGlzLmEzMiAqIG90aGVyLmExMywgdGhpcy5hMTIgKiBvdGhlci5hMjEgKyB0aGlzLmEyMiAqIG90aGVyLmEyMiArIHRoaXMuYTMyICogb3RoZXIuYTIzLCB0aGlzLmExMiAqIG90aGVyLmEzMSArIHRoaXMuYTIyICogb3RoZXIuYTMyICsgdGhpcy5hMzIgKiBvdGhlci5hMzMsIHRoaXMuYTEzICogb3RoZXIuYTExICsgdGhpcy5hMjMgKiBvdGhlci5hMTIgKyB0aGlzLmEzMyAqIG90aGVyLmExMywgdGhpcy5hMTMgKiBvdGhlci5hMjEgKyB0aGlzLmEyMyAqIG90aGVyLmEyMiArIHRoaXMuYTMzICogb3RoZXIuYTIzLCB0aGlzLmExMyAqIG90aGVyLmEzMSArIHRoaXMuYTIzICogb3RoZXIuYTMyICsgdGhpcy5hMzMgKiBvdGhlci5hMzMpOwoJICAgIH07CgkgICAgcmV0dXJuIFBlcnNwZWN0aXZlVHJhbnNmb3JtOwoJfSgpKTsKCVBlcnNwZWN0aXZlVHJhbnNmb3JtJDEuZGVmYXVsdCA9IFBlcnNwZWN0aXZlVHJhbnNmb3JtOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDIgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGVmYXVsdEdyaWRTYW1wbGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJdmFyIEdyaWRTYW1wbGVyXzEgPSBHcmlkU2FtcGxlciQxOwoJdmFyIEJpdE1hdHJpeF8xJDEgPSBCaXRNYXRyaXgkMTsKCXZhciBQZXJzcGVjdGl2ZVRyYW5zZm9ybV8xJDEgPSBQZXJzcGVjdGl2ZVRyYW5zZm9ybSQxOwoJdmFyIE5vdEZvdW5kRXhjZXB0aW9uXzEkNCA9IE5vdEZvdW5kRXhjZXB0aW9uJDE7CgkvKioKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBEZWZhdWx0R3JpZFNhbXBsZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDIoRGVmYXVsdEdyaWRTYW1wbGVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIERlZmF1bHRHcmlkU2FtcGxlcigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICAvKkBPdmVycmlkZSovCgkgICAgRGVmYXVsdEdyaWRTYW1wbGVyLnByb3RvdHlwZS5zYW1wbGVHcmlkID0gZnVuY3Rpb24gKGltYWdlLCBkaW1lbnNpb25YIC8qaW50Ki8sIGRpbWVuc2lvblkgLyppbnQqLywgcDFUb1ggLypmbG9hdCovLCBwMVRvWSAvKmZsb2F0Ki8sIHAyVG9YIC8qZmxvYXQqLywgcDJUb1kgLypmbG9hdCovLCBwM1RvWCAvKmZsb2F0Ki8sIHAzVG9ZIC8qZmxvYXQqLywgcDRUb1ggLypmbG9hdCovLCBwNFRvWSAvKmZsb2F0Ki8sIHAxRnJvbVggLypmbG9hdCovLCBwMUZyb21ZIC8qZmxvYXQqLywgcDJGcm9tWCAvKmZsb2F0Ki8sIHAyRnJvbVkgLypmbG9hdCovLCBwM0Zyb21YIC8qZmxvYXQqLywgcDNGcm9tWSAvKmZsb2F0Ki8sIHA0RnJvbVggLypmbG9hdCovLCBwNEZyb21ZIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgdHJhbnNmb3JtID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm1fMSQxLmRlZmF1bHQucXVhZHJpbGF0ZXJhbFRvUXVhZHJpbGF0ZXJhbChwMVRvWCwgcDFUb1ksIHAyVG9YLCBwMlRvWSwgcDNUb1gsIHAzVG9ZLCBwNFRvWCwgcDRUb1ksIHAxRnJvbVgsIHAxRnJvbVksIHAyRnJvbVgsIHAyRnJvbVksIHAzRnJvbVgsIHAzRnJvbVksIHA0RnJvbVgsIHA0RnJvbVkpOwoJICAgICAgICByZXR1cm4gdGhpcy5zYW1wbGVHcmlkV2l0aFRyYW5zZm9ybShpbWFnZSwgZGltZW5zaW9uWCwgZGltZW5zaW9uWSwgdHJhbnNmb3JtKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBEZWZhdWx0R3JpZFNhbXBsZXIucHJvdG90eXBlLnNhbXBsZUdyaWRXaXRoVHJhbnNmb3JtID0gZnVuY3Rpb24gKGltYWdlLCBkaW1lbnNpb25YIC8qaW50Ki8sIGRpbWVuc2lvblkgLyppbnQqLywgdHJhbnNmb3JtKSB7CgkgICAgICAgIGlmIChkaW1lbnNpb25YIDw9IDAgfHwgZGltZW5zaW9uWSA8PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRNYXRyaXhfMSQxLmRlZmF1bHQoZGltZW5zaW9uWCwgZGltZW5zaW9uWSk7CgkgICAgICAgIHZhciBwb2ludHMgPSBuZXcgRmxvYXQzMkFycmF5KDIgKiBkaW1lbnNpb25YKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBkaW1lbnNpb25ZOyB5KyspIHsKCSAgICAgICAgICAgIHZhciBtYXggPSBwb2ludHMubGVuZ3RoOwoJICAgICAgICAgICAgdmFyIGlWYWx1ZSA9IHkgKyAwLjU7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1heDsgeCArPSAyKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW3hdID0gKHggLyAyKSArIDAuNTsKCSAgICAgICAgICAgICAgICBwb2ludHNbeCArIDFdID0gaVZhbHVlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdHJhbnNmb3JtLnRyYW5zZm9ybVBvaW50cyhwb2ludHMpOwoJICAgICAgICAgICAgLy8gUXVpY2sgY2hlY2sgdG8gc2VlIGlmIHBvaW50cyB0cmFuc2Zvcm1lZCB0byBzb21ldGhpbmcgaW5zaWRlIHRoZSBpbWFnZQoJICAgICAgICAgICAgLy8gc3VmZmljaWVudCB0byBjaGVjayB0aGUgZW5kcG9pbnRzCgkgICAgICAgICAgICBHcmlkU2FtcGxlcl8xLmRlZmF1bHQuY2hlY2tBbmROdWRnZVBvaW50cyhpbWFnZSwgcG9pbnRzKTsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBtYXg7IHggKz0gMikgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaW1hZ2UuZ2V0KE1hdGguZmxvb3IocG9pbnRzW3hdKSwgTWF0aC5mbG9vcihwb2ludHNbeCArIDFdKSkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJsYWNrKC1pc2gpIHBpeGVsCgkgICAgICAgICAgICAgICAgICAgICAgICBiaXRzLnNldCh4IC8gMiwgeSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjYXRjaCAoYWlvb2JlIC8qOiBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24qLykgewoJICAgICAgICAgICAgICAgIC8vIFRoaXMgZmVlbHMgd3JvbmcsIGJ1dCwgc29tZXRpbWVzIGlmIHRoZSBmaW5kZXIgcGF0dGVybnMgYXJlIG1pc2lkZW50aWZpZWQsIHRoZSByZXN1bHRpbmcKCSAgICAgICAgICAgICAgICAvLyB0cmFuc2Zvcm0gZ2V0cyAidHdpc3RlZCIgc3VjaCB0aGF0IGl0IG1hcHMgYSBzdHJhaWdodCBsaW5lIG9mIHBvaW50cyB0byBhIHNldCBvZiBwb2ludHMKCSAgICAgICAgICAgICAgICAvLyB3aG9zZSBlbmRwb2ludHMgYXJlIGluIGJvdW5kcywgYnV0IG90aGVycyBhcmUgbm90LiBUaGVyZSBpcyBwcm9iYWJseSBzb21lIG1hdGhlbWF0aWNhbAoJICAgICAgICAgICAgICAgIC8vIHdheSB0byBkZXRlY3QgdGhpcyBhYm91dCB0aGUgdHJhbnNmb3JtYXRpb24gdGhhdCBJIGRvbid0IGtub3cgeWV0LgoJICAgICAgICAgICAgICAgIC8vIFRoaXMgcmVzdWx0cyBpbiBhbiB1Z2x5IHJ1bnRpbWUgZXhjZXB0aW9uIGRlc3BpdGUgb3VyIGNsZXZlciBjaGVja3MgYWJvdmUgLS0gY2FuJ3QgaGF2ZQoJICAgICAgICAgICAgICAgIC8vIHRoYXQuIFdlIGNvdWxkIGNoZWNrIGVhY2ggcG9pbnQncyBjb29yZGluYXRlcyBidXQgdGhhdCBmZWVscyBkdXBsaWNhdGl2ZS4gV2Ugc2V0dGxlIGZvcgoJICAgICAgICAgICAgICAgIC8vIGNhdGNoaW5nIGFuZCB3cmFwcGluZyBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24uCgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNC5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICByZXR1cm4gRGVmYXVsdEdyaWRTYW1wbGVyOwoJfShHcmlkU2FtcGxlcl8xLmRlZmF1bHQpKTsKCURlZmF1bHRHcmlkU2FtcGxlciQxLmRlZmF1bHQgPSBEZWZhdWx0R3JpZFNhbXBsZXI7CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEdyaWRTYW1wbGVySW5zdGFuY2UkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIERlZmF1bHRHcmlkU2FtcGxlcl8xID0gRGVmYXVsdEdyaWRTYW1wbGVyJDE7Cgl2YXIgR3JpZFNhbXBsZXJJbnN0YW5jZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBHcmlkU2FtcGxlckluc3RhbmNlKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiBTZXRzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiBHcmlkU2FtcGxlciB1c2VkIGJ5IHRoZSBsaWJyYXJ5LiBPbmUgZ2xvYmFsCgkgICAgICogaW5zdGFuY2UgaXMgc3RvcmVkLCB3aGljaCBtYXkgc291bmQgcHJvYmxlbWF0aWMuIEJ1dCwgdGhlIGltcGxlbWVudGF0aW9uIHByb3ZpZGVkCgkgICAgICogb3VnaHQgdG8gYmUgYXBwcm9wcmlhdGUgZm9yIHRoZSBlbnRpcmUgcGxhdGZvcm0sIGFuZCBhbGwgdXNlcyBvZiB0aGlzIGxpYnJhcnkKCSAgICAgKiBpbiB0aGUgd2hvbGUgbGlmZXRpbWUgb2YgdGhlIEpWTS4gRm9yIGluc3RhbmNlLCBhbiBBbmRyb2lkIGFjdGl2aXR5IGNhbiBzd2FwIGluCgkgICAgICogYW4gaW1wbGVtZW50YXRpb24gdGhhdCB0YWtlcyBhZHZhbnRhZ2Ugb2YgbmF0aXZlIHBsYXRmb3JtIGxpYnJhcmllcy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBuZXdHcmlkU2FtcGxlciBUaGUgcGxhdGZvcm0tc3BlY2lmaWMgb2JqZWN0IHRvIGluc3RhbGwuCgkgICAgICovCgkgICAgR3JpZFNhbXBsZXJJbnN0YW5jZS5zZXRHcmlkU2FtcGxlciA9IGZ1bmN0aW9uIChuZXdHcmlkU2FtcGxlcikgewoJICAgICAgICBHcmlkU2FtcGxlckluc3RhbmNlLmdyaWRTYW1wbGVyID0gbmV3R3JpZFNhbXBsZXI7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHRoZSBjdXJyZW50IGltcGxlbWVudGF0aW9uIG9mIEdyaWRTYW1wbGVyCgkgICAgICovCgkgICAgR3JpZFNhbXBsZXJJbnN0YW5jZS5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIEdyaWRTYW1wbGVySW5zdGFuY2UuZ3JpZFNhbXBsZXI7CgkgICAgfTsKCSAgICBHcmlkU2FtcGxlckluc3RhbmNlLmdyaWRTYW1wbGVyID0gbmV3IERlZmF1bHRHcmlkU2FtcGxlcl8xLmRlZmF1bHQoKTsKCSAgICByZXR1cm4gR3JpZFNhbXBsZXJJbnN0YW5jZTsKCX0oKSk7CglHcmlkU2FtcGxlckluc3RhbmNlJDEuZGVmYXVsdCA9IEdyaWRTYW1wbGVySW5zdGFuY2U7CgoJdmFyIFJlc3VsdFBvaW50JDEgPSB7fTsKCgl2YXIgRmxvYXQkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShGbG9hdCQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKioKCSAqIFBvbnlmaWxsIGZvciBKYXZhJ3MgRmxvYXQgY2xhc3MuCgkgKi8KCXZhciBGbG9hdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBGbG9hdCgpIHsKCSAgICB9CgkgICAgLyoqCgkgICAgICogU2luY1RTIGhhcyBubyBkaWZmZXJlbmNlIGJldHdlZW4gaW50IGFuZCBmbG9hdCwgdGhlcmUncyBhbGwgbnVtYmVycywKCSAgICAgKiB0aGlzIGlzIHVzZWQgb25seSB0byBwb2x5ZmlsbCBKYXZhIGNvZGUuCgkgICAgICovCgkgICAgRmxvYXQuZmxvYXRUb0ludEJpdHMgPSBmdW5jdGlvbiAoZikgewoJICAgICAgICByZXR1cm4gZjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFRoZSBmbG9hdCBtYXggdmFsdWUgaW4gSlMgaXMgdGhlIG51bWJlciBtYXggdmFsdWUuCgkgICAgICovCgkgICAgRmxvYXQuTUFYX1ZBTFVFID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgcmV0dXJuIEZsb2F0OwoJfSgpKTsKCUZsb2F0JDEuZGVmYXVsdCA9IEZsb2F0OwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVzdWx0UG9pbnQkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCXZhciBNYXRoVXRpbHNfMSQxID0gTWF0aFV0aWxzJDE7Cgl2YXIgRmxvYXRfMSA9IEZsb2F0JDE7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIHBvaW50IG9mIGludGVyZXN0IGluIGFuIGltYWdlIGNvbnRhaW5pbmcgYSBiYXJjb2RlLiBUeXBpY2FsbHksIHRoaXMKCSAqIHdvdWxkIGJlIHRoZSBsb2NhdGlvbiBvZiBhIGZpbmRlciBwYXR0ZXJuIG9yIHRoZSBjb3JuZXIgb2YgdGhlIGJhcmNvZGUsIGZvciBleGFtcGxlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUmVzdWx0UG9pbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUmVzdWx0UG9pbnQoeCwgeSkgewoJICAgICAgICB0aGlzLnggPSB4OwoJICAgICAgICB0aGlzLnkgPSB5OwoJICAgIH0KCSAgICBSZXN1bHRQb2ludC5wcm90b3R5cGUuZ2V0WCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMueDsKCSAgICB9OwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5nZXRZID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy55OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2YgUmVzdWx0UG9pbnQpIHsKCSAgICAgICAgICAgIHZhciBvdGhlclBvaW50ID0gb3RoZXI7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy54ID09PSBvdGhlclBvaW50LnggJiYgdGhpcy55ID09PSBvdGhlclBvaW50Lnk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDMxICogRmxvYXRfMS5kZWZhdWx0LmZsb2F0VG9JbnRCaXRzKHRoaXMueCkgKyBGbG9hdF8xLmRlZmF1bHQuZmxvYXRUb0ludEJpdHModGhpcy55KTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBSZXN1bHRQb2ludC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiAnKCcgKyB0aGlzLnggKyAnLCcgKyB0aGlzLnkgKyAnKSc7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBPcmRlcnMgYW4gYXJyYXkgb2YgdGhyZWUgUmVzdWx0UG9pbnRzIGluIGFuIG9yZGVyIFtBLEIsQ10gc3VjaCB0aGF0IEFCIGlzIGxlc3MgdGhhbiBBQwoJICAgICAqIGFuZCBCQyBpcyBsZXNzIHRoYW4gQUMsIGFuZCB0aGUgYW5nbGUgYmV0d2VlbiBCQyBhbmQgQkEgaXMgbGVzcyB0aGFuIDE4MCBkZWdyZWVzLgoJICAgICAqCgkgICAgICogQHBhcmFtIHBhdHRlcm5zIGFycmF5IG9mIHRocmVlIHtAY29kZSBSZXN1bHRQb2ludH0gdG8gb3JkZXIKCSAgICAgKi8KCSAgICBSZXN1bHRQb2ludC5vcmRlckJlc3RQYXR0ZXJucyA9IGZ1bmN0aW9uIChwYXR0ZXJucykgewoJICAgICAgICAvLyBGaW5kIGRpc3RhbmNlcyBiZXR3ZWVuIHBhdHRlcm4gY2VudGVycwoJICAgICAgICB2YXIgemVyb09uZURpc3RhbmNlID0gdGhpcy5kaXN0YW5jZShwYXR0ZXJuc1swXSwgcGF0dGVybnNbMV0pOwoJICAgICAgICB2YXIgb25lVHdvRGlzdGFuY2UgPSB0aGlzLmRpc3RhbmNlKHBhdHRlcm5zWzFdLCBwYXR0ZXJuc1syXSk7CgkgICAgICAgIHZhciB6ZXJvVHdvRGlzdGFuY2UgPSB0aGlzLmRpc3RhbmNlKHBhdHRlcm5zWzBdLCBwYXR0ZXJuc1syXSk7CgkgICAgICAgIHZhciBwb2ludEE7CgkgICAgICAgIHZhciBwb2ludEI7CgkgICAgICAgIHZhciBwb2ludEM7CgkgICAgICAgIC8vIEFzc3VtZSBvbmUgY2xvc2VzdCB0byBvdGhlciB0d28gaXMgQjsgQSBhbmQgQyB3aWxsIGp1c3QgYmUgZ3Vlc3NlcyBhdCBmaXJzdAoJICAgICAgICBpZiAob25lVHdvRGlzdGFuY2UgPj0gemVyb09uZURpc3RhbmNlICYmIG9uZVR3b0Rpc3RhbmNlID49IHplcm9Ud29EaXN0YW5jZSkgewoJICAgICAgICAgICAgcG9pbnRCID0gcGF0dGVybnNbMF07CgkgICAgICAgICAgICBwb2ludEEgPSBwYXR0ZXJuc1sxXTsKCSAgICAgICAgICAgIHBvaW50QyA9IHBhdHRlcm5zWzJdOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgaWYgKHplcm9Ud29EaXN0YW5jZSA+PSBvbmVUd29EaXN0YW5jZSAmJiB6ZXJvVHdvRGlzdGFuY2UgPj0gemVyb09uZURpc3RhbmNlKSB7CgkgICAgICAgICAgICBwb2ludEIgPSBwYXR0ZXJuc1sxXTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBhdHRlcm5zWzBdOwoJICAgICAgICAgICAgcG9pbnRDID0gcGF0dGVybnNbMl07CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICBwb2ludEIgPSBwYXR0ZXJuc1syXTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBhdHRlcm5zWzBdOwoJICAgICAgICAgICAgcG9pbnRDID0gcGF0dGVybnNbMV07CgkgICAgICAgIH0KCSAgICAgICAgLy8gVXNlIGNyb3NzIHByb2R1Y3QgdG8gZmlndXJlIG91dCB3aGV0aGVyIEEgYW5kIEMgYXJlIGNvcnJlY3Qgb3IgZmxpcHBlZC4KCSAgICAgICAgLy8gVGhpcyBhc2tzIHdoZXRoZXIgQkMgeCBCQSBoYXMgYSBwb3NpdGl2ZSB6IGNvbXBvbmVudCwgd2hpY2ggaXMgdGhlIGFycmFuZ2VtZW50CgkgICAgICAgIC8vIHdlIHdhbnQgZm9yIEEsIEIsIEMuIElmIGl0J3MgbmVnYXRpdmUsIHRoZW4gd2UndmUgZ290IGl0IGZsaXBwZWQgYXJvdW5kIGFuZAoJICAgICAgICAvLyBzaG91bGQgc3dhcCBBIGFuZCBDLgoJICAgICAgICBpZiAodGhpcy5jcm9zc1Byb2R1Y3RaKHBvaW50QSwgcG9pbnRCLCBwb2ludEMpIDwgMC4wKSB7CgkgICAgICAgICAgICB2YXIgdGVtcCA9IHBvaW50QTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBvaW50QzsKCSAgICAgICAgICAgIHBvaW50QyA9IHRlbXA7CgkgICAgICAgIH0KCSAgICAgICAgcGF0dGVybnNbMF0gPSBwb2ludEE7CgkgICAgICAgIHBhdHRlcm5zWzFdID0gcG9pbnRCOwoJICAgICAgICBwYXR0ZXJuc1syXSA9IHBvaW50QzsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBwYXR0ZXJuMSBmaXJzdCBwYXR0ZXJuCgkgICAgICogQHBhcmFtIHBhdHRlcm4yIHNlY29uZCBwYXR0ZXJuCgkgICAgICogQHJldHVybiBkaXN0YW5jZSBiZXR3ZWVuIHR3byBwb2ludHMKCSAgICAgKi8KCSAgICBSZXN1bHRQb2ludC5kaXN0YW5jZSA9IGZ1bmN0aW9uIChwYXR0ZXJuMSwgcGF0dGVybjIpIHsKCSAgICAgICAgcmV0dXJuIE1hdGhVdGlsc18xJDEuZGVmYXVsdC5kaXN0YW5jZShwYXR0ZXJuMS54LCBwYXR0ZXJuMS55LCBwYXR0ZXJuMi54LCBwYXR0ZXJuMi55KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIHogY29tcG9uZW50IG9mIHRoZSBjcm9zcyBwcm9kdWN0IGJldHdlZW4gdmVjdG9ycyBCQyBhbmQgQkEuCgkgICAgICovCgkgICAgUmVzdWx0UG9pbnQuY3Jvc3NQcm9kdWN0WiA9IGZ1bmN0aW9uIChwb2ludEEsIHBvaW50QiwgcG9pbnRDKSB7CgkgICAgICAgIHZhciBiWCA9IHBvaW50Qi54OwoJICAgICAgICB2YXIgYlkgPSBwb2ludEIueTsKCSAgICAgICAgcmV0dXJuICgocG9pbnRDLnggLSBiWCkgKiAocG9pbnRBLnkgLSBiWSkpIC0gKChwb2ludEMueSAtIGJZKSAqIChwb2ludEEueCAtIGJYKSk7CgkgICAgfTsKCSAgICByZXR1cm4gUmVzdWx0UG9pbnQ7Cgl9KCkpOwoJUmVzdWx0UG9pbnQkMS5kZWZhdWx0ID0gUmVzdWx0UG9pbnQ7CgoJdmFyIEFsaWdubWVudFBhdHRlcm5GaW5kZXIkMSA9IHt9OwoKCXZhciBBbGlnbm1lbnRQYXR0ZXJuJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fZXh0ZW5kcyQxID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFsaWdubWVudFBhdHRlcm4kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGV0ZWN0b3IgeyovCgl2YXIgUmVzdWx0UG9pbnRfMSQzID0gUmVzdWx0UG9pbnQkMTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGFuIGFsaWdubWVudCBwYXR0ZXJuLCB3aGljaCBhcmUgdGhlIHNtYWxsZXIgc3F1YXJlIHBhdHRlcm5zIGZvdW5kIGluCgkgKiBhbGwgYnV0IHRoZSBzaW1wbGVzdCBRUiBDb2Rlcy48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEFsaWdubWVudFBhdHRlcm4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDEoQWxpZ25tZW50UGF0dGVybiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBBbGlnbm1lbnRQYXR0ZXJuKHBvc1ggLypmbG9hdCovLCBwb3NZIC8qZmxvYXQqLywgZXN0aW1hdGVkTW9kdWxlU2l6ZSAvKmZsb2F0Ki8pIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcG9zWCwgcG9zWSkgfHwgdGhpczsKCSAgICAgICAgX3RoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IGVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZXJtaW5lcyBpZiB0aGlzIGFsaWdubWVudCBwYXR0ZXJuICJhYm91dCBlcXVhbHMiIGFuIGFsaWdubWVudCBwYXR0ZXJuIGF0IHRoZSBzdGF0ZWQKCSAgICAgKiBwb3NpdGlvbiBhbmQgc2l6ZSAtLSBtZWFuaW5nLCBpdCBpcyBhdCBuZWFybHkgdGhlIHNhbWUgY2VudGVyIHdpdGggbmVhcmx5IHRoZSBzYW1lIHNpemUuPC9wPgoJICAgICAqLwoJICAgIEFsaWdubWVudFBhdHRlcm4ucHJvdG90eXBlLmFib3V0RXF1YWxzID0gZnVuY3Rpb24gKG1vZHVsZVNpemUgLypmbG9hdCovLCBpIC8qZmxvYXQqLywgaiAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE1hdGguYWJzKGkgLSB0aGlzLmdldFkoKSkgPD0gbW9kdWxlU2l6ZSAmJiBNYXRoLmFicyhqIC0gdGhpcy5nZXRYKCkpIDw9IG1vZHVsZVNpemUpIHsKCSAgICAgICAgICAgIHZhciBtb2R1bGVTaXplRGlmZiA9IE1hdGguYWJzKG1vZHVsZVNpemUgLSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVNpemVEaWZmIDw9IDEuMCB8fCBtb2R1bGVTaXplRGlmZiA8PSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29tYmluZXMgdGhpcyBvYmplY3QncyBjdXJyZW50IGVzdGltYXRlIG9mIGEgZmluZGVyIHBhdHRlcm4gcG9zaXRpb24gYW5kIG1vZHVsZSBzaXplCgkgICAgICogd2l0aCBhIG5ldyBlc3RpbWF0ZS4gSXQgcmV0dXJucyBhIG5ldyB7QGNvZGUgRmluZGVyUGF0dGVybn0gY29udGFpbmluZyBhbiBhdmVyYWdlIG9mIHRoZSB0d28uCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybi5wcm90b3R5cGUuY29tYmluZUVzdGltYXRlID0gZnVuY3Rpb24gKGkgLypmbG9hdCovLCBqIC8qZmxvYXQqLywgbmV3TW9kdWxlU2l6ZSAvKmZsb2F0Ki8pIHsKCSAgICAgICAgdmFyIGNvbWJpbmVkWCA9ICh0aGlzLmdldFgoKSArIGopIC8gMi4wOwoJICAgICAgICB2YXIgY29tYmluZWRZID0gKHRoaXMuZ2V0WSgpICsgaSkgLyAyLjA7CgkgICAgICAgIHZhciBjb21iaW5lZE1vZHVsZVNpemUgPSAodGhpcy5lc3RpbWF0ZWRNb2R1bGVTaXplICsgbmV3TW9kdWxlU2l6ZSkgLyAyLjA7CgkgICAgICAgIHJldHVybiBuZXcgQWxpZ25tZW50UGF0dGVybihjb21iaW5lZFgsIGNvbWJpbmVkWSwgY29tYmluZWRNb2R1bGVTaXplKTsKCSAgICB9OwoJICAgIHJldHVybiBBbGlnbm1lbnRQYXR0ZXJuOwoJfShSZXN1bHRQb2ludF8xJDMuZGVmYXVsdCkpOwoJQWxpZ25tZW50UGF0dGVybiQxLmRlZmF1bHQgPSBBbGlnbm1lbnRQYXR0ZXJuOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX192YWx1ZXMkMSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX3ZhbHVlcykgfHwgZnVuY3Rpb24obykgewoJICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwOwoJICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pOwoJICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHJldHVybiB7CgkgICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7CgkgICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/ICJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLiIgOiAiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpOwoJfTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShBbGlnbm1lbnRQYXR0ZXJuRmluZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBBbGlnbm1lbnRQYXR0ZXJuXzEgPSBBbGlnbm1lbnRQYXR0ZXJuJDE7Cgl2YXIgTm90Rm91bmRFeGNlcHRpb25fMSQzID0gTm90Rm91bmRFeGNlcHRpb24kMTsKCS8qaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgYXR0ZW1wdHMgdG8gZmluZCBhbGlnbm1lbnQgcGF0dGVybnMgaW4gYSBRUiBDb2RlLiBBbGlnbm1lbnQgcGF0dGVybnMgbG9vayBsaWtlIGZpbmRlcgoJICogcGF0dGVybnMgYnV0IGFyZSBzbWFsbGVyIGFuZCBhcHBlYXIgYXQgcmVndWxhciBpbnRlcnZhbHMgdGhyb3VnaG91dCB0aGUgaW1hZ2UuPC9wPgoJICoKCSAqIDxwPkF0IHRoZSBtb21lbnQgdGhpcyBvbmx5IGxvb2tzIGZvciB0aGUgYm90dG9tLXJpZ2h0IGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAqCgkgKiA8cD5UaGlzIGlzIG1vc3RseSBhIHNpbXBsaWZpZWQgY29weSBvZiB7QGxpbmsgRmluZGVyUGF0dGVybkZpbmRlcn0uIEl0IGlzIGNvcGllZCwKCSAqIHBhc3RlZCBhbmQgc3RyaXBwZWQgZG93biBoZXJlIGZvciBtYXhpbXVtIHBlcmZvcm1hbmNlIGJ1dCBkb2VzIHVuZm9ydHVuYXRlbHkgZHVwbGljYXRlCgkgKiBzb21lIGNvZGUuPC9wPgoJICoKCSAqIDxwPlRoaXMgY2xhc3MgaXMgdGhyZWFkLXNhZmUgYnV0IG5vdCByZWVudHJhbnQuIEVhY2ggdGhyZWFkIG11c3QgYWxsb2NhdGUgaXRzIG93biBvYmplY3QuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8qKgoJICAgICAqIDxwPkNyZWF0ZXMgYSBmaW5kZXIgdGhhdCB3aWxsIGxvb2sgaW4gYSBwb3J0aW9uIG9mIHRoZSB3aG9sZSBpbWFnZS48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0gaW1hZ2UgaW1hZ2UgdG8gc2VhcmNoCgkgICAgICogQHBhcmFtIHN0YXJ0WCBsZWZ0IGNvbHVtbiBmcm9tIHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZwoJICAgICAqIEBwYXJhbSBzdGFydFkgdG9wIHJvdyBmcm9tIHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZwoJICAgICAqIEBwYXJhbSB3aWR0aCB3aWR0aCBvZiByZWdpb24gdG8gc2VhcmNoCgkgICAgICogQHBhcmFtIGhlaWdodCBoZWlnaHQgb2YgcmVnaW9uIHRvIHNlYXJjaAoJICAgICAqIEBwYXJhbSBtb2R1bGVTaXplIGVzdGltYXRlZCBtb2R1bGUgc2l6ZSBzbyBmYXIKCSAgICAgKi8KCSAgICBmdW5jdGlvbiBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyKGltYWdlLCBzdGFydFggLyppbnQqLywgc3RhcnRZIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovLCBtb2R1bGVTaXplIC8qZmxvYXQqLywgcmVzdWx0UG9pbnRDYWxsYmFjaykgewoJICAgICAgICB0aGlzLmltYWdlID0gaW1hZ2U7CgkgICAgICAgIHRoaXMuc3RhcnRYID0gc3RhcnRYOwoJICAgICAgICB0aGlzLnN0YXJ0WSA9IHN0YXJ0WTsKCSAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoOwoJICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDsKCSAgICAgICAgdGhpcy5tb2R1bGVTaXplID0gbW9kdWxlU2l6ZTsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gcmVzdWx0UG9pbnRDYWxsYmFjazsKCSAgICAgICAgdGhpcy5wb3NzaWJsZUNlbnRlcnMgPSBbXTsgLy8gbmV3IEFycmF5PGFueT4oNSkpCgkgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiBhcnJheSBpbml0aWFsaXphdGlvbiB3aXRob3V0IHNpemUgYXMgdGhlIGxlbmd0aCBpcyBjaGVja2VkIGJlbG93CgkgICAgICAgIHRoaXMuY3Jvc3NDaGVja1N0YXRlQ291bnQgPSBuZXcgSW50MzJBcnJheSgzKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICogPHA+VGhpcyBtZXRob2QgYXR0ZW1wdHMgdG8gZmluZCB0aGUgYm90dG9tLXJpZ2h0IGFsaWdubWVudCBwYXR0ZXJuIGluIHRoZSBpbWFnZS4gSXQgaXMgYSBiaXQgbWVzc3kgc2luY2UKCSAgICAgKiBpdCdzIHByZXR0eSBwZXJmb3JtYW5jZS1jcml0aWNhbCBhbmQgc28gaXMgd3JpdHRlbiB0byBiZSBmYXN0IGZvcmVtb3N0LjwvcD4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEFsaWdubWVudFBhdHRlcm59IGlmIGZvdW5kCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBub3QgZm91bmQKCSAgICAgKi8KCSAgICBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgc3RhcnRYID0gdGhpcy5zdGFydFg7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmhlaWdodDsKCSAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aDsKCSAgICAgICAgdmFyIG1heEogPSBzdGFydFggKyB3aWR0aDsKCSAgICAgICAgdmFyIG1pZGRsZUkgPSB0aGlzLnN0YXJ0WSArIChoZWlnaHQgLyAyKTsKCSAgICAgICAgLy8gV2UgYXJlIGxvb2tpbmcgZm9yIGJsYWNrL3doaXRlL2JsYWNrIG1vZHVsZXMgaW4gMToxOjEgcmF0aW8KCSAgICAgICAgLy8gdGhpcyB0cmFja3MgdGhlIG51bWJlciBvZiBibGFjay93aGl0ZS9ibGFjayBtb2R1bGVzIHNlZW4gc28gZmFyCgkgICAgICAgIHZhciBzdGF0ZUNvdW50ID0gbmV3IEludDMyQXJyYXkoMyk7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIGZvciAodmFyIGlHZW4gPSAwOyBpR2VuIDwgaGVpZ2h0OyBpR2VuKyspIHsKCSAgICAgICAgICAgIC8vIFNlYXJjaCBmcm9tIG1pZGRsZSBvdXR3YXJkcwoJICAgICAgICAgICAgdmFyIGkgPSBtaWRkbGVJICsgKChpR2VuICYgMHgwMSkgPT09IDAgPyBNYXRoLmZsb29yKChpR2VuICsgMSkgLyAyKSA6IC1NYXRoLmZsb29yKChpR2VuICsgMSkgLyAyKSk7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMV0gPSAwOwoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IDA7CgkgICAgICAgICAgICB2YXIgaiA9IHN0YXJ0WDsKCSAgICAgICAgICAgIC8vIEJ1cm4gb2ZmIGxlYWRpbmcgd2hpdGUgcGl4ZWxzIGJlZm9yZSBhbnl0aGluZyBlbHNlOyBpZiB3ZSBzdGFydCBpbiB0aGUgbWlkZGxlIG9mCgkgICAgICAgICAgICAvLyBhIHdoaXRlIHJ1biwgaXQgZG9lc24ndCBtYWtlIHNlbnNlIHRvIGNvdW50IGl0cyBsZW5ndGgsIHNpbmNlIHdlIGRvbid0IGtub3cgaWYgdGhlCgkgICAgICAgICAgICAvLyB3aGl0ZSBydW4gY29udGludWVkIHRvIHRoZSBsZWZ0IG9mIHRoZSBzdGFydCBwb2ludAoJICAgICAgICAgICAgd2hpbGUgKGogPCBtYXhKICYmICFpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICBqKys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgY3VycmVudFN0YXRlID0gMDsKCSAgICAgICAgICAgIHdoaWxlIChqIDwgbWF4SikgewoJICAgICAgICAgICAgICAgIGlmIChpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gQmxhY2sgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gMSkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMV0rKzsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsgLy8gQ291bnRpbmcgd2hpdGUgcGl4ZWxzCgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFN0YXRlID09PSAyKSB7IC8vIEEgd2lubmVyPwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZvdW5kUGF0dGVybkNyb3NzKHN0YXRlQ291bnQpKSB7IC8vIFllcwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlybWVkID0gdGhpcy5oYW5kbGVQb3NzaWJsZUNlbnRlcihzdGF0ZUNvdW50LCBpLCBqKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCAhPT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpcm1lZDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gc3RhdGVDb3VudFsyXTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzFdID0gMTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzJdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsrK2N1cnJlbnRTdGF0ZV0rKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsgLy8gV2hpdGUgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gMSkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBqKys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAodGhpcy5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSkgewoJICAgICAgICAgICAgICAgIHZhciBjb25maXJtZWQgPSB0aGlzLmhhbmRsZVBvc3NpYmxlQ2VudGVyKHN0YXRlQ291bnQsIGksIG1heEopOwoJICAgICAgICAgICAgICAgIGlmIChjb25maXJtZWQgIT09IG51bGwpIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpcm1lZDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gSG1tLCBub3RoaW5nIHdlIHNhdyB3YXMgb2JzZXJ2ZWQgYW5kIGNvbmZpcm1lZCB0d2ljZS4gSWYgd2UgaGFkCgkgICAgICAgIC8vIGFueSBndWVzcyBhdCBhbGwsIHJldHVybiBpdC4KCSAgICAgICAgaWYgKHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aCAhPT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMucG9zc2libGVDZW50ZXJzWzBdOwoJICAgICAgICB9CgkgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbl8xJDMuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogR2l2ZW4gYSBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCBzZWVuIGFuZCBhbiBlbmQgcG9zaXRpb24sCgkgICAgICogZmlndXJlcyB0aGUgbG9jYXRpb24gb2YgdGhlIGNlbnRlciBvZiB0aGlzIGJsYWNrL3doaXRlL2JsYWNrIHJ1bi4KCSAgICAgKi8KCSAgICBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCwgZW5kIC8qaW50Ki8pIHsKCSAgICAgICAgcmV0dXJuIChlbmQgLSBzdGF0ZUNvdW50WzJdKSAtIHN0YXRlQ291bnRbMV0gLyAyLjA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gc3RhdGVDb3VudCBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCByZWFkCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGUgcHJvcG9ydGlvbnMgb2YgdGhlIGNvdW50cyBpcyBjbG9zZSBlbm91Z2ggdG8gdGhlIDEvMS8xIHJhdGlvcwoJICAgICAqICAgICAgICAgdXNlZCBieSBhbGlnbm1lbnQgcGF0dGVybnMgdG8gYmUgY29uc2lkZXJlZCBhIG1hdGNoCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybkZpbmRlci5wcm90b3R5cGUuZm91bmRQYXR0ZXJuQ3Jvc3MgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCkgewoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRoaXMubW9kdWxlU2l6ZTsKCSAgICAgICAgdmFyIG1heFZhcmlhbmNlID0gbW9kdWxlU2l6ZSAvIDIuMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAzOyBpKyspIHsKCSAgICAgICAgICAgIGlmIChNYXRoLmFicyhtb2R1bGVTaXplIC0gc3RhdGVDb3VudFtpXSkgPj0gbWF4VmFyaWFuY2UpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5BZnRlciBhIGhvcml6b250YWwgc2NhbiBmaW5kcyBhIHBvdGVudGlhbCBhbGlnbm1lbnQgcGF0dGVybiwgdGhpcyBtZXRob2QKCSAgICAgKiAiY3Jvc3MtY2hlY2tzIiBieSBzY2FubmluZyBkb3duIHZlcnRpY2FsbHkgdGhyb3VnaCB0aGUgY2VudGVyIG9mIHRoZSBwb3NzaWJsZQoJICAgICAqIGFsaWdubWVudCBwYXR0ZXJuIHRvIHNlZSBpZiB0aGUgc2FtZSBwcm9wb3J0aW9uIGlzIGRldGVjdGVkLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGFydEkgcm93IHdoZXJlIGFuIGFsaWdubWVudCBwYXR0ZXJuIHdhcyBkZXRlY3RlZAoJICAgICAqIEBwYXJhbSBjZW50ZXJKIGNlbnRlciBvZiB0aGUgc2VjdGlvbiB0aGF0IGFwcGVhcnMgdG8gY3Jvc3MgYW4gYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gbWF4Q291bnQgbWF4aW11bSByZWFzb25hYmxlIG51bWJlciBvZiBtb2R1bGVzIHRoYXQgc2hvdWxkIGJlCgkgICAgICogb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcmV0dXJuIHZlcnRpY2FsIGNlbnRlciBvZiBhbGlnbm1lbnQgcGF0dGVybiwgb3Ige0BsaW5rIEZsb2F0I05hTn0gaWYgbm90IGZvdW5kCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybkZpbmRlci5wcm90b3R5cGUuY3Jvc3NDaGVja1ZlcnRpY2FsID0gZnVuY3Rpb24gKHN0YXJ0SSAvKmludCovLCBjZW50ZXJKIC8qaW50Ki8sIG1heENvdW50IC8qaW50Ki8sIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZTsKCSAgICAgICAgdmFyIG1heEkgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgc3RhdGVDb3VudFsxXSA9IDA7CgkgICAgICAgIHN0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICAvLyBTdGFydCBjb3VudGluZyB1cCBmcm9tIGNlbnRlcgoJICAgICAgICB2YXIgaSA9IHN0YXJ0STsKCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIGFscmVhZHkgdG9vIG1hbnkgbW9kdWxlcyBpbiB0aGlzIHN0YXRlIG9yIHJhbiBvZmYgdGhlIGVkZ2U6CgkgICAgICAgIGlmIChpIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiAhaW1hZ2UuZ2V0KGNlbnRlckosIGkpICYmIHN0YXRlQ291bnRbMF0gPD0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMF0rKzsKCSAgICAgICAgICAgIGktLTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFswXSA+IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIC8vIE5vdyBhbHNvIGNvdW50IGRvd24gZnJvbSBjZW50ZXIKCSAgICAgICAgaSA9IHN0YXJ0SSArIDE7CgkgICAgICAgIHdoaWxlIChpIDwgbWF4SSAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJIHx8IHN0YXRlQ291bnRbMV0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaSA8IG1heEkgJiYgIWltYWdlLmdldChjZW50ZXJKLCBpKSAmJiBzdGF0ZUNvdW50WzJdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzJdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbMl0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdOwoJICAgICAgICBpZiAoNSAqIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA+PSAyICogb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkgPyBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQoc3RhdGVDb3VudCwgaSkgOiBOYU47CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5UaGlzIGlzIGNhbGxlZCB3aGVuIGEgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG9zc2libGUgYWxpZ25tZW50IHBhdHRlcm4uIEl0IHdpbGwKCSAgICAgKiBjcm9zcyBjaGVjayB3aXRoIGEgdmVydGljYWwgc2NhbiwgYW5kIGlmIHN1Y2Nlc3NmdWwsIHdpbGwgc2VlIGlmIHRoaXMgcGF0dGVybiBoYWQgYmVlbgoJICAgICAqIGZvdW5kIG9uIGEgcHJldmlvdXMgaG9yaXpvbnRhbCBzY2FuLiBJZiBzbywgd2UgY29uc2lkZXIgaXQgY29uZmlybWVkIGFuZCBjb25jbHVkZSB3ZSBoYXZlCgkgICAgICogZm91bmQgdGhlIGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGF0ZUNvdW50IHJlYWRpbmcgc3RhdGUgbW9kdWxlIGNvdW50cyBmcm9tIGhvcml6b250YWwgc2NhbgoJICAgICAqIEBwYXJhbSBpIHJvdyB3aGVyZSBhbGlnbm1lbnQgcGF0dGVybiBtYXkgYmUgZm91bmQKCSAgICAgKiBAcGFyYW0gaiBlbmQgb2YgcG9zc2libGUgYWxpZ25tZW50IHBhdHRlcm4gaW4gcm93CgkgICAgICogQHJldHVybiB7QGxpbmsgQWxpZ25tZW50UGF0dGVybn0gaWYgd2UgaGF2ZSBmb3VuZCB0aGUgc2FtZSBwYXR0ZXJuIHR3aWNlLCBvciBudWxsIGlmIG5vdAoJICAgICAqLwoJICAgIEFsaWdubWVudFBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmhhbmRsZVBvc3NpYmxlQ2VudGVyID0gZnVuY3Rpb24gKHN0YXRlQ291bnQsIGkgLyppbnQqLywgaiAvKmludCovKSB7CgkgICAgICAgIHZhciBlXzEsIF9hOwoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdOwoJICAgICAgICB2YXIgY2VudGVySiA9IEFsaWdubWVudFBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBqKTsKCSAgICAgICAgdmFyIGNlbnRlckkgPSB0aGlzLmNyb3NzQ2hlY2tWZXJ0aWNhbChpLCAvKihpbnQpICovIGNlbnRlckosIDIgKiBzdGF0ZUNvdW50WzFdLCBzdGF0ZUNvdW50VG90YWwpOwoJICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckkpKSB7CgkgICAgICAgICAgICB2YXIgZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IChzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0pIC8gMy4wOwoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBfYiA9IF9fdmFsdWVzJDEodGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfYyA9IF9iLm5leHQoKTsgIV9jLmRvbmU7IF9jID0gX2IubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgICAgIHZhciBjZW50ZXIgPSBfYy52YWx1ZTsKCSAgICAgICAgICAgICAgICAgICAgLy8gTG9vayBmb3IgYWJvdXQgdGhlIHNhbWUgY2VudGVyIGFuZCBtb2R1bGUgc2l6ZToKCSAgICAgICAgICAgICAgICAgICAgaWYgKGNlbnRlci5hYm91dEVxdWFscyhlc3RpbWF0ZWRNb2R1bGVTaXplLCBjZW50ZXJJLCBjZW50ZXJKKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNlbnRlci5jb21iaW5lRXN0aW1hdGUoY2VudGVySSwgY2VudGVySiwgZXN0aW1hdGVkTW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKF9jICYmICFfYy5kb25lICYmIChfYSA9IF9iLnJldHVybikpIF9hLmNhbGwoX2IpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBIYWRuJ3QgZm91bmQgdGhpcyBiZWZvcmU7IHNhdmUgaXQKCSAgICAgICAgICAgIHZhciBwb2ludCA9IG5ldyBBbGlnbm1lbnRQYXR0ZXJuXzEuZGVmYXVsdChjZW50ZXJKLCBjZW50ZXJJLCBlc3RpbWF0ZWRNb2R1bGVTaXplKTsKCSAgICAgICAgICAgIHRoaXMucG9zc2libGVDZW50ZXJzLnB1c2gocG9pbnQpOwoJICAgICAgICAgICAgaWYgKHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayAhPT0gbnVsbCAmJiB0aGlzLnJlc3VsdFBvaW50Q2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjay5mb3VuZFBvc3NpYmxlUmVzdWx0UG9pbnQocG9pbnQpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBudWxsOwoJICAgIH07CgkgICAgcmV0dXJuIEFsaWdubWVudFBhdHRlcm5GaW5kZXI7Cgl9KCkpOwoJQWxpZ25tZW50UGF0dGVybkZpbmRlciQxLmRlZmF1bHQgPSBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyOwoKCXZhciBGaW5kZXJQYXR0ZXJuRmluZGVyJDEgPSB7fTsKCgl2YXIgRmluZGVyUGF0dGVybiQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRmluZGVyUGF0dGVybiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLnFyY29kZS5kZXRlY3RvciB7Ki8KCXZhciBSZXN1bHRQb2ludF8xJDIgPSBSZXN1bHRQb2ludCQxOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgYSBmaW5kZXIgcGF0dGVybiwgd2hpY2ggYXJlIHRoZSB0aHJlZSBzcXVhcmUgcGF0dGVybnMgZm91bmQgaW4KCSAqIHRoZSBjb3JuZXJzIG9mIFFSIENvZGVzLiBJdCBhbHNvIGVuY2Fwc3VsYXRlcyBhIGNvdW50IG9mIHNpbWlsYXIgZmluZGVyIHBhdHRlcm5zLAoJICogYXMgYSBjb252ZW5pZW5jZSB0byB0aGUgZmluZGVyJ3MgYm9va2tlZXBpbmcuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBGaW5kZXJQYXR0ZXJuID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyhGaW5kZXJQYXR0ZXJuLCBfc3VwZXIpOwoJICAgIC8vIEZpbmRlclBhdHRlcm4ocG9zWDogbnVtYmVyLypmbG9hdCovLCBwb3NZOiBudW1iZXIvKmZsb2F0Ki8sIGVzdGltYXRlZE1vZHVsZVNpemU6IG51bWJlci8qZmxvYXQqLykgewoJICAgIC8vICAgdGhpcyhwb3NYLCBwb3NZLCBlc3RpbWF0ZWRNb2R1bGVTaXplLCAxKQoJICAgIC8vIH0KCSAgICBmdW5jdGlvbiBGaW5kZXJQYXR0ZXJuKHBvc1ggLypmbG9hdCovLCBwb3NZIC8qZmxvYXQqLywgZXN0aW1hdGVkTW9kdWxlU2l6ZSAvKmZsb2F0Ki8sIGNvdW50IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcG9zWCwgcG9zWSkgfHwgdGhpczsKCSAgICAgICAgX3RoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IGVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIF90aGlzLmNvdW50ID0gY291bnQ7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGNvdW50KSB7CgkgICAgICAgICAgICBfdGhpcy5jb3VudCA9IDE7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBGaW5kZXJQYXR0ZXJuLnByb3RvdHlwZS5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lc3RpbWF0ZWRNb2R1bGVTaXplOwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybi5wcm90b3R5cGUuZ2V0Q291bnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvdW50OwoJICAgIH07CgkgICAgLyoKCSAgICB2b2lkIGluY3JlbWVudENvdW50KCkgewoJICAgICAgdGhpcy5jb3VudCsrCgkgICAgfQoJICAgICAqLwoJICAgIC8qKgoJICAgICAqIDxwPkRldGVybWluZXMgaWYgdGhpcyBmaW5kZXIgcGF0dGVybiAiYWJvdXQgZXF1YWxzIiBhIGZpbmRlciBwYXR0ZXJuIGF0IHRoZSBzdGF0ZWQKCSAgICAgKiBwb3NpdGlvbiBhbmQgc2l6ZSAtLSBtZWFuaW5nLCBpdCBpcyBhdCBuZWFybHkgdGhlIHNhbWUgY2VudGVyIHdpdGggbmVhcmx5IHRoZSBzYW1lIHNpemUuPC9wPgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm4ucHJvdG90eXBlLmFib3V0RXF1YWxzID0gZnVuY3Rpb24gKG1vZHVsZVNpemUgLypmbG9hdCovLCBpIC8qZmxvYXQqLywgaiAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE1hdGguYWJzKGkgLSB0aGlzLmdldFkoKSkgPD0gbW9kdWxlU2l6ZSAmJiBNYXRoLmFicyhqIC0gdGhpcy5nZXRYKCkpIDw9IG1vZHVsZVNpemUpIHsKCSAgICAgICAgICAgIHZhciBtb2R1bGVTaXplRGlmZiA9IE1hdGguYWJzKG1vZHVsZVNpemUgLSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVNpemVEaWZmIDw9IDEuMCB8fCBtb2R1bGVTaXplRGlmZiA8PSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29tYmluZXMgdGhpcyBvYmplY3QncyBjdXJyZW50IGVzdGltYXRlIG9mIGEgZmluZGVyIHBhdHRlcm4gcG9zaXRpb24gYW5kIG1vZHVsZSBzaXplCgkgICAgICogd2l0aCBhIG5ldyBlc3RpbWF0ZS4gSXQgcmV0dXJucyBhIG5ldyB7QGNvZGUgRmluZGVyUGF0dGVybn0gY29udGFpbmluZyBhIHdlaWdodGVkIGF2ZXJhZ2UKCSAgICAgKiBiYXNlZCBvbiBjb3VudC4KCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuLnByb3RvdHlwZS5jb21iaW5lRXN0aW1hdGUgPSBmdW5jdGlvbiAoaSAvKmZsb2F0Ki8sIGogLypmbG9hdCovLCBuZXdNb2R1bGVTaXplIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgY29tYmluZWRDb3VudCA9IHRoaXMuY291bnQgKyAxOwoJICAgICAgICB2YXIgY29tYmluZWRYID0gKHRoaXMuY291bnQgKiB0aGlzLmdldFgoKSArIGopIC8gY29tYmluZWRDb3VudDsKCSAgICAgICAgdmFyIGNvbWJpbmVkWSA9ICh0aGlzLmNvdW50ICogdGhpcy5nZXRZKCkgKyBpKSAvIGNvbWJpbmVkQ291bnQ7CgkgICAgICAgIHZhciBjb21iaW5lZE1vZHVsZVNpemUgPSAodGhpcy5jb3VudCAqIHRoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSArIG5ld01vZHVsZVNpemUpIC8gY29tYmluZWRDb3VudDsKCSAgICAgICAgcmV0dXJuIG5ldyBGaW5kZXJQYXR0ZXJuKGNvbWJpbmVkWCwgY29tYmluZWRZLCBjb21iaW5lZE1vZHVsZVNpemUsIGNvbWJpbmVkQ291bnQpOwoJICAgIH07CgkgICAgcmV0dXJuIEZpbmRlclBhdHRlcm47Cgl9KFJlc3VsdFBvaW50XzEkMi5kZWZhdWx0KSk7CglGaW5kZXJQYXR0ZXJuJDEuZGVmYXVsdCA9IEZpbmRlclBhdHRlcm47CgoJdmFyIEZpbmRlclBhdHRlcm5JbmZvJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEZpbmRlclBhdHRlcm5JbmZvJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGluZm9ybWF0aW9uIGFib3V0IGZpbmRlciBwYXR0ZXJucyBpbiBhbiBpbWFnZSwgaW5jbHVkaW5nIHRoZSBsb2NhdGlvbiBvZgoJICogdGhlIHRocmVlIGZpbmRlciBwYXR0ZXJucywgYW5kIHRoZWlyIGVzdGltYXRlZCBtb2R1bGUgc2l6ZS48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEZpbmRlclBhdHRlcm5JbmZvID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEZpbmRlclBhdHRlcm5JbmZvKHBhdHRlcm5DZW50ZXJzKSB7CgkgICAgICAgIHRoaXMuYm90dG9tTGVmdCA9IHBhdHRlcm5DZW50ZXJzWzBdOwoJICAgICAgICB0aGlzLnRvcExlZnQgPSBwYXR0ZXJuQ2VudGVyc1sxXTsKCSAgICAgICAgdGhpcy50b3BSaWdodCA9IHBhdHRlcm5DZW50ZXJzWzJdOwoJICAgIH0KCSAgICBGaW5kZXJQYXR0ZXJuSW5mby5wcm90b3R5cGUuZ2V0Qm90dG9tTGVmdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYm90dG9tTGVmdDsKCSAgICB9OwoJICAgIEZpbmRlclBhdHRlcm5JbmZvLnByb3RvdHlwZS5nZXRUb3BMZWZ0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50b3BMZWZ0OwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybkluZm8ucHJvdG90eXBlLmdldFRvcFJpZ2h0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50b3BSaWdodDsKCSAgICB9OwoJICAgIHJldHVybiBGaW5kZXJQYXR0ZXJuSW5mbzsKCX0oKSk7CglGaW5kZXJQYXR0ZXJuSW5mbyQxLmRlZmF1bHQgPSBGaW5kZXJQYXR0ZXJuSW5mbzsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEZpbmRlclBhdHRlcm5GaW5kZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGV0ZWN0b3IgeyovCgl2YXIgRGVjb2RlSGludFR5cGVfMSQyID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBSZXN1bHRQb2ludF8xJDEgPSBSZXN1bHRQb2ludCQxOwoJdmFyIEZpbmRlclBhdHRlcm5fMSA9IEZpbmRlclBhdHRlcm4kMTsKCXZhciBGaW5kZXJQYXR0ZXJuSW5mb18xID0gRmluZGVyUGF0dGVybkluZm8kMTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDIgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJLyppbXBvcnQgamF2YS5pby5TZXJpYWxpemFibGU7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsqLwoJLyppbXBvcnQgamF2YS51dGlsLkNvbXBhcmF0b3I7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgYXR0ZW1wdHMgdG8gZmluZCBmaW5kZXIgcGF0dGVybnMgaW4gYSBRUiBDb2RlLiBGaW5kZXIgcGF0dGVybnMgYXJlIHRoZSBzcXVhcmUKCSAqIG1hcmtlcnMgYXQgdGhyZWUgY29ybmVycyBvZiBhIFFSIENvZGUuPC9wPgoJICoKCSAqIDxwPlRoaXMgY2xhc3MgaXMgdGhyZWFkLXNhZmUgYnV0IG5vdCByZWVudHJhbnQuIEVhY2ggdGhyZWFkIG11c3QgYWxsb2NhdGUgaXRzIG93biBvYmplY3QuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEZpbmRlclBhdHRlcm5GaW5kZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogPHA+Q3JlYXRlcyBhIGZpbmRlciB0aGF0IHdpbGwgc2VhcmNoIHRoZSBpbWFnZSBmb3IgdGhyZWUgZmluZGVyIHBhdHRlcm5zLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBpbWFnZSBpbWFnZSB0byBzZWFyY2gKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IoaW1hZ2U6IEJpdE1hdHJpeCkgewoJICAgIC8vICAgdGhpcyhpbWFnZSwgbnVsbCkKCSAgICAvLyB9CgkgICAgZnVuY3Rpb24gRmluZGVyUGF0dGVybkZpbmRlcihpbWFnZSwgcmVzdWx0UG9pbnRDYWxsYmFjaykgewoJICAgICAgICB0aGlzLmltYWdlID0gaW1hZ2U7CgkgICAgICAgIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayA9IHJlc3VsdFBvaW50Q2FsbGJhY2s7CgkgICAgICAgIHRoaXMucG9zc2libGVDZW50ZXJzID0gW107CgkgICAgICAgIHRoaXMuY3Jvc3NDaGVja1N0YXRlQ291bnQgPSBuZXcgSW50MzJBcnJheSg1KTsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gcmVzdWx0UG9pbnRDYWxsYmFjazsKCSAgICB9CgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuZ2V0SW1hZ2UgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmltYWdlOwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuZ2V0UG9zc2libGVDZW50ZXJzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5wb3NzaWJsZUNlbnRlcnM7CgkgICAgfTsKCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24gKGhpbnRzKSB7CgkgICAgICAgIHZhciB0cnlIYXJkZXIgPSAoaGludHMgIT09IG51bGwgJiYgaGludHMgIT09IHVuZGVmaW5lZCkgJiYgdW5kZWZpbmVkICE9PSBoaW50cy5nZXQoRGVjb2RlSGludFR5cGVfMSQyLmRlZmF1bHQuVFJZX0hBUkRFUik7CgkgICAgICAgIHZhciBwdXJlQmFyY29kZSA9IChoaW50cyAhPT0gbnVsbCAmJiBoaW50cyAhPT0gdW5kZWZpbmVkKSAmJiB1bmRlZmluZWQgIT09IGhpbnRzLmdldChEZWNvZGVIaW50VHlwZV8xJDIuZGVmYXVsdC5QVVJFX0JBUkNPREUpOwoJICAgICAgICB2YXIgaW1hZ2UgPSB0aGlzLmltYWdlOwoJICAgICAgICB2YXIgbWF4SSA9IGltYWdlLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgbWF4SiA9IGltYWdlLmdldFdpZHRoKCk7CgkgICAgICAgIC8vIFdlIGFyZSBsb29raW5nIGZvciBibGFjay93aGl0ZS9ibGFjay93aGl0ZS9ibGFjayBtb2R1bGVzIGluCgkgICAgICAgIC8vIDE6MTozOjE6MSByYXRpbzsgdGhpcyB0cmFja3MgdGhlIG51bWJlciBvZiBzdWNoIG1vZHVsZXMgc2VlbiBzbyBmYXIKCSAgICAgICAgLy8gTGV0J3MgYXNzdW1lIHRoYXQgdGhlIG1heGltdW0gdmVyc2lvbiBRUiBDb2RlIHdlIHN1cHBvcnQgdGFrZXMgdXAgMS80IHRoZSBoZWlnaHQgb2YgdGhlCgkgICAgICAgIC8vIGltYWdlLCBhbmQgdGhlbiBhY2NvdW50IGZvciB0aGUgY2VudGVyIGJlaW5nIDMgbW9kdWxlcyBpbiBzaXplLiBUaGlzIGdpdmVzIHRoZSBzbWFsbGVzdAoJICAgICAgICAvLyBudW1iZXIgb2YgcGl4ZWxzIHRoZSBjZW50ZXIgY291bGQgYmUsIHNvIHNraXAgdGhpcyBvZnRlbi4gV2hlbiB0cnlpbmcgaGFyZGVyLCBsb29rIGZvciBhbGwKCSAgICAgICAgLy8gUVIgdmVyc2lvbnMgcmVnYXJkbGVzcyBvZiBob3cgZGVuc2UgdGhleSBhcmUuCgkgICAgICAgIHZhciBpU2tpcCA9IE1hdGguZmxvb3IoKDMgKiBtYXhJKSAvICg0ICogRmluZGVyUGF0dGVybkZpbmRlci5NQVhfTU9EVUxFUykpOwoJICAgICAgICBpZiAoaVNraXAgPCBGaW5kZXJQYXR0ZXJuRmluZGVyLk1JTl9TS0lQIHx8IHRyeUhhcmRlcikgewoJICAgICAgICAgICAgaVNraXAgPSBGaW5kZXJQYXR0ZXJuRmluZGVyLk1JTl9TS0lQOwoJICAgICAgICB9CgkgICAgICAgIHZhciBkb25lID0gZmFsc2U7CgkgICAgICAgIHZhciBzdGF0ZUNvdW50ID0gbmV3IEludDMyQXJyYXkoNSk7CgkgICAgICAgIGZvciAodmFyIGkgPSBpU2tpcCAtIDE7IGkgPCBtYXhJICYmICFkb25lOyBpICs9IGlTa2lwKSB7CgkgICAgICAgICAgICAvLyBHZXQgYSByb3cgb2YgYmxhY2svd2hpdGUgdmFsdWVzCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMV0gPSAwOwoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IDA7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzNdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0gPSAwOwoJICAgICAgICAgICAgdmFyIGN1cnJlbnRTdGF0ZSA9IDA7CgkgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG1heEo7IGorKykgewoJICAgICAgICAgICAgICAgIGlmIChpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gQmxhY2sgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKChjdXJyZW50U3RhdGUgJiAxKSA9PT0gMSkgeyAvLyBDb3VudGluZyB3aGl0ZSBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsgLy8gV2hpdGUgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKChjdXJyZW50U3RhdGUgJiAxKSA9PT0gMCkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50U3RhdGUgPT09IDQpIHsgLy8gQSB3aW5uZXI/CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkpIHsgLy8gWWVzCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb25maXJtZWQgPSB0aGlzLmhhbmRsZVBvc3NpYmxlQ2VudGVyKHN0YXRlQ291bnQsIGksIGosIHB1cmVCYXJjb2RlKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCA9PT0gdHJ1ZSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgZXhhbWluaW5nIGV2ZXJ5IG90aGVyIGxpbmUuIENoZWNraW5nIGVhY2ggbGluZSB0dXJuZWQgb3V0IHRvIGJlIHRvbwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXhwZW5zaXZlIGFuZCBkaWRuJ3QgaW1wcm92ZSBwZXJmb3JtYW5jZS4KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlTa2lwID0gMjsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc1NraXBwZWQgPT09IHRydWUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gdGhpcy5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzKCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm93U2tpcCA9IHRoaXMuZmluZFJvd1NraXAoKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocm93U2tpcCA+IHN0YXRlQ291bnRbMl0pIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2tpcCByb3dzIGJldHdlZW4gcm93IG9mIGxvd2VyIGNvbmZpcm1lZCBjZW50ZXIKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW5kIHRvcCBvZiBwcmVzdW1lZCB0aGlyZCBjb25maXJtZWQgY2VudGVyCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJ1dCBiYWNrIHVwIGEgYml0IHRvIGdldCBhIGZ1bGwgY2hhbmNlIG9mIGRldGVjdGluZwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpdCwgZW50aXJlIHdpZHRoIG9mIGNlbnRlciBvZiBmaW5kZXIgcGF0dGVybgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTa2lwIGJ5IHJvd1NraXAsIGJ1dCBiYWNrIG9mZiBieSBzdGF0ZUNvdW50WzJdIChzaXplIG9mIGxhc3QgY2VudGVyCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9mIHBhdHRlcm4gd2Ugc2F3KSB0byBiZSBjb25zZXJ2YXRpdmUsIGFuZCBhbHNvIGJhY2sgb2ZmIGJ5IGlTa2lwIHdoaWNoCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlzIGFib3V0IHRvIGJlIHJlLWFkZGVkCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgKz0gcm93U2tpcCAtIHN0YXRlQ291bnRbMl0gLSBpU2tpcDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaiA9IG1heEogLSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMF0gPSBzdGF0ZUNvdW50WzJdOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsxXSA9IHN0YXRlQ291bnRbM107CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzJdID0gc3RhdGVDb3VudFs0XTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFs0XSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAzOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2xlYXIgc3RhdGUgdG8gc3RhcnQgbG9va2luZyBhZ2FpbgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsxXSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzNdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFs0XSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyAvLyBObywgc2hpZnQgY291bnRzIGJhY2sgYnkgdHdvCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMF0gPSBzdGF0ZUNvdW50WzJdOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzFdID0gc3RhdGVDb3VudFszXTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IHN0YXRlQ291bnRbNF07CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzRdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0YXRlID0gMzsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WysrY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgeyAvLyBDb3VudGluZyB3aGl0ZSBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgaWYgKEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgY29uZmlybWVkID0gdGhpcy5oYW5kbGVQb3NzaWJsZUNlbnRlcihzdGF0ZUNvdW50LCBpLCBtYXhKLCBwdXJlQmFyY29kZSk7CgkgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCA9PT0gdHJ1ZSkgewoJICAgICAgICAgICAgICAgICAgICBpU2tpcCA9IHN0YXRlQ291bnRbMF07CgkgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc1NraXBwZWQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvdW5kIGEgdGhpcmQgb25lCgkgICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gdGhpcy5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzKCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHBhdHRlcm5JbmZvID0gdGhpcy5zZWxlY3RCZXN0UGF0dGVybnMoKTsKCSAgICAgICAgUmVzdWx0UG9pbnRfMSQxLmRlZmF1bHQub3JkZXJCZXN0UGF0dGVybnMocGF0dGVybkluZm8pOwoJICAgICAgICByZXR1cm4gbmV3IEZpbmRlclBhdHRlcm5JbmZvXzEuZGVmYXVsdChwYXR0ZXJuSW5mbyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBHaXZlbiBhIGNvdW50IG9mIGJsYWNrL3doaXRlL2JsYWNrL3doaXRlL2JsYWNrIHBpeGVscyBqdXN0IHNlZW4gYW5kIGFuIGVuZCBwb3NpdGlvbiwKCSAgICAgKiBmaWd1cmVzIHRoZSBsb2NhdGlvbiBvZiB0aGUgY2VudGVyIG9mIHRoaXMgcnVuLgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZCA9IGZ1bmN0aW9uIChzdGF0ZUNvdW50LCBlbmQgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gKGVuZCAtIHN0YXRlQ291bnRbNF0gLSBzdGF0ZUNvdW50WzNdKSAtIHN0YXRlQ291bnRbMl0gLyAyLjA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gc3RhdGVDb3VudCBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCByZWFkCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGUgcHJvcG9ydGlvbnMgb2YgdGhlIGNvdW50cyBpcyBjbG9zZSBlbm91Z2ggdG8gdGhlIDEvMS8zLzEvMSByYXRpb3MKCSAgICAgKiAgICAgICAgIHVzZWQgYnkgZmluZGVyIHBhdHRlcm5zIHRvIGJlIGNvbnNpZGVyZWQgYSBtYXRjaAoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3MgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCkgewoJICAgICAgICB2YXIgdG90YWxNb2R1bGVTaXplID0gMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA1OyBpKyspIHsKCSAgICAgICAgICAgIHZhciBjb3VudCA9IHN0YXRlQ291bnRbaV07CgkgICAgICAgICAgICBpZiAoY291bnQgPT09IDApIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gY291bnQ7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRvdGFsTW9kdWxlU2l6ZSA8IDcpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRvdGFsTW9kdWxlU2l6ZSAvIDcuMDsKCSAgICAgICAgdmFyIG1heFZhcmlhbmNlID0gbW9kdWxlU2l6ZSAvIDIuMDsKCSAgICAgICAgLy8gQWxsb3cgbGVzcyB0aGFuIDUwJSB2YXJpYW5jZSBmcm9tIDEtMS0zLTEtMSBwcm9wb3J0aW9ucwoJICAgICAgICByZXR1cm4gTWF0aC5hYnMobW9kdWxlU2l6ZSAtIHN0YXRlQ291bnRbMF0pIDwgbWF4VmFyaWFuY2UgJiYKCSAgICAgICAgICAgIE1hdGguYWJzKG1vZHVsZVNpemUgLSBzdGF0ZUNvdW50WzFdKSA8IG1heFZhcmlhbmNlICYmCgkgICAgICAgICAgICBNYXRoLmFicygzLjAgKiBtb2R1bGVTaXplIC0gc3RhdGVDb3VudFsyXSkgPCAzICogbWF4VmFyaWFuY2UgJiYKCSAgICAgICAgICAgIE1hdGguYWJzKG1vZHVsZVNpemUgLSBzdGF0ZUNvdW50WzNdKSA8IG1heFZhcmlhbmNlICYmCgkgICAgICAgICAgICBNYXRoLmFicyhtb2R1bGVTaXplIC0gc3RhdGVDb3VudFs0XSkgPCBtYXhWYXJpYW5jZTsKCSAgICB9OwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgY3Jvc3NDaGVja1N0YXRlQ291bnQgPSB0aGlzLmNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgICAgICBjcm9zc0NoZWNrU3RhdGVDb3VudFswXSA9IDA7CgkgICAgICAgIGNyb3NzQ2hlY2tTdGF0ZUNvdW50WzFdID0gMDsKCSAgICAgICAgY3Jvc3NDaGVja1N0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICBjcm9zc0NoZWNrU3RhdGVDb3VudFszXSA9IDA7CgkgICAgICAgIGNyb3NzQ2hlY2tTdGF0ZUNvdW50WzRdID0gMDsKCSAgICAgICAgcmV0dXJuIGNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQWZ0ZXIgYSB2ZXJ0aWNhbCBhbmQgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG90ZW50aWFsIGZpbmRlciBwYXR0ZXJuLCB0aGlzIG1ldGhvZAoJICAgICAqICJjcm9zcy1jcm9zcy1jcm9zcy1jaGVja3MiIGJ5IHNjYW5uaW5nIGRvd24gZGlhZ29uYWxseSB0aHJvdWdoIHRoZSBjZW50ZXIgb2YgdGhlIHBvc3NpYmxlCgkgICAgICogZmluZGVyIHBhdHRlcm4gdG8gc2VlIGlmIHRoZSBzYW1lIHByb3BvcnRpb24gaXMgZGV0ZWN0ZWQuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gc3RhcnRJIHJvdyB3aGVyZSBhIGZpbmRlciBwYXR0ZXJuIHdhcyBkZXRlY3RlZAoJICAgICAqIEBwYXJhbSBjZW50ZXJKIGNlbnRlciBvZiB0aGUgc2VjdGlvbiB0aGF0IGFwcGVhcnMgdG8gY3Jvc3MgYSBmaW5kZXIgcGF0dGVybgoJICAgICAqIEBwYXJhbSBtYXhDb3VudCBtYXhpbXVtIHJlYXNvbmFibGUgbnVtYmVyIG9mIG1vZHVsZXMgdGhhdCBzaG91bGQgYmUKCSAgICAgKiAgb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcGFyYW0gb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwgVGhlIG9yaWdpbmFsIHN0YXRlIGNvdW50IHRvdGFsLgoJICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBwcm9wb3J0aW9ucyBhcmUgd2l0aGluZyBleHBlY3RlZCBsaW1pdHMKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5jcm9zc0NoZWNrRGlhZ29uYWwgPSBmdW5jdGlvbiAoc3RhcnRJIC8qaW50Ki8sIGNlbnRlckogLyppbnQqLywgbWF4Q291bnQgLyppbnQqLywgb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwgLyppbnQqLykgewoJICAgICAgICB2YXIgc3RhdGVDb3VudCA9IHRoaXMuZ2V0Q3Jvc3NDaGVja1N0YXRlQ291bnQoKTsKCSAgICAgICAgLy8gU3RhcnQgY291bnRpbmcgdXAsIGxlZnQgZnJvbSBjZW50ZXIgZmluZGluZyBibGFjayBjZW50ZXIgbWFzcwoJICAgICAgICB2YXIgaSA9IDA7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIHdoaWxlIChzdGFydEkgPj0gaSAmJiBjZW50ZXJKID49IGkgJiYgaW1hZ2UuZ2V0KGNlbnRlckogLSBpLCBzdGFydEkgLSBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGFydEkgPCBpIHx8IGNlbnRlckogPCBpKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29udGludWUgdXAsIGxlZnQgZmluZGluZyB3aGl0ZSBzcGFjZQoJICAgICAgICB3aGlsZSAoc3RhcnRJID49IGkgJiYgY2VudGVySiA+PSBpICYmICFpbWFnZS5nZXQoY2VudGVySiAtIGksIHN0YXJ0SSAtIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzFdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzFdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgLy8gSWYgYWxyZWFkeSB0b28gbWFueSBtb2R1bGVzIGluIHRoaXMgc3RhdGUgb3IgcmFuIG9mZiB0aGUgZWRnZToKCSAgICAgICAgaWYgKHN0YXJ0SSA8IGkgfHwgY2VudGVySiA8IGkgfHwgc3RhdGVDb3VudFsxXSA+IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29udGludWUgdXAsIGxlZnQgZmluZGluZyBibGFjayBib3JkZXIKCSAgICAgICAgd2hpbGUgKHN0YXJ0SSA+PSBpICYmIGNlbnRlckogPj0gaSAmJiBpbWFnZS5nZXQoY2VudGVySiAtIGksIHN0YXJ0SSAtIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbMF0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBtYXhJID0gaW1hZ2UuZ2V0SGVpZ2h0KCk7CgkgICAgICAgIHZhciBtYXhKID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgLy8gTm93IGFsc28gY291bnQgZG93biwgcmlnaHQgZnJvbSBjZW50ZXIKCSAgICAgICAgaSA9IDE7CgkgICAgICAgIHdoaWxlIChzdGFydEkgKyBpIDwgbWF4SSAmJiBjZW50ZXJKICsgaSA8IG1heEogJiYgaW1hZ2UuZ2V0KGNlbnRlckogKyBpLCBzdGFydEkgKyBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIC8vIFJhbiBvZmYgdGhlIGVkZ2U/CgkgICAgICAgIGlmIChzdGFydEkgKyBpID49IG1heEkgfHwgY2VudGVySiArIGkgPj0gbWF4SikgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChzdGFydEkgKyBpIDwgbWF4SSAmJiBjZW50ZXJKICsgaSA8IG1heEogJiYgIWltYWdlLmdldChjZW50ZXJKICsgaSwgc3RhcnRJICsgaSkgJiYKCSAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPCBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFszXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGFydEkgKyBpID49IG1heEkgfHwgY2VudGVySiArIGkgPj0gbWF4SiB8fCBzdGF0ZUNvdW50WzNdID49IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKHN0YXJ0SSArIGkgPCBtYXhJICYmIGNlbnRlckogKyBpIDwgbWF4SiAmJiBpbWFnZS5nZXQoY2VudGVySiArIGksIHN0YXJ0SSArIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0rKzsKCSAgICAgICAgICAgIGkrKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFs0XSA+PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHdlIGZvdW5kIGEgZmluZGVyLXBhdHRlcm4tbGlrZSBzZWN0aW9uLCBidXQgaXRzIHNpemUgaXMgbW9yZSB0aGFuIDEwMCUgZGlmZmVyZW50IHRoYW4KCSAgICAgICAgLy8gdGhlIG9yaWdpbmFsLCBhc3N1bWUgaXQncyBhIGZhbHNlIHBvc2l0aXZlCgkgICAgICAgIHZhciBzdGF0ZUNvdW50VG90YWwgPSBzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0gKyBzdGF0ZUNvdW50WzNdICsgc3RhdGVDb3VudFs0XTsKCSAgICAgICAgcmV0dXJuIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA8IDIgKiBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCAmJgoJICAgICAgICAgICAgRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkFmdGVyIGEgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG90ZW50aWFsIGZpbmRlciBwYXR0ZXJuLCB0aGlzIG1ldGhvZAoJICAgICAqICJjcm9zcy1jaGVja3MiIGJ5IHNjYW5uaW5nIGRvd24gdmVydGljYWxseSB0aHJvdWdoIHRoZSBjZW50ZXIgb2YgdGhlIHBvc3NpYmxlCgkgICAgICogZmluZGVyIHBhdHRlcm4gdG8gc2VlIGlmIHRoZSBzYW1lIHByb3BvcnRpb24gaXMgZGV0ZWN0ZWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIHN0YXJ0SSByb3cgd2hlcmUgYSBmaW5kZXIgcGF0dGVybiB3YXMgZGV0ZWN0ZWQKCSAgICAgKiBAcGFyYW0gY2VudGVySiBjZW50ZXIgb2YgdGhlIHNlY3Rpb24gdGhhdCBhcHBlYXJzIHRvIGNyb3NzIGEgZmluZGVyIHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gbWF4Q291bnQgbWF4aW11bSByZWFzb25hYmxlIG51bWJlciBvZiBtb2R1bGVzIHRoYXQgc2hvdWxkIGJlCgkgICAgICogb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcmV0dXJuIHZlcnRpY2FsIGNlbnRlciBvZiBmaW5kZXIgcGF0dGVybiwgb3Ige0BsaW5rIEZsb2F0I05hTn0gaWYgbm90IGZvdW5kCgkgICAgICovCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuY3Jvc3NDaGVja1ZlcnRpY2FsID0gZnVuY3Rpb24gKHN0YXJ0SSAvKmludCovLCBjZW50ZXJKIC8qaW50Ki8sIG1heENvdW50IC8qaW50Ki8sIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZTsKCSAgICAgICAgdmFyIG1heEkgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50KCk7CgkgICAgICAgIC8vIFN0YXJ0IGNvdW50aW5nIHVwIGZyb20gY2VudGVyCgkgICAgICAgIHZhciBpID0gc3RhcnRJOwoJICAgICAgICB3aGlsZSAoaSA+PSAwICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpIDwgMCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaSA+PSAwICYmICFpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIGFscmVhZHkgdG9vIG1hbnkgbW9kdWxlcyBpbiB0aGlzIHN0YXRlIG9yIHJhbiBvZmYgdGhlIGVkZ2U6CgkgICAgICAgIGlmIChpIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFswXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFswXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGF0ZUNvdW50WzBdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgLy8gTm93IGFsc28gY291bnQgZG93biBmcm9tIGNlbnRlcgoJICAgICAgICBpID0gc3RhcnRJICsgMTsKCSAgICAgICAgd2hpbGUgKGkgPCBtYXhJICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJKSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChpIDwgbWF4SSAmJiAhaW1hZ2UuZ2V0KGNlbnRlckosIGkpICYmIHN0YXRlQ291bnRbM10gPCBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFszXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJIHx8IHN0YXRlQ291bnRbM10gPj0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPCBtYXhJICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSAmJiBzdGF0ZUNvdW50WzRdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0rKzsKCSAgICAgICAgICAgIGkrKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFs0XSA+PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICAvLyBJZiB3ZSBmb3VuZCBhIGZpbmRlci1wYXR0ZXJuLWxpa2Ugc2VjdGlvbiwgYnV0IGl0cyBzaXplIGlzIG1vcmUgdGhhbiA0MCUgZGlmZmVyZW50IHRoYW4KCSAgICAgICAgLy8gdGhlIG9yaWdpbmFsLCBhc3N1bWUgaXQncyBhIGZhbHNlIHBvc2l0aXZlCgkgICAgICAgIHZhciBzdGF0ZUNvdW50VG90YWwgPSBzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0gKyBzdGF0ZUNvdW50WzNdICsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF07CgkgICAgICAgIGlmICg1ICogTWF0aC5hYnMoc3RhdGVDb3VudFRvdGFsIC0gb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwpID49IDIgKiBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSA/IEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBpKSA6IE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkxpa2Uge0BsaW5rICNjcm9zc0NoZWNrVmVydGljYWwoaW50LCBpbnQsIGludCwgaW50KX0sIGFuZCBpbiBmYWN0IGlzIGJhc2ljYWxseSBpZGVudGljYWwsCgkgICAgICogZXhjZXB0IGl0IHJlYWRzIGhvcml6b250YWxseSBpbnN0ZWFkIG9mIHZlcnRpY2FsbHkuIFRoaXMgaXMgdXNlZCB0byBjcm9zcy1jcm9zcwoJICAgICAqIGNoZWNrIGEgdmVydGljYWwgY3Jvc3MgY2hlY2sgYW5kIGxvY2F0ZSB0aGUgcmVhbCBjZW50ZXIgb2YgdGhlIGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5jcm9zc0NoZWNrSG9yaXpvbnRhbCA9IGZ1bmN0aW9uIChzdGFydEogLyppbnQqLywgY2VudGVySSAvKmludCovLCBtYXhDb3VudCAvKmludCovLCBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCAvKmludCovKSB7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIHZhciBtYXhKID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50KCk7CgkgICAgICAgIHZhciBqID0gc3RhcnRKOwoJICAgICAgICB3aGlsZSAoaiA+PSAwICYmIGltYWdlLmdldChqLCBjZW50ZXJJKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChqIDwgMCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaiA+PSAwICYmICFpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChqIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGogPj0gMCAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFswXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFswXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGF0ZUNvdW50WzBdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgaiA9IHN0YXJ0SiArIDE7CgkgICAgICAgIHdoaWxlIChqIDwgbWF4SiAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMl0rKzsKCSAgICAgICAgICAgIGorKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaiA9PT0gbWF4SikgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaiA8IG1heEogJiYgIWltYWdlLmdldChqLCBjZW50ZXJJKSAmJiBzdGF0ZUNvdW50WzNdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbM10rKzsKCSAgICAgICAgICAgIGorKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaiA9PT0gbWF4SiB8fCBzdGF0ZUNvdW50WzNdID49IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChqIDwgbWF4SiAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFs0XSA8IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdKys7CgkgICAgICAgICAgICBqKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbNF0gPj0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgLy8gSWYgd2UgZm91bmQgYSBmaW5kZXItcGF0dGVybi1saWtlIHNlY3Rpb24sIGJ1dCBpdHMgc2l6ZSBpcyBzaWduaWZpY2FudGx5IGRpZmZlcmVudCB0aGFuCgkgICAgICAgIC8vIHRoZSBvcmlnaW5hbCwgYXNzdW1lIGl0J3MgYSBmYWxzZSBwb3NpdGl2ZQoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdICsgc3RhdGVDb3VudFszXSArCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdOwoJICAgICAgICBpZiAoNSAqIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA+PSBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSA/IEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBqKSA6IE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlRoaXMgaXMgY2FsbGVkIHdoZW4gYSBob3Jpem9udGFsIHNjYW4gZmluZHMgYSBwb3NzaWJsZSBhbGlnbm1lbnQgcGF0dGVybi4gSXQgd2lsbAoJICAgICAqIGNyb3NzIGNoZWNrIHdpdGggYSB2ZXJ0aWNhbCBzY2FuLCBhbmQgaWYgc3VjY2Vzc2Z1bCwgd2lsbCwgYWgsIGNyb3NzLWNyb3NzLWNoZWNrCgkgICAgICogd2l0aCBhbm90aGVyIGhvcml6b250YWwgc2Nhbi4gVGhpcyBpcyBuZWVkZWQgcHJpbWFyaWx5IHRvIGxvY2F0ZSB0aGUgcmVhbCBob3Jpem9udGFsCgkgICAgICogY2VudGVyIG9mIHRoZSBwYXR0ZXJuIGluIGNhc2VzIG9mIGV4dHJlbWUgc2tldy4KCSAgICAgKiBBbmQgdGhlbiB3ZSBjcm9zcy1jcm9zcy1jcm9zcyBjaGVjayB3aXRoIGFub3RoZXIgZGlhZ29uYWwgc2Nhbi48L3A+CgkgICAgICoKCSAgICAgKiA8cD5JZiB0aGF0IHN1Y2NlZWRzIHRoZSBmaW5kZXIgcGF0dGVybiBsb2NhdGlvbiBpcyBhZGRlZCB0byBhIGxpc3QgdGhhdCB0cmFja3MKCSAgICAgKiB0aGUgbnVtYmVyIG9mIHRpbWVzIGVhY2ggbG9jYXRpb24gaGFzIGJlZW4gbmVhcmx5LW1hdGNoZWQgYXMgYSBmaW5kZXIgcGF0dGVybi4KCSAgICAgKiBFYWNoIGFkZGl0aW9uYWwgZmluZCBpcyBtb3JlIGV2aWRlbmNlIHRoYXQgdGhlIGxvY2F0aW9uIGlzIGluIGZhY3QgYSBmaW5kZXIKCSAgICAgKiBwYXR0ZXJuIGNlbnRlcgoJICAgICAqCgkgICAgICogQHBhcmFtIHN0YXRlQ291bnQgcmVhZGluZyBzdGF0ZSBtb2R1bGUgY291bnRzIGZyb20gaG9yaXpvbnRhbCBzY2FuCgkgICAgICogQHBhcmFtIGkgcm93IHdoZXJlIGZpbmRlciBwYXR0ZXJuIG1heSBiZSBmb3VuZAoJICAgICAqIEBwYXJhbSBqIGVuZCBvZiBwb3NzaWJsZSBmaW5kZXIgcGF0dGVybiBpbiByb3cKCSAgICAgKiBAcGFyYW0gcHVyZUJhcmNvZGUgdHJ1ZSBpZiBpbiAicHVyZSBiYXJjb2RlIiBtb2RlCgkgICAgICogQHJldHVybiB0cnVlIGlmIGEgZmluZGVyIHBhdHRlcm4gY2FuZGlkYXRlIHdhcyBmb3VuZCB0aGlzIHRpbWUKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5oYW5kbGVQb3NzaWJsZUNlbnRlciA9IGZ1bmN0aW9uIChzdGF0ZUNvdW50LCBpIC8qaW50Ki8sIGogLyppbnQqLywgcHVyZUJhcmNvZGUpIHsKCSAgICAgICAgdmFyIHN0YXRlQ291bnRUb3RhbCA9IHN0YXRlQ291bnRbMF0gKyBzdGF0ZUNvdW50WzFdICsgc3RhdGVDb3VudFsyXSArIHN0YXRlQ291bnRbM10gKwoJICAgICAgICAgICAgc3RhdGVDb3VudFs0XTsKCSAgICAgICAgdmFyIGNlbnRlckogPSBGaW5kZXJQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQoc3RhdGVDb3VudCwgaik7CgkgICAgICAgIHZhciBjZW50ZXJJID0gdGhpcy5jcm9zc0NoZWNrVmVydGljYWwoaSwgLyooaW50KSAqLyBNYXRoLmZsb29yKGNlbnRlckopLCBzdGF0ZUNvdW50WzJdLCBzdGF0ZUNvdW50VG90YWwpOwoJICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckkpKSB7CgkgICAgICAgICAgICAvLyBSZS1jcm9zcyBjaGVjawoJICAgICAgICAgICAgY2VudGVySiA9IHRoaXMuY3Jvc3NDaGVja0hvcml6b250YWwoLyooaW50KSAqLyBNYXRoLmZsb29yKGNlbnRlckopLCAvKihpbnQpICovIE1hdGguZmxvb3IoY2VudGVySSksIHN0YXRlQ291bnRbMl0sIHN0YXRlQ291bnRUb3RhbCk7CgkgICAgICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckopICYmCgkgICAgICAgICAgICAgICAgKCFwdXJlQmFyY29kZSB8fCB0aGlzLmNyb3NzQ2hlY2tEaWFnb25hbCgvKihpbnQpICovIE1hdGguZmxvb3IoY2VudGVySSksIC8qKGludCkgKi8gTWF0aC5mbG9vcihjZW50ZXJKKSwgc3RhdGVDb3VudFsyXSwgc3RhdGVDb3VudFRvdGFsKSkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IHN0YXRlQ291bnRUb3RhbCAvIDcuMDsKCSAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTsKCSAgICAgICAgICAgICAgICB2YXIgcG9zc2libGVDZW50ZXJzID0gdGhpcy5wb3NzaWJsZUNlbnRlcnM7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwLCBsZW5ndGhfMSA9IHBvc3NpYmxlQ2VudGVycy5sZW5ndGg7IGluZGV4IDwgbGVuZ3RoXzE7IGluZGV4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlciA9IHBvc3NpYmxlQ2VudGVyc1tpbmRleF07CgkgICAgICAgICAgICAgICAgICAgIC8vIExvb2sgZm9yIGFib3V0IHRoZSBzYW1lIGNlbnRlciBhbmQgbW9kdWxlIHNpemU6CgkgICAgICAgICAgICAgICAgICAgIGlmIChjZW50ZXIuYWJvdXRFcXVhbHMoZXN0aW1hdGVkTW9kdWxlU2l6ZSwgY2VudGVySSwgY2VudGVySikpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVyc1tpbmRleF0gPSBjZW50ZXIuY29tYmluZUVzdGltYXRlKGNlbnRlckksIGNlbnRlckosIGVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKCFmb3VuZCkgewoJICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnQgPSBuZXcgRmluZGVyUGF0dGVybl8xLmRlZmF1bHQoY2VudGVySiwgY2VudGVySSwgZXN0aW1hdGVkTW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVycy5wdXNoKHBvaW50KTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayAhPT0gbnVsbCAmJiB0aGlzLnJlc3VsdFBvaW50Q2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrLmZvdW5kUG9zc2libGVSZXN1bHRQb2ludChwb2ludCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2Ygcm93cyB3ZSBjb3VsZCBzYWZlbHkgc2tpcCBkdXJpbmcgc2Nhbm5pbmcsIGJhc2VkIG9uIHRoZSBmaXJzdAoJICAgICAqICAgICAgICAgdHdvIGZpbmRlciBwYXR0ZXJucyB0aGF0IGhhdmUgYmVlbiBsb2NhdGVkLiBJbiBzb21lIGNhc2VzIHRoZWlyIHBvc2l0aW9uIHdpbGwKCSAgICAgKiAgICAgICAgIGFsbG93IHVzIHRvIGluZmVyIHRoYXQgdGhlIHRoaXJkIHBhdHRlcm4gbXVzdCBsaWUgYmVsb3cgYSBjZXJ0YWluIHBvaW50IGZhcnRoZXIKCSAgICAgKiAgICAgICAgIGRvd24gaW4gdGhlIGltYWdlLgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmZpbmRSb3dTa2lwID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIG1heCA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgaWYgKG1heCA8PSAxKSB7CgkgICAgICAgICAgICByZXR1cm4gMDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgZmlyc3RDb25maXJtZWRDZW50ZXIgPSBudWxsOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgX2IgPSBfX3ZhbHVlcyh0aGlzLnBvc3NpYmxlQ2VudGVycyksIF9jID0gX2IubmV4dCgpOyAhX2MuZG9uZTsgX2MgPSBfYi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgY2VudGVyID0gX2MudmFsdWU7CgkgICAgICAgICAgICAgICAgaWYgKGNlbnRlci5nZXRDb3VudCgpID49IEZpbmRlclBhdHRlcm5GaW5kZXIuQ0VOVEVSX1FVT1JVTSkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoZmlyc3RDb25maXJtZWRDZW50ZXIgPT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RDb25maXJtZWRDZW50ZXIgPSBjZW50ZXI7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBoYXZlIHR3byBjb25maXJtZWQgY2VudGVycwoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gSG93IGZhciBkb3duIGNhbiB3ZSBza2lwIGJlZm9yZSByZXN1bWluZyBsb29raW5nIGZvciB0aGUgbmV4dAoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGF0dGVybj8gSW4gdGhlIHdvcnN0IGNhc2UsIG9ubHkgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiB0aGUKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRpZmZlcmVuY2UgaW4gdGhlIHggLyB5IGNvb3JkaW5hdGVzIG9mIHRoZSB0d28gY2VudGVycy4KCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGNhc2Ugd2hlcmUgeW91IGZpbmQgdG9wIGxlZnQgbGFzdC4KCSAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzU2tpcHBlZCA9IHRydWU7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLyooaW50KSAqLyBNYXRoLmZsb29yKChNYXRoLmFicyhmaXJzdENvbmZpcm1lZENlbnRlci5nZXRYKCkgLSBjZW50ZXIuZ2V0WCgpKSAtCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoZmlyc3RDb25maXJtZWRDZW50ZXIuZ2V0WSgpIC0gY2VudGVyLmdldFkoKSkpIC8gMik7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChfYyAmJiAhX2MuZG9uZSAmJiAoX2EgPSBfYi5yZXR1cm4pKSBfYS5jYWxsKF9iKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gdHJ1ZSBpZmYgd2UgaGF2ZSBmb3VuZCBhdCBsZWFzdCAzIGZpbmRlciBwYXR0ZXJucyB0aGF0IGhhdmUgYmVlbiBkZXRlY3RlZAoJICAgICAqICAgICAgICAgYXQgbGVhc3Qge0BsaW5rICNDRU5URVJfUVVPUlVNfSB0aW1lcyBlYWNoLCBhbmQsIHRoZSBlc3RpbWF0ZWQgbW9kdWxlIHNpemUgb2YgdGhlCgkgICAgICogICAgICAgICBjYW5kaWRhdGVzIGlzICJwcmV0dHkgc2ltaWxhciIKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8yLCBfYSwgZV8zLCBfYjsKCSAgICAgICAgdmFyIGNvbmZpcm1lZENvdW50ID0gMDsKCSAgICAgICAgdmFyIHRvdGFsTW9kdWxlU2l6ZSA9IDAuMDsKCSAgICAgICAgdmFyIG1heCA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIF9jID0gX192YWx1ZXModGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfZCA9IF9jLm5leHQoKTsgIV9kLmRvbmU7IF9kID0gX2MubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBfZC52YWx1ZTsKCSAgICAgICAgICAgICAgICBpZiAocGF0dGVybi5nZXRDb3VudCgpID49IEZpbmRlclBhdHRlcm5GaW5kZXIuQ0VOVEVSX1FVT1JVTSkgewoJICAgICAgICAgICAgICAgICAgICBjb25maXJtZWRDb3VudCsrOwoJICAgICAgICAgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gcGF0dGVybi5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzJfMSkgeyBlXzIgPSB7IGVycm9yOiBlXzJfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2QgJiYgIV9kLmRvbmUgJiYgKF9hID0gX2MucmV0dXJuKSkgX2EuY2FsbChfYyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMikgdGhyb3cgZV8yLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvbmZpcm1lZENvdW50IDwgMykgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIE9LLCB3ZSBoYXZlIGF0IGxlYXN0IDMgY29uZmlybWVkIGNlbnRlcnMsIGJ1dCwgaXQncyBwb3NzaWJsZSB0aGF0IG9uZSBpcyBhICJmYWxzZSBwb3NpdGl2ZSIKCSAgICAgICAgLy8gYW5kIHRoYXQgd2UgbmVlZCB0byBrZWVwIGxvb2tpbmcuIFdlIGRldGVjdCB0aGlzIGJ5IGFza2luZyBpZiB0aGUgZXN0aW1hdGVkIG1vZHVsZSBzaXplcwoJICAgICAgICAvLyB2YXJ5IHRvbyBtdWNoLiBXZSBhcmJpdHJhcmlseSBzYXkgdGhhdCB3aGVuIHRoZSB0b3RhbCBkZXZpYXRpb24gZnJvbSBhdmVyYWdlIGV4Y2VlZHMKCSAgICAgICAgLy8gNSUgb2YgdGhlIHRvdGFsIG1vZHVsZSBzaXplIGVzdGltYXRlcywgaXQncyB0b28gbXVjaC4KCSAgICAgICAgdmFyIGF2ZXJhZ2UgPSB0b3RhbE1vZHVsZVNpemUgLyBtYXg7CgkgICAgICAgIHZhciB0b3RhbERldmlhdGlvbiA9IDAuMDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIF9lID0gX192YWx1ZXModGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfZiA9IF9lLm5leHQoKTsgIV9mLmRvbmU7IF9mID0gX2UubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBfZi52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbERldmlhdGlvbiArPSBNYXRoLmFicyhwYXR0ZXJuLmdldEVzdGltYXRlZE1vZHVsZVNpemUoKSAtIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzNfMSkgeyBlXzMgPSB7IGVycm9yOiBlXzNfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2YgJiYgIV9mLmRvbmUgJiYgKF9iID0gX2UucmV0dXJuKSkgX2IuY2FsbChfZSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMykgdGhyb3cgZV8zLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRvdGFsRGV2aWF0aW9uIDw9IDAuMDUgKiB0b3RhbE1vZHVsZVNpemU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHRoZSAzIGJlc3Qge0BsaW5rIEZpbmRlclBhdHRlcm59cyBmcm9tIG91ciBsaXN0IG9mIGNhbmRpZGF0ZXMuIFRoZSAiYmVzdCIgYXJlCgkgICAgICogICAgICAgICB0aG9zZSB0aGF0IGhhdmUgYmVlbiBkZXRlY3RlZCBhdCBsZWFzdCB7QGxpbmsgI0NFTlRFUl9RVU9SVU19IHRpbWVzLCBhbmQgd2hvc2UgbW9kdWxlCgkgICAgICogICAgICAgICBzaXplIGRpZmZlcnMgZnJvbSB0aGUgYXZlcmFnZSBhbW9uZyB0aG9zZSBwYXR0ZXJucyB0aGUgbGVhc3QKCSAgICAgKiBAdGhyb3dzIE5vdEZvdW5kRXhjZXB0aW9uIGlmIDMgc3VjaCBmaW5kZXIgcGF0dGVybnMgZG8gbm90IGV4aXN0CgkgICAgICovCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuc2VsZWN0QmVzdFBhdHRlcm5zID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV80LCBfYSwgZV81LCBfYjsKCSAgICAgICAgdmFyIHN0YXJ0U2l6ZSA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgaWYgKHN0YXJ0U2l6ZSA8IDMpIHsKCSAgICAgICAgICAgIC8vIENvdWxkbid0IGZpbmQgZW5vdWdoIGZpbmRlciBwYXR0ZXJucwoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkMi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHBvc3NpYmxlQ2VudGVycyA9IHRoaXMucG9zc2libGVDZW50ZXJzOwoJICAgICAgICB2YXIgYXZlcmFnZTsKCSAgICAgICAgLy8gRmlsdGVyIG91dGxpZXIgcG9zc2liaWxpdGllcyB3aG9zZSBtb2R1bGUgc2l6ZSBpcyB0b28gZGlmZmVyZW50CgkgICAgICAgIGlmIChzdGFydFNpemUgPiAzKSB7CgkgICAgICAgICAgICAvLyBCdXQgd2UgY2FuIG9ubHkgYWZmb3JkIHRvIGRvIHNvIGlmIHdlIGhhdmUgYXQgbGVhc3QgNCBwb3NzaWJpbGl0aWVzIHRvIGNob29zZSBmcm9tCgkgICAgICAgICAgICB2YXIgdG90YWxNb2R1bGVTaXplID0gMC4wOwoJICAgICAgICAgICAgdmFyIHNxdWFyZSA9IDAuMDsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgX2MgPSBfX3ZhbHVlcyh0aGlzLnBvc3NpYmxlQ2VudGVycyksIF9kID0gX2MubmV4dCgpOyAhX2QuZG9uZTsgX2QgPSBfYy5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlciA9IF9kLnZhbHVlOwoJICAgICAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IGNlbnRlci5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCk7CgkgICAgICAgICAgICAgICAgICAgIHRvdGFsTW9kdWxlU2l6ZSArPSBzaXplOwoJICAgICAgICAgICAgICAgICAgICBzcXVhcmUgKz0gc2l6ZSAqIHNpemU7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgY2F0Y2ggKGVfNF8xKSB7IGVfNCA9IHsgZXJyb3I6IGVfNF8xIH07IH0KCSAgICAgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChfZCAmJiAhX2QuZG9uZSAmJiAoX2EgPSBfYy5yZXR1cm4pKSBfYS5jYWxsKF9jKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZmluYWxseSB7IGlmIChlXzQpIHRocm93IGVfNC5lcnJvcjsgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgYXZlcmFnZSA9IHRvdGFsTW9kdWxlU2l6ZSAvIHN0YXJ0U2l6ZTsKCSAgICAgICAgICAgIHZhciBzdGREZXYgPSBNYXRoLnNxcnQoc3F1YXJlIC8gc3RhcnRTaXplIC0gYXZlcmFnZSAqIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzLnNvcnQoCgkgICAgICAgICAgICAvKioKCSAgICAgICAgICAgICAqIDxwPk9yZGVycyBieSBmdXJ0aGVzdCBmcm9tIGF2ZXJhZ2U8L3A+CgkgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgIC8vIEZ1cnRoZXN0RnJvbUF2ZXJhZ2VDb21wYXJhdG9yIGltcGxlbWVudHMgQ29tcGFyYXRvcjxGaW5kZXJQYXR0ZXJuPgoJICAgICAgICAgICAgZnVuY3Rpb24gKGNlbnRlcjEsIGNlbnRlcjIpIHsKCSAgICAgICAgICAgICAgICB2YXIgZEEgPSBNYXRoLmFicyhjZW50ZXIyLmdldEVzdGltYXRlZE1vZHVsZVNpemUoKSAtIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgICAgIHZhciBkQiA9IE1hdGguYWJzKGNlbnRlcjEuZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpIC0gYXZlcmFnZSk7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGRBIDwgZEIgPyAtMSA6IGRBID4gZEIgPyAxIDogMDsKCSAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgdmFyIGxpbWl0ID0gTWF0aC5tYXgoMC4yICogYXZlcmFnZSwgc3RkRGV2KTsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcG9zc2libGVDZW50ZXJzLmxlbmd0aCAmJiBwb3NzaWJsZUNlbnRlcnMubGVuZ3RoID4gMzsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBwb3NzaWJsZUNlbnRlcnNbaV07CgkgICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHBhdHRlcm4uZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpIC0gYXZlcmFnZSkgPiBsaW1pdCkgewoJICAgICAgICAgICAgICAgICAgICBwb3NzaWJsZUNlbnRlcnMuc3BsaWNlKGksIDEpOwoJICAgICAgICAgICAgICAgICAgICBpLS07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGlmIChwb3NzaWJsZUNlbnRlcnMubGVuZ3RoID4gMykgewoJICAgICAgICAgICAgLy8gVGhyb3cgYXdheSBhbGwgYnV0IHRob3NlIGZpcnN0IHNpemUgY2FuZGlkYXRlIHBvaW50cyB3ZSBmb3VuZC4KCSAgICAgICAgICAgIHZhciB0b3RhbE1vZHVsZVNpemUgPSAwLjA7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGZvciAodmFyIHBvc3NpYmxlQ2VudGVyc18xID0gX192YWx1ZXMocG9zc2libGVDZW50ZXJzKSwgcG9zc2libGVDZW50ZXJzXzFfMSA9IHBvc3NpYmxlQ2VudGVyc18xLm5leHQoKTsgIXBvc3NpYmxlQ2VudGVyc18xXzEuZG9uZTsgcG9zc2libGVDZW50ZXJzXzFfMSA9IHBvc3NpYmxlQ2VudGVyc18xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgICAgICB2YXIgcG9zc2libGVDZW50ZXIgPSBwb3NzaWJsZUNlbnRlcnNfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gcG9zc2libGVDZW50ZXIuZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGNhdGNoIChlXzVfMSkgeyBlXzUgPSB7IGVycm9yOiBlXzVfMSB9OyB9CgkgICAgICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgICAgICBpZiAocG9zc2libGVDZW50ZXJzXzFfMSAmJiAhcG9zc2libGVDZW50ZXJzXzFfMS5kb25lICYmIChfYiA9IHBvc3NpYmxlQ2VudGVyc18xLnJldHVybikpIF9iLmNhbGwocG9zc2libGVDZW50ZXJzXzEpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfNSkgdGhyb3cgZV81LmVycm9yOyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBhdmVyYWdlID0gdG90YWxNb2R1bGVTaXplIC8gcG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVycy5zb3J0KAoJICAgICAgICAgICAgLyoqCgkgICAgICAgICAgICAgKiA8cD5PcmRlcnMgYnkge0BsaW5rIEZpbmRlclBhdHRlcm4jZ2V0Q291bnQoKX0sIGRlc2NlbmRpbmcuPC9wPgoJICAgICAgICAgICAgICovCgkgICAgICAgICAgICAvLyBDZW50ZXJDb21wYXJhdG9yIGltcGxlbWVudHMgQ29tcGFyYXRvcjxGaW5kZXJQYXR0ZXJuPgoJICAgICAgICAgICAgZnVuY3Rpb24gKGNlbnRlcjEsIGNlbnRlcjIpIHsKCSAgICAgICAgICAgICAgICBpZiAoY2VudGVyMi5nZXRDb3VudCgpID09PSBjZW50ZXIxLmdldENvdW50KCkpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGRBID0gTWF0aC5hYnMoY2VudGVyMi5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCkgLSBhdmVyYWdlKTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGRCID0gTWF0aC5hYnMoY2VudGVyMS5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCkgLSBhdmVyYWdlKTsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRBIDwgZEIgPyAxIDogZEEgPiBkQiA/IC0xIDogMDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBjZW50ZXIyLmdldENvdW50KCkgLSBjZW50ZXIxLmdldENvdW50KCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSk7CgkgICAgICAgICAgICBwb3NzaWJsZUNlbnRlcnMuc3BsaWNlKDMpOyAvLyB0aGlzIGlzIG5vdCByZWFseSBuZWNlc3NhcnkgYXMgd2Ugb25seSByZXR1cm4gZmlyc3QgMyBhbnl3YXkKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gWwoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzBdLAoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzFdLAoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzJdCgkgICAgICAgIF07CgkgICAgfTsKCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLkNFTlRFUl9RVU9SVU0gPSAyOwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuTUlOX1NLSVAgPSAzOyAvLyAxIHBpeGVsL21vZHVsZSB0aW1lcyAzIG1vZHVsZXMvY2VudGVyCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5NQVhfTU9EVUxFUyA9IDU3OyAvLyBzdXBwb3J0IHVwIHRvIHZlcnNpb24gMTAgZm9yIG1vYmlsZSBjbGllbnRzCgkgICAgcmV0dXJuIEZpbmRlclBhdHRlcm5GaW5kZXI7Cgl9KCkpOwoJRmluZGVyUGF0dGVybkZpbmRlciQxLmRlZmF1bHQgPSBGaW5kZXJQYXR0ZXJuRmluZGVyOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGV0ZWN0b3IkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIE1hdGhVdGlsc18xID0gTWF0aFV0aWxzJDE7Cgl2YXIgRGV0ZWN0b3JSZXN1bHRfMSA9IERldGVjdG9yUmVzdWx0JDE7CgkvLyBpbXBvcnQgR3JpZFNhbXBsZXIgZnJvbSAnLi4vLi4vY29tbW9uL0dyaWRTYW1wbGVyJzsKCXZhciBHcmlkU2FtcGxlckluc3RhbmNlXzEgPSBHcmlkU2FtcGxlckluc3RhbmNlJDE7Cgl2YXIgUGVyc3BlY3RpdmVUcmFuc2Zvcm1fMSA9IFBlcnNwZWN0aXZlVHJhbnNmb3JtJDE7Cgl2YXIgRGVjb2RlSGludFR5cGVfMSQxID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJdmFyIFJlc3VsdFBvaW50XzEgPSBSZXN1bHRQb2ludCQxOwoJdmFyIFZlcnNpb25fMSA9IFZlcnNpb24kMTsKCXZhciBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyXzEgPSBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyJDE7Cgl2YXIgRmluZGVyUGF0dGVybkZpbmRlcl8xID0gRmluZGVyUGF0dGVybkZpbmRlciQxOwoJLyppbXBvcnQgamF2YS51dGlsLk1hcDsqLwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgbG9naWMgdGhhdCBjYW4gZGV0ZWN0IGEgUVIgQ29kZSBpbiBhbiBpbWFnZSwgZXZlbiBpZiB0aGUgUVIgQ29kZQoJICogaXMgcm90YXRlZCBvciBza2V3ZWQsIG9yIHBhcnRpYWxseSBvYnNjdXJlZC48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERldGVjdG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIERldGVjdG9yKGltYWdlKSB7CgkgICAgICAgIHRoaXMuaW1hZ2UgPSBpbWFnZTsKCSAgICB9CgkgICAgRGV0ZWN0b3IucHJvdG90eXBlLmdldEltYWdlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5pbWFnZTsKCSAgICB9OwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5nZXRSZXN1bHRQb2ludENhbGxiYWNrID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZWN0cyBhIFFSIENvZGUgaW4gYW4gaW1hZ2UuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiB7QGxpbmsgRGV0ZWN0b3JSZXN1bHR9IGVuY2Fwc3VsYXRpbmcgcmVzdWx0cyBvZiBkZXRlY3RpbmcgYSBRUiBDb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBRUiBDb2RlIGNhbm5vdCBiZSBmb3VuZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIGEgUVIgQ29kZSBjYW5ub3QgYmUgZGVjb2RlZAoJICAgICAqLwoJICAgIC8vIHB1YmxpYyBkZXRlY3QoKTogRGV0ZWN0b3JSZXN1bHQgLyp0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiovIHsKCSAgICAvLyAgIHJldHVybiBkZXRlY3QobnVsbCkKCSAgICAvLyB9CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZWN0cyBhIFFSIENvZGUgaW4gYW4gaW1hZ2UuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGhpbnRzIG9wdGlvbmFsIGhpbnRzIHRvIGRldGVjdG9yCgkgICAgICogQHJldHVybiB7QGxpbmsgRGV0ZWN0b3JSZXN1bHR9IGVuY2Fwc3VsYXRpbmcgcmVzdWx0cyBvZiBkZXRlY3RpbmcgYSBRUiBDb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBRUiBDb2RlIGNhbm5vdCBiZSBmb3VuZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIGEgUVIgQ29kZSBjYW5ub3QgYmUgZGVjb2RlZAoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5kZXRlY3QgPSBmdW5jdGlvbiAoaGludHMpIHsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gKGhpbnRzID09PSBudWxsIHx8IGhpbnRzID09PSB1bmRlZmluZWQpID8gbnVsbCA6CgkgICAgICAgICAgICAvKihSZXN1bHRQb2ludENhbGxiYWNrKSAqLyBoaW50cy5nZXQoRGVjb2RlSGludFR5cGVfMSQxLmRlZmF1bHQuTkVFRF9SRVNVTFRfUE9JTlRfQ0FMTEJBQ0spOwoJICAgICAgICB2YXIgZmluZGVyID0gbmV3IEZpbmRlclBhdHRlcm5GaW5kZXJfMS5kZWZhdWx0KHRoaXMuaW1hZ2UsIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayk7CgkgICAgICAgIHZhciBpbmZvID0gZmluZGVyLmZpbmQoaGludHMpOwoJICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzRmluZGVyUGF0dGVybkluZm8oaW5mbyk7CgkgICAgfTsKCSAgICBEZXRlY3Rvci5wcm90b3R5cGUucHJvY2Vzc0ZpbmRlclBhdHRlcm5JbmZvID0gZnVuY3Rpb24gKGluZm8pIHsKCSAgICAgICAgdmFyIHRvcExlZnQgPSBpbmZvLmdldFRvcExlZnQoKTsKCSAgICAgICAgdmFyIHRvcFJpZ2h0ID0gaW5mby5nZXRUb3BSaWdodCgpOwoJICAgICAgICB2YXIgYm90dG9tTGVmdCA9IGluZm8uZ2V0Qm90dG9tTGVmdCgpOwoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRoaXMuY2FsY3VsYXRlTW9kdWxlU2l6ZSh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCk7CgkgICAgICAgIGlmIChtb2R1bGVTaXplIDwgMS4wKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQxLmRlZmF1bHQoJ05vIHBhdHRlcm4gZm91bmQgaW4gcHJvY2Nlc3MgZmluZGVyLicpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBkaW1lbnNpb24gPSBEZXRlY3Rvci5jb21wdXRlRGltZW5zaW9uKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIHByb3Zpc2lvbmFsVmVyc2lvbiA9IFZlcnNpb25fMS5kZWZhdWx0LmdldFByb3Zpc2lvbmFsVmVyc2lvbkZvckRpbWVuc2lvbihkaW1lbnNpb24pOwoJICAgICAgICB2YXIgbW9kdWxlc0JldHdlZW5GUENlbnRlcnMgPSBwcm92aXNpb25hbFZlcnNpb24uZ2V0RGltZW5zaW9uRm9yVmVyc2lvbigpIC0gNzsKCSAgICAgICAgdmFyIGFsaWdubWVudFBhdHRlcm4gPSBudWxsOwoJICAgICAgICAvLyBBbnl0aGluZyBhYm92ZSB2ZXJzaW9uIDEgaGFzIGFuIGFsaWdubWVudCBwYXR0ZXJuCgkgICAgICAgIGlmIChwcm92aXNpb25hbFZlcnNpb24uZ2V0QWxpZ25tZW50UGF0dGVybkNlbnRlcnMoKS5sZW5ndGggPiAwKSB7CgkgICAgICAgICAgICAvLyBHdWVzcyB3aGVyZSBhICJib3R0b20gcmlnaHQiIGZpbmRlciBwYXR0ZXJuIHdvdWxkIGhhdmUgYmVlbgoJICAgICAgICAgICAgdmFyIGJvdHRvbVJpZ2h0WCA9IHRvcFJpZ2h0LmdldFgoKSAtIHRvcExlZnQuZ2V0WCgpICsgYm90dG9tTGVmdC5nZXRYKCk7CgkgICAgICAgICAgICB2YXIgYm90dG9tUmlnaHRZID0gdG9wUmlnaHQuZ2V0WSgpIC0gdG9wTGVmdC5nZXRZKCkgKyBib3R0b21MZWZ0LmdldFkoKTsKCSAgICAgICAgICAgIC8vIEVzdGltYXRlIHRoYXQgYWxpZ25tZW50IHBhdHRlcm4gaXMgY2xvc2VyIGJ5IDMgbW9kdWxlcwoJICAgICAgICAgICAgLy8gZnJvbSAiYm90dG9tIHJpZ2h0IiB0byBrbm93biB0b3AgbGVmdCBsb2NhdGlvbgoJICAgICAgICAgICAgdmFyIGNvcnJlY3Rpb25Ub1RvcExlZnQgPSAxLjAgLSAzLjAgLyBtb2R1bGVzQmV0d2VlbkZQQ2VudGVyczsKCSAgICAgICAgICAgIHZhciBlc3RBbGlnbm1lbnRYID0gLyooaW50KSAqLyBNYXRoLmZsb29yKHRvcExlZnQuZ2V0WCgpICsgY29ycmVjdGlvblRvVG9wTGVmdCAqIChib3R0b21SaWdodFggLSB0b3BMZWZ0LmdldFgoKSkpOwoJICAgICAgICAgICAgdmFyIGVzdEFsaWdubWVudFkgPSAvKihpbnQpICovIE1hdGguZmxvb3IodG9wTGVmdC5nZXRZKCkgKyBjb3JyZWN0aW9uVG9Ub3BMZWZ0ICogKGJvdHRvbVJpZ2h0WSAtIHRvcExlZnQuZ2V0WSgpKSk7CgkgICAgICAgICAgICAvLyBLaW5kIG9mIGFyYml0cmFyeSAtLSBleHBhbmQgc2VhcmNoIHJhZGl1cyBiZWZvcmUgZ2l2aW5nIHVwCgkgICAgICAgICAgICBmb3IgKHZhciBpID0gNDsgaSA8PSAxNjsgaSA8PD0gMSkgewoJICAgICAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgICAgIGFsaWdubWVudFBhdHRlcm4gPSB0aGlzLmZpbmRBbGlnbm1lbnRJblJlZ2lvbihtb2R1bGVTaXplLCBlc3RBbGlnbm1lbnRYLCBlc3RBbGlnbm1lbnRZLCBpKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGNhdGNoIChyZSAvKk5vdEZvdW5kRXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCEocmUgaW5zdGFuY2VvZiBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IHJlOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIC8vIHRyeSBuZXh0IHJvdW5kCgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gSWYgd2UgZGlkbid0IGZpbmQgYWxpZ25tZW50IHBhdHRlcm4uLi4gd2VsbCB0cnkgYW55d2F5IHdpdGhvdXQgaXQKCSAgICAgICAgfQoJICAgICAgICB2YXIgdHJhbnNmb3JtID0gRGV0ZWN0b3IuY3JlYXRlVHJhbnNmb3JtKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBhbGlnbm1lbnRQYXR0ZXJuLCBkaW1lbnNpb24pOwoJICAgICAgICB2YXIgYml0cyA9IERldGVjdG9yLnNhbXBsZUdyaWQodGhpcy5pbWFnZSwgdHJhbnNmb3JtLCBkaW1lbnNpb24pOwoJICAgICAgICB2YXIgcG9pbnRzOwoJICAgICAgICBpZiAoYWxpZ25tZW50UGF0dGVybiA9PT0gbnVsbCkgewoJICAgICAgICAgICAgcG9pbnRzID0gW2JvdHRvbUxlZnQsIHRvcExlZnQsIHRvcFJpZ2h0XTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHBvaW50cyA9IFtib3R0b21MZWZ0LCB0b3BMZWZ0LCB0b3BSaWdodCwgYWxpZ25tZW50UGF0dGVybl07CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG5ldyBEZXRlY3RvclJlc3VsdF8xLmRlZmF1bHQoYml0cywgcG9pbnRzKTsKCSAgICB9OwoJICAgIERldGVjdG9yLmNyZWF0ZVRyYW5zZm9ybSA9IGZ1bmN0aW9uICh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCwgYWxpZ25tZW50UGF0dGVybiwgZGltZW5zaW9uIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGRpbU1pbnVzVGhyZWUgPSBkaW1lbnNpb24gLSAzLjU7CgkgICAgICAgIHZhciBib3R0b21SaWdodFg7IC8qZmxvYXQqLwoJICAgICAgICB2YXIgYm90dG9tUmlnaHRZOyAvKmZsb2F0Ki8KCSAgICAgICAgdmFyIHNvdXJjZUJvdHRvbVJpZ2h0WDsgLypmbG9hdCovCgkgICAgICAgIHZhciBzb3VyY2VCb3R0b21SaWdodFk7IC8qZmxvYXQqLwoJICAgICAgICBpZiAoYWxpZ25tZW50UGF0dGVybiAhPT0gbnVsbCkgewoJICAgICAgICAgICAgYm90dG9tUmlnaHRYID0gYWxpZ25tZW50UGF0dGVybi5nZXRYKCk7CgkgICAgICAgICAgICBib3R0b21SaWdodFkgPSBhbGlnbm1lbnRQYXR0ZXJuLmdldFkoKTsKCSAgICAgICAgICAgIHNvdXJjZUJvdHRvbVJpZ2h0WCA9IGRpbU1pbnVzVGhyZWUgLSAzLjA7CgkgICAgICAgICAgICBzb3VyY2VCb3R0b21SaWdodFkgPSBzb3VyY2VCb3R0b21SaWdodFg7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAvLyBEb24ndCBoYXZlIGFuIGFsaWdubWVudCBwYXR0ZXJuLCBqdXN0IG1ha2UgdXAgdGhlIGJvdHRvbS1yaWdodCBwb2ludAoJICAgICAgICAgICAgYm90dG9tUmlnaHRYID0gKHRvcFJpZ2h0LmdldFgoKSAtIHRvcExlZnQuZ2V0WCgpKSArIGJvdHRvbUxlZnQuZ2V0WCgpOwoJICAgICAgICAgICAgYm90dG9tUmlnaHRZID0gKHRvcFJpZ2h0LmdldFkoKSAtIHRvcExlZnQuZ2V0WSgpKSArIGJvdHRvbUxlZnQuZ2V0WSgpOwoJICAgICAgICAgICAgc291cmNlQm90dG9tUmlnaHRYID0gZGltTWludXNUaHJlZTsKCSAgICAgICAgICAgIHNvdXJjZUJvdHRvbVJpZ2h0WSA9IGRpbU1pbnVzVGhyZWU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIFBlcnNwZWN0aXZlVHJhbnNmb3JtXzEuZGVmYXVsdC5xdWFkcmlsYXRlcmFsVG9RdWFkcmlsYXRlcmFsKDMuNSwgMy41LCBkaW1NaW51c1RocmVlLCAzLjUsIHNvdXJjZUJvdHRvbVJpZ2h0WCwgc291cmNlQm90dG9tUmlnaHRZLCAzLjUsIGRpbU1pbnVzVGhyZWUsIHRvcExlZnQuZ2V0WCgpLCB0b3BMZWZ0LmdldFkoKSwgdG9wUmlnaHQuZ2V0WCgpLCB0b3BSaWdodC5nZXRZKCksIGJvdHRvbVJpZ2h0WCwgYm90dG9tUmlnaHRZLCBib3R0b21MZWZ0LmdldFgoKSwgYm90dG9tTGVmdC5nZXRZKCkpOwoJICAgIH07CgkgICAgRGV0ZWN0b3Iuc2FtcGxlR3JpZCA9IGZ1bmN0aW9uIChpbWFnZSwgdHJhbnNmb3JtLCBkaW1lbnNpb24gLyppbnQqLykgewoJICAgICAgICB2YXIgc2FtcGxlciA9IEdyaWRTYW1wbGVySW5zdGFuY2VfMS5kZWZhdWx0LmdldEluc3RhbmNlKCk7CgkgICAgICAgIHJldHVybiBzYW1wbGVyLnNhbXBsZUdyaWRXaXRoVHJhbnNmb3JtKGltYWdlLCBkaW1lbnNpb24sIGRpbWVuc2lvbiwgdHJhbnNmb3JtKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkNvbXB1dGVzIHRoZSBkaW1lbnNpb24gKG51bWJlciBvZiBtb2R1bGVzIG9uIGEgc2l6ZSkgb2YgdGhlIFFSIENvZGUgYmFzZWQgb24gdGhlIHBvc2l0aW9uCgkgICAgICogb2YgdGhlIGZpbmRlciBwYXR0ZXJucyBhbmQgZXN0aW1hdGVkIG1vZHVsZSBzaXplLjwvcD4KCSAgICAgKi8KCSAgICBEZXRlY3Rvci5jb21wdXRlRGltZW5zaW9uID0gZnVuY3Rpb24gKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBtb2R1bGVTaXplIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgdGx0ckNlbnRlcnNEaW1lbnNpb24gPSBNYXRoVXRpbHNfMS5kZWZhdWx0LnJvdW5kKFJlc3VsdFBvaW50XzEuZGVmYXVsdC5kaXN0YW5jZSh0b3BMZWZ0LCB0b3BSaWdodCkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIHRsYmxDZW50ZXJzRGltZW5zaW9uID0gTWF0aFV0aWxzXzEuZGVmYXVsdC5yb3VuZChSZXN1bHRQb2ludF8xLmRlZmF1bHQuZGlzdGFuY2UodG9wTGVmdCwgYm90dG9tTGVmdCkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IE1hdGguZmxvb3IoKHRsdHJDZW50ZXJzRGltZW5zaW9uICsgdGxibENlbnRlcnNEaW1lbnNpb24pIC8gMikgKyA3OwoJICAgICAgICBzd2l0Y2ggKGRpbWVuc2lvbiAmIDB4MDMpIHsgLy8gbW9kIDQKCSAgICAgICAgICAgIGNhc2UgMDoKCSAgICAgICAgICAgICAgICBkaW1lbnNpb24rKzsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIC8vIDE/IGRvIG5vdGhpbmcKCSAgICAgICAgICAgIGNhc2UgMjoKCSAgICAgICAgICAgICAgICBkaW1lbnNpb24tLTsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIGNhc2UgMzoKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQxLmRlZmF1bHQoJ0RpbWVuc2lvbnMgY291bGQgYmUgbm90IGZvdW5kLicpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBkaW1lbnNpb247CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5Db21wdXRlcyBhbiBhdmVyYWdlIGVzdGltYXRlZCBtb2R1bGUgc2l6ZSBiYXNlZCBvbiBlc3RpbWF0ZWQgZGVyaXZlZCBmcm9tIHRoZSBwb3NpdGlvbnMKCSAgICAgKiBvZiB0aGUgdGhyZWUgZmluZGVyIHBhdHRlcm5zLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB0b3BMZWZ0IGRldGVjdGVkIHRvcC1sZWZ0IGZpbmRlciBwYXR0ZXJuIGNlbnRlcgoJICAgICAqIEBwYXJhbSB0b3BSaWdodCBkZXRlY3RlZCB0b3AtcmlnaHQgZmluZGVyIHBhdHRlcm4gY2VudGVyCgkgICAgICogQHBhcmFtIGJvdHRvbUxlZnQgZGV0ZWN0ZWQgYm90dG9tLWxlZnQgZmluZGVyIHBhdHRlcm4gY2VudGVyCgkgICAgICogQHJldHVybiBlc3RpbWF0ZWQgbW9kdWxlIHNpemUKCSAgICAgKi8KCSAgICBEZXRlY3Rvci5wcm90b3R5cGUuY2FsY3VsYXRlTW9kdWxlU2l6ZSA9IGZ1bmN0aW9uICh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCkgewoJICAgICAgICAvLyBUYWtlIHRoZSBhdmVyYWdlCgkgICAgICAgIHJldHVybiAodGhpcy5jYWxjdWxhdGVNb2R1bGVTaXplT25lV2F5KHRvcExlZnQsIHRvcFJpZ2h0KSArCgkgICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZU1vZHVsZVNpemVPbmVXYXkodG9wTGVmdCwgYm90dG9tTGVmdCkpIC8gMi4wOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+RXN0aW1hdGVzIG1vZHVsZSBzaXplIGJhc2VkIG9uIHR3byBmaW5kZXIgcGF0dGVybnMgLS0gaXQgdXNlcwoJICAgICAqIHtAbGluayAjc2l6ZU9mQmxhY2tXaGl0ZUJsYWNrUnVuQm90aFdheXMoaW50LCBpbnQsIGludCwgaW50KX0gdG8gZmlndXJlIHRoZQoJICAgICAqIHdpZHRoIG9mIGVhY2gsIG1lYXN1cmluZyBhbG9uZyB0aGUgYXhpcyBiZXR3ZWVuIHRoZWlyIGNlbnRlcnMuPC9wPgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5jYWxjdWxhdGVNb2R1bGVTaXplT25lV2F5ID0gZnVuY3Rpb24gKHBhdHRlcm4sIG90aGVyUGF0dGVybikgewoJICAgICAgICB2YXIgbW9kdWxlU2l6ZUVzdDEgPSB0aGlzLnNpemVPZkJsYWNrV2hpdGVCbGFja1J1bkJvdGhXYXlzKC8qKGludCkgKi8gTWF0aC5mbG9vcihwYXR0ZXJuLmdldFgoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3IocGF0dGVybi5nZXRZKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKG90aGVyUGF0dGVybi5nZXRYKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKG90aGVyUGF0dGVybi5nZXRZKCkpKTsKCSAgICAgICAgdmFyIG1vZHVsZVNpemVFc3QyID0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW5Cb3RoV2F5cygvKihpbnQpICovIE1hdGguZmxvb3Iob3RoZXJQYXR0ZXJuLmdldFgoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3Iob3RoZXJQYXR0ZXJuLmdldFkoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3IocGF0dGVybi5nZXRYKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKHBhdHRlcm4uZ2V0WSgpKSk7CgkgICAgICAgIGlmIChpc05hTihtb2R1bGVTaXplRXN0MSkpIHsKCSAgICAgICAgICAgIHJldHVybiBtb2R1bGVTaXplRXN0MiAvIDcuMDsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaXNOYU4obW9kdWxlU2l6ZUVzdDIpKSB7CgkgICAgICAgICAgICByZXR1cm4gbW9kdWxlU2l6ZUVzdDEgLyA3LjA7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQXZlcmFnZSB0aGVtLCBhbmQgZGl2aWRlIGJ5IDcgc2luY2Ugd2UndmUgY291bnRlZCB0aGUgd2lkdGggb2YgMyBibGFjayBtb2R1bGVzLAoJICAgICAgICAvLyBhbmQgMSB3aGl0ZSBhbmQgMSBibGFjayBtb2R1bGUgb24gZWl0aGVyIHNpZGUuIEVyZ28sIGRpdmlkZSBzdW0gYnkgMTQuCgkgICAgICAgIHJldHVybiAobW9kdWxlU2l6ZUVzdDEgKyBtb2R1bGVTaXplRXN0MikgLyAxNC4wOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogU2VlIHtAbGluayAjc2l6ZU9mQmxhY2tXaGl0ZUJsYWNrUnVuKGludCwgaW50LCBpbnQsIGludCl9OyBjb21wdXRlcyB0aGUgdG90YWwgd2lkdGggb2YKCSAgICAgKiBhIGZpbmRlciBwYXR0ZXJuIGJ5IGxvb2tpbmcgZm9yIGEgYmxhY2std2hpdGUtYmxhY2sgcnVuIGZyb20gdGhlIGNlbnRlciBpbiB0aGUgZGlyZWN0aW9uCgkgICAgICogb2YgYW5vdGhlciBwb2ludCAoYW5vdGhlciBmaW5kZXIgcGF0dGVybiBjZW50ZXIpLCBhbmQgaW4gdGhlIG9wcG9zaXRlIGRpcmVjdGlvbiB0b28uCgkgICAgICovCgkgICAgRGV0ZWN0b3IucHJvdG90eXBlLnNpemVPZkJsYWNrV2hpdGVCbGFja1J1bkJvdGhXYXlzID0gZnVuY3Rpb24gKGZyb21YIC8qaW50Ki8sIGZyb21ZIC8qaW50Ki8sIHRvWCAvKmludCovLCB0b1kgLyppbnQqLykgewoJICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4oZnJvbVgsIGZyb21ZLCB0b1gsIHRvWSk7CgkgICAgICAgIC8vIE5vdyBjb3VudCBvdGhlciB3YXkgLS0gZG9uJ3QgcnVuIG9mZiBpbWFnZSB0aG91Z2ggb2YgY291cnNlCgkgICAgICAgIHZhciBzY2FsZSA9IDEuMDsKCSAgICAgICAgdmFyIG90aGVyVG9YID0gZnJvbVggLSAodG9YIC0gZnJvbVgpOwoJICAgICAgICBpZiAob3RoZXJUb1ggPCAwKSB7CgkgICAgICAgICAgICBzY2FsZSA9IGZyb21YIC8gLyooZmxvYXQpICovIChmcm9tWCAtIG90aGVyVG9YKTsKCSAgICAgICAgICAgIG90aGVyVG9YID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChvdGhlclRvWCA+PSB0aGlzLmltYWdlLmdldFdpZHRoKCkpIHsKCSAgICAgICAgICAgIHNjYWxlID0gKHRoaXMuaW1hZ2UuZ2V0V2lkdGgoKSAtIDEgLSBmcm9tWCkgLyAvKihmbG9hdCkgKi8gKG90aGVyVG9YIC0gZnJvbVgpOwoJICAgICAgICAgICAgb3RoZXJUb1ggPSB0aGlzLmltYWdlLmdldFdpZHRoKCkgLSAxOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlclRvWSA9IC8qKGludCkgKi8gTWF0aC5mbG9vcihmcm9tWSAtICh0b1kgLSBmcm9tWSkgKiBzY2FsZSk7CgkgICAgICAgIHNjYWxlID0gMS4wOwoJICAgICAgICBpZiAob3RoZXJUb1kgPCAwKSB7CgkgICAgICAgICAgICBzY2FsZSA9IGZyb21ZIC8gLyooZmxvYXQpICovIChmcm9tWSAtIG90aGVyVG9ZKTsKCSAgICAgICAgICAgIG90aGVyVG9ZID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChvdGhlclRvWSA+PSB0aGlzLmltYWdlLmdldEhlaWdodCgpKSB7CgkgICAgICAgICAgICBzY2FsZSA9ICh0aGlzLmltYWdlLmdldEhlaWdodCgpIC0gMSAtIGZyb21ZKSAvIC8qKGZsb2F0KSAqLyAob3RoZXJUb1kgLSBmcm9tWSk7CgkgICAgICAgICAgICBvdGhlclRvWSA9IHRoaXMuaW1hZ2UuZ2V0SGVpZ2h0KCkgLSAxOwoJICAgICAgICB9CgkgICAgICAgIG90aGVyVG9YID0gLyooaW50KSAqLyBNYXRoLmZsb29yKGZyb21YICsgKG90aGVyVG9YIC0gZnJvbVgpICogc2NhbGUpOwoJICAgICAgICByZXN1bHQgKz0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4oZnJvbVgsIGZyb21ZLCBvdGhlclRvWCwgb3RoZXJUb1kpOwoJICAgICAgICAvLyBNaWRkbGUgcGl4ZWwgaXMgZG91YmxlLWNvdW50ZWQgdGhpcyB3YXk7IHN1YnRyYWN0IDEKCSAgICAgICAgcmV0dXJuIHJlc3VsdCAtIDEuMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlRoaXMgbWV0aG9kIHRyYWNlcyBhIGxpbmUgZnJvbSBhIHBvaW50IGluIHRoZSBpbWFnZSwgaW4gdGhlIGRpcmVjdGlvbiB0b3dhcmRzIGFub3RoZXIgcG9pbnQuCgkgICAgICogSXQgYmVnaW5zIGluIGEgYmxhY2sgcmVnaW9uLCBhbmQga2VlcHMgZ29pbmcgdW50aWwgaXQgZmluZHMgd2hpdGUsIHRoZW4gYmxhY2ssIHRoZW4gd2hpdGUgYWdhaW4uCgkgICAgICogSXQgcmVwb3J0cyB0aGUgZGlzdGFuY2UgZnJvbSB0aGUgc3RhcnQgdG8gdGhpcyBwb2ludC48L3A+CgkgICAgICoKCSAgICAgKiA8cD5UaGlzIGlzIHVzZWQgd2hlbiBmaWd1cmluZyBvdXQgaG93IHdpZGUgYSBmaW5kZXIgcGF0dGVybiBpcywgd2hlbiB0aGUgZmluZGVyIHBhdHRlcm4KCSAgICAgKiBtYXkgYmUgc2tld2VkIG9yIHJvdGF0ZWQuPC9wPgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4gPSBmdW5jdGlvbiAoZnJvbVggLyppbnQqLywgZnJvbVkgLyppbnQqLywgdG9YIC8qaW50Ki8sIHRvWSAvKmludCovKSB7CgkgICAgICAgIC8vIE1pbGQgdmFyaWFudCBvZiBCcmVzZW5oYW0ncyBhbGdvcml0aG0KCSAgICAgICAgLy8gc2VlIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQnJlc2VuaGFtJ3NfbGluZV9hbGdvcml0aG0KCSAgICAgICAgdmFyIHN0ZWVwID0gTWF0aC5hYnModG9ZIC0gZnJvbVkpID4gTWF0aC5hYnModG9YIC0gZnJvbVgpOwoJICAgICAgICBpZiAoc3RlZXApIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gZnJvbVg7CgkgICAgICAgICAgICBmcm9tWCA9IGZyb21ZOwoJICAgICAgICAgICAgZnJvbVkgPSB0ZW1wOwoJICAgICAgICAgICAgdGVtcCA9IHRvWDsKCSAgICAgICAgICAgIHRvWCA9IHRvWTsKCSAgICAgICAgICAgIHRvWSA9IHRlbXA7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGR4ID0gTWF0aC5hYnModG9YIC0gZnJvbVgpOwoJICAgICAgICB2YXIgZHkgPSBNYXRoLmFicyh0b1kgLSBmcm9tWSk7CgkgICAgICAgIHZhciBlcnJvciA9IC1keCAvIDI7CgkgICAgICAgIHZhciB4c3RlcCA9IGZyb21YIDwgdG9YID8gMSA6IC0xOwoJICAgICAgICB2YXIgeXN0ZXAgPSBmcm9tWSA8IHRvWSA/IDEgOiAtMTsKCSAgICAgICAgLy8gSW4gYmxhY2sgcGl4ZWxzLCBsb29raW5nIGZvciB3aGl0ZSwgZmlyc3Qgb3Igc2Vjb25kIHRpbWUuCgkgICAgICAgIHZhciBzdGF0ZSA9IDA7CgkgICAgICAgIC8vIExvb3AgdXAgdW50aWwgeCA9PSB0b1gsIGJ1dCBub3QgYmV5b25kCgkgICAgICAgIHZhciB4TGltaXQgPSB0b1ggKyB4c3RlcDsKCSAgICAgICAgZm9yICh2YXIgeCA9IGZyb21YLCB5ID0gZnJvbVk7IHggIT09IHhMaW1pdDsgeCArPSB4c3RlcCkgewoJICAgICAgICAgICAgdmFyIHJlYWxYID0gc3RlZXAgPyB5IDogeDsKCSAgICAgICAgICAgIHZhciByZWFsWSA9IHN0ZWVwID8geCA6IHk7CgkgICAgICAgICAgICAvLyBEb2VzIGN1cnJlbnQgcGl4ZWwgbWVhbiB3ZSBoYXZlIG1vdmVkIHdoaXRlIHRvIGJsYWNrIG9yIHZpY2UgdmVyc2E/CgkgICAgICAgICAgICAvLyBTY2FubmluZyBibGFjayBpbiBzdGF0ZSAwLDIgYW5kIHdoaXRlIGluIHN0YXRlIDEsIHNvIGlmIHdlIGZpbmQgdGhlIHdyb25nCgkgICAgICAgICAgICAvLyBjb2xvciwgYWR2YW5jZSB0byBuZXh0IHN0YXRlIG9yIGVuZCBpZiB3ZSBhcmUgaW4gc3RhdGUgMiBhbHJlYWR5CgkgICAgICAgICAgICBpZiAoKHN0YXRlID09PSAxKSA9PT0gdGhpcy5pbWFnZS5nZXQocmVhbFgsIHJlYWxZKSkgewoJICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gMikgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aFV0aWxzXzEuZGVmYXVsdC5kaXN0YW5jZSh4LCB5LCBmcm9tWCwgZnJvbVkpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBzdGF0ZSsrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZXJyb3IgKz0gZHk7CgkgICAgICAgICAgICBpZiAoZXJyb3IgPiAwKSB7CgkgICAgICAgICAgICAgICAgaWYgKHkgPT09IHRvWSkgewoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgeSArPSB5c3RlcDsKCSAgICAgICAgICAgICAgICBlcnJvciAtPSBkeDsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICAvLyBGb3VuZCBibGFjay13aGl0ZS1ibGFjazsgZ2l2ZSB0aGUgYmVuZWZpdCBvZiB0aGUgZG91YnQgdGhhdCB0aGUgbmV4dCBwaXhlbCBvdXRzaWRlIHRoZSBpbWFnZQoJICAgICAgICAvLyBpcyAid2hpdGUiIHNvIHRoaXMgbGFzdCBwb2ludCBhdCAodG9YK3hTdGVwLHRvWSkgaXMgdGhlIHJpZ2h0IGVuZGluZy4gVGhpcyBpcyByZWFsbHkgYQoJICAgICAgICAvLyBzbWFsbCBhcHByb3hpbWF0aW9uOyAodG9YK3hTdGVwLHRvWSt5U3RlcCkgbWlnaHQgYmUgcmVhbGx5IGNvcnJlY3QuIElnbm9yZSB0aGlzLgoJICAgICAgICBpZiAoc3RhdGUgPT09IDIpIHsKCSAgICAgICAgICAgIHJldHVybiBNYXRoVXRpbHNfMS5kZWZhdWx0LmRpc3RhbmNlKHRvWCArIHhzdGVwLCB0b1ksIGZyb21YLCBmcm9tWSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gZWxzZSB3ZSBkaWRuJ3QgZmluZCBldmVuIGJsYWNrLXdoaXRlLWJsYWNrOyBubyBlc3RpbWF0ZSBpcyByZWFsbHkgcG9zc2libGUKCSAgICAgICAgcmV0dXJuIE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkF0dGVtcHRzIHRvIGxvY2F0ZSBhbiBhbGlnbm1lbnQgcGF0dGVybiBpbiBhIGxpbWl0ZWQgcmVnaW9uIG9mIHRoZSBpbWFnZSwgd2hpY2ggaXMKCSAgICAgKiBndWVzc2VkIHRvIGNvbnRhaW4gaXQuIFRoaXMgbWV0aG9kIHVzZXMge0BsaW5rIEFsaWdubWVudFBhdHRlcm59LjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBvdmVyYWxsRXN0TW9kdWxlU2l6ZSBlc3RpbWF0ZWQgbW9kdWxlIHNpemUgc28gZmFyCgkgICAgICogQHBhcmFtIGVzdEFsaWdubWVudFggeCBjb29yZGluYXRlIG9mIGNlbnRlciBvZiBhcmVhIHByb2JhYmx5IGNvbnRhaW5pbmcgYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gZXN0QWxpZ25tZW50WSB5IGNvb3JkaW5hdGUgb2YgYWJvdmUKCSAgICAgKiBAcGFyYW0gYWxsb3dhbmNlRmFjdG9yIG51bWJlciBvZiBwaXhlbHMgaW4gYWxsIGRpcmVjdGlvbnMgdG8gc2VhcmNoIGZyb20gdGhlIGNlbnRlcgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEFsaWdubWVudFBhdHRlcm59IGlmIGZvdW5kLCBvciBudWxsIG90aGVyd2lzZQoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgYW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnMgZHVyaW5nIGRldGVjdGlvbgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5maW5kQWxpZ25tZW50SW5SZWdpb24gPSBmdW5jdGlvbiAob3ZlcmFsbEVzdE1vZHVsZVNpemUgLypmbG9hdCovLCBlc3RBbGlnbm1lbnRYIC8qaW50Ki8sIGVzdEFsaWdubWVudFkgLyppbnQqLywgYWxsb3dhbmNlRmFjdG9yIC8qZmxvYXQqLykgewoJICAgICAgICAvLyBMb29rIGZvciBhbiBhbGlnbm1lbnQgcGF0dGVybiAoMyBtb2R1bGVzIGluIHNpemUpIGFyb3VuZCB3aGVyZSBpdAoJICAgICAgICAvLyBzaG91bGQgYmUKCSAgICAgICAgdmFyIGFsbG93YW5jZSA9IC8qKGludCkgKi8gTWF0aC5mbG9vcihhbGxvd2FuY2VGYWN0b3IgKiBvdmVyYWxsRXN0TW9kdWxlU2l6ZSk7CgkgICAgICAgIHZhciBhbGlnbm1lbnRBcmVhTGVmdFggPSBNYXRoLm1heCgwLCBlc3RBbGlnbm1lbnRYIC0gYWxsb3dhbmNlKTsKCSAgICAgICAgdmFyIGFsaWdubWVudEFyZWFSaWdodFggPSBNYXRoLm1pbih0aGlzLmltYWdlLmdldFdpZHRoKCkgLSAxLCBlc3RBbGlnbm1lbnRYICsgYWxsb3dhbmNlKTsKCSAgICAgICAgaWYgKGFsaWdubWVudEFyZWFSaWdodFggLSBhbGlnbm1lbnRBcmVhTGVmdFggPCBvdmVyYWxsRXN0TW9kdWxlU2l6ZSAqIDMpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgnQWxpZ25tZW50IHRvcCBleGNlZWRzIGVzdGltYXRlZCBtb2R1bGUgc2l6ZS4nKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYWxpZ25tZW50QXJlYVRvcFkgPSBNYXRoLm1heCgwLCBlc3RBbGlnbm1lbnRZIC0gYWxsb3dhbmNlKTsKCSAgICAgICAgdmFyIGFsaWdubWVudEFyZWFCb3R0b21ZID0gTWF0aC5taW4odGhpcy5pbWFnZS5nZXRIZWlnaHQoKSAtIDEsIGVzdEFsaWdubWVudFkgKyBhbGxvd2FuY2UpOwoJICAgICAgICBpZiAoYWxpZ25tZW50QXJlYUJvdHRvbVkgLSBhbGlnbm1lbnRBcmVhVG9wWSA8IG92ZXJhbGxFc3RNb2R1bGVTaXplICogMykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkMS5kZWZhdWx0KCdBbGlnbm1lbnQgYm90dG9tIGV4Y2VlZHMgZXN0aW1hdGVkIG1vZHVsZSBzaXplLicpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBhbGlnbm1lbnRGaW5kZXIgPSBuZXcgQWxpZ25tZW50UGF0dGVybkZpbmRlcl8xLmRlZmF1bHQodGhpcy5pbWFnZSwgYWxpZ25tZW50QXJlYUxlZnRYLCBhbGlnbm1lbnRBcmVhVG9wWSwgYWxpZ25tZW50QXJlYVJpZ2h0WCAtIGFsaWdubWVudEFyZWFMZWZ0WCwgYWxpZ25tZW50QXJlYUJvdHRvbVkgLSBhbGlnbm1lbnRBcmVhVG9wWSwgb3ZlcmFsbEVzdE1vZHVsZVNpemUsIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayk7CgkgICAgICAgIHJldHVybiBhbGlnbm1lbnRGaW5kZXIuZmluZCgpOwoJICAgIH07CgkgICAgcmV0dXJuIERldGVjdG9yOwoJfSgpKTsKCURldGVjdG9yJDEuZGVmYXVsdCA9IERldGVjdG9yOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoUVJDb2RlUmVhZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcucXJjb2RlIHsqLwoJdmFyIEJhcmNvZGVGb3JtYXRfMSA9IEJhcmNvZGVGb3JtYXQkMTsKCXZhciBCaXRNYXRyaXhfMSA9IEJpdE1hdHJpeCQxOwoJdmFyIERlY29kZUhpbnRUeXBlXzEgPSBEZWNvZGVIaW50VHlwZSQxOwoJdmFyIE5vdEZvdW5kRXhjZXB0aW9uXzEgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJdmFyIFJlc3VsdF8xID0gUmVzdWx0JDE7Cgl2YXIgUmVzdWx0TWV0YWRhdGFUeXBlXzEgPSBSZXN1bHRNZXRhZGF0YVR5cGUkMTsKCS8vIGltcG9ydCBEZXRlY3RvclJlc3VsdCBmcm9tICcuLi9jb21tb24vRGV0ZWN0b3JSZXN1bHQnOwoJdmFyIERlY29kZXJfMSA9IERlY29kZXIkMTsKCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSA9IFFSQ29kZURlY29kZXJNZXRhRGF0YSQxOwoJdmFyIERldGVjdG9yXzEgPSBEZXRlY3RvciQxOwoJLyppbXBvcnQgamF2YS51dGlsLkxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5NYXA7Ki8KCS8qKgoJICogVGhpcyBpbXBsZW1lbnRhdGlvbiBjYW4gZGV0ZWN0IGFuZCBkZWNvZGUgUVIgQ29kZXMgaW4gYW4gaW1hZ2UuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFFSQ29kZVJlYWRlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBRUkNvZGVSZWFkZXIoKSB7CgkgICAgICAgIHRoaXMuZGVjb2RlciA9IG5ldyBEZWNvZGVyXzEuZGVmYXVsdCgpOwoJICAgIH0KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLmdldERlY29kZXIgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlY29kZXI7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBMb2NhdGVzIGFuZCBkZWNvZGVzIGEgUVIgY29kZSBpbiBhbiBpbWFnZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gYSByZXByZXNlbnRpbmc6IHN0cmluZyB0aGUgY29udGVudCBlbmNvZGVkIGJ5IHRoZSBRUiBjb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBhIFFSIGNvZGUgY2Fubm90IGJlIGZvdW5kCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgYSBRUiBjb2RlIGNhbm5vdCBiZSBkZWNvZGVkCgkgICAgICogQHRocm93cyBDaGVja3N1bUV4Y2VwdGlvbiBpZiBlcnJvciBjb3JyZWN0aW9uIGZhaWxzCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIC8vIHB1YmxpYyBkZWNvZGUoaW1hZ2U6IEJpbmFyeUJpdG1hcCk6IFJlc3VsdCAvKnRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiwgQ2hlY2tzdW1FeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiAqLyB7CgkgICAgLy8gICByZXR1cm4gdGhpcy5kZWNvZGUoaW1hZ2UsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLmRlY29kZSA9IGZ1bmN0aW9uIChpbWFnZSwgaGludHMpIHsKCSAgICAgICAgdmFyIGRlY29kZXJSZXN1bHQ7CgkgICAgICAgIHZhciBwb2ludHM7CgkgICAgICAgIGlmIChoaW50cyAhPT0gdW5kZWZpbmVkICYmIGhpbnRzICE9PSBudWxsICYmIHVuZGVmaW5lZCAhPT0gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEuZGVmYXVsdC5QVVJFX0JBUkNPREUpKSB7CgkgICAgICAgICAgICB2YXIgYml0cyA9IFFSQ29kZVJlYWRlci5leHRyYWN0UHVyZUJpdHMoaW1hZ2UuZ2V0QmxhY2tNYXRyaXgoKSk7CgkgICAgICAgICAgICBkZWNvZGVyUmVzdWx0ID0gdGhpcy5kZWNvZGVyLmRlY29kZUJpdE1hdHJpeChiaXRzLCBoaW50cyk7CgkgICAgICAgICAgICBwb2ludHMgPSBRUkNvZGVSZWFkZXIuTk9fUE9JTlRTOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdmFyIGRldGVjdG9yUmVzdWx0ID0gbmV3IERldGVjdG9yXzEuZGVmYXVsdChpbWFnZS5nZXRCbGFja01hdHJpeCgpKS5kZXRlY3QoaGludHMpOwoJICAgICAgICAgICAgZGVjb2RlclJlc3VsdCA9IHRoaXMuZGVjb2Rlci5kZWNvZGVCaXRNYXRyaXgoZGV0ZWN0b3JSZXN1bHQuZ2V0Qml0cygpLCBoaW50cyk7CgkgICAgICAgICAgICBwb2ludHMgPSBkZXRlY3RvclJlc3VsdC5nZXRQb2ludHMoKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBJZiB0aGUgY29kZSB3YXMgbWlycm9yZWQ6IHN3YXAgdGhlIGJvdHRvbS1sZWZ0IGFuZCB0aGUgdG9wLXJpZ2h0IHBvaW50cy4KCSAgICAgICAgaWYgKGRlY29kZXJSZXN1bHQuZ2V0T3RoZXIoKSBpbnN0YW5jZW9mIFFSQ29kZURlY29kZXJNZXRhRGF0YV8xLmRlZmF1bHQpIHsKCSAgICAgICAgICAgIGRlY29kZXJSZXN1bHQuZ2V0T3RoZXIoKS5hcHBseU1pcnJvcmVkQ29ycmVjdGlvbihwb2ludHMpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSBuZXcgUmVzdWx0XzEuZGVmYXVsdChkZWNvZGVyUmVzdWx0LmdldFRleHQoKSwgZGVjb2RlclJlc3VsdC5nZXRSYXdCeXRlcygpLCB1bmRlZmluZWQsIHBvaW50cywgQmFyY29kZUZvcm1hdF8xLmRlZmF1bHQuUVJfQ09ERSwgdW5kZWZpbmVkKTsKCSAgICAgICAgdmFyIGJ5dGVTZWdtZW50cyA9IGRlY29kZXJSZXN1bHQuZ2V0Qnl0ZVNlZ21lbnRzKCk7CgkgICAgICAgIGlmIChieXRlU2VnbWVudHMgIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJlc3VsdC5wdXRNZXRhZGF0YShSZXN1bHRNZXRhZGF0YVR5cGVfMS5kZWZhdWx0LkJZVEVfU0VHTUVOVFMsIGJ5dGVTZWdtZW50cyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGVjTGV2ZWwgPSBkZWNvZGVyUmVzdWx0LmdldEVDTGV2ZWwoKTsKCSAgICAgICAgaWYgKGVjTGV2ZWwgIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJlc3VsdC5wdXRNZXRhZGF0YShSZXN1bHRNZXRhZGF0YVR5cGVfMS5kZWZhdWx0LkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwsIGVjTGV2ZWwpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChkZWNvZGVyUmVzdWx0Lmhhc1N0cnVjdHVyZWRBcHBlbmQoKSkgewoJICAgICAgICAgICAgcmVzdWx0LnB1dE1ldGFkYXRhKFJlc3VsdE1ldGFkYXRhVHlwZV8xLmRlZmF1bHQuU1RSVUNUVVJFRF9BUFBFTkRfU0VRVUVOQ0UsIGRlY29kZXJSZXN1bHQuZ2V0U3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyKCkpOwoJICAgICAgICAgICAgcmVzdWx0LnB1dE1ldGFkYXRhKFJlc3VsdE1ldGFkYXRhVHlwZV8xLmRlZmF1bHQuU1RSVUNUVVJFRF9BUFBFTkRfUEFSSVRZLCBkZWNvZGVyUmVzdWx0LmdldFN0cnVjdHVyZWRBcHBlbmRQYXJpdHkoKSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBkbyBub3RoaW5nCgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBUaGlzIG1ldGhvZCBkZXRlY3RzIGEgY29kZSBpbiBhICJwdXJlIiBpbWFnZSAtLSB0aGF0IGlzLCBwdXJlIG1vbm9jaHJvbWUgaW1hZ2UKCSAgICAgKiB3aGljaCBjb250YWlucyBvbmx5IGFuIHVucm90YXRlZCwgdW5za2V3ZWQsIGltYWdlIG9mIGEgY29kZSwgd2l0aCBzb21lIHdoaXRlIGJvcmRlcgoJICAgICAqIGFyb3VuZCBpdC4gVGhpcyBpcyBhIHNwZWNpYWxpemVkIG1ldGhvZCB0aGF0IHdvcmtzIGV4Y2VwdGlvbmFsbHkgZmFzdCBpbiB0aGlzIHNwZWNpYWwKCSAgICAgKiBjYXNlLgoJICAgICAqCgkgICAgICogQHNlZSBjb20uZ29vZ2xlLnp4aW5nLmRhdGFtYXRyaXguRGF0YU1hdHJpeFJlYWRlciNleHRyYWN0UHVyZUJpdHMoQml0TWF0cml4KQoJICAgICAqLwoJICAgIFFSQ29kZVJlYWRlci5leHRyYWN0UHVyZUJpdHMgPSBmdW5jdGlvbiAoaW1hZ2UpIHsKCSAgICAgICAgdmFyIGxlZnRUb3BCbGFjayA9IGltYWdlLmdldFRvcExlZnRPbkJpdCgpOwoJICAgICAgICB2YXIgcmlnaHRCb3R0b21CbGFjayA9IGltYWdlLmdldEJvdHRvbVJpZ2h0T25CaXQoKTsKCSAgICAgICAgaWYgKGxlZnRUb3BCbGFjayA9PT0gbnVsbCB8fCByaWdodEJvdHRvbUJsYWNrID09PSBudWxsKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG1vZHVsZVNpemUgPSB0aGlzLm1vZHVsZVNpemUobGVmdFRvcEJsYWNrLCBpbWFnZSk7CgkgICAgICAgIHZhciB0b3AgPSBsZWZ0VG9wQmxhY2tbMV07CgkgICAgICAgIHZhciBib3R0b20gPSByaWdodEJvdHRvbUJsYWNrWzFdOwoJICAgICAgICB2YXIgbGVmdCA9IGxlZnRUb3BCbGFja1swXTsKCSAgICAgICAgdmFyIHJpZ2h0ID0gcmlnaHRCb3R0b21CbGFja1swXTsKCSAgICAgICAgLy8gU2FuaXR5IGNoZWNrIQoJICAgICAgICBpZiAobGVmdCA+PSByaWdodCB8fCB0b3AgPj0gYm90dG9tKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGJvdHRvbSAtIHRvcCAhPT0gcmlnaHQgLSBsZWZ0KSB7CgkgICAgICAgICAgICAvLyBTcGVjaWFsIGNhc2UsIHdoZXJlIGJvdHRvbS1yaWdodCBtb2R1bGUgd2Fzbid0IGJsYWNrIHNvIHdlIGZvdW5kIHNvbWV0aGluZyBlbHNlIGluIHRoZSBsYXN0IHJvdwoJICAgICAgICAgICAgLy8gQXNzdW1lIGl0J3MgYSBzcXVhcmUsIHNvIHVzZSBoZWlnaHQgYXMgdGhlIHdpZHRoCgkgICAgICAgICAgICByaWdodCA9IGxlZnQgKyAoYm90dG9tIC0gdG9wKTsKCSAgICAgICAgICAgIGlmIChyaWdodCA+PSBpbWFnZS5nZXRXaWR0aCgpKSB7CgkgICAgICAgICAgICAgICAgLy8gQWJvcnQgaWYgdGhhdCB3b3VsZCBub3QgbWFrZSBzZW5zZSAtLSBvZmYgaW1hZ2UKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG1hdHJpeFdpZHRoID0gTWF0aC5yb3VuZCgocmlnaHQgLSBsZWZ0ICsgMSkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIG1hdHJpeEhlaWdodCA9IE1hdGgucm91bmQoKGJvdHRvbSAtIHRvcCArIDEpIC8gbW9kdWxlU2l6ZSk7CgkgICAgICAgIGlmIChtYXRyaXhXaWR0aCA8PSAwIHx8IG1hdHJpeEhlaWdodCA8PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKG1hdHJpeEhlaWdodCAhPT0gbWF0cml4V2lkdGgpIHsKCSAgICAgICAgICAgIC8vIE9ubHkgcG9zc2libHkgZGVjb2RlIHNxdWFyZSByZWdpb25zCgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gUHVzaCBpbiB0aGUgImJvcmRlciIgYnkgaGFsZiB0aGUgbW9kdWxlIHdpZHRoIHNvIHRoYXQgd2Ugc3RhcnQKCSAgICAgICAgLy8gc2FtcGxpbmcgaW4gdGhlIG1pZGRsZSBvZiB0aGUgbW9kdWxlLiBKdXN0IGluIGNhc2UgdGhlIGltYWdlIGlzIGEKCSAgICAgICAgLy8gbGl0dGxlIG9mZiwgdGhpcyB3aWxsIGhlbHAgcmVjb3Zlci4KCSAgICAgICAgdmFyIG51ZGdlID0gLyooaW50KSAqLyBNYXRoLmZsb29yKG1vZHVsZVNpemUgLyAyLjApOwoJICAgICAgICB0b3AgKz0gbnVkZ2U7CgkgICAgICAgIGxlZnQgKz0gbnVkZ2U7CgkgICAgICAgIC8vIEJ1dCBjYXJlZnVsIHRoYXQgdGhpcyBkb2VzIG5vdCBzYW1wbGUgb2ZmIHRoZSBlZGdlCgkgICAgICAgIC8vICJyaWdodCIgaXMgdGhlIGZhcnRoZXN0LXJpZ2h0IHZhbGlkIHBpeGVsIGxvY2F0aW9uIC0tIHJpZ2h0KzEgaXMgbm90IG5lY2Vzc2FyaWx5CgkgICAgICAgIC8vIFRoaXMgaXMgcG9zaXRpdmUgYnkgaG93IG11Y2ggdGhlIGlubmVyIHggbG9vcCBiZWxvdyB3b3VsZCBiZSB0b28gbGFyZ2UKCSAgICAgICAgdmFyIG51ZGdlZFRvb0ZhclJpZ2h0ID0gbGVmdCArIC8qKGludCkgKi8gTWF0aC5mbG9vcigobWF0cml4V2lkdGggLSAxKSAqIG1vZHVsZVNpemUpIC0gcmlnaHQ7CgkgICAgICAgIGlmIChudWRnZWRUb29GYXJSaWdodCA+IDApIHsKCSAgICAgICAgICAgIGlmIChudWRnZWRUb29GYXJSaWdodCA+IG51ZGdlKSB7CgkgICAgICAgICAgICAgICAgLy8gTmVpdGhlciB3YXkgZml0czsgYWJvcnQKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBsZWZ0IC09IG51ZGdlZFRvb0ZhclJpZ2h0OwoJICAgICAgICB9CgkgICAgICAgIC8vIFNlZSBsb2dpYyBhYm92ZQoJICAgICAgICB2YXIgbnVkZ2VkVG9vRmFyRG93biA9IHRvcCArIC8qKGludCkgKi8gTWF0aC5mbG9vcigobWF0cml4SGVpZ2h0IC0gMSkgKiBtb2R1bGVTaXplKSAtIGJvdHRvbTsKCSAgICAgICAgaWYgKG51ZGdlZFRvb0ZhckRvd24gPiAwKSB7CgkgICAgICAgICAgICBpZiAobnVkZ2VkVG9vRmFyRG93biA+IG51ZGdlKSB7CgkgICAgICAgICAgICAgICAgLy8gTmVpdGhlciB3YXkgZml0czsgYWJvcnQKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0b3AgLT0gbnVkZ2VkVG9vRmFyRG93bjsKCSAgICAgICAgfQoJICAgICAgICAvLyBOb3cganVzdCByZWFkIG9mZiB0aGUgYml0cwoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRNYXRyaXhfMS5kZWZhdWx0KG1hdHJpeFdpZHRoLCBtYXRyaXhIZWlnaHQpOwoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IG1hdHJpeEhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgaU9mZnNldCA9IHRvcCArIC8qKGludCkgKi8gTWF0aC5mbG9vcih5ICogbW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1hdHJpeFdpZHRoOyB4KyspIHsKCSAgICAgICAgICAgICAgICBpZiAoaW1hZ2UuZ2V0KGxlZnQgKyAvKihpbnQpICovIE1hdGguZmxvb3IoeCAqIG1vZHVsZVNpemUpLCBpT2Zmc2V0KSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLnNldCh4LCB5KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICBRUkNvZGVSZWFkZXIubW9kdWxlU2l6ZSA9IGZ1bmN0aW9uIChsZWZ0VG9wQmxhY2ssIGltYWdlKSB7CgkgICAgICAgIHZhciBoZWlnaHQgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHdpZHRoID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIHggPSBsZWZ0VG9wQmxhY2tbMF07CgkgICAgICAgIHZhciB5ID0gbGVmdFRvcEJsYWNrWzFdOwoJICAgICAgICB2YXIgaW5CbGFjayA9IHRydWU7CgkgICAgICAgIHZhciB0cmFuc2l0aW9ucyA9IDA7CgkgICAgICAgIHdoaWxlICh4IDwgd2lkdGggJiYgeSA8IGhlaWdodCkgewoJICAgICAgICAgICAgaWYgKGluQmxhY2sgIT09IGltYWdlLmdldCh4LCB5KSkgewoJICAgICAgICAgICAgICAgIGlmICgrK3RyYW5zaXRpb25zID09PSA1KSB7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBpbkJsYWNrID0gIWluQmxhY2s7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB4Kys7CgkgICAgICAgICAgICB5Kys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHggPT09IHdpZHRoIHx8IHkgPT09IGhlaWdodCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiAoeCAtIGxlZnRUb3BCbGFja1swXSkgLyA3LjA7CgkgICAgfTsKCSAgICBRUkNvZGVSZWFkZXIuTk9fUE9JTlRTID0gbmV3IEFycmF5KCk7CgkgICAgcmV0dXJuIFFSQ29kZVJlYWRlcjsKCX0oKSk7Cgl2YXIgX2RlZmF1bHQgPSBRUkNvZGVSZWFkZXIkMS5kZWZhdWx0ID0gUVJDb2RlUmVhZGVyOwoKCXZhciB0b0dyYXlzY2FsZUJ1ZmZlciA9IGZ1bmN0aW9uIHRvR3JheXNjYWxlQnVmZmVyKGltYWdlQnVmZmVyLCB3aWR0aCwgaGVpZ2h0KSB7CgkgIHZhciBncmF5c2NhbGVCdWZmZXIgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkod2lkdGggKiBoZWlnaHQpOwoKCSAgZm9yICh2YXIgaSA9IDAsIGogPSAwLCBsZW5ndGhfMSA9IGltYWdlQnVmZmVyLmxlbmd0aDsgaSA8IGxlbmd0aF8xOyBpICs9IDQsIGorKykgewoJICAgIHZhciBncmF5ID0gdm9pZCAwOwoJICAgIHZhciBhbHBoYSA9IGltYWdlQnVmZmVyW2kgKyAzXTsgLy8gVGhlIGNvbG9yIG9mIGZ1bGx5LXRyYW5zcGFyZW50IHBpeGVscyBpcyBpcnJlbGV2YW50LiBUaGV5IGFyZSBvZnRlbiwgdGVjaG5pY2FsbHksIGZ1bGx5LXRyYW5zcGFyZW50CgkgICAgLy8gYmxhY2sgKDAgYWxwaGEsIGFuZCB0aGVuIDAgUkdCKS4gVGhleSBhcmUgb2Z0ZW4gdXNlZCwgb2YgY291cnNlIGFzIHRoZSAid2hpdGUiIGFyZWEgaW4gYQoJICAgIC8vIGJhcmNvZGUgaW1hZ2UuIEZvcmNlIGFueSBzdWNoIHBpeGVsIHRvIGJlIHdoaXRlOgoKCSAgICBpZiAoYWxwaGEgPT09IDApIHsKCSAgICAgIGdyYXkgPSAweEZGOwoJICAgIH0gZWxzZSB7CgkgICAgICB2YXIgcGl4ZWxSID0gaW1hZ2VCdWZmZXJbaV07CgkgICAgICB2YXIgcGl4ZWxHID0gaW1hZ2VCdWZmZXJbaSArIDFdOwoJICAgICAgdmFyIHBpeGVsQiA9IGltYWdlQnVmZmVyW2kgKyAyXTsgLy8gLjI5OVIgKyAwLjU4N0cgKyAwLjExNEIgKFlVVi9ZSVEgZm9yIFBBTCBhbmQgTlRTQyksCgkgICAgICAvLyAoMzA2KlIpID4+IDEwIGlzIGFwcHJveGltYXRlbHkgZXF1YWwgdG8gUiowLjI5OSwgYW5kIHNvIG9uLgoJICAgICAgLy8gMHgyMDAgPj4gMTAgaXMgMC41LCBpdCBpbXBsZW1lbnRzIHJvdW5kaW5nLgoKCSAgICAgIGdyYXkgPSAzMDYgKiBwaXhlbFIgKyA2MDEgKiBwaXhlbEcgKyAxMTcgKiBwaXhlbEIgKyAweDIwMCA+PiAxMDsKCSAgICB9CgoJICAgIGdyYXlzY2FsZUJ1ZmZlcltqXSA9IGdyYXk7CgkgIH0KCgkgIHJldHVybiBncmF5c2NhbGVCdWZmZXI7Cgl9OwoKCXZhciByZWFkZXIgPSBuZXcgX2RlZmF1bHQoKTsKCXNlbGYuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChlKSB7CgkgIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzCgkgIHRyeSB7CgkgICAgdmFyIGx1bWluYW5jZXMgPSB0b0dyYXlzY2FsZUJ1ZmZlcihlLmRhdGEuZGF0YSwgZS5kYXRhLndpZHRoLCBlLmRhdGEuaGVpZ2h0KTsKCSAgICB2YXIgbHVtaW5hbmNlU291cmNlID0gbmV3IF9kZWZhdWx0JDEobHVtaW5hbmNlcywgZS5kYXRhLndpZHRoLCBlLmRhdGEuaGVpZ2h0KTsKCSAgICB2YXIgaHlicmlkQmluYXJpemVyID0gbmV3IF9kZWZhdWx0JDIobHVtaW5hbmNlU291cmNlKTsKCSAgICB2YXIgYmluYXJ5Qml0bWFwID0gbmV3IF9kZWZhdWx0JDMoaHlicmlkQmluYXJpemVyKTsKCSAgICB2YXIgZGVjb2RlZCA9IHJlYWRlci5kZWNvZGUoYmluYXJ5Qml0bWFwKTsKCSAgICBwb3N0TWVzc2FnZShkZWNvZGVkKTsKCSAgfSBjYXRjaCAoZXJyKSB7CgkgICAgcG9zdE1lc3NhZ2UobnVsbCk7CgkgIH0KCX0pOwoKfSkoKTsKCg==",null,!1),P=["constraints","onError","onLoad","onScan","resolution","qrArea"];function O(g,I){var e=Object.keys(g);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(g);I&&(C=C.filter((function(I){return Object.getOwnPropertyDescriptor(g,I).enumerable}))),e.push.apply(e,C)}return e}function _(g){for(var I=1;I<arguments.length;I++){var e=null!=arguments[I]?arguments[I]:{};I%2?O(Object(e),!0).forEach((function(I){t(g,I,e[I])})):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(e)):O(Object(e)).forEach((function(I){Object.defineProperty(g,I,Object.getOwnPropertyDescriptor(e,I))}))}return g}var q=function(){return new j},$=function(g){g&&(g.getVideoTracks&&g.getAudioTracks?(g.getVideoTracks().forEach((function(I){g.removeTrack(I),I.stop()})),g.getAudioTracks().forEach((function(I){g.removeTrack(I),I.stop()}))):g.stop())},gg=function(g){var I=g.constraints,t=g.onError,l=g.onLoad,n=g.onScan,o=g.resolution,a=g.qrArea,i=s(g,P),c=e.useRef(null),d=e.useRef(null),r=e.useRef(document.createElement("canvas")),b=e.useRef(null),u=e.useRef(),m=A(e.useState(null),2),Z=m[0],h=m[1],G=e.useRef(!1),B=e.useRef();e.useEffect((function(){B.current=q();var g=B.current;return g.onmessage=function(g){n&&n(g.data?_(_({},g.data),{},{canvas:r.current}):null),G.current=!1},function(){g.terminate()}}),[n]);var y=JSON.stringify(a),p=e.useCallback((function(){var g=JSON.parse(y),I=B.current,e=d.current&&d.current.readyState===d.current.HAVE_ENOUGH_DATA;if(!G.current&&e){G.current=!0;var C,t=d.current.videoWidth,l=d.current.videoHeight,n=t>l?t:l,a=Math.floor(o/n*100)/100;l=Math.floor(a*l),t=Math.floor(a*t),r.current.width=t,r.current.height=l,b.current=r.current.getContext("2d"),b.current.drawImage(d.current,0,0,t,l),C=g&&2===g.length&&g[0]>0&&g[1]>0?b.current.getImageData(Math.floor((t-g[0])/2),Math.floor((l-g[1])/2),g[0],g[1]):b.current.getImageData(0,0,t,l),I.postMessage(C)}u.current=requestAnimationFrame(p)}),[o,y]),W=JSON.stringify(I);return e.useEffect((function(){var g=JSON.parse(W),I=!0;return navigator.mediaDevices.getUserMedia(g).then((function(g){if(I){c.current=g;try{d.current&&(d.current.srcObject=g,d.current.setAttribute("playsinline",!0))}catch(e){h(window.URL.createObjectURL(g))}l&&l(),u.current=requestAnimationFrame(p)}else $(g)})).catch((function(g){return I?t(g):null})),function(){cancelAnimationFrame(u.current),I=!1,$(c.current),Z&&window.URL.revokeObjectURL(Z)}}),[p,W,t,l,Z]),e.createElement("video",C({autoPlay:!0,playsInline:!0,src:Z,ref:d},i))};return gg.propTypes={constraints:U.object,onError:U.func.isRequired,onLoad:U.func,onScan:U.func.isRequired,resolution:U.number,qrArea:U.array},gg.defaultProps={constraints:{audio:!1,video:!0},resolution:640,qrArea:[]},gg}(e(43))},141:function(g,I,e){var C,t;"undefined"!=typeof self&&self,g.exports=(C=e(43),t=e(950),function(){"use strict";var g={328:function(g,I,e){Object.defineProperty(I,"__esModule",{value:!0}),I.PrintContextConsumer=I.PrintContext=void 0;var C=e(496),t=Object.prototype.hasOwnProperty.call(C,"createContext");I.PrintContext=t?C.createContext({}):null,I.PrintContextConsumer=I.PrintContext?I.PrintContext.Consumer:function(){return null}},428:function(g,I,e){Object.defineProperty(I,"__esModule",{value:!0}),I.ReactToPrint=void 0;var C=e(316),t=e(496),l=e(190),n=e(328),o=e(940),a=function(g){function I(){var I=g.apply(this,C.__spreadArray([],C.__read(arguments),!1))||this;return I.startPrint=function(g){var e=I.props,C=e.onAfterPrint,t=e.onPrintError,l=e.print,n=e.documentTitle;setTimeout((function(){var e,o;if(g.contentWindow)if(g.contentWindow.focus(),l)l(g).then((function(){return null==C?void 0:C()})).then((function(){return I.handleRemoveIframe()})).catch((function(g){t?t("print",g):I.logMessages(["An error was thrown by the specified `print` function"])}));else{if(g.contentWindow.print){var a=null!==(o=null===(e=g.contentDocument)||void 0===e?void 0:e.title)&&void 0!==o?o:"",i=g.ownerDocument.title;n&&(g.ownerDocument.title=n,g.contentDocument&&(g.contentDocument.title=n)),g.contentWindow.print(),n&&(g.ownerDocument.title=i,g.contentDocument&&(g.contentDocument.title=a))}else I.logMessages(["Printing for this browser is not currently possible: the browser does not have a `print` method available for iframes."]);null==C||C(),I.handleRemoveIframe()}else I.logMessages(["Printing failed because the `contentWindow` of the print iframe did not load. This is possibly an error with `react-to-print`. Please file an issue: https://github.com/gregnb/react-to-print/issues/"])}),500)},I.triggerPrint=function(g){var e=I.props,C=e.onBeforePrint,t=e.onPrintError;if(C){var l=C();l&&"function"==typeof l.then?l.then((function(){I.startPrint(g)})).catch((function(g){t&&t("onBeforePrint",g)})):I.startPrint(g)}else I.startPrint(g)},I.handlePrint=function(g){var e=I.props,t=e.bodyClass,n=e.content,o=e.copyStyles,a=e.fonts,i=e.pageStyle,A=e.nonce,c="function"==typeof g?g():null;if(c&&"function"==typeof n&&I.logMessages(['"react-to-print" received a `content` prop and a content param passed the callback return by `useReactToPrint. The `content` prop will be ignored.'],"warning"),c||"function"!=typeof n||(c=n()),void 0!==c)if(null!==c){var s=document.createElement("iframe");s.width="".concat(document.documentElement.clientWidth,"px"),s.height="".concat(document.documentElement.clientHeight,"px"),s.style.position="absolute",s.style.top="-".concat(document.documentElement.clientHeight+100,"px"),s.style.left="-".concat(document.documentElement.clientWidth+100,"px"),s.id="printWindow",s.srcdoc="<!DOCTYPE html>";var d=(0,l.findDOMNode)(c);if(d){var r=d.cloneNode(!0),b=r instanceof Text,u=document.querySelectorAll("link[rel~='stylesheet'], link[as='style']"),m=b?[]:r.querySelectorAll("img"),Z=b?[]:r.querySelectorAll("video"),h=a?a.length:0;I.numResourcesToLoad=u.length+m.length+Z.length+h,I.resourcesLoaded=[],I.resourcesErrored=[];var G=function(g,e){I.resourcesLoaded.includes(g)?I.logMessages(["Tried to mark a resource that has already been handled",g],"debug"):(e?(I.logMessages(C.__spreadArray(['"react-to-print" was unable to load a resource but will continue attempting to print the page'],C.__read(e),!1)),I.resourcesErrored.push(g)):I.resourcesLoaded.push(g),I.resourcesLoaded.length+I.resourcesErrored.length===I.numResourcesToLoad&&I.triggerPrint(s))};s.onload=function(){var g,e,l,n;s.onload=null;var c=s.contentDocument||(null===(e=s.contentWindow)||void 0===e?void 0:e.document);if(c){c.body.appendChild(r),a&&((null===(l=s.contentDocument)||void 0===l?void 0:l.fonts)&&(null===(n=s.contentWindow)||void 0===n?void 0:n.FontFace)?a.forEach((function(g){var I=new FontFace(g.family,g.source,{weight:g.weight,style:g.style});s.contentDocument.fonts.add(I),I.loaded.then((function(){G(I)})).catch((function(g){G(I,["Failed loading the font:",I,"Load error:",g])}))})):(a.forEach((function(g){return G(g)})),I.logMessages(['"react-to-print" is not able to load custom fonts because the browser does not support the FontFace API but will continue attempting to print the page'])));var u="function"==typeof i?i():i;if("string"!=typeof u)I.logMessages(['"react-to-print" expected a "string" from `pageStyle` but received "'.concat(typeof u,'". Styles from `pageStyle` will not be applied.')]);else{var h=c.createElement("style");A&&(h.setAttribute("nonce",A),c.head.setAttribute("nonce",A)),h.appendChild(c.createTextNode(u)),c.head.appendChild(h)}if(t&&(g=c.body.classList).add.apply(g,C.__spreadArray([],C.__read(t.split(" ")),!1)),!b){for(var B=b?[]:d.querySelectorAll("canvas"),y=c.querySelectorAll("canvas"),p=0;p<B.length;++p){var W=B[p],V=y[p].getContext("2d");V&&V.drawImage(W,0,0)}var S=function(g){var I=m[g],e=I.getAttribute("src");if(e){var C=new Image;C.onload=function(){return G(I)},C.onerror=function(g,e,C,t,l){return G(I,["Error loading <img>",I,"Error",l])},C.src=e}else G(I,['Found an <img> tag with an empty "src" attribute. This prevents pre-loading it. The <img> is:',I])};for(p=0;p<m.length;p++)S(p);var X=function(g){var I=Z[g];I.preload="auto";var e=I.getAttribute("poster");if(e){var C=new Image;C.onload=function(){return G(I)},C.onerror=function(g,C,t,l,n){return G(I,["Error loading video poster",e,"for video",I,"Error:",n])},C.src=e}else I.readyState>=2?G(I):(I.onloadeddata=function(){return G(I)},I.onerror=function(g,e,C,t,l){return G(I,["Error loading video",I,"Error",l])},I.onstalled=function(){return G(I,["Loading video stalled, skipping",I])})};for(p=0;p<Z.length;p++)X(p);var R="input",J=d.querySelectorAll(R),k=c.querySelectorAll(R);for(p=0;p<J.length;p++)k[p].value=J[p].value;var Y="input[type=checkbox],input[type=radio]",f=d.querySelectorAll(Y),v=c.querySelectorAll(Y);for(p=0;p<f.length;p++)v[p].checked=f[p].checked;var H="select",w=d.querySelectorAll(H),N=c.querySelectorAll(H);for(p=0;p<w.length;p++)N[p].value=w[p].value}if(o)for(var K=document.querySelectorAll("style, link[rel~='stylesheet'], link[as='style']"),F=function(g,e){var C=K[g];if("style"===C.tagName.toLowerCase()){var t=c.createElement(C.tagName),l=C.sheet;if(l){var n="";try{for(var o=l.cssRules.length,a=0;a<o;++a)"string"==typeof l.cssRules[a].cssText&&(n+="".concat(l.cssRules[a].cssText,"\r\n"))}catch(g){I.logMessages(["A stylesheet could not be accessed. This is likely due to the stylesheet having cross-origin imports, and many browsers block script access to cross-origin stylesheets. See https://github.com/gregnb/react-to-print/issues/429 for details. You may be able to load the sheet by both marking the stylesheet with the cross `crossorigin` attribute, and setting the `Access-Control-Allow-Origin` header on the server serving the stylesheet. Alternatively, host the stylesheet on your domain to avoid this issue entirely.",C],"warning")}t.setAttribute("id","react-to-print-".concat(g)),A&&t.setAttribute("nonce",A),t.appendChild(c.createTextNode(n)),c.head.appendChild(t)}}else if(C.getAttribute("href"))if(C.hasAttribute("disabled"))I.logMessages(["`react-to-print` encountered a <link> tag with a `disabled` attribute and will ignore it. Note that the `disabled` attribute is deprecated, and some browsers ignore it. You should stop using it. https://developer.mozilla.org/en-US/docs/Web/HTML/Element/link#attr-disabled. The <link> is:",C],"warning"),G(C);else{for(var i=c.createElement(C.tagName),s=(a=0,C.attributes.length);a<s;++a){var d=C.attributes[a];d&&i.setAttribute(d.nodeName,d.nodeValue||"")}i.onload=function(){return G(i)},i.onerror=function(g,I,e,C,t){return G(i,["Failed to load",i,"Error:",t])},A&&i.setAttribute("nonce",A),c.head.appendChild(i)}else I.logMessages(["`react-to-print` encountered a <link> tag with an empty `href` attribute. In addition to being invalid HTML, this can cause problems in many browsers, and so the <link> was not loaded. The <link> is:",C],"warning"),G(C)},x=(p=0,K.length);p<x;++p)F(p)}0!==I.numResourcesToLoad&&o||I.triggerPrint(s)},I.handleRemoveIframe(!0),document.body.appendChild(s)}else I.logMessages(['"react-to-print" could not locate the DOM node corresponding with the `content` prop'])}else I.logMessages(['There is nothing to print because the "content" prop returned "null". Please ensure "content" is renderable before allowing "react-to-print" to be called.']);else I.logMessages(["To print a functional component ensure it is wrapped with `React.forwardRef`, and ensure the forwarded ref is used. See the README for an example: https://github.com/gregnb/react-to-print#examples"])},I.handleRemoveIframe=function(g){var e=I.props.removeAfterPrint;if(g||e){var C=document.getElementById("printWindow");C&&document.body.removeChild(C)}},I.logMessages=function(g,e){void 0===e&&(e="error"),I.props.suppressErrors||("error"===e?console.error(g):"warning"===e?console.warn(g):"debug"===e&&console.debug(g))},I}return C.__extends(I,g),I.prototype.handleClick=function(g,I){var e=this,C=this.props,t=C.onBeforeGetContent,l=C.onPrintError;if(t){var n=t();n&&"function"==typeof n.then?n.then((function(){return e.handlePrint(I)})).catch((function(g){l&&l("onBeforeGetContent",g)})):this.handlePrint(I)}else this.handlePrint(I)},I.prototype.render=function(){var g=this.props,I=g.children,e=g.trigger;if(e)return t.cloneElement(e(),{onClick:this.handleClick.bind(this)});if(!n.PrintContext)return this.logMessages(['"react-to-print" requires React ^16.3.0 to be able to use "PrintContext"']),null;var C={handlePrint:this.handleClick.bind(this)};return t.createElement(n.PrintContext.Provider,{value:C},I)},I.defaultProps=o.defaultProps,I}(t.Component);I.ReactToPrint=a},940:function(g,I){Object.defineProperty(I,"__esModule",{value:!0}),I.defaultProps=void 0,I.defaultProps={copyStyles:!0,pageStyle:"\n        @page {\n            /* Remove browser default header (title) and footer (url) */\n            margin: 0;\n        }\n        @media print {\n            body {\n                /* Tell browsers to print background colors */\n                -webkit-print-color-adjust: exact; /* Chrome/Safari/Edge/Opera */\n                color-adjust: exact; /* Firefox */\n            }\n        }\n    ",removeAfterPrint:!1,suppressErrors:!1}},892:function(g,I,e){Object.defineProperty(I,"__esModule",{value:!0}),I.useReactToPrint=void 0;var C=e(316),t=e(496),l=e(428),n=e(940),o=e(860),a=Object.prototype.hasOwnProperty.call(t,"useMemo")&&Object.prototype.hasOwnProperty.call(t,"useCallback");I.useReactToPrint=function(g){if(!a)return g.suppressErrors||console.error('"react-to-print" requires React ^16.8.0 to be able to use "useReactToPrint"'),function(){throw new Error('"react-to-print" requires React ^16.8.0 to be able to use "useReactToPrint"')};var I=t.useMemo((function(){return new l.ReactToPrint(C.__assign(C.__assign({},n.defaultProps),g))}),[g]);return t.useCallback((function(g,e){return(0,o.wrapCallbackWithArgs)(I,I.handleClick,e)(g)}),[I])}},860:function(g,I,e){Object.defineProperty(I,"__esModule",{value:!0}),I.wrapCallbackWithArgs=void 0;var C=e(316);I.wrapCallbackWithArgs=function(g,I){for(var e=[],t=2;t<arguments.length;t++)e[t-2]=arguments[t];return function(){for(var t=[],l=0;l<arguments.length;l++)t[l]=arguments[l];return I.apply(g,C.__spreadArray(C.__spreadArray([],C.__read(t),!1),C.__read(e),!1))}}},496:function(g){g.exports=C},190:function(g){g.exports=t},316:function(g,I,e){e.r(I),e.d(I,{__addDisposableResource:function(){return H},__assign:function(){return l},__asyncDelegator:function(){return V},__asyncGenerator:function(){return W},__asyncValues:function(){return S},__await:function(){return p},__awaiter:function(){return r},__classPrivateFieldGet:function(){return Y},__classPrivateFieldIn:function(){return v},__classPrivateFieldSet:function(){return f},__createBinding:function(){return u},__decorate:function(){return o},__disposeResources:function(){return N},__esDecorate:function(){return i},__exportStar:function(){return m},__extends:function(){return t},__generator:function(){return b},__importDefault:function(){return k},__importStar:function(){return J},__makeTemplateObject:function(){return X},__metadata:function(){return d},__param:function(){return a},__propKey:function(){return c},__read:function(){return h},__rest:function(){return n},__runInitializers:function(){return A},__setFunctionName:function(){return s},__spread:function(){return G},__spreadArray:function(){return y},__spreadArrays:function(){return B},__values:function(){return Z}});var C=function(g,I){return C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,I){g.__proto__=I}||function(g,I){for(var e in I)Object.prototype.hasOwnProperty.call(I,e)&&(g[e]=I[e])},C(g,I)};function t(g,I){if("function"!=typeof I&&null!==I)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");function e(){this.constructor=g}C(g,I),g.prototype=null===I?Object.create(I):(e.prototype=I.prototype,new e)}var l=function(){return l=Object.assign||function(g){for(var I,e=1,C=arguments.length;e<C;e++)for(var t in I=arguments[e])Object.prototype.hasOwnProperty.call(I,t)&&(g[t]=I[t]);return g},l.apply(this,arguments)};function n(g,I){var e={};for(var C in g)Object.prototype.hasOwnProperty.call(g,C)&&I.indexOf(C)<0&&(e[C]=g[C]);if(null!=g&&"function"==typeof Object.getOwnPropertySymbols){var t=0;for(C=Object.getOwnPropertySymbols(g);t<C.length;t++)I.indexOf(C[t])<0&&Object.prototype.propertyIsEnumerable.call(g,C[t])&&(e[C[t]]=g[C[t]])}return e}function o(g,I,e,C){var t,l=arguments.length,n=l<3?I:null===C?C=Object.getOwnPropertyDescriptor(I,e):C;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(g,I,e,C);else for(var o=g.length-1;o>=0;o--)(t=g[o])&&(n=(l<3?t(n):l>3?t(I,e,n):t(I,e))||n);return l>3&&n&&Object.defineProperty(I,e,n),n}function a(g,I){return function(e,C){I(e,C,g)}}function i(g,I,e,C,t,l){function n(g){if(void 0!==g&&"function"!=typeof g)throw new TypeError("Function expected");return g}for(var o,a=C.kind,i="getter"===a?"get":"setter"===a?"set":"value",A=!I&&g?C.static?g:g.prototype:null,c=I||(A?Object.getOwnPropertyDescriptor(A,C.name):{}),s=!1,d=e.length-1;d>=0;d--){var r={};for(var b in C)r[b]="access"===b?{}:C[b];for(var b in C.access)r.access[b]=C.access[b];r.addInitializer=function(g){if(s)throw new TypeError("Cannot add initializers after decoration has completed");l.push(n(g||null))};var u=(0,e[d])("accessor"===a?{get:c.get,set:c.set}:c[i],r);if("accessor"===a){if(void 0===u)continue;if(null===u||"object"!=typeof u)throw new TypeError("Object expected");(o=n(u.get))&&(c.get=o),(o=n(u.set))&&(c.set=o),(o=n(u.init))&&t.unshift(o)}else(o=n(u))&&("field"===a?t.unshift(o):c[i]=o)}A&&Object.defineProperty(A,C.name,c),s=!0}function A(g,I,e){for(var C=arguments.length>2,t=0;t<I.length;t++)e=C?I[t].call(g,e):I[t].call(g);return C?e:void 0}function c(g){return"symbol"==typeof g?g:"".concat(g)}function s(g,I,e){return"symbol"==typeof I&&(I=I.description?"[".concat(I.description,"]"):""),Object.defineProperty(g,"name",{configurable:!0,value:e?"".concat(e," ",I):I})}function d(g,I){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(g,I)}function r(g,I,e,C){return new(e||(e=Promise))((function(t,l){function n(g){try{a(C.next(g))}catch(g){l(g)}}function o(g){try{a(C.throw(g))}catch(g){l(g)}}function a(g){var I;g.done?t(g.value):(I=g.value,I instanceof e?I:new e((function(g){g(I)}))).then(n,o)}a((C=C.apply(g,I||[])).next())}))}function b(g,I){var e,C,t,l,n={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return l={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function o(o){return function(a){return function(o){if(e)throw new TypeError("Generator is already executing.");for(;l&&(l=0,o[0]&&(n=0)),n;)try{if(e=1,C&&(t=2&o[0]?C.return:o[0]?C.throw||((t=C.return)&&t.call(C),0):C.next)&&!(t=t.call(C,o[1])).done)return t;switch(C=0,t&&(o=[2&o[0],t.value]),o[0]){case 0:case 1:t=o;break;case 4:return n.label++,{value:o[1],done:!1};case 5:n.label++,C=o[1],o=[0];continue;case 7:o=n.ops.pop(),n.trys.pop();continue;default:if(!((t=(t=n.trys).length>0&&t[t.length-1])||6!==o[0]&&2!==o[0])){n=0;continue}if(3===o[0]&&(!t||o[1]>t[0]&&o[1]<t[3])){n.label=o[1];break}if(6===o[0]&&n.label<t[1]){n.label=t[1],t=o;break}if(t&&n.label<t[2]){n.label=t[2],n.ops.push(o);break}t[2]&&n.ops.pop(),n.trys.pop();continue}o=I.call(g,n)}catch(g){o=[6,g],C=0}finally{e=t=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var u=Object.create?function(g,I,e,C){void 0===C&&(C=e);var t=Object.getOwnPropertyDescriptor(I,e);t&&!("get"in t?!I.__esModule:t.writable||t.configurable)||(t={enumerable:!0,get:function(){return I[e]}}),Object.defineProperty(g,C,t)}:function(g,I,e,C){void 0===C&&(C=e),g[C]=I[e]};function m(g,I){for(var e in g)"default"===e||Object.prototype.hasOwnProperty.call(I,e)||u(I,g,e)}function Z(g){var I="function"==typeof Symbol&&Symbol.iterator,e=I&&g[I],C=0;if(e)return e.call(g);if(g&&"number"==typeof g.length)return{next:function(){return g&&C>=g.length&&(g=void 0),{value:g&&g[C++],done:!g}}};throw new TypeError(I?"Object is not iterable.":"Symbol.iterator is not defined.")}function h(g,I){var e="function"==typeof Symbol&&g[Symbol.iterator];if(!e)return g;var C,t,l=e.call(g),n=[];try{for(;(void 0===I||I-- >0)&&!(C=l.next()).done;)n.push(C.value)}catch(g){t={error:g}}finally{try{C&&!C.done&&(e=l.return)&&e.call(l)}finally{if(t)throw t.error}}return n}function G(){for(var g=[],I=0;I<arguments.length;I++)g=g.concat(h(arguments[I]));return g}function B(){for(var g=0,I=0,e=arguments.length;I<e;I++)g+=arguments[I].length;var C=Array(g),t=0;for(I=0;I<e;I++)for(var l=arguments[I],n=0,o=l.length;n<o;n++,t++)C[t]=l[n];return C}function y(g,I,e){if(e||2===arguments.length)for(var C,t=0,l=I.length;t<l;t++)!C&&t in I||(C||(C=Array.prototype.slice.call(I,0,t)),C[t]=I[t]);return g.concat(C||Array.prototype.slice.call(I))}function p(g){return this instanceof p?(this.v=g,this):new p(g)}function W(g,I,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var C,t=e.apply(g,I||[]),l=[];return C={},n("next"),n("throw"),n("return"),C[Symbol.asyncIterator]=function(){return this},C;function n(g){t[g]&&(C[g]=function(I){return new Promise((function(e,C){l.push([g,I,e,C])>1||o(g,I)}))})}function o(g,I){try{(e=t[g](I)).value instanceof p?Promise.resolve(e.value.v).then(a,i):A(l[0][2],e)}catch(g){A(l[0][3],g)}var e}function a(g){o("next",g)}function i(g){o("throw",g)}function A(g,I){g(I),l.shift(),l.length&&o(l[0][0],l[0][1])}}function V(g){var I,e;return I={},C("next"),C("throw",(function(g){throw g})),C("return"),I[Symbol.iterator]=function(){return this},I;function C(C,t){I[C]=g[C]?function(I){return(e=!e)?{value:p(g[C](I)),done:!1}:t?t(I):I}:t}}function S(g){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var I,e=g[Symbol.asyncIterator];return e?e.call(g):(g=Z(g),I={},C("next"),C("throw"),C("return"),I[Symbol.asyncIterator]=function(){return this},I);function C(e){I[e]=g[e]&&function(I){return new Promise((function(C,t){!function(g,I,e,C){Promise.resolve(C).then((function(I){g({value:I,done:e})}),I)}(C,t,(I=g[e](I)).done,I.value)}))}}}function X(g,I){return Object.defineProperty?Object.defineProperty(g,"raw",{value:I}):g.raw=I,g}var R=Object.create?function(g,I){Object.defineProperty(g,"default",{enumerable:!0,value:I})}:function(g,I){g.default=I};function J(g){if(g&&g.__esModule)return g;var I={};if(null!=g)for(var e in g)"default"!==e&&Object.prototype.hasOwnProperty.call(g,e)&&u(I,g,e);return R(I,g),I}function k(g){return g&&g.__esModule?g:{default:g}}function Y(g,I,e,C){if("a"===e&&!C)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof I?g!==I||!C:!I.has(g))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?C:"a"===e?C.call(g):C?C.value:I.get(g)}function f(g,I,e,C,t){if("m"===C)throw new TypeError("Private method is not writable");if("a"===C&&!t)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof I?g!==I||!t:!I.has(g))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===C?t.call(g,e):t?t.value=e:I.set(g,e),e}function v(g,I){if(null===I||"object"!=typeof I&&"function"!=typeof I)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof g?I===g:g.has(I)}function H(g,I,e){if(null!=I){if("object"!=typeof I&&"function"!=typeof I)throw new TypeError("Object expected.");var C;if(e){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");C=I[Symbol.asyncDispose]}if(void 0===C){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");C=I[Symbol.dispose]}if("function"!=typeof C)throw new TypeError("Object not disposable.");g.stack.push({value:I,dispose:C,async:e})}else e&&g.stack.push({async:!0});return I}var w="function"==typeof SuppressedError?SuppressedError:function(g,I,e){var C=new Error(e);return C.name="SuppressedError",C.error=g,C.suppressed=I,C};function N(g){function I(I){g.error=g.hasError?new w(I,g.error,"An error was suppressed during disposal."):I,g.hasError=!0}return function e(){for(;g.stack.length;){var C=g.stack.pop();try{var t=C.dispose&&C.dispose.call(C.value);if(C.async)return Promise.resolve(t).then(e,(function(g){return I(g),e()}))}catch(g){I(g)}}if(g.hasError)throw g.error}()}I.default={__extends:t,__assign:l,__rest:n,__decorate:o,__param:a,__metadata:d,__awaiter:r,__generator:b,__createBinding:u,__exportStar:m,__values:Z,__read:h,__spread:G,__spreadArrays:B,__spreadArray:y,__await:p,__asyncGenerator:W,__asyncDelegator:V,__asyncValues:S,__makeTemplateObject:X,__importStar:J,__importDefault:k,__classPrivateFieldGet:Y,__classPrivateFieldSet:f,__classPrivateFieldIn:v,__addDisposableResource:H,__disposeResources:N}}},I={};function e(C){var t=I[C];if(void 0!==t)return t.exports;var l=I[C]={exports:{}};return g[C](l,l.exports,e),l.exports}e.d=function(g,I){for(var C in I)e.o(I,C)&&!e.o(g,C)&&Object.defineProperty(g,C,{enumerable:!0,get:I[C]})},e.o=function(g,I){return Object.prototype.hasOwnProperty.call(g,I)},e.r=function(g){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})};var l={};return function(){var g=l;Object.defineProperty(g,"__esModule",{value:!0}),g.useReactToPrint=g.ReactToPrint=g.PrintContextConsumer=void 0;var I=e(328);Object.defineProperty(g,"PrintContextConsumer",{enumerable:!0,get:function(){return I.PrintContextConsumer}});var C=e(428);Object.defineProperty(g,"ReactToPrint",{enumerable:!0,get:function(){return C.ReactToPrint}});var t=e(892);Object.defineProperty(g,"useReactToPrint",{enumerable:!0,get:function(){return t.useReactToPrint}});var n=e(428);g.default=n.ReactToPrint}(),l}())},153:(g,I,e)=>{"use strict";var C=e(43),t=Symbol.for("react.element"),l=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,o=C.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function i(g,I,e){var C,l={},i=null,A=null;for(C in void 0!==e&&(i=""+e),void 0!==I.key&&(i=""+I.key),void 0!==I.ref&&(A=I.ref),I)n.call(I,C)&&!a.hasOwnProperty(C)&&(l[C]=I[C]);if(g&&g.defaultProps)for(C in I=g.defaultProps)void 0===l[C]&&(l[C]=I[C]);return{$$typeof:t,type:g,key:i,ref:A,props:l,_owner:o.current}}I.Fragment=l,I.jsx=i,I.jsxs=i},202:(g,I)=>{"use strict";var e=Symbol.for("react.element"),C=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),a=Symbol.for("react.context"),i=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),s=Symbol.for("react.lazy"),d=Symbol.iterator;var r={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b=Object.assign,u={};function m(g,I,e){this.props=g,this.context=I,this.refs=u,this.updater=e||r}function Z(){}function h(g,I,e){this.props=g,this.context=I,this.refs=u,this.updater=e||r}m.prototype.isReactComponent={},m.prototype.setState=function(g,I){if("object"!==typeof g&&"function"!==typeof g&&null!=g)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,g,I,"setState")},m.prototype.forceUpdate=function(g){this.updater.enqueueForceUpdate(this,g,"forceUpdate")},Z.prototype=m.prototype;var G=h.prototype=new Z;G.constructor=h,b(G,m.prototype),G.isPureReactComponent=!0;var B=Array.isArray,y=Object.prototype.hasOwnProperty,p={current:null},W={key:!0,ref:!0,__self:!0,__source:!0};function V(g,I,C){var t,l={},n=null,o=null;if(null!=I)for(t in void 0!==I.ref&&(o=I.ref),void 0!==I.key&&(n=""+I.key),I)y.call(I,t)&&!W.hasOwnProperty(t)&&(l[t]=I[t]);var a=arguments.length-2;if(1===a)l.children=C;else if(1<a){for(var i=Array(a),A=0;A<a;A++)i[A]=arguments[A+2];l.children=i}if(g&&g.defaultProps)for(t in a=g.defaultProps)void 0===l[t]&&(l[t]=a[t]);return{$$typeof:e,type:g,key:n,ref:o,props:l,_owner:p.current}}function S(g){return"object"===typeof g&&null!==g&&g.$$typeof===e}var X=/\/+/g;function R(g,I){return"object"===typeof g&&null!==g&&null!=g.key?function(g){var I={"=":"=0",":":"=2"};return"$"+g.replace(/[=:]/g,(function(g){return I[g]}))}(""+g.key):I.toString(36)}function J(g,I,t,l,n){var o=typeof g;"undefined"!==o&&"boolean"!==o||(g=null);var a=!1;if(null===g)a=!0;else switch(o){case"string":case"number":a=!0;break;case"object":switch(g.$$typeof){case e:case C:a=!0}}if(a)return n=n(a=g),g=""===l?"."+R(a,0):l,B(n)?(t="",null!=g&&(t=g.replace(X,"$&/")+"/"),J(n,I,t,"",(function(g){return g}))):null!=n&&(S(n)&&(n=function(g,I){return{$$typeof:e,type:g.type,key:I,ref:g.ref,props:g.props,_owner:g._owner}}(n,t+(!n.key||a&&a.key===n.key?"":(""+n.key).replace(X,"$&/")+"/")+g)),I.push(n)),1;if(a=0,l=""===l?".":l+":",B(g))for(var i=0;i<g.length;i++){var A=l+R(o=g[i],i);a+=J(o,I,t,A,n)}else if(A=function(g){return null===g||"object"!==typeof g?null:"function"===typeof(g=d&&g[d]||g["@@iterator"])?g:null}(g),"function"===typeof A)for(g=A.call(g),i=0;!(o=g.next()).done;)a+=J(o=o.value,I,t,A=l+R(o,i++),n);else if("object"===o)throw I=String(g),Error("Objects are not valid as a React child (found: "+("[object Object]"===I?"object with keys {"+Object.keys(g).join(", ")+"}":I)+"). If you meant to render a collection of children, use an array instead.");return a}function k(g,I,e){if(null==g)return g;var C=[],t=0;return J(g,C,"","",(function(g){return I.call(e,g,t++)})),C}function Y(g){if(-1===g._status){var I=g._result;(I=I()).then((function(I){0!==g._status&&-1!==g._status||(g._status=1,g._result=I)}),(function(I){0!==g._status&&-1!==g._status||(g._status=2,g._result=I)})),-1===g._status&&(g._status=0,g._result=I)}if(1===g._status)return g._result.default;throw g._result}var f={current:null},v={transition:null},H={ReactCurrentDispatcher:f,ReactCurrentBatchConfig:v,ReactCurrentOwner:p};I.Children={map:k,forEach:function(g,I,e){k(g,(function(){I.apply(this,arguments)}),e)},count:function(g){var I=0;return k(g,(function(){I++})),I},toArray:function(g){return k(g,(function(g){return g}))||[]},only:function(g){if(!S(g))throw Error("React.Children.only expected to receive a single React element child.");return g}},I.Component=m,I.Fragment=t,I.Profiler=n,I.PureComponent=h,I.StrictMode=l,I.Suspense=A,I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=H,I.cloneElement=function(g,I,C){if(null===g||void 0===g)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+g+".");var t=b({},g.props),l=g.key,n=g.ref,o=g._owner;if(null!=I){if(void 0!==I.ref&&(n=I.ref,o=p.current),void 0!==I.key&&(l=""+I.key),g.type&&g.type.defaultProps)var a=g.type.defaultProps;for(i in I)y.call(I,i)&&!W.hasOwnProperty(i)&&(t[i]=void 0===I[i]&&void 0!==a?a[i]:I[i])}var i=arguments.length-2;if(1===i)t.children=C;else if(1<i){a=Array(i);for(var A=0;A<i;A++)a[A]=arguments[A+2];t.children=a}return{$$typeof:e,type:g.type,key:l,ref:n,props:t,_owner:o}},I.createContext=function(g){return(g={$$typeof:a,_currentValue:g,_currentValue2:g,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:g},g.Consumer=g},I.createElement=V,I.createFactory=function(g){var I=V.bind(null,g);return I.type=g,I},I.createRef=function(){return{current:null}},I.forwardRef=function(g){return{$$typeof:i,render:g}},I.isValidElement=S,I.lazy=function(g){return{$$typeof:s,_payload:{_status:-1,_result:g},_init:Y}},I.memo=function(g,I){return{$$typeof:c,type:g,compare:void 0===I?null:I}},I.startTransition=function(g){var I=v.transition;v.transition={};try{g()}finally{v.transition=I}},I.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},I.useCallback=function(g,I){return f.current.useCallback(g,I)},I.useContext=function(g){return f.current.useContext(g)},I.useDebugValue=function(){},I.useDeferredValue=function(g){return f.current.useDeferredValue(g)},I.useEffect=function(g,I){return f.current.useEffect(g,I)},I.useId=function(){return f.current.useId()},I.useImperativeHandle=function(g,I,e){return f.current.useImperativeHandle(g,I,e)},I.useInsertionEffect=function(g,I){return f.current.useInsertionEffect(g,I)},I.useLayoutEffect=function(g,I){return f.current.useLayoutEffect(g,I)},I.useMemo=function(g,I){return f.current.useMemo(g,I)},I.useReducer=function(g,I,e){return f.current.useReducer(g,I,e)},I.useRef=function(g){return f.current.useRef(g)},I.useState=function(g){return f.current.useState(g)},I.useSyncExternalStore=function(g,I,e){return f.current.useSyncExternalStore(g,I,e)},I.useTransition=function(){return f.current.useTransition()},I.version="18.2.0"},43:(g,I,e)=>{"use strict";g.exports=e(202)},579:(g,I,e)=>{"use strict";g.exports=e(153)},234:(g,I)=>{"use strict";function e(g,I){var e=g.length;g.push(I);g:for(;0<e;){var C=e-1>>>1,t=g[C];if(!(0<l(t,I)))break g;g[C]=I,g[e]=t,e=C}}function C(g){return 0===g.length?null:g[0]}function t(g){if(0===g.length)return null;var I=g[0],e=g.pop();if(e!==I){g[0]=e;g:for(var C=0,t=g.length,n=t>>>1;C<n;){var o=2*(C+1)-1,a=g[o],i=o+1,A=g[i];if(0>l(a,e))i<t&&0>l(A,a)?(g[C]=A,g[i]=e,C=i):(g[C]=a,g[o]=e,C=o);else{if(!(i<t&&0>l(A,e)))break g;g[C]=A,g[i]=e,C=i}}}return I}function l(g,I){var e=g.sortIndex-I.sortIndex;return 0!==e?e:g.id-I.id}if("object"===typeof performance&&"function"===typeof performance.now){var n=performance;I.unstable_now=function(){return n.now()}}else{var o=Date,a=o.now();I.unstable_now=function(){return o.now()-a}}var i=[],A=[],c=1,s=null,d=3,r=!1,b=!1,u=!1,m="function"===typeof setTimeout?setTimeout:null,Z="function"===typeof clearTimeout?clearTimeout:null,h="undefined"!==typeof setImmediate?setImmediate:null;function G(g){for(var I=C(A);null!==I;){if(null===I.callback)t(A);else{if(!(I.startTime<=g))break;t(A),I.sortIndex=I.expirationTime,e(i,I)}I=C(A)}}function B(g){if(u=!1,G(g),!b)if(null!==C(i))b=!0,v(y);else{var I=C(A);null!==I&&H(B,I.startTime-g)}}function y(g,e){b=!1,u&&(u=!1,Z(S),S=-1),r=!0;var l=d;try{for(G(e),s=C(i);null!==s&&(!(s.expirationTime>e)||g&&!J());){var n=s.callback;if("function"===typeof n){s.callback=null,d=s.priorityLevel;var o=n(s.expirationTime<=e);e=I.unstable_now(),"function"===typeof o?s.callback=o:s===C(i)&&t(i),G(e)}else t(i);s=C(i)}if(null!==s)var a=!0;else{var c=C(A);null!==c&&H(B,c.startTime-e),a=!1}return a}finally{s=null,d=l,r=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var p,W=!1,V=null,S=-1,X=5,R=-1;function J(){return!(I.unstable_now()-R<X)}function k(){if(null!==V){var g=I.unstable_now();R=g;var e=!0;try{e=V(!0,g)}finally{e?p():(W=!1,V=null)}}else W=!1}if("function"===typeof h)p=function(){h(k)};else if("undefined"!==typeof MessageChannel){var Y=new MessageChannel,f=Y.port2;Y.port1.onmessage=k,p=function(){f.postMessage(null)}}else p=function(){m(k,0)};function v(g){V=g,W||(W=!0,p())}function H(g,e){S=m((function(){g(I.unstable_now())}),e)}I.unstable_IdlePriority=5,I.unstable_ImmediatePriority=1,I.unstable_LowPriority=4,I.unstable_NormalPriority=3,I.unstable_Profiling=null,I.unstable_UserBlockingPriority=2,I.unstable_cancelCallback=function(g){g.callback=null},I.unstable_continueExecution=function(){b||r||(b=!0,v(y))},I.unstable_forceFrameRate=function(g){0>g||125<g?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):X=0<g?Math.floor(1e3/g):5},I.unstable_getCurrentPriorityLevel=function(){return d},I.unstable_getFirstCallbackNode=function(){return C(i)},I.unstable_next=function(g){switch(d){case 1:case 2:case 3:var I=3;break;default:I=d}var e=d;d=I;try{return g()}finally{d=e}},I.unstable_pauseExecution=function(){},I.unstable_requestPaint=function(){},I.unstable_runWithPriority=function(g,I){switch(g){case 1:case 2:case 3:case 4:case 5:break;default:g=3}var e=d;d=g;try{return I()}finally{d=e}},I.unstable_scheduleCallback=function(g,t,l){var n=I.unstable_now();switch("object"===typeof l&&null!==l?l="number"===typeof(l=l.delay)&&0<l?n+l:n:l=n,g){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return g={id:c++,callback:t,priorityLevel:g,startTime:l,expirationTime:o=l+o,sortIndex:-1},l>n?(g.sortIndex=l,e(A,g),null===C(i)&&g===C(A)&&(u?(Z(S),S=-1):u=!0,H(B,l-n))):(g.sortIndex=o,e(i,g),b||r||(b=!0,v(y))),g},I.unstable_shouldYield=J,I.unstable_wrapCallback=function(g){var I=d;return function(){var e=d;d=I;try{return g.apply(this,arguments)}finally{d=e}}}},853:(g,I,e)=>{"use strict";g.exports=e(234)}},I={};function e(C){var t=I[C];if(void 0!==t)return t.exports;var l=I[C]={exports:{}};return g[C].call(l.exports,l,l.exports,e),l.exports}e.n=g=>{var I=g&&g.__esModule?()=>g.default:()=>g;return e.d(I,{a:I}),I},(()=>{var g,I=Object.getPrototypeOf?g=>Object.getPrototypeOf(g):g=>g.__proto__;e.t=function(C,t){if(1&t&&(C=this(C)),8&t)return C;if("object"===typeof C&&C){if(4&t&&C.__esModule)return C;if(16&t&&"function"===typeof C.then)return C}var l=Object.create(null);e.r(l);var n={};g=g||[null,I({}),I([]),I(I)];for(var o=2&t&&C;"object"==typeof o&&!~g.indexOf(o);o=I(o))Object.getOwnPropertyNames(o).forEach((g=>n[g]=()=>C[g]));return n.default=()=>C,e.d(l,n),l}})(),e.d=(g,I)=>{for(var C in I)e.o(I,C)&&!e.o(g,C)&&Object.defineProperty(g,C,{enumerable:!0,get:I[C]})},e.o=(g,I)=>Object.prototype.hasOwnProperty.call(g,I),e.r=g=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},(()=>{"use strict";var g={};e.r(g),e.d(g,{hasBrowserEnv:()=>Pi,hasStandardBrowserEnv:()=>Oi,hasStandardBrowserWebWorkerEnv:()=>qi});var I,C=e(43),t=e.t(C,2),l=e(391);function n(){return n=Object.assign?Object.assign.bind():function(g){for(var I=1;I<arguments.length;I++){var e=arguments[I];for(var C in e)Object.prototype.hasOwnProperty.call(e,C)&&(g[C]=e[C])}return g},n.apply(this,arguments)}!function(g){g.Pop="POP",g.Push="PUSH",g.Replace="REPLACE"}(I||(I={}));const o="popstate";function a(g,I){if(!1===g||null===g||"undefined"===typeof g)throw new Error(I)}function i(g,I){if(!g){"undefined"!==typeof console&&console.warn(I);try{throw new Error(I)}catch(e){}}}function A(g,I){return{usr:g.state,key:g.key,idx:I}}function c(g,I,e,C){return void 0===e&&(e=null),n({pathname:"string"===typeof g?g:g.pathname,search:"",hash:""},"string"===typeof I?d(I):I,{state:e,key:I&&I.key||C||Math.random().toString(36).substr(2,8)})}function s(g){let{pathname:I="/",search:e="",hash:C=""}=g;return e&&"?"!==e&&(I+="?"===e.charAt(0)?e:"?"+e),C&&"#"!==C&&(I+="#"===C.charAt(0)?C:"#"+C),I}function d(g){let I={};if(g){let e=g.indexOf("#");e>=0&&(I.hash=g.substr(e),g=g.substr(0,e));let C=g.indexOf("?");C>=0&&(I.search=g.substr(C),g=g.substr(0,C)),g&&(I.pathname=g)}return I}function r(g,e,C,t){void 0===t&&(t={});let{window:l=document.defaultView,v5Compat:i=!1}=t,d=l.history,r=I.Pop,b=null,u=m();function m(){return(d.state||{idx:null}).idx}function Z(){r=I.Pop;let g=m(),e=null==g?null:g-u;u=g,b&&b({action:r,location:G.location,delta:e})}function h(g){let I="null"!==l.location.origin?l.location.origin:l.location.href,e="string"===typeof g?g:s(g);return e=e.replace(/ $/,"%20"),a(I,"No window.location.(origin|href) available to create URL for href: "+e),new URL(e,I)}null==u&&(u=0,d.replaceState(n({},d.state,{idx:u}),""));let G={get action(){return r},get location(){return g(l,d)},listen(g){if(b)throw new Error("A history only accepts one active listener");return l.addEventListener(o,Z),b=g,()=>{l.removeEventListener(o,Z),b=null}},createHref:g=>e(l,g),createURL:h,encodeLocation(g){let I=h(g);return{pathname:I.pathname,search:I.search,hash:I.hash}},push:function(g,e){r=I.Push;let t=c(G.location,g,e);C&&C(t,g),u=m()+1;let n=A(t,u),o=G.createHref(t);try{d.pushState(n,"",o)}catch(a){if(a instanceof DOMException&&"DataCloneError"===a.name)throw a;l.location.assign(o)}i&&b&&b({action:r,location:G.location,delta:1})},replace:function(g,e){r=I.Replace;let t=c(G.location,g,e);C&&C(t,g),u=m();let l=A(t,u),n=G.createHref(t);d.replaceState(l,"",n),i&&b&&b({action:r,location:G.location,delta:0})},go:g=>d.go(g)};return G}var b;!function(g){g.data="data",g.deferred="deferred",g.redirect="redirect",g.error="error"}(b||(b={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function u(g,I,e){void 0===e&&(e="/");let C=k(("string"===typeof I?d(I):I).pathname||"/",e);if(null==C)return null;let t=m(g);!function(g){g.sort(((g,I)=>g.score!==I.score?I.score-g.score:function(g,I){let e=g.length===I.length&&g.slice(0,-1).every(((g,e)=>g===I[e]));return e?g[g.length-1]-I[I.length-1]:0}(g.routesMeta.map((g=>g.childrenIndex)),I.routesMeta.map((g=>g.childrenIndex)))))}(t);let l=null;for(let n=0;null==l&&n<t.length;++n){let g=J(C);l=X(t[n],g)}return l}function m(g,I,e,C){void 0===I&&(I=[]),void 0===e&&(e=[]),void 0===C&&(C="");let t=(g,t,l)=>{let n={relativePath:void 0===l?g.path||"":l,caseSensitive:!0===g.caseSensitive,childrenIndex:t,route:g};n.relativePath.startsWith("/")&&(a(n.relativePath.startsWith(C),'Absolute route path "'+n.relativePath+'" nested under path "'+C+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),n.relativePath=n.relativePath.slice(C.length));let o=w([C,n.relativePath]),i=e.concat(n);g.children&&g.children.length>0&&(a(!0!==g.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),m(g.children,I,i,o)),(null!=g.path||g.index)&&I.push({path:o,score:S(o,g.index),routesMeta:i})};return g.forEach(((g,I)=>{var e;if(""!==g.path&&null!=(e=g.path)&&e.includes("?"))for(let C of Z(g.path))t(g,I,C);else t(g,I)})),I}function Z(g){let I=g.split("/");if(0===I.length)return[];let[e,...C]=I,t=e.endsWith("?"),l=e.replace(/\?$/,"");if(0===C.length)return t?[l,""]:[l];let n=Z(C.join("/")),o=[];return o.push(...n.map((g=>""===g?l:[l,g].join("/")))),t&&o.push(...n),o.map((I=>g.startsWith("/")&&""===I?"/":I))}const h=/^:[\w-]+$/,G=3,B=2,y=1,p=10,W=-2,V=g=>"*"===g;function S(g,I){let e=g.split("/"),C=e.length;return e.some(V)&&(C+=W),I&&(C+=B),e.filter((g=>!V(g))).reduce(((g,I)=>g+(h.test(I)?G:""===I?y:p)),C)}function X(g,I){let{routesMeta:e}=g,C={},t="/",l=[];for(let n=0;n<e.length;++n){let g=e[n],o=n===e.length-1,a="/"===t?I:I.slice(t.length)||"/",i=R({path:g.relativePath,caseSensitive:g.caseSensitive,end:o},a);if(!i)return null;Object.assign(C,i.params);let A=g.route;l.push({params:C,pathname:w([t,i.pathname]),pathnameBase:N(w([t,i.pathnameBase])),route:A}),"/"!==i.pathnameBase&&(t=w([t,i.pathnameBase]))}return l}function R(g,I){"string"===typeof g&&(g={path:g,caseSensitive:!1,end:!0});let[e,C]=function(g,I,e){void 0===I&&(I=!1);void 0===e&&(e=!0);i("*"===g||!g.endsWith("*")||g.endsWith("/*"),'Route path "'+g+'" will be treated as if it were "'+g.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+g.replace(/\*$/,"/*")+'".');let C=[],t="^"+g.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((g,I,e)=>(C.push({paramName:I,isOptional:null!=e}),e?"/?([^\\/]+)?":"/([^\\/]+)")));g.endsWith("*")?(C.push({paramName:"*"}),t+="*"===g||"/*"===g?"(.*)$":"(?:\\/(.+)|\\/*)$"):e?t+="\\/*$":""!==g&&"/"!==g&&(t+="(?:(?=\\/|$))");let l=new RegExp(t,I?void 0:"i");return[l,C]}(g.path,g.caseSensitive,g.end),t=I.match(e);if(!t)return null;let l=t[0],n=l.replace(/(.)\/+$/,"$1"),o=t.slice(1),a=C.reduce(((g,I,e)=>{let{paramName:C,isOptional:t}=I;if("*"===C){let g=o[e]||"";n=l.slice(0,l.length-g.length).replace(/(.)\/+$/,"$1")}const a=o[e];return g[C]=t&&!a?void 0:(a||"").replace(/%2F/g,"/"),g}),{});return{params:a,pathname:l,pathnameBase:n,pattern:g}}function J(g){try{return g.split("/").map((g=>decodeURIComponent(g).replace(/\//g,"%2F"))).join("/")}catch(I){return i(!1,'The URL path "'+g+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+I+")."),g}}function k(g,I){if("/"===I)return g;if(!g.toLowerCase().startsWith(I.toLowerCase()))return null;let e=I.endsWith("/")?I.length-1:I.length,C=g.charAt(e);return C&&"/"!==C?null:g.slice(e)||"/"}function Y(g,I,e,C){return"Cannot include a '"+g+"' character in a manually specified `to."+I+"` field ["+JSON.stringify(C)+"].  Please separate it out to the `to."+e+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function f(g){return g.filter(((g,I)=>0===I||g.route.path&&g.route.path.length>0))}function v(g,I){let e=f(g);return I?e.map(((I,e)=>e===g.length-1?I.pathname:I.pathnameBase)):e.map((g=>g.pathnameBase))}function H(g,I,e,C){let t;void 0===C&&(C=!1),"string"===typeof g?t=d(g):(t=n({},g),a(!t.pathname||!t.pathname.includes("?"),Y("?","pathname","search",t)),a(!t.pathname||!t.pathname.includes("#"),Y("#","pathname","hash",t)),a(!t.search||!t.search.includes("#"),Y("#","search","hash",t)));let l,o=""===g||""===t.pathname,i=o?"/":t.pathname;if(null==i)l=e;else{let g=I.length-1;if(!C&&i.startsWith("..")){let I=i.split("/");for(;".."===I[0];)I.shift(),g-=1;t.pathname=I.join("/")}l=g>=0?I[g]:"/"}let A=function(g,I){void 0===I&&(I="/");let{pathname:e,search:C="",hash:t=""}="string"===typeof g?d(g):g,l=e?e.startsWith("/")?e:function(g,I){let e=I.replace(/\/+$/,"").split("/");return g.split("/").forEach((g=>{".."===g?e.length>1&&e.pop():"."!==g&&e.push(g)})),e.length>1?e.join("/"):"/"}(e,I):I;return{pathname:l,search:K(C),hash:F(t)}}(t,l),c=i&&"/"!==i&&i.endsWith("/"),s=(o||"."===i)&&e.endsWith("/");return A.pathname.endsWith("/")||!c&&!s||(A.pathname+="/"),A}const w=g=>g.join("/").replace(/\/\/+/g,"/"),N=g=>g.replace(/\/+$/,"").replace(/^\/*/,"/"),K=g=>g&&"?"!==g?g.startsWith("?")?g:"?"+g:"",F=g=>g&&"#"!==g?g.startsWith("#")?g:"#"+g:"";Error;function x(g){return null!=g&&"number"===typeof g.status&&"string"===typeof g.statusText&&"boolean"===typeof g.internal&&"data"in g}const z=["post","put","patch","delete"],M=(new Set(z),["get",...z]);new Set(M),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function E(){return E=Object.assign?Object.assign.bind():function(g){for(var I=1;I<arguments.length;I++){var e=arguments[I];for(var C in e)Object.prototype.hasOwnProperty.call(e,C)&&(g[C]=e[C])}return g},E.apply(this,arguments)}const Q=C.createContext(null);const U=C.createContext(null);const L=C.createContext(null);const D=C.createContext(null);const T=C.createContext({outlet:null,matches:[],isDataRoute:!1});const j=C.createContext(null);function P(){return null!=C.useContext(D)}function O(){return P()||a(!1),C.useContext(D).location}function _(g){C.useContext(L).static||C.useLayoutEffect(g)}function q(){let{isDataRoute:g}=C.useContext(T);return g?function(){let{router:g}=og(lg.UseNavigateStable),I=ig(ng.UseNavigateStable),e=C.useRef(!1);_((()=>{e.current=!0}));let t=C.useCallback((function(C,t){void 0===t&&(t={}),e.current&&("number"===typeof C?g.navigate(C):g.navigate(C,E({fromRouteId:I},t)))}),[g,I]);return t}():function(){P()||a(!1);let g=C.useContext(Q),{basename:I,future:e,navigator:t}=C.useContext(L),{matches:l}=C.useContext(T),{pathname:n}=O(),o=JSON.stringify(v(l,e.v7_relativeSplatPath)),i=C.useRef(!1);_((()=>{i.current=!0}));let A=C.useCallback((function(e,C){if(void 0===C&&(C={}),!i.current)return;if("number"===typeof e)return void t.go(e);let l=H(e,JSON.parse(o),n,"path"===C.relative);null==g&&"/"!==I&&(l.pathname="/"===l.pathname?I:w([I,l.pathname])),(C.replace?t.replace:t.push)(l,C.state,C)}),[I,t,o,n,g]);return A}()}function $(g,e,t,l){P()||a(!1);let{navigator:n}=C.useContext(L),{matches:o}=C.useContext(T),i=o[o.length-1],A=i?i.params:{},c=(i&&i.pathname,i?i.pathnameBase:"/");i&&i.route;let s,r=O();if(e){var b;let g="string"===typeof e?d(e):e;"/"===c||(null==(b=g.pathname)?void 0:b.startsWith(c))||a(!1),s=g}else s=r;let m=s.pathname||"/",Z=m;if("/"!==c){let g=c.replace(/^\//,"").split("/");Z="/"+m.replace(/^\//,"").split("/").slice(g.length).join("/")}let h=u(g,{pathname:Z});let G=tg(h&&h.map((g=>Object.assign({},g,{params:Object.assign({},A,g.params),pathname:w([c,n.encodeLocation?n.encodeLocation(g.pathname).pathname:g.pathname]),pathnameBase:"/"===g.pathnameBase?c:w([c,n.encodeLocation?n.encodeLocation(g.pathnameBase).pathname:g.pathnameBase])}))),o,t,l);return e&&G?C.createElement(D.Provider,{value:{location:E({pathname:"/",search:"",hash:"",state:null,key:"default"},s),navigationType:I.Pop}},G):G}function gg(){let g=function(){var g;let I=C.useContext(j),e=ag(ng.UseRouteError),t=ig(ng.UseRouteError);if(void 0!==I)return I;return null==(g=e.errors)?void 0:g[t]}(),I=x(g)?g.status+" "+g.statusText:g instanceof Error?g.message:JSON.stringify(g),e=g instanceof Error?g.stack:null,t="rgba(200,200,200, 0.5)",l={padding:"0.5rem",backgroundColor:t};return C.createElement(C.Fragment,null,C.createElement("h2",null,"Unexpected Application Error!"),C.createElement("h3",{style:{fontStyle:"italic"}},I),e?C.createElement("pre",{style:l},e):null,null)}const Ig=C.createElement(gg,null);class eg extends C.Component{constructor(g){super(g),this.state={location:g.location,revalidation:g.revalidation,error:g.error}}static getDerivedStateFromError(g){return{error:g}}static getDerivedStateFromProps(g,I){return I.location!==g.location||"idle"!==I.revalidation&&"idle"===g.revalidation?{error:g.error,location:g.location,revalidation:g.revalidation}:{error:void 0!==g.error?g.error:I.error,location:I.location,revalidation:g.revalidation||I.revalidation}}componentDidCatch(g,I){console.error("React Router caught the following error during render",g,I)}render(){return void 0!==this.state.error?C.createElement(T.Provider,{value:this.props.routeContext},C.createElement(j.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Cg(g){let{routeContext:I,match:e,children:t}=g,l=C.useContext(Q);return l&&l.static&&l.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(l.staticContext._deepestRenderedBoundaryId=e.route.id),C.createElement(T.Provider,{value:I},t)}function tg(g,I,e,t){var l;if(void 0===I&&(I=[]),void 0===e&&(e=null),void 0===t&&(t=null),null==g){var n;if(null==(n=e)||!n.errors)return null;g=e.matches}let o=g,i=null==(l=e)?void 0:l.errors;if(null!=i){let g=o.findIndex((g=>g.route.id&&(null==i?void 0:i[g.route.id])));g>=0||a(!1),o=o.slice(0,Math.min(o.length,g+1))}let A=!1,c=-1;if(e&&t&&t.v7_partialHydration)for(let C=0;C<o.length;C++){let g=o[C];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(c=C),g.route.id){let{loaderData:I,errors:C}=e,t=g.route.loader&&void 0===I[g.route.id]&&(!C||void 0===C[g.route.id]);if(g.route.lazy||t){A=!0,o=c>=0?o.slice(0,c+1):[o[0]];break}}}return o.reduceRight(((g,t,l)=>{let n,a=!1,s=null,d=null;var r;e&&(n=i&&t.route.id?i[t.route.id]:void 0,s=t.route.errorElement||Ig,A&&(c<0&&0===l?(r="route-fallback",!1||Ag[r]||(Ag[r]=!0),a=!0,d=null):c===l&&(a=!0,d=t.route.hydrateFallbackElement||null)));let b=I.concat(o.slice(0,l+1)),u=()=>{let I;return I=n?s:a?d:t.route.Component?C.createElement(t.route.Component,null):t.route.element?t.route.element:g,C.createElement(Cg,{match:t,routeContext:{outlet:g,matches:b,isDataRoute:null!=e},children:I})};return e&&(t.route.ErrorBoundary||t.route.errorElement||0===l)?C.createElement(eg,{location:e.location,revalidation:e.revalidation,component:s,error:n,children:u(),routeContext:{outlet:null,matches:b,isDataRoute:!0}}):u()}),null)}var lg=function(g){return g.UseBlocker="useBlocker",g.UseRevalidator="useRevalidator",g.UseNavigateStable="useNavigate",g}(lg||{}),ng=function(g){return g.UseBlocker="useBlocker",g.UseLoaderData="useLoaderData",g.UseActionData="useActionData",g.UseRouteError="useRouteError",g.UseNavigation="useNavigation",g.UseRouteLoaderData="useRouteLoaderData",g.UseMatches="useMatches",g.UseRevalidator="useRevalidator",g.UseNavigateStable="useNavigate",g.UseRouteId="useRouteId",g}(ng||{});function og(g){let I=C.useContext(Q);return I||a(!1),I}function ag(g){let I=C.useContext(U);return I||a(!1),I}function ig(g){let I=function(g){let I=C.useContext(T);return I||a(!1),I}(),e=I.matches[I.matches.length-1];return e.route.id||a(!1),e.route.id}const Ag={};t.startTransition;function cg(g){a(!1)}function sg(g){let{basename:e="/",children:t=null,location:l,navigationType:n=I.Pop,navigator:o,static:i=!1,future:A}=g;P()&&a(!1);let c=e.replace(/^\/*/,"/"),s=C.useMemo((()=>({basename:c,navigator:o,static:i,future:E({v7_relativeSplatPath:!1},A)})),[c,A,o,i]);"string"===typeof l&&(l=d(l));let{pathname:r="/",search:b="",hash:u="",state:m=null,key:Z="default"}=l,h=C.useMemo((()=>{let g=k(r,c);return null==g?null:{location:{pathname:g,search:b,hash:u,state:m,key:Z},navigationType:n}}),[c,r,b,u,m,Z,n]);return null==h?null:C.createElement(L.Provider,{value:s},C.createElement(D.Provider,{children:t,value:h}))}function dg(g){let{children:I,location:e}=g;return $(rg(I),e)}new Promise((()=>{}));C.Component;function rg(g,I){void 0===I&&(I=[]);let e=[];return C.Children.forEach(g,((g,t)=>{if(!C.isValidElement(g))return;let l=[...I,t];if(g.type===C.Fragment)return void e.push.apply(e,rg(g.props.children,l));g.type!==cg&&a(!1),g.props.index&&g.props.children&&a(!1);let n={id:g.props.id||l.join("-"),caseSensitive:g.props.caseSensitive,element:g.props.element,Component:g.props.Component,index:g.props.index,path:g.props.path,loader:g.props.loader,action:g.props.action,errorElement:g.props.errorElement,ErrorBoundary:g.props.ErrorBoundary,hasErrorBoundary:null!=g.props.ErrorBoundary||null!=g.props.errorElement,shouldRevalidate:g.props.shouldRevalidate,handle:g.props.handle,lazy:g.props.lazy};g.props.children&&(n.children=rg(g.props.children,l)),e.push(n)})),e}var bg=e(309),ug=e.n(bg),mg=e(579);const Zg=()=>{const g=q(),[I,e]=(0,C.useState)({code:"",sellingPrice:"",quantitySold:1,customerPhoneNo:""}),[t,l]=(0,C.useState)(!1),[n,o]=(0,C.useState)(!1),[a,i]=(0,C.useState)(!1),[A,c]=(0,C.useState)(0),[s,d]=(0,C.useState)(!1),[r,b]=(0,C.useState)(""),[u,m]=(0,C.useState)(!1),[Z,h]=(0,C.useState)(!1);(0,C.useEffect)((()=>{window.localStorage.getItem("userInfo")||g("/login")}),[g]),(0,C.useEffect)((()=>{A>0&&""!==I.sellingPrice&&parseFloat(I.sellingPrice)>0?l(!0):l(!1)}),[A,I.sellingPrice]);(0,C.useEffect)((()=>{(async()=>{try{if(I.code){d(!0);const C=await fetch("/api/availablequantity?code=".concat(I.code),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(C.ok){var{availableQuantity:e}=await C.json();c(e)}else l(!1),c(0),console.log("Failed to fetch available quantity"),401===C.status&&(window.localStorage.clear(),g("/login"));d(!1)}else c(0)}catch(C){console.log(C)}})()}),[I.code]);const G=g=>{const{name:I,value:C}=g.target;if(!("sellingPrice"===I&&parseFloat(C)<0)){if("customerPhoneNo"===I){if(!/^\d*$/.test(C))return;10===C.length||0===C.length?h(!1):h(!0)}e((g=>({...g,[I]:C.toUpperCase()})))}};return(0,mg.jsxs)("div",{className:"bg-white p-6 rounded shadow-lg",children:[(0,mg.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Sale"}),(0,mg.jsxs)("div",{className:"mb-4",children:[(0,mg.jsx)("label",{htmlFor:"code",className:"block text-sm font-medium text-gray-700",children:"Code"}),(0,mg.jsx)("input",{name:"code",type:"string",placeholder:"Product code",value:I.code,onChange:G,className:"mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"}),(0,mg.jsxs)("p",{className:"mb-4 text-green-500",children:["Available Quantity:"," ",s?"Fetching Quantity...":A]}),(0,mg.jsxs)("div",{className:"mb-4",children:[(0,mg.jsx)("label",{htmlFor:"sellingPrice",className:"block text-sm font-medium text-gray-700",children:"Selling Price"}),(0,mg.jsx)("input",{type:"number",placeholder:"Selling price",name:"sellingPrice",value:I.sellingPrice,onChange:G,className:"mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,mg.jsxs)("div",{className:"mb-4",children:[(0,mg.jsx)("label",{htmlFor:"customerPhoneNo",className:"block text-sm font-medium text-gray-700",children:"Customer Phone No."}),(0,mg.jsx)("input",{name:"customerPhoneNo",type:"tel",placeholder:"Customer's phone number",value:I.customerPhoneNo,onChange:G,className:"mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),Z&&(0,mg.jsx)("div",{className:"mt-2 p-2 bg-red-400 text-white font-bold text-center rounded-md",children:"Invalid phone number"})]}),(0,mg.jsxs)("div",{className:"flex justify-center",children:[(0,mg.jsx)("button",{onClick:()=>{b(""),e((g=>({...g,code:""})))},className:"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded m-1",children:"Reset QR Code"}),(0,mg.jsx)("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded m-1",onClick:()=>m(!u),children:"Toggle Scanner"})]}),u&&(0,mg.jsx)(ug(),{onScan:g=>{g&&/^[A-Z]{3}\d{4}$/.test(g.text)&&(e((I=>({...I,code:g.text}))),b(g.text),m(!1))},onError:g=>{console.error("Error while scanning QR code:",g)},constraints:{audio:!1,video:{facingMode:"environment"}},style:{width:"100%"}}),r&&(0,mg.jsxs)("p",{children:["QR Code Scanned: ",r]}),a&&(0,mg.jsx)(mg.Fragment,{children:(0,mg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999},children:(0,mg.jsxs)("div",{className:"flex items-center justify-center bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative w-full m-5",role:"alert",children:[(0,mg.jsx)("strong",{className:"font-bold",children:"Product sold"}),(0,mg.jsx)("span",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",children:(0,mg.jsxs)("svg",{className:"fill-current h-6 w-6 text-green-500 cursor-pointer",role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",onClick:()=>i(!1),children:[(0,mg.jsx)("title",{children:"Close"}),(0,mg.jsx)("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})]})})]})})}),(0,mg.jsx)("button",{onClick:async()=>{o(!0),l(!1);try{const C=await fetch("/api/sell",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)},body:JSON.stringify(I)});C.ok?(e({code:"",sellingPrice:"",quantitySold:1,customerPhoneNo:""}),console.log("Product sold from inventory successfully!"),i(!0),setTimeout((()=>{i(!1)}),3e3)):401===C.status?(window.localStorage.clear(),g("/login")):console.error("Failed to sell product from inventory")}catch(C){console.error("Error:",C)}finally{o(!1)}},disabled:!t||n,className:"w-full py-2 px-4 rounded focus:outline-none focus:shadow-outline-indigo active:bg-indigo-800 ".concat(t?"bg-indigo-500 text-white":"bg-gray-300 text-black opacity-50 cursor-not-allowed"),children:n?"Selling...":"Sell"})]})};var hg,Gg=Object.defineProperty,Bg=Object.getOwnPropertySymbols,yg=Object.prototype.hasOwnProperty,pg=Object.prototype.propertyIsEnumerable,Wg=(g,I,e)=>I in g?Gg(g,I,{enumerable:!0,configurable:!0,writable:!0,value:e}):g[I]=e,Vg=(g,I)=>{for(var e in I||(I={}))yg.call(I,e)&&Wg(g,e,I[e]);if(Bg)for(var e of Bg(I))pg.call(I,e)&&Wg(g,e,I[e]);return g},Sg=(g,I)=>{var e={};for(var C in g)yg.call(g,C)&&I.indexOf(C)<0&&(e[C]=g[C]);if(null!=g&&Bg)for(var C of Bg(g))I.indexOf(C)<0&&pg.call(g,C)&&(e[C]=g[C]);return e};(g=>{const I=class{constructor(g,e,C,t){if(this.version=g,this.errorCorrectionLevel=e,this.modules=[],this.isFunction=[],g<I.MIN_VERSION||g>I.MAX_VERSION)throw new RangeError("Version value out of range");if(t<-1||t>7)throw new RangeError("Mask value out of range");this.size=4*g+17;let n=[];for(let I=0;I<this.size;I++)n.push(!1);for(let I=0;I<this.size;I++)this.modules.push(n.slice()),this.isFunction.push(n.slice());this.drawFunctionPatterns();const o=this.addEccAndInterleave(C);if(this.drawCodewords(o),-1==t){let g=1e9;for(let I=0;I<8;I++){this.applyMask(I),this.drawFormatBits(I);const e=this.getPenaltyScore();e<g&&(t=I,g=e),this.applyMask(I)}}l(0<=t&&t<=7),this.mask=t,this.applyMask(t),this.drawFormatBits(t),this.isFunction=[]}static encodeText(e,C){const t=g.QrSegment.makeSegments(e);return I.encodeSegments(t,C)}static encodeBinary(e,C){const t=g.QrSegment.makeBytes(e);return I.encodeSegments([t],C)}static encodeSegments(g,e){let t,n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,c=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if(!(I.MIN_VERSION<=a&&a<=i&&i<=I.MAX_VERSION)||A<-1||A>7)throw new RangeError("Invalid value");for(t=a;;t++){const C=8*I.getNumDataCodewords(t,e),l=o.getTotalBits(g,t);if(l<=C){n=l;break}if(t>=i)throw new RangeError("Data too long")}for(const C of[I.Ecc.MEDIUM,I.Ecc.QUARTILE,I.Ecc.HIGH])c&&n<=8*I.getNumDataCodewords(t,C)&&(e=C);let s=[];for(const I of g){C(I.mode.modeBits,4,s),C(I.numChars,I.mode.numCharCountBits(t),s);for(const g of I.getData())s.push(g)}l(s.length==n);const d=8*I.getNumDataCodewords(t,e);l(s.length<=d),C(0,Math.min(4,d-s.length),s),C(0,(8-s.length%8)%8,s),l(s.length%8==0);for(let I=236;s.length<d;I^=253)C(I,8,s);let r=[];for(;8*r.length<s.length;)r.push(0);return s.forEach(((g,I)=>r[I>>>3]|=g<<7-(7&I))),new I(t,e,r,A)}getModule(g,I){return 0<=g&&g<this.size&&0<=I&&I<this.size&&this.modules[I][g]}getModules(){return this.modules}drawFunctionPatterns(){for(let e=0;e<this.size;e++)this.setFunctionModule(6,e,e%2==0),this.setFunctionModule(e,6,e%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const g=this.getAlignmentPatternPositions(),I=g.length;for(let e=0;e<I;e++)for(let C=0;C<I;C++)0==e&&0==C||0==e&&C==I-1||e==I-1&&0==C||this.drawAlignmentPattern(g[e],g[C]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(g){const I=this.errorCorrectionLevel.formatBits<<3|g;let e=I;for(let t=0;t<10;t++)e=e<<1^1335*(e>>>9);const C=21522^(I<<10|e);l(C>>>15==0);for(let l=0;l<=5;l++)this.setFunctionModule(8,l,t(C,l));this.setFunctionModule(8,7,t(C,6)),this.setFunctionModule(8,8,t(C,7)),this.setFunctionModule(7,8,t(C,8));for(let l=9;l<15;l++)this.setFunctionModule(14-l,8,t(C,l));for(let l=0;l<8;l++)this.setFunctionModule(this.size-1-l,8,t(C,l));for(let l=8;l<15;l++)this.setFunctionModule(8,this.size-15+l,t(C,l));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let g=this.version;for(let e=0;e<12;e++)g=g<<1^7973*(g>>>11);const I=this.version<<12|g;l(I>>>18==0);for(let e=0;e<18;e++){const g=t(I,e),C=this.size-11+e%3,l=Math.floor(e/3);this.setFunctionModule(C,l,g),this.setFunctionModule(l,C,g)}}drawFinderPattern(g,I){for(let e=-4;e<=4;e++)for(let C=-4;C<=4;C++){const t=Math.max(Math.abs(C),Math.abs(e)),l=g+C,n=I+e;0<=l&&l<this.size&&0<=n&&n<this.size&&this.setFunctionModule(l,n,2!=t&&4!=t)}}drawAlignmentPattern(g,I){for(let e=-2;e<=2;e++)for(let C=-2;C<=2;C++)this.setFunctionModule(g+C,I+e,1!=Math.max(Math.abs(C),Math.abs(e)))}setFunctionModule(g,I,e){this.modules[I][g]=e,this.isFunction[I][g]=!0}addEccAndInterleave(g){const e=this.version,C=this.errorCorrectionLevel;if(g.length!=I.getNumDataCodewords(e,C))throw new RangeError("Invalid argument");const t=I.NUM_ERROR_CORRECTION_BLOCKS[C.ordinal][e],n=I.ECC_CODEWORDS_PER_BLOCK[C.ordinal][e],o=Math.floor(I.getNumRawDataModules(e)/8),a=t-o%t,i=Math.floor(o/t);let A=[];const c=I.reedSolomonComputeDivisor(n);for(let l=0,d=0;l<t;l++){let e=g.slice(d,d+i-n+(l<a?0:1));d+=e.length;const C=I.reedSolomonComputeRemainder(e,c);l<a&&e.push(0),A.push(e.concat(C))}let s=[];for(let I=0;I<A[0].length;I++)A.forEach(((g,e)=>{(I!=i-n||e>=a)&&s.push(g[I])}));return l(s.length==o),s}drawCodewords(g){if(g.length!=Math.floor(I.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let e=0;for(let I=this.size-1;I>=1;I-=2){6==I&&(I=5);for(let C=0;C<this.size;C++)for(let l=0;l<2;l++){const n=I-l,o=0==(I+1&2)?this.size-1-C:C;!this.isFunction[o][n]&&e<8*g.length&&(this.modules[o][n]=t(g[e>>>3],7-(7&e)),e++)}}l(e==8*g.length)}applyMask(g){if(g<0||g>7)throw new RangeError("Mask value out of range");for(let I=0;I<this.size;I++)for(let e=0;e<this.size;e++){let C;switch(g){case 0:C=(e+I)%2==0;break;case 1:C=I%2==0;break;case 2:C=e%3==0;break;case 3:C=(e+I)%3==0;break;case 4:C=(Math.floor(e/3)+Math.floor(I/2))%2==0;break;case 5:C=e*I%2+e*I%3==0;break;case 6:C=(e*I%2+e*I%3)%2==0;break;case 7:C=((e+I)%2+e*I%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[I][e]&&C&&(this.modules[I][e]=!this.modules[I][e])}}getPenaltyScore(){let g=0;for(let l=0;l<this.size;l++){let e=!1,C=0,t=[0,0,0,0,0,0,0];for(let n=0;n<this.size;n++)this.modules[l][n]==e?(C++,5==C?g+=I.PENALTY_N1:C>5&&g++):(this.finderPenaltyAddHistory(C,t),e||(g+=this.finderPenaltyCountPatterns(t)*I.PENALTY_N3),e=this.modules[l][n],C=1);g+=this.finderPenaltyTerminateAndCount(e,C,t)*I.PENALTY_N3}for(let l=0;l<this.size;l++){let e=!1,C=0,t=[0,0,0,0,0,0,0];for(let n=0;n<this.size;n++)this.modules[n][l]==e?(C++,5==C?g+=I.PENALTY_N1:C>5&&g++):(this.finderPenaltyAddHistory(C,t),e||(g+=this.finderPenaltyCountPatterns(t)*I.PENALTY_N3),e=this.modules[n][l],C=1);g+=this.finderPenaltyTerminateAndCount(e,C,t)*I.PENALTY_N3}for(let l=0;l<this.size-1;l++)for(let e=0;e<this.size-1;e++){const C=this.modules[l][e];C==this.modules[l][e+1]&&C==this.modules[l+1][e]&&C==this.modules[l+1][e+1]&&(g+=I.PENALTY_N2)}let e=0;for(const I of this.modules)e=I.reduce(((g,I)=>g+(I?1:0)),e);const C=this.size*this.size,t=Math.ceil(Math.abs(20*e-10*C)/C)-1;return l(0<=t&&t<=9),g+=t*I.PENALTY_N4,l(0<=g&&g<=2568888),g}getAlignmentPatternPositions(){if(1==this.version)return[];{const g=Math.floor(this.version/7)+2,I=32==this.version?26:2*Math.ceil((4*this.version+4)/(2*g-2));let e=[6];for(let C=this.size-7;e.length<g;C-=I)e.splice(1,0,C);return e}}static getNumRawDataModules(g){if(g<I.MIN_VERSION||g>I.MAX_VERSION)throw new RangeError("Version number out of range");let e=(16*g+128)*g+64;if(g>=2){const I=Math.floor(g/7)+2;e-=(25*I-10)*I-55,g>=7&&(e-=36)}return l(208<=e&&e<=29648),e}static getNumDataCodewords(g,e){return Math.floor(I.getNumRawDataModules(g)/8)-I.ECC_CODEWORDS_PER_BLOCK[e.ordinal][g]*I.NUM_ERROR_CORRECTION_BLOCKS[e.ordinal][g]}static reedSolomonComputeDivisor(g){if(g<1||g>255)throw new RangeError("Degree out of range");let e=[];for(let I=0;I<g-1;I++)e.push(0);e.push(1);let C=1;for(let t=0;t<g;t++){for(let g=0;g<e.length;g++)e[g]=I.reedSolomonMultiply(e[g],C),g+1<e.length&&(e[g]^=e[g+1]);C=I.reedSolomonMultiply(C,2)}return e}static reedSolomonComputeRemainder(g,e){let C=e.map((g=>0));for(const t of g){const g=t^C.shift();C.push(0),e.forEach(((e,t)=>C[t]^=I.reedSolomonMultiply(e,g)))}return C}static reedSolomonMultiply(g,I){if(g>>>8!=0||I>>>8!=0)throw new RangeError("Byte out of range");let e=0;for(let C=7;C>=0;C--)e=e<<1^285*(e>>>7),e^=(I>>>C&1)*g;return l(e>>>8==0),e}finderPenaltyCountPatterns(g){const I=g[1];l(I<=3*this.size);const e=I>0&&g[2]==I&&g[3]==3*I&&g[4]==I&&g[5]==I;return(e&&g[0]>=4*I&&g[6]>=I?1:0)+(e&&g[6]>=4*I&&g[0]>=I?1:0)}finderPenaltyTerminateAndCount(g,I,e){return g&&(this.finderPenaltyAddHistory(I,e),I=0),I+=this.size,this.finderPenaltyAddHistory(I,e),this.finderPenaltyCountPatterns(e)}finderPenaltyAddHistory(g,I){0==I[0]&&(g+=this.size),I.pop(),I.unshift(g)}};let e=I;function C(g,I,e){if(I<0||I>31||g>>>I!=0)throw new RangeError("Value out of range");for(let C=I-1;C>=0;C--)e.push(g>>>C&1)}function t(g,I){return 0!=(g>>>I&1)}function l(g){if(!g)throw new Error("Assertion error")}e.MIN_VERSION=1,e.MAX_VERSION=40,e.PENALTY_N1=3,e.PENALTY_N2=3,e.PENALTY_N3=40,e.PENALTY_N4=10,e.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],e.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],g.QrCode=e;const n=class{constructor(g,I,e){if(this.mode=g,this.numChars=I,this.bitData=e,I<0)throw new RangeError("Invalid argument");this.bitData=e.slice()}static makeBytes(g){let I=[];for(const e of g)C(e,8,I);return new n(n.Mode.BYTE,g.length,I)}static makeNumeric(g){if(!n.isNumeric(g))throw new RangeError("String contains non-numeric characters");let I=[];for(let e=0;e<g.length;){const t=Math.min(g.length-e,3);C(parseInt(g.substr(e,t),10),3*t+1,I),e+=t}return new n(n.Mode.NUMERIC,g.length,I)}static makeAlphanumeric(g){if(!n.isAlphanumeric(g))throw new RangeError("String contains unencodable characters in alphanumeric mode");let I,e=[];for(I=0;I+2<=g.length;I+=2){let t=45*n.ALPHANUMERIC_CHARSET.indexOf(g.charAt(I));t+=n.ALPHANUMERIC_CHARSET.indexOf(g.charAt(I+1)),C(t,11,e)}return I<g.length&&C(n.ALPHANUMERIC_CHARSET.indexOf(g.charAt(I)),6,e),new n(n.Mode.ALPHANUMERIC,g.length,e)}static makeSegments(g){return""==g?[]:n.isNumeric(g)?[n.makeNumeric(g)]:n.isAlphanumeric(g)?[n.makeAlphanumeric(g)]:[n.makeBytes(n.toUtf8ByteArray(g))]}static makeEci(g){let I=[];if(g<0)throw new RangeError("ECI assignment value out of range");if(g<128)C(g,8,I);else if(g<16384)C(2,2,I),C(g,14,I);else{if(!(g<1e6))throw new RangeError("ECI assignment value out of range");C(6,3,I),C(g,21,I)}return new n(n.Mode.ECI,0,I)}static isNumeric(g){return n.NUMERIC_REGEX.test(g)}static isAlphanumeric(g){return n.ALPHANUMERIC_REGEX.test(g)}getData(){return this.bitData.slice()}static getTotalBits(g,I){let e=0;for(const C of g){const g=C.mode.numCharCountBits(I);if(C.numChars>=1<<g)return 1/0;e+=4+g+C.bitData.length}return e}static toUtf8ByteArray(g){g=encodeURI(g);let I=[];for(let e=0;e<g.length;e++)"%"!=g.charAt(e)?I.push(g.charCodeAt(e)):(I.push(parseInt(g.substr(e+1,2),16)),e+=2);return I}};let o=n;o.NUMERIC_REGEX=/^[0-9]*$/,o.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,o.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",g.QrSegment=o})(hg||(hg={})),(g=>{let I;(g=>{const I=class{constructor(g,I){this.ordinal=g,this.formatBits=I}};let e=I;e.LOW=new I(0,1),e.MEDIUM=new I(1,0),e.QUARTILE=new I(2,3),e.HIGH=new I(3,2),g.Ecc=e})(I=g.QrCode||(g.QrCode={}))})(hg||(hg={})),(g=>{let I;(g=>{const I=class{constructor(g,I){this.modeBits=g,this.numBitsCharCount=I}numCharCountBits(g){return this.numBitsCharCount[Math.floor((g+7)/17)]}};let e=I;e.NUMERIC=new I(1,[10,12,14]),e.ALPHANUMERIC=new I(2,[9,11,13]),e.BYTE=new I(4,[8,16,16]),e.KANJI=new I(8,[8,10,12]),e.ECI=new I(7,[0,0,0]),g.Mode=e})(I=g.QrSegment||(g.QrSegment={}))})(hg||(hg={}));var Xg=hg,Rg={L:Xg.QrCode.Ecc.LOW,M:Xg.QrCode.Ecc.MEDIUM,Q:Xg.QrCode.Ecc.QUARTILE,H:Xg.QrCode.Ecc.HIGH},Jg=128,kg="L",Yg="#FFFFFF",fg="#000000",vg=!1,Hg=4,wg=.1;function Ng(g){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const e=[];return g.forEach((function(g,C){let t=null;g.forEach((function(l,n){if(!l&&null!==t)return e.push("M".concat(t+I," ").concat(C+I,"h").concat(n-t,"v1H").concat(t+I,"z")),void(t=null);if(n!==g.length-1)l&&null===t&&(t=n);else{if(!l)return;null===t?e.push("M".concat(n+I,",").concat(C+I," h1v1H").concat(n+I,"z")):e.push("M".concat(t+I,",").concat(C+I," h").concat(n+1-t,"v1H").concat(t+I,"z"))}}))})),e.join("")}function Kg(g,I){return g.slice().map(((g,e)=>e<I.y||e>=I.y+I.h?g:g.map(((g,e)=>(e<I.x||e>=I.x+I.w)&&g))))}function Fg(g,I,e,C){if(null==C)return null;const t=e?Hg:0,l=g.length+2*t,n=Math.floor(I*wg),o=l/I,a=(C.width||n)*o,i=(C.height||n)*o,A=null==C.x?g.length/2-a/2:C.x*o,c=null==C.y?g.length/2-i/2:C.y*o;let s=null;if(C.excavate){let g=Math.floor(A),I=Math.floor(c);s={x:g,y:I,w:Math.ceil(a+A-g),h:Math.ceil(i+c-I)}}return{x:A,y:c,h:i,w:a,excavation:s}}var xg=function(){try{(new Path2D).addPath(new Path2D)}catch(g){return!1}return!0}();function zg(g){const I=g,{value:e,size:t=Jg,level:l=kg,bgColor:n=Yg,fgColor:o=fg,includeMargin:a=vg,style:i,imageSettings:A}=I,c=Sg(I,["value","size","level","bgColor","fgColor","includeMargin","style","imageSettings"]),s=null==A?void 0:A.src,d=(0,C.useRef)(null),r=(0,C.useRef)(null),[b,u]=(0,C.useState)(!1);(0,C.useEffect)((()=>{if(null!=d.current){const g=d.current,I=g.getContext("2d");if(!I)return;let C=Xg.QrCode.encodeText(e,Rg[l]).getModules();const i=a?Hg:0,c=C.length+2*i,s=Fg(C,t,a,A),b=r.current,u=null!=s&&null!==b&&b.complete&&0!==b.naturalHeight&&0!==b.naturalWidth;u&&null!=s.excavation&&(C=Kg(C,s.excavation));const m=window.devicePixelRatio||1;g.height=g.width=t*m;const Z=t/c*m;I.scale(Z,Z),I.fillStyle=n,I.fillRect(0,0,c,c),I.fillStyle=o,xg?I.fill(new Path2D(Ng(C,i))):C.forEach((function(g,e){g.forEach((function(g,C){g&&I.fillRect(C+i,e+i,1,1)}))})),u&&I.drawImage(b,s.x+i,s.y+i,s.w,s.h)}})),(0,C.useEffect)((()=>{u(!1)}),[s]);const m=Vg({height:t,width:t},i);let Z=null;return null!=s&&(Z=C.createElement("img",{src:s,key:s,style:{display:"none"},onLoad:()=>{u(!0)},ref:r})),C.createElement(C.Fragment,null,C.createElement("canvas",Vg({style:m,height:t,width:t,ref:d},c)),Z)}function Mg(g){const I=g,{value:e,size:t=Jg,level:l=kg,bgColor:n=Yg,fgColor:o=fg,includeMargin:a=vg,imageSettings:i}=I,A=Sg(I,["value","size","level","bgColor","fgColor","includeMargin","imageSettings"]);let c=Xg.QrCode.encodeText(e,Rg[l]).getModules();const s=a?Hg:0,d=c.length+2*s,r=Fg(c,t,a,i);let b=null;null!=i&&null!=r&&(null!=r.excavation&&(c=Kg(c,r.excavation)),b=C.createElement("image",{xlinkHref:i.src,height:r.h,width:r.w,x:r.x+s,y:r.y+s,preserveAspectRatio:"none"}));const u=Ng(c,s);return C.createElement("svg",Vg({height:t,width:t,viewBox:"0 0 ".concat(d," ").concat(d)},A),C.createElement("path",{fill:n,d:"M0,0 h".concat(d,"v").concat(d,"H0z"),shapeRendering:"crispEdges"}),C.createElement("path",{fill:o,d:u,shapeRendering:"crispEdges"}),b)}var Eg=g=>{const I=g,{renderAs:e}=I,t=Sg(I,["renderAs"]);return"svg"===e?C.createElement(Mg,Vg({},t)):C.createElement(zg,Vg({},t))},Qg=e(141);const Ug=()=>{const g=q(),I=C.useRef(),[e,t]=(0,C.useState)({brand:"",product:"",category:"",size:[],quantityBuy:1,mrp:""}),[l,n]=(0,C.useState)({products:[],categories:[],sizes:[{size:[]}]}),[o,a]=(0,C.useState)([]),[i,A]=(0,C.useState)(!1),[c,s]=(0,C.useState)(!1),[d,r]=(0,C.useState)(!1),[b,u]=(0,C.useState)(!1),[m,Z]=(0,C.useState)([]),[h,G]=(0,C.useState)(!1),[B,y]=(0,C.useState)(!1),p=()=>{y((g=>!g))};(0,C.useEffect)((()=>{window.localStorage.getItem("userInfo")||g("/login")}),[g]),(0,C.useEffect)((()=>{m.length>0?G(!0):G(!1)}),[m]);(0,C.useEffect)((()=>{(async()=>{try{if(window.localStorage.getItem("userInfo")){const I=await fetch("/api/dropdownoption/dropdownoptions",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(I.ok){const g=await I.json();g.products.sort(((g,I)=>g.brand.localeCompare(I.brand))),g.products.forEach((g=>{g.products.sort()})),g.categories[0].category.sort(((g,I)=>g.localeCompare(I))),n(g)}else console.error("Failed to fetch dropdown options"),window.localStorage.clear(),g("/login")}}catch(I){console.log(I)}})()}),[]),(0,C.useEffect)((()=>{(()=>{const g=Object.values(e).every((g=>""!==g))&&e.size.length>0;A(g)})()}),[e]);const W=g=>{const{name:I,value:e}=g.target;("quantityBuy"===I||"mrp"===I)&&parseFloat(e)<0||t((g=>({...g,[I]:e})))},V=g=>{const{value:I}=g.target;let C=[...e.size];C.includes(I)?C=C.filter((g=>g!==I)):C.push(I),C.sort(((g,I)=>l.sizes[0].size.indexOf(g)-l.sizes[0].size.indexOf(I))),t((g=>({...g,size:C})))};const S=(0,Qg.useReactToPrint)({content:()=>I.current});return(0,mg.jsxs)("div",{className:"bg-white p-6 shadow-md rounded-md",children:[(0,mg.jsx)("h2",{className:"text-2xl font-semibold mb-6",children:"Purchase"}),b&&(B?(0,mg.jsx)(mg.Fragment,{children:(0,mg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999},children:(0,mg.jsxs)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative w-full m-5",role:"alert",children:[(0,mg.jsx)("strong",{className:"font-bold",children:"Items added to inventory:"}),(0,mg.jsx)("div",{className:"flex justify-center m-4",children:(0,mg.jsx)("button",{onClick:p,className:"px-4 py-2 bg-indigo-500 text-white rounded-md focus:outline-none",children:B?"Show Code and Size":"Show QR Code"})}),(0,mg.jsx)("div",{className:"flex justify-center",children:(0,mg.jsxs)("div",{style:{width:"106mm"},ref:I,className:"flex flex-wrap",children:[m.length%2!==0&&m.push({code:"",brand:"",product:"",category:"",size:"",quantityBuy:0,quantitySold:0,mrp:100,secretCode:""}),m.map(((g,I)=>{return(0,mg.jsx)("div",{className:"flex items-center justify-evenly",children:(0,mg.jsxs)("div",{style:{width:"50mm",height:"25mm",padding:0,marginLeft:"1.3mm",marginRight:"1.3mm"},className:"flex justify-evenly bg-white",children:[(0,mg.jsxs)("div",{className:"p-2 pr-0",children:[(0,mg.jsx)(Eg,{value:g.code,size:60}),(0,mg.jsx)("p",{className:"text-black",children:g.code})]}),(0,mg.jsxs)("div",{className:"relative font-bold text-black pt-1",children:[(0,mg.jsx)("div",{className:"flex justify-center",children:(0,mg.jsx)("img",{src:"Images/Ganesha.jpg",alt:"project",width:"25mm"})}),(0,mg.jsxs)("div",{children:[(0,mg.jsxs)("p",{children:["MRP: ",(e=g.mrp,e-=100,100*Math.ceil(e/100)*2+100-4),"/-"]}),(0,mg.jsxs)("p",{children:["Size: ",g.size]}),(0,mg.jsx)("div",{children:(0,mg.jsx)("p",{className:"absolute right-1 bottom-1 text-sm font-normal",children:g.secretCode})})]})]})]})},I);var e}))]})}),(0,mg.jsx)("button",{onClick:S,disabled:!h,className:"w-full py-2 px-4 rounded focus:outline-none focus:shadow-outline-indigo active:bg-indigo-800 ".concat(h?"bg-indigo-500 text-white":"bg-gray-300 text-black opacity-50 cursor-not-allowed"),children:"Print"}),(0,mg.jsx)("span",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",children:(0,mg.jsxs)("svg",{className:"fill-current h-6 w-6 text-green-500 cursor-pointer",role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",onClick:()=>u(!1),children:[(0,mg.jsx)("title",{children:"Close"}),(0,mg.jsx)("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})]})})]})})}):(0,mg.jsx)(mg.Fragment,{children:(0,mg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999},children:(0,mg.jsxs)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative w-full m-5",role:"alert",children:[(0,mg.jsx)("strong",{className:"font-bold",children:"Items added to inventory:"}),(0,mg.jsx)("div",{className:"flex justify-center m-4",children:(0,mg.jsx)("button",{onClick:p,className:"px-4 py-2 bg-indigo-500 text-white rounded-md focus:outline-none",children:B?"Show Code and Size":"Show QR Code"})}),m.map(((g,I)=>(0,mg.jsxs)("div",{className:"flex items-center justify-evenly mb-2",children:[(0,mg.jsxs)("div",{className:"rounded-md p-2 mr-2",children:[(0,mg.jsx)("span",{className:"block sm:inline font-semibold",children:"Code:"}),(0,mg.jsx)("span",{className:"block sm:inline ml-1",children:g.code})]}),(0,mg.jsxs)("div",{className:"rounded-md p-2",children:[(0,mg.jsx)("span",{className:"block sm:inline font-semibold",children:"Size:"}),(0,mg.jsx)("span",{className:"block sm:inline ml-1",children:g.size})]})]},I))),(0,mg.jsx)("span",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",children:(0,mg.jsxs)("svg",{className:"fill-current h-6 w-6 text-green-500 cursor-pointer",role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",onClick:()=>u(!1),children:[(0,mg.jsx)("title",{children:"Close"}),(0,mg.jsx)("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})]})})]})})})),(0,mg.jsxs)("select",{name:"brand",value:e.brand,onChange:g=>{var I;const{name:e,value:C}=g.target;var n=l.products.filter((g=>g.brand===C));n=(null===(I=n[0])||void 0===I?void 0:I.products)||[],a(n),t((g=>({...g,[e]:C})))},className:"w-full p-2 border rounded-md",children:[(0,mg.jsx)("option",{value:"",disabled:!0,children:"Select Brand"}),l.products.map((g=>(0,mg.jsx)("option",{value:g.brand,children:g.brand},g._id)))]}),(0,mg.jsxs)("select",{name:"product",value:e.product,onChange:W,className:"w-full mt-4 p-2 border rounded-md",children:[(0,mg.jsx)("option",{value:"",disabled:!0,children:"Select Product"}),o.map((g=>(0,mg.jsx)("option",{value:g,children:g},g)))]}),(0,mg.jsxs)("select",{name:"category",value:e.category,onChange:W,className:"w-full mt-4 p-2 border rounded-md",children:[(0,mg.jsx)("option",{value:"",disabled:!0,children:"Select Category"}),l.categories.map((g=>g.category.map((g=>(0,mg.jsx)("option",{value:g,children:g},g)))))]}),(0,mg.jsxs)("div",{className:"mt-4",children:[(0,mg.jsx)("p",{className:"font-semibold mb-1",children:"Select Size:"}),(0,mg.jsx)("div",{className:"flex flex-wrap",children:l.sizes[0].size.map(((g,I)=>(0,mg.jsxs)("div",{className:"flex items-center mr-4 mb-2",children:[(0,mg.jsx)("input",{type:"checkbox",id:g,name:g,value:g,checked:e.size.includes(g),onChange:V,className:"mr-1"}),(0,mg.jsx)("label",{htmlFor:g,children:g})]},I)))})]}),(0,mg.jsx)("input",{type:"number",placeholder:"MRP",name:"mrp",value:e.mrp,onChange:W,className:"w-full mt-4 p-2 border rounded-md"}),(0,mg.jsx)("input",{type:"number",placeholder:"Quantity to Purchase",name:"quantityBuy",value:e.quantityBuy,onChange:W,className:"w-full mt-4 p-2 border rounded-md"}),d&&(0,mg.jsx)("div",{className:"text-green-500 text-sm mt-2",children:"Product added to inventory"}),(0,mg.jsx)("button",{onClick:async()=>{if(i){s(!0);try{const I=await fetch("/api/purchase",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)},body:JSON.stringify(e)});if(I.ok){t({brand:"",product:"",category:"",size:[],quantityBuy:1,mrp:""});const{items:g}=await I.json();Z(g),u(!0),r(!0),setTimeout((()=>{r(!1)}),3e3)}else 401===I.status?(window.localStorage.clear(),g("/login")):console.error("Failed to add product to inventory")}catch(I){console.error("Error:",I)}finally{s(!1)}}},disabled:!i||c,className:"w-full mt-6 py-2 px-4 rounded focus:outline-none ".concat(i?"bg-indigo-500 text-white":"bg-gray-500 text-gray-500 opacity-50 cursor-not-allowed"),children:c?"Adding...":"Add to Inventory"})]})},Lg=(0,C.createContext)(),Dg=()=>(0,C.useContext)(Lg),Tg=g=>{let{children:I}=g;const e=q(),[t,l]=(0,C.useState)("user");return(0,C.useEffect)((()=>{(async()=>{try{if(window.localStorage.getItem("userInfo")){const g=await fetch("/api/role",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(g.ok){const I=await g.json();l(I.role)}else console.error("Failed to fetch role"),window.localStorage.clear(),e("/login")}}catch(g){console.log(g)}})()}),[]),(0,mg.jsxs)(Lg.Provider,{value:[t,l],children:[" ",I]})},jg=()=>{const g=q(),[I]=Dg();(0,C.useEffect)((()=>{window.localStorage.getItem("userInfo")||g("/login")}),[g]);var e="admin"===I,t="dev"===I;return(0,mg.jsx)(mg.Fragment,{children:(0,mg.jsx)("div",{className:"bg-gray-800 text-white h-full fixed top-0 w-full p-4 transition-all duration-300 ease-in-out z-50",children:(0,mg.jsxs)("div",{children:[(0,mg.jsx)("h2",{className:"text-2xl font-bold mb-8",children:"Menu"}),(e||t)&&(0,mg.jsx)("a",{href:"/dashboard",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Dashboard"}),(e||t)&&(0,mg.jsx)("a",{href:"/inventory",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Inventory"}),(0,mg.jsx)("a",{href:"/sale",className:"text-green-500 block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Sale"}),(0,mg.jsx)("a",{href:"/add-expense",className:"text-red-500 block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Add Expense"}),(0,mg.jsx)("a",{href:"/purchase",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Purchase"}),(e||t)&&(0,mg.jsx)("a",{href:"/history",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"History"}),(e||t)&&(0,mg.jsx)("a",{href:"/sale-history",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Sale History / Return"}),(0,mg.jsx)("a",{href:"/expense-history",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Expense History"}),(0,mg.jsx)("a",{href:"/add-brand-product",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Add Brand and Product"}),(0,mg.jsx)("a",{href:"/add-size",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Add Size"}),(0,mg.jsx)("a",{href:"/add-category",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Add Category"}),(0,mg.jsx)("a",{href:"/print-tag",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Print Tags"}),(0,mg.jsx)("a",{href:"/login",className:"font-bold block py-2 px-4 text-red-500 rounded transition duration-300 hover:bg-gray-700",onClick:function(){window.localStorage.clear(),g("/login")},children:"Log Out"})]})})})};function Pg(g){return Pg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(g){return typeof g}:function(g){return g&&"function"==typeof Symbol&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},Pg(g)}function Og(g){var I=function(g,I){if("object"!=Pg(g)||!g)return g;var e=g[Symbol.toPrimitive];if(void 0!==e){var C=e.call(g,I||"default");if("object"!=Pg(C))return C;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===I?String:Number)(g)}(g,"string");return"symbol"==Pg(I)?I:String(I)}function _g(g,I,e){return(I=Og(I))in g?Object.defineProperty(g,I,{value:e,enumerable:!0,configurable:!0,writable:!0}):g[I]=e,g}function qg(g){return g+.5|0}const $g=(g,I,e)=>Math.max(Math.min(g,e),I);function gI(g){return $g(qg(2.55*g),0,255)}function II(g){return $g(qg(255*g),0,255)}function eI(g){return $g(qg(g/2.55)/100,0,1)}function CI(g){return $g(qg(100*g),0,100)}const tI={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},lI=[..."0123456789ABCDEF"],nI=g=>lI[15&g],oI=g=>lI[(240&g)>>4]+lI[15&g],aI=g=>(240&g)>>4===(15&g);function iI(g){var I=(g=>aI(g.r)&&aI(g.g)&&aI(g.b)&&aI(g.a))(g)?nI:oI;return g?"#"+I(g.r)+I(g.g)+I(g.b)+((g,I)=>g<255?I(g):"")(g.a,I):void 0}const AI=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function cI(g,I,e){const C=I*Math.min(e,1-e),t=function(I){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(I+g/30)%12;return e-C*Math.max(Math.min(t-3,9-t,1),-1)};return[t(0),t(8),t(4)]}function sI(g,I,e){const C=function(C){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(C+g/60)%6;return e-e*I*Math.max(Math.min(t,4-t,1),0)};return[C(5),C(3),C(1)]}function dI(g,I,e){const C=cI(g,1,.5);let t;for(I+e>1&&(t=1/(I+e),I*=t,e*=t),t=0;t<3;t++)C[t]*=1-I-e,C[t]+=I;return C}function rI(g){const I=g.r/255,e=g.g/255,C=g.b/255,t=Math.max(I,e,C),l=Math.min(I,e,C),n=(t+l)/2;let o,a,i;return t!==l&&(i=t-l,a=n>.5?i/(2-t-l):i/(t+l),o=function(g,I,e,C,t){return g===t?(I-e)/C+(I<e?6:0):I===t?(e-g)/C+2:(g-I)/C+4}(I,e,C,i,t),o=60*o+.5),[0|o,a||0,n]}function bI(g,I,e,C){return(Array.isArray(I)?g(I[0],I[1],I[2]):g(I,e,C)).map(II)}function uI(g,I,e){return bI(cI,g,I,e)}function mI(g){return(g%360+360)%360}function ZI(g){const I=AI.exec(g);let e,C=255;if(!I)return;I[5]!==e&&(C=I[6]?gI(+I[5]):II(+I[5]));const t=mI(+I[2]),l=+I[3]/100,n=+I[4]/100;return e="hwb"===I[1]?function(g,I,e){return bI(dI,g,I,e)}(t,l,n):"hsv"===I[1]?function(g,I,e){return bI(sI,g,I,e)}(t,l,n):uI(t,l,n),{r:e[0],g:e[1],b:e[2],a:C}}const hI={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},GI={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let BI;function yI(g){BI||(BI=function(){const g={},I=Object.keys(GI),e=Object.keys(hI);let C,t,l,n,o;for(C=0;C<I.length;C++){for(n=o=I[C],t=0;t<e.length;t++)l=e[t],o=o.replace(l,hI[l]);l=parseInt(GI[n],16),g[o]=[l>>16&255,l>>8&255,255&l]}return g}(),BI.transparent=[0,0,0,0]);const I=BI[g.toLowerCase()];return I&&{r:I[0],g:I[1],b:I[2],a:4===I.length?I[3]:255}}const pI=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;const WI=g=>g<=.0031308?12.92*g:1.055*Math.pow(g,1/2.4)-.055,VI=g=>g<=.04045?g/12.92:Math.pow((g+.055)/1.055,2.4);function SI(g,I,e){if(g){let C=rI(g);C[I]=Math.max(0,Math.min(C[I]+C[I]*e,0===I?360:1)),C=uI(C),g.r=C[0],g.g=C[1],g.b=C[2]}}function XI(g,I){return g?Object.assign(I||{},g):g}function RI(g){var I={r:0,g:0,b:0,a:255};return Array.isArray(g)?g.length>=3&&(I={r:g[0],g:g[1],b:g[2],a:255},g.length>3&&(I.a=II(g[3]))):(I=XI(g,{r:0,g:0,b:0,a:1})).a=II(I.a),I}function JI(g){return"r"===g.charAt(0)?function(g){const I=pI.exec(g);let e,C,t,l=255;if(I){if(I[7]!==e){const g=+I[7];l=I[8]?gI(g):$g(255*g,0,255)}return e=+I[1],C=+I[3],t=+I[5],e=255&(I[2]?gI(e):$g(e,0,255)),C=255&(I[4]?gI(C):$g(C,0,255)),t=255&(I[6]?gI(t):$g(t,0,255)),{r:e,g:C,b:t,a:l}}}(g):ZI(g)}class kI{constructor(g){if(g instanceof kI)return g;const I=typeof g;let e;"object"===I?e=RI(g):"string"===I&&(e=function(g){var I,e=g.length;return"#"===g[0]&&(4===e||5===e?I={r:255&17*tI[g[1]],g:255&17*tI[g[2]],b:255&17*tI[g[3]],a:5===e?17*tI[g[4]]:255}:7!==e&&9!==e||(I={r:tI[g[1]]<<4|tI[g[2]],g:tI[g[3]]<<4|tI[g[4]],b:tI[g[5]]<<4|tI[g[6]],a:9===e?tI[g[7]]<<4|tI[g[8]]:255})),I}(g)||yI(g)||JI(g)),this._rgb=e,this._valid=!!e}get valid(){return this._valid}get rgb(){var g=XI(this._rgb);return g&&(g.a=eI(g.a)),g}set rgb(g){this._rgb=RI(g)}rgbString(){return this._valid?(g=this._rgb)&&(g.a<255?"rgba(".concat(g.r,", ").concat(g.g,", ").concat(g.b,", ").concat(eI(g.a),")"):"rgb(".concat(g.r,", ").concat(g.g,", ").concat(g.b,")")):void 0;var g}hexString(){return this._valid?iI(this._rgb):void 0}hslString(){return this._valid?function(g){if(!g)return;const I=rI(g),e=I[0],C=CI(I[1]),t=CI(I[2]);return g.a<255?"hsla(".concat(e,", ").concat(C,"%, ").concat(t,"%, ").concat(eI(g.a),")"):"hsl(".concat(e,", ").concat(C,"%, ").concat(t,"%)")}(this._rgb):void 0}mix(g,I){if(g){const e=this.rgb,C=g.rgb;let t;const l=I===t?.5:I,n=2*l-1,o=e.a-C.a,a=((n*o===-1?n:(n+o)/(1+n*o))+1)/2;t=1-a,e.r=255&a*e.r+t*C.r+.5,e.g=255&a*e.g+t*C.g+.5,e.b=255&a*e.b+t*C.b+.5,e.a=l*e.a+(1-l)*C.a,this.rgb=e}return this}interpolate(g,I){return g&&(this._rgb=function(g,I,e){const C=VI(eI(g.r)),t=VI(eI(g.g)),l=VI(eI(g.b));return{r:II(WI(C+e*(VI(eI(I.r))-C))),g:II(WI(t+e*(VI(eI(I.g))-t))),b:II(WI(l+e*(VI(eI(I.b))-l))),a:g.a+e*(I.a-g.a)}}(this._rgb,g._rgb,I)),this}clone(){return new kI(this.rgb)}alpha(g){return this._rgb.a=II(g),this}clearer(g){return this._rgb.a*=1-g,this}greyscale(){const g=this._rgb,I=qg(.3*g.r+.59*g.g+.11*g.b);return g.r=g.g=g.b=I,this}opaquer(g){return this._rgb.a*=1+g,this}negate(){const g=this._rgb;return g.r=255-g.r,g.g=255-g.g,g.b=255-g.b,this}lighten(g){return SI(this._rgb,2,g),this}darken(g){return SI(this._rgb,2,-g),this}saturate(g){return SI(this._rgb,1,g),this}desaturate(g){return SI(this._rgb,1,-g),this}rotate(g){return function(g,I){var e=rI(g);e[0]=mI(e[0]+I),e=uI(e),g.r=e[0],g.g=e[1],g.b=e[2]}(this._rgb,g),this}}function YI(){}const fI=(()=>{let g=0;return()=>g++})();function vI(g){return null===g||"undefined"===typeof g}function HI(g){if(Array.isArray&&Array.isArray(g))return!0;const I=Object.prototype.toString.call(g);return"[object"===I.slice(0,7)&&"Array]"===I.slice(-6)}function wI(g){return null!==g&&"[object Object]"===Object.prototype.toString.call(g)}function NI(g){return("number"===typeof g||g instanceof Number)&&isFinite(+g)}function KI(g,I){return NI(g)?g:I}function FI(g,I){return"undefined"===typeof g?I:g}const xI=(g,I)=>"string"===typeof g&&g.endsWith("%")?parseFloat(g)/100*I:+g;function zI(g,I,e){if(g&&"function"===typeof g.call)return g.apply(e,I)}function MI(g,I,e,C){let t,l,n;if(HI(g))if(l=g.length,C)for(t=l-1;t>=0;t--)I.call(e,g[t],t);else for(t=0;t<l;t++)I.call(e,g[t],t);else if(wI(g))for(n=Object.keys(g),l=n.length,t=0;t<l;t++)I.call(e,g[n[t]],n[t])}function EI(g,I){let e,C,t,l;if(!g||!I||g.length!==I.length)return!1;for(e=0,C=g.length;e<C;++e)if(t=g[e],l=I[e],t.datasetIndex!==l.datasetIndex||t.index!==l.index)return!1;return!0}function QI(g){if(HI(g))return g.map(QI);if(wI(g)){const I=Object.create(null),e=Object.keys(g),C=e.length;let t=0;for(;t<C;++t)I[e[t]]=QI(g[e[t]]);return I}return g}function UI(g){return-1===["__proto__","prototype","constructor"].indexOf(g)}function LI(g,I,e,C){if(!UI(g))return;const t=I[g],l=e[g];wI(t)&&wI(l)?DI(t,l,C):I[g]=QI(l)}function DI(g,I,e){const C=HI(I)?I:[I],t=C.length;if(!wI(g))return g;const l=(e=e||{}).merger||LI;let n;for(let o=0;o<t;++o){if(n=C[o],!wI(n))continue;const I=Object.keys(n);for(let C=0,t=I.length;C<t;++C)l(I[C],g,n,e)}return g}function TI(g,I){return DI(g,I,{merger:jI})}function jI(g,I,e){if(!UI(g))return;const C=I[g],t=e[g];wI(C)&&wI(t)?TI(C,t):Object.prototype.hasOwnProperty.call(I,g)||(I[g]=QI(t))}const PI={"":g=>g,x:g=>g.x,y:g=>g.y};function OI(g,I){const e=PI[I]||(PI[I]=function(g){const I=function(g){const I=g.split("."),e=[];let C="";for(const t of I)C+=t,C.endsWith("\\")?C=C.slice(0,-1)+".":(e.push(C),C="");return e}(g);return g=>{for(const e of I){if(""===e)break;g=g&&g[e]}return g}}(I));return e(g)}function _I(g){return g.charAt(0).toUpperCase()+g.slice(1)}const qI=g=>"undefined"!==typeof g,$I=g=>"function"===typeof g,ge=(g,I)=>{if(g.size!==I.size)return!1;for(const e of g)if(!I.has(e))return!1;return!0};const Ie=Math.PI,ee=2*Ie,Ce=ee+Ie,te=Number.POSITIVE_INFINITY,le=Ie/180,ne=Ie/2,oe=Ie/4,ae=2*Ie/3,ie=Math.log10,Ae=Math.sign;function ce(g,I,e){return Math.abs(g-I)<e}function se(g){const I=Math.round(g);g=ce(g,I,g/1e3)?I:g;const e=Math.pow(10,Math.floor(ie(g))),C=g/e;return(C<=1?1:C<=2?2:C<=5?5:10)*e}function de(g){return!isNaN(parseFloat(g))&&isFinite(g)}function re(g,I,e){let C,t,l;for(C=0,t=g.length;C<t;C++)l=g[C][e],isNaN(l)||(I.min=Math.min(I.min,l),I.max=Math.max(I.max,l))}function be(g){return g*(Ie/180)}function ue(g){return g*(180/Ie)}function me(g){if(!NI(g))return;let I=1,e=0;for(;Math.round(g*I)/I!==g;)I*=10,e++;return e}function Ze(g,I){const e=I.x-g.x,C=I.y-g.y,t=Math.sqrt(e*e+C*C);let l=Math.atan2(C,e);return l<-.5*Ie&&(l+=ee),{angle:l,distance:t}}function he(g,I){return Math.sqrt(Math.pow(I.x-g.x,2)+Math.pow(I.y-g.y,2))}function Ge(g,I){return(g-I+Ce)%ee-Ie}function Be(g){return(g%ee+ee)%ee}function ye(g,I,e,C){const t=Be(g),l=Be(I),n=Be(e),o=Be(l-t),a=Be(n-t),i=Be(t-l),A=Be(t-n);return t===l||t===n||C&&l===n||o>a&&i<A}function pe(g,I,e){return Math.max(I,Math.min(e,g))}function We(g,I,e){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-6;return g>=Math.min(I,e)-C&&g<=Math.max(I,e)+C}function Ve(g,I,e){e=e||(e=>g[e]<I);let C,t=g.length-1,l=0;for(;t-l>1;)C=l+t>>1,e(C)?l=C:t=C;return{lo:l,hi:t}}const Se=(g,I,e,C)=>Ve(g,e,C?C=>{const t=g[C][I];return t<e||t===e&&g[C+1][I]===e}:C=>g[C][I]<e),Xe=(g,I,e)=>Ve(g,e,(C=>g[C][I]>=e));const Re=["push","pop","shift","splice","unshift"];function Je(g,I){const e=g._chartjs;if(!e)return;const C=e.listeners,t=C.indexOf(I);-1!==t&&C.splice(t,1),C.length>0||(Re.forEach((I=>{delete g[I]})),delete g._chartjs)}function ke(g){const I=new Set(g);return I.size===g.length?g:Array.from(I)}const Ye="undefined"===typeof window?function(g){return g()}:window.requestAnimationFrame;function fe(g,I){let e=[],C=!1;return function(){for(var t=arguments.length,l=new Array(t),n=0;n<t;n++)l[n]=arguments[n];e=l,C||(C=!0,Ye.call(window,(()=>{C=!1,g.apply(I,e)})))}}const ve=g=>"start"===g?"left":"end"===g?"right":"center",He=(g,I,e)=>"start"===g?I:"end"===g?e:(I+e)/2;function we(g,I,e){const C=I.length;let t=0,l=C;if(g._sorted){const{iScale:n,_parsed:o}=g,a=n.axis,{min:i,max:A,minDefined:c,maxDefined:s}=n.getUserBounds();c&&(t=pe(Math.min(Se(o,a,i).lo,e?C:Se(I,a,n.getPixelForValue(i)).lo),0,C-1)),l=s?pe(Math.max(Se(o,n.axis,A,!0).hi+1,e?0:Se(I,a,n.getPixelForValue(A),!0).hi+1),t,C)-t:C-t}return{start:t,count:l}}function Ne(g){const{xScale:I,yScale:e,_scaleRanges:C}=g,t={xmin:I.min,xmax:I.max,ymin:e.min,ymax:e.max};if(!C)return g._scaleRanges=t,!0;const l=C.xmin!==I.min||C.xmax!==I.max||C.ymin!==e.min||C.ymax!==e.max;return Object.assign(C,t),l}const Ke=g=>0===g||1===g,Fe=(g,I,e)=>-Math.pow(2,10*(g-=1))*Math.sin((g-I)*ee/e),xe=(g,I,e)=>Math.pow(2,-10*g)*Math.sin((g-I)*ee/e)+1,ze={linear:g=>g,easeInQuad:g=>g*g,easeOutQuad:g=>-g*(g-2),easeInOutQuad:g=>(g/=.5)<1?.5*g*g:-.5*(--g*(g-2)-1),easeInCubic:g=>g*g*g,easeOutCubic:g=>(g-=1)*g*g+1,easeInOutCubic:g=>(g/=.5)<1?.5*g*g*g:.5*((g-=2)*g*g+2),easeInQuart:g=>g*g*g*g,easeOutQuart:g=>-((g-=1)*g*g*g-1),easeInOutQuart:g=>(g/=.5)<1?.5*g*g*g*g:-.5*((g-=2)*g*g*g-2),easeInQuint:g=>g*g*g*g*g,easeOutQuint:g=>(g-=1)*g*g*g*g+1,easeInOutQuint:g=>(g/=.5)<1?.5*g*g*g*g*g:.5*((g-=2)*g*g*g*g+2),easeInSine:g=>1-Math.cos(g*ne),easeOutSine:g=>Math.sin(g*ne),easeInOutSine:g=>-.5*(Math.cos(Ie*g)-1),easeInExpo:g=>0===g?0:Math.pow(2,10*(g-1)),easeOutExpo:g=>1===g?1:1-Math.pow(2,-10*g),easeInOutExpo:g=>Ke(g)?g:g<.5?.5*Math.pow(2,10*(2*g-1)):.5*(2-Math.pow(2,-10*(2*g-1))),easeInCirc:g=>g>=1?g:-(Math.sqrt(1-g*g)-1),easeOutCirc:g=>Math.sqrt(1-(g-=1)*g),easeInOutCirc:g=>(g/=.5)<1?-.5*(Math.sqrt(1-g*g)-1):.5*(Math.sqrt(1-(g-=2)*g)+1),easeInElastic:g=>Ke(g)?g:Fe(g,.075,.3),easeOutElastic:g=>Ke(g)?g:xe(g,.075,.3),easeInOutElastic(g){const I=.1125;return Ke(g)?g:g<.5?.5*Fe(2*g,I,.45):.5+.5*xe(2*g-1,I,.45)},easeInBack(g){const I=1.70158;return g*g*((I+1)*g-I)},easeOutBack(g){const I=1.70158;return(g-=1)*g*((I+1)*g+I)+1},easeInOutBack(g){let I=1.70158;return(g/=.5)<1?g*g*((1+(I*=1.525))*g-I)*.5:.5*((g-=2)*g*((1+(I*=1.525))*g+I)+2)},easeInBounce:g=>1-ze.easeOutBounce(1-g),easeOutBounce(g){const I=7.5625,e=2.75;return g<1/e?I*g*g:g<2/e?I*(g-=1.5/e)*g+.75:g<2.5/e?I*(g-=2.25/e)*g+.9375:I*(g-=2.625/e)*g+.984375},easeInOutBounce:g=>g<.5?.5*ze.easeInBounce(2*g):.5*ze.easeOutBounce(2*g-1)+.5};function Me(g){if(g&&"object"===typeof g){const I=g.toString();return"[object CanvasPattern]"===I||"[object CanvasGradient]"===I}return!1}function Ee(g){return Me(g)?g:new kI(g)}function Qe(g){return Me(g)?g:new kI(g).saturate(.5).darken(.1).hexString()}const Ue=["x","y","borderWidth","radius","tension"],Le=["color","borderColor","backgroundColor"];const De=new Map;function Te(g,I,e){return function(g,I){I=I||{};const e=g+JSON.stringify(I);let C=De.get(e);return C||(C=new Intl.NumberFormat(g,I),De.set(e,C)),C}(I,e).format(g)}const je={values:g=>HI(g)?g:""+g,numeric(g,I,e){if(0===g)return"0";const C=this.chart.options.locale;let t,l=g;if(e.length>1){const I=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(I<1e-4||I>1e15)&&(t="scientific"),l=function(g,I){let e=I.length>3?I[2].value-I[1].value:I[1].value-I[0].value;Math.abs(e)>=1&&g!==Math.floor(g)&&(e=g-Math.floor(g));return e}(g,e)}const n=ie(Math.abs(l)),o=isNaN(n)?1:Math.max(Math.min(-1*Math.floor(n),20),0),a={notation:t,minimumFractionDigits:o,maximumFractionDigits:o};return Object.assign(a,this.options.ticks.format),Te(g,C,a)},logarithmic(g,I,e){if(0===g)return"0";const C=e[I].significand||g/Math.pow(10,Math.floor(ie(g)));return[1,2,3,5,10,15].includes(C)||I>.8*e.length?je.numeric.call(this,g,I,e):""}};var Pe={formatters:je};const Oe=Object.create(null),_e=Object.create(null);function qe(g,I){if(!I)return g;const e=I.split(".");for(let C=0,t=e.length;C<t;++C){const I=e[C];g=g[I]||(g[I]=Object.create(null))}return g}function $e(g,I,e){return"string"===typeof I?DI(qe(g,I),e):DI(qe(g,""),I)}class gC{constructor(g,I){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=g=>g.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(g,I)=>Qe(I.backgroundColor),this.hoverBorderColor=(g,I)=>Qe(I.borderColor),this.hoverColor=(g,I)=>Qe(I.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(g),this.apply(I)}set(g,I){return $e(this,g,I)}get(g){return qe(this,g)}describe(g,I){return $e(_e,g,I)}override(g,I){return $e(Oe,g,I)}route(g,I,e,C){const t=qe(this,g),l=qe(this,e),n="_"+I;Object.defineProperties(t,{[n]:{value:t[I],writable:!0},[I]:{enumerable:!0,get(){const g=this[n],I=l[C];return wI(g)?Object.assign({},I,g):FI(g,I)},set(g){this[n]=g}}})}apply(g){g.forEach((g=>g(this)))}}var IC=new gC({_scriptable:g=>!g.startsWith("on"),_indexable:g=>"events"!==g,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[function(g){g.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),g.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:g=>"onProgress"!==g&&"onComplete"!==g&&"fn"!==g}),g.set("animations",{colors:{type:"color",properties:Le},numbers:{type:"number",properties:Ue}}),g.describe("animations",{_fallback:"animation"}),g.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:g=>0|g}}}})},function(g){g.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})},function(g){g.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(g,I)=>I.lineWidth,tickColor:(g,I)=>I.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Pe.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),g.route("scale.ticks","color","","color"),g.route("scale.grid","color","","borderColor"),g.route("scale.border","color","","borderColor"),g.route("scale.title","color","","color"),g.describe("scale",{_fallback:!1,_scriptable:g=>!g.startsWith("before")&&!g.startsWith("after")&&"callback"!==g&&"parser"!==g,_indexable:g=>"borderDash"!==g&&"tickBorderDash"!==g&&"dash"!==g}),g.describe("scales",{_fallback:"scale"}),g.describe("scale.ticks",{_scriptable:g=>"backdropPadding"!==g&&"callback"!==g,_indexable:g=>"backdropPadding"!==g})}]);function eC(g,I,e,C,t){let l=I[t];return l||(l=I[t]=g.measureText(t).width,e.push(t)),l>C&&(C=l),C}function CC(g,I,e,C){let t=(C=C||{}).data=C.data||{},l=C.garbageCollect=C.garbageCollect||[];C.font!==I&&(t=C.data={},l=C.garbageCollect=[],C.font=I),g.save(),g.font=I;let n=0;const o=e.length;let a,i,A,c,s;for(a=0;a<o;a++)if(c=e[a],void 0===c||null===c||HI(c)){if(HI(c))for(i=0,A=c.length;i<A;i++)s=c[i],void 0===s||null===s||HI(s)||(n=eC(g,t,l,n,s))}else n=eC(g,t,l,n,c);g.restore();const d=l.length/2;if(d>e.length){for(a=0;a<d;a++)delete t[l[a]];l.splice(0,d)}return n}function tC(g,I,e){const C=g.currentDevicePixelRatio,t=0!==e?Math.max(e/2,.5):0;return Math.round((I-t)*C)/C+t}function lC(g,I){(I=I||g.getContext("2d")).save(),I.resetTransform(),I.clearRect(0,0,g.width,g.height),I.restore()}function nC(g,I,e,C){oC(g,I,e,C,null)}function oC(g,I,e,C,t){let l,n,o,a,i,A,c,s;const d=I.pointStyle,r=I.rotation,b=I.radius;let u=(r||0)*le;if(d&&"object"===typeof d&&(l=d.toString(),"[object HTMLImageElement]"===l||"[object HTMLCanvasElement]"===l))return g.save(),g.translate(e,C),g.rotate(u),g.drawImage(d,-d.width/2,-d.height/2,d.width,d.height),void g.restore();if(!(isNaN(b)||b<=0)){switch(g.beginPath(),d){default:t?g.ellipse(e,C,t/2,b,0,0,ee):g.arc(e,C,b,0,ee),g.closePath();break;case"triangle":A=t?t/2:b,g.moveTo(e+Math.sin(u)*A,C-Math.cos(u)*b),u+=ae,g.lineTo(e+Math.sin(u)*A,C-Math.cos(u)*b),u+=ae,g.lineTo(e+Math.sin(u)*A,C-Math.cos(u)*b),g.closePath();break;case"rectRounded":i=.516*b,a=b-i,n=Math.cos(u+oe)*a,c=Math.cos(u+oe)*(t?t/2-i:a),o=Math.sin(u+oe)*a,s=Math.sin(u+oe)*(t?t/2-i:a),g.arc(e-c,C-o,i,u-Ie,u-ne),g.arc(e+s,C-n,i,u-ne,u),g.arc(e+c,C+o,i,u,u+ne),g.arc(e-s,C+n,i,u+ne,u+Ie),g.closePath();break;case"rect":if(!r){a=Math.SQRT1_2*b,A=t?t/2:a,g.rect(e-A,C-a,2*A,2*a);break}u+=oe;case"rectRot":c=Math.cos(u)*(t?t/2:b),n=Math.cos(u)*b,o=Math.sin(u)*b,s=Math.sin(u)*(t?t/2:b),g.moveTo(e-c,C-o),g.lineTo(e+s,C-n),g.lineTo(e+c,C+o),g.lineTo(e-s,C+n),g.closePath();break;case"crossRot":u+=oe;case"cross":c=Math.cos(u)*(t?t/2:b),n=Math.cos(u)*b,o=Math.sin(u)*b,s=Math.sin(u)*(t?t/2:b),g.moveTo(e-c,C-o),g.lineTo(e+c,C+o),g.moveTo(e+s,C-n),g.lineTo(e-s,C+n);break;case"star":c=Math.cos(u)*(t?t/2:b),n=Math.cos(u)*b,o=Math.sin(u)*b,s=Math.sin(u)*(t?t/2:b),g.moveTo(e-c,C-o),g.lineTo(e+c,C+o),g.moveTo(e+s,C-n),g.lineTo(e-s,C+n),u+=oe,c=Math.cos(u)*(t?t/2:b),n=Math.cos(u)*b,o=Math.sin(u)*b,s=Math.sin(u)*(t?t/2:b),g.moveTo(e-c,C-o),g.lineTo(e+c,C+o),g.moveTo(e+s,C-n),g.lineTo(e-s,C+n);break;case"line":n=t?t/2:Math.cos(u)*b,o=Math.sin(u)*b,g.moveTo(e-n,C-o),g.lineTo(e+n,C+o);break;case"dash":g.moveTo(e,C),g.lineTo(e+Math.cos(u)*(t?t/2:b),C+Math.sin(u)*b);break;case!1:g.closePath()}g.fill(),I.borderWidth>0&&g.stroke()}}function aC(g,I,e){return e=e||.5,!I||g&&g.x>I.left-e&&g.x<I.right+e&&g.y>I.top-e&&g.y<I.bottom+e}function iC(g,I){g.save(),g.beginPath(),g.rect(I.left,I.top,I.right-I.left,I.bottom-I.top),g.clip()}function AC(g){g.restore()}function cC(g,I,e,C,t){if(!I)return g.lineTo(e.x,e.y);if("middle"===t){const C=(I.x+e.x)/2;g.lineTo(C,I.y),g.lineTo(C,e.y)}else"after"===t!==!!C?g.lineTo(I.x,e.y):g.lineTo(e.x,I.y);g.lineTo(e.x,e.y)}function sC(g,I,e,C){if(!I)return g.lineTo(e.x,e.y);g.bezierCurveTo(C?I.cp1x:I.cp2x,C?I.cp1y:I.cp2y,C?e.cp2x:e.cp1x,C?e.cp2y:e.cp1y,e.x,e.y)}function dC(g,I,e,C,t){if(t.strikethrough||t.underline){const l=g.measureText(C),n=I-l.actualBoundingBoxLeft,o=I+l.actualBoundingBoxRight,a=e-l.actualBoundingBoxAscent,i=e+l.actualBoundingBoxDescent,A=t.strikethrough?(a+i)/2:i;g.strokeStyle=g.fillStyle,g.beginPath(),g.lineWidth=t.decorationWidth||2,g.moveTo(n,A),g.lineTo(o,A),g.stroke()}}function rC(g,I){const e=g.fillStyle;g.fillStyle=I.color,g.fillRect(I.left,I.top,I.width,I.height),g.fillStyle=e}function bC(g,I,e,C,t){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const n=HI(I)?I:[I],o=l.strokeWidth>0&&""!==l.strokeColor;let a,i;for(g.save(),g.font=t.string,function(g,I){I.translation&&g.translate(I.translation[0],I.translation[1]),vI(I.rotation)||g.rotate(I.rotation),I.color&&(g.fillStyle=I.color),I.textAlign&&(g.textAlign=I.textAlign),I.textBaseline&&(g.textBaseline=I.textBaseline)}(g,l),a=0;a<n.length;++a)i=n[a],l.backdrop&&rC(g,l.backdrop),o&&(l.strokeColor&&(g.strokeStyle=l.strokeColor),vI(l.strokeWidth)||(g.lineWidth=l.strokeWidth),g.strokeText(i,e,C,l.maxWidth)),g.fillText(i,e,C,l.maxWidth),dC(g,e,C,i,l),C+=Number(t.lineHeight);g.restore()}function uC(g,I){const{x:e,y:C,w:t,h:l,radius:n}=I;g.arc(e+n.topLeft,C+n.topLeft,n.topLeft,1.5*Ie,Ie,!0),g.lineTo(e,C+l-n.bottomLeft),g.arc(e+n.bottomLeft,C+l-n.bottomLeft,n.bottomLeft,Ie,ne,!0),g.lineTo(e+t-n.bottomRight,C+l),g.arc(e+t-n.bottomRight,C+l-n.bottomRight,n.bottomRight,ne,0,!0),g.lineTo(e+t,C+n.topRight),g.arc(e+t-n.topRight,C+n.topRight,n.topRight,0,-ne,!0),g.lineTo(e+n.topLeft,C)}const mC=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,ZC=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function hC(g,I){const e=(""+g).match(mC);if(!e||"normal"===e[1])return 1.2*I;switch(g=+e[2],e[3]){case"px":return g;case"%":g/=100}return I*g}const GC=g=>+g||0;function BC(g,I){const e={},C=wI(I),t=C?Object.keys(I):I,l=wI(g)?C?e=>FI(g[e],g[I[e]]):I=>g[I]:()=>g;for(const n of t)e[n]=GC(l(n));return e}function yC(g){return BC(g,{top:"y",right:"x",bottom:"y",left:"x"})}function pC(g){return BC(g,["topLeft","topRight","bottomLeft","bottomRight"])}function WC(g){const I=yC(g);return I.width=I.left+I.right,I.height=I.top+I.bottom,I}function VC(g,I){g=g||{},I=I||IC.font;let e=FI(g.size,I.size);"string"===typeof e&&(e=parseInt(e,10));let C=FI(g.style,I.style);C&&!(""+C).match(ZC)&&(console.warn('Invalid font style specified: "'+C+'"'),C=void 0);const t={family:FI(g.family,I.family),lineHeight:hC(FI(g.lineHeight,I.lineHeight),e),size:e,style:C,weight:FI(g.weight,I.weight),string:""};return t.string=function(g){return!g||vI(g.size)||vI(g.family)?null:(g.style?g.style+" ":"")+(g.weight?g.weight+" ":"")+g.size+"px "+g.family}(t),t}function SC(g,I,e,C){let t,l,n,o=!0;for(t=0,l=g.length;t<l;++t)if(n=g[t],void 0!==n&&(void 0!==I&&"function"===typeof n&&(n=n(I),o=!1),void 0!==e&&HI(n)&&(n=n[e%n.length],o=!1),void 0!==n))return C&&!o&&(C.cacheable=!1),n}function XC(g,I){return Object.assign(Object.create(g),I)}function RC(g){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[""],e=arguments.length>3?arguments[3]:void 0,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>g[0];const t=(arguments.length>2?arguments[2]:void 0)||g;"undefined"===typeof e&&(e=xC("_fallback",g));const l={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:g,_rootScopes:t,_fallback:e,_getTarget:C,override:C=>RC([C,...g],I,t,e)};return new Proxy(l,{deleteProperty:(I,e)=>(delete I[e],delete I._keys,delete g[0][e],!0),get:(e,C)=>vC(e,C,(()=>function(g,I,e,C){let t;for(const l of I)if(t=xC(YC(l,g),e),"undefined"!==typeof t)return fC(g,t)?KC(e,C,g,t):t}(C,I,g,e))),getOwnPropertyDescriptor:(g,I)=>Reflect.getOwnPropertyDescriptor(g._scopes[0],I),getPrototypeOf:()=>Reflect.getPrototypeOf(g[0]),has:(g,I)=>zC(g).includes(I),ownKeys:g=>zC(g),set(g,I,e){const t=g._storage||(g._storage=C());return g[I]=t[I]=e,delete g._keys,!0}})}function JC(g,I,e,C){const t={_cacheable:!1,_proxy:g,_context:I,_subProxy:e,_stack:new Set,_descriptors:kC(g,C),setContext:I=>JC(g,I,e,C),override:t=>JC(g.override(t),I,e,C)};return new Proxy(t,{deleteProperty:(I,e)=>(delete I[e],delete g[e],!0),get:(g,I,e)=>vC(g,I,(()=>function(g,I,e){const{_proxy:C,_context:t,_subProxy:l,_descriptors:n}=g;let o=C[I];$I(o)&&n.isScriptable(I)&&(o=function(g,I,e,C){const{_proxy:t,_context:l,_subProxy:n,_stack:o}=e;if(o.has(g))throw new Error("Recursion detected: "+Array.from(o).join("->")+"->"+g);o.add(g);let a=I(l,n||C);o.delete(g),fC(g,a)&&(a=KC(t._scopes,t,g,a));return a}(I,o,g,e));HI(o)&&o.length&&(o=function(g,I,e,C){const{_proxy:t,_context:l,_subProxy:n,_descriptors:o}=e;if("undefined"!==typeof l.index&&C(g))return I[l.index%I.length];if(wI(I[0])){const e=I,C=t._scopes.filter((g=>g!==e));I=[];for(const a of e){const e=KC(C,t,g,a);I.push(JC(e,l,n&&n[g],o))}}return I}(I,o,g,n.isIndexable));fC(I,o)&&(o=JC(o,t,l&&l[I],n));return o}(g,I,e))),getOwnPropertyDescriptor:(I,e)=>I._descriptors.allKeys?Reflect.has(g,e)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(g,e),getPrototypeOf:()=>Reflect.getPrototypeOf(g),has:(I,e)=>Reflect.has(g,e),ownKeys:()=>Reflect.ownKeys(g),set:(I,e,C)=>(g[e]=C,delete I[e],!0)})}function kC(g){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{scriptable:!0,indexable:!0};const{_scriptable:e=I.scriptable,_indexable:C=I.indexable,_allKeys:t=I.allKeys}=g;return{allKeys:t,scriptable:e,indexable:C,isScriptable:$I(e)?e:()=>e,isIndexable:$I(C)?C:()=>C}}const YC=(g,I)=>g?g+_I(I):I,fC=(g,I)=>wI(I)&&"adapters"!==g&&(null===Object.getPrototypeOf(I)||I.constructor===Object);function vC(g,I,e){if(Object.prototype.hasOwnProperty.call(g,I))return g[I];const C=e();return g[I]=C,C}function HC(g,I,e){return $I(g)?g(I,e):g}const wC=(g,I)=>!0===g?I:"string"===typeof g?OI(I,g):void 0;function NC(g,I,e,C,t){for(const l of I){const I=wC(e,l);if(I){g.add(I);const l=HC(I._fallback,e,t);if("undefined"!==typeof l&&l!==e&&l!==C)return l}else if(!1===I&&"undefined"!==typeof C&&e!==C)return null}return!1}function KC(g,I,e,C){const t=I._rootScopes,l=HC(I._fallback,e,C),n=[...g,...t],o=new Set;o.add(C);let a=FC(o,n,e,l||e,C);return null!==a&&(("undefined"===typeof l||l===e||(a=FC(o,n,l,a,C),null!==a))&&RC(Array.from(o),[""],t,l,(()=>function(g,I,e){const C=g._getTarget();I in C||(C[I]={});const t=C[I];if(HI(t)&&wI(e))return e;return t||{}}(I,e,C))))}function FC(g,I,e,C,t){for(;e;)e=NC(g,I,e,C,t);return e}function xC(g,I){for(const e of I){if(!e)continue;const I=e[g];if("undefined"!==typeof I)return I}}function zC(g){let I=g._keys;return I||(I=g._keys=function(g){const I=new Set;for(const e of g)for(const g of Object.keys(e).filter((g=>!g.startsWith("_"))))I.add(g);return Array.from(I)}(g._scopes)),I}function MC(g,I,e,C){const{iScale:t}=g,{key:l="r"}=this._parsing,n=new Array(C);let o,a,i,A;for(o=0,a=C;o<a;++o)i=o+e,A=I[i],n[o]={r:t.parse(OI(A,l),i)};return n}const EC=Number.EPSILON||1e-14,QC=(g,I)=>I<g.length&&!g[I].skip&&g[I],UC=g=>"x"===g?"y":"x";function LC(g,I,e,C){const t=g.skip?I:g,l=I,n=e.skip?I:e,o=he(l,t),a=he(n,l);let i=o/(o+a),A=a/(o+a);i=isNaN(i)?0:i,A=isNaN(A)?0:A;const c=C*i,s=C*A;return{previous:{x:l.x-c*(n.x-t.x),y:l.y-c*(n.y-t.y)},next:{x:l.x+s*(n.x-t.x),y:l.y+s*(n.y-t.y)}}}function DC(g){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"x";const e=UC(I),C=g.length,t=Array(C).fill(0),l=Array(C);let n,o,a,i=QC(g,0);for(n=0;n<C;++n)if(o=a,a=i,i=QC(g,n+1),a){if(i){const g=i[I]-a[I];t[n]=0!==g?(i[e]-a[e])/g:0}l[n]=o?i?Ae(t[n-1])!==Ae(t[n])?0:(t[n-1]+t[n])/2:t[n-1]:t[n]}!function(g,I,e){const C=g.length;let t,l,n,o,a,i=QC(g,0);for(let A=0;A<C-1;++A)a=i,i=QC(g,A+1),a&&i&&(ce(I[A],0,EC)?e[A]=e[A+1]=0:(t=e[A]/I[A],l=e[A+1]/I[A],o=Math.pow(t,2)+Math.pow(l,2),o<=9||(n=3/Math.sqrt(o),e[A]=t*n*I[A],e[A+1]=l*n*I[A])))}(g,t,l),function(g,I){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"x";const C=UC(e),t=g.length;let l,n,o,a=QC(g,0);for(let i=0;i<t;++i){if(n=o,o=a,a=QC(g,i+1),!o)continue;const t=o[e],A=o[C];n&&(l=(t-n[e])/3,o["cp1".concat(e)]=t-l,o["cp1".concat(C)]=A-l*I[i]),a&&(l=(a[e]-t)/3,o["cp2".concat(e)]=t+l,o["cp2".concat(C)]=A+l*I[i])}}(g,l,I)}function TC(g,I,e){return Math.max(Math.min(g,e),I)}function jC(g,I,e,C,t){let l,n,o,a;if(I.spanGaps&&(g=g.filter((g=>!g.skip))),"monotone"===I.cubicInterpolationMode)DC(g,t);else{let e=C?g[g.length-1]:g[0];for(l=0,n=g.length;l<n;++l)o=g[l],a=LC(e,o,g[Math.min(l+1,n-(C?0:1))%n],I.tension),o.cp1x=a.previous.x,o.cp1y=a.previous.y,o.cp2x=a.next.x,o.cp2y=a.next.y,e=o}I.capBezierPoints&&function(g,I){let e,C,t,l,n,o=aC(g[0],I);for(e=0,C=g.length;e<C;++e)n=l,l=o,o=e<C-1&&aC(g[e+1],I),l&&(t=g[e],n&&(t.cp1x=TC(t.cp1x,I.left,I.right),t.cp1y=TC(t.cp1y,I.top,I.bottom)),o&&(t.cp2x=TC(t.cp2x,I.left,I.right),t.cp2y=TC(t.cp2y,I.top,I.bottom)))}(g,e)}function PC(){return"undefined"!==typeof window&&"undefined"!==typeof document}function OC(g){let I=g.parentNode;return I&&"[object ShadowRoot]"===I.toString()&&(I=I.host),I}function _C(g,I,e){let C;return"string"===typeof g?(C=parseInt(g,10),-1!==g.indexOf("%")&&(C=C/100*I.parentNode[e])):C=g,C}const qC=g=>g.ownerDocument.defaultView.getComputedStyle(g,null);const $C=["top","right","bottom","left"];function gt(g,I,e){const C={};e=e?"-"+e:"";for(let t=0;t<4;t++){const l=$C[t];C[l]=parseFloat(g[I+"-"+l+e])||0}return C.width=C.left+C.right,C.height=C.top+C.bottom,C}const It=(g,I,e)=>(g>0||I>0)&&(!e||!e.shadowRoot);function et(g,I){if("native"in g)return g;const{canvas:e,currentDevicePixelRatio:C}=I,t=qC(e),l="border-box"===t.boxSizing,n=gt(t,"padding"),o=gt(t,"border","width"),{x:a,y:i,box:A}=function(g,I){const e=g.touches,C=e&&e.length?e[0]:g,{offsetX:t,offsetY:l}=C;let n,o,a=!1;if(It(t,l,g.target))n=t,o=l;else{const g=I.getBoundingClientRect();n=C.clientX-g.left,o=C.clientY-g.top,a=!0}return{x:n,y:o,box:a}}(g,e),c=n.left+(A&&o.left),s=n.top+(A&&o.top);let{width:d,height:r}=I;return l&&(d-=n.width+o.width,r-=n.height+o.height),{x:Math.round((a-c)/d*e.width/C),y:Math.round((i-s)/r*e.height/C)}}const Ct=g=>Math.round(10*g)/10;function tt(g,I,e,C){const t=qC(g),l=gt(t,"margin"),n=_C(t.maxWidth,g,"clientWidth")||te,o=_C(t.maxHeight,g,"clientHeight")||te,a=function(g,I,e){let C,t;if(void 0===I||void 0===e){const l=OC(g);if(l){const g=l.getBoundingClientRect(),n=qC(l),o=gt(n,"border","width"),a=gt(n,"padding");I=g.width-a.width-o.width,e=g.height-a.height-o.height,C=_C(n.maxWidth,l,"clientWidth"),t=_C(n.maxHeight,l,"clientHeight")}else I=g.clientWidth,e=g.clientHeight}return{width:I,height:e,maxWidth:C||te,maxHeight:t||te}}(g,I,e);let{width:i,height:A}=a;if("content-box"===t.boxSizing){const g=gt(t,"border","width"),I=gt(t,"padding");i-=I.width+g.width,A-=I.height+g.height}i=Math.max(0,i-l.width),A=Math.max(0,C?i/C:A-l.height),i=Ct(Math.min(i,n,a.maxWidth)),A=Ct(Math.min(A,o,a.maxHeight)),i&&!A&&(A=Ct(i/2));return(void 0!==I||void 0!==e)&&C&&a.height&&A>a.height&&(A=a.height,i=Ct(Math.floor(A*C))),{width:i,height:A}}function lt(g,I,e){const C=I||1,t=Math.floor(g.height*C),l=Math.floor(g.width*C);g.height=Math.floor(g.height),g.width=Math.floor(g.width);const n=g.canvas;return n.style&&(e||!n.style.height&&!n.style.width)&&(n.style.height="".concat(g.height,"px"),n.style.width="".concat(g.width,"px")),(g.currentDevicePixelRatio!==C||n.height!==t||n.width!==l)&&(g.currentDevicePixelRatio=C,n.height=t,n.width=l,g.ctx.setTransform(C,0,0,C,0,0),!0)}const nt=function(){let g=!1;try{const I={get passive(){return g=!0,!1}};PC()&&(window.addEventListener("test",null,I),window.removeEventListener("test",null,I))}catch(I){}return g}();function ot(g,I){const e=function(g,I){return qC(g).getPropertyValue(I)}(g,I),C=e&&e.match(/^(\d+)(\.\d+)?px$/);return C?+C[1]:void 0}function at(g,I,e,C){return{x:g.x+e*(I.x-g.x),y:g.y+e*(I.y-g.y)}}function it(g,I,e,C){return{x:g.x+e*(I.x-g.x),y:"middle"===C?e<.5?g.y:I.y:"after"===C?e<1?g.y:I.y:e>0?I.y:g.y}}function At(g,I,e,C){const t={x:g.cp2x,y:g.cp2y},l={x:I.cp1x,y:I.cp1y},n=at(g,t,e),o=at(t,l,e),a=at(l,I,e),i=at(n,o,e),A=at(o,a,e);return at(i,A,e)}function ct(g,I,e){return g?function(g,I){return{x:e=>g+g+I-e,setWidth(g){I=g},textAlign:g=>"center"===g?g:"right"===g?"left":"right",xPlus:(g,I)=>g-I,leftForLtr:(g,I)=>g-I}}(I,e):{x:g=>g,setWidth(g){},textAlign:g=>g,xPlus:(g,I)=>g+I,leftForLtr:(g,I)=>g}}function st(g,I){let e,C;"ltr"!==I&&"rtl"!==I||(e=g.canvas.style,C=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",I,"important"),g.prevTextDirection=C)}function dt(g,I){void 0!==I&&(delete g.prevTextDirection,g.canvas.style.setProperty("direction",I[0],I[1]))}function rt(g){return"angle"===g?{between:ye,compare:Ge,normalize:Be}:{between:We,compare:(g,I)=>g-I,normalize:g=>g}}function bt(g){let{start:I,end:e,count:C,loop:t,style:l}=g;return{start:I%C,end:e%C,loop:t&&(e-I+1)%C===0,style:l}}function ut(g,I,e){if(!e)return[g];const{property:C,start:t,end:l}=e,n=I.length,{compare:o,between:a,normalize:i}=rt(C),{start:A,end:c,loop:s,style:d}=function(g,I,e){const{property:C,start:t,end:l}=e,{between:n,normalize:o}=rt(C),a=I.length;let i,A,{start:c,end:s,loop:d}=g;if(d){for(c+=a,s+=a,i=0,A=a;i<A&&n(o(I[c%a][C]),t,l);++i)c--,s--;c%=a,s%=a}return s<c&&(s+=a),{start:c,end:s,loop:d,style:g.style}}(g,I,e),r=[];let b,u,m,Z=!1,h=null;const G=()=>Z||a(t,m,b)&&0!==o(t,m),B=()=>!Z||0===o(l,b)||a(l,m,b);for(let y=A,p=A;y<=c;++y)u=I[y%n],u.skip||(b=i(u[C]),b!==m&&(Z=a(b,t,l),null===h&&G()&&(h=0===o(b,t)?y:p),null!==h&&B()&&(r.push(bt({start:h,end:y,loop:s,count:n,style:d})),h=null),p=y,m=b));return null!==h&&r.push(bt({start:h,end:c,loop:s,count:n,style:d})),r}function mt(g,I){const e=[],C=g.segments;for(let t=0;t<C.length;t++){const l=ut(C[t],g.points,I);l.length&&e.push(...l)}return e}function Zt(g,I,e,C){return C&&C.setContext&&e?function(g,I,e,C){const t=g._chart.getContext(),l=ht(g.options),{_datasetIndex:n,options:{spanGaps:o}}=g,a=e.length,i=[];let A=l,c=I[0].start,s=c;function d(g,I,C,t){const l=o?-1:1;if(g!==I){for(g+=a;e[g%a].skip;)g-=l;for(;e[I%a].skip;)I+=l;g%a!==I%a&&(i.push({start:g%a,end:I%a,loop:C,style:t}),A=t,c=I%a)}}for(const r of I){c=o?c:r.start;let g,I=e[c%a];for(s=c+1;s<=r.end;s++){const l=e[s%a];g=ht(C.setContext(XC(t,{type:"segment",p0:I,p1:l,p0DataIndex:(s-1)%a,p1DataIndex:s%a,datasetIndex:n}))),Gt(g,A)&&d(c,s-1,r.loop,A),I=l,A=g}c<s-1&&d(c,s-1,r.loop,A)}return i}(g,I,e,C):I}function ht(g){return{backgroundColor:g.backgroundColor,borderCapStyle:g.borderCapStyle,borderDash:g.borderDash,borderDashOffset:g.borderDashOffset,borderJoinStyle:g.borderJoinStyle,borderWidth:g.borderWidth,borderColor:g.borderColor}}function Gt(g,I){if(!I)return!1;const e=[],C=function(g,I){return Me(I)?(e.includes(I)||e.push(I),e.indexOf(I)):I};return JSON.stringify(g,C)!==JSON.stringify(I,C)}class Bt{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(g,I,e,C){const t=I.listeners[C],l=I.duration;t.forEach((C=>C({chart:g,initial:I.initial,numSteps:l,currentStep:Math.min(e-I.start,l)})))}_refresh(){this._request||(this._running=!0,this._request=Ye.call(window,(()=>{this._update(),this._request=null,this._running&&this._refresh()})))}_update(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),I=0;this._charts.forEach(((e,C)=>{if(!e.running||!e.items.length)return;const t=e.items;let l,n=t.length-1,o=!1;for(;n>=0;--n)l=t[n],l._active?(l._total>e.duration&&(e.duration=l._total),l.tick(g),o=!0):(t[n]=t[t.length-1],t.pop());o&&(C.draw(),this._notify(C,e,g,"progress")),t.length||(e.running=!1,this._notify(C,e,g,"complete"),e.initial=!1),I+=t.length})),this._lastDate=g,0===I&&(this._running=!1)}_getAnims(g){const I=this._charts;let e=I.get(g);return e||(e={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},I.set(g,e)),e}listen(g,I,e){this._getAnims(g).listeners[I].push(e)}add(g,I){I&&I.length&&this._getAnims(g).items.push(...I)}has(g){return this._getAnims(g).items.length>0}start(g){const I=this._charts.get(g);I&&(I.running=!0,I.start=Date.now(),I.duration=I.items.reduce(((g,I)=>Math.max(g,I._duration)),0),this._refresh())}running(g){if(!this._running)return!1;const I=this._charts.get(g);return!!(I&&I.running&&I.items.length)}stop(g){const I=this._charts.get(g);if(!I||!I.items.length)return;const e=I.items;let C=e.length-1;for(;C>=0;--C)e[C].cancel();I.items=[],this._notify(g,I,Date.now(),"complete")}remove(g){return this._charts.delete(g)}}var yt=new Bt;const pt="transparent",Wt={boolean:(g,I,e)=>e>.5?I:g,color(g,I,e){const C=Ee(g||pt),t=C.valid&&Ee(I||pt);return t&&t.valid?t.mix(C,e).hexString():I},number:(g,I,e)=>g+(I-g)*e};class Vt{constructor(g,I,e,C){const t=I[e];C=SC([g.to,C,t,g.from]);const l=SC([g.from,t,C]);this._active=!0,this._fn=g.fn||Wt[g.type||typeof l],this._easing=ze[g.easing]||ze.linear,this._start=Math.floor(Date.now()+(g.delay||0)),this._duration=this._total=Math.floor(g.duration),this._loop=!!g.loop,this._target=I,this._prop=e,this._from=l,this._to=C,this._promises=void 0}active(){return this._active}update(g,I,e){if(this._active){this._notify(!1);const C=this._target[this._prop],t=e-this._start,l=this._duration-t;this._start=e,this._duration=Math.floor(Math.max(l,g.duration)),this._total+=t,this._loop=!!g.loop,this._to=SC([g.to,I,C,g.from]),this._from=SC([g.from,C,I])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(g){const I=g-this._start,e=this._duration,C=this._prop,t=this._from,l=this._loop,n=this._to;let o;if(this._active=t!==n&&(l||I<e),!this._active)return this._target[C]=n,void this._notify(!0);I<0?this._target[C]=t:(o=I/e%2,o=l&&o>1?2-o:o,o=this._easing(Math.min(1,Math.max(0,o))),this._target[C]=this._fn(t,n,o))}wait(){const g=this._promises||(this._promises=[]);return new Promise(((I,e)=>{g.push({res:I,rej:e})}))}_notify(g){const I=g?"res":"rej",e=this._promises||[];for(let C=0;C<e.length;C++)e[C][I]()}}class St{constructor(g,I){this._chart=g,this._properties=new Map,this.configure(I)}configure(g){if(!wI(g))return;const I=Object.keys(IC.animation),e=this._properties;Object.getOwnPropertyNames(g).forEach((C=>{const t=g[C];if(!wI(t))return;const l={};for(const g of I)l[g]=t[g];(HI(t.properties)&&t.properties||[C]).forEach((g=>{g!==C&&e.has(g)||e.set(g,l)}))}))}_animateOptions(g,I){const e=I.options,C=function(g,I){if(!I)return;let e=g.options;if(!e)return void(g.options=I);e.$shared&&(g.options=e=Object.assign({},e,{$shared:!1,$animations:{}}));return e}(g,e);if(!C)return[];const t=this._createAnimations(C,e);return e.$shared&&function(g,I){const e=[],C=Object.keys(I);for(let t=0;t<C.length;t++){const I=g[C[t]];I&&I.active()&&e.push(I.wait())}return Promise.all(e)}(g.options.$animations,e).then((()=>{g.options=e}),(()=>{})),t}_createAnimations(g,I){const e=this._properties,C=[],t=g.$animations||(g.$animations={}),l=Object.keys(I),n=Date.now();let o;for(o=l.length-1;o>=0;--o){const a=l[o];if("$"===a.charAt(0))continue;if("options"===a){C.push(...this._animateOptions(g,I));continue}const i=I[a];let A=t[a];const c=e.get(a);if(A){if(c&&A.active()){A.update(c,i,n);continue}A.cancel()}c&&c.duration?(t[a]=A=new Vt(c,g,a,i),C.push(A)):g[a]=i}return C}update(g,I){if(0===this._properties.size)return void Object.assign(g,I);const e=this._createAnimations(g,I);return e.length?(yt.add(this._chart,e),!0):void 0}}function Xt(g,I){const e=g&&g.options||{},C=e.reverse,t=void 0===e.min?I:0,l=void 0===e.max?I:0;return{start:C?l:t,end:C?t:l}}function Rt(g,I){const e=[],C=g._getSortedDatasetMetas(I);let t,l;for(t=0,l=C.length;t<l;++t)e.push(C[t].index);return e}function Jt(g,I,e){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const t=g.keys,l="single"===C.mode;let n,o,a,i;if(null!==I){for(n=0,o=t.length;n<o;++n){if(a=+t[n],a===e){if(C.all)continue;break}i=g.values[a],NI(i)&&(l||0===I||Ae(I)===Ae(i))&&(I+=i)}return I}}function kt(g,I){const e=g&&g.options.stacked;return e||void 0===e&&void 0!==I.stack}function Yt(g,I,e){const C=g[I]||(g[I]={});return C[e]||(C[e]={})}function ft(g,I,e,C){for(const t of I.getMatchingVisibleMetas(C).reverse()){const I=g[t.index];if(e&&I>0||!e&&I<0)return t.index}return null}function vt(g,I){const{chart:e,_cachedMeta:C}=g,t=e._stacks||(e._stacks={}),{iScale:l,vScale:n,index:o}=C,a=l.axis,i=n.axis,A=function(g,I,e){return"".concat(g.id,".").concat(I.id,".").concat(e.stack||e.type)}(l,n,C),c=I.length;let s;for(let d=0;d<c;++d){const g=I[d],{[a]:e,[i]:l}=g;s=(g._stacks||(g._stacks={}))[i]=Yt(t,A,e),s[o]=l,s._top=ft(s,n,!0,C.type),s._bottom=ft(s,n,!1,C.type);(s._visualValues||(s._visualValues={}))[o]=l}}function Ht(g,I){const e=g.scales;return Object.keys(e).filter((g=>e[g].axis===I)).shift()}function wt(g,I){const e=g.controller.index,C=g.vScale&&g.vScale.axis;if(C){I=I||g._parsed;for(const g of I){const I=g._stacks;if(!I||void 0===I[C]||void 0===I[C][e])return;delete I[C][e],void 0!==I[C]._visualValues&&void 0!==I[C]._visualValues[e]&&delete I[C]._visualValues[e]}}}const Nt=g=>"reset"===g||"none"===g,Kt=(g,I)=>I?g:Object.assign({},g);class Ft{constructor(g,I){this.chart=g,this._ctx=g.ctx,this.index=I,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const g=this._cachedMeta;this.configure(),this.linkScales(),g._stacked=kt(g.vScale,g),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(g){this.index!==g&&wt(this._cachedMeta),this.index=g}linkScales(){const g=this.chart,I=this._cachedMeta,e=this.getDataset(),C=(g,I,e,C)=>"x"===g?I:"r"===g?C:e,t=I.xAxisID=FI(e.xAxisID,Ht(g,"x")),l=I.yAxisID=FI(e.yAxisID,Ht(g,"y")),n=I.rAxisID=FI(e.rAxisID,Ht(g,"r")),o=I.indexAxis,a=I.iAxisID=C(o,t,l,n),i=I.vAxisID=C(o,l,t,n);I.xScale=this.getScaleForId(t),I.yScale=this.getScaleForId(l),I.rScale=this.getScaleForId(n),I.iScale=this.getScaleForId(a),I.vScale=this.getScaleForId(i)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(g){return this.chart.scales[g]}_getOtherScale(g){const I=this._cachedMeta;return g===I.iScale?I.vScale:I.iScale}reset(){this._update("reset")}_destroy(){const g=this._cachedMeta;this._data&&Je(this._data,this),g._stacked&&wt(g)}_dataCheck(){const g=this.getDataset(),I=g.data||(g.data=[]),e=this._data;if(wI(I))this._data=function(g){const I=Object.keys(g),e=new Array(I.length);let C,t,l;for(C=0,t=I.length;C<t;++C)l=I[C],e[C]={x:l,y:g[l]};return e}(I);else if(e!==I){if(e){Je(e,this);const g=this._cachedMeta;wt(g),g._parsed=[]}I&&Object.isExtensible(I)&&(t=this,(C=I)._chartjs?C._chartjs.listeners.push(t):(Object.defineProperty(C,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),Re.forEach((g=>{const I="_onData"+_I(g),e=C[g];Object.defineProperty(C,g,{configurable:!0,enumerable:!1,value(){for(var g=arguments.length,t=new Array(g),l=0;l<g;l++)t[l]=arguments[l];const n=e.apply(this,t);return C._chartjs.listeners.forEach((g=>{"function"===typeof g[I]&&g[I](...t)})),n}})})))),this._syncList=[],this._data=I}var C,t}addElements(){const g=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(g.dataset=new this.datasetElementType)}buildOrUpdateElements(g){const I=this._cachedMeta,e=this.getDataset();let C=!1;this._dataCheck();const t=I._stacked;I._stacked=kt(I.vScale,I),I.stack!==e.stack&&(C=!0,wt(I),I.stack=e.stack),this._resyncElements(g),(C||t!==I._stacked)&&vt(this,I._parsed)}configure(){const g=this.chart.config,I=g.datasetScopeKeys(this._type),e=g.getOptionScopes(this.getDataset(),I,!0);this.options=g.createResolver(e,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(g,I){const{_cachedMeta:e,_data:C}=this,{iScale:t,_stacked:l}=e,n=t.axis;let o,a,i,A=0===g&&I===C.length||e._sorted,c=g>0&&e._parsed[g-1];if(!1===this._parsing)e._parsed=C,e._sorted=!0,i=C;else{i=HI(C[g])?this.parseArrayData(e,C,g,I):wI(C[g])?this.parseObjectData(e,C,g,I):this.parsePrimitiveData(e,C,g,I);const t=()=>null===a[n]||c&&a[n]<c[n];for(o=0;o<I;++o)e._parsed[o+g]=a=i[o],A&&(t()&&(A=!1),c=a);e._sorted=A}l&&vt(this,i)}parsePrimitiveData(g,I,e,C){const{iScale:t,vScale:l}=g,n=t.axis,o=l.axis,a=t.getLabels(),i=t===l,A=new Array(C);let c,s,d;for(c=0,s=C;c<s;++c)d=c+e,A[c]={[n]:i||t.parse(a[d],d),[o]:l.parse(I[d],d)};return A}parseArrayData(g,I,e,C){const{xScale:t,yScale:l}=g,n=new Array(C);let o,a,i,A;for(o=0,a=C;o<a;++o)i=o+e,A=I[i],n[o]={x:t.parse(A[0],i),y:l.parse(A[1],i)};return n}parseObjectData(g,I,e,C){const{xScale:t,yScale:l}=g,{xAxisKey:n="x",yAxisKey:o="y"}=this._parsing,a=new Array(C);let i,A,c,s;for(i=0,A=C;i<A;++i)c=i+e,s=I[c],a[i]={x:t.parse(OI(s,n),c),y:l.parse(OI(s,o),c)};return a}getParsed(g){return this._cachedMeta._parsed[g]}getDataElement(g){return this._cachedMeta.data[g]}applyStack(g,I,e){const C=this.chart,t=this._cachedMeta,l=I[g.axis];return Jt({keys:Rt(C,!0),values:I._stacks[g.axis]._visualValues},l,t.index,{mode:e})}updateRangeFromParsed(g,I,e,C){const t=e[I.axis];let l=null===t?NaN:t;const n=C&&e._stacks[I.axis];C&&n&&(C.values=n,l=Jt(C,t,this._cachedMeta.index)),g.min=Math.min(g.min,l),g.max=Math.max(g.max,l)}getMinMax(g,I){const e=this._cachedMeta,C=e._parsed,t=e._sorted&&g===e.iScale,l=C.length,n=this._getOtherScale(g),o=((g,I,e)=>g&&!I.hidden&&I._stacked&&{keys:Rt(e,!0),values:null})(I,e,this.chart),a={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:i,max:A}=function(g){const{min:I,max:e,minDefined:C,maxDefined:t}=g.getUserBounds();return{min:C?I:Number.NEGATIVE_INFINITY,max:t?e:Number.POSITIVE_INFINITY}}(n);let c,s;function d(){s=C[c];const I=s[n.axis];return!NI(s[g.axis])||i>I||A<I}for(c=0;c<l&&(d()||(this.updateRangeFromParsed(a,g,s,o),!t));++c);if(t)for(c=l-1;c>=0;--c)if(!d()){this.updateRangeFromParsed(a,g,s,o);break}return a}getAllParsedValues(g){const I=this._cachedMeta._parsed,e=[];let C,t,l;for(C=0,t=I.length;C<t;++C)l=I[C][g.axis],NI(l)&&e.push(l);return e}getMaxOverflow(){return!1}getLabelAndValue(g){const I=this._cachedMeta,e=I.iScale,C=I.vScale,t=this.getParsed(g);return{label:e?""+e.getLabelForValue(t[e.axis]):"",value:C?""+C.getLabelForValue(t[C.axis]):""}}_update(g){const I=this._cachedMeta;this.update(g||"default"),I._clip=function(g){let I,e,C,t;return wI(g)?(I=g.top,e=g.right,C=g.bottom,t=g.left):I=e=C=t=g,{top:I,right:e,bottom:C,left:t,disabled:!1===g}}(FI(this.options.clip,function(g,I,e){if(!1===e)return!1;const C=Xt(g,e),t=Xt(I,e);return{top:t.end,right:C.end,bottom:t.start,left:C.start}}(I.xScale,I.yScale,this.getMaxOverflow())))}update(g){}draw(){const g=this._ctx,I=this.chart,e=this._cachedMeta,C=e.data||[],t=I.chartArea,l=[],n=this._drawStart||0,o=this._drawCount||C.length-n,a=this.options.drawActiveElementsOnTop;let i;for(e.dataset&&e.dataset.draw(g,t,n,o),i=n;i<n+o;++i){const I=C[i];I.hidden||(I.active&&a?l.push(I):I.draw(g,t))}for(i=0;i<l.length;++i)l[i].draw(g,t)}getStyle(g,I){const e=I?"active":"default";return void 0===g&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(e):this.resolveDataElementOptions(g||0,e)}getContext(g,I,e){const C=this.getDataset();let t;if(g>=0&&g<this._cachedMeta.data.length){const I=this._cachedMeta.data[g];t=I.$context||(I.$context=function(g,I,e){return XC(g,{active:!1,dataIndex:I,parsed:void 0,raw:void 0,element:e,index:I,mode:"default",type:"data"})}(this.getContext(),g,I)),t.parsed=this.getParsed(g),t.raw=C.data[g],t.index=t.dataIndex=g}else t=this.$context||(this.$context=function(g,I){return XC(g,{active:!1,dataset:void 0,datasetIndex:I,index:I,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),t.dataset=C,t.index=t.datasetIndex=this.index;return t.active=!!I,t.mode=e,t}resolveDatasetElementOptions(g){return this._resolveElementOptions(this.datasetElementType.id,g)}resolveDataElementOptions(g,I){return this._resolveElementOptions(this.dataElementType.id,I,g)}_resolveElementOptions(g){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",e=arguments.length>2?arguments[2]:void 0;const C="active"===I,t=this._cachedDataOpts,l=g+"-"+I,n=t[l],o=this.enableOptionSharing&&qI(e);if(n)return Kt(n,o);const a=this.chart.config,i=a.datasetElementScopeKeys(this._type,g),A=C?["".concat(g,"Hover"),"hover",g,""]:[g,""],c=a.getOptionScopes(this.getDataset(),i),s=Object.keys(IC.elements[g]),d=a.resolveNamedOptions(c,s,(()=>this.getContext(e,C,I)),A);return d.$shared&&(d.$shared=o,t[l]=Object.freeze(Kt(d,o))),d}_resolveAnimations(g,I,e){const C=this.chart,t=this._cachedDataOpts,l="animation-".concat(I),n=t[l];if(n)return n;let o;if(!1!==C.options.animation){const C=this.chart.config,t=C.datasetAnimationScopeKeys(this._type,I),l=C.getOptionScopes(this.getDataset(),t);o=C.createResolver(l,this.getContext(g,e,I))}const a=new St(C,o&&o.animations);return o&&o._cacheable&&(t[l]=Object.freeze(a)),a}getSharedOptions(g){if(g.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},g))}includeOptions(g,I){return!I||Nt(g)||this.chart._animationsDisabled}_getSharedOptions(g,I){const e=this.resolveDataElementOptions(g,I),C=this._sharedOptions,t=this.getSharedOptions(e),l=this.includeOptions(I,t)||t!==C;return this.updateSharedOptions(t,I,e),{sharedOptions:t,includeOptions:l}}updateElement(g,I,e,C){Nt(C)?Object.assign(g,e):this._resolveAnimations(I,C).update(g,e)}updateSharedOptions(g,I,e){g&&!Nt(I)&&this._resolveAnimations(void 0,I).update(g,e)}_setStyle(g,I,e,C){g.active=C;const t=this.getStyle(I,C);this._resolveAnimations(I,e,C).update(g,{options:!C&&this.getSharedOptions(t)||t})}removeHoverStyle(g,I,e){this._setStyle(g,e,"active",!1)}setHoverStyle(g,I,e){this._setStyle(g,e,"active",!0)}_removeDatasetHoverStyle(){const g=this._cachedMeta.dataset;g&&this._setStyle(g,void 0,"active",!1)}_setDatasetHoverStyle(){const g=this._cachedMeta.dataset;g&&this._setStyle(g,void 0,"active",!0)}_resyncElements(g){const I=this._data,e=this._cachedMeta.data;for(const[n,o,a]of this._syncList)this[n](o,a);this._syncList=[];const C=e.length,t=I.length,l=Math.min(t,C);l&&this.parse(0,l),t>C?this._insertElements(C,t-C,g):t<C&&this._removeElements(t,C-t)}_insertElements(g,I){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const C=this._cachedMeta,t=C.data,l=g+I;let n;const o=g=>{for(g.length+=I,n=g.length-1;n>=l;n--)g[n]=g[n-I]};for(o(t),n=g;n<l;++n)t[n]=new this.dataElementType;this._parsing&&o(C._parsed),this.parse(g,I),e&&this.updateElements(t,g,I,"reset")}updateElements(g,I,e,C){}_removeElements(g,I){const e=this._cachedMeta;if(this._parsing){const C=e._parsed.splice(g,I);e._stacked&&wt(e,C)}e.data.splice(g,I)}_sync(g){if(this._parsing)this._syncList.push(g);else{const[I,e,C]=g;this[I](e,C)}this.chart._dataChanges.push([this.index,...g])}_onDataPush(){const g=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-g,g])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(g,I){I&&this._sync(["_removeElements",g,I]);const e=arguments.length-2;e&&this._sync(["_insertElements",g,e])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function xt(g){const I=g.iScale,e=function(g,I){if(!g._cache.$bar){const e=g.getMatchingVisibleMetas(I);let C=[];for(let I=0,t=e.length;I<t;I++)C=C.concat(e[I].controller.getAllParsedValues(g));g._cache.$bar=ke(C.sort(((g,I)=>g-I)))}return g._cache.$bar}(I,g.type);let C,t,l,n,o=I._length;const a=()=>{32767!==l&&-32768!==l&&(qI(n)&&(o=Math.min(o,Math.abs(l-n)||o)),n=l)};for(C=0,t=e.length;C<t;++C)l=I.getPixelForValue(e[C]),a();for(n=void 0,C=0,t=I.ticks.length;C<t;++C)l=I.getPixelForTick(C),a();return o}function zt(g,I,e,C){return HI(g)?function(g,I,e,C){const t=e.parse(g[0],C),l=e.parse(g[1],C),n=Math.min(t,l),o=Math.max(t,l);let a=n,i=o;Math.abs(n)>Math.abs(o)&&(a=o,i=n),I[e.axis]=i,I._custom={barStart:a,barEnd:i,start:t,end:l,min:n,max:o}}(g,I,e,C):I[e.axis]=e.parse(g,C),I}function Mt(g,I,e,C){const t=g.iScale,l=g.vScale,n=t.getLabels(),o=t===l,a=[];let i,A,c,s;for(i=e,A=e+C;i<A;++i)s=I[i],c={},c[t.axis]=o||t.parse(n[i],i),a.push(zt(s,c,l,i));return a}function Et(g){return g&&void 0!==g.barStart&&void 0!==g.barEnd}function Qt(g,I,e,C){let t=I.borderSkipped;const l={};if(!t)return void(g.borderSkipped=l);if(!0===t)return void(g.borderSkipped={top:!0,right:!0,bottom:!0,left:!0});const{start:n,end:o,reverse:a,top:i,bottom:A}=function(g){let I,e,C,t,l;return g.horizontal?(I=g.base>g.x,e="left",C="right"):(I=g.base<g.y,e="bottom",C="top"),I?(t="end",l="start"):(t="start",l="end"),{start:e,end:C,reverse:I,top:t,bottom:l}}(g);"middle"===t&&e&&(g.enableBorderRadius=!0,(e._top||0)===C?t=i:(e._bottom||0)===C?t=A:(l[Ut(A,n,o,a)]=!0,t=i)),l[Ut(t,n,o,a)]=!0,g.borderSkipped=l}function Ut(g,I,e,C){var t,l,n;return C?(n=e,g=Lt(g=(t=g)===(l=I)?n:t===n?l:t,e,I)):g=Lt(g,I,e),g}function Lt(g,I,e){return"start"===g?I:"end"===g?e:g}function Dt(g,I,e){let{inflateAmount:C}=I;g.inflateAmount="auto"===C?1===e?.33:0:C}_g(Ft,"defaults",{}),_g(Ft,"datasetElementType",null),_g(Ft,"dataElementType",null);class Tt extends Ft{parsePrimitiveData(g,I,e,C){return Mt(g,I,e,C)}parseArrayData(g,I,e,C){return Mt(g,I,e,C)}parseObjectData(g,I,e,C){const{iScale:t,vScale:l}=g,{xAxisKey:n="x",yAxisKey:o="y"}=this._parsing,a="x"===t.axis?n:o,i="x"===l.axis?n:o,A=[];let c,s,d,r;for(c=e,s=e+C;c<s;++c)r=I[c],d={},d[t.axis]=t.parse(OI(r,a),c),A.push(zt(OI(r,i),d,l,c));return A}updateRangeFromParsed(g,I,e,C){super.updateRangeFromParsed(g,I,e,C);const t=e._custom;t&&I===this._cachedMeta.vScale&&(g.min=Math.min(g.min,t.min),g.max=Math.max(g.max,t.max))}getMaxOverflow(){return 0}getLabelAndValue(g){const I=this._cachedMeta,{iScale:e,vScale:C}=I,t=this.getParsed(g),l=t._custom,n=Et(l)?"["+l.start+", "+l.end+"]":""+C.getLabelForValue(t[C.axis]);return{label:""+e.getLabelForValue(t[e.axis]),value:n}}initialize(){this.enableOptionSharing=!0,super.initialize();this._cachedMeta.stack=this.getDataset().stack}update(g){const I=this._cachedMeta;this.updateElements(I.data,0,I.data.length,g)}updateElements(g,I,e,C){const t="reset"===C,{index:l,_cachedMeta:{vScale:n}}=this,o=n.getBasePixel(),a=n.isHorizontal(),i=this._getRuler(),{sharedOptions:A,includeOptions:c}=this._getSharedOptions(I,C);for(let s=I;s<I+e;s++){const I=this.getParsed(s),e=t||vI(I[n.axis])?{base:o,head:o}:this._calculateBarValuePixels(s),d=this._calculateBarIndexPixels(s,i),r=(I._stacks||{})[n.axis],b={horizontal:a,base:e.base,enableBorderRadius:!r||Et(I._custom)||l===r._top||l===r._bottom,x:a?e.head:d.center,y:a?d.center:e.head,height:a?d.size:Math.abs(e.size),width:a?Math.abs(e.size):d.size};c&&(b.options=A||this.resolveDataElementOptions(s,g[s].active?"active":C));const u=b.options||g[s].options;Qt(b,u,r,l),Dt(b,u,i.ratio),this.updateElement(g[s],s,b,C)}}_getStacks(g,I){const{iScale:e}=this._cachedMeta,C=e.getMatchingVisibleMetas(this._type).filter((g=>g.controller.options.grouped)),t=e.options.stacked,l=[],n=g=>{const e=g.controller.getParsed(I),C=e&&e[g.vScale.axis];if(vI(C)||isNaN(C))return!0};for(const o of C)if((void 0===I||!n(o))&&((!1===t||-1===l.indexOf(o.stack)||void 0===t&&void 0===o.stack)&&l.push(o.stack),o.index===g))break;return l.length||l.push(void 0),l}_getStackCount(g){return this._getStacks(void 0,g).length}_getStackIndex(g,I,e){const C=this._getStacks(g,e),t=void 0!==I?C.indexOf(I):-1;return-1===t?C.length-1:t}_getRuler(){const g=this.options,I=this._cachedMeta,e=I.iScale,C=[];let t,l;for(t=0,l=I.data.length;t<l;++t)C.push(e.getPixelForValue(this.getParsed(t)[e.axis],t));const n=g.barThickness;return{min:n||xt(I),pixels:C,start:e._startPixel,end:e._endPixel,stackCount:this._getStackCount(),scale:e,grouped:g.grouped,ratio:n?1:g.categoryPercentage*g.barPercentage}}_calculateBarValuePixels(g){const{_cachedMeta:{vScale:I,_stacked:e,index:C},options:{base:t,minBarLength:l}}=this,n=t||0,o=this.getParsed(g),a=o._custom,i=Et(a);let A,c,s=o[I.axis],d=0,r=e?this.applyStack(I,o,e):s;r!==s&&(d=r-s,r=s),i&&(s=a.barStart,r=a.barEnd-a.barStart,0!==s&&Ae(s)!==Ae(a.barEnd)&&(d=0),d+=s);const b=vI(t)||i?d:t;let u=I.getPixelForValue(b);if(A=this.chart.getDataVisibility(g)?I.getPixelForValue(d+r):u,c=A-u,Math.abs(c)<l){c=function(g,I,e){return 0!==g?Ae(g):(I.isHorizontal()?1:-1)*(I.min>=e?1:-1)}(c,I,n)*l,s===n&&(u-=c/2);const g=I.getPixelForDecimal(0),t=I.getPixelForDecimal(1),a=Math.min(g,t),d=Math.max(g,t);u=Math.max(Math.min(u,d),a),A=u+c,e&&!i&&(o._stacks[I.axis]._visualValues[C]=I.getValueForPixel(A)-I.getValueForPixel(u))}if(u===I.getPixelForValue(n)){const g=Ae(c)*I.getLineWidthForValue(n)/2;u+=g,c-=g}return{size:c,base:u,head:A,center:A+c/2}}_calculateBarIndexPixels(g,I){const e=I.scale,C=this.options,t=C.skipNull,l=FI(C.maxBarThickness,1/0);let n,o;if(I.grouped){const e=t?this._getStackCount(g):I.stackCount,a="flex"===C.barThickness?function(g,I,e,C){const t=I.pixels,l=t[g];let n=g>0?t[g-1]:null,o=g<t.length-1?t[g+1]:null;const a=e.categoryPercentage;null===n&&(n=l-(null===o?I.end-I.start:o-l)),null===o&&(o=l+l-n);const i=l-(l-Math.min(n,o))/2*a;return{chunk:Math.abs(o-n)/2*a/C,ratio:e.barPercentage,start:i}}(g,I,C,e):function(g,I,e,C){const t=e.barThickness;let l,n;return vI(t)?(l=I.min*e.categoryPercentage,n=e.barPercentage):(l=t*C,n=1),{chunk:l/C,ratio:n,start:I.pixels[g]-l/2}}(g,I,C,e),i=this._getStackIndex(this.index,this._cachedMeta.stack,t?g:void 0);n=a.start+a.chunk*i+a.chunk/2,o=Math.min(l,a.chunk*a.ratio)}else n=e.getPixelForValue(this.getParsed(g)[e.axis],g),o=Math.min(l,I.min*I.ratio);return{base:n-o/2,head:n+o/2,center:n,size:o}}draw(){const g=this._cachedMeta,I=g.vScale,e=g.data,C=e.length;let t=0;for(;t<C;++t)null!==this.getParsed(t)[I.axis]&&e[t].draw(this._ctx)}}_g(Tt,"id","bar"),_g(Tt,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),_g(Tt,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class jt extends Ft{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(g,I,e,C){const t=super.parsePrimitiveData(g,I,e,C);for(let l=0;l<t.length;l++)t[l]._custom=this.resolveDataElementOptions(l+e).radius;return t}parseArrayData(g,I,e,C){const t=super.parseArrayData(g,I,e,C);for(let l=0;l<t.length;l++){const g=I[e+l];t[l]._custom=FI(g[2],this.resolveDataElementOptions(l+e).radius)}return t}parseObjectData(g,I,e,C){const t=super.parseObjectData(g,I,e,C);for(let l=0;l<t.length;l++){const g=I[e+l];t[l]._custom=FI(g&&g.r&&+g.r,this.resolveDataElementOptions(l+e).radius)}return t}getMaxOverflow(){const g=this._cachedMeta.data;let I=0;for(let e=g.length-1;e>=0;--e)I=Math.max(I,g[e].size(this.resolveDataElementOptions(e))/2);return I>0&&I}getLabelAndValue(g){const I=this._cachedMeta,e=this.chart.data.labels||[],{xScale:C,yScale:t}=I,l=this.getParsed(g),n=C.getLabelForValue(l.x),o=t.getLabelForValue(l.y),a=l._custom;return{label:e[g]||"",value:"("+n+", "+o+(a?", "+a:"")+")"}}update(g){const I=this._cachedMeta.data;this.updateElements(I,0,I.length,g)}updateElements(g,I,e,C){const t="reset"===C,{iScale:l,vScale:n}=this._cachedMeta,{sharedOptions:o,includeOptions:a}=this._getSharedOptions(I,C),i=l.axis,A=n.axis;for(let c=I;c<I+e;c++){const I=g[c],e=!t&&this.getParsed(c),s={},d=s[i]=t?l.getPixelForDecimal(.5):l.getPixelForValue(e[i]),r=s[A]=t?n.getBasePixel():n.getPixelForValue(e[A]);s.skip=isNaN(d)||isNaN(r),a&&(s.options=o||this.resolveDataElementOptions(c,I.active?"active":C),t&&(s.options.radius=0)),this.updateElement(I,c,s,C)}}resolveDataElementOptions(g,I){const e=this.getParsed(g);let C=super.resolveDataElementOptions(g,I);C.$shared&&(C=Object.assign({},C,{$shared:!1}));const t=C.radius;return"active"!==I&&(C.radius=0),C.radius+=FI(e&&e._custom,t),C}}_g(jt,"id","bubble"),_g(jt,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),_g(jt,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});class Pt extends Ft{constructor(g,I){super(g,I),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(g,I){const e=this.getDataset().data,C=this._cachedMeta;if(!1===this._parsing)C._parsed=e;else{let t,l,n=g=>+e[g];if(wI(e[g])){const{key:g="value"}=this._parsing;n=I=>+OI(e[I],g)}for(t=g,l=g+I;t<l;++t)C._parsed[t]=n(t)}}_getRotation(){return be(this.options.rotation-90)}_getCircumference(){return be(this.options.circumference)}_getRotationExtents(){let g=ee,I=-ee;for(let e=0;e<this.chart.data.datasets.length;++e)if(this.chart.isDatasetVisible(e)&&this.chart.getDatasetMeta(e).type===this._type){const C=this.chart.getDatasetMeta(e).controller,t=C._getRotation(),l=C._getCircumference();g=Math.min(g,t),I=Math.max(I,t+l)}return{rotation:g,circumference:I-g}}update(g){const I=this.chart,{chartArea:e}=I,C=this._cachedMeta,t=C.data,l=this.getMaxBorderWidth()+this.getMaxOffset(t)+this.options.spacing,n=Math.max((Math.min(e.width,e.height)-l)/2,0),o=Math.min((a=this.options.cutout,i=n,"string"===typeof a&&a.endsWith("%")?parseFloat(a)/100:+a/i),1);var a,i;const A=this._getRingWeight(this.index),{circumference:c,rotation:s}=this._getRotationExtents(),{ratioX:d,ratioY:r,offsetX:b,offsetY:u}=function(g,I,e){let C=1,t=1,l=0,n=0;if(I<ee){const o=g,a=o+I,i=Math.cos(o),A=Math.sin(o),c=Math.cos(a),s=Math.sin(a),d=(g,I,C)=>ye(g,o,a,!0)?1:Math.max(I,I*e,C,C*e),r=(g,I,C)=>ye(g,o,a,!0)?-1:Math.min(I,I*e,C,C*e),b=d(0,i,c),u=d(ne,A,s),m=r(Ie,i,c),Z=r(Ie+ne,A,s);C=(b-m)/2,t=(u-Z)/2,l=-(b+m)/2,n=-(u+Z)/2}return{ratioX:C,ratioY:t,offsetX:l,offsetY:n}}(s,c,o),m=(e.width-l)/d,Z=(e.height-l)/r,h=Math.max(Math.min(m,Z)/2,0),G=xI(this.options.radius,h),B=(G-Math.max(G*o,0))/this._getVisibleDatasetWeightTotal();this.offsetX=b*G,this.offsetY=u*G,C.total=this.calculateTotal(),this.outerRadius=G-B*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-B*A,0),this.updateElements(t,0,t.length,g)}_circumference(g,I){const e=this.options,C=this._cachedMeta,t=this._getCircumference();return I&&e.animation.animateRotate||!this.chart.getDataVisibility(g)||null===C._parsed[g]||C.data[g].hidden?0:this.calculateCircumference(C._parsed[g]*t/ee)}updateElements(g,I,e,C){const t="reset"===C,l=this.chart,n=l.chartArea,o=l.options.animation,a=(n.left+n.right)/2,i=(n.top+n.bottom)/2,A=t&&o.animateScale,c=A?0:this.innerRadius,s=A?0:this.outerRadius,{sharedOptions:d,includeOptions:r}=this._getSharedOptions(I,C);let b,u=this._getRotation();for(b=0;b<I;++b)u+=this._circumference(b,t);for(b=I;b<I+e;++b){const I=this._circumference(b,t),e=g[b],l={x:a+this.offsetX,y:i+this.offsetY,startAngle:u,endAngle:u+I,circumference:I,outerRadius:s,innerRadius:c};r&&(l.options=d||this.resolveDataElementOptions(b,e.active?"active":C)),u+=I,this.updateElement(e,b,l,C)}}calculateTotal(){const g=this._cachedMeta,I=g.data;let e,C=0;for(e=0;e<I.length;e++){const t=g._parsed[e];null===t||isNaN(t)||!this.chart.getDataVisibility(e)||I[e].hidden||(C+=Math.abs(t))}return C}calculateCircumference(g){const I=this._cachedMeta.total;return I>0&&!isNaN(g)?ee*(Math.abs(g)/I):0}getLabelAndValue(g){const I=this._cachedMeta,e=this.chart,C=e.data.labels||[],t=Te(I._parsed[g],e.options.locale);return{label:C[g]||"",value:t}}getMaxBorderWidth(g){let I=0;const e=this.chart;let C,t,l,n,o;if(!g)for(C=0,t=e.data.datasets.length;C<t;++C)if(e.isDatasetVisible(C)){l=e.getDatasetMeta(C),g=l.data,n=l.controller;break}if(!g)return 0;for(C=0,t=g.length;C<t;++C)o=n.resolveDataElementOptions(C),"inner"!==o.borderAlign&&(I=Math.max(I,o.borderWidth||0,o.hoverBorderWidth||0));return I}getMaxOffset(g){let I=0;for(let e=0,C=g.length;e<C;++e){const g=this.resolveDataElementOptions(e);I=Math.max(I,g.offset||0,g.hoverOffset||0)}return I}_getRingWeightOffset(g){let I=0;for(let e=0;e<g;++e)this.chart.isDatasetVisible(e)&&(I+=this._getRingWeight(e));return I}_getRingWeight(g){return Math.max(FI(this.chart.data.datasets[g].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}_g(Pt,"id","doughnut"),_g(Pt,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),_g(Pt,"descriptors",{_scriptable:g=>"spacing"!==g,_indexable:g=>"spacing"!==g&&!g.startsWith("borderDash")&&!g.startsWith("hoverBorderDash")}),_g(Pt,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(g){const I=g.data;if(I.labels.length&&I.datasets.length){const{labels:{pointStyle:e,color:C}}=g.legend.options;return I.labels.map(((I,t)=>{const l=g.getDatasetMeta(0).controller.getStyle(t);return{text:I,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:C,lineWidth:l.borderWidth,pointStyle:e,hidden:!g.getDataVisibility(t),index:t}}))}return[]}},onClick(g,I,e){e.chart.toggleDataVisibility(I.index),e.chart.update()}}}});class Ot extends Ft{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(g){const I=this._cachedMeta,{dataset:e,data:C=[],_dataset:t}=I,l=this.chart._animationsDisabled;let{start:n,count:o}=we(I,C,l);this._drawStart=n,this._drawCount=o,Ne(I)&&(n=0,o=C.length),e._chart=this.chart,e._datasetIndex=this.index,e._decimated=!!t._decimated,e.points=C;const a=this.resolveDatasetElementOptions(g);this.options.showLine||(a.borderWidth=0),a.segment=this.options.segment,this.updateElement(e,void 0,{animated:!l,options:a},g),this.updateElements(C,n,o,g)}updateElements(g,I,e,C){const t="reset"===C,{iScale:l,vScale:n,_stacked:o,_dataset:a}=this._cachedMeta,{sharedOptions:i,includeOptions:A}=this._getSharedOptions(I,C),c=l.axis,s=n.axis,{spanGaps:d,segment:r}=this.options,b=de(d)?d:Number.POSITIVE_INFINITY,u=this.chart._animationsDisabled||t||"none"===C,m=I+e,Z=g.length;let h=I>0&&this.getParsed(I-1);for(let G=0;G<Z;++G){const e=g[G],d=u?e:{};if(G<I||G>=m){d.skip=!0;continue}const Z=this.getParsed(G),B=vI(Z[s]),y=d[c]=l.getPixelForValue(Z[c],G),p=d[s]=t||B?n.getBasePixel():n.getPixelForValue(o?this.applyStack(n,Z,o):Z[s],G);d.skip=isNaN(y)||isNaN(p)||B,d.stop=G>0&&Math.abs(Z[c]-h[c])>b,r&&(d.parsed=Z,d.raw=a.data[G]),A&&(d.options=i||this.resolveDataElementOptions(G,e.active?"active":C)),u||this.updateElement(e,G,d,C),h=Z}}getMaxOverflow(){const g=this._cachedMeta,I=g.dataset,e=I.options&&I.options.borderWidth||0,C=g.data||[];if(!C.length)return e;const t=C[0].size(this.resolveDataElementOptions(0)),l=C[C.length-1].size(this.resolveDataElementOptions(C.length-1));return Math.max(e,t,l)/2}draw(){const g=this._cachedMeta;g.dataset.updateControlPoints(this.chart.chartArea,g.iScale.axis),super.draw()}}_g(Ot,"id","line"),_g(Ot,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),_g(Ot,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class _t extends Ft{constructor(g,I){super(g,I),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(g){const I=this._cachedMeta,e=this.chart,C=e.data.labels||[],t=Te(I._parsed[g].r,e.options.locale);return{label:C[g]||"",value:t}}parseObjectData(g,I,e,C){return MC.bind(this)(g,I,e,C)}update(g){const I=this._cachedMeta.data;this._updateRadius(),this.updateElements(I,0,I.length,g)}getMinMax(){const g=this._cachedMeta,I={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return g.data.forEach(((g,e)=>{const C=this.getParsed(e).r;!isNaN(C)&&this.chart.getDataVisibility(e)&&(C<I.min&&(I.min=C),C>I.max&&(I.max=C))})),I}_updateRadius(){const g=this.chart,I=g.chartArea,e=g.options,C=Math.min(I.right-I.left,I.bottom-I.top),t=Math.max(C/2,0),l=(t-Math.max(e.cutoutPercentage?t/100*e.cutoutPercentage:1,0))/g.getVisibleDatasetCount();this.outerRadius=t-l*this.index,this.innerRadius=this.outerRadius-l}updateElements(g,I,e,C){const t="reset"===C,l=this.chart,n=l.options.animation,o=this._cachedMeta.rScale,a=o.xCenter,i=o.yCenter,A=o.getIndexAngle(0)-.5*Ie;let c,s=A;const d=360/this.countVisibleElements();for(c=0;c<I;++c)s+=this._computeAngle(c,C,d);for(c=I;c<I+e;c++){const I=g[c];let e=s,r=s+this._computeAngle(c,C,d),b=l.getDataVisibility(c)?o.getDistanceFromCenterForValue(this.getParsed(c).r):0;s=r,t&&(n.animateScale&&(b=0),n.animateRotate&&(e=r=A));const u={x:a,y:i,innerRadius:0,outerRadius:b,startAngle:e,endAngle:r,options:this.resolveDataElementOptions(c,I.active?"active":C)};this.updateElement(I,c,u,C)}}countVisibleElements(){const g=this._cachedMeta;let I=0;return g.data.forEach(((g,e)=>{!isNaN(this.getParsed(e).r)&&this.chart.getDataVisibility(e)&&I++})),I}_computeAngle(g,I,e){return this.chart.getDataVisibility(g)?be(this.resolveDataElementOptions(g,I).angle||e):0}}_g(_t,"id","polarArea"),_g(_t,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),_g(_t,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(g){const I=g.data;if(I.labels.length&&I.datasets.length){const{labels:{pointStyle:e,color:C}}=g.legend.options;return I.labels.map(((I,t)=>{const l=g.getDatasetMeta(0).controller.getStyle(t);return{text:I,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:C,lineWidth:l.borderWidth,pointStyle:e,hidden:!g.getDataVisibility(t),index:t}}))}return[]}},onClick(g,I,e){e.chart.toggleDataVisibility(I.index),e.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class qt extends Pt{}_g(qt,"id","pie"),_g(qt,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class $t extends Ft{getLabelAndValue(g){const I=this._cachedMeta.vScale,e=this.getParsed(g);return{label:I.getLabels()[g],value:""+I.getLabelForValue(e[I.axis])}}parseObjectData(g,I,e,C){return MC.bind(this)(g,I,e,C)}update(g){const I=this._cachedMeta,e=I.dataset,C=I.data||[],t=I.iScale.getLabels();if(e.points=C,"resize"!==g){const I=this.resolveDatasetElementOptions(g);this.options.showLine||(I.borderWidth=0);const l={_loop:!0,_fullLoop:t.length===C.length,options:I};this.updateElement(e,void 0,l,g)}this.updateElements(C,0,C.length,g)}updateElements(g,I,e,C){const t=this._cachedMeta.rScale,l="reset"===C;for(let n=I;n<I+e;n++){const I=g[n],e=this.resolveDataElementOptions(n,I.active?"active":C),o=t.getPointPositionForValue(n,this.getParsed(n).r),a=l?t.xCenter:o.x,i=l?t.yCenter:o.y,A={x:a,y:i,angle:o.angle,skip:isNaN(a)||isNaN(i),options:e};this.updateElement(I,n,A,C)}}}_g($t,"id","radar"),_g($t,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),_g($t,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class gl extends Ft{getLabelAndValue(g){const I=this._cachedMeta,e=this.chart.data.labels||[],{xScale:C,yScale:t}=I,l=this.getParsed(g),n=C.getLabelForValue(l.x),o=t.getLabelForValue(l.y);return{label:e[g]||"",value:"("+n+", "+o+")"}}update(g){const I=this._cachedMeta,{data:e=[]}=I,C=this.chart._animationsDisabled;let{start:t,count:l}=we(I,e,C);if(this._drawStart=t,this._drawCount=l,Ne(I)&&(t=0,l=e.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:t,_dataset:l}=I;t._chart=this.chart,t._datasetIndex=this.index,t._decimated=!!l._decimated,t.points=e;const n=this.resolveDatasetElementOptions(g);n.segment=this.options.segment,this.updateElement(t,void 0,{animated:!C,options:n},g)}else this.datasetElementType&&(delete I.dataset,this.datasetElementType=!1);this.updateElements(e,t,l,g)}addElements(){const{showLine:g}=this.options;!this.datasetElementType&&g&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(g,I,e,C){const t="reset"===C,{iScale:l,vScale:n,_stacked:o,_dataset:a}=this._cachedMeta,i=this.resolveDataElementOptions(I,C),A=this.getSharedOptions(i),c=this.includeOptions(C,A),s=l.axis,d=n.axis,{spanGaps:r,segment:b}=this.options,u=de(r)?r:Number.POSITIVE_INFINITY,m=this.chart._animationsDisabled||t||"none"===C;let Z=I>0&&this.getParsed(I-1);for(let h=I;h<I+e;++h){const I=g[h],e=this.getParsed(h),i=m?I:{},r=vI(e[d]),G=i[s]=l.getPixelForValue(e[s],h),B=i[d]=t||r?n.getBasePixel():n.getPixelForValue(o?this.applyStack(n,e,o):e[d],h);i.skip=isNaN(G)||isNaN(B)||r,i.stop=h>0&&Math.abs(e[s]-Z[s])>u,b&&(i.parsed=e,i.raw=a.data[h]),c&&(i.options=A||this.resolveDataElementOptions(h,I.active?"active":C)),m||this.updateElement(I,h,i,C),Z=e}this.updateSharedOptions(A,C,i)}getMaxOverflow(){const g=this._cachedMeta,I=g.data||[];if(!this.options.showLine){let g=0;for(let e=I.length-1;e>=0;--e)g=Math.max(g,I[e].size(this.resolveDataElementOptions(e))/2);return g>0&&g}const e=g.dataset,C=e.options&&e.options.borderWidth||0;if(!I.length)return C;const t=I[0].size(this.resolveDataElementOptions(0)),l=I[I.length-1].size(this.resolveDataElementOptions(I.length-1));return Math.max(C,t,l)/2}}_g(gl,"id","scatter"),_g(gl,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),_g(gl,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var Il=Object.freeze({__proto__:null,BarController:Tt,BubbleController:jt,DoughnutController:Pt,LineController:Ot,PieController:qt,PolarAreaController:_t,RadarController:$t,ScatterController:gl});function el(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Cl{static override(g){Object.assign(Cl.prototype,g)}constructor(g){_g(this,"options",void 0),this.options=g||{}}init(){}formats(){return el()}parse(){return el()}format(){return el()}add(){return el()}diff(){return el()}startOf(){return el()}endOf(){return el()}}var tl=Cl;function ll(g,I,e,C){const{controller:t,data:l,_sorted:n}=g,o=t._cachedMeta.iScale;if(o&&I===o.axis&&"r"!==I&&n&&l.length){const g=o._reversePixels?Xe:Se;if(!C)return g(l,I,e);if(t._sharedOptions){const C=l[0],t="function"===typeof C.getRange&&C.getRange(I);if(t){const C=g(l,I,e-t),n=g(l,I,e+t);return{lo:C.lo,hi:n.hi}}}}return{lo:0,hi:l.length-1}}function nl(g,I,e,C,t){const l=g.getSortedVisibleDatasetMetas(),n=e[I];for(let o=0,a=l.length;o<a;++o){const{index:g,data:e}=l[o],{lo:a,hi:i}=ll(l[o],I,n,t);for(let I=a;I<=i;++I){const t=e[I];t.skip||C(t,g,I)}}}function ol(g,I,e,C,t){const l=[];if(!t&&!g.isPointInArea(I))return l;return nl(g,e,I,(function(e,n,o){(t||aC(e,g.chartArea,0))&&e.inRange(I.x,I.y,C)&&l.push({element:e,datasetIndex:n,index:o})}),!0),l}function al(g,I,e,C,t,l){let n=[];const o=function(g){const I=-1!==g.indexOf("x"),e=-1!==g.indexOf("y");return function(g,C){const t=I?Math.abs(g.x-C.x):0,l=e?Math.abs(g.y-C.y):0;return Math.sqrt(Math.pow(t,2)+Math.pow(l,2))}}(e);let a=Number.POSITIVE_INFINITY;return nl(g,e,I,(function(e,i,A){const c=e.inRange(I.x,I.y,t);if(C&&!c)return;const s=e.getCenterPoint(t);if(!(!!l||g.isPointInArea(s))&&!c)return;const d=o(I,s);d<a?(n=[{element:e,datasetIndex:i,index:A}],a=d):d===a&&n.push({element:e,datasetIndex:i,index:A})})),n}function il(g,I,e,C,t,l){return l||g.isPointInArea(I)?"r"!==e||C?al(g,I,e,C,t,l):function(g,I,e,C){let t=[];return nl(g,e,I,(function(g,e,l){const{startAngle:n,endAngle:o}=g.getProps(["startAngle","endAngle"],C),{angle:a}=Ze(g,{x:I.x,y:I.y});ye(a,n,o)&&t.push({element:g,datasetIndex:e,index:l})})),t}(g,I,e,t):[]}function Al(g,I,e,C,t){const l=[],n="x"===e?"inXRange":"inYRange";let o=!1;return nl(g,e,I,((g,C,a)=>{g[n](I[e],t)&&(l.push({element:g,datasetIndex:C,index:a}),o=o||g.inRange(I.x,I.y,t))})),C&&!o?[]:l}var cl={evaluateInteractionItems:nl,modes:{index(g,I,e,C){const t=et(I,g),l=e.axis||"x",n=e.includeInvisible||!1,o=e.intersect?ol(g,t,l,C,n):il(g,t,l,!1,C,n),a=[];return o.length?(g.getSortedVisibleDatasetMetas().forEach((g=>{const I=o[0].index,e=g.data[I];e&&!e.skip&&a.push({element:e,datasetIndex:g.index,index:I})})),a):[]},dataset(g,I,e,C){const t=et(I,g),l=e.axis||"xy",n=e.includeInvisible||!1;let o=e.intersect?ol(g,t,l,C,n):il(g,t,l,!1,C,n);if(o.length>0){const I=o[0].datasetIndex,e=g.getDatasetMeta(I).data;o=[];for(let g=0;g<e.length;++g)o.push({element:e[g],datasetIndex:I,index:g})}return o},point:(g,I,e,C)=>ol(g,et(I,g),e.axis||"xy",C,e.includeInvisible||!1),nearest(g,I,e,C){const t=et(I,g),l=e.axis||"xy",n=e.includeInvisible||!1;return il(g,t,l,e.intersect,C,n)},x:(g,I,e,C)=>Al(g,et(I,g),"x",e.intersect,C),y:(g,I,e,C)=>Al(g,et(I,g),"y",e.intersect,C)}};const sl=["left","top","right","bottom"];function dl(g,I){return g.filter((g=>g.pos===I))}function rl(g,I){return g.filter((g=>-1===sl.indexOf(g.pos)&&g.box.axis===I))}function bl(g,I){return g.sort(((g,e)=>{const C=I?e:g,t=I?g:e;return C.weight===t.weight?C.index-t.index:C.weight-t.weight}))}function ul(g,I){const e=function(g){const I={};for(const e of g){const{stack:g,pos:C,stackWeight:t}=e;if(!g||!sl.includes(C))continue;const l=I[g]||(I[g]={count:0,placed:0,weight:0,size:0});l.count++,l.weight+=t}return I}(g),{vBoxMaxWidth:C,hBoxMaxHeight:t}=I;let l,n,o;for(l=0,n=g.length;l<n;++l){o=g[l];const{fullSize:n}=o.box,a=e[o.stack],i=a&&o.stackWeight/a.weight;o.horizontal?(o.width=i?i*C:n&&I.availableWidth,o.height=t):(o.width=C,o.height=i?i*t:n&&I.availableHeight)}return e}function ml(g,I,e,C){return Math.max(g[e],I[e])+Math.max(g[C],I[C])}function Zl(g,I){g.top=Math.max(g.top,I.top),g.left=Math.max(g.left,I.left),g.bottom=Math.max(g.bottom,I.bottom),g.right=Math.max(g.right,I.right)}function hl(g,I,e,C){const{pos:t,box:l}=e,n=g.maxPadding;if(!wI(t)){e.size&&(g[t]-=e.size);const I=C[e.stack]||{size:0,count:1};I.size=Math.max(I.size,e.horizontal?l.height:l.width),e.size=I.size/I.count,g[t]+=e.size}l.getPadding&&Zl(n,l.getPadding());const o=Math.max(0,I.outerWidth-ml(n,g,"left","right")),a=Math.max(0,I.outerHeight-ml(n,g,"top","bottom")),i=o!==g.w,A=a!==g.h;return g.w=o,g.h=a,e.horizontal?{same:i,other:A}:{same:A,other:i}}function Gl(g,I){const e=I.maxPadding;function C(g){const C={left:0,top:0,right:0,bottom:0};return g.forEach((g=>{C[g]=Math.max(I[g],e[g])})),C}return C(g?["left","right"]:["top","bottom"])}function Bl(g,I,e,C){const t=[];let l,n,o,a,i,A;for(l=0,n=g.length,i=0;l<n;++l){o=g[l],a=o.box,a.update(o.width||I.w,o.height||I.h,Gl(o.horizontal,I));const{same:n,other:c}=hl(I,e,o,C);i|=n&&t.length,A=A||c,a.fullSize||t.push(o)}return i&&Bl(t,I,e,C)||A}function yl(g,I,e,C,t){g.top=e,g.left=I,g.right=I+C,g.bottom=e+t,g.width=C,g.height=t}function pl(g,I,e,C){const t=e.padding;let{x:l,y:n}=I;for(const o of g){const g=o.box,a=C[o.stack]||{count:1,placed:0,weight:1},i=o.stackWeight/a.weight||1;if(o.horizontal){const C=I.w*i,l=a.size||g.height;qI(a.start)&&(n=a.start),g.fullSize?yl(g,t.left,n,e.outerWidth-t.right-t.left,l):yl(g,I.left+a.placed,n,C,l),a.start=n,a.placed+=C,n=g.bottom}else{const C=I.h*i,n=a.size||g.width;qI(a.start)&&(l=a.start),g.fullSize?yl(g,l,t.top,n,e.outerHeight-t.bottom-t.top):yl(g,l,I.top+a.placed,n,C),a.start=l,a.placed+=C,l=g.right}}I.x=l,I.y=n}var Wl={addBox(g,I){g.boxes||(g.boxes=[]),I.fullSize=I.fullSize||!1,I.position=I.position||"top",I.weight=I.weight||0,I._layers=I._layers||function(){return[{z:0,draw(g){I.draw(g)}}]},g.boxes.push(I)},removeBox(g,I){const e=g.boxes?g.boxes.indexOf(I):-1;-1!==e&&g.boxes.splice(e,1)},configure(g,I,e){I.fullSize=e.fullSize,I.position=e.position,I.weight=e.weight},update(g,I,e,C){if(!g)return;const t=WC(g.options.layout.padding),l=Math.max(I-t.width,0),n=Math.max(e-t.height,0),o=function(g){const I=function(g){const I=[];let e,C,t,l,n,o;for(e=0,C=(g||[]).length;e<C;++e)t=g[e],({position:l,options:{stack:n,stackWeight:o=1}}=t),I.push({index:e,box:t,pos:l,horizontal:t.isHorizontal(),weight:t.weight,stack:n&&l+n,stackWeight:o});return I}(g),e=bl(I.filter((g=>g.box.fullSize)),!0),C=bl(dl(I,"left"),!0),t=bl(dl(I,"right")),l=bl(dl(I,"top"),!0),n=bl(dl(I,"bottom")),o=rl(I,"x"),a=rl(I,"y");return{fullSize:e,leftAndTop:C.concat(l),rightAndBottom:t.concat(a).concat(n).concat(o),chartArea:dl(I,"chartArea"),vertical:C.concat(t).concat(a),horizontal:l.concat(n).concat(o)}}(g.boxes),a=o.vertical,i=o.horizontal;MI(g.boxes,(g=>{"function"===typeof g.beforeLayout&&g.beforeLayout()}));const A=a.reduce(((g,I)=>I.box.options&&!1===I.box.options.display?g:g+1),0)||1,c=Object.freeze({outerWidth:I,outerHeight:e,padding:t,availableWidth:l,availableHeight:n,vBoxMaxWidth:l/2/A,hBoxMaxHeight:n/2}),s=Object.assign({},t);Zl(s,WC(C));const d=Object.assign({maxPadding:s,w:l,h:n,x:t.left,y:t.top},t),r=ul(a.concat(i),c);Bl(o.fullSize,d,c,r),Bl(a,d,c,r),Bl(i,d,c,r)&&Bl(a,d,c,r),function(g){const I=g.maxPadding;function e(e){const C=Math.max(I[e]-g[e],0);return g[e]+=C,C}g.y+=e("top"),g.x+=e("left"),e("right"),e("bottom")}(d),pl(o.leftAndTop,d,c,r),d.x+=d.w,d.y+=d.h,pl(o.rightAndBottom,d,c,r),g.chartArea={left:d.left,top:d.top,right:d.left+d.w,bottom:d.top+d.h,height:d.h,width:d.w},MI(o.chartArea,(I=>{const e=I.box;Object.assign(e,g.chartArea),e.update(d.w,d.h,{left:0,top:0,right:0,bottom:0})}))}};class Vl{acquireContext(g,I){}releaseContext(g){return!1}addEventListener(g,I,e){}removeEventListener(g,I,e){}getDevicePixelRatio(){return 1}getMaximumSize(g,I,e,C){return I=Math.max(0,I||g.width),e=e||g.height,{width:I,height:Math.max(0,C?Math.floor(I/C):e)}}isAttached(g){return!0}updateConfig(g){}}class Sl extends Vl{acquireContext(g){return g&&g.getContext&&g.getContext("2d")||null}updateConfig(g){g.options.animation=!1}}const Xl="$chartjs",Rl={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Jl=g=>null===g||""===g;const kl=!!nt&&{passive:!0};function Yl(g,I,e){g.canvas.removeEventListener(I,e,kl)}function fl(g,I){for(const e of g)if(e===I||e.contains(I))return!0}function vl(g,I,e){const C=g.canvas,t=new MutationObserver((g=>{let I=!1;for(const e of g)I=I||fl(e.addedNodes,C),I=I&&!fl(e.removedNodes,C);I&&e()}));return t.observe(document,{childList:!0,subtree:!0}),t}function Hl(g,I,e){const C=g.canvas,t=new MutationObserver((g=>{let I=!1;for(const e of g)I=I||fl(e.removedNodes,C),I=I&&!fl(e.addedNodes,C);I&&e()}));return t.observe(document,{childList:!0,subtree:!0}),t}const wl=new Map;let Nl=0;function Kl(){const g=window.devicePixelRatio;g!==Nl&&(Nl=g,wl.forEach(((I,e)=>{e.currentDevicePixelRatio!==g&&I()})))}function Fl(g,I,e){const C=g.canvas,t=C&&OC(C);if(!t)return;const l=fe(((g,I)=>{const C=t.clientWidth;e(g,I),C<t.clientWidth&&e()}),window),n=new ResizeObserver((g=>{const I=g[0],e=I.contentRect.width,C=I.contentRect.height;0===e&&0===C||l(e,C)}));return n.observe(t),function(g,I){wl.size||window.addEventListener("resize",Kl),wl.set(g,I)}(g,l),n}function xl(g,I,e){e&&e.disconnect(),"resize"===I&&function(g){wl.delete(g),wl.size||window.removeEventListener("resize",Kl)}(g)}function zl(g,I,e){const C=g.canvas,t=fe((I=>{null!==g.ctx&&e(function(g,I){const e=Rl[g.type]||g.type,{x:C,y:t}=et(g,I);return{type:e,chart:I,native:g,x:void 0!==C?C:null,y:void 0!==t?t:null}}(I,g))}),g);return function(g,I,e){g.addEventListener(I,e,kl)}(C,I,t),t}class Ml extends Vl{acquireContext(g,I){const e=g&&g.getContext&&g.getContext("2d");return e&&e.canvas===g?(function(g,I){const e=g.style,C=g.getAttribute("height"),t=g.getAttribute("width");if(g[Xl]={initial:{height:C,width:t,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",Jl(t)){const I=ot(g,"width");void 0!==I&&(g.width=I)}if(Jl(C))if(""===g.style.height)g.height=g.width/(I||2);else{const I=ot(g,"height");void 0!==I&&(g.height=I)}}(g,I),e):null}releaseContext(g){const I=g.canvas;if(!I[Xl])return!1;const e=I[Xl].initial;["height","width"].forEach((g=>{const C=e[g];vI(C)?I.removeAttribute(g):I.setAttribute(g,C)}));const C=e.style||{};return Object.keys(C).forEach((g=>{I.style[g]=C[g]})),I.width=I.width,delete I[Xl],!0}addEventListener(g,I,e){this.removeEventListener(g,I);const C=g.$proxies||(g.$proxies={}),t={attach:vl,detach:Hl,resize:Fl}[I]||zl;C[I]=t(g,I,e)}removeEventListener(g,I){const e=g.$proxies||(g.$proxies={}),C=e[I];if(!C)return;({attach:xl,detach:xl,resize:xl}[I]||Yl)(g,I,C),e[I]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(g,I,e,C){return tt(g,I,e,C)}isAttached(g){const I=OC(g);return!(!I||!I.isConnected)}}class El{constructor(){_g(this,"x",void 0),_g(this,"y",void 0),_g(this,"active",!1),_g(this,"options",void 0),_g(this,"$animations",void 0)}tooltipPosition(g){const{x:I,y:e}=this.getProps(["x","y"],g);return{x:I,y:e}}hasValue(){return de(this.x)&&de(this.y)}getProps(g,I){const e=this.$animations;if(!I||!e)return this;const C={};return g.forEach((g=>{C[g]=e[g]&&e[g].active()?e[g]._to:this[g]})),C}}function Ql(g,I){const e=g.options.ticks,C=function(g){const I=g.options.offset,e=g._tickSize(),C=g._length/e+(I?0:1),t=g._maxLength/e;return Math.floor(Math.min(C,t))}(g),t=Math.min(e.maxTicksLimit||C,C),l=e.major.enabled?function(g){const I=[];let e,C;for(e=0,C=g.length;e<C;e++)g[e].major&&I.push(e);return I}(I):[],n=l.length,o=l[0],a=l[n-1],i=[];if(n>t)return function(g,I,e,C){let t,l=0,n=e[0];for(C=Math.ceil(C),t=0;t<g.length;t++)t===n&&(I.push(g[t]),l++,n=e[l*C])}(I,i,l,n/t),i;const A=function(g,I,e){const C=function(g){const I=g.length;let e,C;if(I<2)return!1;for(C=g[0],e=1;e<I;++e)if(g[e]-g[e-1]!==C)return!1;return C}(g),t=I.length/e;if(!C)return Math.max(t,1);const l=function(g){const I=[],e=Math.sqrt(g);let C;for(C=1;C<e;C++)g%C===0&&(I.push(C),I.push(g/C));return e===(0|e)&&I.push(e),I.sort(((g,I)=>g-I)).pop(),I}(C);for(let n=0,o=l.length-1;n<o;n++){const g=l[n];if(g>t)return g}return Math.max(t,1)}(l,I,t);if(n>0){let g,e;const C=n>1?Math.round((a-o)/(n-1)):null;for(Ul(I,i,A,vI(C)?0:o-C,o),g=0,e=n-1;g<e;g++)Ul(I,i,A,l[g],l[g+1]);return Ul(I,i,A,a,vI(C)?I.length:a+C),i}return Ul(I,i,A),i}function Ul(g,I,e,C,t){const l=FI(C,0),n=Math.min(FI(t,g.length),g.length);let o,a,i,A=0;for(e=Math.ceil(e),t&&(o=t-C,e=o/Math.floor(o/e)),i=l;i<0;)A++,i=Math.round(l+A*e);for(a=Math.max(l,0);a<n;a++)a===i&&(I.push(g[a]),A++,i=Math.round(l+A*e))}_g(El,"defaults",{}),_g(El,"defaultRoutes",void 0);const Ll=(g,I,e)=>"top"===I||"left"===I?g[I]+e:g[I]-e,Dl=(g,I)=>Math.min(I||g,g);function Tl(g,I){const e=[],C=g.length/I,t=g.length;let l=0;for(;l<t;l+=C)e.push(g[Math.floor(l)]);return e}function jl(g,I,e){const C=g.ticks.length,t=Math.min(I,C-1),l=g._startPixel,n=g._endPixel,o=1e-6;let a,i=g.getPixelForTick(t);if(!(e&&(a=1===C?Math.max(i-l,n-i):0===I?(g.getPixelForTick(1)-i)/2:(i-g.getPixelForTick(t-1))/2,i+=t<I?a:-a,i<l-o||i>n+o)))return i}function Pl(g){return g.drawTicks?g.tickLength:0}function Ol(g,I){if(!g.display)return 0;const e=VC(g.font,I),C=WC(g.padding);return(HI(g.text)?g.text.length:1)*e.lineHeight+C.height}function _l(g,I,e){let C=ve(g);return(e&&"right"!==I||!e&&"right"===I)&&(C=(g=>"left"===g?"right":"right"===g?"left":g)(C)),C}class ql extends El{constructor(g){super(),this.id=g.id,this.type=g.type,this.options=void 0,this.ctx=g.ctx,this.chart=g.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(g){this.options=g.setContext(this.getContext()),this.axis=g.axis,this._userMin=this.parse(g.min),this._userMax=this.parse(g.max),this._suggestedMin=this.parse(g.suggestedMin),this._suggestedMax=this.parse(g.suggestedMax)}parse(g,I){return g}getUserBounds(){let{_userMin:g,_userMax:I,_suggestedMin:e,_suggestedMax:C}=this;return g=KI(g,Number.POSITIVE_INFINITY),I=KI(I,Number.NEGATIVE_INFINITY),e=KI(e,Number.POSITIVE_INFINITY),C=KI(C,Number.NEGATIVE_INFINITY),{min:KI(g,e),max:KI(I,C),minDefined:NI(g),maxDefined:NI(I)}}getMinMax(g){let I,{min:e,max:C,minDefined:t,maxDefined:l}=this.getUserBounds();if(t&&l)return{min:e,max:C};const n=this.getMatchingVisibleMetas();for(let o=0,a=n.length;o<a;++o)I=n[o].controller.getMinMax(this,g),t||(e=Math.min(e,I.min)),l||(C=Math.max(C,I.max));return e=l&&e>C?C:e,C=t&&e>C?e:C,{min:KI(e,KI(C,e)),max:KI(C,KI(e,C))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const g=this.chart.data;return this.options.labels||(this.isHorizontal()?g.xLabels:g.yLabels)||g.labels||[]}getLabelItems(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.chart.chartArea;return this._labelItems||(this._labelItems=this._computeLabelItems(g))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){zI(this.options.beforeUpdate,[this])}update(g,I,e){const{beginAtZero:C,grace:t,ticks:l}=this.options,n=l.sampleSize;this.beforeUpdate(),this.maxWidth=g,this.maxHeight=I,this._margins=e=Object.assign({left:0,right:0,top:0,bottom:0},e),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+e.left+e.right:this.height+e.top+e.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(g,I,e){const{min:C,max:t}=g,l=xI(I,(t-C)/2),n=(g,I)=>e&&0===g?0:g+I;return{min:n(C,-Math.abs(l)),max:n(t,l)}}(this,t,C),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const o=n<this.ticks.length;this._convertTicksToLabels(o?Tl(this.ticks,n):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),l.display&&(l.autoSkip||"auto"===l.source)&&(this.ticks=Ql(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),o&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let g,I,e=this.options.reverse;this.isHorizontal()?(g=this.left,I=this.right):(g=this.top,I=this.bottom,e=!e),this._startPixel=g,this._endPixel=I,this._reversePixels=e,this._length=I-g,this._alignToPixels=this.options.alignToPixels}afterUpdate(){zI(this.options.afterUpdate,[this])}beforeSetDimensions(){zI(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){zI(this.options.afterSetDimensions,[this])}_callHooks(g){this.chart.notifyPlugins(g,this.getContext()),zI(this.options[g],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){zI(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(g){const I=this.options.ticks;let e,C,t;for(e=0,C=g.length;e<C;e++)t=g[e],t.label=zI(I.callback,[t.value,e,g],this)}afterTickToLabelConversion(){zI(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){zI(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const g=this.options,I=g.ticks,e=Dl(this.ticks.length,g.ticks.maxTicksLimit),C=I.minRotation||0,t=I.maxRotation;let l,n,o,a=C;if(!this._isVisible()||!I.display||C>=t||e<=1||!this.isHorizontal())return void(this.labelRotation=C);const i=this._getLabelSizes(),A=i.widest.width,c=i.highest.height,s=pe(this.chart.width-A,0,this.maxWidth);l=g.offset?this.maxWidth/e:s/(e-1),A+6>l&&(l=s/(e-(g.offset?.5:1)),n=this.maxHeight-Pl(g.grid)-I.padding-Ol(g.title,this.chart.options.font),o=Math.sqrt(A*A+c*c),a=ue(Math.min(Math.asin(pe((i.highest.height+6)/l,-1,1)),Math.asin(pe(n/o,-1,1))-Math.asin(pe(c/o,-1,1)))),a=Math.max(C,Math.min(t,a))),this.labelRotation=a}afterCalculateLabelRotation(){zI(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){zI(this.options.beforeFit,[this])}fit(){const g={width:0,height:0},{chart:I,options:{ticks:e,title:C,grid:t}}=this,l=this._isVisible(),n=this.isHorizontal();if(l){const l=Ol(C,I.options.font);if(n?(g.width=this.maxWidth,g.height=Pl(t)+l):(g.height=this.maxHeight,g.width=Pl(t)+l),e.display&&this.ticks.length){const{first:I,last:C,widest:t,highest:l}=this._getLabelSizes(),o=2*e.padding,a=be(this.labelRotation),i=Math.cos(a),A=Math.sin(a);if(n){const I=e.mirror?0:A*t.width+i*l.height;g.height=Math.min(this.maxHeight,g.height+I+o)}else{const I=e.mirror?0:i*t.width+A*l.height;g.width=Math.min(this.maxWidth,g.width+I+o)}this._calculatePadding(I,C,A,i)}}this._handleMargins(),n?(this.width=this._length=I.width-this._margins.left-this._margins.right,this.height=g.height):(this.width=g.width,this.height=this._length=I.height-this._margins.top-this._margins.bottom)}_calculatePadding(g,I,e,C){const{ticks:{align:t,padding:l},position:n}=this.options,o=0!==this.labelRotation,a="top"!==n&&"x"===this.axis;if(this.isHorizontal()){const n=this.getPixelForTick(0)-this.left,i=this.right-this.getPixelForTick(this.ticks.length-1);let A=0,c=0;o?a?(A=C*g.width,c=e*I.height):(A=e*g.height,c=C*I.width):"start"===t?c=I.width:"end"===t?A=g.width:"inner"!==t&&(A=g.width/2,c=I.width/2),this.paddingLeft=Math.max((A-n+l)*this.width/(this.width-n),0),this.paddingRight=Math.max((c-i+l)*this.width/(this.width-i),0)}else{let e=I.height/2,C=g.height/2;"start"===t?(e=0,C=g.height):"end"===t&&(e=I.height,C=0),this.paddingTop=e+l,this.paddingBottom=C+l}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){zI(this.options.afterFit,[this])}isHorizontal(){const{axis:g,position:I}=this.options;return"top"===I||"bottom"===I||"x"===g}isFullSize(){return this.options.fullSize}_convertTicksToLabels(g){let I,e;for(this.beforeTickToLabelConversion(),this.generateTickLabels(g),I=0,e=g.length;I<e;I++)vI(g[I].label)&&(g.splice(I,1),e--,I--);this.afterTickToLabelConversion()}_getLabelSizes(){let g=this._labelSizes;if(!g){const I=this.options.ticks.sampleSize;let e=this.ticks;I<e.length&&(e=Tl(e,I)),this._labelSizes=g=this._computeLabelSizes(e,e.length,this.options.ticks.maxTicksLimit)}return g}_computeLabelSizes(g,I,e){const{ctx:C,_longestTextCache:t}=this,l=[],n=[],o=Math.floor(I/Dl(I,e));let a,i,A,c,s,d,r,b,u,m,Z,h=0,G=0;for(a=0;a<I;a+=o){if(c=g[a].label,s=this._resolveTickFontOptions(a),C.font=d=s.string,r=t[d]=t[d]||{data:{},gc:[]},b=s.lineHeight,u=m=0,vI(c)||HI(c)){if(HI(c))for(i=0,A=c.length;i<A;++i)Z=c[i],vI(Z)||HI(Z)||(u=eC(C,r.data,r.gc,u,Z),m+=b)}else u=eC(C,r.data,r.gc,u,c),m=b;l.push(u),n.push(m),h=Math.max(u,h),G=Math.max(m,G)}!function(g,I){MI(g,(g=>{const e=g.gc,C=e.length/2;let t;if(C>I){for(t=0;t<C;++t)delete g.data[e[t]];e.splice(0,C)}}))}(t,I);const B=l.indexOf(h),y=n.indexOf(G),p=g=>({width:l[g]||0,height:n[g]||0});return{first:p(0),last:p(I-1),widest:p(B),highest:p(y),widths:l,heights:n}}getLabelForValue(g){return g}getPixelForValue(g,I){return NaN}getValueForPixel(g){}getPixelForTick(g){const I=this.ticks;return g<0||g>I.length-1?null:this.getPixelForValue(I[g].value)}getPixelForDecimal(g){this._reversePixels&&(g=1-g);const I=this._startPixel+g*this._length;return pe(this._alignToPixels?tC(this.chart,I,0):I,-32768,32767)}getDecimalForPixel(g){const I=(g-this._startPixel)/this._length;return this._reversePixels?1-I:I}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:g,max:I}=this;return g<0&&I<0?I:g>0&&I>0?g:0}getContext(g){const I=this.ticks||[];if(g>=0&&g<I.length){const e=I[g];return e.$context||(e.$context=function(g,I,e){return XC(g,{tick:e,index:I,type:"tick"})}(this.getContext(),g,e))}return this.$context||(this.$context=XC(this.chart.getContext(),{scale:this,type:"scale"}))}_tickSize(){const g=this.options.ticks,I=be(this.labelRotation),e=Math.abs(Math.cos(I)),C=Math.abs(Math.sin(I)),t=this._getLabelSizes(),l=g.autoSkipPadding||0,n=t?t.widest.width+l:0,o=t?t.highest.height+l:0;return this.isHorizontal()?o*e>n*C?n/e:o/C:o*C<n*e?o/e:n/C}_isVisible(){const g=this.options.display;return"auto"!==g?!!g:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(g){const I=this.axis,e=this.chart,C=this.options,{grid:t,position:l,border:n}=C,o=t.offset,a=this.isHorizontal(),i=this.ticks.length+(o?1:0),A=Pl(t),c=[],s=n.setContext(this.getContext()),d=s.display?s.width:0,r=d/2,b=function(g){return tC(e,g,d)};let u,m,Z,h,G,B,y,p,W,V,S,X;if("top"===l)u=b(this.bottom),B=this.bottom-A,p=u-r,V=b(g.top)+r,X=g.bottom;else if("bottom"===l)u=b(this.top),V=g.top,X=b(g.bottom)-r,B=u+r,p=this.top+A;else if("left"===l)u=b(this.right),G=this.right-A,y=u-r,W=b(g.left)+r,S=g.right;else if("right"===l)u=b(this.left),W=g.left,S=b(g.right)-r,G=u+r,y=this.left+A;else if("x"===I){if("center"===l)u=b((g.top+g.bottom)/2+.5);else if(wI(l)){const g=Object.keys(l)[0],I=l[g];u=b(this.chart.scales[g].getPixelForValue(I))}V=g.top,X=g.bottom,B=u+r,p=B+A}else if("y"===I){if("center"===l)u=b((g.left+g.right)/2);else if(wI(l)){const g=Object.keys(l)[0],I=l[g];u=b(this.chart.scales[g].getPixelForValue(I))}G=u-r,y=G-A,W=g.left,S=g.right}const R=FI(C.ticks.maxTicksLimit,i),J=Math.max(1,Math.ceil(i/R));for(m=0;m<i;m+=J){const g=this.getContext(m),I=t.setContext(g),C=n.setContext(g),l=I.lineWidth,i=I.color,A=C.dash||[],s=C.dashOffset,d=I.tickWidth,r=I.tickColor,b=I.tickBorderDash||[],u=I.tickBorderDashOffset;Z=jl(this,m,o),void 0!==Z&&(h=tC(e,Z,l),a?G=y=W=S=h:B=p=V=X=h,c.push({tx1:G,ty1:B,tx2:y,ty2:p,x1:W,y1:V,x2:S,y2:X,width:l,color:i,borderDash:A,borderDashOffset:s,tickWidth:d,tickColor:r,tickBorderDash:b,tickBorderDashOffset:u}))}return this._ticksLength=i,this._borderValue=u,c}_computeLabelItems(g){const I=this.axis,e=this.options,{position:C,ticks:t}=e,l=this.isHorizontal(),n=this.ticks,{align:o,crossAlign:a,padding:i,mirror:A}=t,c=Pl(e.grid),s=c+i,d=A?-i:s,r=-be(this.labelRotation),b=[];let u,m,Z,h,G,B,y,p,W,V,S,X,R="middle";if("top"===C)B=this.bottom-d,y=this._getXAxisLabelAlignment();else if("bottom"===C)B=this.top+d,y=this._getXAxisLabelAlignment();else if("left"===C){const g=this._getYAxisLabelAlignment(c);y=g.textAlign,G=g.x}else if("right"===C){const g=this._getYAxisLabelAlignment(c);y=g.textAlign,G=g.x}else if("x"===I){if("center"===C)B=(g.top+g.bottom)/2+s;else if(wI(C)){const g=Object.keys(C)[0],I=C[g];B=this.chart.scales[g].getPixelForValue(I)+s}y=this._getXAxisLabelAlignment()}else if("y"===I){if("center"===C)G=(g.left+g.right)/2-s;else if(wI(C)){const g=Object.keys(C)[0],I=C[g];G=this.chart.scales[g].getPixelForValue(I)}y=this._getYAxisLabelAlignment(c).textAlign}"y"===I&&("start"===o?R="top":"end"===o&&(R="bottom"));const J=this._getLabelSizes();for(u=0,m=n.length;u<m;++u){Z=n[u],h=Z.label;const g=t.setContext(this.getContext(u));p=this.getPixelForTick(u)+t.labelOffset,W=this._resolveTickFontOptions(u),V=W.lineHeight,S=HI(h)?h.length:1;const I=S/2,e=g.color,o=g.textStrokeColor,i=g.textStrokeWidth;let c,s=y;if(l?(G=p,"inner"===y&&(s=u===m-1?this.options.reverse?"left":"right":0===u?this.options.reverse?"right":"left":"center"),X="top"===C?"near"===a||0!==r?-S*V+V/2:"center"===a?-J.highest.height/2-I*V+V:-J.highest.height+V/2:"near"===a||0!==r?V/2:"center"===a?J.highest.height/2-I*V:J.highest.height-S*V,A&&(X*=-1),0===r||g.showLabelBackdrop||(G+=V/2*Math.sin(r))):(B=p,X=(1-S)*V/2),g.showLabelBackdrop){const I=WC(g.backdropPadding),e=J.heights[u],C=J.widths[u];let t=X-I.top,l=0-I.left;switch(R){case"middle":t-=e/2;break;case"bottom":t-=e}switch(y){case"center":l-=C/2;break;case"right":l-=C;break;case"inner":u===m-1?l-=C:u>0&&(l-=C/2)}c={left:l,top:t,width:C+I.width,height:e+I.height,color:g.backdropColor}}b.push({label:h,font:W,textOffset:X,options:{rotation:r,color:e,strokeColor:o,strokeWidth:i,textAlign:s,textBaseline:R,translation:[G,B],backdrop:c}})}return b}_getXAxisLabelAlignment(){const{position:g,ticks:I}=this.options;if(-be(this.labelRotation))return"top"===g?"left":"right";let e="center";return"start"===I.align?e="left":"end"===I.align?e="right":"inner"===I.align&&(e="inner"),e}_getYAxisLabelAlignment(g){const{position:I,ticks:{crossAlign:e,mirror:C,padding:t}}=this.options,l=g+t,n=this._getLabelSizes().widest.width;let o,a;return"left"===I?C?(a=this.right+t,"near"===e?o="left":"center"===e?(o="center",a+=n/2):(o="right",a+=n)):(a=this.right-l,"near"===e?o="right":"center"===e?(o="center",a-=n/2):(o="left",a=this.left)):"right"===I?C?(a=this.left+t,"near"===e?o="right":"center"===e?(o="center",a-=n/2):(o="left",a-=n)):(a=this.left+l,"near"===e?o="left":"center"===e?(o="center",a+=n/2):(o="right",a=this.right)):o="right",{textAlign:o,x:a}}_computeLabelArea(){if(this.options.ticks.mirror)return;const g=this.chart,I=this.options.position;return"left"===I||"right"===I?{top:0,left:this.left,bottom:g.height,right:this.right}:"top"===I||"bottom"===I?{top:this.top,left:0,bottom:this.bottom,right:g.width}:void 0}drawBackground(){const{ctx:g,options:{backgroundColor:I},left:e,top:C,width:t,height:l}=this;I&&(g.save(),g.fillStyle=I,g.fillRect(e,C,t,l),g.restore())}getLineWidthForValue(g){const I=this.options.grid;if(!this._isVisible()||!I.display)return 0;const e=this.ticks.findIndex((I=>I.value===g));if(e>=0){return I.setContext(this.getContext(e)).lineWidth}return 0}drawGrid(g){const I=this.options.grid,e=this.ctx,C=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(g));let t,l;const n=(g,I,C)=>{C.width&&C.color&&(e.save(),e.lineWidth=C.width,e.strokeStyle=C.color,e.setLineDash(C.borderDash||[]),e.lineDashOffset=C.borderDashOffset,e.beginPath(),e.moveTo(g.x,g.y),e.lineTo(I.x,I.y),e.stroke(),e.restore())};if(I.display)for(t=0,l=C.length;t<l;++t){const g=C[t];I.drawOnChartArea&&n({x:g.x1,y:g.y1},{x:g.x2,y:g.y2},g),I.drawTicks&&n({x:g.tx1,y:g.ty1},{x:g.tx2,y:g.ty2},{color:g.tickColor,width:g.tickWidth,borderDash:g.tickBorderDash,borderDashOffset:g.tickBorderDashOffset})}}drawBorder(){const{chart:g,ctx:I,options:{border:e,grid:C}}=this,t=e.setContext(this.getContext()),l=e.display?t.width:0;if(!l)return;const n=C.setContext(this.getContext(0)).lineWidth,o=this._borderValue;let a,i,A,c;this.isHorizontal()?(a=tC(g,this.left,l)-l/2,i=tC(g,this.right,n)+n/2,A=c=o):(A=tC(g,this.top,l)-l/2,c=tC(g,this.bottom,n)+n/2,a=i=o),I.save(),I.lineWidth=t.width,I.strokeStyle=t.color,I.beginPath(),I.moveTo(a,A),I.lineTo(i,c),I.stroke(),I.restore()}drawLabels(g){if(!this.options.ticks.display)return;const I=this.ctx,e=this._computeLabelArea();e&&iC(I,e);const C=this.getLabelItems(g);for(const t of C){const g=t.options,e=t.font;bC(I,t.label,0,t.textOffset,e,g)}e&&AC(I)}drawTitle(){const{ctx:g,options:{position:I,title:e,reverse:C}}=this;if(!e.display)return;const t=VC(e.font),l=WC(e.padding),n=e.align;let o=t.lineHeight/2;"bottom"===I||"center"===I||wI(I)?(o+=l.bottom,HI(e.text)&&(o+=t.lineHeight*(e.text.length-1))):o+=l.top;const{titleX:a,titleY:i,maxWidth:A,rotation:c}=function(g,I,e,C){const{top:t,left:l,bottom:n,right:o,chart:a}=g,{chartArea:i,scales:A}=a;let c,s,d,r=0;const b=n-t,u=o-l;if(g.isHorizontal()){if(s=He(C,l,o),wI(e)){const g=Object.keys(e)[0],C=e[g];d=A[g].getPixelForValue(C)+b-I}else d="center"===e?(i.bottom+i.top)/2+b-I:Ll(g,e,I);c=o-l}else{if(wI(e)){const g=Object.keys(e)[0],C=e[g];s=A[g].getPixelForValue(C)-u+I}else s="center"===e?(i.left+i.right)/2-u+I:Ll(g,e,I);d=He(C,n,t),r="left"===e?-ne:ne}return{titleX:s,titleY:d,maxWidth:c,rotation:r}}(this,o,I,n);bC(g,e.text,0,0,t,{color:e.color,maxWidth:A,rotation:c,textAlign:_l(n,I,C),textBaseline:"middle",translation:[a,i]})}draw(g){this._isVisible()&&(this.drawBackground(),this.drawGrid(g),this.drawBorder(),this.drawTitle(),this.drawLabels(g))}_layers(){const g=this.options,I=g.ticks&&g.ticks.z||0,e=FI(g.grid&&g.grid.z,-1),C=FI(g.border&&g.border.z,0);return this._isVisible()&&this.draw===ql.prototype.draw?[{z:e,draw:g=>{this.drawBackground(),this.drawGrid(g),this.drawTitle()}},{z:C,draw:()=>{this.drawBorder()}},{z:I,draw:g=>{this.drawLabels(g)}}]:[{z:I,draw:g=>{this.draw(g)}}]}getMatchingVisibleMetas(g){const I=this.chart.getSortedVisibleDatasetMetas(),e=this.axis+"AxisID",C=[];let t,l;for(t=0,l=I.length;t<l;++t){const l=I[t];l[e]!==this.id||g&&l.type!==g||C.push(l)}return C}_resolveTickFontOptions(g){return VC(this.options.ticks.setContext(this.getContext(g)).font)}_maxDigits(){const g=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/g}}class $l{constructor(g,I,e){this.type=g,this.scope=I,this.override=e,this.items=Object.create(null)}isForType(g){return Object.prototype.isPrototypeOf.call(this.type.prototype,g.prototype)}register(g){const I=Object.getPrototypeOf(g);let e;(function(g){return"id"in g&&"defaults"in g})(I)&&(e=this.register(I));const C=this.items,t=g.id,l=this.scope+"."+t;if(!t)throw new Error("class does not have id: "+g);return t in C||(C[t]=g,function(g,I,e){const C=DI(Object.create(null),[e?IC.get(e):{},IC.get(I),g.defaults]);IC.set(I,C),g.defaultRoutes&&function(g,I){Object.keys(I).forEach((e=>{const C=e.split("."),t=C.pop(),l=[g].concat(C).join("."),n=I[e].split("."),o=n.pop(),a=n.join(".");IC.route(l,t,a,o)}))}(I,g.defaultRoutes);g.descriptors&&IC.describe(I,g.descriptors)}(g,l,e),this.override&&IC.override(g.id,g.overrides)),l}get(g){return this.items[g]}unregister(g){const I=this.items,e=g.id,C=this.scope;e in I&&delete I[e],C&&e in IC[C]&&(delete IC[C][e],this.override&&delete Oe[e])}}class gn{constructor(){this.controllers=new $l(Ft,"datasets",!0),this.elements=new $l(El,"elements"),this.plugins=new $l(Object,"plugins"),this.scales=new $l(ql,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(){for(var g=arguments.length,I=new Array(g),e=0;e<g;e++)I[e]=arguments[e];this._each("register",I)}remove(){for(var g=arguments.length,I=new Array(g),e=0;e<g;e++)I[e]=arguments[e];this._each("unregister",I)}addControllers(){for(var g=arguments.length,I=new Array(g),e=0;e<g;e++)I[e]=arguments[e];this._each("register",I,this.controllers)}addElements(){for(var g=arguments.length,I=new Array(g),e=0;e<g;e++)I[e]=arguments[e];this._each("register",I,this.elements)}addPlugins(){for(var g=arguments.length,I=new Array(g),e=0;e<g;e++)I[e]=arguments[e];this._each("register",I,this.plugins)}addScales(){for(var g=arguments.length,I=new Array(g),e=0;e<g;e++)I[e]=arguments[e];this._each("register",I,this.scales)}getController(g){return this._get(g,this.controllers,"controller")}getElement(g){return this._get(g,this.elements,"element")}getPlugin(g){return this._get(g,this.plugins,"plugin")}getScale(g){return this._get(g,this.scales,"scale")}removeControllers(){for(var g=arguments.length,I=new Array(g),e=0;e<g;e++)I[e]=arguments[e];this._each("unregister",I,this.controllers)}removeElements(){for(var g=arguments.length,I=new Array(g),e=0;e<g;e++)I[e]=arguments[e];this._each("unregister",I,this.elements)}removePlugins(){for(var g=arguments.length,I=new Array(g),e=0;e<g;e++)I[e]=arguments[e];this._each("unregister",I,this.plugins)}removeScales(){for(var g=arguments.length,I=new Array(g),e=0;e<g;e++)I[e]=arguments[e];this._each("unregister",I,this.scales)}_each(g,I,e){[...I].forEach((I=>{const C=e||this._getRegistryForType(I);e||C.isForType(I)||C===this.plugins&&I.id?this._exec(g,C,I):MI(I,(I=>{const C=e||this._getRegistryForType(I);this._exec(g,C,I)}))}))}_exec(g,I,e){const C=_I(g);zI(e["before"+C],[],e),I[g](e),zI(e["after"+C],[],e)}_getRegistryForType(g){for(let I=0;I<this._typedRegistries.length;I++){const e=this._typedRegistries[I];if(e.isForType(g))return e}return this.plugins}_get(g,I,e){const C=I.get(g);if(void 0===C)throw new Error('"'+g+'" is not a registered '+e+".");return C}}var In=new gn;class en{constructor(){this._init=[]}notify(g,I,e,C){"beforeInit"===I&&(this._init=this._createDescriptors(g,!0),this._notify(this._init,g,"install"));const t=C?this._descriptors(g).filter(C):this._descriptors(g),l=this._notify(t,g,I,e);return"afterDestroy"===I&&(this._notify(t,g,"stop"),this._notify(this._init,g,"uninstall")),l}_notify(g,I,e,C){C=C||{};for(const t of g){const g=t.plugin;if(!1===zI(g[e],[I,C,t.options],g)&&C.cancelable)return!1}return!0}invalidate(){vI(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(g){if(this._cache)return this._cache;const I=this._cache=this._createDescriptors(g);return this._notifyStateChanges(g),I}_createDescriptors(g,I){const e=g&&g.config,C=FI(e.options&&e.options.plugins,{}),t=function(g){const I={},e=[],C=Object.keys(In.plugins.items);for(let l=0;l<C.length;l++)e.push(In.getPlugin(C[l]));const t=g.plugins||[];for(let l=0;l<t.length;l++){const g=t[l];-1===e.indexOf(g)&&(e.push(g),I[g.id]=!0)}return{plugins:e,localIds:I}}(e);return!1!==C||I?function(g,I,e,C){let{plugins:t,localIds:l}=I;const n=[],o=g.getContext();for(const a of t){const I=a.id,t=Cn(e[I],C);null!==t&&n.push({plugin:a,options:tn(g.config,{plugin:a,local:l[I]},t,o)})}return n}(g,t,C,I):[]}_notifyStateChanges(g){const I=this._oldCache||[],e=this._cache,C=(g,I)=>g.filter((g=>!I.some((I=>g.plugin.id===I.plugin.id))));this._notify(C(I,e),g,"stop"),this._notify(C(e,I),g,"start")}}function Cn(g,I){return I||!1!==g?!0===g?{}:g:null}function tn(g,I,e,C){let{plugin:t,local:l}=I;const n=g.pluginScopeKeys(t),o=g.getOptionScopes(e,n);return l&&t.defaults&&o.push(t.defaults),g.createResolver(o,C,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function ln(g,I){const e=IC.datasets[g]||{};return((I.datasets||{})[g]||{}).indexAxis||I.indexAxis||e.indexAxis||"x"}function nn(g){if("x"===g||"y"===g||"r"===g)return g}function on(g){if(nn(g))return g;for(var I=arguments.length,e=new Array(I>1?I-1:0),C=1;C<I;C++)e[C-1]=arguments[C];for(const l of e){const I=l.axis||("top"===(t=l.position)||"bottom"===t?"x":"left"===t||"right"===t?"y":void 0)||g.length>1&&nn(g[0].toLowerCase());if(I)return I}var t;throw new Error("Cannot determine type of '".concat(g,"' axis. Please provide 'axis' or 'position' option."))}function an(g,I,e){if(e[I+"AxisID"]===g)return{axis:I}}function An(g,I){const e=Oe[g.type]||{scales:{}},C=I.scales||{},t=ln(g.type,I),l=Object.create(null);return Object.keys(C).forEach((I=>{const n=C[I];if(!wI(n))return console.error("Invalid scale configuration for scale: ".concat(I));if(n._proxy)return console.warn("Ignoring resolver passed as options for scale: ".concat(I));const o=on(I,n,function(g,I){if(I.data&&I.data.datasets){const e=I.data.datasets.filter((I=>I.xAxisID===g||I.yAxisID===g));if(e.length)return an(g,"x",e[0])||an(g,"y",e[0])}return{}}(I,g),IC.scales[n.type]),a=function(g,I){return g===I?"_index_":"_value_"}(o,t),i=e.scales||{};l[I]=TI(Object.create(null),[{axis:o},n,i[o],i[a]])})),g.data.datasets.forEach((e=>{const t=e.type||g.type,n=e.indexAxis||ln(t,I),o=(Oe[t]||{}).scales||{};Object.keys(o).forEach((g=>{const I=function(g,I){let e=g;return"_index_"===g?e=I:"_value_"===g&&(e="x"===I?"y":"x"),e}(g,n),t=e[I+"AxisID"]||I;l[t]=l[t]||Object.create(null),TI(l[t],[{axis:I},C[t],o[g]])}))})),Object.keys(l).forEach((g=>{const I=l[g];TI(I,[IC.scales[I.type],IC.scale])})),l}function cn(g){const I=g.options||(g.options={});I.plugins=FI(I.plugins,{}),I.scales=An(g,I)}function sn(g){return(g=g||{}).datasets=g.datasets||[],g.labels=g.labels||[],g}const dn=new Map,rn=new Set;function bn(g,I){let e=dn.get(g);return e||(e=I(),dn.set(g,e),rn.add(e)),e}const un=(g,I,e)=>{const C=OI(I,e);void 0!==C&&g.add(C)};class mn{constructor(g){this._config=function(g){return(g=g||{}).data=sn(g.data),cn(g),g}(g),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(g){this._config.type=g}get data(){return this._config.data}set data(g){this._config.data=sn(g)}get options(){return this._config.options}set options(g){this._config.options=g}get plugins(){return this._config.plugins}update(){const g=this._config;this.clearCache(),cn(g)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(g){return bn(g,(()=>[["datasets.".concat(g),""]]))}datasetAnimationScopeKeys(g,I){return bn("".concat(g,".transition.").concat(I),(()=>[["datasets.".concat(g,".transitions.").concat(I),"transitions.".concat(I)],["datasets.".concat(g),""]]))}datasetElementScopeKeys(g,I){return bn("".concat(g,"-").concat(I),(()=>[["datasets.".concat(g,".elements.").concat(I),"datasets.".concat(g),"elements.".concat(I),""]]))}pluginScopeKeys(g){const I=g.id,e=this.type;return bn("".concat(e,"-plugin-").concat(I),(()=>[["plugins.".concat(I),...g.additionalOptionScopes||[]]]))}_cachedScopes(g,I){const e=this._scopeCache;let C=e.get(g);return C&&!I||(C=new Map,e.set(g,C)),C}getOptionScopes(g,I,e){const{options:C,type:t}=this,l=this._cachedScopes(g,e),n=l.get(I);if(n)return n;const o=new Set;I.forEach((I=>{g&&(o.add(g),I.forEach((I=>un(o,g,I)))),I.forEach((g=>un(o,C,g))),I.forEach((g=>un(o,Oe[t]||{},g))),I.forEach((g=>un(o,IC,g))),I.forEach((g=>un(o,_e,g)))}));const a=Array.from(o);return 0===a.length&&a.push(Object.create(null)),rn.has(I)&&l.set(I,a),a}chartOptionScopes(){const{options:g,type:I}=this;return[g,Oe[I]||{},IC.datasets[I]||{},{type:I},IC,_e]}resolveNamedOptions(g,I,e){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[""];const t={$shared:!0},{resolver:l,subPrefixes:n}=Zn(this._resolverCache,g,C);let o=l;if(function(g,I){const{isScriptable:e,isIndexable:C}=kC(g);for(const t of I){const I=e(t),l=C(t),n=(l||I)&&g[t];if(I&&($I(n)||hn(n))||l&&HI(n))return!0}return!1}(l,I)){t.$shared=!1;o=JC(l,e=$I(e)?e():e,this.createResolver(g,e,n))}for(const a of I)t[a]=o[a];return t}createResolver(g,I){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[""],C=arguments.length>3?arguments[3]:void 0;const{resolver:t}=Zn(this._resolverCache,g,e);return wI(I)?JC(t,I,void 0,C):t}}function Zn(g,I,e){let C=g.get(I);C||(C=new Map,g.set(I,C));const t=e.join();let l=C.get(t);if(!l){l={resolver:RC(I,e),subPrefixes:e.filter((g=>!g.toLowerCase().includes("hover")))},C.set(t,l)}return l}const hn=g=>wI(g)&&Object.getOwnPropertyNames(g).some((I=>$I(g[I])));const Gn=["top","bottom","left","right","chartArea"];function Bn(g,I){return"top"===g||"bottom"===g||-1===Gn.indexOf(g)&&"x"===I}function yn(g,I){return function(e,C){return e[g]===C[g]?e[I]-C[I]:e[g]-C[g]}}function pn(g){const I=g.chart,e=I.options.animation;I.notifyPlugins("afterRender"),zI(e&&e.onComplete,[g],I)}function Wn(g){const I=g.chart,e=I.options.animation;zI(e&&e.onProgress,[g],I)}function Vn(g){return PC()&&"string"===typeof g?g=document.getElementById(g):g&&g.length&&(g=g[0]),g&&g.canvas&&(g=g.canvas),g}const Sn={},Xn=g=>{const I=Vn(g);return Object.values(Sn).filter((g=>g.canvas===I)).pop()};function Rn(g,I,e){const C=Object.keys(g);for(const t of C){const C=+t;if(C>=I){const l=g[t];delete g[t],(e>0||C>I)&&(g[C+e]=l)}}}function Jn(g,I,e){return g.options.clip?g[e]:I[e]}class kn{static register(){In.add(...arguments),Yn()}static unregister(){In.remove(...arguments),Yn()}constructor(g,I){const e=this.config=new mn(I),C=Vn(g),t=Xn(C);if(t)throw new Error("Canvas is already in use. Chart with ID '"+t.id+"' must be destroyed before the canvas with ID '"+t.canvas.id+"' can be reused.");const l=e.createResolver(e.chartOptionScopes(),this.getContext());this.platform=new(e.platform||function(g){return!PC()||"undefined"!==typeof OffscreenCanvas&&g instanceof OffscreenCanvas?Sl:Ml}(C)),this.platform.updateConfig(e);const n=this.platform.acquireContext(C,l.aspectRatio),o=n&&n.canvas,a=o&&o.height,i=o&&o.width;this.id=fI(),this.ctx=n,this.canvas=o,this.width=i,this.height=a,this._options=l,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new en,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(g,I){let e;return function(){for(var C=arguments.length,t=new Array(C),l=0;l<C;l++)t[l]=arguments[l];return I?(clearTimeout(e),e=setTimeout(g,I,t)):g.apply(this,t),I}}((g=>this.update(g)),l.resizeDelay||0),this._dataChanges=[],Sn[this.id]=this,n&&o?(yt.listen(this,"complete",pn),yt.listen(this,"progress",Wn),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:g,maintainAspectRatio:I},width:e,height:C,_aspectRatio:t}=this;return vI(g)?I&&t?t:C?e/C:null:g}get data(){return this.config.data}set data(g){this.config.data=g}get options(){return this._options}set options(g){this.config.options=g}get registry(){return In}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():lt(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return lC(this.canvas,this.ctx),this}stop(){return yt.stop(this),this}resize(g,I){yt.running(this)?this._resizeBeforeDraw={width:g,height:I}:this._resize(g,I)}_resize(g,I){const e=this.options,C=this.canvas,t=e.maintainAspectRatio&&this.aspectRatio,l=this.platform.getMaximumSize(C,g,I,t),n=e.devicePixelRatio||this.platform.getDevicePixelRatio(),o=this.width?"resize":"attach";this.width=l.width,this.height=l.height,this._aspectRatio=this.aspectRatio,lt(this,n,!0)&&(this.notifyPlugins("resize",{size:l}),zI(e.onResize,[this,l],this),this.attached&&this._doResize(o)&&this.render())}ensureScalesHaveIDs(){MI(this.options.scales||{},((g,I)=>{g.id=I}))}buildOrUpdateScales(){const g=this.options,I=g.scales,e=this.scales,C=Object.keys(e).reduce(((g,I)=>(g[I]=!1,g)),{});let t=[];I&&(t=t.concat(Object.keys(I).map((g=>{const e=I[g],C=on(g,e),t="r"===C,l="x"===C;return{options:e,dposition:t?"chartArea":l?"bottom":"left",dtype:t?"radialLinear":l?"category":"linear"}})))),MI(t,(I=>{const t=I.options,l=t.id,n=on(l,t),o=FI(t.type,I.dtype);void 0!==t.position&&Bn(t.position,n)===Bn(I.dposition)||(t.position=I.dposition),C[l]=!0;let a=null;if(l in e&&e[l].type===o)a=e[l];else{a=new(In.getScale(o))({id:l,type:o,ctx:this.ctx,chart:this}),e[a.id]=a}a.init(t,g)})),MI(C,((g,I)=>{g||delete e[I]})),MI(e,(g=>{Wl.configure(this,g,g.options),Wl.addBox(this,g)}))}_updateMetasets(){const g=this._metasets,I=this.data.datasets.length,e=g.length;if(g.sort(((g,I)=>g.index-I.index)),e>I){for(let g=I;g<e;++g)this._destroyDatasetMeta(g);g.splice(I,e-I)}this._sortedMetasets=g.slice(0).sort(yn("order","index"))}_removeUnreferencedMetasets(){const{_metasets:g,data:{datasets:I}}=this;g.length>I.length&&delete this._stacks,g.forEach(((g,e)=>{0===I.filter((I=>I===g._dataset)).length&&this._destroyDatasetMeta(e)}))}buildOrUpdateControllers(){const g=[],I=this.data.datasets;let e,C;for(this._removeUnreferencedMetasets(),e=0,C=I.length;e<C;e++){const C=I[e];let t=this.getDatasetMeta(e);const l=C.type||this.config.type;if(t.type&&t.type!==l&&(this._destroyDatasetMeta(e),t=this.getDatasetMeta(e)),t.type=l,t.indexAxis=C.indexAxis||ln(l,this.options),t.order=C.order||0,t.index=e,t.label=""+C.label,t.visible=this.isDatasetVisible(e),t.controller)t.controller.updateIndex(e),t.controller.linkScales();else{const I=In.getController(l),{datasetElementType:C,dataElementType:n}=IC.datasets[l];Object.assign(I,{dataElementType:In.getElement(n),datasetElementType:C&&In.getElement(C)}),t.controller=new I(this,e),g.push(t.controller)}}return this._updateMetasets(),g}_resetElements(){MI(this.data.datasets,((g,I)=>{this.getDatasetMeta(I).controller.reset()}),this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(g){const I=this.config;I.update();const e=this._options=I.createResolver(I.chartOptionScopes(),this.getContext()),C=this._animationsDisabled=!e.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:g,cancelable:!0}))return;const t=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let l=0;for(let a=0,i=this.data.datasets.length;a<i;a++){const{controller:g}=this.getDatasetMeta(a),I=!C&&-1===t.indexOf(g);g.buildOrUpdateElements(I),l=Math.max(+g.getMaxOverflow(),l)}l=this._minPadding=e.layout.autoPadding?l:0,this._updateLayout(l),C||MI(t,(g=>{g.reset()})),this._updateDatasets(g),this.notifyPlugins("afterUpdate",{mode:g}),this._layers.sort(yn("z","_idx"));const{_active:n,_lastEvent:o}=this;o?this._eventHandler(o,!0):n.length&&this._updateHoverStyles(n,n,!0),this.render()}_updateScales(){MI(this.scales,(g=>{Wl.removeBox(this,g)})),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const g=this.options,I=new Set(Object.keys(this._listeners)),e=new Set(g.events);ge(I,e)&&!!this._responsiveListeners===g.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:g}=this,I=this._getUniformDataChanges()||[];for(const{method:e,start:C,count:t}of I){Rn(g,C,"_removeElements"===e?-t:t)}}_getUniformDataChanges(){const g=this._dataChanges;if(!g||!g.length)return;this._dataChanges=[];const I=this.data.datasets.length,e=I=>new Set(g.filter((g=>g[0]===I)).map(((g,I)=>I+","+g.splice(1).join(",")))),C=e(0);for(let t=1;t<I;t++)if(!ge(C,e(t)))return;return Array.from(C).map((g=>g.split(","))).map((g=>({method:g[1],start:+g[2],count:+g[3]})))}_updateLayout(g){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;Wl.update(this,this.width,this.height,g);const I=this.chartArea,e=I.width<=0||I.height<=0;this._layers=[],MI(this.boxes,(g=>{e&&"chartArea"===g.position||(g.configure&&g.configure(),this._layers.push(...g._layers()))}),this),this._layers.forEach(((g,I)=>{g._idx=I})),this.notifyPlugins("afterLayout")}_updateDatasets(g){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:g,cancelable:!0})){for(let g=0,I=this.data.datasets.length;g<I;++g)this.getDatasetMeta(g).controller.configure();for(let I=0,e=this.data.datasets.length;I<e;++I)this._updateDataset(I,$I(g)?g({datasetIndex:I}):g);this.notifyPlugins("afterDatasetsUpdate",{mode:g})}}_updateDataset(g,I){const e=this.getDatasetMeta(g),C={meta:e,index:g,mode:I,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",C)&&(e.controller._update(I),C.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",C))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(yt.has(this)?this.attached&&!yt.running(this)&&yt.start(this):(this.draw(),pn({chart:this})))}draw(){let g;if(this._resizeBeforeDraw){const{width:g,height:I}=this._resizeBeforeDraw;this._resize(g,I),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0)return;if(!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const I=this._layers;for(g=0;g<I.length&&I[g].z<=0;++g)I[g].draw(this.chartArea);for(this._drawDatasets();g<I.length;++g)I[g].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(g){const I=this._sortedMetasets,e=[];let C,t;for(C=0,t=I.length;C<t;++C){const t=I[C];g&&!t.visible||e.push(t)}return e}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const g=this.getSortedVisibleDatasetMetas();for(let I=g.length-1;I>=0;--I)this._drawDataset(g[I]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(g){const I=this.ctx,e=g._clip,C=!e.disabled,t=function(g,I){const{xScale:e,yScale:C}=g;return e&&C?{left:Jn(e,I,"left"),right:Jn(e,I,"right"),top:Jn(C,I,"top"),bottom:Jn(C,I,"bottom")}:I}(g,this.chartArea),l={meta:g,index:g.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",l)&&(C&&iC(I,{left:!1===e.left?0:t.left-e.left,right:!1===e.right?this.width:t.right+e.right,top:!1===e.top?0:t.top-e.top,bottom:!1===e.bottom?this.height:t.bottom+e.bottom}),g.controller.draw(),C&&AC(I),l.cancelable=!1,this.notifyPlugins("afterDatasetDraw",l))}isPointInArea(g){return aC(g,this.chartArea,this._minPadding)}getElementsAtEventForMode(g,I,e,C){const t=cl.modes[I];return"function"===typeof t?t(this,g,e,C):[]}getDatasetMeta(g){const I=this.data.datasets[g],e=this._metasets;let C=e.filter((g=>g&&g._dataset===I)).pop();return C||(C={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:I&&I.order||0,index:g,_dataset:I,_parsed:[],_sorted:!1},e.push(C)),C}getContext(){return this.$context||(this.$context=XC(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(g){const I=this.data.datasets[g];if(!I)return!1;const e=this.getDatasetMeta(g);return"boolean"===typeof e.hidden?!e.hidden:!I.hidden}setDatasetVisibility(g,I){this.getDatasetMeta(g).hidden=!I}toggleDataVisibility(g){this._hiddenIndices[g]=!this._hiddenIndices[g]}getDataVisibility(g){return!this._hiddenIndices[g]}_updateVisibility(g,I,e){const C=e?"show":"hide",t=this.getDatasetMeta(g),l=t.controller._resolveAnimations(void 0,C);qI(I)?(t.data[I].hidden=!e,this.update()):(this.setDatasetVisibility(g,e),l.update(t,{visible:e}),this.update((I=>I.datasetIndex===g?C:void 0)))}hide(g,I){this._updateVisibility(g,I,!1)}show(g,I){this._updateVisibility(g,I,!0)}_destroyDatasetMeta(g){const I=this._metasets[g];I&&I.controller&&I.controller._destroy(),delete this._metasets[g]}_stop(){let g,I;for(this.stop(),yt.remove(this),g=0,I=this.data.datasets.length;g<I;++g)this._destroyDatasetMeta(g)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:g,ctx:I}=this;this._stop(),this.config.clearCache(),g&&(this.unbindEvents(),lC(g,I),this.platform.releaseContext(I),this.canvas=null,this.ctx=null),delete Sn[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(){return this.canvas.toDataURL(...arguments)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const g=this._listeners,I=this.platform,e=(e,C)=>{I.addEventListener(this,e,C),g[e]=C},C=(g,I,e)=>{g.offsetX=I,g.offsetY=e,this._eventHandler(g)};MI(this.options.events,(g=>e(g,C)))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const g=this._responsiveListeners,I=this.platform,e=(e,C)=>{I.addEventListener(this,e,C),g[e]=C},C=(e,C)=>{g[e]&&(I.removeEventListener(this,e,C),delete g[e])},t=(g,I)=>{this.canvas&&this.resize(g,I)};let l;const n=()=>{C("attach",n),this.attached=!0,this.resize(),e("resize",t),e("detach",l)};l=()=>{this.attached=!1,C("resize",t),this._stop(),this._resize(0,0),e("attach",n)},I.isAttached(this.canvas)?n():l()}unbindEvents(){MI(this._listeners,((g,I)=>{this.platform.removeEventListener(this,I,g)})),this._listeners={},MI(this._responsiveListeners,((g,I)=>{this.platform.removeEventListener(this,I,g)})),this._responsiveListeners=void 0}updateHoverStyle(g,I,e){const C=e?"set":"remove";let t,l,n,o;for("dataset"===I&&(t=this.getDatasetMeta(g[0].datasetIndex),t.controller["_"+C+"DatasetHoverStyle"]()),n=0,o=g.length;n<o;++n){l=g[n];const I=l&&this.getDatasetMeta(l.datasetIndex).controller;I&&I[C+"HoverStyle"](l.element,l.datasetIndex,l.index)}}getActiveElements(){return this._active||[]}setActiveElements(g){const I=this._active||[],e=g.map((g=>{let{datasetIndex:I,index:e}=g;const C=this.getDatasetMeta(I);if(!C)throw new Error("No dataset found at index "+I);return{datasetIndex:I,element:C.data[e],index:e}}));!EI(e,I)&&(this._active=e,this._lastEvent=null,this._updateHoverStyles(e,I))}notifyPlugins(g,I,e){return this._plugins.notify(this,g,I,e)}isPluginEnabled(g){return 1===this._plugins._cache.filter((I=>I.plugin.id===g)).length}_updateHoverStyles(g,I,e){const C=this.options.hover,t=(g,I)=>g.filter((g=>!I.some((I=>g.datasetIndex===I.datasetIndex&&g.index===I.index)))),l=t(I,g),n=e?g:t(g,I);l.length&&this.updateHoverStyle(l,C.mode,!1),n.length&&C.mode&&this.updateHoverStyle(n,C.mode,!0)}_eventHandler(g,I){const e={event:g,replay:I,cancelable:!0,inChartArea:this.isPointInArea(g)},C=I=>(I.options.events||this.options.events).includes(g.native.type);if(!1===this.notifyPlugins("beforeEvent",e,C))return;const t=this._handleEvent(g,I,e.inChartArea);return e.cancelable=!1,this.notifyPlugins("afterEvent",e,C),(t||e.changed)&&this.render(),this}_handleEvent(g,I,e){const{_active:C=[],options:t}=this,l=I,n=this._getActiveElements(g,C,e,l),o=function(g){return"mouseup"===g.type||"click"===g.type||"contextmenu"===g.type}(g),a=function(g,I,e,C){return e&&"mouseout"!==g.type?C?I:g:null}(g,this._lastEvent,e,o);e&&(this._lastEvent=null,zI(t.onHover,[g,n,this],this),o&&zI(t.onClick,[g,n,this],this));const i=!EI(n,C);return(i||I)&&(this._active=n,this._updateHoverStyles(n,C,I)),this._lastEvent=a,i}_getActiveElements(g,I,e,C){if("mouseout"===g.type)return[];if(!e)return I;const t=this.options.hover;return this.getElementsAtEventForMode(g,t.mode,t,C)}}function Yn(){return MI(kn.instances,(g=>g._plugins.invalidate()))}function fn(g,I,e,C){const t=BC(g.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]);const l=(e-I)/2,n=Math.min(l,C*I/2),o=g=>{const I=(e-Math.min(l,g))*C/2;return pe(g,0,Math.min(l,I))};return{outerStart:o(t.outerStart),outerEnd:o(t.outerEnd),innerStart:pe(t.innerStart,0,n),innerEnd:pe(t.innerEnd,0,n)}}function vn(g,I,e,C){return{x:e+g*Math.cos(I),y:C+g*Math.sin(I)}}function Hn(g,I,e,C,t,l){const{x:n,y:o,startAngle:a,pixelMargin:i,innerRadius:A}=I,c=Math.max(I.outerRadius+C+e-i,0),s=A>0?A+C+e+i:0;let d=0;const r=t-a;if(C){const g=((A>0?A-C:0)+(c>0?c-C:0))/2;d=(r-(0!==g?r*g/(g+C):r))/2}const b=(r-Math.max(.001,r*c-e/Ie)/c)/2,u=a+b+d,m=t-b-d,{outerStart:Z,outerEnd:h,innerStart:G,innerEnd:B}=fn(I,s,c,m-u),y=c-Z,p=c-h,W=u+Z/y,V=m-h/p,S=s+G,X=s+B,R=u+G/S,J=m-B/X;if(g.beginPath(),l){const I=(W+V)/2;if(g.arc(n,o,c,W,I),g.arc(n,o,c,I,V),h>0){const I=vn(p,V,n,o);g.arc(I.x,I.y,h,V,m+ne)}const e=vn(X,m,n,o);if(g.lineTo(e.x,e.y),B>0){const I=vn(X,J,n,o);g.arc(I.x,I.y,B,m+ne,J+Math.PI)}const C=(m-B/s+(u+G/s))/2;if(g.arc(n,o,s,m-B/s,C,!0),g.arc(n,o,s,C,u+G/s,!0),G>0){const I=vn(S,R,n,o);g.arc(I.x,I.y,G,R+Math.PI,u-ne)}const t=vn(y,u,n,o);if(g.lineTo(t.x,t.y),Z>0){const I=vn(y,W,n,o);g.arc(I.x,I.y,Z,u-ne,W)}}else{g.moveTo(n,o);const I=Math.cos(W)*c+n,e=Math.sin(W)*c+o;g.lineTo(I,e);const C=Math.cos(V)*c+n,t=Math.sin(V)*c+o;g.lineTo(C,t)}g.closePath()}function wn(g,I,e,C,t){const{fullCircles:l,startAngle:n,circumference:o,options:a}=I,{borderWidth:i,borderJoinStyle:A,borderDash:c,borderDashOffset:s}=a,d="inner"===a.borderAlign;if(!i)return;g.setLineDash(c||[]),g.lineDashOffset=s,d?(g.lineWidth=2*i,g.lineJoin=A||"round"):(g.lineWidth=i,g.lineJoin=A||"bevel");let r=I.endAngle;if(l){Hn(g,I,e,C,r,t);for(let I=0;I<l;++I)g.stroke();isNaN(o)||(r=n+(o%ee||ee))}d&&function(g,I,e){const{startAngle:C,pixelMargin:t,x:l,y:n,outerRadius:o,innerRadius:a}=I;let i=t/o;g.beginPath(),g.arc(l,n,o,C-i,e+i),a>t?(i=t/a,g.arc(l,n,a,e+i,C-i,!0)):g.arc(l,n,t,e+ne,C-ne),g.closePath(),g.clip()}(g,I,r),l||(Hn(g,I,e,C,r,t),g.stroke())}_g(kn,"defaults",IC),_g(kn,"instances",Sn),_g(kn,"overrides",Oe),_g(kn,"registry",In),_g(kn,"version","4.4.1"),_g(kn,"getChart",Xn);class Nn extends El{constructor(g){super(),_g(this,"circumference",void 0),_g(this,"endAngle",void 0),_g(this,"fullCircles",void 0),_g(this,"innerRadius",void 0),_g(this,"outerRadius",void 0),_g(this,"pixelMargin",void 0),_g(this,"startAngle",void 0),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,g&&Object.assign(this,g)}inRange(g,I,e){const C=this.getProps(["x","y"],e),{angle:t,distance:l}=Ze(C,{x:g,y:I}),{startAngle:n,endAngle:o,innerRadius:a,outerRadius:i,circumference:A}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],e),c=(this.options.spacing+this.options.borderWidth)/2,s=FI(A,o-n)>=ee||ye(t,n,o),d=We(l,a+c,i+c);return s&&d}getCenterPoint(g){const{x:I,y:e,startAngle:C,endAngle:t,innerRadius:l,outerRadius:n}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],g),{offset:o,spacing:a}=this.options,i=(C+t)/2,A=(l+n+a+o)/2;return{x:I+Math.cos(i)*A,y:e+Math.sin(i)*A}}tooltipPosition(g){return this.getCenterPoint(g)}draw(g){const{options:I,circumference:e}=this,C=(I.offset||0)/4,t=(I.spacing||0)/2,l=I.circular;if(this.pixelMargin="inner"===I.borderAlign?.33:0,this.fullCircles=e>ee?Math.floor(e/ee):0,0===e||this.innerRadius<0||this.outerRadius<0)return;g.save();const n=(this.startAngle+this.endAngle)/2;g.translate(Math.cos(n)*C,Math.sin(n)*C);const o=C*(1-Math.sin(Math.min(Ie,e||0)));g.fillStyle=I.backgroundColor,g.strokeStyle=I.borderColor,function(g,I,e,C,t){const{fullCircles:l,startAngle:n,circumference:o}=I;let a=I.endAngle;if(l){Hn(g,I,e,C,a,t);for(let I=0;I<l;++I)g.fill();isNaN(o)||(a=n+(o%ee||ee))}Hn(g,I,e,C,a,t),g.fill()}(g,this,o,t,l),wn(g,this,o,t,l),g.restore()}}function Kn(g,I){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:I;g.lineCap=FI(e.borderCapStyle,I.borderCapStyle),g.setLineDash(FI(e.borderDash,I.borderDash)),g.lineDashOffset=FI(e.borderDashOffset,I.borderDashOffset),g.lineJoin=FI(e.borderJoinStyle,I.borderJoinStyle),g.lineWidth=FI(e.borderWidth,I.borderWidth),g.strokeStyle=FI(e.borderColor,I.borderColor)}function Fn(g,I,e){g.lineTo(e.x,e.y)}function xn(g,I){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const C=g.length,{start:t=0,end:l=C-1}=e,{start:n,end:o}=I,a=Math.max(t,n),i=Math.min(l,o),A=t<n&&l<n||t>o&&l>o;return{count:C,start:a,loop:I.loop,ilen:i<a&&!A?C+i-a:i-a}}function zn(g,I,e,C){const{points:t,options:l}=I,{count:n,start:o,loop:a,ilen:i}=xn(t,e,C),A=function(g){return g.stepped?cC:g.tension||"monotone"===g.cubicInterpolationMode?sC:Fn}(l);let c,s,d,{move:r=!0,reverse:b}=C||{};for(c=0;c<=i;++c)s=t[(o+(b?i-c:c))%n],s.skip||(r?(g.moveTo(s.x,s.y),r=!1):A(g,d,s,b,l.stepped),d=s);return a&&(s=t[(o+(b?i:0))%n],A(g,d,s,b,l.stepped)),!!a}function Mn(g,I,e,C){const t=I.points,{count:l,start:n,ilen:o}=xn(t,e,C),{move:a=!0,reverse:i}=C||{};let A,c,s,d,r,b,u=0,m=0;const Z=g=>(n+(i?o-g:g))%l,h=()=>{d!==r&&(g.lineTo(u,r),g.lineTo(u,d),g.lineTo(u,b))};for(a&&(c=t[Z(0)],g.moveTo(c.x,c.y)),A=0;A<=o;++A){if(c=t[Z(A)],c.skip)continue;const I=c.x,e=c.y,C=0|I;C===s?(e<d?d=e:e>r&&(r=e),u=(m*u+I)/++m):(h(),g.lineTo(I,e),s=C,m=0,d=r=e),b=e}h()}function En(g){const I=g.options,e=I.borderDash&&I.borderDash.length;return!g._decimated&&!g._loop&&!I.tension&&"monotone"!==I.cubicInterpolationMode&&!I.stepped&&!e?Mn:zn}_g(Nn,"id","arc"),_g(Nn,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),_g(Nn,"defaultRoutes",{backgroundColor:"backgroundColor"}),_g(Nn,"descriptors",{_scriptable:!0,_indexable:g=>"borderDash"!==g});const Qn="function"===typeof Path2D;function Un(g,I,e,C){Qn&&!I.options.segment?function(g,I,e,C){let t=I._path;t||(t=I._path=new Path2D,I.path(t,e,C)&&t.closePath()),Kn(g,I.options),g.stroke(t)}(g,I,e,C):function(g,I,e,C){const{segments:t,options:l}=I,n=En(I);for(const o of t)Kn(g,l,o.style),g.beginPath(),n(g,I,o,{start:e,end:e+C-1})&&g.closePath(),g.stroke()}(g,I,e,C)}class Ln extends El{constructor(g){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,g&&Object.assign(this,g)}updateControlPoints(g,I){const e=this.options;if((e.tension||"monotone"===e.cubicInterpolationMode)&&!e.stepped&&!this._pointsUpdated){const C=e.spanGaps?this._loop:this._fullLoop;jC(this._points,e,g,C,I),this._pointsUpdated=!0}}set points(g){this._points=g,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(g,I){const e=g.points,C=g.options.spanGaps,t=e.length;if(!t)return[];const l=!!g._loop,{start:n,end:o}=function(g,I,e,C){let t=0,l=I-1;if(e&&!C)for(;t<I&&!g[t].skip;)t++;for(;t<I&&g[t].skip;)t++;for(t%=I,e&&(l+=t);l>t&&g[l%I].skip;)l--;return l%=I,{start:t,end:l}}(e,t,l,C);return Zt(g,!0===C?[{start:n,end:o,loop:l}]:function(g,I,e,C){const t=g.length,l=[];let n,o=I,a=g[I];for(n=I+1;n<=e;++n){const e=g[n%t];e.skip||e.stop?a.skip||(C=!1,l.push({start:I%t,end:(n-1)%t,loop:C}),I=o=e.stop?n:null):(o=n,a.skip&&(I=n)),a=e}return null!==o&&l.push({start:I%t,end:o%t,loop:C}),l}(e,n,o<n?o+t:o,!!g._fullLoop&&0===n&&o===t-1),e,I)}(this,this.options.segment))}first(){const g=this.segments,I=this.points;return g.length&&I[g[0].start]}last(){const g=this.segments,I=this.points,e=g.length;return e&&I[g[e-1].end]}interpolate(g,I){const e=this.options,C=g[I],t=this.points,l=mt(this,{property:I,start:C,end:C});if(!l.length)return;const n=[],o=function(g){return g.stepped?it:g.tension||"monotone"===g.cubicInterpolationMode?At:at}(e);let a,i;for(a=0,i=l.length;a<i;++a){const{start:i,end:A}=l[a],c=t[i],s=t[A];if(c===s){n.push(c);continue}const d=o(c,s,Math.abs((C-c[I])/(s[I]-c[I])),e.stepped);d[I]=g[I],n.push(d)}return 1===n.length?n[0]:n}pathSegment(g,I,e){return En(this)(g,this,I,e)}path(g,I,e){const C=this.segments,t=En(this);let l=this._loop;I=I||0,e=e||this.points.length-I;for(const n of C)l&=t(g,this,n,{start:I,end:I+e-1});return!!l}draw(g,I,e,C){const t=this.options||{};(this.points||[]).length&&t.borderWidth&&(g.save(),Un(g,this,e,C),g.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function Dn(g,I,e,C){const t=g.options,{[e]:l}=g.getProps([e],C);return Math.abs(I-l)<t.radius+t.hitRadius}_g(Ln,"id","line"),_g(Ln,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),_g(Ln,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),_g(Ln,"descriptors",{_scriptable:!0,_indexable:g=>"borderDash"!==g&&"fill"!==g});class Tn extends El{constructor(g){super(),_g(this,"parsed",void 0),_g(this,"skip",void 0),_g(this,"stop",void 0),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,g&&Object.assign(this,g)}inRange(g,I,e){const C=this.options,{x:t,y:l}=this.getProps(["x","y"],e);return Math.pow(g-t,2)+Math.pow(I-l,2)<Math.pow(C.hitRadius+C.radius,2)}inXRange(g,I){return Dn(this,g,"x",I)}inYRange(g,I){return Dn(this,g,"y",I)}getCenterPoint(g){const{x:I,y:e}=this.getProps(["x","y"],g);return{x:I,y:e}}size(g){let I=(g=g||this.options||{}).radius||0;I=Math.max(I,I&&g.hoverRadius||0);return 2*(I+(I&&g.borderWidth||0))}draw(g,I){const e=this.options;this.skip||e.radius<.1||!aC(this,I,this.size(e)/2)||(g.strokeStyle=e.borderColor,g.lineWidth=e.borderWidth,g.fillStyle=e.backgroundColor,nC(g,e,this.x,this.y))}getRange(){const g=this.options||{};return g.radius+g.hitRadius}}function jn(g,I){const{x:e,y:C,base:t,width:l,height:n}=g.getProps(["x","y","base","width","height"],I);let o,a,i,A,c;return g.horizontal?(c=n/2,o=Math.min(e,t),a=Math.max(e,t),i=C-c,A=C+c):(c=l/2,o=e-c,a=e+c,i=Math.min(C,t),A=Math.max(C,t)),{left:o,top:i,right:a,bottom:A}}function Pn(g,I,e,C){return g?0:pe(I,e,C)}function On(g){const I=jn(g),e=I.right-I.left,C=I.bottom-I.top,t=function(g,I,e){const C=g.options.borderWidth,t=g.borderSkipped,l=yC(C);return{t:Pn(t.top,l.top,0,e),r:Pn(t.right,l.right,0,I),b:Pn(t.bottom,l.bottom,0,e),l:Pn(t.left,l.left,0,I)}}(g,e/2,C/2),l=function(g,I,e){const{enableBorderRadius:C}=g.getProps(["enableBorderRadius"]),t=g.options.borderRadius,l=pC(t),n=Math.min(I,e),o=g.borderSkipped,a=C||wI(t);return{topLeft:Pn(!a||o.top||o.left,l.topLeft,0,n),topRight:Pn(!a||o.top||o.right,l.topRight,0,n),bottomLeft:Pn(!a||o.bottom||o.left,l.bottomLeft,0,n),bottomRight:Pn(!a||o.bottom||o.right,l.bottomRight,0,n)}}(g,e/2,C/2);return{outer:{x:I.left,y:I.top,w:e,h:C,radius:l},inner:{x:I.left+t.l,y:I.top+t.t,w:e-t.l-t.r,h:C-t.t-t.b,radius:{topLeft:Math.max(0,l.topLeft-Math.max(t.t,t.l)),topRight:Math.max(0,l.topRight-Math.max(t.t,t.r)),bottomLeft:Math.max(0,l.bottomLeft-Math.max(t.b,t.l)),bottomRight:Math.max(0,l.bottomRight-Math.max(t.b,t.r))}}}}function _n(g,I,e,C){const t=null===I,l=null===e,n=g&&!(t&&l)&&jn(g,C);return n&&(t||We(I,n.left,n.right))&&(l||We(e,n.top,n.bottom))}function qn(g,I){g.rect(I.x,I.y,I.w,I.h)}function $n(g,I){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const C=g.x!==e.x?-I:0,t=g.y!==e.y?-I:0,l=(g.x+g.w!==e.x+e.w?I:0)-C,n=(g.y+g.h!==e.y+e.h?I:0)-t;return{x:g.x+C,y:g.y+t,w:g.w+l,h:g.h+n,radius:g.radius}}_g(Tn,"id","point"),_g(Tn,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),_g(Tn,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});class go extends El{constructor(g){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,g&&Object.assign(this,g)}draw(g){const{inflateAmount:I,options:{borderColor:e,backgroundColor:C}}=this,{inner:t,outer:l}=On(this),n=(o=l.radius).topLeft||o.topRight||o.bottomLeft||o.bottomRight?uC:qn;var o;g.save(),l.w===t.w&&l.h===t.h||(g.beginPath(),n(g,$n(l,I,t)),g.clip(),n(g,$n(t,-I,l)),g.fillStyle=e,g.fill("evenodd")),g.beginPath(),n(g,$n(t,I)),g.fillStyle=C,g.fill(),g.restore()}inRange(g,I,e){return _n(this,g,I,e)}inXRange(g,I){return _n(this,g,null,I)}inYRange(g,I){return _n(this,null,g,I)}getCenterPoint(g){const{x:I,y:e,base:C,horizontal:t}=this.getProps(["x","y","base","horizontal"],g);return{x:t?(I+C)/2:I,y:t?e:(e+C)/2}}getRange(g){return"x"===g?this.width/2:this.height/2}}_g(go,"id","bar"),_g(go,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),_g(go,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var Io=Object.freeze({__proto__:null,ArcElement:Nn,BarElement:go,LineElement:Ln,PointElement:Tn});const eo=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],Co=eo.map((g=>g.replace("rgb(","rgba(").replace(")",", 0.5)")));function to(g){return eo[g%eo.length]}function lo(g){return Co[g%Co.length]}function no(g){let I=0;return(e,C)=>{const t=g.getDatasetMeta(C).controller;t instanceof Pt?I=function(g,I){return g.backgroundColor=g.data.map((()=>to(I++))),I}(e,I):t instanceof _t?I=function(g,I){return g.backgroundColor=g.data.map((()=>lo(I++))),I}(e,I):t&&(I=function(g,I){return g.borderColor=to(I),g.backgroundColor=lo(I),++I}(e,I))}}function oo(g){let I;for(I in g)if(g[I].borderColor||g[I].backgroundColor)return!0;return!1}var ao={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(g,I,e){if(!e.enabled)return;const{data:{datasets:C},options:t}=g.config,{elements:l}=t;if(!e.forceOverride&&(oo(C)||(n=t)&&(n.borderColor||n.backgroundColor)||l&&oo(l)))return;var n;const o=no(g);C.forEach(o)}};function io(g){if(g._decimated){const I=g._data;delete g._decimated,delete g._data,Object.defineProperty(g,"data",{configurable:!0,enumerable:!0,writable:!0,value:I})}}function Ao(g){g.data.datasets.forEach((g=>{io(g)}))}var co={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(g,I,e)=>{if(!e.enabled)return void Ao(g);const C=g.width;g.data.datasets.forEach(((I,t)=>{const{_data:l,indexAxis:n}=I,o=g.getDatasetMeta(t),a=l||I.data;if("y"===SC([n,g.options.indexAxis]))return;if(!o.controller.supportsDecimation)return;const i=g.scales[o.xAxisID];if("linear"!==i.type&&"time"!==i.type)return;if(g.options.parsing)return;let{start:A,count:c}=function(g,I){const e=I.length;let C,t=0;const{iScale:l}=g,{min:n,max:o,minDefined:a,maxDefined:i}=l.getUserBounds();return a&&(t=pe(Se(I,l.axis,n).lo,0,e-1)),C=i?pe(Se(I,l.axis,o).hi+1,t,e)-t:e-t,{start:t,count:C}}(o,a);if(c<=(e.threshold||4*C))return void io(I);let s;switch(vI(l)&&(I._data=a,delete I.data,Object.defineProperty(I,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(g){this._data=g}})),e.algorithm){case"lttb":s=function(g,I,e,C,t){const l=t.samples||C;if(l>=e)return g.slice(I,I+e);const n=[],o=(e-2)/(l-2);let a=0;const i=I+e-1;let A,c,s,d,r,b=I;for(n[a++]=g[b],A=0;A<l-2;A++){let C,t=0,l=0;const i=Math.floor((A+1)*o)+1+I,u=Math.min(Math.floor((A+2)*o)+1,e)+I,m=u-i;for(C=i;C<u;C++)t+=g[C].x,l+=g[C].y;t/=m,l/=m;const Z=Math.floor(A*o)+1+I,h=Math.min(Math.floor((A+1)*o)+1,e)+I,{x:G,y:B}=g[b];for(s=d=-1,C=Z;C<h;C++)d=.5*Math.abs((G-t)*(g[C].y-B)-(G-g[C].x)*(l-B)),d>s&&(s=d,c=g[C],r=C);n[a++]=c,b=r}return n[a++]=g[i],n}(a,A,c,C,e);break;case"min-max":s=function(g,I,e,C){let t,l,n,o,a,i,A,c,s,d,r=0,b=0;const u=[],m=I+e-1,Z=g[I].x,h=g[m].x-Z;for(t=I;t<I+e;++t){l=g[t],n=(l.x-Z)/h*C,o=l.y;const I=0|n;if(I===a)o<s?(s=o,i=t):o>d&&(d=o,A=t),r=(b*r+l.x)/++b;else{const e=t-1;if(!vI(i)&&!vI(A)){const I=Math.min(i,A),C=Math.max(i,A);I!==c&&I!==e&&u.push({...g[I],x:r}),C!==c&&C!==e&&u.push({...g[C],x:r})}t>0&&e!==c&&u.push(g[e]),u.push(l),a=I,b=0,s=d=o,i=A=c=t}}return u}(a,A,c,C);break;default:throw new Error("Unsupported decimation algorithm '".concat(e.algorithm,"'"))}I._decimated=s}))},destroy(g){Ao(g)}};function so(g,I,e,C){if(C)return;let t=I[g],l=e[g];return"angle"===g&&(t=Be(t),l=Be(l)),{property:g,start:t,end:l}}function ro(g,I,e){for(;I>g;I--){const g=e[I];if(!isNaN(g.x)&&!isNaN(g.y))break}return I}function bo(g,I,e,C){return g&&I?C(g[e],I[e]):g?g[e]:I?I[e]:0}function uo(g,I){let e=[],C=!1;return HI(g)?(C=!0,e=g):e=function(g,I){const{x:e=null,y:C=null}=g||{},t=I.points,l=[];return I.segments.forEach((g=>{let{start:I,end:n}=g;n=ro(I,n,t);const o=t[I],a=t[n];null!==C?(l.push({x:o.x,y:C}),l.push({x:a.x,y:C})):null!==e&&(l.push({x:e,y:o.y}),l.push({x:e,y:a.y}))})),l}(g,I),e.length?new Ln({points:e,options:{tension:0},_loop:C,_fullLoop:C}):null}function mo(g){return g&&!1!==g.fill}function Zo(g,I,e){let C=g[I].fill;const t=[I];let l;if(!e)return C;for(;!1!==C&&-1===t.indexOf(C);){if(!NI(C))return C;if(l=g[C],!l)return!1;if(l.visible)return C;t.push(C),C=l.fill}return!1}function ho(g,I,e){const C=function(g){const I=g.options,e=I.fill;let C=FI(e&&e.target,e);void 0===C&&(C=!!I.backgroundColor);if(!1===C||null===C)return!1;if(!0===C)return"origin";return C}(g);if(wI(C))return!isNaN(C.value)&&C;let t=parseFloat(C);return NI(t)&&Math.floor(t)===t?function(g,I,e,C){"-"!==g&&"+"!==g||(e=I+e);if(e===I||e<0||e>=C)return!1;return e}(C[0],I,t,e):["origin","start","end","stack","shape"].indexOf(C)>=0&&C}function Go(g,I,e){const C=[];for(let t=0;t<e.length;t++){const l=e[t],{first:n,last:o,point:a}=Bo(l,I,"x");if(!(!a||n&&o))if(n)C.unshift(a);else if(g.push(a),!o)break}g.push(...C)}function Bo(g,I,e){const C=g.interpolate(I,e);if(!C)return{};const t=C[e],l=g.segments,n=g.points;let o=!1,a=!1;for(let i=0;i<l.length;i++){const g=l[i],I=n[g.start][e],C=n[g.end][e];if(We(t,I,C)){o=t===I,a=t===C;break}}return{first:o,last:a,point:C}}class yo{constructor(g){this.x=g.x,this.y=g.y,this.radius=g.radius}pathSegment(g,I,e){const{x:C,y:t,radius:l}=this;return I=I||{start:0,end:ee},g.arc(C,t,l,I.end,I.start,!0),!e.bounds}interpolate(g){const{x:I,y:e,radius:C}=this,t=g.angle;return{x:I+Math.cos(t)*C,y:e+Math.sin(t)*C,angle:t}}}function po(g){const{chart:I,fill:e,line:C}=g;if(NI(e))return function(g,I){const e=g.getDatasetMeta(I),C=e&&g.isDatasetVisible(I);return C?e.dataset:null}(I,e);if("stack"===e)return function(g){const{scale:I,index:e,line:C}=g,t=[],l=C.segments,n=C.points,o=function(g,I){const e=[],C=g.getMatchingVisibleMetas("line");for(let t=0;t<C.length;t++){const g=C[t];if(g.index===I)break;g.hidden||e.unshift(g.dataset)}return e}(I,e);o.push(uo({x:null,y:I.bottom},C));for(let a=0;a<l.length;a++){const g=l[a];for(let I=g.start;I<=g.end;I++)Go(t,n[I],o)}return new Ln({points:t,options:{}})}(g);if("shape"===e)return!0;const t=function(g){const I=g.scale||{};if(I.getPointPositionForValue)return function(g){const{scale:I,fill:e}=g,C=I.options,t=I.getLabels().length,l=C.reverse?I.max:I.min,n=function(g,I,e){let C;return C="start"===g?e:"end"===g?I.options.reverse?I.min:I.max:wI(g)?g.value:I.getBaseValue(),C}(e,I,l),o=[];if(C.grid.circular){const g=I.getPointPositionForValue(0,l);return new yo({x:g.x,y:g.y,radius:I.getDistanceFromCenterForValue(n)})}for(let a=0;a<t;++a)o.push(I.getPointPositionForValue(a,n));return o}(g);return function(g){const{scale:I={},fill:e}=g,C=function(g,I){let e=null;return"start"===g?e=I.bottom:"end"===g?e=I.top:wI(g)?e=I.getPixelForValue(g.value):I.getBasePixel&&(e=I.getBasePixel()),e}(e,I);if(NI(C)){const g=I.isHorizontal();return{x:g?C:null,y:g?null:C}}return null}(g)}(g);return t instanceof yo?t:uo(t,C)}function Wo(g,I,e){const C=po(I),{line:t,scale:l,axis:n}=I,o=t.options,a=o.fill,i=o.backgroundColor,{above:A=i,below:c=i}=a||{};C&&t.points.length&&(iC(g,e),function(g,I){const{line:e,target:C,above:t,below:l,area:n,scale:o}=I,a=e._loop?"angle":I.axis;g.save(),"x"===a&&l!==t&&(Vo(g,C,n.top),So(g,{line:e,target:C,color:t,scale:o,property:a}),g.restore(),g.save(),Vo(g,C,n.bottom));So(g,{line:e,target:C,color:l,scale:o,property:a}),g.restore()}(g,{line:t,target:C,above:A,below:c,area:e,scale:l,axis:n}),AC(g))}function Vo(g,I,e){const{segments:C,points:t}=I;let l=!0,n=!1;g.beginPath();for(const o of C){const{start:C,end:a}=o,i=t[C],A=t[ro(C,a,t)];l?(g.moveTo(i.x,i.y),l=!1):(g.lineTo(i.x,e),g.lineTo(i.x,i.y)),n=!!I.pathSegment(g,o,{move:n}),n?g.closePath():g.lineTo(A.x,e)}g.lineTo(I.first().x,e),g.closePath(),g.clip()}function So(g,I){const{line:e,target:C,property:t,color:l,scale:n}=I,o=function(g,I,e){const C=g.segments,t=g.points,l=I.points,n=[];for(const o of C){let{start:g,end:C}=o;C=ro(g,C,t);const a=so(e,t[g],t[C],o.loop);if(!I.segments){n.push({source:o,target:a,start:t[g],end:t[C]});continue}const i=mt(I,a);for(const I of i){const g=so(e,l[I.start],l[I.end],I.loop),C=ut(o,t,g);for(const t of C)n.push({source:t,target:I,start:{[e]:bo(a,g,"start",Math.max)},end:{[e]:bo(a,g,"end",Math.min)}})}}return n}(e,C,t);for(const{source:a,target:i,start:A,end:c}of o){const{style:{backgroundColor:I=l}={}}=a,o=!0!==C;g.save(),g.fillStyle=I,Xo(g,n,o&&so(t,A,c)),g.beginPath();const s=!!e.pathSegment(g,a);let d;if(o){s?g.closePath():Ro(g,C,c,t);const I=!!C.pathSegment(g,i,{move:s,reverse:!0});d=s&&I,d||Ro(g,C,A,t)}g.closePath(),g.fill(d?"evenodd":"nonzero"),g.restore()}}function Xo(g,I,e){const{top:C,bottom:t}=I.chart.chartArea,{property:l,start:n,end:o}=e||{};"x"===l&&(g.beginPath(),g.rect(n,C,o-n,t-C),g.clip())}function Ro(g,I,e,C){const t=I.interpolate(e,C);t&&g.lineTo(t.x,t.y)}var Jo={id:"filler",afterDatasetsUpdate(g,I,e){const C=(g.data.datasets||[]).length,t=[];let l,n,o,a;for(n=0;n<C;++n)l=g.getDatasetMeta(n),o=l.dataset,a=null,o&&o.options&&o instanceof Ln&&(a={visible:g.isDatasetVisible(n),index:n,fill:ho(o,n,C),chart:g,axis:l.controller.options.indexAxis,scale:l.vScale,line:o}),l.$filler=a,t.push(a);for(n=0;n<C;++n)a=t[n],a&&!1!==a.fill&&(a.fill=Zo(t,n,e.propagate))},beforeDraw(g,I,e){const C="beforeDraw"===e.drawTime,t=g.getSortedVisibleDatasetMetas(),l=g.chartArea;for(let n=t.length-1;n>=0;--n){const I=t[n].$filler;I&&(I.line.updateControlPoints(l,I.axis),C&&I.fill&&Wo(g.ctx,I,l))}},beforeDatasetsDraw(g,I,e){if("beforeDatasetsDraw"!==e.drawTime)return;const C=g.getSortedVisibleDatasetMetas();for(let t=C.length-1;t>=0;--t){const I=C[t].$filler;mo(I)&&Wo(g.ctx,I,g.chartArea)}},beforeDatasetDraw(g,I,e){const C=I.meta.$filler;mo(C)&&"beforeDatasetDraw"===e.drawTime&&Wo(g.ctx,C,g.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const ko=(g,I)=>{let{boxHeight:e=I,boxWidth:C=I}=g;return g.usePointStyle&&(e=Math.min(e,I),C=g.pointStyleWidth||Math.min(C,I)),{boxWidth:C,boxHeight:e,itemHeight:Math.max(I,e)}};class Yo extends El{constructor(g){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=g.chart,this.options=g.options,this.ctx=g.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(g,I,e){this.maxWidth=g,this.maxHeight=I,this._margins=e,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const g=this.options.labels||{};let I=zI(g.generateLabels,[this.chart],this)||[];g.filter&&(I=I.filter((I=>g.filter(I,this.chart.data)))),g.sort&&(I=I.sort(((I,e)=>g.sort(I,e,this.chart.data)))),this.options.reverse&&I.reverse(),this.legendItems=I}fit(){const{options:g,ctx:I}=this;if(!g.display)return void(this.width=this.height=0);const e=g.labels,C=VC(e.font),t=C.size,l=this._computeTitleHeight(),{boxWidth:n,itemHeight:o}=ko(e,t);let a,i;I.font=C.string,this.isHorizontal()?(a=this.maxWidth,i=this._fitRows(l,t,n,o)+10):(i=this.maxHeight,a=this._fitCols(l,C,n,o)+10),this.width=Math.min(a,g.maxWidth||this.maxWidth),this.height=Math.min(i,g.maxHeight||this.maxHeight)}_fitRows(g,I,e,C){const{ctx:t,maxWidth:l,options:{labels:{padding:n}}}=this,o=this.legendHitBoxes=[],a=this.lineWidths=[0],i=C+n;let A=g;t.textAlign="left",t.textBaseline="middle";let c=-1,s=-i;return this.legendItems.forEach(((g,d)=>{const r=e+I/2+t.measureText(g.text).width;(0===d||a[a.length-1]+r+2*n>l)&&(A+=i,a[a.length-(d>0?0:1)]=0,s+=i,c++),o[d]={left:0,top:s,row:c,width:r,height:C},a[a.length-1]+=r+n})),A}_fitCols(g,I,e,C){const{ctx:t,maxHeight:l,options:{labels:{padding:n}}}=this,o=this.legendHitBoxes=[],a=this.columnSizes=[],i=l-g;let A=n,c=0,s=0,d=0,r=0;return this.legendItems.forEach(((g,l)=>{const{itemWidth:b,itemHeight:u}=function(g,I,e,C,t){const l=function(g,I,e,C){let t=g.text;t&&"string"!==typeof t&&(t=t.reduce(((g,I)=>g.length>I.length?g:I)));return I+e.size/2+C.measureText(t).width}(C,g,I,e),n=function(g,I,e){let C=g;"string"!==typeof I.text&&(C=fo(I,e));return C}(t,C,I.lineHeight);return{itemWidth:l,itemHeight:n}}(e,I,t,g,C);l>0&&s+u+2*n>i&&(A+=c+n,a.push({width:c,height:s}),d+=c+n,r++,c=s=0),o[l]={left:d,top:s,col:r,width:b,height:u},c=Math.max(c,b),s+=u+n})),A+=c,a.push({width:c,height:s}),A}adjustHitBoxes(){if(!this.options.display)return;const g=this._computeTitleHeight(),{legendHitBoxes:I,options:{align:e,labels:{padding:C},rtl:t}}=this,l=ct(t,this.left,this.width);if(this.isHorizontal()){let t=0,n=He(e,this.left+C,this.right-this.lineWidths[t]);for(const o of I)t!==o.row&&(t=o.row,n=He(e,this.left+C,this.right-this.lineWidths[t])),o.top+=this.top+g+C,o.left=l.leftForLtr(l.x(n),o.width),n+=o.width+C}else{let t=0,n=He(e,this.top+g+C,this.bottom-this.columnSizes[t].height);for(const o of I)o.col!==t&&(t=o.col,n=He(e,this.top+g+C,this.bottom-this.columnSizes[t].height)),o.top=n,o.left+=this.left+C,o.left=l.leftForLtr(l.x(o.left),o.width),n+=o.height+C}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const g=this.ctx;iC(g,this),this._draw(),AC(g)}}_draw(){const{options:g,columnSizes:I,lineWidths:e,ctx:C}=this,{align:t,labels:l}=g,n=IC.color,o=ct(g.rtl,this.left,this.width),a=VC(l.font),{padding:i}=l,A=a.size,c=A/2;let s;this.drawTitle(),C.textAlign=o.textAlign("left"),C.textBaseline="middle",C.lineWidth=.5,C.font=a.string;const{boxWidth:d,boxHeight:r,itemHeight:b}=ko(l,A),u=this.isHorizontal(),m=this._computeTitleHeight();s=u?{x:He(t,this.left+i,this.right-e[0]),y:this.top+i+m,line:0}:{x:this.left+i,y:He(t,this.top+m+i,this.bottom-I[0].height),line:0},st(this.ctx,g.textDirection);const Z=b+i;this.legendItems.forEach(((h,G)=>{C.strokeStyle=h.fontColor,C.fillStyle=h.fontColor;const B=C.measureText(h.text).width,y=o.textAlign(h.textAlign||(h.textAlign=l.textAlign)),p=d+c+B;let W=s.x,V=s.y;o.setWidth(this.width),u?G>0&&W+p+i>this.right&&(V=s.y+=Z,s.line++,W=s.x=He(t,this.left+i,this.right-e[s.line])):G>0&&V+Z>this.bottom&&(W=s.x=W+I[s.line].width+i,s.line++,V=s.y=He(t,this.top+m+i,this.bottom-I[s.line].height));if(function(g,I,e){if(isNaN(d)||d<=0||isNaN(r)||r<0)return;C.save();const t=FI(e.lineWidth,1);if(C.fillStyle=FI(e.fillStyle,n),C.lineCap=FI(e.lineCap,"butt"),C.lineDashOffset=FI(e.lineDashOffset,0),C.lineJoin=FI(e.lineJoin,"miter"),C.lineWidth=t,C.strokeStyle=FI(e.strokeStyle,n),C.setLineDash(FI(e.lineDash,[])),l.usePointStyle){const n={radius:r*Math.SQRT2/2,pointStyle:e.pointStyle,rotation:e.rotation,borderWidth:t},a=o.xPlus(g,d/2);oC(C,n,a,I+c,l.pointStyleWidth&&d)}else{const l=I+Math.max((A-r)/2,0),n=o.leftForLtr(g,d),a=pC(e.borderRadius);C.beginPath(),Object.values(a).some((g=>0!==g))?uC(C,{x:n,y:l,w:d,h:r,radius:a}):C.rect(n,l,d,r),C.fill(),0!==t&&C.stroke()}C.restore()}(o.x(W),V,h),W=((g,I,e,C)=>g===(C?"left":"right")?e:"center"===g?(I+e)/2:I)(y,W+d+c,u?W+p:this.right,g.rtl),function(g,I,e){bC(C,e.text,g,I+b/2,a,{strikethrough:e.hidden,textAlign:o.textAlign(e.textAlign)})}(o.x(W),V,h),u)s.x+=p+i;else if("string"!==typeof h.text){const g=a.lineHeight;s.y+=fo(h,g)+i}else s.y+=Z})),dt(this.ctx,g.textDirection)}drawTitle(){const g=this.options,I=g.title,e=VC(I.font),C=WC(I.padding);if(!I.display)return;const t=ct(g.rtl,this.left,this.width),l=this.ctx,n=I.position,o=e.size/2,a=C.top+o;let i,A=this.left,c=this.width;if(this.isHorizontal())c=Math.max(...this.lineWidths),i=this.top+a,A=He(g.align,A,this.right-c);else{const I=this.columnSizes.reduce(((g,I)=>Math.max(g,I.height)),0);i=a+He(g.align,this.top,this.bottom-I-g.labels.padding-this._computeTitleHeight())}const s=He(n,A,A+c);l.textAlign=t.textAlign(ve(n)),l.textBaseline="middle",l.strokeStyle=I.color,l.fillStyle=I.color,l.font=e.string,bC(l,I.text,s,i,e)}_computeTitleHeight(){const g=this.options.title,I=VC(g.font),e=WC(g.padding);return g.display?I.lineHeight+e.height:0}_getLegendItemAt(g,I){let e,C,t;if(We(g,this.left,this.right)&&We(I,this.top,this.bottom))for(t=this.legendHitBoxes,e=0;e<t.length;++e)if(C=t[e],We(g,C.left,C.left+C.width)&&We(I,C.top,C.top+C.height))return this.legendItems[e];return null}handleEvent(g){const I=this.options;if(!function(g,I){if(("mousemove"===g||"mouseout"===g)&&(I.onHover||I.onLeave))return!0;if(I.onClick&&("click"===g||"mouseup"===g))return!0;return!1}(g.type,I))return;const e=this._getLegendItemAt(g.x,g.y);if("mousemove"===g.type||"mouseout"===g.type){const l=this._hoveredItem,n=(t=e,null!==(C=l)&&null!==t&&C.datasetIndex===t.datasetIndex&&C.index===t.index);l&&!n&&zI(I.onLeave,[g,l,this],this),this._hoveredItem=e,e&&!n&&zI(I.onHover,[g,e,this],this)}else e&&zI(I.onClick,[g,e,this],this);var C,t}}function fo(g,I){return I*(g.text?g.text.length:0)}var vo={id:"legend",_element:Yo,start(g,I,e){const C=g.legend=new Yo({ctx:g.ctx,options:e,chart:g});Wl.configure(g,C,e),Wl.addBox(g,C)},stop(g){Wl.removeBox(g,g.legend),delete g.legend},beforeUpdate(g,I,e){const C=g.legend;Wl.configure(g,C,e),C.options=e},afterUpdate(g){const I=g.legend;I.buildLabels(),I.adjustHitBoxes()},afterEvent(g,I){I.replay||g.legend.handleEvent(I.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(g,I,e){const C=I.datasetIndex,t=e.chart;t.isDatasetVisible(C)?(t.hide(C),I.hidden=!0):(t.show(C),I.hidden=!1)},onHover:null,onLeave:null,labels:{color:g=>g.chart.options.color,boxWidth:40,padding:10,generateLabels(g){const I=g.data.datasets,{labels:{usePointStyle:e,pointStyle:C,textAlign:t,color:l,useBorderRadius:n,borderRadius:o}}=g.legend.options;return g._getSortedDatasetMetas().map((g=>{const a=g.controller.getStyle(e?0:void 0),i=WC(a.borderWidth);return{text:I[g.index].label,fillStyle:a.backgroundColor,fontColor:l,hidden:!g.visible,lineCap:a.borderCapStyle,lineDash:a.borderDash,lineDashOffset:a.borderDashOffset,lineJoin:a.borderJoinStyle,lineWidth:(i.width+i.height)/4,strokeStyle:a.borderColor,pointStyle:C||a.pointStyle,rotation:a.rotation,textAlign:t||a.textAlign,borderRadius:n&&(o||a.borderRadius),datasetIndex:g.index}}),this)}},title:{color:g=>g.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:g=>!g.startsWith("on"),labels:{_scriptable:g=>!["generateLabels","filter","sort"].includes(g)}}};class Ho extends El{constructor(g){super(),this.chart=g.chart,this.options=g.options,this.ctx=g.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(g,I){const e=this.options;if(this.left=0,this.top=0,!e.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=g,this.height=this.bottom=I;const C=HI(e.text)?e.text.length:1;this._padding=WC(e.padding);const t=C*VC(e.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=t:this.width=t}isHorizontal(){const g=this.options.position;return"top"===g||"bottom"===g}_drawArgs(g){const{top:I,left:e,bottom:C,right:t,options:l}=this,n=l.align;let o,a,i,A=0;return this.isHorizontal()?(a=He(n,e,t),i=I+g,o=t-e):("left"===l.position?(a=e+g,i=He(n,C,I),A=-.5*Ie):(a=t-g,i=He(n,I,C),A=.5*Ie),o=C-I),{titleX:a,titleY:i,maxWidth:o,rotation:A}}draw(){const g=this.ctx,I=this.options;if(!I.display)return;const e=VC(I.font),C=e.lineHeight/2+this._padding.top,{titleX:t,titleY:l,maxWidth:n,rotation:o}=this._drawArgs(C);bC(g,I.text,0,0,e,{color:I.color,maxWidth:n,rotation:o,textAlign:ve(I.align),textBaseline:"middle",translation:[t,l]})}}var wo={id:"title",_element:Ho,start(g,I,e){!function(g,I){const e=new Ho({ctx:g.ctx,options:I,chart:g});Wl.configure(g,e,I),Wl.addBox(g,e),g.titleBlock=e}(g,e)},stop(g){const I=g.titleBlock;Wl.removeBox(g,I),delete g.titleBlock},beforeUpdate(g,I,e){const C=g.titleBlock;Wl.configure(g,C,e),C.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const No=new WeakMap;var Ko={id:"subtitle",start(g,I,e){const C=new Ho({ctx:g.ctx,options:e,chart:g});Wl.configure(g,C,e),Wl.addBox(g,C),No.set(g,C)},stop(g){Wl.removeBox(g,No.get(g)),No.delete(g)},beforeUpdate(g,I,e){const C=No.get(g);Wl.configure(g,C,e),C.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Fo={average(g){if(!g.length)return!1;let I,e,C=0,t=0,l=0;for(I=0,e=g.length;I<e;++I){const e=g[I].element;if(e&&e.hasValue()){const g=e.tooltipPosition();C+=g.x,t+=g.y,++l}}return{x:C/l,y:t/l}},nearest(g,I){if(!g.length)return!1;let e,C,t,l=I.x,n=I.y,o=Number.POSITIVE_INFINITY;for(e=0,C=g.length;e<C;++e){const C=g[e].element;if(C&&C.hasValue()){const g=he(I,C.getCenterPoint());g<o&&(o=g,t=C)}}if(t){const g=t.tooltipPosition();l=g.x,n=g.y}return{x:l,y:n}}};function xo(g,I){return I&&(HI(I)?Array.prototype.push.apply(g,I):g.push(I)),g}function zo(g){return("string"===typeof g||g instanceof String)&&g.indexOf("\n")>-1?g.split("\n"):g}function Mo(g,I){const{element:e,datasetIndex:C,index:t}=I,l=g.getDatasetMeta(C).controller,{label:n,value:o}=l.getLabelAndValue(t);return{chart:g,label:n,parsed:l.getParsed(t),raw:g.data.datasets[C].data[t],formattedValue:o,dataset:l.getDataset(),dataIndex:t,datasetIndex:C,element:e}}function Eo(g,I){const e=g.chart.ctx,{body:C,footer:t,title:l}=g,{boxWidth:n,boxHeight:o}=I,a=VC(I.bodyFont),i=VC(I.titleFont),A=VC(I.footerFont),c=l.length,s=t.length,d=C.length,r=WC(I.padding);let b=r.height,u=0,m=C.reduce(((g,I)=>g+I.before.length+I.lines.length+I.after.length),0);if(m+=g.beforeBody.length+g.afterBody.length,c&&(b+=c*i.lineHeight+(c-1)*I.titleSpacing+I.titleMarginBottom),m){b+=d*(I.displayColors?Math.max(o,a.lineHeight):a.lineHeight)+(m-d)*a.lineHeight+(m-1)*I.bodySpacing}s&&(b+=I.footerMarginTop+s*A.lineHeight+(s-1)*I.footerSpacing);let Z=0;const h=function(g){u=Math.max(u,e.measureText(g).width+Z)};return e.save(),e.font=i.string,MI(g.title,h),e.font=a.string,MI(g.beforeBody.concat(g.afterBody),h),Z=I.displayColors?n+2+I.boxPadding:0,MI(C,(g=>{MI(g.before,h),MI(g.lines,h),MI(g.after,h)})),Z=0,e.font=A.string,MI(g.footer,h),e.restore(),u+=r.width,{width:u,height:b}}function Qo(g,I,e,C){const{x:t,width:l}=e,{width:n,chartArea:{left:o,right:a}}=g;let i="center";return"center"===C?i=t<=(o+a)/2?"left":"right":t<=l/2?i="left":t>=n-l/2&&(i="right"),function(g,I,e,C){const{x:t,width:l}=C,n=e.caretSize+e.caretPadding;return"left"===g&&t+l+n>I.width||"right"===g&&t-l-n<0||void 0}(i,g,I,e)&&(i="center"),i}function Uo(g,I,e){const C=e.yAlign||I.yAlign||function(g,I){const{y:e,height:C}=I;return e<C/2?"top":e>g.height-C/2?"bottom":"center"}(g,e);return{xAlign:e.xAlign||I.xAlign||Qo(g,I,e,C),yAlign:C}}function Lo(g,I,e,C){const{caretSize:t,caretPadding:l,cornerRadius:n}=g,{xAlign:o,yAlign:a}=e,i=t+l,{topLeft:A,topRight:c,bottomLeft:s,bottomRight:d}=pC(n);let r=function(g,I){let{x:e,width:C}=g;return"right"===I?e-=C:"center"===I&&(e-=C/2),e}(I,o);const b=function(g,I,e){let{y:C,height:t}=g;return"top"===I?C+=e:C-="bottom"===I?t+e:t/2,C}(I,a,i);return"center"===a?"left"===o?r+=i:"right"===o&&(r-=i):"left"===o?r-=Math.max(A,s)+t:"right"===o&&(r+=Math.max(c,d)+t),{x:pe(r,0,C.width-I.width),y:pe(b,0,C.height-I.height)}}function Do(g,I,e){const C=WC(e.padding);return"center"===I?g.x+g.width/2:"right"===I?g.x+g.width-C.right:g.x+C.left}function To(g){return xo([],zo(g))}function jo(g,I){const e=I&&I.dataset&&I.dataset.tooltip&&I.dataset.tooltip.callbacks;return e?g.override(e):g}const Po={beforeTitle:YI,title(g){if(g.length>0){const I=g[0],e=I.chart.data.labels,C=e?e.length:0;if(this&&this.options&&"dataset"===this.options.mode)return I.dataset.label||"";if(I.label)return I.label;if(C>0&&I.dataIndex<C)return e[I.dataIndex]}return""},afterTitle:YI,beforeBody:YI,beforeLabel:YI,label(g){if(this&&this.options&&"dataset"===this.options.mode)return g.label+": "+g.formattedValue||g.formattedValue;let I=g.dataset.label||"";I&&(I+=": ");const e=g.formattedValue;return vI(e)||(I+=e),I},labelColor(g){const I=g.chart.getDatasetMeta(g.datasetIndex).controller.getStyle(g.dataIndex);return{borderColor:I.borderColor,backgroundColor:I.backgroundColor,borderWidth:I.borderWidth,borderDash:I.borderDash,borderDashOffset:I.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(g){const I=g.chart.getDatasetMeta(g.datasetIndex).controller.getStyle(g.dataIndex);return{pointStyle:I.pointStyle,rotation:I.rotation}},afterLabel:YI,afterBody:YI,beforeFooter:YI,footer:YI,afterFooter:YI};function Oo(g,I,e,C){const t=g[I].call(e,C);return"undefined"===typeof t?Po[I].call(e,C):t}class _o extends El{constructor(g){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=g.chart,this.options=g.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(g){this.options=g,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const g=this._cachedAnimations;if(g)return g;const I=this.chart,e=this.options.setContext(this.getContext()),C=e.enabled&&I.options.animation&&e.animations,t=new St(this.chart,C);return C._cacheable&&(this._cachedAnimations=Object.freeze(t)),t}getContext(){return this.$context||(this.$context=(g=this.chart.getContext(),I=this,e=this._tooltipItems,XC(g,{tooltip:I,tooltipItems:e,type:"tooltip"})));var g,I,e}getTitle(g,I){const{callbacks:e}=I,C=Oo(e,"beforeTitle",this,g),t=Oo(e,"title",this,g),l=Oo(e,"afterTitle",this,g);let n=[];return n=xo(n,zo(C)),n=xo(n,zo(t)),n=xo(n,zo(l)),n}getBeforeBody(g,I){return To(Oo(I.callbacks,"beforeBody",this,g))}getBody(g,I){const{callbacks:e}=I,C=[];return MI(g,(g=>{const I={before:[],lines:[],after:[]},t=jo(e,g);xo(I.before,zo(Oo(t,"beforeLabel",this,g))),xo(I.lines,Oo(t,"label",this,g)),xo(I.after,zo(Oo(t,"afterLabel",this,g))),C.push(I)})),C}getAfterBody(g,I){return To(Oo(I.callbacks,"afterBody",this,g))}getFooter(g,I){const{callbacks:e}=I,C=Oo(e,"beforeFooter",this,g),t=Oo(e,"footer",this,g),l=Oo(e,"afterFooter",this,g);let n=[];return n=xo(n,zo(C)),n=xo(n,zo(t)),n=xo(n,zo(l)),n}_createItems(g){const I=this._active,e=this.chart.data,C=[],t=[],l=[];let n,o,a=[];for(n=0,o=I.length;n<o;++n)a.push(Mo(this.chart,I[n]));return g.filter&&(a=a.filter(((I,C,t)=>g.filter(I,C,t,e)))),g.itemSort&&(a=a.sort(((I,C)=>g.itemSort(I,C,e)))),MI(a,(I=>{const e=jo(g.callbacks,I);C.push(Oo(e,"labelColor",this,I)),t.push(Oo(e,"labelPointStyle",this,I)),l.push(Oo(e,"labelTextColor",this,I))})),this.labelColors=C,this.labelPointStyles=t,this.labelTextColors=l,this.dataPoints=a,a}update(g,I){const e=this.options.setContext(this.getContext()),C=this._active;let t,l=[];if(C.length){const g=Fo[e.position].call(this,C,this._eventPosition);l=this._createItems(e),this.title=this.getTitle(l,e),this.beforeBody=this.getBeforeBody(l,e),this.body=this.getBody(l,e),this.afterBody=this.getAfterBody(l,e),this.footer=this.getFooter(l,e);const I=this._size=Eo(this,e),n=Object.assign({},g,I),o=Uo(this.chart,e,n),a=Lo(e,n,o,this.chart);this.xAlign=o.xAlign,this.yAlign=o.yAlign,t={opacity:1,x:a.x,y:a.y,width:I.width,height:I.height,caretX:g.x,caretY:g.y}}else 0!==this.opacity&&(t={opacity:0});this._tooltipItems=l,this.$context=void 0,t&&this._resolveAnimations().update(this,t),g&&e.external&&e.external.call(this,{chart:this.chart,tooltip:this,replay:I})}drawCaret(g,I,e,C){const t=this.getCaretPosition(g,e,C);I.lineTo(t.x1,t.y1),I.lineTo(t.x2,t.y2),I.lineTo(t.x3,t.y3)}getCaretPosition(g,I,e){const{xAlign:C,yAlign:t}=this,{caretSize:l,cornerRadius:n}=e,{topLeft:o,topRight:a,bottomLeft:i,bottomRight:A}=pC(n),{x:c,y:s}=g,{width:d,height:r}=I;let b,u,m,Z,h,G;return"center"===t?(h=s+r/2,"left"===C?(b=c,u=b-l,Z=h+l,G=h-l):(b=c+d,u=b+l,Z=h-l,G=h+l),m=b):(u="left"===C?c+Math.max(o,i)+l:"right"===C?c+d-Math.max(a,A)-l:this.caretX,"top"===t?(Z=s,h=Z-l,b=u-l,m=u+l):(Z=s+r,h=Z+l,b=u+l,m=u-l),G=Z),{x1:b,x2:u,x3:m,y1:Z,y2:h,y3:G}}drawTitle(g,I,e){const C=this.title,t=C.length;let l,n,o;if(t){const a=ct(e.rtl,this.x,this.width);for(g.x=Do(this,e.titleAlign,e),I.textAlign=a.textAlign(e.titleAlign),I.textBaseline="middle",l=VC(e.titleFont),n=e.titleSpacing,I.fillStyle=e.titleColor,I.font=l.string,o=0;o<t;++o)I.fillText(C[o],a.x(g.x),g.y+l.lineHeight/2),g.y+=l.lineHeight+n,o+1===t&&(g.y+=e.titleMarginBottom-n)}}_drawColorBox(g,I,e,C,t){const l=this.labelColors[e],n=this.labelPointStyles[e],{boxHeight:o,boxWidth:a}=t,i=VC(t.bodyFont),A=Do(this,"left",t),c=C.x(A),s=o<i.lineHeight?(i.lineHeight-o)/2:0,d=I.y+s;if(t.usePointStyle){const I={radius:Math.min(a,o)/2,pointStyle:n.pointStyle,rotation:n.rotation,borderWidth:1},e=C.leftForLtr(c,a)+a/2,i=d+o/2;g.strokeStyle=t.multiKeyBackground,g.fillStyle=t.multiKeyBackground,nC(g,I,e,i),g.strokeStyle=l.borderColor,g.fillStyle=l.backgroundColor,nC(g,I,e,i)}else{g.lineWidth=wI(l.borderWidth)?Math.max(...Object.values(l.borderWidth)):l.borderWidth||1,g.strokeStyle=l.borderColor,g.setLineDash(l.borderDash||[]),g.lineDashOffset=l.borderDashOffset||0;const I=C.leftForLtr(c,a),e=C.leftForLtr(C.xPlus(c,1),a-2),n=pC(l.borderRadius);Object.values(n).some((g=>0!==g))?(g.beginPath(),g.fillStyle=t.multiKeyBackground,uC(g,{x:I,y:d,w:a,h:o,radius:n}),g.fill(),g.stroke(),g.fillStyle=l.backgroundColor,g.beginPath(),uC(g,{x:e,y:d+1,w:a-2,h:o-2,radius:n}),g.fill()):(g.fillStyle=t.multiKeyBackground,g.fillRect(I,d,a,o),g.strokeRect(I,d,a,o),g.fillStyle=l.backgroundColor,g.fillRect(e,d+1,a-2,o-2))}g.fillStyle=this.labelTextColors[e]}drawBody(g,I,e){const{body:C}=this,{bodySpacing:t,bodyAlign:l,displayColors:n,boxHeight:o,boxWidth:a,boxPadding:i}=e,A=VC(e.bodyFont);let c=A.lineHeight,s=0;const d=ct(e.rtl,this.x,this.width),r=function(e){I.fillText(e,d.x(g.x+s),g.y+c/2),g.y+=c+t},b=d.textAlign(l);let u,m,Z,h,G,B,y;for(I.textAlign=l,I.textBaseline="middle",I.font=A.string,g.x=Do(this,b,e),I.fillStyle=e.bodyColor,MI(this.beforeBody,r),s=n&&"right"!==b?"center"===l?a/2+i:a+2+i:0,h=0,B=C.length;h<B;++h){for(u=C[h],m=this.labelTextColors[h],I.fillStyle=m,MI(u.before,r),Z=u.lines,n&&Z.length&&(this._drawColorBox(I,g,h,d,e),c=Math.max(A.lineHeight,o)),G=0,y=Z.length;G<y;++G)r(Z[G]),c=A.lineHeight;MI(u.after,r)}s=0,c=A.lineHeight,MI(this.afterBody,r),g.y-=t}drawFooter(g,I,e){const C=this.footer,t=C.length;let l,n;if(t){const o=ct(e.rtl,this.x,this.width);for(g.x=Do(this,e.footerAlign,e),g.y+=e.footerMarginTop,I.textAlign=o.textAlign(e.footerAlign),I.textBaseline="middle",l=VC(e.footerFont),I.fillStyle=e.footerColor,I.font=l.string,n=0;n<t;++n)I.fillText(C[n],o.x(g.x),g.y+l.lineHeight/2),g.y+=l.lineHeight+e.footerSpacing}}drawBackground(g,I,e,C){const{xAlign:t,yAlign:l}=this,{x:n,y:o}=g,{width:a,height:i}=e,{topLeft:A,topRight:c,bottomLeft:s,bottomRight:d}=pC(C.cornerRadius);I.fillStyle=C.backgroundColor,I.strokeStyle=C.borderColor,I.lineWidth=C.borderWidth,I.beginPath(),I.moveTo(n+A,o),"top"===l&&this.drawCaret(g,I,e,C),I.lineTo(n+a-c,o),I.quadraticCurveTo(n+a,o,n+a,o+c),"center"===l&&"right"===t&&this.drawCaret(g,I,e,C),I.lineTo(n+a,o+i-d),I.quadraticCurveTo(n+a,o+i,n+a-d,o+i),"bottom"===l&&this.drawCaret(g,I,e,C),I.lineTo(n+s,o+i),I.quadraticCurveTo(n,o+i,n,o+i-s),"center"===l&&"left"===t&&this.drawCaret(g,I,e,C),I.lineTo(n,o+A),I.quadraticCurveTo(n,o,n+A,o),I.closePath(),I.fill(),C.borderWidth>0&&I.stroke()}_updateAnimationTarget(g){const I=this.chart,e=this.$animations,C=e&&e.x,t=e&&e.y;if(C||t){const e=Fo[g.position].call(this,this._active,this._eventPosition);if(!e)return;const l=this._size=Eo(this,g),n=Object.assign({},e,this._size),o=Uo(I,g,n),a=Lo(g,n,o,I);C._to===a.x&&t._to===a.y||(this.xAlign=o.xAlign,this.yAlign=o.yAlign,this.width=l.width,this.height=l.height,this.caretX=e.x,this.caretY=e.y,this._resolveAnimations().update(this,a))}}_willRender(){return!!this.opacity}draw(g){const I=this.options.setContext(this.getContext());let e=this.opacity;if(!e)return;this._updateAnimationTarget(I);const C={width:this.width,height:this.height},t={x:this.x,y:this.y};e=Math.abs(e)<.001?0:e;const l=WC(I.padding),n=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;I.enabled&&n&&(g.save(),g.globalAlpha=e,this.drawBackground(t,g,C,I),st(g,I.textDirection),t.y+=l.top,this.drawTitle(t,g,I),this.drawBody(t,g,I),this.drawFooter(t,g,I),dt(g,I.textDirection),g.restore())}getActiveElements(){return this._active||[]}setActiveElements(g,I){const e=this._active,C=g.map((g=>{let{datasetIndex:I,index:e}=g;const C=this.chart.getDatasetMeta(I);if(!C)throw new Error("Cannot find a dataset at index "+I);return{datasetIndex:I,element:C.data[e],index:e}})),t=!EI(e,C),l=this._positionChanged(C,I);(t||l)&&(this._active=C,this._eventPosition=I,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(g,I){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(I&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const C=this.options,t=this._active||[],l=this._getActiveElements(g,t,I,e),n=this._positionChanged(l,g),o=I||!EI(l,t)||n;return o&&(this._active=l,(C.enabled||C.external)&&(this._eventPosition={x:g.x,y:g.y},this.update(!0,I))),o}_getActiveElements(g,I,e,C){const t=this.options;if("mouseout"===g.type)return[];if(!C)return I.filter((g=>this.chart.data.datasets[g.datasetIndex]&&void 0!==this.chart.getDatasetMeta(g.datasetIndex).controller.getParsed(g.index)));const l=this.chart.getElementsAtEventForMode(g,t.mode,t,e);return t.reverse&&l.reverse(),l}_positionChanged(g,I){const{caretX:e,caretY:C,options:t}=this,l=Fo[t.position].call(this,g,I);return!1!==l&&(e!==l.x||C!==l.y)}}_g(_o,"positioners",Fo);var qo={id:"tooltip",_element:_o,positioners:Fo,afterInit(g,I,e){e&&(g.tooltip=new _o({chart:g,options:e}))},beforeUpdate(g,I,e){g.tooltip&&g.tooltip.initialize(e)},reset(g,I,e){g.tooltip&&g.tooltip.initialize(e)},afterDraw(g){const I=g.tooltip;if(I&&I._willRender()){const e={tooltip:I};if(!1===g.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0}))return;I.draw(g.ctx),g.notifyPlugins("afterTooltipDraw",e)}},afterEvent(g,I){if(g.tooltip){const e=I.replay;g.tooltip.handleEvent(I.event,e,I.inChartArea)&&(I.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(g,I)=>I.bodyFont.size,boxWidth:(g,I)=>I.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Po},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:g=>"filter"!==g&&"itemSort"!==g&&"external"!==g,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},$o=Object.freeze({__proto__:null,Colors:ao,Decimation:co,Filler:Jo,Legend:vo,SubTitle:Ko,Title:wo,Tooltip:qo});function ga(g,I,e,C){const t=g.indexOf(I);if(-1===t)return((g,I,e,C)=>("string"===typeof I?(e=g.push(I)-1,C.unshift({index:e,label:I})):isNaN(I)&&(e=null),e))(g,I,e,C);return t!==g.lastIndexOf(I)?e:t}function Ia(g){const I=this.getLabels();return g>=0&&g<I.length?I[g]:g}class ea extends ql{constructor(g){super(g),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(g){const I=this._addedLabels;if(I.length){const g=this.getLabels();for(const{index:e,label:C}of I)g[e]===C&&g.splice(e,1);this._addedLabels=[]}super.init(g)}parse(g,I){if(vI(g))return null;const e=this.getLabels();return((g,I)=>null===g?null:pe(Math.round(g),0,I))(I=isFinite(I)&&e[I]===g?I:ga(e,g,FI(I,g),this._addedLabels),e.length-1)}determineDataLimits(){const{minDefined:g,maxDefined:I}=this.getUserBounds();let{min:e,max:C}=this.getMinMax(!0);"ticks"===this.options.bounds&&(g||(e=0),I||(C=this.getLabels().length-1)),this.min=e,this.max=C}buildTicks(){const g=this.min,I=this.max,e=this.options.offset,C=[];let t=this.getLabels();t=0===g&&I===t.length-1?t:t.slice(g,I+1),this._valueRange=Math.max(t.length-(e?0:1),1),this._startValue=this.min-(e?.5:0);for(let l=g;l<=I;l++)C.push({value:l});return C}getLabelForValue(g){return Ia.call(this,g)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(g){return"number"!==typeof g&&(g=this.parse(g)),null===g?NaN:this.getPixelForDecimal((g-this._startValue)/this._valueRange)}getPixelForTick(g){const I=this.ticks;return g<0||g>I.length-1?null:this.getPixelForValue(I[g].value)}getValueForPixel(g){return Math.round(this._startValue+this.getDecimalForPixel(g)*this._valueRange)}getBasePixel(){return this.bottom}}function Ca(g,I){const e=[],{bounds:C,step:t,min:l,max:n,precision:o,count:a,maxTicks:i,maxDigits:A,includeBounds:c}=g,s=t||1,d=i-1,{min:r,max:b}=I,u=!vI(l),m=!vI(n),Z=!vI(a),h=(b-r)/(A+1);let G,B,y,p,W=se((b-r)/d/s)*s;if(W<1e-14&&!u&&!m)return[{value:r},{value:b}];p=Math.ceil(b/W)-Math.floor(r/W),p>d&&(W=se(p*W/d/s)*s),vI(o)||(G=Math.pow(10,o),W=Math.ceil(W*G)/G),"ticks"===C?(B=Math.floor(r/W)*W,y=Math.ceil(b/W)*W):(B=r,y=b),u&&m&&t&&function(g,I){const e=Math.round(g);return e-I<=g&&e+I>=g}((n-l)/t,W/1e3)?(p=Math.round(Math.min((n-l)/W,i)),W=(n-l)/p,B=l,y=n):Z?(B=u?l:B,y=m?n:y,p=a-1,W=(y-B)/p):(p=(y-B)/W,p=ce(p,Math.round(p),W/1e3)?Math.round(p):Math.ceil(p));const V=Math.max(me(W),me(B));G=Math.pow(10,vI(o)?V:o),B=Math.round(B*G)/G,y=Math.round(y*G)/G;let S=0;for(u&&(c&&B!==l?(e.push({value:l}),B<l&&S++,ce(Math.round((B+S*W)*G)/G,l,ta(l,h,g))&&S++):B<l&&S++);S<p;++S){const g=Math.round((B+S*W)*G)/G;if(m&&g>n)break;e.push({value:g})}return m&&c&&y!==n?e.length&&ce(e[e.length-1].value,n,ta(n,h,g))?e[e.length-1].value=n:e.push({value:n}):m&&y!==n||e.push({value:y}),e}function ta(g,I,e){let{horizontal:C,minRotation:t}=e;const l=be(t),n=(C?Math.sin(l):Math.cos(l))||.001,o=.75*I*(""+g).length;return Math.min(I/n,o)}_g(ea,"id","category"),_g(ea,"defaults",{ticks:{callback:Ia}});class la extends ql{constructor(g){super(g),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(g,I){return vI(g)||("number"===typeof g||g instanceof Number)&&!isFinite(+g)?null:+g}handleTickRangeOptions(){const{beginAtZero:g}=this.options,{minDefined:I,maxDefined:e}=this.getUserBounds();let{min:C,max:t}=this;const l=g=>C=I?C:g,n=g=>t=e?t:g;if(g){const g=Ae(C),I=Ae(t);g<0&&I<0?n(0):g>0&&I>0&&l(0)}if(C===t){let I=0===t?1:Math.abs(.05*t);n(t+I),g||l(C-I)}this.min=C,this.max=t}getTickLimit(){const g=this.options.ticks;let I,{maxTicksLimit:e,stepSize:C}=g;return C?(I=Math.ceil(this.max/C)-Math.floor(this.min/C)+1,I>1e3&&(console.warn("scales.".concat(this.id,".ticks.stepSize: ").concat(C," would result generating up to ").concat(I," ticks. Limiting to 1000.")),I=1e3)):(I=this.computeTickLimit(),e=e||11),e&&(I=Math.min(e,I)),I}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const g=this.options,I=g.ticks;let e=this.getTickLimit();e=Math.max(2,e);const C=Ca({maxTicks:e,bounds:g.bounds,min:g.min,max:g.max,precision:I.precision,step:I.stepSize,count:I.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:I.minRotation||0,includeBounds:!1!==I.includeBounds},this._range||this);return"ticks"===g.bounds&&re(C,this,"value"),g.reverse?(C.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),C}configure(){const g=this.ticks;let I=this.min,e=this.max;if(super.configure(),this.options.offset&&g.length){const C=(e-I)/Math.max(g.length-1,1)/2;I-=C,e+=C}this._startValue=I,this._endValue=e,this._valueRange=e-I}getLabelForValue(g){return Te(g,this.chart.options.locale,this.options.ticks.format)}}class na extends la{determineDataLimits(){const{min:g,max:I}=this.getMinMax(!0);this.min=NI(g)?g:0,this.max=NI(I)?I:1,this.handleTickRangeOptions()}computeTickLimit(){const g=this.isHorizontal(),I=g?this.width:this.height,e=be(this.options.ticks.minRotation),C=(g?Math.sin(e):Math.cos(e))||.001,t=this._resolveTickFontOptions(0);return Math.ceil(I/Math.min(40,t.lineHeight/C))}getPixelForValue(g){return null===g?NaN:this.getPixelForDecimal((g-this._startValue)/this._valueRange)}getValueForPixel(g){return this._startValue+this.getDecimalForPixel(g)*this._valueRange}}_g(na,"id","linear"),_g(na,"defaults",{ticks:{callback:Pe.formatters.numeric}});const oa=g=>Math.floor(ie(g)),aa=(g,I)=>Math.pow(10,oa(g)+I);function ia(g){return 1===g/Math.pow(10,oa(g))}function Aa(g,I,e){const C=Math.pow(10,e),t=Math.floor(g/C);return Math.ceil(I/C)-t}function ca(g,I){let{min:e,max:C}=I;e=KI(g.min,e);const t=[],l=oa(e);let n=function(g,I){let e=oa(I-g);for(;Aa(g,I,e)>10;)e++;for(;Aa(g,I,e)<10;)e--;return Math.min(e,oa(g))}(e,C),o=n<0?Math.pow(10,Math.abs(n)):1;const a=Math.pow(10,n),i=l>n?Math.pow(10,l):0,A=Math.round((e-i)*o)/o,c=Math.floor((e-i)/a/10)*a*10;let s=Math.floor((A-c)/Math.pow(10,n)),d=KI(g.min,Math.round((i+c+s*Math.pow(10,n))*o)/o);for(;d<C;)t.push({value:d,major:ia(d),significand:s}),s>=10?s=s<15?15:20:s++,s>=20&&(n++,s=2,o=n>=0?1:o),d=Math.round((i+c+s*Math.pow(10,n))*o)/o;const r=KI(g.max,d);return t.push({value:r,major:ia(r),significand:s}),t}class sa extends ql{constructor(g){super(g),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(g,I){const e=la.prototype.parse.apply(this,[g,I]);if(0!==e)return NI(e)&&e>0?e:null;this._zero=!0}determineDataLimits(){const{min:g,max:I}=this.getMinMax(!0);this.min=NI(g)?Math.max(0,g):null,this.max=NI(I)?Math.max(0,I):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!NI(this._userMin)&&(this.min=g===aa(this.min,0)?aa(this.min,-1):aa(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:g,maxDefined:I}=this.getUserBounds();let e=this.min,C=this.max;const t=I=>e=g?e:I,l=g=>C=I?C:g;e===C&&(e<=0?(t(1),l(10)):(t(aa(e,-1)),l(aa(C,1)))),e<=0&&t(aa(C,-1)),C<=0&&l(aa(e,1)),this.min=e,this.max=C}buildTicks(){const g=this.options,I=ca({min:this._userMin,max:this._userMax},this);return"ticks"===g.bounds&&re(I,this,"value"),g.reverse?(I.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),I}getLabelForValue(g){return void 0===g?"0":Te(g,this.chart.options.locale,this.options.ticks.format)}configure(){const g=this.min;super.configure(),this._startValue=ie(g),this._valueRange=ie(this.max)-ie(g)}getPixelForValue(g){return void 0!==g&&0!==g||(g=this.min),null===g||isNaN(g)?NaN:this.getPixelForDecimal(g===this.min?0:(ie(g)-this._startValue)/this._valueRange)}getValueForPixel(g){const I=this.getDecimalForPixel(g);return Math.pow(10,this._startValue+I*this._valueRange)}}function da(g){const I=g.ticks;if(I.display&&g.display){const g=WC(I.backdropPadding);return FI(I.font&&I.font.size,IC.font.size)+g.height}return 0}function ra(g,I,e,C,t){return g===C||g===t?{start:I-e/2,end:I+e/2}:g<C||g>t?{start:I-e,end:I}:{start:I,end:I+e}}function ba(g){const I={l:g.left+g._padding.left,r:g.right-g._padding.right,t:g.top+g._padding.top,b:g.bottom-g._padding.bottom},e=Object.assign({},I),C=[],t=[],l=g._pointLabels.length,n=g.options.pointLabels,o=n.centerPointLabels?Ie/l:0;for(let c=0;c<l;c++){const l=n.setContext(g.getPointLabelContext(c));t[c]=l.padding;const s=g.getPointPosition(c,g.drawingArea+t[c],o),d=VC(l.font),r=(a=g.ctx,i=d,A=HI(A=g._pointLabels[c])?A:[A],{w:CC(a,i.string,A),h:A.length*i.lineHeight});C[c]=r;const b=Be(g.getIndexAngle(c)+o),u=Math.round(ue(b));ua(e,I,b,ra(u,s.x,r.w,0,180),ra(u,s.y,r.h,90,270))}var a,i,A;g.setCenterPoint(I.l-e.l,e.r-I.r,I.t-e.t,e.b-I.b),g._pointLabelItems=function(g,I,e){const C=[],t=g._pointLabels.length,l=g.options,{centerPointLabels:n,display:o}=l.pointLabels,a={extra:da(l)/2,additionalAngle:n?Ie/t:0};let i;for(let A=0;A<t;A++){a.padding=e[A],a.size=I[A];const t=ma(g,A,a);C.push(t),"auto"===o&&(t.visible=Za(t,i),t.visible&&(i=t))}return C}(g,C,t)}function ua(g,I,e,C,t){const l=Math.abs(Math.sin(e)),n=Math.abs(Math.cos(e));let o=0,a=0;C.start<I.l?(o=(I.l-C.start)/l,g.l=Math.min(g.l,I.l-o)):C.end>I.r&&(o=(C.end-I.r)/l,g.r=Math.max(g.r,I.r+o)),t.start<I.t?(a=(I.t-t.start)/n,g.t=Math.min(g.t,I.t-a)):t.end>I.b&&(a=(t.end-I.b)/n,g.b=Math.max(g.b,I.b+a))}function ma(g,I,e){const C=g.drawingArea,{extra:t,additionalAngle:l,padding:n,size:o}=e,a=g.getPointPosition(I,C+t+n,l),i=Math.round(ue(Be(a.angle+ne))),A=function(g,I,e){90===e||270===e?g-=I/2:(e>270||e<90)&&(g-=I);return g}(a.y,o.h,i),c=function(g){if(0===g||180===g)return"center";if(g<180)return"left";return"right"}(i),s=function(g,I,e){"right"===e?g-=I:"center"===e&&(g-=I/2);return g}(a.x,o.w,c);return{visible:!0,x:a.x,y:A,textAlign:c,left:s,top:A,right:s+o.w,bottom:A+o.h}}function Za(g,I){if(!I)return!0;const{left:e,top:C,right:t,bottom:l}=g;return!(aC({x:e,y:C},I)||aC({x:e,y:l},I)||aC({x:t,y:C},I)||aC({x:t,y:l},I))}function ha(g,I,e){const{left:C,top:t,right:l,bottom:n}=e,{backdropColor:o}=I;if(!vI(o)){const e=pC(I.borderRadius),a=WC(I.backdropPadding);g.fillStyle=o;const i=C-a.left,A=t-a.top,c=l-C+a.width,s=n-t+a.height;Object.values(e).some((g=>0!==g))?(g.beginPath(),uC(g,{x:i,y:A,w:c,h:s,radius:e}),g.fill()):g.fillRect(i,A,c,s)}}function Ga(g,I,e,C){const{ctx:t}=g;if(e)t.arc(g.xCenter,g.yCenter,I,0,ee);else{let e=g.getPointPosition(0,I);t.moveTo(e.x,e.y);for(let l=1;l<C;l++)e=g.getPointPosition(l,I),t.lineTo(e.x,e.y)}}_g(sa,"id","logarithmic"),_g(sa,"defaults",{ticks:{callback:Pe.formatters.logarithmic,major:{enabled:!0}}});class Ba extends la{constructor(g){super(g),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const g=this._padding=WC(da(this.options)/2),I=this.width=this.maxWidth-g.width,e=this.height=this.maxHeight-g.height;this.xCenter=Math.floor(this.left+I/2+g.left),this.yCenter=Math.floor(this.top+e/2+g.top),this.drawingArea=Math.floor(Math.min(I,e)/2)}determineDataLimits(){const{min:g,max:I}=this.getMinMax(!1);this.min=NI(g)&&!isNaN(g)?g:0,this.max=NI(I)&&!isNaN(I)?I:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/da(this.options))}generateTickLabels(g){la.prototype.generateTickLabels.call(this,g),this._pointLabels=this.getLabels().map(((g,I)=>{const e=zI(this.options.pointLabels.callback,[g,I],this);return e||0===e?e:""})).filter(((g,I)=>this.chart.getDataVisibility(I)))}fit(){const g=this.options;g.display&&g.pointLabels.display?ba(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(g,I,e,C){this.xCenter+=Math.floor((g-I)/2),this.yCenter+=Math.floor((e-C)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(g,I,e,C))}getIndexAngle(g){return Be(g*(ee/(this._pointLabels.length||1))+be(this.options.startAngle||0))}getDistanceFromCenterForValue(g){if(vI(g))return NaN;const I=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-g)*I:(g-this.min)*I}getValueForDistanceFromCenter(g){if(vI(g))return NaN;const I=g/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-I:this.min+I}getPointLabelContext(g){const I=this._pointLabels||[];if(g>=0&&g<I.length){const e=I[g];return function(g,I,e){return XC(g,{label:e,index:I,type:"pointLabel"})}(this.getContext(),g,e)}}getPointPosition(g,I){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const C=this.getIndexAngle(g)-ne+e;return{x:Math.cos(C)*I+this.xCenter,y:Math.sin(C)*I+this.yCenter,angle:C}}getPointPositionForValue(g,I){return this.getPointPosition(g,this.getDistanceFromCenterForValue(I))}getBasePosition(g){return this.getPointPositionForValue(g||0,this.getBaseValue())}getPointLabelPosition(g){const{left:I,top:e,right:C,bottom:t}=this._pointLabelItems[g];return{left:I,top:e,right:C,bottom:t}}drawBackground(){const{backgroundColor:g,grid:{circular:I}}=this.options;if(g){const e=this.ctx;e.save(),e.beginPath(),Ga(this,this.getDistanceFromCenterForValue(this._endValue),I,this._pointLabels.length),e.closePath(),e.fillStyle=g,e.fill(),e.restore()}}drawGrid(){const g=this.ctx,I=this.options,{angleLines:e,grid:C,border:t}=I,l=this._pointLabels.length;let n,o,a;if(I.pointLabels.display&&function(g,I){const{ctx:e,options:{pointLabels:C}}=g;for(let t=I-1;t>=0;t--){const I=g._pointLabelItems[t];if(!I.visible)continue;const l=C.setContext(g.getPointLabelContext(t));ha(e,l,I);const n=VC(l.font),{x:o,y:a,textAlign:i}=I;bC(e,g._pointLabels[t],o,a+n.lineHeight/2,n,{color:l.color,textAlign:i,textBaseline:"middle"})}}(this,l),C.display&&this.ticks.forEach(((g,I)=>{if(0!==I){o=this.getDistanceFromCenterForValue(g.value);const e=this.getContext(I),n=C.setContext(e),a=t.setContext(e);!function(g,I,e,C,t){const l=g.ctx,n=I.circular,{color:o,lineWidth:a}=I;!n&&!C||!o||!a||e<0||(l.save(),l.strokeStyle=o,l.lineWidth=a,l.setLineDash(t.dash),l.lineDashOffset=t.dashOffset,l.beginPath(),Ga(g,e,n,C),l.closePath(),l.stroke(),l.restore())}(this,n,o,l,a)}})),e.display){for(g.save(),n=l-1;n>=0;n--){const C=e.setContext(this.getPointLabelContext(n)),{color:t,lineWidth:l}=C;l&&t&&(g.lineWidth=l,g.strokeStyle=t,g.setLineDash(C.borderDash),g.lineDashOffset=C.borderDashOffset,o=this.getDistanceFromCenterForValue(I.ticks.reverse?this.min:this.max),a=this.getPointPosition(n,o),g.beginPath(),g.moveTo(this.xCenter,this.yCenter),g.lineTo(a.x,a.y),g.stroke())}g.restore()}}drawBorder(){}drawLabels(){const g=this.ctx,I=this.options,e=I.ticks;if(!e.display)return;const C=this.getIndexAngle(0);let t,l;g.save(),g.translate(this.xCenter,this.yCenter),g.rotate(C),g.textAlign="center",g.textBaseline="middle",this.ticks.forEach(((C,n)=>{if(0===n&&!I.reverse)return;const o=e.setContext(this.getContext(n)),a=VC(o.font);if(t=this.getDistanceFromCenterForValue(this.ticks[n].value),o.showLabelBackdrop){g.font=a.string,l=g.measureText(C.label).width,g.fillStyle=o.backdropColor;const I=WC(o.backdropPadding);g.fillRect(-l/2-I.left,-t-a.size/2-I.top,l+I.width,a.size+I.height)}bC(g,C.label,0,-t,a,{color:o.color,strokeColor:o.textStrokeColor,strokeWidth:o.textStrokeWidth})})),g.restore()}drawTitle(){}}_g(Ba,"id","radialLinear"),_g(Ba,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Pe.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:g=>g,padding:5,centerPointLabels:!1}}),_g(Ba,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),_g(Ba,"descriptors",{angleLines:{_fallback:"grid"}});const ya={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},pa=Object.keys(ya);function Wa(g,I){return g-I}function Va(g,I){if(vI(I))return null;const e=g._adapter,{parser:C,round:t,isoWeekday:l}=g._parseOpts;let n=I;return"function"===typeof C&&(n=C(n)),NI(n)||(n="string"===typeof C?e.parse(n,C):e.parse(n)),null===n?null:(t&&(n="week"!==t||!de(l)&&!0!==l?e.startOf(n,t):e.startOf(n,"isoWeek",l)),+n)}function Sa(g,I,e,C){const t=pa.length;for(let l=pa.indexOf(g);l<t-1;++l){const g=ya[pa[l]],t=g.steps?g.steps:Number.MAX_SAFE_INTEGER;if(g.common&&Math.ceil((e-I)/(t*g.size))<=C)return pa[l]}return pa[t-1]}function Xa(g,I,e){if(e){if(e.length){const{lo:C,hi:t}=Ve(e,I);g[e[C]>=I?e[C]:e[t]]=!0}}else g[I]=!0}function Ra(g,I,e){const C=[],t={},l=I.length;let n,o;for(n=0;n<l;++n)o=I[n],t[o]=n,C.push({value:o,major:!1});return 0!==l&&e?function(g,I,e,C){const t=g._adapter,l=+t.startOf(I[0].value,C),n=I[I.length-1].value;let o,a;for(o=l;o<=n;o=+t.add(o,1,C))a=e[o],a>=0&&(I[a].major=!0);return I}(g,C,t,e):C}class Ja extends ql{constructor(g){super(g),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(g){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const e=g.time||(g.time={}),C=this._adapter=new tl(g.adapters.date);C.init(I),TI(e.displayFormats,C.formats()),this._parseOpts={parser:e.parser,round:e.round,isoWeekday:e.isoWeekday},super.init(g),this._normalized=I.normalized}parse(g,I){return void 0===g?null:Va(this,g)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const g=this.options,I=this._adapter,e=g.time.unit||"day";let{min:C,max:t,minDefined:l,maxDefined:n}=this.getUserBounds();function o(g){l||isNaN(g.min)||(C=Math.min(C,g.min)),n||isNaN(g.max)||(t=Math.max(t,g.max))}l&&n||(o(this._getLabelBounds()),"ticks"===g.bounds&&"labels"===g.ticks.source||o(this.getMinMax(!1))),C=NI(C)&&!isNaN(C)?C:+I.startOf(Date.now(),e),t=NI(t)&&!isNaN(t)?t:+I.endOf(Date.now(),e)+1,this.min=Math.min(C,t-1),this.max=Math.max(C+1,t)}_getLabelBounds(){const g=this.getLabelTimestamps();let I=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY;return g.length&&(I=g[0],e=g[g.length-1]),{min:I,max:e}}buildTicks(){const g=this.options,I=g.time,e=g.ticks,C="labels"===e.source?this.getLabelTimestamps():this._generate();"ticks"===g.bounds&&C.length&&(this.min=this._userMin||C[0],this.max=this._userMax||C[C.length-1]);const t=this.min,l=function(g,I,e){let C=0,t=g.length;for(;C<t&&g[C]<I;)C++;for(;t>C&&g[t-1]>e;)t--;return C>0||t<g.length?g.slice(C,t):g}(C,t,this.max);return this._unit=I.unit||(e.autoSkip?Sa(I.minUnit,this.min,this.max,this._getLabelCapacity(t)):function(g,I,e,C,t){for(let l=pa.length-1;l>=pa.indexOf(e);l--){const e=pa[l];if(ya[e].common&&g._adapter.diff(t,C,e)>=I-1)return e}return pa[e?pa.indexOf(e):0]}(this,l.length,I.minUnit,this.min,this.max)),this._majorUnit=e.major.enabled&&"year"!==this._unit?function(g){for(let I=pa.indexOf(g)+1,e=pa.length;I<e;++I)if(ya[pa[I]].common)return pa[I]}(this._unit):void 0,this.initOffsets(C),g.reverse&&l.reverse(),Ra(this,l,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map((g=>+g.value)))}initOffsets(){let g,I,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],C=0,t=0;this.options.offset&&e.length&&(g=this.getDecimalForValue(e[0]),C=1===e.length?1-g:(this.getDecimalForValue(e[1])-g)/2,I=this.getDecimalForValue(e[e.length-1]),t=1===e.length?I:(I-this.getDecimalForValue(e[e.length-2]))/2);const l=e.length<3?.5:.25;C=pe(C,0,l),t=pe(t,0,l),this._offsets={start:C,end:t,factor:1/(C+1+t)}}_generate(){const g=this._adapter,I=this.min,e=this.max,C=this.options,t=C.time,l=t.unit||Sa(t.minUnit,I,e,this._getLabelCapacity(I)),n=FI(C.ticks.stepSize,1),o="week"===l&&t.isoWeekday,a=de(o)||!0===o,i={};let A,c,s=I;if(a&&(s=+g.startOf(s,"isoWeek",o)),s=+g.startOf(s,a?"day":l),g.diff(e,I,l)>1e5*n)throw new Error(I+" and "+e+" are too far apart with stepSize of "+n+" "+l);const d="data"===C.ticks.source&&this.getDataTimestamps();for(A=s,c=0;A<e;A=+g.add(A,n,l),c++)Xa(i,A,d);return A!==e&&"ticks"!==C.bounds&&1!==c||Xa(i,A,d),Object.keys(i).sort(Wa).map((g=>+g))}getLabelForValue(g){const I=this._adapter,e=this.options.time;return e.tooltipFormat?I.format(g,e.tooltipFormat):I.format(g,e.displayFormats.datetime)}format(g,I){const e=this.options.time.displayFormats,C=this._unit,t=I||e[C];return this._adapter.format(g,t)}_tickFormatFunction(g,I,e,C){const t=this.options,l=t.ticks.callback;if(l)return zI(l,[g,I,e],this);const n=t.time.displayFormats,o=this._unit,a=this._majorUnit,i=o&&n[o],A=a&&n[a],c=e[I],s=a&&A&&c&&c.major;return this._adapter.format(g,C||(s?A:i))}generateTickLabels(g){let I,e,C;for(I=0,e=g.length;I<e;++I)C=g[I],C.label=this._tickFormatFunction(C.value,I,g)}getDecimalForValue(g){return null===g?NaN:(g-this.min)/(this.max-this.min)}getPixelForValue(g){const I=this._offsets,e=this.getDecimalForValue(g);return this.getPixelForDecimal((I.start+e)*I.factor)}getValueForPixel(g){const I=this._offsets,e=this.getDecimalForPixel(g)/I.factor-I.end;return this.min+e*(this.max-this.min)}_getLabelSize(g){const I=this.options.ticks,e=this.ctx.measureText(g).width,C=be(this.isHorizontal()?I.maxRotation:I.minRotation),t=Math.cos(C),l=Math.sin(C),n=this._resolveTickFontOptions(0).size;return{w:e*t+n*l,h:e*l+n*t}}_getLabelCapacity(g){const I=this.options.time,e=I.displayFormats,C=e[I.unit]||e.millisecond,t=this._tickFormatFunction(g,0,Ra(this,[g],this._majorUnit),C),l=this._getLabelSize(t),n=Math.floor(this.isHorizontal()?this.width/l.w:this.height/l.h)-1;return n>0?n:1}getDataTimestamps(){let g,I,e=this._cache.data||[];if(e.length)return e;const C=this.getMatchingVisibleMetas();if(this._normalized&&C.length)return this._cache.data=C[0].controller.getAllParsedValues(this);for(g=0,I=C.length;g<I;++g)e=e.concat(C[g].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const g=this._cache.labels||[];let I,e;if(g.length)return g;const C=this.getLabels();for(I=0,e=C.length;I<e;++I)g.push(Va(this,C[I]));return this._cache.labels=this._normalized?g:this.normalize(g)}normalize(g){return ke(g.sort(Wa))}}function ka(g,I,e){let C,t,l,n,o=0,a=g.length-1;e?(I>=g[o].pos&&I<=g[a].pos&&({lo:o,hi:a}=Se(g,"pos",I)),({pos:C,time:l}=g[o]),({pos:t,time:n}=g[a])):(I>=g[o].time&&I<=g[a].time&&({lo:o,hi:a}=Se(g,"time",I)),({time:C,pos:l}=g[o]),({time:t,pos:n}=g[a]));const i=t-C;return i?l+(n-l)*(I-C)/i:l}_g(Ja,"id","time"),_g(Ja,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});class Ya extends Ja{constructor(g){super(g),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const g=this._getTimestampsForTable(),I=this._table=this.buildLookupTable(g);this._minPos=ka(I,this.min),this._tableRange=ka(I,this.max)-this._minPos,super.initOffsets(g)}buildLookupTable(g){const{min:I,max:e}=this,C=[],t=[];let l,n,o,a,i;for(l=0,n=g.length;l<n;++l)a=g[l],a>=I&&a<=e&&C.push(a);if(C.length<2)return[{time:I,pos:0},{time:e,pos:1}];for(l=0,n=C.length;l<n;++l)i=C[l+1],o=C[l-1],a=C[l],Math.round((i+o)/2)!==a&&t.push({time:a,pos:l/(n-1)});return t}_generate(){const g=this.min,I=this.max;let e=super.getDataTimestamps();return e.includes(g)&&e.length||e.splice(0,0,g),e.includes(I)&&1!==e.length||e.push(I),e.sort(((g,I)=>g-I))}_getTimestampsForTable(){let g=this._cache.all||[];if(g.length)return g;const I=this.getDataTimestamps(),e=this.getLabelTimestamps();return g=I.length&&e.length?this.normalize(I.concat(e)):I.length?I:e,g=this._cache.all=g,g}getDecimalForValue(g){return(ka(this._table,g)-this._minPos)/this._tableRange}getValueForPixel(g){const I=this._offsets,e=this.getDecimalForPixel(g)/I.factor-I.end;return ka(this._table,e*this._tableRange+this._minPos,!0)}}_g(Ya,"id","timeseries"),_g(Ya,"defaults",Ja.defaults);const fa=[Il,Io,$o,Object.freeze({__proto__:null,CategoryScale:ea,LinearScale:na,LogarithmicScale:sa,RadialLinearScale:Ba,TimeScale:Ja,TimeSeriesScale:Ya})],va="label";function Ha(g,I){"function"===typeof g?g(I):g&&(g.current=I)}function wa(g,I){g.labels=I}function Na(g,I){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:va;const C=[];g.datasets=I.map((I=>{const t=g.datasets.find((g=>g[e]===I[e]));return t&&I.data&&!C.includes(t)?(C.push(t),Object.assign(t,I),t):{...I}}))}function Ka(g){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:va;const e={labels:[],datasets:[]};return wa(e,g.labels),Na(e,g.datasets,I),e}function Fa(g,I){const{height:e=150,width:t=300,redraw:l=!1,datasetIdKey:n,type:o,data:a,options:i,plugins:A=[],fallbackContent:c,updateMode:s,...d}=g,r=(0,C.useRef)(null),b=(0,C.useRef)(),u=()=>{r.current&&(b.current=new kn(r.current,{type:o,data:Ka(a,n),options:i&&{...i},plugins:A}),Ha(I,b.current))},m=()=>{Ha(I,null),b.current&&(b.current.destroy(),b.current=null)};return(0,C.useEffect)((()=>{!l&&b.current&&i&&function(g,I){const e=g.options;e&&I&&Object.assign(e,I)}(b.current,i)}),[l,i]),(0,C.useEffect)((()=>{!l&&b.current&&wa(b.current.config.data,a.labels)}),[l,a.labels]),(0,C.useEffect)((()=>{!l&&b.current&&a.datasets&&Na(b.current.config.data,a.datasets,n)}),[l,a.datasets]),(0,C.useEffect)((()=>{b.current&&(l?(m(),setTimeout(u)):b.current.update(s))}),[l,i,a.labels,a.datasets,s]),(0,C.useEffect)((()=>{b.current&&(m(),setTimeout(u))}),[o]),(0,C.useEffect)((()=>(u(),()=>m())),[]),C.createElement("canvas",Object.assign({ref:r,role:"img",height:e,width:t},d),c)}const xa=(0,C.forwardRef)(Fa);function za(g,I){return kn.register(I),(0,C.forwardRef)(((I,e)=>C.createElement(xa,Object.assign({},I,{ref:e,type:g}))))}const Ma=za("line",Ot),Ea=za("bar",Tt),Qa=za("doughnut",Pt);kn.register(...fa);const Ua=()=>{const g=q(),[I,e]=(0,C.useState)(),[t,l]=(0,C.useState)(),[n,o]=(0,C.useState)(1),[a,i]=(0,C.useState)({}),[A,c]=(0,C.useState)(0),[s,d]=(0,C.useState)({}),[r,b]=(0,C.useState)({}),[u,m]=(0,C.useState)(0),[Z,h]=(0,C.useState)(0),[G,B]=(0,C.useState)(!1);(0,C.useEffect)((()=>{window.localStorage.getItem("userInfo")||g("/login")}),[g]);const y=()=>{const g=new Date;g.setDate(g.getDate()-n),g.setHours(0,0,0,0);const e=null===I||void 0===I?void 0:I.filter((I=>new Date(I.soldAt).setHours(0,0,0,0)>g)),C=null===t||void 0===t?void 0:t.filter((I=>new Date(I.date).setHours(0,0,0,0)>g)),l=null===e||void 0===e?void 0:e.reduce(((g,I)=>{const e=new Date(I.soldAt).toLocaleDateString();return g[e]=(g[e]||0)+I.sellingPrice,g}),{});i(l||{});const o=null===e||void 0===e?void 0:e.reduce(((g,I)=>g+I.sellingPrice),0);c(o||0);const a=null===e||void 0===e?void 0:e.reduce(((g,I)=>{const e=I.product;return g[e]=(g[e]||0)+1,g}),{});d(a||{});const A=null===e||void 0===e?void 0:e.reduce(((g,I)=>{const e=new Date(I.soldAt).toLocaleDateString(),C=I.brand,t=I.sellingPrice-I.mrp;return g[e]=g[e]||{},g[e][C]=(g[e][C]||0)+t,g}),{}),s=(g=>{const I=Object.keys(g),e=Array.from(new Set(I.flatMap((I=>Object.keys(g[I]||{})))));return I.reduce(((I,C)=>(I[C]=e.reduce(((I,e)=>{var t;return I[e]=(null===(t=g[C])||void 0===t?void 0:t[e])||0,I}),{}),I)),{})})(A||{});b(s);const r=A?Object.values(A).reduce(((g,I)=>g+Object.values(I).reduce(((g,I)=>g+I),0)),0):0;h(r);const u=null===C||void 0===C?void 0:C.reduce(((g,I)=>g+I.expenseAmount),0);m(u||0),B(!1)};(0,C.useEffect)((()=>{(async()=>{if(window.localStorage.getItem("userInfo")){B(!0);try{const[I,C]=await Promise.all([fetch("/api/saleslog",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}}),fetch("/api/expenselog/totalexpense",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}})]);if(!I.ok)return console.error("Failed to fetch sales data"),window.localStorage.clear(),void g("/login");const t=await I.json();if(e(t),C.ok){const g=await C.json();l(g)}else console.error("Failed to fetch expenses data")}catch(I){console.log(I)}}})()}),[]),(0,C.useEffect)((()=>{y()}),[n,I,t]);const p={labels:Object.keys(a),datasets:[{label:"Daily Sales Sum",data:Object.values(a),fill:!0,backgroundColor:"rgba(75,192,192,0.2)",borderColor:"rgba(75,192,192,1)"}]},W={labels:Object.keys(s),datasets:[{label:"Products Sold",data:Object.values(s),backgroundColor:"rgba(54, 162, 235, 0.5)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]},V={labels:Object.keys(r),datasets:Object.keys(r[Object.keys(r)[0]]||{}).map(((g,I)=>({label:g,data:Object.keys(r).map((I=>r[I][g]||0)),fill:!1,borderColor:"rgba(".concat(Math.floor(256*Math.random()),", ").concat(Math.floor(256*Math.random()),", ").concat(Math.floor(256*Math.random()),", 0.7)")})))};return(0,mg.jsxs)("div",{className:"p-4 bg-gray-100 rounded-md shadow-md",children:[(0,mg.jsx)("h2",{className:"text-3xl font-bold mb-4",children:"Sales Dashboard"}),(0,mg.jsxs)("div",{className:"mb-4",children:[(0,mg.jsx)("label",{className:"block mb-2 text-lg",children:"Select Days:"}),(0,mg.jsx)("select",{value:n,onChange:g=>{o(parseInt(g.target.value,10))},className:"border p-2 rounded-md",children:[1,2,3,4,5,6,7,15,30,180,365].map((g=>(0,mg.jsx)("option",{value:g,children:"".concat(g," Day").concat(g>1?"s":"")},g)))})]}),(0,mg.jsxs)("div",{className:"mb-8",children:[(0,mg.jsxs)("h3",{className:"text-lg font-semibold mb-2",children:["Total Sales in ",n," days:"]}),(0,mg.jsxs)("div",{className:"text-xl font-bold",children:["\u20b9",G?" Calculating.....":A.toLocaleString("hi")]})]}),(0,mg.jsxs)("div",{className:"mb-8",children:[(0,mg.jsxs)("h3",{className:"text-lg font-semibold mb-2",children:["Total Profit in ",n," days:"]}),(0,mg.jsxs)("div",{className:"text-xl font-bold",children:["\u20b9",G?" Calculating.....":Z.toLocaleString("hi")]})]}),(0,mg.jsxs)("div",{children:[(0,mg.jsxs)("h3",{className:"text-lg font-semibold mb-2",children:["Total Expenses in ",n," days:"]}),(0,mg.jsxs)("div",{className:"text-xl font-bold",children:["\u20b9",G?" Calculating.....":u.toLocaleString("hi")]})]}),(0,mg.jsxs)("div",{className:"mb-8",children:[(0,mg.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Sales Over Time"}),(0,mg.jsx)(Ma,{data:p,height:150})]}),(0,mg.jsxs)("div",{className:"mb-8 w-full h-screen",children:[(0,mg.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Products Sold"}),(0,mg.jsx)(Ea,{data:W,options:{maintainAspectRatio:!1}})]}),(0,mg.jsxs)("div",{className:"mb-8 w-full h-screen",children:[(0,mg.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Profits by Brand"}),(0,mg.jsx)(Ma,{data:V,options:{maintainAspectRatio:!1}})]})]})},La=()=>(0,mg.jsx)(mg.Fragment,{children:(0,mg.jsx)("div",{className:"fixed top-0 right-0 p-4",children:(0,mg.jsx)("a",{href:"/menu",className:"text-black hover:text-gray-300",children:"Menu"})})}),Da=()=>{const g=q(),[I,e]=(0,C.useState)([]),[t,l]=(0,C.useState)(""),[n,o]=(0,C.useState)([]),[a,i]=(0,C.useState)(!1),[A,c]=(0,C.useState)(!1);function s(g){return g.sort(((g,I)=>g.brand.localeCompare(I.brand))),g.forEach((g=>{g.products.sort(((g,I)=>g.localeCompare(I)))})),g}(0,C.useEffect)((()=>{(async()=>{try{const I=await fetch("/api/dropdownoption/products",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(I.ok){const g=await I.json();s(g),e(g)}else 401===I.status?(window.localStorage.clear(),g("/login")):console.error("Failed to fetch brands and products")}catch(I){console.log(I)}})()}),[g]),(0,C.useEffect)((()=>{s(I)}),[I]);const d=""===t.trim();return(0,mg.jsxs)("div",{className:"p-4 bg-gray-100",children:[(0,mg.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Add Brand and Product"}),(0,mg.jsxs)("div",{className:"mb-4",children:[(0,mg.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Brands and Products"}),I.map(((g,C)=>(0,mg.jsxs)("div",{className:"mb-2 bg-white p-4 rounded shadow-md",children:[(0,mg.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>(g=>{const C=[...I];C[g].expanded=!C[g].expanded,e(C)})(C),children:[(0,mg.jsx)("strong",{children:g.brand}),(0,mg.jsx)("p",{className:"transition transform ".concat(g.expanded?"":"rotate-180"),children:"^"})]}),g.expanded&&(0,mg.jsx)("ul",{className:"list-disc ml-6",children:g.products.map(((g,I)=>(0,mg.jsx)("li",{className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-200",children:g},I)))})]},C)))]}),(0,mg.jsxs)("div",{className:"mb-4 bg-white p-4 rounded shadow-md",children:[(0,mg.jsx)("label",{className:"block mb-2",children:"Add New Brand:"}),(0,mg.jsx)("input",{type:"text",placeholder:"Enter New Brand",value:t,onChange:g=>{l(g.target.value.toUpperCase())},className:"border p-2 w-full mb-2"}),(0,mg.jsx)("textarea",{placeholder:"Enter Products (comma-separated)",value:n.join(", "),onChange:g=>{o(g.target.value.split(",").map((g=>g.trim())))},className:"border p-2 w-full"}),a&&(0,mg.jsx)("div",{className:"text-green-500 mt-2",children:"Brand added successfully!"}),(0,mg.jsx)("button",{onClick:async()=>{if(""!==t.trim())try{c(!0);if((await fetch("/api/dropdownoption/products",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)},body:JSON.stringify({brand:t,products:n})})).ok){const g=[...I];g.push({brand:t,products:n}),e(g),l(""),o([]),i(!0),setTimeout((()=>{i(!1)}),3e3),c(!1)}else console.error("Failed to add brand")}catch(g){console.error("Error:",g)}},disabled:d,className:"bg-green-500 text-white py-2 px-4 rounded focus:outline-none ".concat(d?"opacity-50 cursor-not-allowed":"hover:bg-green-700"),children:A?"Adding...":"Add Brand"})]})]})},Ta=()=>{const g=q(),[I,e]=(0,C.useState)([]),[t,l]=(0,C.useState)([]),[n,o]=(0,C.useState)(""),[a,i]=(0,C.useState)(!0),[A,c]=(0,C.useState)(!1),[s,d]=(0,C.useState)(!1);(0,C.useEffect)((()=>{window.localStorage.getItem("userInfo")||g("/login")}),[g]),(0,C.useEffect)((()=>{(async()=>{if(window.localStorage.getItem("userInfo"))try{const I=await fetch("/api/dropdownoption/categories",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(I.ok){const g=await I.json();g[0].category.sort(((g,I)=>g.localeCompare(I))),e(g[0].category)}else 401===I.status?(window.localStorage.clear(),g("/login")):console.error("Failed to fetch categories")}catch(I){console.log(I)}})()}),[]);const r=""===n.trim();return(0,mg.jsxs)("div",{className:"p-4",children:[(0,mg.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Add Category"}),(0,mg.jsxs)("div",{className:"flex border p-2",children:[(0,mg.jsxs)("div",{className:"w-1/3 pr-4",children:[(0,mg.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Categories"}),(0,mg.jsx)("ul",{className:"space-y-2",children:I.map(((g,I)=>(0,mg.jsx)("li",{className:"cursor-pointer border-b py-2",children:(0,mg.jsx)("div",{className:"border-b pb-1",children:g},I)},I)))})]}),(0,mg.jsx)("div",{className:"w-2/3 pl-4",children:(0,mg.jsxs)("div",{className:"mt-8",children:[(0,mg.jsx)("label",{className:"block mb-2",children:"Add New Category:"}),(0,mg.jsx)("input",{type:"text",placeholder:"Enter New Category",value:n,onChange:g=>{o(g.target.value)},className:"border p-2 w-full"}),(0,mg.jsx)("button",{onClick:()=>{e([...I,n.trim()]),l([...t,n.trim()]),o(""),i(!1)},disabled:r,className:"bg-green-500 text-white py-2 px-4 rounded focus:outline-none hover:bg-green-700 ".concat(r?"cursor-not-allowed opacity-50":""),children:"Add Category"})]})})]}),(0,mg.jsxs)("div",{className:"mt-2",children:[A&&(0,mg.jsx)("div",{className:"text-green-500 mt-0",children:"Data saved successfully!"}),(0,mg.jsx)("button",{onClick:async()=>{try{d(!0);const I=await fetch("/api/dropdownoption/categories",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)},body:JSON.stringify({category:t})});I.ok?(o(""),l([]),i(!0),c(!0),setTimeout((()=>{c(!1)}),3e3)):401===I.status?(window.localStorage.clear(),g("/login")):console.error("Failed to save category")}catch(I){console.error("Error:",I)}finally{d(!1)}},disabled:a,className:"py-2 px-4 rounded focus:outline-none ".concat(a?"bg-gray-500 opacity-50 cursor-not-allowed text-black":"bg-indigo-500 hover:bg-indigo-700 text-white"),children:s?"Saving...":"Save"})]})]})},ja=()=>{const g=q(),[I,e]=(0,C.useState)([]),[t,l]=(0,C.useState)([]),[n,o]=(0,C.useState)(""),[a,i]=(0,C.useState)(!0),[A,c]=(0,C.useState)(!1),[s,d]=(0,C.useState)(!1);(0,C.useEffect)((()=>{window.localStorage.getItem("userInfo")||g("/login")}),[g]),(0,C.useEffect)((()=>{(async()=>{if(window.localStorage.getItem("userInfo"))try{const I=await fetch("/api/dropdownoption/sizes",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(I.ok){const g=await I.json();e(g[0].size)}else 401===I.status?(window.localStorage.clear(),g("/login")):console.error("Failed to fetch sizes")}catch(I){console.log(I)}})()}),[]);const r=""===n.trim();return(0,mg.jsxs)("div",{className:"p-4",children:[(0,mg.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Add Size"}),(0,mg.jsxs)("div",{className:"flex border p-2",children:[(0,mg.jsxs)("div",{className:"w-1/3 pr-4",children:[(0,mg.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Sizes"}),(0,mg.jsx)("ul",{className:"space-y-2",children:I.map(((g,I)=>(0,mg.jsx)("li",{className:"cursor-pointer border-b py-2",children:(0,mg.jsx)("div",{className:"border-b pb-1",children:g},I)},I)))})]}),(0,mg.jsx)("div",{className:"w-2/3 pl-4",children:(0,mg.jsxs)("div",{className:"mt-8",children:[(0,mg.jsx)("label",{className:"block mb-2",children:"Add New Size:"}),(0,mg.jsx)("input",{type:"text",placeholder:"Enter New Size",value:n,onChange:g=>{o(g.target.value)},className:"border p-2 w-full"}),(0,mg.jsx)("button",{onClick:()=>{e([...I,n.trim()]),l([...t,n.trim()]),o(""),i(!1)},disabled:r,className:"bg-green-500 text-white py-2 px-4 rounded focus:outline-none hover:bg-green-700 ".concat(r?"cursor-not-allowed opacity-50":""),children:"Add Size"})]})})]}),(0,mg.jsxs)("div",{className:"mt-2",children:[A&&(0,mg.jsx)("div",{className:"text-green-500 mt-0",children:"Data saved successfully!"}),(0,mg.jsx)("button",{onClick:async()=>{try{d(!0);const I=await fetch("/api/dropdownoption/sizes",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)},body:JSON.stringify({size:t})});I.ok?(o(""),l([]),i(!0),c(!0),setTimeout((()=>{c(!1)}),3e3)):401===I.status?(window.localStorage.clear(),g("/login")):console.error("Failed to save size")}catch(I){console.error("Error:",I)}finally{d(!1)}},disabled:a,className:"py-2 px-4 rounded focus:outline-none ".concat(a?"bg-gray-500 opacity-50 cursor-not-allowed text-black":"bg-indigo-500 hover:bg-indigo-700 text-white"),children:s?"Saving...":"Save"})]})]})},Pa=()=>{const g=q(),[I,e]=(0,C.useState)({expenseType:"",expenseAmount:""}),[t,l]=(0,C.useState)(!1),[n,o]=(0,C.useState)(!1),a=()=>!isNaN(I.expenseAmount)&&I.expenseAmount>0;return(0,C.useEffect)((()=>{window.localStorage.getItem("userInfo")||g("/login")}),[g]),(0,mg.jsxs)("div",{className:"p-4",children:[(0,mg.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Add Expense"}),(0,mg.jsxs)("div",{className:"mb-4",children:[(0,mg.jsx)("label",{className:"block mb-2",children:"Expense Type:"}),(0,mg.jsx)("input",{type:"text",value:I.expenseType,onChange:g=>e({...I,expenseType:g.target.value}),className:"border p-2 w-full"})]}),(0,mg.jsxs)("div",{className:"mb-4",children:[(0,mg.jsx)("label",{className:"block mb-2",children:"Expense Amount:"}),(0,mg.jsx)("input",{type:"number",value:I.expenseAmount,onChange:g=>e({...I,expenseAmount:Math.max(0,g.target.value)}),className:"border p-2 w-full"})]}),n&&(0,mg.jsx)("div",{className:"text-green-500 mt-4",children:"Expense added successfully!"}),(0,mg.jsx)("button",{onClick:async()=>{try{if(!a())return void console.error("Expense type and a valid positive amount are required");l(!0);const C=await fetch("/api/expenseLog",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)},body:JSON.stringify(I)});C.ok?(console.log("Expense added successfully"),e({expenseType:"",expenseAmount:""}),o(!0),setTimeout((()=>{o(!1)}),3e3)):401===C.status?(window.localStorage.clear(),g("/login")):console.error("Failed to add expense")}catch(C){console.error("Error:",C)}finally{l(!1)}},className:"bg-blue-500 text-white py-2 px-4 rounded focus:outline-none hover:bg-blue-700 ".concat(!a()&&"opacity-50 cursor-not-allowed"),disabled:!a(),children:t?"Adding...":"Add Expense"})]})};function Oa(g,I){return function(){return g.apply(I,arguments)}}const{toString:_a}=Object.prototype,{getPrototypeOf:qa}=Object,$a=(gi=Object.create(null),g=>{const I=_a.call(g);return gi[I]||(gi[I]=I.slice(8,-1).toLowerCase())});var gi;const Ii=g=>(g=g.toLowerCase(),I=>$a(I)===g),ei=g=>I=>typeof I===g,{isArray:Ci}=Array,ti=ei("undefined");const li=Ii("ArrayBuffer");const ni=ei("string"),oi=ei("function"),ai=ei("number"),ii=g=>null!==g&&"object"===typeof g,Ai=g=>{if("object"!==$a(g))return!1;const I=qa(g);return(null===I||I===Object.prototype||null===Object.getPrototypeOf(I))&&!(Symbol.toStringTag in g)&&!(Symbol.iterator in g)},ci=Ii("Date"),si=Ii("File"),di=Ii("Blob"),ri=Ii("FileList"),bi=Ii("URLSearchParams");function ui(g,I){let e,C,{allOwnKeys:t=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==g&&"undefined"!==typeof g)if("object"!==typeof g&&(g=[g]),Ci(g))for(e=0,C=g.length;e<C;e++)I.call(null,g[e],e,g);else{const C=t?Object.getOwnPropertyNames(g):Object.keys(g),l=C.length;let n;for(e=0;e<l;e++)n=C[e],I.call(null,g[n],n,g)}}function mi(g,I){I=I.toLowerCase();const e=Object.keys(g);let C,t=e.length;for(;t-- >0;)if(C=e[t],I===C.toLowerCase())return C;return null}const Zi="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global,hi=g=>!ti(g)&&g!==Zi;const Gi=(Bi="undefined"!==typeof Uint8Array&&qa(Uint8Array),g=>Bi&&g instanceof Bi);var Bi;const yi=Ii("HTMLFormElement"),pi=(g=>{let{hasOwnProperty:I}=g;return(g,e)=>I.call(g,e)})(Object.prototype),Wi=Ii("RegExp"),Vi=(g,I)=>{const e=Object.getOwnPropertyDescriptors(g),C={};ui(e,((e,t)=>{let l;!1!==(l=I(e,t,g))&&(C[t]=l||e)})),Object.defineProperties(g,C)},Si="abcdefghijklmnopqrstuvwxyz",Xi="0123456789",Ri={DIGIT:Xi,ALPHA:Si,ALPHA_DIGIT:Si+Si.toUpperCase()+Xi};const Ji=Ii("AsyncFunction"),ki={isArray:Ci,isArrayBuffer:li,isBuffer:function(g){return null!==g&&!ti(g)&&null!==g.constructor&&!ti(g.constructor)&&oi(g.constructor.isBuffer)&&g.constructor.isBuffer(g)},isFormData:g=>{let I;return g&&("function"===typeof FormData&&g instanceof FormData||oi(g.append)&&("formdata"===(I=$a(g))||"object"===I&&oi(g.toString)&&"[object FormData]"===g.toString()))},isArrayBufferView:function(g){let I;return I="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(g):g&&g.buffer&&li(g.buffer),I},isString:ni,isNumber:ai,isBoolean:g=>!0===g||!1===g,isObject:ii,isPlainObject:Ai,isUndefined:ti,isDate:ci,isFile:si,isBlob:di,isRegExp:Wi,isFunction:oi,isStream:g=>ii(g)&&oi(g.pipe),isURLSearchParams:bi,isTypedArray:Gi,isFileList:ri,forEach:ui,merge:function g(){const{caseless:I}=hi(this)&&this||{},e={},C=(C,t)=>{const l=I&&mi(e,t)||t;Ai(e[l])&&Ai(C)?e[l]=g(e[l],C):Ai(C)?e[l]=g({},C):Ci(C)?e[l]=C.slice():e[l]=C};for(let t=0,l=arguments.length;t<l;t++)arguments[t]&&ui(arguments[t],C);return e},extend:function(g,I,e){let{allOwnKeys:C}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return ui(I,((I,C)=>{e&&oi(I)?g[C]=Oa(I,e):g[C]=I}),{allOwnKeys:C}),g},trim:g=>g.trim?g.trim():g.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:g=>(65279===g.charCodeAt(0)&&(g=g.slice(1)),g),inherits:(g,I,e,C)=>{g.prototype=Object.create(I.prototype,C),g.prototype.constructor=g,Object.defineProperty(g,"super",{value:I.prototype}),e&&Object.assign(g.prototype,e)},toFlatObject:(g,I,e,C)=>{let t,l,n;const o={};if(I=I||{},null==g)return I;do{for(t=Object.getOwnPropertyNames(g),l=t.length;l-- >0;)n=t[l],C&&!C(n,g,I)||o[n]||(I[n]=g[n],o[n]=!0);g=!1!==e&&qa(g)}while(g&&(!e||e(g,I))&&g!==Object.prototype);return I},kindOf:$a,kindOfTest:Ii,endsWith:(g,I,e)=>{g=String(g),(void 0===e||e>g.length)&&(e=g.length),e-=I.length;const C=g.indexOf(I,e);return-1!==C&&C===e},toArray:g=>{if(!g)return null;if(Ci(g))return g;let I=g.length;if(!ai(I))return null;const e=new Array(I);for(;I-- >0;)e[I]=g[I];return e},forEachEntry:(g,I)=>{const e=(g&&g[Symbol.iterator]).call(g);let C;for(;(C=e.next())&&!C.done;){const e=C.value;I.call(g,e[0],e[1])}},matchAll:(g,I)=>{let e;const C=[];for(;null!==(e=g.exec(I));)C.push(e);return C},isHTMLForm:yi,hasOwnProperty:pi,hasOwnProp:pi,reduceDescriptors:Vi,freezeMethods:g=>{Vi(g,((I,e)=>{if(oi(g)&&-1!==["arguments","caller","callee"].indexOf(e))return!1;const C=g[e];oi(C)&&(I.enumerable=!1,"writable"in I?I.writable=!1:I.set||(I.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")}))}))},toObjectSet:(g,I)=>{const e={},C=g=>{g.forEach((g=>{e[g]=!0}))};return Ci(g)?C(g):C(String(g).split(I)),e},toCamelCase:g=>g.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(g,I,e){return I.toUpperCase()+e})),noop:()=>{},toFiniteNumber:(g,I)=>(g=+g,Number.isFinite(g)?g:I),findKey:mi,global:Zi,isContextDefined:hi,ALPHABET:Ri,generateString:function(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ri.ALPHA_DIGIT,e="";const{length:C}=I;for(;g--;)e+=I[Math.random()*C|0];return e},isSpecCompliantForm:function(g){return!!(g&&oi(g.append)&&"FormData"===g[Symbol.toStringTag]&&g[Symbol.iterator])},toJSONObject:g=>{const I=new Array(10),e=(g,C)=>{if(ii(g)){if(I.indexOf(g)>=0)return;if(!("toJSON"in g)){I[C]=g;const t=Ci(g)?[]:{};return ui(g,((g,I)=>{const l=e(g,C+1);!ti(l)&&(t[I]=l)})),I[C]=void 0,t}}return g};return e(g,0)},isAsyncFn:Ji,isThenable:g=>g&&(ii(g)||oi(g))&&oi(g.then)&&oi(g.catch)};function Yi(g,I,e,C,t){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=g,this.name="AxiosError",I&&(this.code=I),e&&(this.config=e),C&&(this.request=C),t&&(this.response=t)}ki.inherits(Yi,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ki.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const fi=Yi.prototype,vi={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((g=>{vi[g]={value:g}})),Object.defineProperties(Yi,vi),Object.defineProperty(fi,"isAxiosError",{value:!0}),Yi.from=(g,I,e,C,t,l)=>{const n=Object.create(fi);return ki.toFlatObject(g,n,(function(g){return g!==Error.prototype}),(g=>"isAxiosError"!==g)),Yi.call(n,g.message,I,e,C,t),n.cause=g,n.name=g.name,l&&Object.assign(n,l),n};const Hi=Yi;function wi(g){return ki.isPlainObject(g)||ki.isArray(g)}function Ni(g){return ki.endsWith(g,"[]")?g.slice(0,-2):g}function Ki(g,I,e){return g?g.concat(I).map((function(g,I){return g=Ni(g),!e&&I?"["+g+"]":g})).join(e?".":""):I}const Fi=ki.toFlatObject(ki,{},null,(function(g){return/^is[A-Z]/.test(g)}));const xi=function(g,I,e){if(!ki.isObject(g))throw new TypeError("target must be an object");I=I||new FormData;const C=(e=ki.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(g,I){return!ki.isUndefined(I[g])}))).metaTokens,t=e.visitor||i,l=e.dots,n=e.indexes,o=(e.Blob||"undefined"!==typeof Blob&&Blob)&&ki.isSpecCompliantForm(I);if(!ki.isFunction(t))throw new TypeError("visitor must be a function");function a(g){if(null===g)return"";if(ki.isDate(g))return g.toISOString();if(!o&&ki.isBlob(g))throw new Hi("Blob is not supported. Use a Buffer instead.");return ki.isArrayBuffer(g)||ki.isTypedArray(g)?o&&"function"===typeof Blob?new Blob([g]):Buffer.from(g):g}function i(g,e,t){let o=g;if(g&&!t&&"object"===typeof g)if(ki.endsWith(e,"{}"))e=C?e:e.slice(0,-2),g=JSON.stringify(g);else if(ki.isArray(g)&&function(g){return ki.isArray(g)&&!g.some(wi)}(g)||(ki.isFileList(g)||ki.endsWith(e,"[]"))&&(o=ki.toArray(g)))return e=Ni(e),o.forEach((function(g,C){!ki.isUndefined(g)&&null!==g&&I.append(!0===n?Ki([e],C,l):null===n?e:e+"[]",a(g))})),!1;return!!wi(g)||(I.append(Ki(t,e,l),a(g)),!1)}const A=[],c=Object.assign(Fi,{defaultVisitor:i,convertValue:a,isVisitable:wi});if(!ki.isObject(g))throw new TypeError("data must be an object");return function g(e,C){if(!ki.isUndefined(e)){if(-1!==A.indexOf(e))throw Error("Circular reference detected in "+C.join("."));A.push(e),ki.forEach(e,(function(e,l){!0===(!(ki.isUndefined(e)||null===e)&&t.call(I,e,ki.isString(l)?l.trim():l,C,c))&&g(e,C?C.concat(l):[l])})),A.pop()}}(g),I};function zi(g){const I={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(g).replace(/[!'()~]|%20|%00/g,(function(g){return I[g]}))}function Mi(g,I){this._pairs=[],g&&xi(g,this,I)}const Ei=Mi.prototype;Ei.append=function(g,I){this._pairs.push([g,I])},Ei.toString=function(g){const I=g?function(I){return g.call(this,I,zi)}:zi;return this._pairs.map((function(g){return I(g[0])+"="+I(g[1])}),"").join("&")};const Qi=Mi;function Ui(g){return encodeURIComponent(g).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Li(g,I,e){if(!I)return g;const C=e&&e.encode||Ui,t=e&&e.serialize;let l;if(l=t?t(I,e):ki.isURLSearchParams(I)?I.toString():new Qi(I,e).toString(C),l){const I=g.indexOf("#");-1!==I&&(g=g.slice(0,I)),g+=(-1===g.indexOf("?")?"?":"&")+l}return g}const Di=class{constructor(){this.handlers=[]}use(g,I,e){return this.handlers.push({fulfilled:g,rejected:I,synchronous:!!e&&e.synchronous,runWhen:e?e.runWhen:null}),this.handlers.length-1}eject(g){this.handlers[g]&&(this.handlers[g]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(g){ki.forEach(this.handlers,(function(I){null!==I&&g(I)}))}},Ti={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ji={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:Qi,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},Pi="undefined"!==typeof window&&"undefined"!==typeof document,Oi=(_i="undefined"!==typeof navigator&&navigator.product,Pi&&["ReactNative","NativeScript","NS"].indexOf(_i)<0);var _i;const qi="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,$i={...g,...ji};const gA=function(g){function I(g,e,C,t){let l=g[t++];if("__proto__"===l)return!0;const n=Number.isFinite(+l),o=t>=g.length;if(l=!l&&ki.isArray(C)?C.length:l,o)return ki.hasOwnProp(C,l)?C[l]=[C[l],e]:C[l]=e,!n;C[l]&&ki.isObject(C[l])||(C[l]=[]);return I(g,e,C[l],t)&&ki.isArray(C[l])&&(C[l]=function(g){const I={},e=Object.keys(g);let C;const t=e.length;let l;for(C=0;C<t;C++)l=e[C],I[l]=g[l];return I}(C[l])),!n}if(ki.isFormData(g)&&ki.isFunction(g.entries)){const e={};return ki.forEachEntry(g,((g,C)=>{I(function(g){return ki.matchAll(/\w+|\[(\w*)]/g,g).map((g=>"[]"===g[0]?"":g[1]||g[0]))}(g),C,e,0)})),e}return null};const IA={transitional:Ti,adapter:["xhr","http"],transformRequest:[function(g,I){const e=I.getContentType()||"",C=e.indexOf("application/json")>-1,t=ki.isObject(g);t&&ki.isHTMLForm(g)&&(g=new FormData(g));if(ki.isFormData(g))return C?JSON.stringify(gA(g)):g;if(ki.isArrayBuffer(g)||ki.isBuffer(g)||ki.isStream(g)||ki.isFile(g)||ki.isBlob(g))return g;if(ki.isArrayBufferView(g))return g.buffer;if(ki.isURLSearchParams(g))return I.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),g.toString();let l;if(t){if(e.indexOf("application/x-www-form-urlencoded")>-1)return function(g,I){return xi(g,new $i.classes.URLSearchParams,Object.assign({visitor:function(g,I,e,C){return $i.isNode&&ki.isBuffer(g)?(this.append(I,g.toString("base64")),!1):C.defaultVisitor.apply(this,arguments)}},I))}(g,this.formSerializer).toString();if((l=ki.isFileList(g))||e.indexOf("multipart/form-data")>-1){const I=this.env&&this.env.FormData;return xi(l?{"files[]":g}:g,I&&new I,this.formSerializer)}}return t||C?(I.setContentType("application/json",!1),function(g,I,e){if(ki.isString(g))try{return(I||JSON.parse)(g),ki.trim(g)}catch(C){if("SyntaxError"!==C.name)throw C}return(e||JSON.stringify)(g)}(g)):g}],transformResponse:[function(g){const I=this.transitional||IA.transitional,e=I&&I.forcedJSONParsing,C="json"===this.responseType;if(g&&ki.isString(g)&&(e&&!this.responseType||C)){const e=!(I&&I.silentJSONParsing)&&C;try{return JSON.parse(g)}catch(t){if(e){if("SyntaxError"===t.name)throw Hi.from(t,Hi.ERR_BAD_RESPONSE,this,null,this.response);throw t}}}return g}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:$i.classes.FormData,Blob:$i.classes.Blob},validateStatus:function(g){return g>=200&&g<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ki.forEach(["delete","get","head","post","put","patch"],(g=>{IA.headers[g]={}}));const eA=IA,CA=ki.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),tA=Symbol("internals");function lA(g){return g&&String(g).trim().toLowerCase()}function nA(g){return!1===g||null==g?g:ki.isArray(g)?g.map(nA):String(g)}function oA(g,I,e,C,t){return ki.isFunction(C)?C.call(this,I,e):(t&&(I=e),ki.isString(I)?ki.isString(C)?-1!==I.indexOf(C):ki.isRegExp(C)?C.test(I):void 0:void 0)}class aA{constructor(g){g&&this.set(g)}set(g,I,e){const C=this;function t(g,I,e){const t=lA(I);if(!t)throw new Error("header name must be a non-empty string");const l=ki.findKey(C,t);(!l||void 0===C[l]||!0===e||void 0===e&&!1!==C[l])&&(C[l||I]=nA(g))}const l=(g,I)=>ki.forEach(g,((g,e)=>t(g,e,I)));return ki.isPlainObject(g)||g instanceof this.constructor?l(g,I):ki.isString(g)&&(g=g.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(g.trim())?l((g=>{const I={};let e,C,t;return g&&g.split("\n").forEach((function(g){t=g.indexOf(":"),e=g.substring(0,t).trim().toLowerCase(),C=g.substring(t+1).trim(),!e||I[e]&&CA[e]||("set-cookie"===e?I[e]?I[e].push(C):I[e]=[C]:I[e]=I[e]?I[e]+", "+C:C)})),I})(g),I):null!=g&&t(I,g,e),this}get(g,I){if(g=lA(g)){const e=ki.findKey(this,g);if(e){const g=this[e];if(!I)return g;if(!0===I)return function(g){const I=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let C;for(;C=e.exec(g);)I[C[1]]=C[2];return I}(g);if(ki.isFunction(I))return I.call(this,g,e);if(ki.isRegExp(I))return I.exec(g);throw new TypeError("parser must be boolean|regexp|function")}}}has(g,I){if(g=lA(g)){const e=ki.findKey(this,g);return!(!e||void 0===this[e]||I&&!oA(0,this[e],e,I))}return!1}delete(g,I){const e=this;let C=!1;function t(g){if(g=lA(g)){const t=ki.findKey(e,g);!t||I&&!oA(0,e[t],t,I)||(delete e[t],C=!0)}}return ki.isArray(g)?g.forEach(t):t(g),C}clear(g){const I=Object.keys(this);let e=I.length,C=!1;for(;e--;){const t=I[e];g&&!oA(0,this[t],t,g,!0)||(delete this[t],C=!0)}return C}normalize(g){const I=this,e={};return ki.forEach(this,((C,t)=>{const l=ki.findKey(e,t);if(l)return I[l]=nA(C),void delete I[t];const n=g?function(g){return g.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((g,I,e)=>I.toUpperCase()+e))}(t):String(t).trim();n!==t&&delete I[t],I[n]=nA(C),e[n]=!0})),this}concat(){for(var g=arguments.length,I=new Array(g),e=0;e<g;e++)I[e]=arguments[e];return this.constructor.concat(this,...I)}toJSON(g){const I=Object.create(null);return ki.forEach(this,((e,C)=>{null!=e&&!1!==e&&(I[C]=g&&ki.isArray(e)?e.join(", "):e)})),I}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((g=>{let[I,e]=g;return I+": "+e})).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(g){return g instanceof this?g:new this(g)}static concat(g){const I=new this(g);for(var e=arguments.length,C=new Array(e>1?e-1:0),t=1;t<e;t++)C[t-1]=arguments[t];return C.forEach((g=>I.set(g))),I}static accessor(g){const I=(this[tA]=this[tA]={accessors:{}}).accessors,e=this.prototype;function C(g){const C=lA(g);I[C]||(!function(g,I){const e=ki.toCamelCase(" "+I);["get","set","has"].forEach((C=>{Object.defineProperty(g,C+e,{value:function(g,e,t){return this[C].call(this,I,g,e,t)},configurable:!0})}))}(e,g),I[C]=!0)}return ki.isArray(g)?g.forEach(C):C(g),this}}aA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ki.reduceDescriptors(aA.prototype,((g,I)=>{let{value:e}=g,C=I[0].toUpperCase()+I.slice(1);return{get:()=>e,set(g){this[C]=g}}})),ki.freezeMethods(aA);const iA=aA;function AA(g,I){const e=this||eA,C=I||e,t=iA.from(C.headers);let l=C.data;return ki.forEach(g,(function(g){l=g.call(e,l,t.normalize(),I?I.status:void 0)})),t.normalize(),l}function cA(g){return!(!g||!g.__CANCEL__)}function sA(g,I,e){Hi.call(this,null==g?"canceled":g,Hi.ERR_CANCELED,I,e),this.name="CanceledError"}ki.inherits(sA,Hi,{__CANCEL__:!0});const dA=sA;const rA=$i.hasStandardBrowserEnv?{write(g,I,e,C,t,l){const n=[g+"="+encodeURIComponent(I)];ki.isNumber(e)&&n.push("expires="+new Date(e).toGMTString()),ki.isString(C)&&n.push("path="+C),ki.isString(t)&&n.push("domain="+t),!0===l&&n.push("secure"),document.cookie=n.join("; ")},read(g){const I=document.cookie.match(new RegExp("(^|;\\s*)("+g+")=([^;]*)"));return I?decodeURIComponent(I[3]):null},remove(g){this.write(g,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function bA(g,I){return g&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(I)?function(g,I){return I?g.replace(/\/?\/$/,"")+"/"+I.replace(/^\/+/,""):g}(g,I):I}const uA=$i.hasStandardBrowserEnv?function(){const g=/(msie|trident)/i.test(navigator.userAgent),I=document.createElement("a");let e;function C(e){let C=e;return g&&(I.setAttribute("href",C),C=I.href),I.setAttribute("href",C),{href:I.href,protocol:I.protocol?I.protocol.replace(/:$/,""):"",host:I.host,search:I.search?I.search.replace(/^\?/,""):"",hash:I.hash?I.hash.replace(/^#/,""):"",hostname:I.hostname,port:I.port,pathname:"/"===I.pathname.charAt(0)?I.pathname:"/"+I.pathname}}return e=C(window.location.href),function(g){const I=ki.isString(g)?C(g):g;return I.protocol===e.protocol&&I.host===e.host}}():function(){return!0};const mA=function(g,I){g=g||10;const e=new Array(g),C=new Array(g);let t,l=0,n=0;return I=void 0!==I?I:1e3,function(o){const a=Date.now(),i=C[n];t||(t=a),e[l]=o,C[l]=a;let A=n,c=0;for(;A!==l;)c+=e[A++],A%=g;if(l=(l+1)%g,l===n&&(n=(n+1)%g),a-t<I)return;const s=i&&a-i;return s?Math.round(1e3*c/s):void 0}};function ZA(g,I){let e=0;const C=mA(50,250);return t=>{const l=t.loaded,n=t.lengthComputable?t.total:void 0,o=l-e,a=C(o);e=l;const i={loaded:l,total:n,progress:n?l/n:void 0,bytes:o,rate:a||void 0,estimated:a&&n&&l<=n?(n-l)/a:void 0,event:t};i[I?"download":"upload"]=!0,g(i)}}const hA="undefined"!==typeof XMLHttpRequest&&function(g){return new Promise((function(I,e){let C=g.data;const t=iA.from(g.headers).normalize();let l,n,{responseType:o,withXSRFToken:a}=g;function i(){g.cancelToken&&g.cancelToken.unsubscribe(l),g.signal&&g.signal.removeEventListener("abort",l)}if(ki.isFormData(C))if($i.hasStandardBrowserEnv||$i.hasStandardBrowserWebWorkerEnv)t.setContentType(!1);else if(!1!==(n=t.getContentType())){const[g,...I]=n?n.split(";").map((g=>g.trim())).filter(Boolean):[];t.setContentType([g||"multipart/form-data",...I].join("; "))}let A=new XMLHttpRequest;if(g.auth){const I=g.auth.username||"",e=g.auth.password?unescape(encodeURIComponent(g.auth.password)):"";t.set("Authorization","Basic "+btoa(I+":"+e))}const c=bA(g.baseURL,g.url);function s(){if(!A)return;const C=iA.from("getAllResponseHeaders"in A&&A.getAllResponseHeaders());!function(g,I,e){const C=e.config.validateStatus;e.status&&C&&!C(e.status)?I(new Hi("Request failed with status code "+e.status,[Hi.ERR_BAD_REQUEST,Hi.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e)):g(e)}((function(g){I(g),i()}),(function(g){e(g),i()}),{data:o&&"text"!==o&&"json"!==o?A.response:A.responseText,status:A.status,statusText:A.statusText,headers:C,config:g,request:A}),A=null}if(A.open(g.method.toUpperCase(),Li(c,g.params,g.paramsSerializer),!0),A.timeout=g.timeout,"onloadend"in A?A.onloadend=s:A.onreadystatechange=function(){A&&4===A.readyState&&(0!==A.status||A.responseURL&&0===A.responseURL.indexOf("file:"))&&setTimeout(s)},A.onabort=function(){A&&(e(new Hi("Request aborted",Hi.ECONNABORTED,g,A)),A=null)},A.onerror=function(){e(new Hi("Network Error",Hi.ERR_NETWORK,g,A)),A=null},A.ontimeout=function(){let I=g.timeout?"timeout of "+g.timeout+"ms exceeded":"timeout exceeded";const C=g.transitional||Ti;g.timeoutErrorMessage&&(I=g.timeoutErrorMessage),e(new Hi(I,C.clarifyTimeoutError?Hi.ETIMEDOUT:Hi.ECONNABORTED,g,A)),A=null},$i.hasStandardBrowserEnv&&(a&&ki.isFunction(a)&&(a=a(g)),a||!1!==a&&uA(c))){const I=g.xsrfHeaderName&&g.xsrfCookieName&&rA.read(g.xsrfCookieName);I&&t.set(g.xsrfHeaderName,I)}void 0===C&&t.setContentType(null),"setRequestHeader"in A&&ki.forEach(t.toJSON(),(function(g,I){A.setRequestHeader(I,g)})),ki.isUndefined(g.withCredentials)||(A.withCredentials=!!g.withCredentials),o&&"json"!==o&&(A.responseType=g.responseType),"function"===typeof g.onDownloadProgress&&A.addEventListener("progress",ZA(g.onDownloadProgress,!0)),"function"===typeof g.onUploadProgress&&A.upload&&A.upload.addEventListener("progress",ZA(g.onUploadProgress)),(g.cancelToken||g.signal)&&(l=I=>{A&&(e(!I||I.type?new dA(null,g,A):I),A.abort(),A=null)},g.cancelToken&&g.cancelToken.subscribe(l),g.signal&&(g.signal.aborted?l():g.signal.addEventListener("abort",l)));const d=function(g){const I=/^([-+\w]{1,25})(:?\/\/|:)/.exec(g);return I&&I[1]||""}(c);d&&-1===$i.protocols.indexOf(d)?e(new Hi("Unsupported protocol "+d+":",Hi.ERR_BAD_REQUEST,g)):A.send(C||null)}))},GA={http:null,xhr:hA};ki.forEach(GA,((g,I)=>{if(g){try{Object.defineProperty(g,"name",{value:I})}catch(e){}Object.defineProperty(g,"adapterName",{value:I})}}));const BA=g=>"- ".concat(g),yA=g=>ki.isFunction(g)||null===g||!1===g,pA=g=>{g=ki.isArray(g)?g:[g];const{length:I}=g;let e,C;const t={};for(let l=0;l<I;l++){let I;if(e=g[l],C=e,!yA(e)&&(C=GA[(I=String(e)).toLowerCase()],void 0===C))throw new Hi("Unknown adapter '".concat(I,"'"));if(C)break;t[I||"#"+l]=C}if(!C){const g=Object.entries(t).map((g=>{let[I,e]=g;return"adapter ".concat(I," ")+(!1===e?"is not supported by the environment":"is not available in the build")}));let e=I?g.length>1?"since :\n"+g.map(BA).join("\n"):" "+BA(g[0]):"as no adapter specified";throw new Hi("There is no suitable adapter to dispatch the request "+e,"ERR_NOT_SUPPORT")}return C};function WA(g){if(g.cancelToken&&g.cancelToken.throwIfRequested(),g.signal&&g.signal.aborted)throw new dA(null,g)}function VA(g){WA(g),g.headers=iA.from(g.headers),g.data=AA.call(g,g.transformRequest),-1!==["post","put","patch"].indexOf(g.method)&&g.headers.setContentType("application/x-www-form-urlencoded",!1);return pA(g.adapter||eA.adapter)(g).then((function(I){return WA(g),I.data=AA.call(g,g.transformResponse,I),I.headers=iA.from(I.headers),I}),(function(I){return cA(I)||(WA(g),I&&I.response&&(I.response.data=AA.call(g,g.transformResponse,I.response),I.response.headers=iA.from(I.response.headers))),Promise.reject(I)}))}const SA=g=>g instanceof iA?g.toJSON():g;function XA(g,I){I=I||{};const e={};function C(g,I,e){return ki.isPlainObject(g)&&ki.isPlainObject(I)?ki.merge.call({caseless:e},g,I):ki.isPlainObject(I)?ki.merge({},I):ki.isArray(I)?I.slice():I}function t(g,I,e){return ki.isUndefined(I)?ki.isUndefined(g)?void 0:C(void 0,g,e):C(g,I,e)}function l(g,I){if(!ki.isUndefined(I))return C(void 0,I)}function n(g,I){return ki.isUndefined(I)?ki.isUndefined(g)?void 0:C(void 0,g):C(void 0,I)}function o(e,t,l){return l in I?C(e,t):l in g?C(void 0,e):void 0}const a={url:l,method:l,data:l,baseURL:n,transformRequest:n,transformResponse:n,paramsSerializer:n,timeout:n,timeoutMessage:n,withCredentials:n,withXSRFToken:n,adapter:n,responseType:n,xsrfCookieName:n,xsrfHeaderName:n,onUploadProgress:n,onDownloadProgress:n,decompress:n,maxContentLength:n,maxBodyLength:n,beforeRedirect:n,transport:n,httpAgent:n,httpsAgent:n,cancelToken:n,socketPath:n,responseEncoding:n,validateStatus:o,headers:(g,I)=>t(SA(g),SA(I),!0)};return ki.forEach(Object.keys(Object.assign({},g,I)),(function(C){const l=a[C]||t,n=l(g[C],I[C],C);ki.isUndefined(n)&&l!==o||(e[C]=n)})),e}const RA="1.6.7",JA={};["object","boolean","number","function","string","symbol"].forEach(((g,I)=>{JA[g]=function(e){return typeof e===g||"a"+(I<1?"n ":" ")+g}}));const kA={};JA.transitional=function(g,I,e){function C(g,I){return"[Axios v1.6.7] Transitional option '"+g+"'"+I+(e?". "+e:"")}return(e,t,l)=>{if(!1===g)throw new Hi(C(t," has been removed"+(I?" in "+I:"")),Hi.ERR_DEPRECATED);return I&&!kA[t]&&(kA[t]=!0,console.warn(C(t," has been deprecated since v"+I+" and will be removed in the near future"))),!g||g(e,t,l)}};const YA={assertOptions:function(g,I,e){if("object"!==typeof g)throw new Hi("options must be an object",Hi.ERR_BAD_OPTION_VALUE);const C=Object.keys(g);let t=C.length;for(;t-- >0;){const l=C[t],n=I[l];if(n){const I=g[l],e=void 0===I||n(I,l,g);if(!0!==e)throw new Hi("option "+l+" must be "+e,Hi.ERR_BAD_OPTION_VALUE)}else if(!0!==e)throw new Hi("Unknown option "+l,Hi.ERR_BAD_OPTION)}},validators:JA},fA=YA.validators;class vA{constructor(g){this.defaults=g,this.interceptors={request:new Di,response:new Di}}async request(g,I){try{return await this._request(g,I)}catch(e){if(e instanceof Error){let g;Error.captureStackTrace?Error.captureStackTrace(g={}):g=new Error;const I=g.stack?g.stack.replace(/^.+\n/,""):"";e.stack?I&&!String(e.stack).endsWith(I.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+I):e.stack=I}throw e}}_request(g,I){"string"===typeof g?(I=I||{}).url=g:I=g||{},I=XA(this.defaults,I);const{transitional:e,paramsSerializer:C,headers:t}=I;void 0!==e&&YA.assertOptions(e,{silentJSONParsing:fA.transitional(fA.boolean),forcedJSONParsing:fA.transitional(fA.boolean),clarifyTimeoutError:fA.transitional(fA.boolean)},!1),null!=C&&(ki.isFunction(C)?I.paramsSerializer={serialize:C}:YA.assertOptions(C,{encode:fA.function,serialize:fA.function},!0)),I.method=(I.method||this.defaults.method||"get").toLowerCase();let l=t&&ki.merge(t.common,t[I.method]);t&&ki.forEach(["delete","get","head","post","put","patch","common"],(g=>{delete t[g]})),I.headers=iA.concat(l,t);const n=[];let o=!0;this.interceptors.request.forEach((function(g){"function"===typeof g.runWhen&&!1===g.runWhen(I)||(o=o&&g.synchronous,n.unshift(g.fulfilled,g.rejected))}));const a=[];let i;this.interceptors.response.forEach((function(g){a.push(g.fulfilled,g.rejected)}));let A,c=0;if(!o){const g=[VA.bind(this),void 0];for(g.unshift.apply(g,n),g.push.apply(g,a),A=g.length,i=Promise.resolve(I);c<A;)i=i.then(g[c++],g[c++]);return i}A=n.length;let s=I;for(c=0;c<A;){const g=n[c++],I=n[c++];try{s=g(s)}catch(d){I.call(this,d);break}}try{i=VA.call(this,s)}catch(d){return Promise.reject(d)}for(c=0,A=a.length;c<A;)i=i.then(a[c++],a[c++]);return i}getUri(g){return Li(bA((g=XA(this.defaults,g)).baseURL,g.url),g.params,g.paramsSerializer)}}ki.forEach(["delete","get","head","options"],(function(g){vA.prototype[g]=function(I,e){return this.request(XA(e||{},{method:g,url:I,data:(e||{}).data}))}})),ki.forEach(["post","put","patch"],(function(g){function I(I){return function(e,C,t){return this.request(XA(t||{},{method:g,headers:I?{"Content-Type":"multipart/form-data"}:{},url:e,data:C}))}}vA.prototype[g]=I(),vA.prototype[g+"Form"]=I(!0)}));const HA=vA;class wA{constructor(g){if("function"!==typeof g)throw new TypeError("executor must be a function.");let I;this.promise=new Promise((function(g){I=g}));const e=this;this.promise.then((g=>{if(!e._listeners)return;let I=e._listeners.length;for(;I-- >0;)e._listeners[I](g);e._listeners=null})),this.promise.then=g=>{let I;const C=new Promise((g=>{e.subscribe(g),I=g})).then(g);return C.cancel=function(){e.unsubscribe(I)},C},g((function(g,C,t){e.reason||(e.reason=new dA(g,C,t),I(e.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(g){this.reason?g(this.reason):this._listeners?this._listeners.push(g):this._listeners=[g]}unsubscribe(g){if(!this._listeners)return;const I=this._listeners.indexOf(g);-1!==I&&this._listeners.splice(I,1)}static source(){let g;return{token:new wA((function(I){g=I})),cancel:g}}}const NA=wA;const KA={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(KA).forEach((g=>{let[I,e]=g;KA[e]=I}));const FA=KA;const xA=function g(I){const e=new HA(I),C=Oa(HA.prototype.request,e);return ki.extend(C,HA.prototype,e,{allOwnKeys:!0}),ki.extend(C,e,null,{allOwnKeys:!0}),C.create=function(e){return g(XA(I,e))},C}(eA);xA.Axios=HA,xA.CanceledError=dA,xA.CancelToken=NA,xA.isCancel=cA,xA.VERSION=RA,xA.toFormData=xi,xA.AxiosError=Hi,xA.Cancel=xA.CanceledError,xA.all=function(g){return Promise.all(g)},xA.spread=function(g){return function(I){return g.apply(null,I)}},xA.isAxiosError=function(g){return ki.isObject(g)&&!0===g.isAxiosError},xA.mergeConfig=XA,xA.AxiosHeaders=iA,xA.formToJSON=g=>gA(ki.isHTMLForm(g)?new FormData(g):g),xA.getAdapter=pA,xA.HttpStatusCode=FA,xA.default=xA;const zA=xA,MA=()=>{const g=q(),[I,e]=Dg();(0,C.useEffect)((()=>{window.localStorage.getItem("userInfo")&&g("/")}),[]);const[t,l]=(0,C.useState)({email:"",password:""}),[n,o]=(0,C.useState)({email:"",password:""}),[a,i]=(0,C.useState)(!1),[A,c]=(0,C.useState)(!1),s=()=>{const{email:g,password:I}=t;let e={};return g&&/\S+@\S+\.\S+/.test(g)?!(!I||I.length<8)||(e.password="Please enter full password",o(e),!1):(e.email="Please enter a valid email address",o(e),!1)},d=g=>{const{name:I,value:e}=g.target;l({...t,[I]:e}),n[I]&&o({...n,[I]:""})};return(0,mg.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,mg.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,mg.jsx)("div",{children:(0,mg.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Login"})}),(0,mg.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:async I=>{if(I.preventDefault(),i(!0),s())try{const I={headers:{"Content-type":"application/json"}},{data:C}=await zA.post("/login",{email:t.email,password:t.password},I);"object"===typeof C?(window.localStorage.setItem("userInfo",JSON.stringify(C)),e(C.role),g("/")):C&&(c(!0),setTimeout((()=>{c(!1)}),3e3))}catch(C){console.error(C)}finally{l({email:"",password:""})}i(!1)},children:[(0,mg.jsxs)("div",{className:"rounded-md shadow-sm -space-y-px",children:[(0,mg.jsxs)("div",{children:[(0,mg.jsx)("label",{htmlFor:"email",className:"sr-only",children:"Email address"}),(0,mg.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:t.email,onChange:d,className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"Email address"}),n.email&&(0,mg.jsx)("p",{className:"text-red-500 text-sm mt-1",children:n.email})]}),(0,mg.jsxs)("div",{children:[(0,mg.jsx)("label",{htmlFor:"password",className:"sr-only",children:"Password"}),(0,mg.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:t.password,onChange:d,className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"Password"}),n.password&&(0,mg.jsx)("p",{className:"text-red-500 text-sm mt-1",children:n.password})]})]}),A&&(0,mg.jsx)("div",{className:"mt-2 p-2 bg-red-500 text-white text-center rounded-md",children:"Wrong credentials. Please try again."}),(0,mg.jsx)("div",{children:(0,mg.jsx)("button",{type:"submit",className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-500 hover:bg-indigo-700 ",children:a?"Loading...":"Login"})})]})]})})},EA=()=>{const g=q(),[I,e]=(0,C.useState)([]),[t,l]=(0,C.useState)(0),[n,o]=(0,C.useState)([]),[a,i]=(0,C.useState)([]),[A,c]=(0,C.useState)(""),[s,d]=(0,C.useState)([]);(0,C.useEffect)((()=>{(async()=>{try{const I=await fetch("/api/item",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(!I.ok)return console.error("Failed to fetch inventory data"),window.localStorage.clear(),void g("/login");const C=await I.json();e(C);const t=(g=>g.reduce(((g,I)=>{const e=I.brand,C=g.find((g=>g.brand===e));return C?(C.quantityBuy+=I.quantityBuy,C.quantitySold+=I.quantitySold,C.totalValue+=(I.quantityBuy-I.quantitySold)*I.mrp):g.push({brand:e,quantityBuy:I.quantityBuy,quantitySold:I.quantitySold,totalValue:(I.quantityBuy-I.quantitySold)*I.mrp}),g}),[]))(C),n=(g=>{const I=g.reduce(((g,I)=>{const e=I.product,C=g.find((g=>g.product===e));return C?(C.totalValue+=(I.quantityBuy-I.quantitySold)*I.mrp,C.totalPieces+=I.quantityBuy-I.quantitySold,C.quantityBuy+=I.quantityBuy,C.quantitySold+=I.quantitySold):g.push({product:e,totalValue:(I.quantityBuy-I.quantitySold)*I.mrp,totalPieces:I.quantityBuy-I.quantitySold,quantityBuy:I.quantityBuy,quantitySold:I.quantitySold}),g}),[]);return I})(C);o(t),i(n);const a=C.reduce(((g,I)=>g+(I.quantityBuy-I.quantitySold)*I.mrp),0);l(a)}catch(I){console.log(I)}})()}),[]);const r=g=>{const I=["rgba(255, 99, 132, 0.7)","rgba(54, 162, 235, 0.7)","rgba(255, 206, 86, 0.7)","rgba(75, 192, 192, 0.7)","rgba(192, 192, 192, 0.7)"];for(let e=4;e<g;e++){const g="rgba(".concat(Math.floor(256*Math.random()),", ").concat(Math.floor(256*Math.random()),", ").concat(Math.floor(256*Math.random()),", 0.7)");I.push(g)}return I},b={labels:n.map((g=>g.brand)),datasets:[{data:n.map((g=>g.totalValue)),backgroundColor:r(n.length),borderWidth:1,label:"Worth"}]},u={labels:a.map((g=>g.product)),datasets:[{data:a.map((g=>g.quantityBuy)),backgroundColor:r(a.length),borderWidth:1,label:"Quantity Buy"},{data:a.map((g=>g.quantitySold)),backgroundColor:r(a.length).map((g=>g.replace("0.7","0.3"))),borderWidth:1,label:"Quantity Sold"}]},m={labels:s.map((g=>g.size)),datasets:[{data:s.map((g=>g.quantity)),backgroundColor:r(s.length),borderWidth:1,label:"Quantity Available"}]},Z=r(n.length),h={labels:n.map((g=>g.brand)),datasets:[{data:n.map((g=>g.quantityBuy)),backgroundColor:Z,borderWidth:1,label:"Quantity Buy"},{data:n.map((g=>g.quantitySold)),backgroundColor:Z.map((g=>g.replace("0.7","0.3"))),borderWidth:1,label:"Quantity Sold"}]};return(0,mg.jsxs)("div",{className:"p-4 bg-gray-100 rounded-md shadow-md",children:[(0,mg.jsx)("h2",{className:"text-3xl font-bold mb-4",children:"Inventory"}),(0,mg.jsxs)("div",{className:"mb-8",children:[(0,mg.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Total Inventory Value:"}),(0,mg.jsxs)("div",{className:"text-xl font-bold",children:["\u20b9",t?t.toLocaleString("hi"):"  Calculating......."]})]}),(0,mg.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Inventory by Brand"}),(0,mg.jsx)("div",{className:"flex items-center justify-center ",children:(0,mg.jsx)("div",{className:"w-screen h-screen",children:(0,mg.jsx)(Qa,{data:b,options:{maintainAspectRatio:!1}})})}),(0,mg.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Inventory by Product"}),(0,mg.jsx)("div",{className:"flex items-center justify-center",children:(0,mg.jsx)("div",{className:"w-screen h-screen",children:(0,mg.jsx)(Qa,{data:u,options:{maintainAspectRatio:!1}})})}),(0,mg.jsxs)("select",{value:A,onChange:g=>(g=>{c(g);const e=I.filter((I=>I.product===g)),C=e.reduce(((g,I)=>{const e=I.size,C=g.find((g=>g.size===e));return C?C.quantity+=I.quantityBuy-I.quantitySold:g.push({size:e,quantity:I.quantityBuy-I.quantitySold}),g}),[]);d(C)})(g.target.value),className:"mt-4 p-2 border rounded",children:[(0,mg.jsx)("option",{value:"",disabled:!0,children:"Select a Product"}),a.map((g=>(0,mg.jsx)("option",{value:g.product,children:g.product},g.product)))]}),A&&(0,mg.jsxs)("div",{children:[(0,mg.jsxs)("h3",{className:"text-lg font-semibold mb-2",children:["Sizes and Quantity for ",A]}),(0,mg.jsx)("div",{className:"flex items-center justify-center",children:(0,mg.jsx)("div",{className:"w-auto",children:(0,mg.jsx)(Qa,{data:m,height:100})})})]}),(0,mg.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Quantity Bought and Sold by Brand"}),(0,mg.jsx)("div",{className:"flex items-center justify-center",children:(0,mg.jsx)("div",{className:"w-screen h-screen",children:(0,mg.jsx)(Ea,{data:h,options:{maintainAspectRatio:!1}})})})]})},QA=()=>{const g=q(),[I,e]=(0,C.useState)([]),[t,l]=(0,C.useState)(null),[n,o]=(0,C.useState)(!1),[a,i]=(0,C.useState)(!1),[A,c]=(0,C.useState)(!1),[s,d]=(0,C.useState)(1),[r,b]=(0,C.useState)(null),[u,m]=(0,C.useState)(""),[Z,h]=(0,C.useState)("Code"),[G,B]=(0,C.useState)(!1),y=g=>{b((I=>I===g?null:g))};(0,C.useEffect)((()=>{W()}),[s]);const p=async(g,I)=>{c(!0);try{const e=await fetch("/api/item/".concat(G?"exact-search":"search","/").concat(g,"/").concat(I),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(e.ok){const g=await e.json();l(g),o(!1)}else 401===e.status?(window.localStorage.clear(),l(null),o(!0),c(!1)):(l(null),o(!0),c(!1))}catch(e){}finally{c(!1)}},W=async()=>{i(!0);try{const I=await fetch("/api/item/paginate?page=".concat(s,"&limit=10"),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(I.ok){const g=await I.json();e(1===s?g.items:I=>[...I,...g.items])}else console.error("Failed to fetch items"),window.localStorage.clear(),g("/login")}catch(I){console.error("Error fetching items:",I)}finally{i(!1)}};(0,C.useEffect)((()=>{p(Z,u)}),[Z,G]);const V=I=>{g("/edit-item/".concat(I))};return(0,mg.jsxs)("div",{children:[(0,mg.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"Purchase History"}),(0,mg.jsxs)("form",{onSubmit:g=>{g.preventDefault(),""===u.trim()?(l(null),o(!1)):p(Z,u),m("")},className:"mb-4 flex items-center",children:[(0,mg.jsxs)("select",{value:Z,onChange:g=>{h(g.target.value)},className:"border border-gray-300 rounded-l px-4 py-2 w-1/4",children:[(0,mg.jsx)("option",{value:"Code",children:"Code"}),(0,mg.jsx)("option",{value:"Brand",children:"Brand"}),(0,mg.jsx)("option",{value:"Product",children:"Product"}),(0,mg.jsx)("option",{value:"Category",children:"Category"}),(0,mg.jsx)("option",{value:"Size",children:"Size"}),(0,mg.jsx)("option",{value:"mrp>=",children:"MRP Gt"}),(0,mg.jsx)("option",{value:"mrp<=",children:"MRP Ls"})]}),(0,mg.jsx)("input",{type:"text",value:u,onChange:g=>{const I=g.target.value;/^[a-zA-Z0-9\s]*$/.test(I)&&(m(I.toUpperCase()),""===I?(l(null),o(!1)):p(Z,I))},placeholder:"Search by code",className:"border border-gray-300 rounded-l px-4 py-2 w-2/4"}),(0,mg.jsx)("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-r w-1/4",children:A?"Serahcing":"Search"})]}),(0,mg.jsx)("div",{className:"flex justify-center",children:(0,mg.jsx)("button",{onClick:g=>{g.preventDefault(),B((g=>!g))},className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded ".concat(G?"bg-blue-500 hover:bg-blue-700 text-white":""),children:G?"Exact Match Search On":"Exact Match Search Off"})}),A&&(0,mg.jsx)("p",{className:"text-green-500 text-center font-semibold",children:" Searching"}),t?(0,mg.jsxs)("div",{children:[(0,mg.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Searched Item"}),(0,mg.jsxs)("p",{children:["Number of result = ",t.length]}),t.map((g=>(0,mg.jsxs)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative",children:[(0,mg.jsxs)("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>y(g._id),children:[(0,mg.jsxs)("div",{children:[(0,mg.jsxs)("p",{className:"font-semibold text-lg",children:["Code: ",g.code]}),(0,mg.jsxs)("p",{className:"text-black",children:["Brand: ",g.brand]})]}),(0,mg.jsx)("svg",{className:"h-6 w-6 ".concat(r===g._id?"transform rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,mg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),r===g._id&&(0,mg.jsx)("div",{className:"flex items-center justify-evenly border-t border-gray-300 mt-4 pt-4",children:(0,mg.jsxs)("div",{className:"text-black",children:[(0,mg.jsxs)("p",{className:"font-semibold py-1",children:["Product: ",g.product]}),(0,mg.jsxs)("p",{className:"font-semibold py-1",children:["Category: ",g.category]}),(0,mg.jsxs)("p",{className:"font-semibold py-1",children:["Size: ",g.size]}),(0,mg.jsxs)("p",{className:"font-semibold py-1",children:["Quantity Available: ",g.quantityBuy-g.quantitySold]}),(0,mg.jsxs)("p",{className:"font-semibold py-1",children:["MRP: ",g.mrp]}),(0,mg.jsx)("button",{onClick:()=>V(g.code),className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-1 mr-2",children:"Edit"})]})})]},g._id)))]}):n&&(0,mg.jsx)("div",{className:"mt-2 p-2 bg-red-500 text-white text-center rounded-md",children:"No product found with this code."}),(0,mg.jsx)("hr",{className:"my-8 border-t border-gray-300"}),(0,mg.jsxs)("div",{children:[(0,mg.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"All Items"}),I.map((g=>(0,mg.jsxs)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative",children:[(0,mg.jsxs)("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>y(g._id),children:[(0,mg.jsxs)("div",{children:[(0,mg.jsxs)("p",{className:"font-semibold text-lg",children:["Code: ",g.code]}),(0,mg.jsxs)("p",{className:"text-black",children:["Brand: ",g.brand]})]}),(0,mg.jsx)("svg",{className:"h-6 w-6 ".concat(r===g._id?"transform rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,mg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),r===g._id&&(0,mg.jsx)("div",{className:"flex items-center justify-evenly border-t border-gray-300 mt-4 pt-4",children:(0,mg.jsxs)("div",{className:"text-black",children:[(0,mg.jsxs)("p",{className:"font-semibold py-1",children:["Product: ",g.product]}),(0,mg.jsxs)("p",{className:"font-semibold py-1",children:["Category: ",g.category]}),(0,mg.jsxs)("p",{className:"font-semibold py-1",children:["Size: ",g.size]}),(0,mg.jsxs)("p",{className:"font-semibold py-1",children:["Quantity Available: ",g.quantityBuy-g.quantitySold]}),(0,mg.jsxs)("p",{className:"font-semibold py-1",children:["MRP: ",g.mrp]}),(0,mg.jsx)("button",{onClick:()=>V(g.code),className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-1 mr-2",children:"Edit"})]})})]},g._id))),(0,mg.jsx)("div",{className:"flex justify-center",children:(0,mg.jsx)("button",{onClick:()=>{d((g=>g+1))},className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-1",children:a?"loading....":"Load More"})})]})]})},UA=()=>{const g=q(),{code:I}=function(){let{matches:g}=C.useContext(T),I=g[g.length-1];return I?I.params:{}}(),[e,t]=(0,C.useState)({brand:"",product:"",category:"",size:"",mrp:"",quantityBuy:""}),[l,n]=(0,C.useState)({...e}),[o,a]=(0,C.useState)({products:[],categories:[],sizes:[{size:[]}]}),[i,A]=(0,C.useState)(!1),[c,s]=(0,C.useState)(!1),[d,r]=(0,C.useState)(!1),[b,u]=(0,C.useState)(!1),[m,Z]=(0,C.useState)(!1),[h,G]=(0,C.useState)(!1),[B,y]=(0,C.useState)(!1),[p,W]=(0,C.useState)("");(0,C.useEffect)((()=>{window.localStorage.getItem("userInfo")||g("/login")}),[g]);(0,C.useEffect)((()=>{(()=>{var g=Object.keys(e).some((g=>e[g]!=l[g]))&&""!==l.mrp&&""!==l.quantityBuy;A(g)})()}),[l]),(0,C.useEffect)((()=>{(async()=>{try{if(r(!0),!window.localStorage.getItem("userInfo"))throw new Error("User not logged in");const[g,e]=await Promise.all([fetch("/api/item/code/".concat(I),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}}),fetch("/api/dropdownoption/dropdownoptions",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}})]);if(!g.ok)throw new Error("Failed to fetch item details");const C=await g.json();if(t(C),n(C),!e.ok)throw new Error("Failed to fetch dropdown options");const l=await e.json(),o=l.products.filter((g=>g.brand===C.brand));o.forEach((g=>{g.products.sort()})),l.categories[0].category.sort(((g,I)=>g.localeCompare(I))),a({...l,products:o})}catch(e){console.error("Error fetching dropdown options and item details:",e),window.localStorage.clear(),g("/login")}finally{r(!1)}})()}),[]);const V=g=>{const{name:I,value:e}=g.target;"mrp"===I&&parseFloat(e)<0||"quantityBuy"===I&&parseFloat(e)<0||n((g=>({...g,[I]:e})))};return(0,mg.jsxs)("div",{className:"bg-white p-6 shadow-md rounded-md",children:[(0,mg.jsx)("h2",{className:"text-2xl font-semibold mb-6",children:"Edit Page"}),h&&(0,mg.jsx)(mg.Fragment,{children:(0,mg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999},children:(0,mg.jsxs)("div",{className:"bg-white border  px-4 py-3 rounded relative w-full m-5",role:"alert",children:[(0,mg.jsx)("strong",{className:"font-bold text-center",children:"Are you sure ?"}),(0,mg.jsx)("div",{children:(0,mg.jsx)("button",{className:"w-full mt-6 py-2 px-4 rounded focus:outline-none ".concat(i?"bg-indigo-500 text-white":"bg-gray-500 text-gray-500 opacity-50 cursor-not-allowed"),onClick:async()=>{s(!0);try{const C=Object.entries(l).reduce(((g,I)=>{let[C,t]=I;return e[C]!==t&&(g[C]=t),g}),{});(await fetch("/api/item/".concat(I),{method:"PATCH",headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token),"Content-Type":"application/json"},body:JSON.stringify(C)})).ok?g("/history"):(console.error("Failed to update purchase"),u(!0),setTimeout((()=>{u(!1)}),3e3))}catch(C){console.error("Error:",C)}finally{s(!1)}},children:"Confirm"})}),(0,mg.jsx)("span",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",children:(0,mg.jsxs)("svg",{className:"fill-current h-6 w-6  cursor-pointer",role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",onClick:()=>G(!1),children:[(0,mg.jsx)("title",{children:"Close"}),(0,mg.jsx)("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})]})})]})})}),d?(0,mg.jsx)("h1",{className:"text-green-500 text-center text-2xl font-semibold mb-6",children:"Loading...."}):(0,mg.jsxs)(mg.Fragment,{children:[(0,mg.jsx)("select",{name:"brand",value:l.brand,disabled:!0,className:"w-full p-2 border rounded-md",children:(0,mg.jsx)("option",{value:l.brand,children:l.brand})}),(0,mg.jsxs)("select",{name:"product",value:l.product,onChange:V,className:"w-full mt-4 p-2 border rounded-md",children:[(0,mg.jsx)("option",{value:"",disabled:!0,children:"Select Product"}),o.products.map((g=>g.products.map((g=>(0,mg.jsx)("option",{value:g,children:g},g)))))]}),(0,mg.jsxs)("select",{name:"category",value:l.category,onChange:V,className:"w-full mt-4 p-2 border rounded-md",children:[(0,mg.jsx)("option",{value:"",disabled:!0,children:"Select Category"}),o.categories.map((g=>g.category.map((g=>(0,mg.jsx)("option",{value:g,children:g},g)))))]}),(0,mg.jsxs)("select",{name:"size",value:l.size,onChange:V,className:"w-full mt-4 p-2 border rounded-md",children:[(0,mg.jsx)("option",{value:"",disabled:!0,children:"Select Size"}),o.sizes.map((g=>g.size.map((g=>(0,mg.jsx)("option",{value:g,children:g},g)))))]}),(0,mg.jsx)("input",{type:"number",placeholder:"MRP",name:"mrp",value:l.mrp,onChange:V,className:"w-full mt-4 p-2 border rounded-md"}),(0,mg.jsx)("input",{type:"number",placeholder:"Quantity Buy",name:"quantityBuy",value:l.quantityBuy,onChange:V,className:"w-full mt-4 p-2 border rounded-md"})]}),b&&(0,mg.jsx)("div",{className:"text-red-500 text-center text-sm mt-2",children:"Error while updating try again"}),(0,mg.jsx)("button",{onClick:()=>{G(!0)},disabled:!i||c,className:"w-full mt-6 py-2 px-4 rounded focus:outline-none ".concat(i?"bg-indigo-500 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:c?"Updating...":"Update"}),m&&(0,mg.jsx)("div",{className:"text-red-500 text-center text-sm mt-2",children:"Error while Deleting try again.."}),(0,mg.jsx)("button",{onClick:()=>{y(!0)},className:"w-full mt-6 py-2 px-4 rounded focus:outline-none bg-red-500 text-white",children:"Delete This Product"}),B&&(0,mg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:(0,mg.jsxs)("div",{className:"bg-white p-6 rounded-md",children:[(0,mg.jsx)("p",{className:"mb-4",children:"Type 'CONFIRM' to delete this item:"}),(0,mg.jsx)("input",{type:"text",value:p,onChange:g=>{W(g.target.value.toUpperCase())},className:"border border-gray-300 p-2 rounded-md mb-4"}),(0,mg.jsxs)("div",{className:"flex justify-between",children:[(0,mg.jsx)("button",{onClick:()=>{W(""),y(!1)},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md mr-2",children:"Cancel"}),(0,mg.jsx)("button",{disabled:"CONFIRM"!==p,onClick:async()=>{if("CONFIRM"===p)try{(await fetch("/api/item/".concat(I),{method:"DELETE",headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}})).ok?g("/history"):(console.error("Failed to delete item"),y(!1),Z(!0),setTimeout((()=>{Z(!1)}),3e3))}catch(e){console.error("Error:",e)}},className:"px-4 py-2 rounded-md ".concat("CONFIRM"!==p?"bg-gray-300 text-gray-700 cursor-not-allowed":"bg-red-500 text-white"),children:"Confirm"})]})]})})]})},LA=()=>{const[g,I]=(0,C.useState)([]),[e,t]=(0,C.useState)(null),[l,n]=(0,C.useState)(!1),[o,a]=(0,C.useState)(!1),[i,A]=(0,C.useState)(!1),[c,s]=(0,C.useState)(1),[d,r]=(0,C.useState)(null),[b,u]=(0,C.useState)(""),[m,Z]=(0,C.useState)("Code"),[h,G]=(0,C.useState)(!1),[B,y]=(0,C.useState)(!1),[p,W]=(0,C.useState)(""),[V,S]=(0,C.useState)(!1),[X,R]=(0,C.useState)(""),[J,k]=(0,C.useState)(!1),[Y,f]=(0,C.useState)({}),v=g=>{r((I=>I===g?null:g))};(0,C.useEffect)((()=>{w()}),[c]);const H=async(g,I)=>{A(!0);try{const e=await fetch("/api/saleslog/".concat(h?"exact-search":"search","/").concat(g,"/").concat(I),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(e.ok){const g=await e.json();t(g),n(!1)}else 401===e.status?(window.localStorage.clear(),t(null),n(!0),A(!1)):(t(null),n(!0),A(!1))}catch(e){}finally{A(!1)}},w=async()=>{a(!0);try{const g=await fetch("/api/saleslog/paginate?page=".concat(c,"&limit=10"),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(g.ok){const e=await g.json();I(1===c?e.sales:g=>[...g,...e.sales])}else console.error("Failed to fetch sales")}catch(g){console.error("Error fetching sales:",g)}finally{a(!1)}};(0,C.useEffect)((()=>{H(m,b)}),[m,h,J]);const N=g=>{y(!0),R(g)};return(0,C.useEffect)((()=>{f((()=>{const I={};return g.forEach((g=>{const e=new Date(g.soldAt).getDate();I[e]||(I[e]=[]),I[e].push(g)})),I})())}),[g]),(0,mg.jsxs)("div",{children:[(0,mg.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"Sale History"}),(0,mg.jsxs)("form",{onSubmit:g=>{g.preventDefault(),""===b.trim()?(t(null),n(!1)):H(m,b),u("")},className:"mb-4 flex items-center",children:[(0,mg.jsxs)("select",{value:m,onChange:g=>{Z(g.target.value)},className:"border border-gray-300 rounded-l px-4 py-2 w-1/4",children:[(0,mg.jsx)("option",{value:"Sale Code",children:"Code"}),(0,mg.jsx)("option",{value:"Customer Name",children:"Brand"}),(0,mg.jsx)("option",{value:"Product",children:"Product"}),(0,mg.jsx)("option",{value:"Category",children:"Category"}),(0,mg.jsx)("option",{value:"Sale Date",children:"Size"})]}),(0,mg.jsx)("input",{type:"text",value:b,onChange:g=>{const I=g.target.value;/^[a-zA-Z0-9\s]*$/.test(I)&&(u(I.toUpperCase()),""===I?(t(null),n(!1)):H(m,I))},placeholder:"Search by code",className:"border border-gray-300 rounded-l px-4 py-2 w-2/4"}),(0,mg.jsx)("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-r w-1/4",children:i?"Searching":"Search"})]}),(0,mg.jsx)("div",{className:"flex justify-center",children:(0,mg.jsx)("button",{onClick:g=>{g.preventDefault(),G((g=>!g))},className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded ".concat(h?"bg-blue-500 hover:bg-blue-700 text-white":""),children:h?"Exact Match Search On":"Exact Match Search Off"})}),i&&(0,mg.jsx)("p",{className:"text-green-500 text-center font-semibold",children:"Searching"}),e?(0,mg.jsxs)("div",{children:[(0,mg.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Searched Sales"}),(0,mg.jsxs)("p",{children:["Number of results: ",e.length]}),e.map((g=>(0,mg.jsxs)("div",{className:"bg-gray-200 border border-black text-black px-4 py-3 rounded relative",children:[(0,mg.jsxs)("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>v(g._id),children:[(0,mg.jsxs)("div",{children:[(0,mg.jsxs)("p",{className:"font-semibold text-lg",children:["Code: ",g.code]}),(0,mg.jsxs)("p",{className:"text-black",children:["Brand: ",g.brand]})]}),(0,mg.jsxs)("div",{children:[new Date(g.soldAt).toLocaleString(),(0,mg.jsx)("svg",{className:"h-6 w-6 ".concat(d===g._id?"transform rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,mg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),d===g._id&&(0,mg.jsx)("div",{className:"flex items-center justify-evenly border-t border-gray-300 mt-4 pt-4",children:(0,mg.jsxs)("div",{className:"text-black",children:[(0,mg.jsxs)("p",{className:"font-semibold py-1",children:["Product: ",g.product]}),(0,mg.jsxs)("p",{className:"font-semibold py-1",children:["Category: ",g.category]}),(0,mg.jsxs)("p",{className:"font-semibold py-1",children:["Selling Price: ",g.sellingPrice]}),g.sellingPrice-g.mrp>=0?(0,mg.jsxs)("p",{className:"font-semibold py-1 text-green-500",children:["Profit : ",g.sellingPrice-g.mrp]}):(0,mg.jsxs)("p",{className:"font-semibold py-1 text-red-500",children:["Loss : ",g.sellingPrice-g.mrp]}),V&&(0,mg.jsx)("div",{className:"text-red-500 text-center text-sm mt-2",children:"Error while Deleting try again.."}),(0,mg.jsx)("button",{onClick:()=>{N(g.code)},className:"w-full mt-6 py-2 px-4 rounded focus:outline-none bg-red-500 text-white",children:"Return"})]})})]},g._id)))]}):l&&(0,mg.jsx)("div",{className:"mt-2 p-2 bg-red-500 text-white text-center rounded-md",children:"No sale found with this criteria."}),(0,mg.jsx)("hr",{className:"my-8 border-t border-gray-300"}),(0,mg.jsxs)("div",{children:[(0,mg.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"All Sales"}),Object.keys(Y).sort(((g,I)=>new Date(I)-new Date(g))).map(((g,I)=>{const e=Y[g],t=e.reduce(((g,I)=>g+I.sellingPrice),0),l=e.reduce(((g,I)=>g+(I.sellingPrice-I.mrp)),0);return(0,mg.jsxs)(C.Fragment,{children:[(0,mg.jsxs)("div",{className:"bg-green-200 border border-black text-black px-4 py-3 rounded relative flex justify-between items-center cursor-pointer font-semibold",children:[(0,mg.jsx)("p",{children:new Date(e[0].soldAt).toLocaleDateString()}),(0,mg.jsxs)("p",{children:["Sale - ",t]}),l>=0?(0,mg.jsxs)("p",{className:"font-semibold py-1 text-black",children:["Profit : ",l]}):(0,mg.jsxs)("p",{className:"font-semibold py-1 text-red-500",children:["Loss : ",l]})]}),e.map((g=>(0,mg.jsxs)("div",{className:"bg-gray-200 border border-black text-black px-4 py-3 rounded relative",children:[(0,mg.jsxs)("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>v(g._id),children:[(0,mg.jsxs)("div",{children:[(0,mg.jsxs)("p",{className:"font-semibold text-lg",children:["Code: ",g.code]}),(0,mg.jsxs)("p",{className:"text-black",children:["Brand : ",g.brand]})]}),(0,mg.jsxs)("div",{children:[new Date(g.soldAt).toLocaleString(),(0,mg.jsx)("svg",{className:"h-6 w-6 ".concat(d===g._id?"transform rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,mg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),d===g._id&&(0,mg.jsx)("div",{className:"flex items-center justify-evenly border-t border-gray-300 mt-4 pt-4",children:(0,mg.jsxs)("div",{className:"text-black",children:[(0,mg.jsxs)("p",{className:"font-semibold py-1",children:["Product: ",g.product]}),(0,mg.jsxs)("p",{className:"font-semibold py-1",children:["Category: ",g.category]}),(0,mg.jsxs)("p",{className:"font-semibold py-1",children:["Selling Price: ",g.sellingPrice]}),g.sellingPrice-g.mrp>=0?(0,mg.jsxs)("p",{className:"font-semibold py-1 text-green-500",children:["Profit : ",g.sellingPrice-g.mrp]}):(0,mg.jsxs)("p",{className:"font-semibold py-1 text-red-500",children:["Loss : ",g.sellingPrice-g.mrp]}),V&&(0,mg.jsx)("div",{className:"text-red-500 text-center text-sm mt-2",children:"Error while Deleting try again.."}),(0,mg.jsx)("button",{onClick:()=>{N(g.code)},className:"w-full mt-6 py-2 px-4 rounded focus:outline-none bg-red-500 text-white",children:"Return"})]})})]},g._id)))]},g)})),(0,mg.jsx)("div",{className:"flex justify-center",children:(0,mg.jsx)("button",{onClick:()=>{s((g=>g+1))},className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-1",children:o?"Loading...":"Load More"})})]}),B&&(0,mg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:(0,mg.jsxs)("div",{className:"bg-white p-6 rounded-md",children:[(0,mg.jsx)("p",{className:"mb-4",children:"Type 'CONFIRM' to delete this item:"}),(0,mg.jsx)("div",{className:"flex justify-center",children:(0,mg.jsx)("input",{type:"text",value:p,onChange:g=>{W(g.target.value.toUpperCase())},className:"border border-gray-300 p-2 rounded-md mb-4"})}),(0,mg.jsxs)("div",{className:"flex justify-between",children:[(0,mg.jsx)("button",{onClick:()=>{W(""),y(!1)},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md mr-2",children:"Cancel"}),(0,mg.jsx)("button",{disabled:"CONFIRM"!==p,onClick:async()=>{if("CONFIRM"===p)try{(await fetch("/api/saleslog/".concat(X),{method:"DELETE",headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}})).ok?(await w(),k(!J),R(""),y(!1),W("")):(console.error("Failed to delete "),W(""),y(!1),S(!0),setTimeout((()=>{S(!1)}),3e3))}catch(g){console.error("Error:",g)}},className:"px-4 py-2 rounded-md ".concat("CONFIRM"!==p?"bg-gray-300 text-gray-700 cursor-not-allowed":"bg-red-500 text-white"),children:"Confirm"})]})]})})]})},DA=()=>{const g=C.useRef(),[I,e]=(0,C.useState)([]),[t,l]=(0,C.useState)(!1),[n,o]=(0,C.useState)(1),[a,i]=(0,C.useState)([]),[A,c]=(0,C.useState)(null),[s,d]=(0,C.useState)(!1);(0,C.useEffect)((()=>{(async()=>{l(!0);try{const g=await fetch("/api/item/paginate?page=".concat(n,"&limit=10"),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(g.ok){const I=await g.json();i(1===n?I.items:g=>[...g,...I.items])}else console.error("Failed to fetch items")}catch(g){console.error("Error fetching items:",g)}finally{l(!1)}})()}),[n]);const r=(0,Qg.useReactToPrint)({content:()=>g.current});return(0,mg.jsxs)("div",{children:[(0,mg.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"Print Tags"}),(0,mg.jsx)("div",{className:"flex justify-center",children:(0,mg.jsx)("button",{onClick:()=>{console.log(I),d(!0)},disabled:0===I.length,className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-1 mr-2 ".concat(0===I.length?"opacity-50 cursor-not-allowed":""),children:"Print Selected"})}),s&&(0,mg.jsx)(mg.Fragment,{children:(0,mg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999},children:(0,mg.jsxs)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative w-full m-5",role:"alert",contentEditable:!0,children:[(0,mg.jsx)("strong",{className:"font-bold",children:"Items added to inventory:"}),(0,mg.jsx)("div",{className:"flex justify-center",children:(0,mg.jsxs)("div",{style:{width:"106mm"},ref:g,className:"flex flex-wrap",children:[I.length%2!==0&&I.push({code:"",brand:"",product:"",category:"",size:"",quantityBuy:0,quantitySold:0,mrp:100,secretCode:""}),I.map(((g,I)=>{return(0,mg.jsx)("div",{className:"flex items-center justify-evenly",children:(0,mg.jsxs)("div",{style:{width:"50mm",height:"25mm",padding:0,marginLeft:"1.3mm",marginRight:"1.3mm"},className:"flex justify-evenly bg-white",children:[(0,mg.jsxs)("div",{className:"p-2 pr-0",children:[(0,mg.jsx)(Eg,{value:g.code,size:60}),(0,mg.jsx)("p",{className:"text-black",children:g.code})]}),(0,mg.jsxs)("div",{className:"relative font-bold text-black pt-1",children:[(0,mg.jsx)("div",{className:"flex justify-center",children:(0,mg.jsx)("img",{src:"Images/Ganesha.jpg",alt:"project",width:"25mm"})}),(0,mg.jsxs)("div",{children:[(0,mg.jsxs)("p",{children:["MRP: ",(e=g.mrp,e-=100,100*Math.ceil(e/100)*2+100-4),"/-"]}),(0,mg.jsxs)("p",{children:["Size: ",g.size]}),(0,mg.jsx)("div",{children:(0,mg.jsx)("p",{className:"absolute right-1 bottom-1 text-sm font-normal",children:g.secretCode})})]})]})]})},I);var e}))]})}),(0,mg.jsx)("button",{onClick:r,disabled:0===I.length,className:"w-full py-2 px-4 rounded focus:outline-none focus:shadow-outline-indigo active:bg-indigo-800 ".concat(0!==I.length?"bg-indigo-500 text-white":"bg-gray-300 text-black opacity-50 cursor-not-allowed"),children:"Print"}),(0,mg.jsx)("span",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",children:(0,mg.jsxs)("svg",{className:"fill-current h-6 w-6 text-green-500 cursor-pointer",role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",onClick:()=>d(!1),children:[(0,mg.jsx)("title",{children:"Close"}),(0,mg.jsx)("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})]})})]})})}),(0,mg.jsx)("div",{children:a.map((g=>(0,mg.jsx)("div",{children:(0,mg.jsxs)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative",children:[(0,mg.jsxs)("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>{return I=g._id,void c((g=>g===I?null:I));var I},children:[(0,mg.jsxs)("div",{children:[(0,mg.jsxs)("p",{className:"font-semibold text-lg",children:["Code: ",g.code]}),(0,mg.jsxs)("p",{className:"text-black",children:["Brand: ",g.brand]})]}),(0,mg.jsxs)("div",{children:[(0,mg.jsx)("input",{type:"checkbox",checked:I.includes(g),onChange:()=>(g=>{e((I=>-1!==I.findIndex((I=>I._id===g._id))?I.filter((I=>I._id!==g._id)):[...I,g]))})(g)}),(0,mg.jsx)("svg",{className:"h-6 w-6 ".concat(A===g._id?"transform rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"})]})]}),A===g._id&&(0,mg.jsx)("div",{className:"flex items-center justify-evenly border-t border-gray-300 mt-4 pt-4",children:(0,mg.jsxs)("div",{className:"text-black",children:[(0,mg.jsxs)("p",{className:"font-semibold py-1",children:["Product: ",g.product]}),(0,mg.jsxs)("p",{className:"font-semibold py-1",children:["Category: ",g.category]}),(0,mg.jsxs)("p",{className:"font-semibold py-1",children:["Size: ",g.size]}),(0,mg.jsxs)("p",{className:"font-semibold py-1",children:["Quantity Available: ",g.quantityBuy-g.quantitySold]}),(0,mg.jsxs)("p",{className:"font-semibold py-1",children:["MRP: ",g.mrp]})]})})]},g._id)},g._id)))}),(0,mg.jsx)("div",{className:"flex justify-center",children:(0,mg.jsx)("button",{onClick:()=>{o((g=>g+1))},className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-1",children:t?"Loading...":"Load More"})})]})},TA=()=>{const[g,I]=(0,C.useState)([]),[e,t]=(0,C.useState)(!1),[l,n]=(0,C.useState)(1),[o,a]=(0,C.useState)({});(0,C.useEffect)((()=>{a((()=>{const I={};return g.forEach((g=>{const e=new Date(g.date).toLocaleDateString();I[e]||(I[e]=[]),I[e].push(g)})),I})())}),[g]),(0,C.useEffect)((()=>{i()}),[l]);const i=async()=>{t(!0);try{const g=await fetch("/api/expenselog/paginate?page=".concat(l,"&limit=10"),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(g.ok){const e=await g.json();I(1===l?e.expenses:g=>[...g,...e.expenses])}else console.error("Failed to fetch expenses")}catch(g){console.error("Error fetching expenses:",g)}finally{t(!1)}};return(0,mg.jsxs)("div",{children:[(0,mg.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"Expense History"}),(0,mg.jsxs)("div",{children:[(0,mg.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"All Expenses"}),Object.keys(o).sort(((g,I)=>new Date(I)-new Date(g))).map((g=>(0,mg.jsx)(C.Fragment,{children:(0,mg.jsxs)("div",{children:[(0,mg.jsxs)("div",{className:"bg-red-100 border border-black text-black  rounded relative flex justify-between items-center cursor-pointer font-semibold pr-2 pl-2",children:[(0,mg.jsx)("h3",{className:"text-lg font-semibold",children:g}),(0,mg.jsxs)("p",{className:"font-semibold",children:["Total Expense:"," ",o[g].reduce(((g,I)=>g+I.expenseAmount),0)]})]}),o[g].map((g=>(0,mg.jsxs)("div",{className:"flex justify-between items-center cursor-pointer bg-gray-100 border border-black text-black px-4 py-3 rounded relative",children:[(0,mg.jsx)("span",{className:"font-semibold",children:g.expenseType}),(0,mg.jsx)("span",{className:"text-red-500",children:g.expenseAmount})]},g._id)))]},g)},g))),e&&(0,mg.jsx)("p",{className:"text-center",children:"Loading expenses..."}),g.length>0&&(0,mg.jsx)("div",{className:"flex justify-center",children:(0,mg.jsx)("button",{onClick:()=>{n((g=>g+1))},className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-4",children:e?"Loading...":"Load More"})})]})]})},jA=()=>{const[g]=Dg(),I="admin"===g;var e="dev"===g;return(0,mg.jsxs)(mg.Fragment,{children:[(0,mg.jsx)(La,{}),(0,mg.jsxs)(dg,{children:[(0,mg.jsx)(cg,{path:"/login",element:(0,mg.jsx)(MA,{})}),(0,mg.jsx)(cg,{path:"/menu",element:(0,mg.jsx)(jg,{})}),(0,mg.jsx)(cg,{path:"/sale",element:(0,mg.jsx)(Zg,{})}),(0,mg.jsx)(cg,{path:"/purchase",element:(0,mg.jsx)(Ug,{})}),(0,mg.jsx)(cg,{path:"/print-tag",element:(0,mg.jsx)(DA,{})}),(I||e)&&(0,mg.jsx)(cg,{path:"/dashboard",element:(0,mg.jsx)(Ua,{})}),(0,mg.jsx)(cg,{path:"/add-brand-product",element:(0,mg.jsx)(Da,{})}),(0,mg.jsx)(cg,{path:"/add-category",element:(0,mg.jsx)(Ta,{})}),(0,mg.jsx)(cg,{path:"/add-size",element:(0,mg.jsx)(ja,{})}),(I||e)&&(0,mg.jsx)(cg,{path:"/inventory",element:(0,mg.jsx)(EA,{})}),(0,mg.jsx)(cg,{path:"/add-expense",element:(0,mg.jsx)(Pa,{})}),(I||e)&&(0,mg.jsx)(cg,{path:"/history",element:(0,mg.jsx)(QA,{})}),(I||e)&&(0,mg.jsx)(cg,{path:"/sale-history",element:(0,mg.jsx)(LA,{})}),e&&(0,mg.jsx)(cg,{path:"/sale-history/:code",element:(0,mg.jsx)(LA,{})}),(0,mg.jsx)(cg,{path:"/expense-history",element:(0,mg.jsx)(TA,{})}),e&&(0,mg.jsx)(cg,{path:"/edit-item/:code",element:(0,mg.jsx)(UA,{})}),(0,mg.jsx)(cg,{path:"*",element:(0,mg.jsx)(jg,{})})]})]})};var PA=e(950),OA=e.t(PA,2);new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);try{window.__reactRouterVersion="6"}catch(ec){}new Map;const _A=t.startTransition;OA.flushSync,t.useId;function qA(g){let{basename:I,children:e,future:t,window:l}=g,n=C.useRef();var o;null==n.current&&(n.current=(void 0===(o={window:l,v5Compat:!0})&&(o={}),r((function(g,I){let{pathname:e,search:C,hash:t}=g.location;return c("",{pathname:e,search:C,hash:t},I.state&&I.state.usr||null,I.state&&I.state.key||"default")}),(function(g,I){return"string"===typeof I?I:s(I)}),null,o)));let a=n.current,[i,A]=C.useState({action:a.action,location:a.location}),{v7_startTransition:d}=t||{},b=C.useCallback((g=>{d&&_A?_A((()=>A(g))):A(g)}),[A,d]);return C.useLayoutEffect((()=>a.listen(b)),[a,b]),C.createElement(sg,{basename:I,children:e,location:i.location,navigationType:i.action,navigator:a,future:t})}"undefined"!==typeof window&&"undefined"!==typeof window.document&&window.document.createElement;var $A,gc;(function(g){g.UseScrollRestoration="useScrollRestoration",g.UseSubmit="useSubmit",g.UseSubmitFetcher="useSubmitFetcher",g.UseFetcher="useFetcher",g.useViewTransitionState="useViewTransitionState"})($A||($A={})),function(g){g.UseFetcher="useFetcher",g.UseFetchers="useFetchers",g.UseScrollRestoration="useScrollRestoration"}(gc||(gc={}));const Ic=()=>(0,mg.jsx)(qA,{children:(0,mg.jsx)(Tg,{children:(0,mg.jsx)(jA,{})})});l.createRoot(document.getElementById("root")).render((0,mg.jsx)(C.StrictMode,{children:(0,mg.jsx)(Ic,{})}))})()})();
//# sourceMappingURL=main.d3a82741.js.map