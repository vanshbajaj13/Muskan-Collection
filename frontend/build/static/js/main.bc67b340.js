/*! For license information please see main.bc67b340.js.LICENSE.txt */
(()=>{var g={730:(g,e,t)=>{"use strict";var I=t(43),l=t(853);function C(g){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+g,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+g+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,o={};function a(g,e){i(g,e),i(g+"Capture",e)}function i(g,e){for(o[g]=e,g=0;g<e.length;g++)n.add(e[g])}var s=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),c=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,A={},r={};function u(g,e,t,I,l,C,n){this.acceptsBooleans=2===e||3===e||4===e,this.attributeName=I,this.attributeNamespace=l,this.mustUseProperty=t,this.propertyName=g,this.type=e,this.sanitizeURL=C,this.removeEmptyString=n}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(g){m[g]=new u(g,0,!1,g,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(g){var e=g[0];m[e]=new u(e,1,!1,g[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(g){m[g]=new u(g,2,!1,g.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(g){m[g]=new u(g,2,!1,g,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(g){m[g]=new u(g,3,!1,g.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(g){m[g]=new u(g,3,!0,g,null,!1,!1)})),["capture","download"].forEach((function(g){m[g]=new u(g,4,!1,g,null,!1,!1)})),["cols","rows","size","span"].forEach((function(g){m[g]=new u(g,6,!1,g,null,!1,!1)})),["rowSpan","start"].forEach((function(g){m[g]=new u(g,5,!1,g.toLowerCase(),null,!1,!1)}));var b=/[\-:]([a-z])/g;function h(g){return g[1].toUpperCase()}function Z(g,e,t,I){var l=m.hasOwnProperty(e)?m[e]:null;(null!==l?0!==l.type:I||!(2<e.length)||"o"!==e[0]&&"O"!==e[0]||"n"!==e[1]&&"N"!==e[1])&&(function(g,e,t,I){if(null===e||"undefined"===typeof e||function(g,e,t,I){if(null!==t&&0===t.type)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return!I&&(null!==t?!t.acceptsBooleans:"data-"!==(g=g.toLowerCase().slice(0,5))&&"aria-"!==g);default:return!1}}(g,e,t,I))return!0;if(I)return!1;if(null!==t)switch(t.type){case 3:return!e;case 4:return!1===e;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}(e,t,l,I)&&(t=null),I||null===l?function(g){return!!c.call(r,g)||!c.call(A,g)&&(d.test(g)?r[g]=!0:(A[g]=!0,!1))}(e)&&(null===t?g.removeAttribute(e):g.setAttribute(e,""+t)):l.mustUseProperty?g[l.propertyName]=null===t?3!==l.type&&"":t:(e=l.attributeName,I=l.attributeNamespace,null===t?g.removeAttribute(e):(t=3===(l=l.type)||4===l&&!0===t?"":""+t,I?g.setAttributeNS(I,e,t):g.setAttribute(e,t))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(g){var e=g.replace(b,h);m[e]=new u(e,1,!1,g,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(g){var e=g.replace(b,h);m[e]=new u(e,1,!1,g,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(g){var e=g.replace(b,h);m[e]=new u(e,1,!1,g,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(g){m[g]=new u(g,1,!1,g.toLowerCase(),null,!1,!1)})),m.xlinkHref=new u("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(g){m[g]=new u(g,1,!1,g.toLowerCase(),null,!0,!0)}));var G=I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,p=Symbol.for("react.element"),y=Symbol.for("react.portal"),B=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),W=Symbol.for("react.profiler"),V=Symbol.for("react.provider"),R=Symbol.for("react.context"),X=Symbol.for("react.forward_ref"),J=Symbol.for("react.suspense"),k=Symbol.for("react.suspense_list"),f=Symbol.for("react.memo"),v=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var Y=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var x=Symbol.iterator;function H(g){return null===g||"object"!==typeof g?null:"function"===typeof(g=x&&g[x]||g["@@iterator"])?g:null}var N,w=Object.assign;function F(g){if(void 0===N)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);N=e&&e[1]||""}return"\n"+N+g}var K=!1;function z(g,e){if(!g||K)return"";K=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(e,[])}catch(i){var I=i}Reflect.construct(g,[],e)}else{try{e.call()}catch(i){I=i}g.call(e.prototype)}else{try{throw Error()}catch(i){I=i}g()}}catch(i){if(i&&I&&"string"===typeof i.stack){for(var l=i.stack.split("\n"),C=I.stack.split("\n"),n=l.length-1,o=C.length-1;1<=n&&0<=o&&l[n]!==C[o];)o--;for(;1<=n&&0<=o;n--,o--)if(l[n]!==C[o]){if(1!==n||1!==o)do{if(n--,0>--o||l[n]!==C[o]){var a="\n"+l[n].replace(" at new "," at ");return g.displayName&&a.includes("<anonymous>")&&(a=a.replace("<anonymous>",g.displayName)),a}}while(1<=n&&0<=o);break}}}finally{K=!1,Error.prepareStackTrace=t}return(g=g?g.displayName||g.name:"")?F(g):""}function M(g){switch(g.tag){case 5:return F(g.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return g=z(g.type,!1);case 11:return g=z(g.type.render,!1);case 1:return g=z(g.type,!0);default:return""}}function E(g){if(null==g)return null;if("function"===typeof g)return g.displayName||g.name||null;if("string"===typeof g)return g;switch(g){case B:return"Fragment";case y:return"Portal";case W:return"Profiler";case S:return"StrictMode";case J:return"Suspense";case k:return"SuspenseList"}if("object"===typeof g)switch(g.$$typeof){case R:return(g.displayName||"Context")+".Consumer";case V:return(g._context.displayName||"Context")+".Provider";case X:var e=g.render;return(g=g.displayName)||(g=""!==(g=e.displayName||e.name||"")?"ForwardRef("+g+")":"ForwardRef"),g;case f:return null!==(e=g.displayName||null)?e:E(g.type)||"Memo";case v:e=g._payload,g=g._init;try{return E(g(e))}catch(t){}}return null}function Q(g){var e=g.type;switch(g.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return g=(g=e.render).displayName||g.name||"",e.displayName||(""!==g?"ForwardRef("+g+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return E(e);case 8:return e===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e}return null}function U(g){switch(typeof g){case"boolean":case"number":case"string":case"undefined":case"object":return g;default:return""}}function L(g){var e=g.type;return(g=g.nodeName)&&"input"===g.toLowerCase()&&("checkbox"===e||"radio"===e)}function j(g){g._valueTracker||(g._valueTracker=function(g){var e=L(g)?"checked":"value",t=Object.getOwnPropertyDescriptor(g.constructor.prototype,e),I=""+g[e];if(!g.hasOwnProperty(e)&&"undefined"!==typeof t&&"function"===typeof t.get&&"function"===typeof t.set){var l=t.get,C=t.set;return Object.defineProperty(g,e,{configurable:!0,get:function(){return l.call(this)},set:function(g){I=""+g,C.call(this,g)}}),Object.defineProperty(g,e,{enumerable:t.enumerable}),{getValue:function(){return I},setValue:function(g){I=""+g},stopTracking:function(){g._valueTracker=null,delete g[e]}}}}(g))}function D(g){if(!g)return!1;var e=g._valueTracker;if(!e)return!0;var t=e.getValue(),I="";return g&&(I=L(g)?g.checked?"true":"false":g.value),(g=I)!==t&&(e.setValue(g),!0)}function T(g){if("undefined"===typeof(g=g||("undefined"!==typeof document?document:void 0)))return null;try{return g.activeElement||g.body}catch(e){return g.body}}function P(g,e){var t=e.checked;return w({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=t?t:g._wrapperState.initialChecked})}function O(g,e){var t=null==e.defaultValue?"":e.defaultValue,I=null!=e.checked?e.checked:e.defaultChecked;t=U(null!=e.value?e.value:t),g._wrapperState={initialChecked:I,initialValue:t,controlled:"checkbox"===e.type||"radio"===e.type?null!=e.checked:null!=e.value}}function _(g,e){null!=(e=e.checked)&&Z(g,"checked",e,!1)}function q(g,e){_(g,e);var t=U(e.value),I=e.type;if(null!=t)"number"===I?(0===t&&""===g.value||g.value!=t)&&(g.value=""+t):g.value!==""+t&&(g.value=""+t);else if("submit"===I||"reset"===I)return void g.removeAttribute("value");e.hasOwnProperty("value")?gg(g,e.type,t):e.hasOwnProperty("defaultValue")&&gg(g,e.type,U(e.defaultValue)),null==e.checked&&null!=e.defaultChecked&&(g.defaultChecked=!!e.defaultChecked)}function $(g,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var I=e.type;if(!("submit"!==I&&"reset"!==I||void 0!==e.value&&null!==e.value))return;e=""+g._wrapperState.initialValue,t||e===g.value||(g.value=e),g.defaultValue=e}""!==(t=g.name)&&(g.name=""),g.defaultChecked=!!g._wrapperState.initialChecked,""!==t&&(g.name=t)}function gg(g,e,t){"number"===e&&T(g.ownerDocument)===g||(null==t?g.defaultValue=""+g._wrapperState.initialValue:g.defaultValue!==""+t&&(g.defaultValue=""+t))}var eg=Array.isArray;function tg(g,e,t,I){if(g=g.options,e){e={};for(var l=0;l<t.length;l++)e["$"+t[l]]=!0;for(t=0;t<g.length;t++)l=e.hasOwnProperty("$"+g[t].value),g[t].selected!==l&&(g[t].selected=l),l&&I&&(g[t].defaultSelected=!0)}else{for(t=""+U(t),e=null,l=0;l<g.length;l++){if(g[l].value===t)return g[l].selected=!0,void(I&&(g[l].defaultSelected=!0));null!==e||g[l].disabled||(e=g[l])}null!==e&&(e.selected=!0)}}function Ig(g,e){if(null!=e.dangerouslySetInnerHTML)throw Error(C(91));return w({},e,{value:void 0,defaultValue:void 0,children:""+g._wrapperState.initialValue})}function lg(g,e){var t=e.value;if(null==t){if(t=e.children,e=e.defaultValue,null!=t){if(null!=e)throw Error(C(92));if(eg(t)){if(1<t.length)throw Error(C(93));t=t[0]}e=t}null==e&&(e=""),t=e}g._wrapperState={initialValue:U(t)}}function Cg(g,e){var t=U(e.value),I=U(e.defaultValue);null!=t&&((t=""+t)!==g.value&&(g.value=t),null==e.defaultValue&&g.defaultValue!==t&&(g.defaultValue=t)),null!=I&&(g.defaultValue=""+I)}function ng(g){var e=g.textContent;e===g._wrapperState.initialValue&&""!==e&&null!==e&&(g.value=e)}function og(g){switch(g){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ag(g,e){return null==g||"http://www.w3.org/1999/xhtml"===g?og(e):"http://www.w3.org/2000/svg"===g&&"foreignObject"===e?"http://www.w3.org/1999/xhtml":g}var ig,sg,cg=(sg=function(g,e){if("http://www.w3.org/2000/svg"!==g.namespaceURI||"innerHTML"in g)g.innerHTML=e;else{for((ig=ig||document.createElement("div")).innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ig.firstChild;g.firstChild;)g.removeChild(g.firstChild);for(;e.firstChild;)g.appendChild(e.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(g,e,t,I){MSApp.execUnsafeLocalFunction((function(){return sg(g,e)}))}:sg);function dg(g,e){if(e){var t=g.firstChild;if(t&&t===g.lastChild&&3===t.nodeType)return void(t.nodeValue=e)}g.textContent=e}var Ag={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},rg=["Webkit","ms","Moz","O"];function ug(g,e,t){return null==e||"boolean"===typeof e||""===e?"":t||"number"!==typeof e||0===e||Ag.hasOwnProperty(g)&&Ag[g]?(""+e).trim():e+"px"}function mg(g,e){for(var t in g=g.style,e)if(e.hasOwnProperty(t)){var I=0===t.indexOf("--"),l=ug(t,e[t],I);"float"===t&&(t="cssFloat"),I?g.setProperty(t,l):g[t]=l}}Object.keys(Ag).forEach((function(g){rg.forEach((function(e){e=e+g.charAt(0).toUpperCase()+g.substring(1),Ag[e]=Ag[g]}))}));var bg=w({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function hg(g,e){if(e){if(bg[g]&&(null!=e.children||null!=e.dangerouslySetInnerHTML))throw Error(C(137,g));if(null!=e.dangerouslySetInnerHTML){if(null!=e.children)throw Error(C(60));if("object"!==typeof e.dangerouslySetInnerHTML||!("__html"in e.dangerouslySetInnerHTML))throw Error(C(61))}if(null!=e.style&&"object"!==typeof e.style)throw Error(C(62))}}function Zg(g,e){if(-1===g.indexOf("-"))return"string"===typeof e.is;switch(g){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Gg=null;function pg(g){return(g=g.target||g.srcElement||window).correspondingUseElement&&(g=g.correspondingUseElement),3===g.nodeType?g.parentNode:g}var yg=null,Bg=null,Sg=null;function Wg(g){if(g=hl(g)){if("function"!==typeof yg)throw Error(C(280));var e=g.stateNode;e&&(e=Gl(e),yg(g.stateNode,g.type,e))}}function Vg(g){Bg?Sg?Sg.push(g):Sg=[g]:Bg=g}function Rg(){if(Bg){var g=Bg,e=Sg;if(Sg=Bg=null,Wg(g),e)for(g=0;g<e.length;g++)Wg(e[g])}}function Xg(g,e){return g(e)}function Jg(){}var kg=!1;function fg(g,e,t){if(kg)return g(e,t);kg=!0;try{return Xg(g,e,t)}finally{kg=!1,(null!==Bg||null!==Sg)&&(Jg(),Rg())}}function vg(g,e){var t=g.stateNode;if(null===t)return null;var I=Gl(t);if(null===I)return null;t=I[e];g:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(I=!I.disabled)||(I=!("button"===(g=g.type)||"input"===g||"select"===g||"textarea"===g)),g=!I;break g;default:g=!1}if(g)return null;if(t&&"function"!==typeof t)throw Error(C(231,e,typeof t));return t}var Yg=!1;if(s)try{var xg={};Object.defineProperty(xg,"passive",{get:function(){Yg=!0}}),window.addEventListener("test",xg,xg),window.removeEventListener("test",xg,xg)}catch(sg){Yg=!1}function Hg(g,e,t,I,l,C,n,o,a){var i=Array.prototype.slice.call(arguments,3);try{e.apply(t,i)}catch(s){this.onError(s)}}var Ng=!1,wg=null,Fg=!1,Kg=null,zg={onError:function(g){Ng=!0,wg=g}};function Mg(g,e,t,I,l,C,n,o,a){Ng=!1,wg=null,Hg.apply(zg,arguments)}function Eg(g){var e=g,t=g;if(g.alternate)for(;e.return;)e=e.return;else{g=e;do{0!==(4098&(e=g).flags)&&(t=e.return),g=e.return}while(g)}return 3===e.tag?t:null}function Qg(g){if(13===g.tag){var e=g.memoizedState;if(null===e&&(null!==(g=g.alternate)&&(e=g.memoizedState)),null!==e)return e.dehydrated}return null}function Ug(g){if(Eg(g)!==g)throw Error(C(188))}function Lg(g){return null!==(g=function(g){var e=g.alternate;if(!e){if(null===(e=Eg(g)))throw Error(C(188));return e!==g?null:g}for(var t=g,I=e;;){var l=t.return;if(null===l)break;var n=l.alternate;if(null===n){if(null!==(I=l.return)){t=I;continue}break}if(l.child===n.child){for(n=l.child;n;){if(n===t)return Ug(l),g;if(n===I)return Ug(l),e;n=n.sibling}throw Error(C(188))}if(t.return!==I.return)t=l,I=n;else{for(var o=!1,a=l.child;a;){if(a===t){o=!0,t=l,I=n;break}if(a===I){o=!0,I=l,t=n;break}a=a.sibling}if(!o){for(a=n.child;a;){if(a===t){o=!0,t=n,I=l;break}if(a===I){o=!0,I=n,t=l;break}a=a.sibling}if(!o)throw Error(C(189))}}if(t.alternate!==I)throw Error(C(190))}if(3!==t.tag)throw Error(C(188));return t.stateNode.current===t?g:e}(g))?jg(g):null}function jg(g){if(5===g.tag||6===g.tag)return g;for(g=g.child;null!==g;){var e=jg(g);if(null!==e)return e;g=g.sibling}return null}var Dg=l.unstable_scheduleCallback,Tg=l.unstable_cancelCallback,Pg=l.unstable_shouldYield,Og=l.unstable_requestPaint,_g=l.unstable_now,qg=l.unstable_getCurrentPriorityLevel,$g=l.unstable_ImmediatePriority,ge=l.unstable_UserBlockingPriority,ee=l.unstable_NormalPriority,te=l.unstable_LowPriority,Ie=l.unstable_IdlePriority,le=null,Ce=null;var ne=Math.clz32?Math.clz32:function(g){return g>>>=0,0===g?32:31-(oe(g)/ae|0)|0},oe=Math.log,ae=Math.LN2;var ie=64,se=4194304;function ce(g){switch(g&-g){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&g;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&g;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return g}}function de(g,e){var t=g.pendingLanes;if(0===t)return 0;var I=0,l=g.suspendedLanes,C=g.pingedLanes,n=268435455&t;if(0!==n){var o=n&~l;0!==o?I=ce(o):0!==(C&=n)&&(I=ce(C))}else 0!==(n=t&~l)?I=ce(n):0!==C&&(I=ce(C));if(0===I)return 0;if(0!==e&&e!==I&&0===(e&l)&&((l=I&-I)>=(C=e&-e)||16===l&&0!==(4194240&C)))return e;if(0!==(4&I)&&(I|=16&t),0!==(e=g.entangledLanes))for(g=g.entanglements,e&=I;0<e;)l=1<<(t=31-ne(e)),I|=g[t],e&=~l;return I}function Ae(g,e){switch(g){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;default:return-1}}function re(g){return 0!==(g=-1073741825&g.pendingLanes)?g:1073741824&g?1073741824:0}function ue(){var g=ie;return 0===(4194240&(ie<<=1))&&(ie=64),g}function me(g){for(var e=[],t=0;31>t;t++)e.push(g);return e}function be(g,e,t){g.pendingLanes|=e,536870912!==e&&(g.suspendedLanes=0,g.pingedLanes=0),(g=g.eventTimes)[e=31-ne(e)]=t}function he(g,e){var t=g.entangledLanes|=e;for(g=g.entanglements;t;){var I=31-ne(t),l=1<<I;l&e|g[I]&e&&(g[I]|=e),t&=~l}}var Ze=0;function Ge(g){return 1<(g&=-g)?4<g?0!==(268435455&g)?16:536870912:4:1}var pe,ye,Be,Se,We,Ve=!1,Re=[],Xe=null,Je=null,ke=null,fe=new Map,ve=new Map,Ye=[],xe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function He(g,e){switch(g){case"focusin":case"focusout":Xe=null;break;case"dragenter":case"dragleave":Je=null;break;case"mouseover":case"mouseout":ke=null;break;case"pointerover":case"pointerout":fe.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ve.delete(e.pointerId)}}function Ne(g,e,t,I,l,C){return null===g||g.nativeEvent!==C?(g={blockedOn:e,domEventName:t,eventSystemFlags:I,nativeEvent:C,targetContainers:[l]},null!==e&&(null!==(e=hl(e))&&ye(e)),g):(g.eventSystemFlags|=I,e=g.targetContainers,null!==l&&-1===e.indexOf(l)&&e.push(l),g)}function we(g){var e=bl(g.target);if(null!==e){var t=Eg(e);if(null!==t)if(13===(e=t.tag)){if(null!==(e=Qg(t)))return g.blockedOn=e,void We(g.priority,(function(){Be(t)}))}else if(3===e&&t.stateNode.current.memoizedState.isDehydrated)return void(g.blockedOn=3===t.tag?t.stateNode.containerInfo:null)}g.blockedOn=null}function Fe(g){if(null!==g.blockedOn)return!1;for(var e=g.targetContainers;0<e.length;){var t=Pe(g.domEventName,g.eventSystemFlags,e[0],g.nativeEvent);if(null!==t)return null!==(e=hl(t))&&ye(e),g.blockedOn=t,!1;var I=new(t=g.nativeEvent).constructor(t.type,t);Gg=I,t.target.dispatchEvent(I),Gg=null,e.shift()}return!0}function Ke(g,e,t){Fe(g)&&t.delete(e)}function ze(){Ve=!1,null!==Xe&&Fe(Xe)&&(Xe=null),null!==Je&&Fe(Je)&&(Je=null),null!==ke&&Fe(ke)&&(ke=null),fe.forEach(Ke),ve.forEach(Ke)}function Me(g,e){g.blockedOn===e&&(g.blockedOn=null,Ve||(Ve=!0,l.unstable_scheduleCallback(l.unstable_NormalPriority,ze)))}function Ee(g){function e(e){return Me(e,g)}if(0<Re.length){Me(Re[0],g);for(var t=1;t<Re.length;t++){var I=Re[t];I.blockedOn===g&&(I.blockedOn=null)}}for(null!==Xe&&Me(Xe,g),null!==Je&&Me(Je,g),null!==ke&&Me(ke,g),fe.forEach(e),ve.forEach(e),t=0;t<Ye.length;t++)(I=Ye[t]).blockedOn===g&&(I.blockedOn=null);for(;0<Ye.length&&null===(t=Ye[0]).blockedOn;)we(t),null===t.blockedOn&&Ye.shift()}var Qe=G.ReactCurrentBatchConfig,Ue=!0;function Le(g,e,t,I){var l=Ze,C=Qe.transition;Qe.transition=null;try{Ze=1,De(g,e,t,I)}finally{Ze=l,Qe.transition=C}}function je(g,e,t,I){var l=Ze,C=Qe.transition;Qe.transition=null;try{Ze=4,De(g,e,t,I)}finally{Ze=l,Qe.transition=C}}function De(g,e,t,I){if(Ue){var l=Pe(g,e,t,I);if(null===l)QI(g,e,I,Te,t),He(g,I);else if(function(g,e,t,I,l){switch(e){case"focusin":return Xe=Ne(Xe,g,e,t,I,l),!0;case"dragenter":return Je=Ne(Je,g,e,t,I,l),!0;case"mouseover":return ke=Ne(ke,g,e,t,I,l),!0;case"pointerover":var C=l.pointerId;return fe.set(C,Ne(fe.get(C)||null,g,e,t,I,l)),!0;case"gotpointercapture":return C=l.pointerId,ve.set(C,Ne(ve.get(C)||null,g,e,t,I,l)),!0}return!1}(l,g,e,t,I))I.stopPropagation();else if(He(g,I),4&e&&-1<xe.indexOf(g)){for(;null!==l;){var C=hl(l);if(null!==C&&pe(C),null===(C=Pe(g,e,t,I))&&QI(g,e,I,Te,t),C===l)break;l=C}null!==l&&I.stopPropagation()}else QI(g,e,I,null,t)}}var Te=null;function Pe(g,e,t,I){if(Te=null,null!==(g=bl(g=pg(I))))if(null===(e=Eg(g)))g=null;else if(13===(t=e.tag)){if(null!==(g=Qg(e)))return g;g=null}else if(3===t){if(e.stateNode.current.memoizedState.isDehydrated)return 3===e.tag?e.stateNode.containerInfo:null;g=null}else e!==g&&(g=null);return Te=g,null}function Oe(g){switch(g){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(qg()){case $g:return 1;case ge:return 4;case ee:case te:return 16;case Ie:return 536870912;default:return 16}default:return 16}}var _e=null,qe=null,$e=null;function gt(){if($e)return $e;var g,e,t=qe,I=t.length,l="value"in _e?_e.value:_e.textContent,C=l.length;for(g=0;g<I&&t[g]===l[g];g++);var n=I-g;for(e=1;e<=n&&t[I-e]===l[C-e];e++);return $e=l.slice(g,1<e?1-e:void 0)}function et(g){var e=g.keyCode;return"charCode"in g?0===(g=g.charCode)&&13===e&&(g=13):g=e,10===g&&(g=13),32<=g||13===g?g:0}function tt(){return!0}function It(){return!1}function lt(g){function e(e,t,I,l,C){for(var n in this._reactName=e,this._targetInst=I,this.type=t,this.nativeEvent=l,this.target=C,this.currentTarget=null,g)g.hasOwnProperty(n)&&(e=g[n],this[n]=e?e(l):l[n]);return this.isDefaultPrevented=(null!=l.defaultPrevented?l.defaultPrevented:!1===l.returnValue)?tt:It,this.isPropagationStopped=It,this}return w(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var g=this.nativeEvent;g&&(g.preventDefault?g.preventDefault():"unknown"!==typeof g.returnValue&&(g.returnValue=!1),this.isDefaultPrevented=tt)},stopPropagation:function(){var g=this.nativeEvent;g&&(g.stopPropagation?g.stopPropagation():"unknown"!==typeof g.cancelBubble&&(g.cancelBubble=!0),this.isPropagationStopped=tt)},persist:function(){},isPersistent:tt}),e}var Ct,nt,ot,at={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(g){return g.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},it=lt(at),st=w({},at,{view:0,detail:0}),ct=lt(st),dt=w({},st,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:St,button:0,buttons:0,relatedTarget:function(g){return void 0===g.relatedTarget?g.fromElement===g.srcElement?g.toElement:g.fromElement:g.relatedTarget},movementX:function(g){return"movementX"in g?g.movementX:(g!==ot&&(ot&&"mousemove"===g.type?(Ct=g.screenX-ot.screenX,nt=g.screenY-ot.screenY):nt=Ct=0,ot=g),Ct)},movementY:function(g){return"movementY"in g?g.movementY:nt}}),At=lt(dt),rt=lt(w({},dt,{dataTransfer:0})),ut=lt(w({},st,{relatedTarget:0})),mt=lt(w({},at,{animationName:0,elapsedTime:0,pseudoElement:0})),bt=w({},at,{clipboardData:function(g){return"clipboardData"in g?g.clipboardData:window.clipboardData}}),ht=lt(bt),Zt=lt(w({},at,{data:0})),Gt={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},pt={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},yt={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Bt(g){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(g):!!(g=yt[g])&&!!e[g]}function St(){return Bt}var Wt=w({},st,{key:function(g){if(g.key){var e=Gt[g.key]||g.key;if("Unidentified"!==e)return e}return"keypress"===g.type?13===(g=et(g))?"Enter":String.fromCharCode(g):"keydown"===g.type||"keyup"===g.type?pt[g.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:St,charCode:function(g){return"keypress"===g.type?et(g):0},keyCode:function(g){return"keydown"===g.type||"keyup"===g.type?g.keyCode:0},which:function(g){return"keypress"===g.type?et(g):"keydown"===g.type||"keyup"===g.type?g.keyCode:0}}),Vt=lt(Wt),Rt=lt(w({},dt,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Xt=lt(w({},st,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:St})),Jt=lt(w({},at,{propertyName:0,elapsedTime:0,pseudoElement:0})),kt=w({},dt,{deltaX:function(g){return"deltaX"in g?g.deltaX:"wheelDeltaX"in g?-g.wheelDeltaX:0},deltaY:function(g){return"deltaY"in g?g.deltaY:"wheelDeltaY"in g?-g.wheelDeltaY:"wheelDelta"in g?-g.wheelDelta:0},deltaZ:0,deltaMode:0}),ft=lt(kt),vt=[9,13,27,32],Yt=s&&"CompositionEvent"in window,xt=null;s&&"documentMode"in document&&(xt=document.documentMode);var Ht=s&&"TextEvent"in window&&!xt,Nt=s&&(!Yt||xt&&8<xt&&11>=xt),wt=String.fromCharCode(32),Ft=!1;function Kt(g,e){switch(g){case"keyup":return-1!==vt.indexOf(e.keyCode);case"keydown":return 229!==e.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zt(g){return"object"===typeof(g=g.detail)&&"data"in g?g.data:null}var Mt=!1;var Et={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Qt(g){var e=g&&g.nodeName&&g.nodeName.toLowerCase();return"input"===e?!!Et[g.type]:"textarea"===e}function Ut(g,e,t,I){Vg(I),0<(e=LI(e,"onChange")).length&&(t=new it("onChange","change",null,t,I),g.push({event:t,listeners:e}))}var Lt=null,jt=null;function Dt(g){wI(g,0)}function Tt(g){if(D(Zl(g)))return g}function Pt(g,e){if("change"===g)return e}var Ot=!1;if(s){var _t;if(s){var qt="oninput"in document;if(!qt){var $t=document.createElement("div");$t.setAttribute("oninput","return;"),qt="function"===typeof $t.oninput}_t=qt}else _t=!1;Ot=_t&&(!document.documentMode||9<document.documentMode)}function gI(){Lt&&(Lt.detachEvent("onpropertychange",eI),jt=Lt=null)}function eI(g){if("value"===g.propertyName&&Tt(jt)){var e=[];Ut(e,jt,g,pg(g)),fg(Dt,e)}}function tI(g,e,t){"focusin"===g?(gI(),jt=t,(Lt=e).attachEvent("onpropertychange",eI)):"focusout"===g&&gI()}function II(g){if("selectionchange"===g||"keyup"===g||"keydown"===g)return Tt(jt)}function lI(g,e){if("click"===g)return Tt(e)}function CI(g,e){if("input"===g||"change"===g)return Tt(e)}var nI="function"===typeof Object.is?Object.is:function(g,e){return g===e&&(0!==g||1/g===1/e)||g!==g&&e!==e};function oI(g,e){if(nI(g,e))return!0;if("object"!==typeof g||null===g||"object"!==typeof e||null===e)return!1;var t=Object.keys(g),I=Object.keys(e);if(t.length!==I.length)return!1;for(I=0;I<t.length;I++){var l=t[I];if(!c.call(e,l)||!nI(g[l],e[l]))return!1}return!0}function aI(g){for(;g&&g.firstChild;)g=g.firstChild;return g}function iI(g,e){var t,I=aI(g);for(g=0;I;){if(3===I.nodeType){if(t=g+I.textContent.length,g<=e&&t>=e)return{node:I,offset:e-g};g=t}g:{for(;I;){if(I.nextSibling){I=I.nextSibling;break g}I=I.parentNode}I=void 0}I=aI(I)}}function sI(g,e){return!(!g||!e)&&(g===e||(!g||3!==g.nodeType)&&(e&&3===e.nodeType?sI(g,e.parentNode):"contains"in g?g.contains(e):!!g.compareDocumentPosition&&!!(16&g.compareDocumentPosition(e))))}function cI(){for(var g=window,e=T();e instanceof g.HTMLIFrameElement;){try{var t="string"===typeof e.contentWindow.location.href}catch(I){t=!1}if(!t)break;e=T((g=e.contentWindow).document)}return e}function dI(g){var e=g&&g.nodeName&&g.nodeName.toLowerCase();return e&&("input"===e&&("text"===g.type||"search"===g.type||"tel"===g.type||"url"===g.type||"password"===g.type)||"textarea"===e||"true"===g.contentEditable)}function AI(g){var e=cI(),t=g.focusedElem,I=g.selectionRange;if(e!==t&&t&&t.ownerDocument&&sI(t.ownerDocument.documentElement,t)){if(null!==I&&dI(t))if(e=I.start,void 0===(g=I.end)&&(g=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(g,t.value.length);else if((g=(e=t.ownerDocument||document)&&e.defaultView||window).getSelection){g=g.getSelection();var l=t.textContent.length,C=Math.min(I.start,l);I=void 0===I.end?C:Math.min(I.end,l),!g.extend&&C>I&&(l=I,I=C,C=l),l=iI(t,C);var n=iI(t,I);l&&n&&(1!==g.rangeCount||g.anchorNode!==l.node||g.anchorOffset!==l.offset||g.focusNode!==n.node||g.focusOffset!==n.offset)&&((e=e.createRange()).setStart(l.node,l.offset),g.removeAllRanges(),C>I?(g.addRange(e),g.extend(n.node,n.offset)):(e.setEnd(n.node,n.offset),g.addRange(e)))}for(e=[],g=t;g=g.parentNode;)1===g.nodeType&&e.push({element:g,left:g.scrollLeft,top:g.scrollTop});for("function"===typeof t.focus&&t.focus(),t=0;t<e.length;t++)(g=e[t]).element.scrollLeft=g.left,g.element.scrollTop=g.top}}var rI=s&&"documentMode"in document&&11>=document.documentMode,uI=null,mI=null,bI=null,hI=!1;function ZI(g,e,t){var I=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;hI||null==uI||uI!==T(I)||("selectionStart"in(I=uI)&&dI(I)?I={start:I.selectionStart,end:I.selectionEnd}:I={anchorNode:(I=(I.ownerDocument&&I.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:I.anchorOffset,focusNode:I.focusNode,focusOffset:I.focusOffset},bI&&oI(bI,I)||(bI=I,0<(I=LI(mI,"onSelect")).length&&(e=new it("onSelect","select",null,e,t),g.push({event:e,listeners:I}),e.target=uI)))}function GI(g,e){var t={};return t[g.toLowerCase()]=e.toLowerCase(),t["Webkit"+g]="webkit"+e,t["Moz"+g]="moz"+e,t}var pI={animationend:GI("Animation","AnimationEnd"),animationiteration:GI("Animation","AnimationIteration"),animationstart:GI("Animation","AnimationStart"),transitionend:GI("Transition","TransitionEnd")},yI={},BI={};function SI(g){if(yI[g])return yI[g];if(!pI[g])return g;var e,t=pI[g];for(e in t)if(t.hasOwnProperty(e)&&e in BI)return yI[g]=t[e];return g}s&&(BI=document.createElement("div").style,"AnimationEvent"in window||(delete pI.animationend.animation,delete pI.animationiteration.animation,delete pI.animationstart.animation),"TransitionEvent"in window||delete pI.transitionend.transition);var WI=SI("animationend"),VI=SI("animationiteration"),RI=SI("animationstart"),XI=SI("transitionend"),JI=new Map,kI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function fI(g,e){JI.set(g,e),a(e,[g])}for(var vI=0;vI<kI.length;vI++){var YI=kI[vI];fI(YI.toLowerCase(),"on"+(YI[0].toUpperCase()+YI.slice(1)))}fI(WI,"onAnimationEnd"),fI(VI,"onAnimationIteration"),fI(RI,"onAnimationStart"),fI("dblclick","onDoubleClick"),fI("focusin","onFocus"),fI("focusout","onBlur"),fI(XI,"onTransitionEnd"),i("onMouseEnter",["mouseout","mouseover"]),i("onMouseLeave",["mouseout","mouseover"]),i("onPointerEnter",["pointerout","pointerover"]),i("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xI="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),HI=new Set("cancel close invalid load scroll toggle".split(" ").concat(xI));function NI(g,e,t){var I=g.type||"unknown-event";g.currentTarget=t,function(g,e,t,I,l,n,o,a,i){if(Mg.apply(this,arguments),Ng){if(!Ng)throw Error(C(198));var s=wg;Ng=!1,wg=null,Fg||(Fg=!0,Kg=s)}}(I,e,void 0,g),g.currentTarget=null}function wI(g,e){e=0!==(4&e);for(var t=0;t<g.length;t++){var I=g[t],l=I.event;I=I.listeners;g:{var C=void 0;if(e)for(var n=I.length-1;0<=n;n--){var o=I[n],a=o.instance,i=o.currentTarget;if(o=o.listener,a!==C&&l.isPropagationStopped())break g;NI(l,o,i),C=a}else for(n=0;n<I.length;n++){if(a=(o=I[n]).instance,i=o.currentTarget,o=o.listener,a!==C&&l.isPropagationStopped())break g;NI(l,o,i),C=a}}}if(Fg)throw g=Kg,Fg=!1,Kg=null,g}function FI(g,e){var t=e[rl];void 0===t&&(t=e[rl]=new Set);var I=g+"__bubble";t.has(I)||(EI(e,g,2,!1),t.add(I))}function KI(g,e,t){var I=0;e&&(I|=4),EI(t,g,I,e)}var zI="_reactListening"+Math.random().toString(36).slice(2);function MI(g){if(!g[zI]){g[zI]=!0,n.forEach((function(e){"selectionchange"!==e&&(HI.has(e)||KI(e,!1,g),KI(e,!0,g))}));var e=9===g.nodeType?g:g.ownerDocument;null===e||e[zI]||(e[zI]=!0,KI("selectionchange",!1,e))}}function EI(g,e,t,I){switch(Oe(e)){case 1:var l=Le;break;case 4:l=je;break;default:l=De}t=l.bind(null,e,t,g),l=void 0,!Yg||"touchstart"!==e&&"touchmove"!==e&&"wheel"!==e||(l=!0),I?void 0!==l?g.addEventListener(e,t,{capture:!0,passive:l}):g.addEventListener(e,t,!0):void 0!==l?g.addEventListener(e,t,{passive:l}):g.addEventListener(e,t,!1)}function QI(g,e,t,I,l){var C=I;if(0===(1&e)&&0===(2&e)&&null!==I)g:for(;;){if(null===I)return;var n=I.tag;if(3===n||4===n){var o=I.stateNode.containerInfo;if(o===l||8===o.nodeType&&o.parentNode===l)break;if(4===n)for(n=I.return;null!==n;){var a=n.tag;if((3===a||4===a)&&((a=n.stateNode.containerInfo)===l||8===a.nodeType&&a.parentNode===l))return;n=n.return}for(;null!==o;){if(null===(n=bl(o)))return;if(5===(a=n.tag)||6===a){I=C=n;continue g}o=o.parentNode}}I=I.return}fg((function(){var I=C,l=pg(t),n=[];g:{var o=JI.get(g);if(void 0!==o){var a=it,i=g;switch(g){case"keypress":if(0===et(t))break g;case"keydown":case"keyup":a=Vt;break;case"focusin":i="focus",a=ut;break;case"focusout":i="blur",a=ut;break;case"beforeblur":case"afterblur":a=ut;break;case"click":if(2===t.button)break g;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":a=At;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":a=rt;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":a=Xt;break;case WI:case VI:case RI:a=mt;break;case XI:a=Jt;break;case"scroll":a=ct;break;case"wheel":a=ft;break;case"copy":case"cut":case"paste":a=ht;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":a=Rt}var s=0!==(4&e),c=!s&&"scroll"===g,d=s?null!==o?o+"Capture":null:o;s=[];for(var A,r=I;null!==r;){var u=(A=r).stateNode;if(5===A.tag&&null!==u&&(A=u,null!==d&&(null!=(u=vg(r,d))&&s.push(UI(r,u,A)))),c)break;r=r.return}0<s.length&&(o=new a(o,i,null,t,l),n.push({event:o,listeners:s}))}}if(0===(7&e)){if(a="mouseout"===g||"pointerout"===g,(!(o="mouseover"===g||"pointerover"===g)||t===Gg||!(i=t.relatedTarget||t.fromElement)||!bl(i)&&!i[Al])&&(a||o)&&(o=l.window===l?l:(o=l.ownerDocument)?o.defaultView||o.parentWindow:window,a?(a=I,null!==(i=(i=t.relatedTarget||t.toElement)?bl(i):null)&&(i!==(c=Eg(i))||5!==i.tag&&6!==i.tag)&&(i=null)):(a=null,i=I),a!==i)){if(s=At,u="onMouseLeave",d="onMouseEnter",r="mouse","pointerout"!==g&&"pointerover"!==g||(s=Rt,u="onPointerLeave",d="onPointerEnter",r="pointer"),c=null==a?o:Zl(a),A=null==i?o:Zl(i),(o=new s(u,r+"leave",a,t,l)).target=c,o.relatedTarget=A,u=null,bl(l)===I&&((s=new s(d,r+"enter",i,t,l)).target=A,s.relatedTarget=c,u=s),c=u,a&&i)g:{for(d=i,r=0,A=s=a;A;A=jI(A))r++;for(A=0,u=d;u;u=jI(u))A++;for(;0<r-A;)s=jI(s),r--;for(;0<A-r;)d=jI(d),A--;for(;r--;){if(s===d||null!==d&&s===d.alternate)break g;s=jI(s),d=jI(d)}s=null}else s=null;null!==a&&DI(n,o,a,s,!1),null!==i&&null!==c&&DI(n,c,i,s,!0)}if("select"===(a=(o=I?Zl(I):window).nodeName&&o.nodeName.toLowerCase())||"input"===a&&"file"===o.type)var m=Pt;else if(Qt(o))if(Ot)m=CI;else{m=II;var b=tI}else(a=o.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(m=lI);switch(m&&(m=m(g,I))?Ut(n,m,t,l):(b&&b(g,o,I),"focusout"===g&&(b=o._wrapperState)&&b.controlled&&"number"===o.type&&gg(o,"number",o.value)),b=I?Zl(I):window,g){case"focusin":(Qt(b)||"true"===b.contentEditable)&&(uI=b,mI=I,bI=null);break;case"focusout":bI=mI=uI=null;break;case"mousedown":hI=!0;break;case"contextmenu":case"mouseup":case"dragend":hI=!1,ZI(n,t,l);break;case"selectionchange":if(rI)break;case"keydown":case"keyup":ZI(n,t,l)}var h;if(Yt)g:{switch(g){case"compositionstart":var Z="onCompositionStart";break g;case"compositionend":Z="onCompositionEnd";break g;case"compositionupdate":Z="onCompositionUpdate";break g}Z=void 0}else Mt?Kt(g,t)&&(Z="onCompositionEnd"):"keydown"===g&&229===t.keyCode&&(Z="onCompositionStart");Z&&(Nt&&"ko"!==t.locale&&(Mt||"onCompositionStart"!==Z?"onCompositionEnd"===Z&&Mt&&(h=gt()):(qe="value"in(_e=l)?_e.value:_e.textContent,Mt=!0)),0<(b=LI(I,Z)).length&&(Z=new Zt(Z,g,null,t,l),n.push({event:Z,listeners:b}),h?Z.data=h:null!==(h=zt(t))&&(Z.data=h))),(h=Ht?function(g,e){switch(g){case"compositionend":return zt(e);case"keypress":return 32!==e.which?null:(Ft=!0,wt);case"textInput":return(g=e.data)===wt&&Ft?null:g;default:return null}}(g,t):function(g,e){if(Mt)return"compositionend"===g||!Yt&&Kt(g,e)?(g=gt(),$e=qe=_e=null,Mt=!1,g):null;switch(g){case"paste":default:return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Nt&&"ko"!==e.locale?null:e.data}}(g,t))&&(0<(I=LI(I,"onBeforeInput")).length&&(l=new Zt("onBeforeInput","beforeinput",null,t,l),n.push({event:l,listeners:I}),l.data=h))}wI(n,e)}))}function UI(g,e,t){return{instance:g,listener:e,currentTarget:t}}function LI(g,e){for(var t=e+"Capture",I=[];null!==g;){var l=g,C=l.stateNode;5===l.tag&&null!==C&&(l=C,null!=(C=vg(g,t))&&I.unshift(UI(g,C,l)),null!=(C=vg(g,e))&&I.push(UI(g,C,l))),g=g.return}return I}function jI(g){if(null===g)return null;do{g=g.return}while(g&&5!==g.tag);return g||null}function DI(g,e,t,I,l){for(var C=e._reactName,n=[];null!==t&&t!==I;){var o=t,a=o.alternate,i=o.stateNode;if(null!==a&&a===I)break;5===o.tag&&null!==i&&(o=i,l?null!=(a=vg(t,C))&&n.unshift(UI(t,a,o)):l||null!=(a=vg(t,C))&&n.push(UI(t,a,o))),t=t.return}0!==n.length&&g.push({event:e,listeners:n})}var TI=/\r\n?/g,PI=/\u0000|\uFFFD/g;function OI(g){return("string"===typeof g?g:""+g).replace(TI,"\n").replace(PI,"")}function _I(g,e,t){if(e=OI(e),OI(g)!==e&&t)throw Error(C(425))}function qI(){}var $I=null,gl=null;function el(g,e){return"textarea"===g||"noscript"===g||"string"===typeof e.children||"number"===typeof e.children||"object"===typeof e.dangerouslySetInnerHTML&&null!==e.dangerouslySetInnerHTML&&null!=e.dangerouslySetInnerHTML.__html}var tl="function"===typeof setTimeout?setTimeout:void 0,Il="function"===typeof clearTimeout?clearTimeout:void 0,ll="function"===typeof Promise?Promise:void 0,Cl="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ll?function(g){return ll.resolve(null).then(g).catch(nl)}:tl;function nl(g){setTimeout((function(){throw g}))}function ol(g,e){var t=e,I=0;do{var l=t.nextSibling;if(g.removeChild(t),l&&8===l.nodeType)if("/$"===(t=l.data)){if(0===I)return g.removeChild(l),void Ee(e);I--}else"$"!==t&&"$?"!==t&&"$!"!==t||I++;t=l}while(t);Ee(e)}function al(g){for(;null!=g;g=g.nextSibling){var e=g.nodeType;if(1===e||3===e)break;if(8===e){if("$"===(e=g.data)||"$!"===e||"$?"===e)break;if("/$"===e)return null}}return g}function il(g){g=g.previousSibling;for(var e=0;g;){if(8===g.nodeType){var t=g.data;if("$"===t||"$!"===t||"$?"===t){if(0===e)return g;e--}else"/$"===t&&e++}g=g.previousSibling}return null}var sl=Math.random().toString(36).slice(2),cl="__reactFiber$"+sl,dl="__reactProps$"+sl,Al="__reactContainer$"+sl,rl="__reactEvents$"+sl,ul="__reactListeners$"+sl,ml="__reactHandles$"+sl;function bl(g){var e=g[cl];if(e)return e;for(var t=g.parentNode;t;){if(e=t[Al]||t[cl]){if(t=e.alternate,null!==e.child||null!==t&&null!==t.child)for(g=il(g);null!==g;){if(t=g[cl])return t;g=il(g)}return e}t=(g=t).parentNode}return null}function hl(g){return!(g=g[cl]||g[Al])||5!==g.tag&&6!==g.tag&&13!==g.tag&&3!==g.tag?null:g}function Zl(g){if(5===g.tag||6===g.tag)return g.stateNode;throw Error(C(33))}function Gl(g){return g[dl]||null}var pl=[],yl=-1;function Bl(g){return{current:g}}function Sl(g){0>yl||(g.current=pl[yl],pl[yl]=null,yl--)}function Wl(g,e){yl++,pl[yl]=g.current,g.current=e}var Vl={},Rl=Bl(Vl),Xl=Bl(!1),Jl=Vl;function kl(g,e){var t=g.type.contextTypes;if(!t)return Vl;var I=g.stateNode;if(I&&I.__reactInternalMemoizedUnmaskedChildContext===e)return I.__reactInternalMemoizedMaskedChildContext;var l,C={};for(l in t)C[l]=e[l];return I&&((g=g.stateNode).__reactInternalMemoizedUnmaskedChildContext=e,g.__reactInternalMemoizedMaskedChildContext=C),C}function fl(g){return null!==(g=g.childContextTypes)&&void 0!==g}function vl(){Sl(Xl),Sl(Rl)}function Yl(g,e,t){if(Rl.current!==Vl)throw Error(C(168));Wl(Rl,e),Wl(Xl,t)}function xl(g,e,t){var I=g.stateNode;if(e=e.childContextTypes,"function"!==typeof I.getChildContext)return t;for(var l in I=I.getChildContext())if(!(l in e))throw Error(C(108,Q(g)||"Unknown",l));return w({},t,I)}function Hl(g){return g=(g=g.stateNode)&&g.__reactInternalMemoizedMergedChildContext||Vl,Jl=Rl.current,Wl(Rl,g),Wl(Xl,Xl.current),!0}function Nl(g,e,t){var I=g.stateNode;if(!I)throw Error(C(169));t?(g=xl(g,e,Jl),I.__reactInternalMemoizedMergedChildContext=g,Sl(Xl),Sl(Rl),Wl(Rl,g)):Sl(Xl),Wl(Xl,t)}var wl=null,Fl=!1,Kl=!1;function zl(g){null===wl?wl=[g]:wl.push(g)}function Ml(){if(!Kl&&null!==wl){Kl=!0;var g=0,e=Ze;try{var t=wl;for(Ze=1;g<t.length;g++){var I=t[g];do{I=I(!0)}while(null!==I)}wl=null,Fl=!1}catch(l){throw null!==wl&&(wl=wl.slice(g+1)),Dg($g,Ml),l}finally{Ze=e,Kl=!1}}return null}var El=[],Ql=0,Ul=null,Ll=0,jl=[],Dl=0,Tl=null,Pl=1,Ol="";function _l(g,e){El[Ql++]=Ll,El[Ql++]=Ul,Ul=g,Ll=e}function ql(g,e,t){jl[Dl++]=Pl,jl[Dl++]=Ol,jl[Dl++]=Tl,Tl=g;var I=Pl;g=Ol;var l=32-ne(I)-1;I&=~(1<<l),t+=1;var C=32-ne(e)+l;if(30<C){var n=l-l%5;C=(I&(1<<n)-1).toString(32),I>>=n,l-=n,Pl=1<<32-ne(e)+l|t<<l|I,Ol=C+g}else Pl=1<<C|t<<l|I,Ol=g}function $l(g){null!==g.return&&(_l(g,1),ql(g,1,0))}function gC(g){for(;g===Ul;)Ul=El[--Ql],El[Ql]=null,Ll=El[--Ql],El[Ql]=null;for(;g===Tl;)Tl=jl[--Dl],jl[Dl]=null,Ol=jl[--Dl],jl[Dl]=null,Pl=jl[--Dl],jl[Dl]=null}var eC=null,tC=null,IC=!1,lC=null;function CC(g,e){var t=vi(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=g,null===(e=g.deletions)?(g.deletions=[t],g.flags|=16):e.push(t)}function nC(g,e){switch(g.tag){case 5:var t=g.type;return null!==(e=1!==e.nodeType||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e)&&(g.stateNode=e,eC=g,tC=al(e.firstChild),!0);case 6:return null!==(e=""===g.pendingProps||3!==e.nodeType?null:e)&&(g.stateNode=e,eC=g,tC=null,!0);case 13:return null!==(e=8!==e.nodeType?null:e)&&(t=null!==Tl?{id:Pl,overflow:Ol}:null,g.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},(t=vi(18,null,null,0)).stateNode=e,t.return=g,g.child=t,eC=g,tC=null,!0);default:return!1}}function oC(g){return 0!==(1&g.mode)&&0===(128&g.flags)}function aC(g){if(IC){var e=tC;if(e){var t=e;if(!nC(g,e)){if(oC(g))throw Error(C(418));e=al(t.nextSibling);var I=eC;e&&nC(g,e)?CC(I,t):(g.flags=-4097&g.flags|2,IC=!1,eC=g)}}else{if(oC(g))throw Error(C(418));g.flags=-4097&g.flags|2,IC=!1,eC=g}}}function iC(g){for(g=g.return;null!==g&&5!==g.tag&&3!==g.tag&&13!==g.tag;)g=g.return;eC=g}function sC(g){if(g!==eC)return!1;if(!IC)return iC(g),IC=!0,!1;var e;if((e=3!==g.tag)&&!(e=5!==g.tag)&&(e="head"!==(e=g.type)&&"body"!==e&&!el(g.type,g.memoizedProps)),e&&(e=tC)){if(oC(g))throw cC(),Error(C(418));for(;e;)CC(g,e),e=al(e.nextSibling)}if(iC(g),13===g.tag){if(!(g=null!==(g=g.memoizedState)?g.dehydrated:null))throw Error(C(317));g:{for(g=g.nextSibling,e=0;g;){if(8===g.nodeType){var t=g.data;if("/$"===t){if(0===e){tC=al(g.nextSibling);break g}e--}else"$"!==t&&"$!"!==t&&"$?"!==t||e++}g=g.nextSibling}tC=null}}else tC=eC?al(g.stateNode.nextSibling):null;return!0}function cC(){for(var g=tC;g;)g=al(g.nextSibling)}function dC(){tC=eC=null,IC=!1}function AC(g){null===lC?lC=[g]:lC.push(g)}var rC=G.ReactCurrentBatchConfig;function uC(g,e){if(g&&g.defaultProps){for(var t in e=w({},e),g=g.defaultProps)void 0===e[t]&&(e[t]=g[t]);return e}return e}var mC=Bl(null),bC=null,hC=null,ZC=null;function GC(){ZC=hC=bC=null}function pC(g){var e=mC.current;Sl(mC),g._currentValue=e}function yC(g,e,t){for(;null!==g;){var I=g.alternate;if((g.childLanes&e)!==e?(g.childLanes|=e,null!==I&&(I.childLanes|=e)):null!==I&&(I.childLanes&e)!==e&&(I.childLanes|=e),g===t)break;g=g.return}}function BC(g,e){bC=g,ZC=hC=null,null!==(g=g.dependencies)&&null!==g.firstContext&&(0!==(g.lanes&e)&&(Go=!0),g.firstContext=null)}function SC(g){var e=g._currentValue;if(ZC!==g)if(g={context:g,memoizedValue:e,next:null},null===hC){if(null===bC)throw Error(C(308));hC=g,bC.dependencies={lanes:0,firstContext:g}}else hC=hC.next=g;return e}var WC=null;function VC(g){null===WC?WC=[g]:WC.push(g)}function RC(g,e,t,I){var l=e.interleaved;return null===l?(t.next=t,VC(e)):(t.next=l.next,l.next=t),e.interleaved=t,XC(g,I)}function XC(g,e){g.lanes|=e;var t=g.alternate;for(null!==t&&(t.lanes|=e),t=g,g=g.return;null!==g;)g.childLanes|=e,null!==(t=g.alternate)&&(t.childLanes|=e),t=g,g=g.return;return 3===t.tag?t.stateNode:null}var JC=!1;function kC(g){g.updateQueue={baseState:g.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function fC(g,e){g=g.updateQueue,e.updateQueue===g&&(e.updateQueue={baseState:g.baseState,firstBaseUpdate:g.firstBaseUpdate,lastBaseUpdate:g.lastBaseUpdate,shared:g.shared,effects:g.effects})}function vC(g,e){return{eventTime:g,lane:e,tag:0,payload:null,callback:null,next:null}}function YC(g,e,t){var I=g.updateQueue;if(null===I)return null;if(I=I.shared,0!==(2&Ja)){var l=I.pending;return null===l?e.next=e:(e.next=l.next,l.next=e),I.pending=e,XC(g,t)}return null===(l=I.interleaved)?(e.next=e,VC(I)):(e.next=l.next,l.next=e),I.interleaved=e,XC(g,t)}function xC(g,e,t){if(null!==(e=e.updateQueue)&&(e=e.shared,0!==(4194240&t))){var I=e.lanes;t|=I&=g.pendingLanes,e.lanes=t,he(g,t)}}function HC(g,e){var t=g.updateQueue,I=g.alternate;if(null!==I&&t===(I=I.updateQueue)){var l=null,C=null;if(null!==(t=t.firstBaseUpdate)){do{var n={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};null===C?l=C=n:C=C.next=n,t=t.next}while(null!==t);null===C?l=C=e:C=C.next=e}else l=C=e;return t={baseState:I.baseState,firstBaseUpdate:l,lastBaseUpdate:C,shared:I.shared,effects:I.effects},void(g.updateQueue=t)}null===(g=t.lastBaseUpdate)?t.firstBaseUpdate=e:g.next=e,t.lastBaseUpdate=e}function NC(g,e,t,I){var l=g.updateQueue;JC=!1;var C=l.firstBaseUpdate,n=l.lastBaseUpdate,o=l.shared.pending;if(null!==o){l.shared.pending=null;var a=o,i=a.next;a.next=null,null===n?C=i:n.next=i,n=a;var s=g.alternate;null!==s&&((o=(s=s.updateQueue).lastBaseUpdate)!==n&&(null===o?s.firstBaseUpdate=i:o.next=i,s.lastBaseUpdate=a))}if(null!==C){var c=l.baseState;for(n=0,s=i=a=null,o=C;;){var d=o.lane,A=o.eventTime;if((I&d)===d){null!==s&&(s=s.next={eventTime:A,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});g:{var r=g,u=o;switch(d=e,A=t,u.tag){case 1:if("function"===typeof(r=u.payload)){c=r.call(A,c,d);break g}c=r;break g;case 3:r.flags=-65537&r.flags|128;case 0:if(null===(d="function"===typeof(r=u.payload)?r.call(A,c,d):r)||void 0===d)break g;c=w({},c,d);break g;case 2:JC=!0}}null!==o.callback&&0!==o.lane&&(g.flags|=64,null===(d=l.effects)?l.effects=[o]:d.push(o))}else A={eventTime:A,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===s?(i=s=A,a=c):s=s.next=A,n|=d;if(null===(o=o.next)){if(null===(o=l.shared.pending))break;o=(d=o).next,d.next=null,l.lastBaseUpdate=d,l.shared.pending=null}}if(null===s&&(a=c),l.baseState=a,l.firstBaseUpdate=i,l.lastBaseUpdate=s,null!==(e=l.shared.interleaved)){l=e;do{n|=l.lane,l=l.next}while(l!==e)}else null===C&&(l.shared.lanes=0);wa|=n,g.lanes=n,g.memoizedState=c}}function wC(g,e,t){if(g=e.effects,e.effects=null,null!==g)for(e=0;e<g.length;e++){var I=g[e],l=I.callback;if(null!==l){if(I.callback=null,I=t,"function"!==typeof l)throw Error(C(191,l));l.call(I)}}}var FC=(new I.Component).refs;function KC(g,e,t,I){t=null===(t=t(I,e=g.memoizedState))||void 0===t?e:w({},e,t),g.memoizedState=t,0===g.lanes&&(g.updateQueue.baseState=t)}var zC={isMounted:function(g){return!!(g=g._reactInternals)&&Eg(g)===g},enqueueSetState:function(g,e,t){g=g._reactInternals;var I=ei(),l=ti(g),C=vC(I,l);C.payload=e,void 0!==t&&null!==t&&(C.callback=t),null!==(e=YC(g,C,l))&&(Ii(e,g,l,I),xC(e,g,l))},enqueueReplaceState:function(g,e,t){g=g._reactInternals;var I=ei(),l=ti(g),C=vC(I,l);C.tag=1,C.payload=e,void 0!==t&&null!==t&&(C.callback=t),null!==(e=YC(g,C,l))&&(Ii(e,g,l,I),xC(e,g,l))},enqueueForceUpdate:function(g,e){g=g._reactInternals;var t=ei(),I=ti(g),l=vC(t,I);l.tag=2,void 0!==e&&null!==e&&(l.callback=e),null!==(e=YC(g,l,I))&&(Ii(e,g,I,t),xC(e,g,I))}};function MC(g,e,t,I,l,C,n){return"function"===typeof(g=g.stateNode).shouldComponentUpdate?g.shouldComponentUpdate(I,C,n):!e.prototype||!e.prototype.isPureReactComponent||(!oI(t,I)||!oI(l,C))}function EC(g,e,t){var I=!1,l=Vl,C=e.contextType;return"object"===typeof C&&null!==C?C=SC(C):(l=fl(e)?Jl:Rl.current,C=(I=null!==(I=e.contextTypes)&&void 0!==I)?kl(g,l):Vl),e=new e(t,C),g.memoizedState=null!==e.state&&void 0!==e.state?e.state:null,e.updater=zC,g.stateNode=e,e._reactInternals=g,I&&((g=g.stateNode).__reactInternalMemoizedUnmaskedChildContext=l,g.__reactInternalMemoizedMaskedChildContext=C),e}function QC(g,e,t,I){g=e.state,"function"===typeof e.componentWillReceiveProps&&e.componentWillReceiveProps(t,I),"function"===typeof e.UNSAFE_componentWillReceiveProps&&e.UNSAFE_componentWillReceiveProps(t,I),e.state!==g&&zC.enqueueReplaceState(e,e.state,null)}function UC(g,e,t,I){var l=g.stateNode;l.props=t,l.state=g.memoizedState,l.refs=FC,kC(g);var C=e.contextType;"object"===typeof C&&null!==C?l.context=SC(C):(C=fl(e)?Jl:Rl.current,l.context=kl(g,C)),l.state=g.memoizedState,"function"===typeof(C=e.getDerivedStateFromProps)&&(KC(g,e,C,t),l.state=g.memoizedState),"function"===typeof e.getDerivedStateFromProps||"function"===typeof l.getSnapshotBeforeUpdate||"function"!==typeof l.UNSAFE_componentWillMount&&"function"!==typeof l.componentWillMount||(e=l.state,"function"===typeof l.componentWillMount&&l.componentWillMount(),"function"===typeof l.UNSAFE_componentWillMount&&l.UNSAFE_componentWillMount(),e!==l.state&&zC.enqueueReplaceState(l,l.state,null),NC(g,t,l,I),l.state=g.memoizedState),"function"===typeof l.componentDidMount&&(g.flags|=4194308)}function LC(g,e,t){if(null!==(g=t.ref)&&"function"!==typeof g&&"object"!==typeof g){if(t._owner){if(t=t._owner){if(1!==t.tag)throw Error(C(309));var I=t.stateNode}if(!I)throw Error(C(147,g));var l=I,n=""+g;return null!==e&&null!==e.ref&&"function"===typeof e.ref&&e.ref._stringRef===n?e.ref:(e=function(g){var e=l.refs;e===FC&&(e=l.refs={}),null===g?delete e[n]:e[n]=g},e._stringRef=n,e)}if("string"!==typeof g)throw Error(C(284));if(!t._owner)throw Error(C(290,g))}return g}function jC(g,e){throw g=Object.prototype.toString.call(e),Error(C(31,"[object Object]"===g?"object with keys {"+Object.keys(e).join(", ")+"}":g))}function DC(g){return(0,g._init)(g._payload)}function TC(g){function e(e,t){if(g){var I=e.deletions;null===I?(e.deletions=[t],e.flags|=16):I.push(t)}}function t(t,I){if(!g)return null;for(;null!==I;)e(t,I),I=I.sibling;return null}function I(g,e){for(g=new Map;null!==e;)null!==e.key?g.set(e.key,e):g.set(e.index,e),e=e.sibling;return g}function l(g,e){return(g=xi(g,e)).index=0,g.sibling=null,g}function n(e,t,I){return e.index=I,g?null!==(I=e.alternate)?(I=I.index)<t?(e.flags|=2,t):I:(e.flags|=2,t):(e.flags|=1048576,t)}function o(e){return g&&null===e.alternate&&(e.flags|=2),e}function a(g,e,t,I){return null===e||6!==e.tag?((e=Fi(t,g.mode,I)).return=g,e):((e=l(e,t)).return=g,e)}function i(g,e,t,I){var C=t.type;return C===B?c(g,e,t.props.children,I,t.key):null!==e&&(e.elementType===C||"object"===typeof C&&null!==C&&C.$$typeof===v&&DC(C)===e.type)?((I=l(e,t.props)).ref=LC(g,e,t),I.return=g,I):((I=Hi(t.type,t.key,t.props,null,g.mode,I)).ref=LC(g,e,t),I.return=g,I)}function s(g,e,t,I){return null===e||4!==e.tag||e.stateNode.containerInfo!==t.containerInfo||e.stateNode.implementation!==t.implementation?((e=Ki(t,g.mode,I)).return=g,e):((e=l(e,t.children||[])).return=g,e)}function c(g,e,t,I,C){return null===e||7!==e.tag?((e=Ni(t,g.mode,I,C)).return=g,e):((e=l(e,t)).return=g,e)}function d(g,e,t){if("string"===typeof e&&""!==e||"number"===typeof e)return(e=Fi(""+e,g.mode,t)).return=g,e;if("object"===typeof e&&null!==e){switch(e.$$typeof){case p:return(t=Hi(e.type,e.key,e.props,null,g.mode,t)).ref=LC(g,null,e),t.return=g,t;case y:return(e=Ki(e,g.mode,t)).return=g,e;case v:return d(g,(0,e._init)(e._payload),t)}if(eg(e)||H(e))return(e=Ni(e,g.mode,t,null)).return=g,e;jC(g,e)}return null}function A(g,e,t,I){var l=null!==e?e.key:null;if("string"===typeof t&&""!==t||"number"===typeof t)return null!==l?null:a(g,e,""+t,I);if("object"===typeof t&&null!==t){switch(t.$$typeof){case p:return t.key===l?i(g,e,t,I):null;case y:return t.key===l?s(g,e,t,I):null;case v:return A(g,e,(l=t._init)(t._payload),I)}if(eg(t)||H(t))return null!==l?null:c(g,e,t,I,null);jC(g,t)}return null}function r(g,e,t,I,l){if("string"===typeof I&&""!==I||"number"===typeof I)return a(e,g=g.get(t)||null,""+I,l);if("object"===typeof I&&null!==I){switch(I.$$typeof){case p:return i(e,g=g.get(null===I.key?t:I.key)||null,I,l);case y:return s(e,g=g.get(null===I.key?t:I.key)||null,I,l);case v:return r(g,e,t,(0,I._init)(I._payload),l)}if(eg(I)||H(I))return c(e,g=g.get(t)||null,I,l,null);jC(e,I)}return null}function u(l,C,o,a){for(var i=null,s=null,c=C,u=C=0,m=null;null!==c&&u<o.length;u++){c.index>u?(m=c,c=null):m=c.sibling;var b=A(l,c,o[u],a);if(null===b){null===c&&(c=m);break}g&&c&&null===b.alternate&&e(l,c),C=n(b,C,u),null===s?i=b:s.sibling=b,s=b,c=m}if(u===o.length)return t(l,c),IC&&_l(l,u),i;if(null===c){for(;u<o.length;u++)null!==(c=d(l,o[u],a))&&(C=n(c,C,u),null===s?i=c:s.sibling=c,s=c);return IC&&_l(l,u),i}for(c=I(l,c);u<o.length;u++)null!==(m=r(c,l,u,o[u],a))&&(g&&null!==m.alternate&&c.delete(null===m.key?u:m.key),C=n(m,C,u),null===s?i=m:s.sibling=m,s=m);return g&&c.forEach((function(g){return e(l,g)})),IC&&_l(l,u),i}function m(l,o,a,i){var s=H(a);if("function"!==typeof s)throw Error(C(150));if(null==(a=s.call(a)))throw Error(C(151));for(var c=s=null,u=o,m=o=0,b=null,h=a.next();null!==u&&!h.done;m++,h=a.next()){u.index>m?(b=u,u=null):b=u.sibling;var Z=A(l,u,h.value,i);if(null===Z){null===u&&(u=b);break}g&&u&&null===Z.alternate&&e(l,u),o=n(Z,o,m),null===c?s=Z:c.sibling=Z,c=Z,u=b}if(h.done)return t(l,u),IC&&_l(l,m),s;if(null===u){for(;!h.done;m++,h=a.next())null!==(h=d(l,h.value,i))&&(o=n(h,o,m),null===c?s=h:c.sibling=h,c=h);return IC&&_l(l,m),s}for(u=I(l,u);!h.done;m++,h=a.next())null!==(h=r(u,l,m,h.value,i))&&(g&&null!==h.alternate&&u.delete(null===h.key?m:h.key),o=n(h,o,m),null===c?s=h:c.sibling=h,c=h);return g&&u.forEach((function(g){return e(l,g)})),IC&&_l(l,m),s}return function g(I,C,n,a){if("object"===typeof n&&null!==n&&n.type===B&&null===n.key&&(n=n.props.children),"object"===typeof n&&null!==n){switch(n.$$typeof){case p:g:{for(var i=n.key,s=C;null!==s;){if(s.key===i){if((i=n.type)===B){if(7===s.tag){t(I,s.sibling),(C=l(s,n.props.children)).return=I,I=C;break g}}else if(s.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===v&&DC(i)===s.type){t(I,s.sibling),(C=l(s,n.props)).ref=LC(I,s,n),C.return=I,I=C;break g}t(I,s);break}e(I,s),s=s.sibling}n.type===B?((C=Ni(n.props.children,I.mode,a,n.key)).return=I,I=C):((a=Hi(n.type,n.key,n.props,null,I.mode,a)).ref=LC(I,C,n),a.return=I,I=a)}return o(I);case y:g:{for(s=n.key;null!==C;){if(C.key===s){if(4===C.tag&&C.stateNode.containerInfo===n.containerInfo&&C.stateNode.implementation===n.implementation){t(I,C.sibling),(C=l(C,n.children||[])).return=I,I=C;break g}t(I,C);break}e(I,C),C=C.sibling}(C=Ki(n,I.mode,a)).return=I,I=C}return o(I);case v:return g(I,C,(s=n._init)(n._payload),a)}if(eg(n))return u(I,C,n,a);if(H(n))return m(I,C,n,a);jC(I,n)}return"string"===typeof n&&""!==n||"number"===typeof n?(n=""+n,null!==C&&6===C.tag?(t(I,C.sibling),(C=l(C,n)).return=I,I=C):(t(I,C),(C=Fi(n,I.mode,a)).return=I,I=C),o(I)):t(I,C)}}var PC=TC(!0),OC=TC(!1),_C={},qC=Bl(_C),$C=Bl(_C),gn=Bl(_C);function en(g){if(g===_C)throw Error(C(174));return g}function tn(g,e){switch(Wl(gn,e),Wl($C,g),Wl(qC,_C),g=e.nodeType){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ag(null,"");break;default:e=ag(e=(g=8===g?e.parentNode:e).namespaceURI||null,g=g.tagName)}Sl(qC),Wl(qC,e)}function In(){Sl(qC),Sl($C),Sl(gn)}function ln(g){en(gn.current);var e=en(qC.current),t=ag(e,g.type);e!==t&&(Wl($C,g),Wl(qC,t))}function Cn(g){$C.current===g&&(Sl(qC),Sl($C))}var nn=Bl(0);function on(g){for(var e=g;null!==e;){if(13===e.tag){var t=e.memoizedState;if(null!==t&&(null===(t=t.dehydrated)||"$?"===t.data||"$!"===t.data))return e}else if(19===e.tag&&void 0!==e.memoizedProps.revealOrder){if(0!==(128&e.flags))return e}else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===g)break;for(;null===e.sibling;){if(null===e.return||e.return===g)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var an=[];function sn(){for(var g=0;g<an.length;g++)an[g]._workInProgressVersionPrimary=null;an.length=0}var cn=G.ReactCurrentDispatcher,dn=G.ReactCurrentBatchConfig,An=0,rn=null,un=null,mn=null,bn=!1,hn=!1,Zn=0,Gn=0;function pn(){throw Error(C(321))}function yn(g,e){if(null===e)return!1;for(var t=0;t<e.length&&t<g.length;t++)if(!nI(g[t],e[t]))return!1;return!0}function Bn(g,e,t,I,l,n){if(An=n,rn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,cn.current=null===g||null===g.memoizedState?no:oo,g=t(I,l),hn){n=0;do{if(hn=!1,Zn=0,25<=n)throw Error(C(301));n+=1,mn=un=null,e.updateQueue=null,cn.current=ao,g=t(I,l)}while(hn)}if(cn.current=Co,e=null!==un&&null!==un.next,An=0,mn=un=rn=null,bn=!1,e)throw Error(C(300));return g}function Sn(){var g=0!==Zn;return Zn=0,g}function Wn(){var g={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===mn?rn.memoizedState=mn=g:mn=mn.next=g,mn}function Vn(){if(null===un){var g=rn.alternate;g=null!==g?g.memoizedState:null}else g=un.next;var e=null===mn?rn.memoizedState:mn.next;if(null!==e)mn=e,un=g;else{if(null===g)throw Error(C(310));g={memoizedState:(un=g).memoizedState,baseState:un.baseState,baseQueue:un.baseQueue,queue:un.queue,next:null},null===mn?rn.memoizedState=mn=g:mn=mn.next=g}return mn}function Rn(g,e){return"function"===typeof e?e(g):e}function Xn(g){var e=Vn(),t=e.queue;if(null===t)throw Error(C(311));t.lastRenderedReducer=g;var I=un,l=I.baseQueue,n=t.pending;if(null!==n){if(null!==l){var o=l.next;l.next=n.next,n.next=o}I.baseQueue=l=n,t.pending=null}if(null!==l){n=l.next,I=I.baseState;var a=o=null,i=null,s=n;do{var c=s.lane;if((An&c)===c)null!==i&&(i=i.next={lane:0,action:s.action,hasEagerState:s.hasEagerState,eagerState:s.eagerState,next:null}),I=s.hasEagerState?s.eagerState:g(I,s.action);else{var d={lane:c,action:s.action,hasEagerState:s.hasEagerState,eagerState:s.eagerState,next:null};null===i?(a=i=d,o=I):i=i.next=d,rn.lanes|=c,wa|=c}s=s.next}while(null!==s&&s!==n);null===i?o=I:i.next=a,nI(I,e.memoizedState)||(Go=!0),e.memoizedState=I,e.baseState=o,e.baseQueue=i,t.lastRenderedState=I}if(null!==(g=t.interleaved)){l=g;do{n=l.lane,rn.lanes|=n,wa|=n,l=l.next}while(l!==g)}else null===l&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Jn(g){var e=Vn(),t=e.queue;if(null===t)throw Error(C(311));t.lastRenderedReducer=g;var I=t.dispatch,l=t.pending,n=e.memoizedState;if(null!==l){t.pending=null;var o=l=l.next;do{n=g(n,o.action),o=o.next}while(o!==l);nI(n,e.memoizedState)||(Go=!0),e.memoizedState=n,null===e.baseQueue&&(e.baseState=n),t.lastRenderedState=n}return[n,I]}function kn(){}function fn(g,e){var t=rn,I=Vn(),l=e(),n=!nI(I.memoizedState,l);if(n&&(I.memoizedState=l,Go=!0),I=I.queue,Qn(xn.bind(null,t,I,g),[g]),I.getSnapshot!==e||n||null!==mn&&1&mn.memoizedState.tag){if(t.flags|=2048,Fn(9,Yn.bind(null,t,I,l,e),void 0,null),null===ka)throw Error(C(349));0!==(30&An)||vn(t,e,l)}return l}function vn(g,e,t){g.flags|=16384,g={getSnapshot:e,value:t},null===(e=rn.updateQueue)?(e={lastEffect:null,stores:null},rn.updateQueue=e,e.stores=[g]):null===(t=e.stores)?e.stores=[g]:t.push(g)}function Yn(g,e,t,I){e.value=t,e.getSnapshot=I,Hn(e)&&Nn(g)}function xn(g,e,t){return t((function(){Hn(e)&&Nn(g)}))}function Hn(g){var e=g.getSnapshot;g=g.value;try{var t=e();return!nI(g,t)}catch(I){return!0}}function Nn(g){var e=XC(g,1);null!==e&&Ii(e,g,1,-1)}function wn(g){var e=Wn();return"function"===typeof g&&(g=g()),e.memoizedState=e.baseState=g,g={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Rn,lastRenderedState:g},e.queue=g,g=g.dispatch=eo.bind(null,rn,g),[e.memoizedState,g]}function Fn(g,e,t,I){return g={tag:g,create:e,destroy:t,deps:I,next:null},null===(e=rn.updateQueue)?(e={lastEffect:null,stores:null},rn.updateQueue=e,e.lastEffect=g.next=g):null===(t=e.lastEffect)?e.lastEffect=g.next=g:(I=t.next,t.next=g,g.next=I,e.lastEffect=g),g}function Kn(){return Vn().memoizedState}function zn(g,e,t,I){var l=Wn();rn.flags|=g,l.memoizedState=Fn(1|e,t,void 0,void 0===I?null:I)}function Mn(g,e,t,I){var l=Vn();I=void 0===I?null:I;var C=void 0;if(null!==un){var n=un.memoizedState;if(C=n.destroy,null!==I&&yn(I,n.deps))return void(l.memoizedState=Fn(e,t,C,I))}rn.flags|=g,l.memoizedState=Fn(1|e,t,C,I)}function En(g,e){return zn(8390656,8,g,e)}function Qn(g,e){return Mn(2048,8,g,e)}function Un(g,e){return Mn(4,2,g,e)}function Ln(g,e){return Mn(4,4,g,e)}function jn(g,e){return"function"===typeof e?(g=g(),e(g),function(){e(null)}):null!==e&&void 0!==e?(g=g(),e.current=g,function(){e.current=null}):void 0}function Dn(g,e,t){return t=null!==t&&void 0!==t?t.concat([g]):null,Mn(4,4,jn.bind(null,e,g),t)}function Tn(){}function Pn(g,e){var t=Vn();e=void 0===e?null:e;var I=t.memoizedState;return null!==I&&null!==e&&yn(e,I[1])?I[0]:(t.memoizedState=[g,e],g)}function On(g,e){var t=Vn();e=void 0===e?null:e;var I=t.memoizedState;return null!==I&&null!==e&&yn(e,I[1])?I[0]:(g=g(),t.memoizedState=[g,e],g)}function _n(g,e,t){return 0===(21&An)?(g.baseState&&(g.baseState=!1,Go=!0),g.memoizedState=t):(nI(t,e)||(t=ue(),rn.lanes|=t,wa|=t,g.baseState=!0),e)}function qn(g,e){var t=Ze;Ze=0!==t&&4>t?t:4,g(!0);var I=dn.transition;dn.transition={};try{g(!1),e()}finally{Ze=t,dn.transition=I}}function $n(){return Vn().memoizedState}function go(g,e,t){var I=ti(g);if(t={lane:I,action:t,hasEagerState:!1,eagerState:null,next:null},to(g))Io(e,t);else if(null!==(t=RC(g,e,t,I))){Ii(t,g,I,ei()),lo(t,e,I)}}function eo(g,e,t){var I=ti(g),l={lane:I,action:t,hasEagerState:!1,eagerState:null,next:null};if(to(g))Io(e,l);else{var C=g.alternate;if(0===g.lanes&&(null===C||0===C.lanes)&&null!==(C=e.lastRenderedReducer))try{var n=e.lastRenderedState,o=C(n,t);if(l.hasEagerState=!0,l.eagerState=o,nI(o,n)){var a=e.interleaved;return null===a?(l.next=l,VC(e)):(l.next=a.next,a.next=l),void(e.interleaved=l)}}catch(i){}null!==(t=RC(g,e,l,I))&&(Ii(t,g,I,l=ei()),lo(t,e,I))}}function to(g){var e=g.alternate;return g===rn||null!==e&&e===rn}function Io(g,e){hn=bn=!0;var t=g.pending;null===t?e.next=e:(e.next=t.next,t.next=e),g.pending=e}function lo(g,e,t){if(0!==(4194240&t)){var I=e.lanes;t|=I&=g.pendingLanes,e.lanes=t,he(g,t)}}var Co={readContext:SC,useCallback:pn,useContext:pn,useEffect:pn,useImperativeHandle:pn,useInsertionEffect:pn,useLayoutEffect:pn,useMemo:pn,useReducer:pn,useRef:pn,useState:pn,useDebugValue:pn,useDeferredValue:pn,useTransition:pn,useMutableSource:pn,useSyncExternalStore:pn,useId:pn,unstable_isNewReconciler:!1},no={readContext:SC,useCallback:function(g,e){return Wn().memoizedState=[g,void 0===e?null:e],g},useContext:SC,useEffect:En,useImperativeHandle:function(g,e,t){return t=null!==t&&void 0!==t?t.concat([g]):null,zn(4194308,4,jn.bind(null,e,g),t)},useLayoutEffect:function(g,e){return zn(4194308,4,g,e)},useInsertionEffect:function(g,e){return zn(4,2,g,e)},useMemo:function(g,e){var t=Wn();return e=void 0===e?null:e,g=g(),t.memoizedState=[g,e],g},useReducer:function(g,e,t){var I=Wn();return e=void 0!==t?t(e):e,I.memoizedState=I.baseState=e,g={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:g,lastRenderedState:e},I.queue=g,g=g.dispatch=go.bind(null,rn,g),[I.memoizedState,g]},useRef:function(g){return g={current:g},Wn().memoizedState=g},useState:wn,useDebugValue:Tn,useDeferredValue:function(g){return Wn().memoizedState=g},useTransition:function(){var g=wn(!1),e=g[0];return g=qn.bind(null,g[1]),Wn().memoizedState=g,[e,g]},useMutableSource:function(){},useSyncExternalStore:function(g,e,t){var I=rn,l=Wn();if(IC){if(void 0===t)throw Error(C(407));t=t()}else{if(t=e(),null===ka)throw Error(C(349));0!==(30&An)||vn(I,e,t)}l.memoizedState=t;var n={value:t,getSnapshot:e};return l.queue=n,En(xn.bind(null,I,n,g),[g]),I.flags|=2048,Fn(9,Yn.bind(null,I,n,t,e),void 0,null),t},useId:function(){var g=Wn(),e=ka.identifierPrefix;if(IC){var t=Ol;e=":"+e+"R"+(t=(Pl&~(1<<32-ne(Pl)-1)).toString(32)+t),0<(t=Zn++)&&(e+="H"+t.toString(32)),e+=":"}else e=":"+e+"r"+(t=Gn++).toString(32)+":";return g.memoizedState=e},unstable_isNewReconciler:!1},oo={readContext:SC,useCallback:Pn,useContext:SC,useEffect:Qn,useImperativeHandle:Dn,useInsertionEffect:Un,useLayoutEffect:Ln,useMemo:On,useReducer:Xn,useRef:Kn,useState:function(){return Xn(Rn)},useDebugValue:Tn,useDeferredValue:function(g){return _n(Vn(),un.memoizedState,g)},useTransition:function(){return[Xn(Rn)[0],Vn().memoizedState]},useMutableSource:kn,useSyncExternalStore:fn,useId:$n,unstable_isNewReconciler:!1},ao={readContext:SC,useCallback:Pn,useContext:SC,useEffect:Qn,useImperativeHandle:Dn,useInsertionEffect:Un,useLayoutEffect:Ln,useMemo:On,useReducer:Jn,useRef:Kn,useState:function(){return Jn(Rn)},useDebugValue:Tn,useDeferredValue:function(g){var e=Vn();return null===un?e.memoizedState=g:_n(e,un.memoizedState,g)},useTransition:function(){return[Jn(Rn)[0],Vn().memoizedState]},useMutableSource:kn,useSyncExternalStore:fn,useId:$n,unstable_isNewReconciler:!1};function io(g,e){try{var t="",I=e;do{t+=M(I),I=I.return}while(I);var l=t}catch(C){l="\nError generating stack: "+C.message+"\n"+C.stack}return{value:g,source:e,stack:l,digest:null}}function so(g,e,t){return{value:g,source:null,stack:null!=t?t:null,digest:null!=e?e:null}}function co(g,e){try{console.error(e.value)}catch(t){setTimeout((function(){throw t}))}}var Ao="function"===typeof WeakMap?WeakMap:Map;function ro(g,e,t){(t=vC(-1,t)).tag=3,t.payload={element:null};var I=e.value;return t.callback=function(){La||(La=!0,ja=I),co(0,e)},t}function uo(g,e,t){(t=vC(-1,t)).tag=3;var I=g.type.getDerivedStateFromError;if("function"===typeof I){var l=e.value;t.payload=function(){return I(l)},t.callback=function(){co(0,e)}}var C=g.stateNode;return null!==C&&"function"===typeof C.componentDidCatch&&(t.callback=function(){co(0,e),"function"!==typeof I&&(null===Da?Da=new Set([this]):Da.add(this));var g=e.stack;this.componentDidCatch(e.value,{componentStack:null!==g?g:""})}),t}function mo(g,e,t){var I=g.pingCache;if(null===I){I=g.pingCache=new Ao;var l=new Set;I.set(e,l)}else void 0===(l=I.get(e))&&(l=new Set,I.set(e,l));l.has(t)||(l.add(t),g=Vi.bind(null,g,e,t),e.then(g,g))}function bo(g){do{var e;if((e=13===g.tag)&&(e=null===(e=g.memoizedState)||null!==e.dehydrated),e)return g;g=g.return}while(null!==g);return null}function ho(g,e,t,I,l){return 0===(1&g.mode)?(g===e?g.flags|=65536:(g.flags|=128,t.flags|=131072,t.flags&=-52805,1===t.tag&&(null===t.alternate?t.tag=17:((e=vC(-1,1)).tag=2,YC(t,e,1))),t.lanes|=1),g):(g.flags|=65536,g.lanes=l,g)}var Zo=G.ReactCurrentOwner,Go=!1;function po(g,e,t,I){e.child=null===g?OC(e,null,t,I):PC(e,g.child,t,I)}function yo(g,e,t,I,l){t=t.render;var C=e.ref;return BC(e,l),I=Bn(g,e,t,I,C,l),t=Sn(),null===g||Go?(IC&&t&&$l(e),e.flags|=1,po(g,e,I,l),e.child):(e.updateQueue=g.updateQueue,e.flags&=-2053,g.lanes&=~l,Lo(g,e,l))}function Bo(g,e,t,I,l){if(null===g){var C=t.type;return"function"!==typeof C||Yi(C)||void 0!==C.defaultProps||null!==t.compare||void 0!==t.defaultProps?((g=Hi(t.type,null,I,e,e.mode,l)).ref=e.ref,g.return=e,e.child=g):(e.tag=15,e.type=C,So(g,e,C,I,l))}if(C=g.child,0===(g.lanes&l)){var n=C.memoizedProps;if((t=null!==(t=t.compare)?t:oI)(n,I)&&g.ref===e.ref)return Lo(g,e,l)}return e.flags|=1,(g=xi(C,I)).ref=e.ref,g.return=e,e.child=g}function So(g,e,t,I,l){if(null!==g){var C=g.memoizedProps;if(oI(C,I)&&g.ref===e.ref){if(Go=!1,e.pendingProps=I=C,0===(g.lanes&l))return e.lanes=g.lanes,Lo(g,e,l);0!==(131072&g.flags)&&(Go=!0)}}return Ro(g,e,t,I,l)}function Wo(g,e,t){var I=e.pendingProps,l=I.children,C=null!==g?g.memoizedState:null;if("hidden"===I.mode)if(0===(1&e.mode))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Wl(xa,Ya),Ya|=t;else{if(0===(1073741824&t))return g=null!==C?C.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:g,cachePool:null,transitions:null},e.updateQueue=null,Wl(xa,Ya),Ya|=g,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},I=null!==C?C.baseLanes:t,Wl(xa,Ya),Ya|=I}else null!==C?(I=C.baseLanes|t,e.memoizedState=null):I=t,Wl(xa,Ya),Ya|=I;return po(g,e,l,t),e.child}function Vo(g,e){var t=e.ref;(null===g&&null!==t||null!==g&&g.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Ro(g,e,t,I,l){var C=fl(t)?Jl:Rl.current;return C=kl(e,C),BC(e,l),t=Bn(g,e,t,I,C,l),I=Sn(),null===g||Go?(IC&&I&&$l(e),e.flags|=1,po(g,e,t,l),e.child):(e.updateQueue=g.updateQueue,e.flags&=-2053,g.lanes&=~l,Lo(g,e,l))}function Xo(g,e,t,I,l){if(fl(t)){var C=!0;Hl(e)}else C=!1;if(BC(e,l),null===e.stateNode)Uo(g,e),EC(e,t,I),UC(e,t,I,l),I=!0;else if(null===g){var n=e.stateNode,o=e.memoizedProps;n.props=o;var a=n.context,i=t.contextType;"object"===typeof i&&null!==i?i=SC(i):i=kl(e,i=fl(t)?Jl:Rl.current);var s=t.getDerivedStateFromProps,c="function"===typeof s||"function"===typeof n.getSnapshotBeforeUpdate;c||"function"!==typeof n.UNSAFE_componentWillReceiveProps&&"function"!==typeof n.componentWillReceiveProps||(o!==I||a!==i)&&QC(e,n,I,i),JC=!1;var d=e.memoizedState;n.state=d,NC(e,I,n,l),a=e.memoizedState,o!==I||d!==a||Xl.current||JC?("function"===typeof s&&(KC(e,t,s,I),a=e.memoizedState),(o=JC||MC(e,t,o,I,d,a,i))?(c||"function"!==typeof n.UNSAFE_componentWillMount&&"function"!==typeof n.componentWillMount||("function"===typeof n.componentWillMount&&n.componentWillMount(),"function"===typeof n.UNSAFE_componentWillMount&&n.UNSAFE_componentWillMount()),"function"===typeof n.componentDidMount&&(e.flags|=4194308)):("function"===typeof n.componentDidMount&&(e.flags|=4194308),e.memoizedProps=I,e.memoizedState=a),n.props=I,n.state=a,n.context=i,I=o):("function"===typeof n.componentDidMount&&(e.flags|=4194308),I=!1)}else{n=e.stateNode,fC(g,e),o=e.memoizedProps,i=e.type===e.elementType?o:uC(e.type,o),n.props=i,c=e.pendingProps,d=n.context,"object"===typeof(a=t.contextType)&&null!==a?a=SC(a):a=kl(e,a=fl(t)?Jl:Rl.current);var A=t.getDerivedStateFromProps;(s="function"===typeof A||"function"===typeof n.getSnapshotBeforeUpdate)||"function"!==typeof n.UNSAFE_componentWillReceiveProps&&"function"!==typeof n.componentWillReceiveProps||(o!==c||d!==a)&&QC(e,n,I,a),JC=!1,d=e.memoizedState,n.state=d,NC(e,I,n,l);var r=e.memoizedState;o!==c||d!==r||Xl.current||JC?("function"===typeof A&&(KC(e,t,A,I),r=e.memoizedState),(i=JC||MC(e,t,i,I,d,r,a)||!1)?(s||"function"!==typeof n.UNSAFE_componentWillUpdate&&"function"!==typeof n.componentWillUpdate||("function"===typeof n.componentWillUpdate&&n.componentWillUpdate(I,r,a),"function"===typeof n.UNSAFE_componentWillUpdate&&n.UNSAFE_componentWillUpdate(I,r,a)),"function"===typeof n.componentDidUpdate&&(e.flags|=4),"function"===typeof n.getSnapshotBeforeUpdate&&(e.flags|=1024)):("function"!==typeof n.componentDidUpdate||o===g.memoizedProps&&d===g.memoizedState||(e.flags|=4),"function"!==typeof n.getSnapshotBeforeUpdate||o===g.memoizedProps&&d===g.memoizedState||(e.flags|=1024),e.memoizedProps=I,e.memoizedState=r),n.props=I,n.state=r,n.context=a,I=i):("function"!==typeof n.componentDidUpdate||o===g.memoizedProps&&d===g.memoizedState||(e.flags|=4),"function"!==typeof n.getSnapshotBeforeUpdate||o===g.memoizedProps&&d===g.memoizedState||(e.flags|=1024),I=!1)}return Jo(g,e,t,I,C,l)}function Jo(g,e,t,I,l,C){Vo(g,e);var n=0!==(128&e.flags);if(!I&&!n)return l&&Nl(e,t,!1),Lo(g,e,C);I=e.stateNode,Zo.current=e;var o=n&&"function"!==typeof t.getDerivedStateFromError?null:I.render();return e.flags|=1,null!==g&&n?(e.child=PC(e,g.child,null,C),e.child=PC(e,null,o,C)):po(g,e,o,C),e.memoizedState=I.state,l&&Nl(e,t,!0),e.child}function ko(g){var e=g.stateNode;e.pendingContext?Yl(0,e.pendingContext,e.pendingContext!==e.context):e.context&&Yl(0,e.context,!1),tn(g,e.containerInfo)}function fo(g,e,t,I,l){return dC(),AC(l),e.flags|=256,po(g,e,t,I),e.child}var vo,Yo,xo,Ho,No={dehydrated:null,treeContext:null,retryLane:0};function wo(g){return{baseLanes:g,cachePool:null,transitions:null}}function Fo(g,e,t){var I,l=e.pendingProps,n=nn.current,o=!1,a=0!==(128&e.flags);if((I=a)||(I=(null===g||null!==g.memoizedState)&&0!==(2&n)),I?(o=!0,e.flags&=-129):null!==g&&null===g.memoizedState||(n|=1),Wl(nn,1&n),null===g)return aC(e),null!==(g=e.memoizedState)&&null!==(g=g.dehydrated)?(0===(1&e.mode)?e.lanes=1:"$!"===g.data?e.lanes=8:e.lanes=1073741824,null):(a=l.children,g=l.fallback,o?(l=e.mode,o=e.child,a={mode:"hidden",children:a},0===(1&l)&&null!==o?(o.childLanes=0,o.pendingProps=a):o=wi(a,l,0,null),g=Ni(g,l,t,null),o.return=e,g.return=e,o.sibling=g,e.child=o,e.child.memoizedState=wo(t),e.memoizedState=No,g):Ko(e,a));if(null!==(n=g.memoizedState)&&null!==(I=n.dehydrated))return function(g,e,t,I,l,n,o){if(t)return 256&e.flags?(e.flags&=-257,zo(g,e,o,I=so(Error(C(422))))):null!==e.memoizedState?(e.child=g.child,e.flags|=128,null):(n=I.fallback,l=e.mode,I=wi({mode:"visible",children:I.children},l,0,null),(n=Ni(n,l,o,null)).flags|=2,I.return=e,n.return=e,I.sibling=n,e.child=I,0!==(1&e.mode)&&PC(e,g.child,null,o),e.child.memoizedState=wo(o),e.memoizedState=No,n);if(0===(1&e.mode))return zo(g,e,o,null);if("$!"===l.data){if(I=l.nextSibling&&l.nextSibling.dataset)var a=I.dgst;return I=a,zo(g,e,o,I=so(n=Error(C(419)),I,void 0))}if(a=0!==(o&g.childLanes),Go||a){if(null!==(I=ka)){switch(o&-o){case 4:l=2;break;case 16:l=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:l=32;break;case 536870912:l=268435456;break;default:l=0}0!==(l=0!==(l&(I.suspendedLanes|o))?0:l)&&l!==n.retryLane&&(n.retryLane=l,XC(g,l),Ii(I,g,l,-1))}return mi(),zo(g,e,o,I=so(Error(C(421))))}return"$?"===l.data?(e.flags|=128,e.child=g.child,e=Xi.bind(null,g),l._reactRetry=e,null):(g=n.treeContext,tC=al(l.nextSibling),eC=e,IC=!0,lC=null,null!==g&&(jl[Dl++]=Pl,jl[Dl++]=Ol,jl[Dl++]=Tl,Pl=g.id,Ol=g.overflow,Tl=e),e=Ko(e,I.children),e.flags|=4096,e)}(g,e,a,l,I,n,t);if(o){o=l.fallback,a=e.mode,I=(n=g.child).sibling;var i={mode:"hidden",children:l.children};return 0===(1&a)&&e.child!==n?((l=e.child).childLanes=0,l.pendingProps=i,e.deletions=null):(l=xi(n,i)).subtreeFlags=14680064&n.subtreeFlags,null!==I?o=xi(I,o):(o=Ni(o,a,t,null)).flags|=2,o.return=e,l.return=e,l.sibling=o,e.child=l,l=o,o=e.child,a=null===(a=g.child.memoizedState)?wo(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},o.memoizedState=a,o.childLanes=g.childLanes&~t,e.memoizedState=No,l}return g=(o=g.child).sibling,l=xi(o,{mode:"visible",children:l.children}),0===(1&e.mode)&&(l.lanes=t),l.return=e,l.sibling=null,null!==g&&(null===(t=e.deletions)?(e.deletions=[g],e.flags|=16):t.push(g)),e.child=l,e.memoizedState=null,l}function Ko(g,e){return(e=wi({mode:"visible",children:e},g.mode,0,null)).return=g,g.child=e}function zo(g,e,t,I){return null!==I&&AC(I),PC(e,g.child,null,t),(g=Ko(e,e.pendingProps.children)).flags|=2,e.memoizedState=null,g}function Mo(g,e,t){g.lanes|=e;var I=g.alternate;null!==I&&(I.lanes|=e),yC(g.return,e,t)}function Eo(g,e,t,I,l){var C=g.memoizedState;null===C?g.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:I,tail:t,tailMode:l}:(C.isBackwards=e,C.rendering=null,C.renderingStartTime=0,C.last=I,C.tail=t,C.tailMode=l)}function Qo(g,e,t){var I=e.pendingProps,l=I.revealOrder,C=I.tail;if(po(g,e,I.children,t),0!==(2&(I=nn.current)))I=1&I|2,e.flags|=128;else{if(null!==g&&0!==(128&g.flags))g:for(g=e.child;null!==g;){if(13===g.tag)null!==g.memoizedState&&Mo(g,t,e);else if(19===g.tag)Mo(g,t,e);else if(null!==g.child){g.child.return=g,g=g.child;continue}if(g===e)break g;for(;null===g.sibling;){if(null===g.return||g.return===e)break g;g=g.return}g.sibling.return=g.return,g=g.sibling}I&=1}if(Wl(nn,I),0===(1&e.mode))e.memoizedState=null;else switch(l){case"forwards":for(t=e.child,l=null;null!==t;)null!==(g=t.alternate)&&null===on(g)&&(l=t),t=t.sibling;null===(t=l)?(l=e.child,e.child=null):(l=t.sibling,t.sibling=null),Eo(e,!1,l,t,C);break;case"backwards":for(t=null,l=e.child,e.child=null;null!==l;){if(null!==(g=l.alternate)&&null===on(g)){e.child=l;break}g=l.sibling,l.sibling=t,t=l,l=g}Eo(e,!0,t,null,C);break;case"together":Eo(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Uo(g,e){0===(1&e.mode)&&null!==g&&(g.alternate=null,e.alternate=null,e.flags|=2)}function Lo(g,e,t){if(null!==g&&(e.dependencies=g.dependencies),wa|=e.lanes,0===(t&e.childLanes))return null;if(null!==g&&e.child!==g.child)throw Error(C(153));if(null!==e.child){for(t=xi(g=e.child,g.pendingProps),e.child=t,t.return=e;null!==g.sibling;)g=g.sibling,(t=t.sibling=xi(g,g.pendingProps)).return=e;t.sibling=null}return e.child}function jo(g,e){if(!IC)switch(g.tailMode){case"hidden":e=g.tail;for(var t=null;null!==e;)null!==e.alternate&&(t=e),e=e.sibling;null===t?g.tail=null:t.sibling=null;break;case"collapsed":t=g.tail;for(var I=null;null!==t;)null!==t.alternate&&(I=t),t=t.sibling;null===I?e||null===g.tail?g.tail=null:g.tail.sibling=null:I.sibling=null}}function Do(g){var e=null!==g.alternate&&g.alternate.child===g.child,t=0,I=0;if(e)for(var l=g.child;null!==l;)t|=l.lanes|l.childLanes,I|=14680064&l.subtreeFlags,I|=14680064&l.flags,l.return=g,l=l.sibling;else for(l=g.child;null!==l;)t|=l.lanes|l.childLanes,I|=l.subtreeFlags,I|=l.flags,l.return=g,l=l.sibling;return g.subtreeFlags|=I,g.childLanes=t,e}function To(g,e,t){var I=e.pendingProps;switch(gC(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Do(e),null;case 1:case 17:return fl(e.type)&&vl(),Do(e),null;case 3:return I=e.stateNode,In(),Sl(Xl),Sl(Rl),sn(),I.pendingContext&&(I.context=I.pendingContext,I.pendingContext=null),null!==g&&null!==g.child||(sC(e)?e.flags|=4:null===g||g.memoizedState.isDehydrated&&0===(256&e.flags)||(e.flags|=1024,null!==lC&&(oi(lC),lC=null))),Yo(g,e),Do(e),null;case 5:Cn(e);var l=en(gn.current);if(t=e.type,null!==g&&null!=e.stateNode)xo(g,e,t,I,l),g.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!I){if(null===e.stateNode)throw Error(C(166));return Do(e),null}if(g=en(qC.current),sC(e)){I=e.stateNode,t=e.type;var n=e.memoizedProps;switch(I[cl]=e,I[dl]=n,g=0!==(1&e.mode),t){case"dialog":FI("cancel",I),FI("close",I);break;case"iframe":case"object":case"embed":FI("load",I);break;case"video":case"audio":for(l=0;l<xI.length;l++)FI(xI[l],I);break;case"source":FI("error",I);break;case"img":case"image":case"link":FI("error",I),FI("load",I);break;case"details":FI("toggle",I);break;case"input":O(I,n),FI("invalid",I);break;case"select":I._wrapperState={wasMultiple:!!n.multiple},FI("invalid",I);break;case"textarea":lg(I,n),FI("invalid",I)}for(var a in hg(t,n),l=null,n)if(n.hasOwnProperty(a)){var i=n[a];"children"===a?"string"===typeof i?I.textContent!==i&&(!0!==n.suppressHydrationWarning&&_I(I.textContent,i,g),l=["children",i]):"number"===typeof i&&I.textContent!==""+i&&(!0!==n.suppressHydrationWarning&&_I(I.textContent,i,g),l=["children",""+i]):o.hasOwnProperty(a)&&null!=i&&"onScroll"===a&&FI("scroll",I)}switch(t){case"input":j(I),$(I,n,!0);break;case"textarea":j(I),ng(I);break;case"select":case"option":break;default:"function"===typeof n.onClick&&(I.onclick=qI)}I=l,e.updateQueue=I,null!==I&&(e.flags|=4)}else{a=9===l.nodeType?l:l.ownerDocument,"http://www.w3.org/1999/xhtml"===g&&(g=og(t)),"http://www.w3.org/1999/xhtml"===g?"script"===t?((g=a.createElement("div")).innerHTML="<script><\/script>",g=g.removeChild(g.firstChild)):"string"===typeof I.is?g=a.createElement(t,{is:I.is}):(g=a.createElement(t),"select"===t&&(a=g,I.multiple?a.multiple=!0:I.size&&(a.size=I.size))):g=a.createElementNS(g,t),g[cl]=e,g[dl]=I,vo(g,e,!1,!1),e.stateNode=g;g:{switch(a=Zg(t,I),t){case"dialog":FI("cancel",g),FI("close",g),l=I;break;case"iframe":case"object":case"embed":FI("load",g),l=I;break;case"video":case"audio":for(l=0;l<xI.length;l++)FI(xI[l],g);l=I;break;case"source":FI("error",g),l=I;break;case"img":case"image":case"link":FI("error",g),FI("load",g),l=I;break;case"details":FI("toggle",g),l=I;break;case"input":O(g,I),l=P(g,I),FI("invalid",g);break;case"option":default:l=I;break;case"select":g._wrapperState={wasMultiple:!!I.multiple},l=w({},I,{value:void 0}),FI("invalid",g);break;case"textarea":lg(g,I),l=Ig(g,I),FI("invalid",g)}for(n in hg(t,l),i=l)if(i.hasOwnProperty(n)){var s=i[n];"style"===n?mg(g,s):"dangerouslySetInnerHTML"===n?null!=(s=s?s.__html:void 0)&&cg(g,s):"children"===n?"string"===typeof s?("textarea"!==t||""!==s)&&dg(g,s):"number"===typeof s&&dg(g,""+s):"suppressContentEditableWarning"!==n&&"suppressHydrationWarning"!==n&&"autoFocus"!==n&&(o.hasOwnProperty(n)?null!=s&&"onScroll"===n&&FI("scroll",g):null!=s&&Z(g,n,s,a))}switch(t){case"input":j(g),$(g,I,!1);break;case"textarea":j(g),ng(g);break;case"option":null!=I.value&&g.setAttribute("value",""+U(I.value));break;case"select":g.multiple=!!I.multiple,null!=(n=I.value)?tg(g,!!I.multiple,n,!1):null!=I.defaultValue&&tg(g,!!I.multiple,I.defaultValue,!0);break;default:"function"===typeof l.onClick&&(g.onclick=qI)}switch(t){case"button":case"input":case"select":case"textarea":I=!!I.autoFocus;break g;case"img":I=!0;break g;default:I=!1}}I&&(e.flags|=4)}null!==e.ref&&(e.flags|=512,e.flags|=2097152)}return Do(e),null;case 6:if(g&&null!=e.stateNode)Ho(g,e,g.memoizedProps,I);else{if("string"!==typeof I&&null===e.stateNode)throw Error(C(166));if(t=en(gn.current),en(qC.current),sC(e)){if(I=e.stateNode,t=e.memoizedProps,I[cl]=e,(n=I.nodeValue!==t)&&null!==(g=eC))switch(g.tag){case 3:_I(I.nodeValue,t,0!==(1&g.mode));break;case 5:!0!==g.memoizedProps.suppressHydrationWarning&&_I(I.nodeValue,t,0!==(1&g.mode))}n&&(e.flags|=4)}else(I=(9===t.nodeType?t:t.ownerDocument).createTextNode(I))[cl]=e,e.stateNode=I}return Do(e),null;case 13:if(Sl(nn),I=e.memoizedState,null===g||null!==g.memoizedState&&null!==g.memoizedState.dehydrated){if(IC&&null!==tC&&0!==(1&e.mode)&&0===(128&e.flags))cC(),dC(),e.flags|=98560,n=!1;else if(n=sC(e),null!==I&&null!==I.dehydrated){if(null===g){if(!n)throw Error(C(318));if(!(n=null!==(n=e.memoizedState)?n.dehydrated:null))throw Error(C(317));n[cl]=e}else dC(),0===(128&e.flags)&&(e.memoizedState=null),e.flags|=4;Do(e),n=!1}else null!==lC&&(oi(lC),lC=null),n=!0;if(!n)return 65536&e.flags?e:null}return 0!==(128&e.flags)?(e.lanes=t,e):((I=null!==I)!==(null!==g&&null!==g.memoizedState)&&I&&(e.child.flags|=8192,0!==(1&e.mode)&&(null===g||0!==(1&nn.current)?0===Ha&&(Ha=3):mi())),null!==e.updateQueue&&(e.flags|=4),Do(e),null);case 4:return In(),Yo(g,e),null===g&&MI(e.stateNode.containerInfo),Do(e),null;case 10:return pC(e.type._context),Do(e),null;case 19:if(Sl(nn),null===(n=e.memoizedState))return Do(e),null;if(I=0!==(128&e.flags),null===(a=n.rendering))if(I)jo(n,!1);else{if(0!==Ha||null!==g&&0!==(128&g.flags))for(g=e.child;null!==g;){if(null!==(a=on(g))){for(e.flags|=128,jo(n,!1),null!==(I=a.updateQueue)&&(e.updateQueue=I,e.flags|=4),e.subtreeFlags=0,I=t,t=e.child;null!==t;)g=I,(n=t).flags&=14680066,null===(a=n.alternate)?(n.childLanes=0,n.lanes=g,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=a.childLanes,n.lanes=a.lanes,n.child=a.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=a.memoizedProps,n.memoizedState=a.memoizedState,n.updateQueue=a.updateQueue,n.type=a.type,g=a.dependencies,n.dependencies=null===g?null:{lanes:g.lanes,firstContext:g.firstContext}),t=t.sibling;return Wl(nn,1&nn.current|2),e.child}g=g.sibling}null!==n.tail&&_g()>Qa&&(e.flags|=128,I=!0,jo(n,!1),e.lanes=4194304)}else{if(!I)if(null!==(g=on(a))){if(e.flags|=128,I=!0,null!==(t=g.updateQueue)&&(e.updateQueue=t,e.flags|=4),jo(n,!0),null===n.tail&&"hidden"===n.tailMode&&!a.alternate&&!IC)return Do(e),null}else 2*_g()-n.renderingStartTime>Qa&&1073741824!==t&&(e.flags|=128,I=!0,jo(n,!1),e.lanes=4194304);n.isBackwards?(a.sibling=e.child,e.child=a):(null!==(t=n.last)?t.sibling=a:e.child=a,n.last=a)}return null!==n.tail?(e=n.tail,n.rendering=e,n.tail=e.sibling,n.renderingStartTime=_g(),e.sibling=null,t=nn.current,Wl(nn,I?1&t|2:1&t),e):(Do(e),null);case 22:case 23:return di(),I=null!==e.memoizedState,null!==g&&null!==g.memoizedState!==I&&(e.flags|=8192),I&&0!==(1&e.mode)?0!==(1073741824&Ya)&&(Do(e),6&e.subtreeFlags&&(e.flags|=8192)):Do(e),null;case 24:case 25:return null}throw Error(C(156,e.tag))}function Po(g,e){switch(gC(e),e.tag){case 1:return fl(e.type)&&vl(),65536&(g=e.flags)?(e.flags=-65537&g|128,e):null;case 3:return In(),Sl(Xl),Sl(Rl),sn(),0!==(65536&(g=e.flags))&&0===(128&g)?(e.flags=-65537&g|128,e):null;case 5:return Cn(e),null;case 13:if(Sl(nn),null!==(g=e.memoizedState)&&null!==g.dehydrated){if(null===e.alternate)throw Error(C(340));dC()}return 65536&(g=e.flags)?(e.flags=-65537&g|128,e):null;case 19:return Sl(nn),null;case 4:return In(),null;case 10:return pC(e.type._context),null;case 22:case 23:return di(),null;default:return null}}vo=function(g,e){for(var t=e.child;null!==t;){if(5===t.tag||6===t.tag)g.appendChild(t.stateNode);else if(4!==t.tag&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}},Yo=function(){},xo=function(g,e,t,I){var l=g.memoizedProps;if(l!==I){g=e.stateNode,en(qC.current);var C,n=null;switch(t){case"input":l=P(g,l),I=P(g,I),n=[];break;case"select":l=w({},l,{value:void 0}),I=w({},I,{value:void 0}),n=[];break;case"textarea":l=Ig(g,l),I=Ig(g,I),n=[];break;default:"function"!==typeof l.onClick&&"function"===typeof I.onClick&&(g.onclick=qI)}for(s in hg(t,I),t=null,l)if(!I.hasOwnProperty(s)&&l.hasOwnProperty(s)&&null!=l[s])if("style"===s){var a=l[s];for(C in a)a.hasOwnProperty(C)&&(t||(t={}),t[C]="")}else"dangerouslySetInnerHTML"!==s&&"children"!==s&&"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(o.hasOwnProperty(s)?n||(n=[]):(n=n||[]).push(s,null));for(s in I){var i=I[s];if(a=null!=l?l[s]:void 0,I.hasOwnProperty(s)&&i!==a&&(null!=i||null!=a))if("style"===s)if(a){for(C in a)!a.hasOwnProperty(C)||i&&i.hasOwnProperty(C)||(t||(t={}),t[C]="");for(C in i)i.hasOwnProperty(C)&&a[C]!==i[C]&&(t||(t={}),t[C]=i[C])}else t||(n||(n=[]),n.push(s,t)),t=i;else"dangerouslySetInnerHTML"===s?(i=i?i.__html:void 0,a=a?a.__html:void 0,null!=i&&a!==i&&(n=n||[]).push(s,i)):"children"===s?"string"!==typeof i&&"number"!==typeof i||(n=n||[]).push(s,""+i):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&(o.hasOwnProperty(s)?(null!=i&&"onScroll"===s&&FI("scroll",g),n||a===i||(n=[])):(n=n||[]).push(s,i))}t&&(n=n||[]).push("style",t);var s=n;(e.updateQueue=s)&&(e.flags|=4)}},Ho=function(g,e,t,I){t!==I&&(e.flags|=4)};var Oo=!1,_o=!1,qo="function"===typeof WeakSet?WeakSet:Set,$o=null;function ga(g,e){var t=g.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(I){Wi(g,e,I)}else t.current=null}function ea(g,e,t){try{t()}catch(I){Wi(g,e,I)}}var ta=!1;function Ia(g,e,t){var I=e.updateQueue;if(null!==(I=null!==I?I.lastEffect:null)){var l=I=I.next;do{if((l.tag&g)===g){var C=l.destroy;l.destroy=void 0,void 0!==C&&ea(e,t,C)}l=l.next}while(l!==I)}}function la(g,e){if(null!==(e=null!==(e=e.updateQueue)?e.lastEffect:null)){var t=e=e.next;do{if((t.tag&g)===g){var I=t.create;t.destroy=I()}t=t.next}while(t!==e)}}function Ca(g){var e=g.ref;if(null!==e){var t=g.stateNode;g.tag,g=t,"function"===typeof e?e(g):e.current=g}}function na(g){var e=g.alternate;null!==e&&(g.alternate=null,na(e)),g.child=null,g.deletions=null,g.sibling=null,5===g.tag&&(null!==(e=g.stateNode)&&(delete e[cl],delete e[dl],delete e[rl],delete e[ul],delete e[ml])),g.stateNode=null,g.return=null,g.dependencies=null,g.memoizedProps=null,g.memoizedState=null,g.pendingProps=null,g.stateNode=null,g.updateQueue=null}function oa(g){return 5===g.tag||3===g.tag||4===g.tag}function aa(g){g:for(;;){for(;null===g.sibling;){if(null===g.return||oa(g.return))return null;g=g.return}for(g.sibling.return=g.return,g=g.sibling;5!==g.tag&&6!==g.tag&&18!==g.tag;){if(2&g.flags)continue g;if(null===g.child||4===g.tag)continue g;g.child.return=g,g=g.child}if(!(2&g.flags))return g.stateNode}}function ia(g,e,t){var I=g.tag;if(5===I||6===I)g=g.stateNode,e?8===t.nodeType?t.parentNode.insertBefore(g,e):t.insertBefore(g,e):(8===t.nodeType?(e=t.parentNode).insertBefore(g,t):(e=t).appendChild(g),null!==(t=t._reactRootContainer)&&void 0!==t||null!==e.onclick||(e.onclick=qI));else if(4!==I&&null!==(g=g.child))for(ia(g,e,t),g=g.sibling;null!==g;)ia(g,e,t),g=g.sibling}function sa(g,e,t){var I=g.tag;if(5===I||6===I)g=g.stateNode,e?t.insertBefore(g,e):t.appendChild(g);else if(4!==I&&null!==(g=g.child))for(sa(g,e,t),g=g.sibling;null!==g;)sa(g,e,t),g=g.sibling}var ca=null,da=!1;function Aa(g,e,t){for(t=t.child;null!==t;)ra(g,e,t),t=t.sibling}function ra(g,e,t){if(Ce&&"function"===typeof Ce.onCommitFiberUnmount)try{Ce.onCommitFiberUnmount(le,t)}catch(o){}switch(t.tag){case 5:_o||ga(t,e);case 6:var I=ca,l=da;ca=null,Aa(g,e,t),da=l,null!==(ca=I)&&(da?(g=ca,t=t.stateNode,8===g.nodeType?g.parentNode.removeChild(t):g.removeChild(t)):ca.removeChild(t.stateNode));break;case 18:null!==ca&&(da?(g=ca,t=t.stateNode,8===g.nodeType?ol(g.parentNode,t):1===g.nodeType&&ol(g,t),Ee(g)):ol(ca,t.stateNode));break;case 4:I=ca,l=da,ca=t.stateNode.containerInfo,da=!0,Aa(g,e,t),ca=I,da=l;break;case 0:case 11:case 14:case 15:if(!_o&&(null!==(I=t.updateQueue)&&null!==(I=I.lastEffect))){l=I=I.next;do{var C=l,n=C.destroy;C=C.tag,void 0!==n&&(0!==(2&C)||0!==(4&C))&&ea(t,e,n),l=l.next}while(l!==I)}Aa(g,e,t);break;case 1:if(!_o&&(ga(t,e),"function"===typeof(I=t.stateNode).componentWillUnmount))try{I.props=t.memoizedProps,I.state=t.memoizedState,I.componentWillUnmount()}catch(o){Wi(t,e,o)}Aa(g,e,t);break;case 21:Aa(g,e,t);break;case 22:1&t.mode?(_o=(I=_o)||null!==t.memoizedState,Aa(g,e,t),_o=I):Aa(g,e,t);break;default:Aa(g,e,t)}}function ua(g){var e=g.updateQueue;if(null!==e){g.updateQueue=null;var t=g.stateNode;null===t&&(t=g.stateNode=new qo),e.forEach((function(e){var I=Ji.bind(null,g,e);t.has(e)||(t.add(e),e.then(I,I))}))}}function ma(g,e){var t=e.deletions;if(null!==t)for(var I=0;I<t.length;I++){var l=t[I];try{var n=g,o=e,a=o;g:for(;null!==a;){switch(a.tag){case 5:ca=a.stateNode,da=!1;break g;case 3:case 4:ca=a.stateNode.containerInfo,da=!0;break g}a=a.return}if(null===ca)throw Error(C(160));ra(n,o,l),ca=null,da=!1;var i=l.alternate;null!==i&&(i.return=null),l.return=null}catch(s){Wi(l,e,s)}}if(12854&e.subtreeFlags)for(e=e.child;null!==e;)ba(e,g),e=e.sibling}function ba(g,e){var t=g.alternate,I=g.flags;switch(g.tag){case 0:case 11:case 14:case 15:if(ma(e,g),ha(g),4&I){try{Ia(3,g,g.return),la(3,g)}catch(m){Wi(g,g.return,m)}try{Ia(5,g,g.return)}catch(m){Wi(g,g.return,m)}}break;case 1:ma(e,g),ha(g),512&I&&null!==t&&ga(t,t.return);break;case 5:if(ma(e,g),ha(g),512&I&&null!==t&&ga(t,t.return),32&g.flags){var l=g.stateNode;try{dg(l,"")}catch(m){Wi(g,g.return,m)}}if(4&I&&null!=(l=g.stateNode)){var n=g.memoizedProps,o=null!==t?t.memoizedProps:n,a=g.type,i=g.updateQueue;if(g.updateQueue=null,null!==i)try{"input"===a&&"radio"===n.type&&null!=n.name&&_(l,n),Zg(a,o);var s=Zg(a,n);for(o=0;o<i.length;o+=2){var c=i[o],d=i[o+1];"style"===c?mg(l,d):"dangerouslySetInnerHTML"===c?cg(l,d):"children"===c?dg(l,d):Z(l,c,d,s)}switch(a){case"input":q(l,n);break;case"textarea":Cg(l,n);break;case"select":var A=l._wrapperState.wasMultiple;l._wrapperState.wasMultiple=!!n.multiple;var r=n.value;null!=r?tg(l,!!n.multiple,r,!1):A!==!!n.multiple&&(null!=n.defaultValue?tg(l,!!n.multiple,n.defaultValue,!0):tg(l,!!n.multiple,n.multiple?[]:"",!1))}l[dl]=n}catch(m){Wi(g,g.return,m)}}break;case 6:if(ma(e,g),ha(g),4&I){if(null===g.stateNode)throw Error(C(162));l=g.stateNode,n=g.memoizedProps;try{l.nodeValue=n}catch(m){Wi(g,g.return,m)}}break;case 3:if(ma(e,g),ha(g),4&I&&null!==t&&t.memoizedState.isDehydrated)try{Ee(e.containerInfo)}catch(m){Wi(g,g.return,m)}break;case 4:default:ma(e,g),ha(g);break;case 13:ma(e,g),ha(g),8192&(l=g.child).flags&&(n=null!==l.memoizedState,l.stateNode.isHidden=n,!n||null!==l.alternate&&null!==l.alternate.memoizedState||(Ea=_g())),4&I&&ua(g);break;case 22:if(c=null!==t&&null!==t.memoizedState,1&g.mode?(_o=(s=_o)||c,ma(e,g),_o=s):ma(e,g),ha(g),8192&I){if(s=null!==g.memoizedState,(g.stateNode.isHidden=s)&&!c&&0!==(1&g.mode))for($o=g,c=g.child;null!==c;){for(d=$o=c;null!==$o;){switch(r=(A=$o).child,A.tag){case 0:case 11:case 14:case 15:Ia(4,A,A.return);break;case 1:ga(A,A.return);var u=A.stateNode;if("function"===typeof u.componentWillUnmount){I=A,t=A.return;try{e=I,u.props=e.memoizedProps,u.state=e.memoizedState,u.componentWillUnmount()}catch(m){Wi(I,t,m)}}break;case 5:ga(A,A.return);break;case 22:if(null!==A.memoizedState){ya(d);continue}}null!==r?(r.return=A,$o=r):ya(d)}c=c.sibling}g:for(c=null,d=g;;){if(5===d.tag){if(null===c){c=d;try{l=d.stateNode,s?"function"===typeof(n=l.style).setProperty?n.setProperty("display","none","important"):n.display="none":(a=d.stateNode,o=void 0!==(i=d.memoizedProps.style)&&null!==i&&i.hasOwnProperty("display")?i.display:null,a.style.display=ug("display",o))}catch(m){Wi(g,g.return,m)}}}else if(6===d.tag){if(null===c)try{d.stateNode.nodeValue=s?"":d.memoizedProps}catch(m){Wi(g,g.return,m)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===g)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===g)break g;for(;null===d.sibling;){if(null===d.return||d.return===g)break g;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:ma(e,g),ha(g),4&I&&ua(g);case 21:}}function ha(g){var e=g.flags;if(2&e){try{g:{for(var t=g.return;null!==t;){if(oa(t)){var I=t;break g}t=t.return}throw Error(C(160))}switch(I.tag){case 5:var l=I.stateNode;32&I.flags&&(dg(l,""),I.flags&=-33),sa(g,aa(g),l);break;case 3:case 4:var n=I.stateNode.containerInfo;ia(g,aa(g),n);break;default:throw Error(C(161))}}catch(o){Wi(g,g.return,o)}g.flags&=-3}4096&e&&(g.flags&=-4097)}function Za(g,e,t){$o=g,Ga(g,e,t)}function Ga(g,e,t){for(var I=0!==(1&g.mode);null!==$o;){var l=$o,C=l.child;if(22===l.tag&&I){var n=null!==l.memoizedState||Oo;if(!n){var o=l.alternate,a=null!==o&&null!==o.memoizedState||_o;o=Oo;var i=_o;if(Oo=n,(_o=a)&&!i)for($o=l;null!==$o;)a=(n=$o).child,22===n.tag&&null!==n.memoizedState?Ba(l):null!==a?(a.return=n,$o=a):Ba(l);for(;null!==C;)$o=C,Ga(C,e,t),C=C.sibling;$o=l,Oo=o,_o=i}pa(g)}else 0!==(8772&l.subtreeFlags)&&null!==C?(C.return=l,$o=C):pa(g)}}function pa(g){for(;null!==$o;){var e=$o;if(0!==(8772&e.flags)){var t=e.alternate;try{if(0!==(8772&e.flags))switch(e.tag){case 0:case 11:case 15:_o||la(5,e);break;case 1:var I=e.stateNode;if(4&e.flags&&!_o)if(null===t)I.componentDidMount();else{var l=e.elementType===e.type?t.memoizedProps:uC(e.type,t.memoizedProps);I.componentDidUpdate(l,t.memoizedState,I.__reactInternalSnapshotBeforeUpdate)}var n=e.updateQueue;null!==n&&wC(e,n,I);break;case 3:var o=e.updateQueue;if(null!==o){if(t=null,null!==e.child)switch(e.child.tag){case 5:case 1:t=e.child.stateNode}wC(e,o,t)}break;case 5:var a=e.stateNode;if(null===t&&4&e.flags){t=a;var i=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":i.autoFocus&&t.focus();break;case"img":i.src&&(t.src=i.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===e.memoizedState){var s=e.alternate;if(null!==s){var c=s.memoizedState;if(null!==c){var d=c.dehydrated;null!==d&&Ee(d)}}}break;default:throw Error(C(163))}_o||512&e.flags&&Ca(e)}catch(A){Wi(e,e.return,A)}}if(e===g){$o=null;break}if(null!==(t=e.sibling)){t.return=e.return,$o=t;break}$o=e.return}}function ya(g){for(;null!==$o;){var e=$o;if(e===g){$o=null;break}var t=e.sibling;if(null!==t){t.return=e.return,$o=t;break}$o=e.return}}function Ba(g){for(;null!==$o;){var e=$o;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{la(4,e)}catch(a){Wi(e,t,a)}break;case 1:var I=e.stateNode;if("function"===typeof I.componentDidMount){var l=e.return;try{I.componentDidMount()}catch(a){Wi(e,l,a)}}var C=e.return;try{Ca(e)}catch(a){Wi(e,C,a)}break;case 5:var n=e.return;try{Ca(e)}catch(a){Wi(e,n,a)}}}catch(a){Wi(e,e.return,a)}if(e===g){$o=null;break}var o=e.sibling;if(null!==o){o.return=e.return,$o=o;break}$o=e.return}}var Sa,Wa=Math.ceil,Va=G.ReactCurrentDispatcher,Ra=G.ReactCurrentOwner,Xa=G.ReactCurrentBatchConfig,Ja=0,ka=null,fa=null,va=0,Ya=0,xa=Bl(0),Ha=0,Na=null,wa=0,Fa=0,Ka=0,za=null,Ma=null,Ea=0,Qa=1/0,Ua=null,La=!1,ja=null,Da=null,Ta=!1,Pa=null,Oa=0,_a=0,qa=null,$a=-1,gi=0;function ei(){return 0!==(6&Ja)?_g():-1!==$a?$a:$a=_g()}function ti(g){return 0===(1&g.mode)?1:0!==(2&Ja)&&0!==va?va&-va:null!==rC.transition?(0===gi&&(gi=ue()),gi):0!==(g=Ze)?g:g=void 0===(g=window.event)?16:Oe(g.type)}function Ii(g,e,t,I){if(50<_a)throw _a=0,qa=null,Error(C(185));be(g,t,I),0!==(2&Ja)&&g===ka||(g===ka&&(0===(2&Ja)&&(Fa|=t),4===Ha&&ai(g,va)),li(g,I),1===t&&0===Ja&&0===(1&e.mode)&&(Qa=_g()+500,Fl&&Ml()))}function li(g,e){var t=g.callbackNode;!function(g,e){for(var t=g.suspendedLanes,I=g.pingedLanes,l=g.expirationTimes,C=g.pendingLanes;0<C;){var n=31-ne(C),o=1<<n,a=l[n];-1===a?0!==(o&t)&&0===(o&I)||(l[n]=Ae(o,e)):a<=e&&(g.expiredLanes|=o),C&=~o}}(g,e);var I=de(g,g===ka?va:0);if(0===I)null!==t&&Tg(t),g.callbackNode=null,g.callbackPriority=0;else if(e=I&-I,g.callbackPriority!==e){if(null!=t&&Tg(t),1===e)0===g.tag?function(g){Fl=!0,zl(g)}(ii.bind(null,g)):zl(ii.bind(null,g)),Cl((function(){0===(6&Ja)&&Ml()})),t=null;else{switch(Ge(I)){case 1:t=$g;break;case 4:t=ge;break;case 16:default:t=ee;break;case 536870912:t=Ie}t=ki(t,Ci.bind(null,g))}g.callbackPriority=e,g.callbackNode=t}}function Ci(g,e){if($a=-1,gi=0,0!==(6&Ja))throw Error(C(327));var t=g.callbackNode;if(Bi()&&g.callbackNode!==t)return null;var I=de(g,g===ka?va:0);if(0===I)return null;if(0!==(30&I)||0!==(I&g.expiredLanes)||e)e=bi(g,I);else{e=I;var l=Ja;Ja|=2;var n=ui();for(ka===g&&va===e||(Ua=null,Qa=_g()+500,Ai(g,e));;)try{Zi();break}catch(a){ri(g,a)}GC(),Va.current=n,Ja=l,null!==fa?e=0:(ka=null,va=0,e=Ha)}if(0!==e){if(2===e&&(0!==(l=re(g))&&(I=l,e=ni(g,l))),1===e)throw t=Na,Ai(g,0),ai(g,I),li(g,_g()),t;if(6===e)ai(g,I);else{if(l=g.current.alternate,0===(30&I)&&!function(g){for(var e=g;;){if(16384&e.flags){var t=e.updateQueue;if(null!==t&&null!==(t=t.stores))for(var I=0;I<t.length;I++){var l=t[I],C=l.getSnapshot;l=l.value;try{if(!nI(C(),l))return!1}catch(o){return!1}}}if(t=e.child,16384&e.subtreeFlags&&null!==t)t.return=e,e=t;else{if(e===g)break;for(;null===e.sibling;){if(null===e.return||e.return===g)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}(l)&&(2===(e=bi(g,I))&&(0!==(n=re(g))&&(I=n,e=ni(g,n))),1===e))throw t=Na,Ai(g,0),ai(g,I),li(g,_g()),t;switch(g.finishedWork=l,g.finishedLanes=I,e){case 0:case 1:throw Error(C(345));case 2:case 5:yi(g,Ma,Ua);break;case 3:if(ai(g,I),(130023424&I)===I&&10<(e=Ea+500-_g())){if(0!==de(g,0))break;if(((l=g.suspendedLanes)&I)!==I){ei(),g.pingedLanes|=g.suspendedLanes&l;break}g.timeoutHandle=tl(yi.bind(null,g,Ma,Ua),e);break}yi(g,Ma,Ua);break;case 4:if(ai(g,I),(4194240&I)===I)break;for(e=g.eventTimes,l=-1;0<I;){var o=31-ne(I);n=1<<o,(o=e[o])>l&&(l=o),I&=~n}if(I=l,10<(I=(120>(I=_g()-I)?120:480>I?480:1080>I?1080:1920>I?1920:3e3>I?3e3:4320>I?4320:1960*Wa(I/1960))-I)){g.timeoutHandle=tl(yi.bind(null,g,Ma,Ua),I);break}yi(g,Ma,Ua);break;default:throw Error(C(329))}}}return li(g,_g()),g.callbackNode===t?Ci.bind(null,g):null}function ni(g,e){var t=za;return g.current.memoizedState.isDehydrated&&(Ai(g,e).flags|=256),2!==(g=bi(g,e))&&(e=Ma,Ma=t,null!==e&&oi(e)),g}function oi(g){null===Ma?Ma=g:Ma.push.apply(Ma,g)}function ai(g,e){for(e&=~Ka,e&=~Fa,g.suspendedLanes|=e,g.pingedLanes&=~e,g=g.expirationTimes;0<e;){var t=31-ne(e),I=1<<t;g[t]=-1,e&=~I}}function ii(g){if(0!==(6&Ja))throw Error(C(327));Bi();var e=de(g,0);if(0===(1&e))return li(g,_g()),null;var t=bi(g,e);if(0!==g.tag&&2===t){var I=re(g);0!==I&&(e=I,t=ni(g,I))}if(1===t)throw t=Na,Ai(g,0),ai(g,e),li(g,_g()),t;if(6===t)throw Error(C(345));return g.finishedWork=g.current.alternate,g.finishedLanes=e,yi(g,Ma,Ua),li(g,_g()),null}function si(g,e){var t=Ja;Ja|=1;try{return g(e)}finally{0===(Ja=t)&&(Qa=_g()+500,Fl&&Ml())}}function ci(g){null!==Pa&&0===Pa.tag&&0===(6&Ja)&&Bi();var e=Ja;Ja|=1;var t=Xa.transition,I=Ze;try{if(Xa.transition=null,Ze=1,g)return g()}finally{Ze=I,Xa.transition=t,0===(6&(Ja=e))&&Ml()}}function di(){Ya=xa.current,Sl(xa)}function Ai(g,e){g.finishedWork=null,g.finishedLanes=0;var t=g.timeoutHandle;if(-1!==t&&(g.timeoutHandle=-1,Il(t)),null!==fa)for(t=fa.return;null!==t;){var I=t;switch(gC(I),I.tag){case 1:null!==(I=I.type.childContextTypes)&&void 0!==I&&vl();break;case 3:In(),Sl(Xl),Sl(Rl),sn();break;case 5:Cn(I);break;case 4:In();break;case 13:case 19:Sl(nn);break;case 10:pC(I.type._context);break;case 22:case 23:di()}t=t.return}if(ka=g,fa=g=xi(g.current,null),va=Ya=e,Ha=0,Na=null,Ka=Fa=wa=0,Ma=za=null,null!==WC){for(e=0;e<WC.length;e++)if(null!==(I=(t=WC[e]).interleaved)){t.interleaved=null;var l=I.next,C=t.pending;if(null!==C){var n=C.next;C.next=l,I.next=n}t.pending=I}WC=null}return g}function ri(g,e){for(;;){var t=fa;try{if(GC(),cn.current=Co,bn){for(var I=rn.memoizedState;null!==I;){var l=I.queue;null!==l&&(l.pending=null),I=I.next}bn=!1}if(An=0,mn=un=rn=null,hn=!1,Zn=0,Ra.current=null,null===t||null===t.return){Ha=1,Na=e,fa=null;break}g:{var n=g,o=t.return,a=t,i=e;if(e=va,a.flags|=32768,null!==i&&"object"===typeof i&&"function"===typeof i.then){var s=i,c=a,d=c.tag;if(0===(1&c.mode)&&(0===d||11===d||15===d)){var A=c.alternate;A?(c.updateQueue=A.updateQueue,c.memoizedState=A.memoizedState,c.lanes=A.lanes):(c.updateQueue=null,c.memoizedState=null)}var r=bo(o);if(null!==r){r.flags&=-257,ho(r,o,a,0,e),1&r.mode&&mo(n,s,e),i=s;var u=(e=r).updateQueue;if(null===u){var m=new Set;m.add(i),e.updateQueue=m}else u.add(i);break g}if(0===(1&e)){mo(n,s,e),mi();break g}i=Error(C(426))}else if(IC&&1&a.mode){var b=bo(o);if(null!==b){0===(65536&b.flags)&&(b.flags|=256),ho(b,o,a,0,e),AC(io(i,a));break g}}n=i=io(i,a),4!==Ha&&(Ha=2),null===za?za=[n]:za.push(n),n=o;do{switch(n.tag){case 3:n.flags|=65536,e&=-e,n.lanes|=e,HC(n,ro(0,i,e));break g;case 1:a=i;var h=n.type,Z=n.stateNode;if(0===(128&n.flags)&&("function"===typeof h.getDerivedStateFromError||null!==Z&&"function"===typeof Z.componentDidCatch&&(null===Da||!Da.has(Z)))){n.flags|=65536,e&=-e,n.lanes|=e,HC(n,uo(n,a,e));break g}}n=n.return}while(null!==n)}pi(t)}catch(G){e=G,fa===t&&null!==t&&(fa=t=t.return);continue}break}}function ui(){var g=Va.current;return Va.current=Co,null===g?Co:g}function mi(){0!==Ha&&3!==Ha&&2!==Ha||(Ha=4),null===ka||0===(268435455&wa)&&0===(268435455&Fa)||ai(ka,va)}function bi(g,e){var t=Ja;Ja|=2;var I=ui();for(ka===g&&va===e||(Ua=null,Ai(g,e));;)try{hi();break}catch(l){ri(g,l)}if(GC(),Ja=t,Va.current=I,null!==fa)throw Error(C(261));return ka=null,va=0,Ha}function hi(){for(;null!==fa;)Gi(fa)}function Zi(){for(;null!==fa&&!Pg();)Gi(fa)}function Gi(g){var e=Sa(g.alternate,g,Ya);g.memoizedProps=g.pendingProps,null===e?pi(g):fa=e,Ra.current=null}function pi(g){var e=g;do{var t=e.alternate;if(g=e.return,0===(32768&e.flags)){if(null!==(t=To(t,e,Ya)))return void(fa=t)}else{if(null!==(t=Po(t,e)))return t.flags&=32767,void(fa=t);if(null===g)return Ha=6,void(fa=null);g.flags|=32768,g.subtreeFlags=0,g.deletions=null}if(null!==(e=e.sibling))return void(fa=e);fa=e=g}while(null!==e);0===Ha&&(Ha=5)}function yi(g,e,t){var I=Ze,l=Xa.transition;try{Xa.transition=null,Ze=1,function(g,e,t,I){do{Bi()}while(null!==Pa);if(0!==(6&Ja))throw Error(C(327));t=g.finishedWork;var l=g.finishedLanes;if(null===t)return null;if(g.finishedWork=null,g.finishedLanes=0,t===g.current)throw Error(C(177));g.callbackNode=null,g.callbackPriority=0;var n=t.lanes|t.childLanes;if(function(g,e){var t=g.pendingLanes&~e;g.pendingLanes=e,g.suspendedLanes=0,g.pingedLanes=0,g.expiredLanes&=e,g.mutableReadLanes&=e,g.entangledLanes&=e,e=g.entanglements;var I=g.eventTimes;for(g=g.expirationTimes;0<t;){var l=31-ne(t),C=1<<l;e[l]=0,I[l]=-1,g[l]=-1,t&=~C}}(g,n),g===ka&&(fa=ka=null,va=0),0===(2064&t.subtreeFlags)&&0===(2064&t.flags)||Ta||(Ta=!0,ki(ee,(function(){return Bi(),null}))),n=0!==(15990&t.flags),0!==(15990&t.subtreeFlags)||n){n=Xa.transition,Xa.transition=null;var o=Ze;Ze=1;var a=Ja;Ja|=4,Ra.current=null,function(g,e){if($I=Ue,dI(g=cI())){if("selectionStart"in g)var t={start:g.selectionStart,end:g.selectionEnd};else g:{var I=(t=(t=g.ownerDocument)&&t.defaultView||window).getSelection&&t.getSelection();if(I&&0!==I.rangeCount){t=I.anchorNode;var l=I.anchorOffset,n=I.focusNode;I=I.focusOffset;try{t.nodeType,n.nodeType}catch(p){t=null;break g}var o=0,a=-1,i=-1,s=0,c=0,d=g,A=null;e:for(;;){for(var r;d!==t||0!==l&&3!==d.nodeType||(a=o+l),d!==n||0!==I&&3!==d.nodeType||(i=o+I),3===d.nodeType&&(o+=d.nodeValue.length),null!==(r=d.firstChild);)A=d,d=r;for(;;){if(d===g)break e;if(A===t&&++s===l&&(a=o),A===n&&++c===I&&(i=o),null!==(r=d.nextSibling))break;A=(d=A).parentNode}d=r}t=-1===a||-1===i?null:{start:a,end:i}}else t=null}t=t||{start:0,end:0}}else t=null;for(gl={focusedElem:g,selectionRange:t},Ue=!1,$o=e;null!==$o;)if(g=(e=$o).child,0!==(1028&e.subtreeFlags)&&null!==g)g.return=e,$o=g;else for(;null!==$o;){e=$o;try{var u=e.alternate;if(0!==(1024&e.flags))switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==u){var m=u.memoizedProps,b=u.memoizedState,h=e.stateNode,Z=h.getSnapshotBeforeUpdate(e.elementType===e.type?m:uC(e.type,m),b);h.__reactInternalSnapshotBeforeUpdate=Z}break;case 3:var G=e.stateNode.containerInfo;1===G.nodeType?G.textContent="":9===G.nodeType&&G.documentElement&&G.removeChild(G.documentElement);break;default:throw Error(C(163))}}catch(p){Wi(e,e.return,p)}if(null!==(g=e.sibling)){g.return=e.return,$o=g;break}$o=e.return}u=ta,ta=!1}(g,t),ba(t,g),AI(gl),Ue=!!$I,gl=$I=null,g.current=t,Za(t,g,l),Og(),Ja=a,Ze=o,Xa.transition=n}else g.current=t;if(Ta&&(Ta=!1,Pa=g,Oa=l),n=g.pendingLanes,0===n&&(Da=null),function(g){if(Ce&&"function"===typeof Ce.onCommitFiberRoot)try{Ce.onCommitFiberRoot(le,g,void 0,128===(128&g.current.flags))}catch(e){}}(t.stateNode),li(g,_g()),null!==e)for(I=g.onRecoverableError,t=0;t<e.length;t++)l=e[t],I(l.value,{componentStack:l.stack,digest:l.digest});if(La)throw La=!1,g=ja,ja=null,g;0!==(1&Oa)&&0!==g.tag&&Bi(),n=g.pendingLanes,0!==(1&n)?g===qa?_a++:(_a=0,qa=g):_a=0,Ml()}(g,e,t,I)}finally{Xa.transition=l,Ze=I}return null}function Bi(){if(null!==Pa){var g=Ge(Oa),e=Xa.transition,t=Ze;try{if(Xa.transition=null,Ze=16>g?16:g,null===Pa)var I=!1;else{if(g=Pa,Pa=null,Oa=0,0!==(6&Ja))throw Error(C(331));var l=Ja;for(Ja|=4,$o=g.current;null!==$o;){var n=$o,o=n.child;if(0!==(16&$o.flags)){var a=n.deletions;if(null!==a){for(var i=0;i<a.length;i++){var s=a[i];for($o=s;null!==$o;){var c=$o;switch(c.tag){case 0:case 11:case 15:Ia(8,c,n)}var d=c.child;if(null!==d)d.return=c,$o=d;else for(;null!==$o;){var A=(c=$o).sibling,r=c.return;if(na(c),c===s){$o=null;break}if(null!==A){A.return=r,$o=A;break}$o=r}}}var u=n.alternate;if(null!==u){var m=u.child;if(null!==m){u.child=null;do{var b=m.sibling;m.sibling=null,m=b}while(null!==m)}}$o=n}}if(0!==(2064&n.subtreeFlags)&&null!==o)o.return=n,$o=o;else g:for(;null!==$o;){if(0!==(2048&(n=$o).flags))switch(n.tag){case 0:case 11:case 15:Ia(9,n,n.return)}var h=n.sibling;if(null!==h){h.return=n.return,$o=h;break g}$o=n.return}}var Z=g.current;for($o=Z;null!==$o;){var G=(o=$o).child;if(0!==(2064&o.subtreeFlags)&&null!==G)G.return=o,$o=G;else g:for(o=Z;null!==$o;){if(0!==(2048&(a=$o).flags))try{switch(a.tag){case 0:case 11:case 15:la(9,a)}}catch(y){Wi(a,a.return,y)}if(a===o){$o=null;break g}var p=a.sibling;if(null!==p){p.return=a.return,$o=p;break g}$o=a.return}}if(Ja=l,Ml(),Ce&&"function"===typeof Ce.onPostCommitFiberRoot)try{Ce.onPostCommitFiberRoot(le,g)}catch(y){}I=!0}return I}finally{Ze=t,Xa.transition=e}}return!1}function Si(g,e,t){g=YC(g,e=ro(0,e=io(t,e),1),1),e=ei(),null!==g&&(be(g,1,e),li(g,e))}function Wi(g,e,t){if(3===g.tag)Si(g,g,t);else for(;null!==e;){if(3===e.tag){Si(e,g,t);break}if(1===e.tag){var I=e.stateNode;if("function"===typeof e.type.getDerivedStateFromError||"function"===typeof I.componentDidCatch&&(null===Da||!Da.has(I))){e=YC(e,g=uo(e,g=io(t,g),1),1),g=ei(),null!==e&&(be(e,1,g),li(e,g));break}}e=e.return}}function Vi(g,e,t){var I=g.pingCache;null!==I&&I.delete(e),e=ei(),g.pingedLanes|=g.suspendedLanes&t,ka===g&&(va&t)===t&&(4===Ha||3===Ha&&(130023424&va)===va&&500>_g()-Ea?Ai(g,0):Ka|=t),li(g,e)}function Ri(g,e){0===e&&(0===(1&g.mode)?e=1:(e=se,0===(130023424&(se<<=1))&&(se=4194304)));var t=ei();null!==(g=XC(g,e))&&(be(g,e,t),li(g,t))}function Xi(g){var e=g.memoizedState,t=0;null!==e&&(t=e.retryLane),Ri(g,t)}function Ji(g,e){var t=0;switch(g.tag){case 13:var I=g.stateNode,l=g.memoizedState;null!==l&&(t=l.retryLane);break;case 19:I=g.stateNode;break;default:throw Error(C(314))}null!==I&&I.delete(e),Ri(g,t)}function ki(g,e){return Dg(g,e)}function fi(g,e,t,I){this.tag=g,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=I,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vi(g,e,t,I){return new fi(g,e,t,I)}function Yi(g){return!(!(g=g.prototype)||!g.isReactComponent)}function xi(g,e){var t=g.alternate;return null===t?((t=vi(g.tag,e,g.key,g.mode)).elementType=g.elementType,t.type=g.type,t.stateNode=g.stateNode,t.alternate=g,g.alternate=t):(t.pendingProps=e,t.type=g.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=14680064&g.flags,t.childLanes=g.childLanes,t.lanes=g.lanes,t.child=g.child,t.memoizedProps=g.memoizedProps,t.memoizedState=g.memoizedState,t.updateQueue=g.updateQueue,e=g.dependencies,t.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=g.sibling,t.index=g.index,t.ref=g.ref,t}function Hi(g,e,t,I,l,n){var o=2;if(I=g,"function"===typeof g)Yi(g)&&(o=1);else if("string"===typeof g)o=5;else g:switch(g){case B:return Ni(t.children,l,n,e);case S:o=8,l|=8;break;case W:return(g=vi(12,t,e,2|l)).elementType=W,g.lanes=n,g;case J:return(g=vi(13,t,e,l)).elementType=J,g.lanes=n,g;case k:return(g=vi(19,t,e,l)).elementType=k,g.lanes=n,g;case Y:return wi(t,l,n,e);default:if("object"===typeof g&&null!==g)switch(g.$$typeof){case V:o=10;break g;case R:o=9;break g;case X:o=11;break g;case f:o=14;break g;case v:o=16,I=null;break g}throw Error(C(130,null==g?g:typeof g,""))}return(e=vi(o,t,e,l)).elementType=g,e.type=I,e.lanes=n,e}function Ni(g,e,t,I){return(g=vi(7,g,I,e)).lanes=t,g}function wi(g,e,t,I){return(g=vi(22,g,I,e)).elementType=Y,g.lanes=t,g.stateNode={isHidden:!1},g}function Fi(g,e,t){return(g=vi(6,g,null,e)).lanes=t,g}function Ki(g,e,t){return(e=vi(4,null!==g.children?g.children:[],g.key,e)).lanes=t,e.stateNode={containerInfo:g.containerInfo,pendingChildren:null,implementation:g.implementation},e}function zi(g,e,t,I,l){this.tag=e,this.containerInfo=g,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=me(0),this.expirationTimes=me(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=me(0),this.identifierPrefix=I,this.onRecoverableError=l,this.mutableSourceEagerHydrationData=null}function Mi(g,e,t,I,l,C,n,o,a){return g=new zi(g,e,t,o,a),1===e?(e=1,!0===C&&(e|=8)):e=0,C=vi(3,null,null,e),g.current=C,C.stateNode=g,C.memoizedState={element:I,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},kC(C),g}function Ei(g){if(!g)return Vl;g:{if(Eg(g=g._reactInternals)!==g||1!==g.tag)throw Error(C(170));var e=g;do{switch(e.tag){case 3:e=e.stateNode.context;break g;case 1:if(fl(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break g}}e=e.return}while(null!==e);throw Error(C(171))}if(1===g.tag){var t=g.type;if(fl(t))return xl(g,t,e)}return e}function Qi(g,e,t,I,l,C,n,o,a){return(g=Mi(t,I,!0,g,0,C,0,o,a)).context=Ei(null),t=g.current,(C=vC(I=ei(),l=ti(t))).callback=void 0!==e&&null!==e?e:null,YC(t,C,l),g.current.lanes=l,be(g,l,I),li(g,I),g}function Ui(g,e,t,I){var l=e.current,C=ei(),n=ti(l);return t=Ei(t),null===e.context?e.context=t:e.pendingContext=t,(e=vC(C,n)).payload={element:g},null!==(I=void 0===I?null:I)&&(e.callback=I),null!==(g=YC(l,e,n))&&(Ii(g,l,n,C),xC(g,l,n)),n}function Li(g){return(g=g.current).child?(g.child.tag,g.child.stateNode):null}function ji(g,e){if(null!==(g=g.memoizedState)&&null!==g.dehydrated){var t=g.retryLane;g.retryLane=0!==t&&t<e?t:e}}function Di(g,e){ji(g,e),(g=g.alternate)&&ji(g,e)}Sa=function(g,e,t){if(null!==g)if(g.memoizedProps!==e.pendingProps||Xl.current)Go=!0;else{if(0===(g.lanes&t)&&0===(128&e.flags))return Go=!1,function(g,e,t){switch(e.tag){case 3:ko(e),dC();break;case 5:ln(e);break;case 1:fl(e.type)&&Hl(e);break;case 4:tn(e,e.stateNode.containerInfo);break;case 10:var I=e.type._context,l=e.memoizedProps.value;Wl(mC,I._currentValue),I._currentValue=l;break;case 13:if(null!==(I=e.memoizedState))return null!==I.dehydrated?(Wl(nn,1&nn.current),e.flags|=128,null):0!==(t&e.child.childLanes)?Fo(g,e,t):(Wl(nn,1&nn.current),null!==(g=Lo(g,e,t))?g.sibling:null);Wl(nn,1&nn.current);break;case 19:if(I=0!==(t&e.childLanes),0!==(128&g.flags)){if(I)return Qo(g,e,t);e.flags|=128}if(null!==(l=e.memoizedState)&&(l.rendering=null,l.tail=null,l.lastEffect=null),Wl(nn,nn.current),I)break;return null;case 22:case 23:return e.lanes=0,Wo(g,e,t)}return Lo(g,e,t)}(g,e,t);Go=0!==(131072&g.flags)}else Go=!1,IC&&0!==(1048576&e.flags)&&ql(e,Ll,e.index);switch(e.lanes=0,e.tag){case 2:var I=e.type;Uo(g,e),g=e.pendingProps;var l=kl(e,Rl.current);BC(e,t),l=Bn(null,e,I,g,l,t);var n=Sn();return e.flags|=1,"object"===typeof l&&null!==l&&"function"===typeof l.render&&void 0===l.$$typeof?(e.tag=1,e.memoizedState=null,e.updateQueue=null,fl(I)?(n=!0,Hl(e)):n=!1,e.memoizedState=null!==l.state&&void 0!==l.state?l.state:null,kC(e),l.updater=zC,e.stateNode=l,l._reactInternals=e,UC(e,I,g,t),e=Jo(null,e,I,!0,n,t)):(e.tag=0,IC&&n&&$l(e),po(null,e,l,t),e=e.child),e;case 16:I=e.elementType;g:{switch(Uo(g,e),g=e.pendingProps,I=(l=I._init)(I._payload),e.type=I,l=e.tag=function(g){if("function"===typeof g)return Yi(g)?1:0;if(void 0!==g&&null!==g){if((g=g.$$typeof)===X)return 11;if(g===f)return 14}return 2}(I),g=uC(I,g),l){case 0:e=Ro(null,e,I,g,t);break g;case 1:e=Xo(null,e,I,g,t);break g;case 11:e=yo(null,e,I,g,t);break g;case 14:e=Bo(null,e,I,uC(I.type,g),t);break g}throw Error(C(306,I,""))}return e;case 0:return I=e.type,l=e.pendingProps,Ro(g,e,I,l=e.elementType===I?l:uC(I,l),t);case 1:return I=e.type,l=e.pendingProps,Xo(g,e,I,l=e.elementType===I?l:uC(I,l),t);case 3:g:{if(ko(e),null===g)throw Error(C(387));I=e.pendingProps,l=(n=e.memoizedState).element,fC(g,e),NC(e,I,null,t);var o=e.memoizedState;if(I=o.element,n.isDehydrated){if(n={element:I,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=n,e.memoizedState=n,256&e.flags){e=fo(g,e,I,t,l=io(Error(C(423)),e));break g}if(I!==l){e=fo(g,e,I,t,l=io(Error(C(424)),e));break g}for(tC=al(e.stateNode.containerInfo.firstChild),eC=e,IC=!0,lC=null,t=OC(e,null,I,t),e.child=t;t;)t.flags=-3&t.flags|4096,t=t.sibling}else{if(dC(),I===l){e=Lo(g,e,t);break g}po(g,e,I,t)}e=e.child}return e;case 5:return ln(e),null===g&&aC(e),I=e.type,l=e.pendingProps,n=null!==g?g.memoizedProps:null,o=l.children,el(I,l)?o=null:null!==n&&el(I,n)&&(e.flags|=32),Vo(g,e),po(g,e,o,t),e.child;case 6:return null===g&&aC(e),null;case 13:return Fo(g,e,t);case 4:return tn(e,e.stateNode.containerInfo),I=e.pendingProps,null===g?e.child=PC(e,null,I,t):po(g,e,I,t),e.child;case 11:return I=e.type,l=e.pendingProps,yo(g,e,I,l=e.elementType===I?l:uC(I,l),t);case 7:return po(g,e,e.pendingProps,t),e.child;case 8:case 12:return po(g,e,e.pendingProps.children,t),e.child;case 10:g:{if(I=e.type._context,l=e.pendingProps,n=e.memoizedProps,o=l.value,Wl(mC,I._currentValue),I._currentValue=o,null!==n)if(nI(n.value,o)){if(n.children===l.children&&!Xl.current){e=Lo(g,e,t);break g}}else for(null!==(n=e.child)&&(n.return=e);null!==n;){var a=n.dependencies;if(null!==a){o=n.child;for(var i=a.firstContext;null!==i;){if(i.context===I){if(1===n.tag){(i=vC(-1,t&-t)).tag=2;var s=n.updateQueue;if(null!==s){var c=(s=s.shared).pending;null===c?i.next=i:(i.next=c.next,c.next=i),s.pending=i}}n.lanes|=t,null!==(i=n.alternate)&&(i.lanes|=t),yC(n.return,t,e),a.lanes|=t;break}i=i.next}}else if(10===n.tag)o=n.type===e.type?null:n.child;else if(18===n.tag){if(null===(o=n.return))throw Error(C(341));o.lanes|=t,null!==(a=o.alternate)&&(a.lanes|=t),yC(o,t,e),o=n.sibling}else o=n.child;if(null!==o)o.return=n;else for(o=n;null!==o;){if(o===e){o=null;break}if(null!==(n=o.sibling)){n.return=o.return,o=n;break}o=o.return}n=o}po(g,e,l.children,t),e=e.child}return e;case 9:return l=e.type,I=e.pendingProps.children,BC(e,t),I=I(l=SC(l)),e.flags|=1,po(g,e,I,t),e.child;case 14:return l=uC(I=e.type,e.pendingProps),Bo(g,e,I,l=uC(I.type,l),t);case 15:return So(g,e,e.type,e.pendingProps,t);case 17:return I=e.type,l=e.pendingProps,l=e.elementType===I?l:uC(I,l),Uo(g,e),e.tag=1,fl(I)?(g=!0,Hl(e)):g=!1,BC(e,t),EC(e,I,l),UC(e,I,l,t),Jo(null,e,I,!0,g,t);case 19:return Qo(g,e,t);case 22:return Wo(g,e,t)}throw Error(C(156,e.tag))};var Ti="function"===typeof reportError?reportError:function(g){console.error(g)};function Pi(g){this._internalRoot=g}function Oi(g){this._internalRoot=g}function _i(g){return!(!g||1!==g.nodeType&&9!==g.nodeType&&11!==g.nodeType)}function qi(g){return!(!g||1!==g.nodeType&&9!==g.nodeType&&11!==g.nodeType&&(8!==g.nodeType||" react-mount-point-unstable "!==g.nodeValue))}function $i(){}function gs(g,e,t,I,l){var C=t._reactRootContainer;if(C){var n=C;if("function"===typeof l){var o=l;l=function(){var g=Li(n);o.call(g)}}Ui(e,n,g,l)}else n=function(g,e,t,I,l){if(l){if("function"===typeof I){var C=I;I=function(){var g=Li(n);C.call(g)}}var n=Qi(e,I,g,0,null,!1,0,"",$i);return g._reactRootContainer=n,g[Al]=n.current,MI(8===g.nodeType?g.parentNode:g),ci(),n}for(;l=g.lastChild;)g.removeChild(l);if("function"===typeof I){var o=I;I=function(){var g=Li(a);o.call(g)}}var a=Mi(g,0,!1,null,0,!1,0,"",$i);return g._reactRootContainer=a,g[Al]=a.current,MI(8===g.nodeType?g.parentNode:g),ci((function(){Ui(e,a,t,I)})),a}(t,e,g,l,I);return Li(n)}Oi.prototype.render=Pi.prototype.render=function(g){var e=this._internalRoot;if(null===e)throw Error(C(409));Ui(g,e,null,null)},Oi.prototype.unmount=Pi.prototype.unmount=function(){var g=this._internalRoot;if(null!==g){this._internalRoot=null;var e=g.containerInfo;ci((function(){Ui(null,g,null,null)})),e[Al]=null}},Oi.prototype.unstable_scheduleHydration=function(g){if(g){var e=Se();g={blockedOn:null,target:g,priority:e};for(var t=0;t<Ye.length&&0!==e&&e<Ye[t].priority;t++);Ye.splice(t,0,g),0===t&&we(g)}},pe=function(g){switch(g.tag){case 3:var e=g.stateNode;if(e.current.memoizedState.isDehydrated){var t=ce(e.pendingLanes);0!==t&&(he(e,1|t),li(e,_g()),0===(6&Ja)&&(Qa=_g()+500,Ml()))}break;case 13:ci((function(){var e=XC(g,1);if(null!==e){var t=ei();Ii(e,g,1,t)}})),Di(g,1)}},ye=function(g){if(13===g.tag){var e=XC(g,134217728);if(null!==e)Ii(e,g,134217728,ei());Di(g,134217728)}},Be=function(g){if(13===g.tag){var e=ti(g),t=XC(g,e);if(null!==t)Ii(t,g,e,ei());Di(g,e)}},Se=function(){return Ze},We=function(g,e){var t=Ze;try{return Ze=g,e()}finally{Ze=t}},yg=function(g,e,t){switch(e){case"input":if(q(g,t),e=t.name,"radio"===t.type&&null!=e){for(t=g;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var I=t[e];if(I!==g&&I.form===g.form){var l=Gl(I);if(!l)throw Error(C(90));D(I),q(I,l)}}}break;case"textarea":Cg(g,t);break;case"select":null!=(e=t.value)&&tg(g,!!t.multiple,e,!1)}},Xg=si,Jg=ci;var es={usingClientEntryPoint:!1,Events:[hl,Zl,Gl,Vg,Rg,si]},ts={findFiberByHostInstance:bl,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Is={bundleType:ts.bundleType,version:ts.version,rendererPackageName:ts.rendererPackageName,rendererConfig:ts.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:G.ReactCurrentDispatcher,findHostInstanceByFiber:function(g){return null===(g=Lg(g))?null:g.stateNode},findFiberByHostInstance:ts.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ls=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ls.isDisabled&&ls.supportsFiber)try{le=ls.inject(Is),Ce=ls}catch(sg){}}e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=es,e.createPortal=function(g,e){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!_i(e))throw Error(C(200));return function(g,e,t){var I=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:y,key:null==I?null:""+I,children:g,containerInfo:e,implementation:t}}(g,e,null,t)},e.createRoot=function(g,e){if(!_i(g))throw Error(C(299));var t=!1,I="",l=Ti;return null!==e&&void 0!==e&&(!0===e.unstable_strictMode&&(t=!0),void 0!==e.identifierPrefix&&(I=e.identifierPrefix),void 0!==e.onRecoverableError&&(l=e.onRecoverableError)),e=Mi(g,1,!1,null,0,t,0,I,l),g[Al]=e.current,MI(8===g.nodeType?g.parentNode:g),new Pi(e)},e.findDOMNode=function(g){if(null==g)return null;if(1===g.nodeType)return g;var e=g._reactInternals;if(void 0===e){if("function"===typeof g.render)throw Error(C(188));throw g=Object.keys(g).join(","),Error(C(268,g))}return g=null===(g=Lg(e))?null:g.stateNode},e.flushSync=function(g){return ci(g)},e.hydrate=function(g,e,t){if(!qi(e))throw Error(C(200));return gs(null,g,e,!0,t)},e.hydrateRoot=function(g,e,t){if(!_i(g))throw Error(C(405));var I=null!=t&&t.hydratedSources||null,l=!1,n="",o=Ti;if(null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(l=!0),void 0!==t.identifierPrefix&&(n=t.identifierPrefix),void 0!==t.onRecoverableError&&(o=t.onRecoverableError)),e=Qi(e,null,g,1,null!=t?t:null,l,0,n,o),g[Al]=e.current,MI(g),I)for(g=0;g<I.length;g++)l=(l=(t=I[g])._getVersion)(t._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[t,l]:e.mutableSourceEagerHydrationData.push(t,l);return new Oi(e)},e.render=function(g,e,t){if(!qi(e))throw Error(C(200));return gs(null,g,e,!1,t)},e.unmountComponentAtNode=function(g){if(!qi(g))throw Error(C(40));return!!g._reactRootContainer&&(ci((function(){gs(null,null,g,!1,(function(){g._reactRootContainer=null,g[Al]=null}))})),!0)},e.unstable_batchedUpdates=si,e.unstable_renderSubtreeIntoContainer=function(g,e,t,I){if(!qi(t))throw Error(C(200));if(null==g||void 0===g._reactInternals)throw Error(C(38));return gs(g,e,t,!1,I)},e.version="18.2.0-next-9e3b772b8-20220608"},391:(g,e,t)=>{"use strict";var I=t(950);e.createRoot=I.createRoot,e.hydrateRoot=I.hydrateRoot},950:(g,e,t)=>{"use strict";!function g(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(g)}catch(e){console.error(e)}}(),g.exports=t(730)},309:function(g,e,t){g.exports=function(g){"use strict";function e(g){if(g&&g.__esModule)return g;var e=Object.create(null);return g&&Object.keys(g).forEach((function(t){if("default"!==t){var I=Object.getOwnPropertyDescriptor(g,t);Object.defineProperty(e,t,I.get?I:{enumerable:!0,get:function(){return g[t]}})}})),e.default=g,Object.freeze(e)}var t=e(g);function I(){return I=Object.assign?Object.assign.bind():function(g){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var I in t)Object.prototype.hasOwnProperty.call(t,I)&&(g[I]=t[I])}return g},I.apply(this,arguments)}function l(g,e,t){return e in g?Object.defineProperty(g,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):g[e]=t,g}function C(g){if(Array.isArray(g))return g}function n(g,e){var t=null==g?null:"undefined"!==typeof Symbol&&g[Symbol.iterator]||g["@@iterator"];if(null!=t){var I,l,C=[],n=!0,o=!1;try{for(t=t.call(g);!(n=(I=t.next()).done)&&(C.push(I.value),!e||C.length!==e);n=!0);}catch(a){o=!0,l=a}finally{try{n||null==t.return||t.return()}finally{if(o)throw l}}return C}}function o(g,e){(null==e||e>g.length)&&(e=g.length);for(var t=0,I=new Array(e);t<e;t++)I[t]=g[t];return I}function a(g,e){if(g){if("string"===typeof g)return o(g,e);var t=Object.prototype.toString.call(g).slice(8,-1);return"Object"===t&&g.constructor&&(t=g.constructor.name),"Map"===t||"Set"===t?Array.from(g):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?o(g,e):void 0}}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(g,e){return C(g)||n(g,e)||a(g,e)||i()}function c(g,e){if(null==g)return{};var t,I,l={},C=Object.keys(g);for(I=0;I<C.length;I++)t=C[I],e.indexOf(t)>=0||(l[t]=g[t]);return l}function d(g,e){if(null==g)return{};var t,I,l=c(g,e);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(g);for(I=0;I<C.length;I++)t=C[I],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(g,t)&&(l[t]=g[t])}return l}var A={exports:{}},r={exports:{}},u={},m="function"===typeof Symbol&&Symbol.for,b=m?Symbol.for("react.element"):60103,h=m?Symbol.for("react.portal"):60106,Z=m?Symbol.for("react.fragment"):60107,G=m?Symbol.for("react.strict_mode"):60108,p=m?Symbol.for("react.profiler"):60114,y=m?Symbol.for("react.provider"):60109,B=m?Symbol.for("react.context"):60110,S=m?Symbol.for("react.async_mode"):60111,W=m?Symbol.for("react.concurrent_mode"):60111,V=m?Symbol.for("react.forward_ref"):60112,R=m?Symbol.for("react.suspense"):60113,X=m?Symbol.for("react.suspense_list"):60120,J=m?Symbol.for("react.memo"):60115,k=m?Symbol.for("react.lazy"):60116,f=m?Symbol.for("react.block"):60121,v=m?Symbol.for("react.fundamental"):60117,Y=m?Symbol.for("react.responder"):60118,x=m?Symbol.for("react.scope"):60119;function H(g){if("object"===typeof g&&null!==g){var e=g.$$typeof;switch(e){case b:switch(g=g.type){case S:case W:case Z:case p:case G:case R:return g;default:switch(g=g&&g.$$typeof){case B:case V:case k:case J:case y:return g;default:return e}}case h:return e}}}function N(g){return H(g)===W}u.AsyncMode=S,u.ConcurrentMode=W,u.ContextConsumer=B,u.ContextProvider=y,u.Element=b,u.ForwardRef=V,u.Fragment=Z,u.Lazy=k,u.Memo=J,u.Portal=h,u.Profiler=p,u.StrictMode=G,u.Suspense=R,u.isAsyncMode=function(g){return N(g)||H(g)===S},u.isConcurrentMode=N,u.isContextConsumer=function(g){return H(g)===B},u.isContextProvider=function(g){return H(g)===y},u.isElement=function(g){return"object"===typeof g&&null!==g&&g.$$typeof===b},u.isForwardRef=function(g){return H(g)===V},u.isFragment=function(g){return H(g)===Z},u.isLazy=function(g){return H(g)===k},u.isMemo=function(g){return H(g)===J},u.isPortal=function(g){return H(g)===h},u.isProfiler=function(g){return H(g)===p},u.isStrictMode=function(g){return H(g)===G},u.isSuspense=function(g){return H(g)===R},u.isValidElementType=function(g){return"string"===typeof g||"function"===typeof g||g===Z||g===W||g===p||g===G||g===R||g===X||"object"===typeof g&&null!==g&&(g.$$typeof===k||g.$$typeof===J||g.$$typeof===y||g.$$typeof===B||g.$$typeof===V||g.$$typeof===v||g.$$typeof===Y||g.$$typeof===x||g.$$typeof===f)},u.typeOf=H,r.exports=u;Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;function w(){try{if(!Object.assign)return!1;var g=new String("abc");if(g[5]="de","5"===Object.getOwnPropertyNames(g)[0])return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;var I=Object.getOwnPropertyNames(e).map((function(g){return e[g]}));if("0123456789"!==I.join(""))return!1;var l={};return"abcdefghijklmnopqrst".split("").forEach((function(g){l[g]=g})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},l)).join("")}catch(C){return!1}}w()&&Object.assign;var F="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";function K(g,e,t,I,l){}Function.call.bind(Object.prototype.hasOwnProperty),K.resetWarningCache=function(){},r.exports;var z=F;function M(){}function E(){}E.resetWarningCache=M;var Q=function(){function g(g,e,t,I,l,C){if(C!==z){var n=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw n.name="Invariant Violation",n}}function e(){return g}g.isRequired=g;var t={array:g,bigint:g,bool:g,func:g,number:g,object:g,string:g,symbol:g,any:g,arrayOf:e,element:g,elementType:g,instanceOf:e,node:g,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:E,resetWarningCache:M};return t.PropTypes=t,t};A.exports=Q();var U=A.exports;function L(g,e){var t=atob(g);if(e){for(var I=new Uint8Array(t.length),l=0,C=t.length;l<C;++l)I[l]=t.charCodeAt(l);return String.fromCharCode.apply(null,new Uint16Array(I.buffer))}return t}function j(g,e,t){var I=void 0===e?null:e,l=L(g,void 0!==t&&t),C=l.indexOf("\n",10)+1,n=l.substring(C)+(I?"//# sourceMappingURL="+I:""),o=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(o)}function D(g,e,t){var I;return function(l){return I=I||j(g,e,t),new Worker(I,l)}}var T=D("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewoJJ3VzZSBzdHJpY3QnOwoKCXZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9OwoKCWZ1bmN0aW9uIGdldEF1Z21lbnRlZE5hbWVzcGFjZShuKSB7CgkJaWYgKG4uX19lc01vZHVsZSkgcmV0dXJuIG47CgkJdmFyIGEgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sICdfX2VzTW9kdWxlJywge3ZhbHVlOiB0cnVlfSk7CgkJT2JqZWN0LmtleXMobikuZm9yRWFjaChmdW5jdGlvbiAoaykgewoJCQl2YXIgZCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iobiwgayk7CgkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShhLCBrLCBkLmdldCA/IGQgOiB7CgkJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgkJCQkJcmV0dXJuIG5ba107CgkJCQl9CgkJCX0pOwoJCX0pOwoJCXJldHVybiBhOwoJfQoKCXZhciBCaW5hcnlCaXRtYXAkMSA9IHt9OwoKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBFeGNlcHRpb24kMSA9IHt9OwoKCWZ1bmN0aW9uIGZpeFByb3RvKHRhcmdldCwgcHJvdG90eXBlKSB7CgkgIHZhciBzZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZjsKCSAgc2V0UHJvdG90eXBlT2YgPyBzZXRQcm90b3R5cGVPZih0YXJnZXQsIHByb3RvdHlwZSkgOiB0YXJnZXQuX19wcm90b19fID0gcHJvdG90eXBlOwoJfQoJZnVuY3Rpb24gZml4U3RhY2sodGFyZ2V0LCBmbikgewoJICBpZiAoZm4gPT09IHZvaWQgMCkgewoJICAgIGZuID0gdGFyZ2V0LmNvbnN0cnVjdG9yOwoJICB9CgoJICB2YXIgY2FwdHVyZVN0YWNrVHJhY2UgPSBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZTsKCSAgY2FwdHVyZVN0YWNrVHJhY2UgJiYgY2FwdHVyZVN0YWNrVHJhY2UodGFyZ2V0LCBmbik7Cgl9CgoJdmFyIF9fZXh0ZW5kcyRrID0gZnVuY3Rpb24gKCkgewoJICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCB7CgkgICAgICBfX3Byb3RvX186IFtdCgkgICAgfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICBkLl9fcHJvdG9fXyA9IGI7CgkgICAgfSB8fCBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgZm9yICh2YXIgcCBpbiBiKSB7IGlmIChiLmhhc093blByb3BlcnR5KHApKSB7IGRbcF0gPSBiW3BdOyB9IH0KCSAgICB9OwoKCSAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgfTsKCgkgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgoJICAgIGZ1bmN0aW9uIF9fKCkgewoJICAgICAgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7CgkgICAgfQoKCSAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgIH07Cgl9KCk7CgoJdmFyIEN1c3RvbUVycm9yID0gZnVuY3Rpb24gKF9zdXBlcikgewoJICBfX2V4dGVuZHMkayhDdXN0b21FcnJvciwgX3N1cGVyKTsKCgkgIGZ1bmN0aW9uIEN1c3RvbUVycm9yKG1lc3NhZ2UpIHsKCSAgICB2YXIgX25ld1RhcmdldCA9IHRoaXMuY29uc3RydWN0b3I7CgoJICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIG1lc3NhZ2UpIHx8IHRoaXM7CgoJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShfdGhpcywgJ25hbWUnLCB7CgkgICAgICB2YWx1ZTogX25ld1RhcmdldC5uYW1lLAoJICAgICAgZW51bWVyYWJsZTogZmFsc2UsCgkgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICB9KTsKCSAgICBmaXhQcm90byhfdGhpcywgX25ld1RhcmdldC5wcm90b3R5cGUpOwoJICAgIGZpeFN0YWNrKF90aGlzKTsKCSAgICByZXR1cm4gX3RoaXM7CgkgIH0KCgkgIHJldHVybiBDdXN0b21FcnJvcjsKCX0oRXJyb3IpOwoKCXZhciBfX3NwcmVhZEFycmF5cyA9IGZ1bmN0aW9uICgpIHsKCSAgdmFyIGFyZ3VtZW50cyQxID0gYXJndW1lbnRzOwoKCSAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7IHMgKz0gYXJndW1lbnRzJDFbaV0ubGVuZ3RoOyB9CgoJICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspIHsgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspIHsgcltrXSA9IGFbal07IH0gfQoKCSAgcmV0dXJuIHI7Cgl9OwoJZnVuY3Rpb24gY3VzdG9tRXJyb3JGYWN0b3J5KGZuLCBwYXJlbnQpIHsKCSAgaWYgKHBhcmVudCA9PT0gdm9pZCAwKSB7CgkgICAgcGFyZW50ID0gRXJyb3I7CgkgIH0KCgkgIGZ1bmN0aW9uIEN1c3RvbUVycm9yKCkgewoJICAgIHZhciBhcmd1bWVudHMkMSA9IGFyZ3VtZW50czsKCgkgICAgdmFyIGFyZ3MgPSBbXTsKCgkgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzJDFbX2ldOwoJICAgIH0KCgkgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIEN1c3RvbUVycm9yKSkgeyByZXR1cm4gbmV3IChDdXN0b21FcnJvci5iaW5kLmFwcGx5KEN1c3RvbUVycm9yLCBfX3NwcmVhZEFycmF5cyhbdm9pZCAwXSwgYXJncykpKSgpOyB9CgkgICAgcGFyZW50LmFwcGx5KHRoaXMsIGFyZ3MpOwoJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnbmFtZScsIHsKCSAgICAgIHZhbHVlOiBmbi5uYW1lIHx8IHBhcmVudC5uYW1lLAoJICAgICAgZW51bWVyYWJsZTogZmFsc2UsCgkgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICB9KTsKCSAgICBmbi5hcHBseSh0aGlzLCBhcmdzKTsKCSAgICBmaXhTdGFjayh0aGlzLCBDdXN0b21FcnJvcik7CgkgIH0KCgkgIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhDdXN0b21FcnJvciwgewoJICAgIHByb3RvdHlwZTogewoJICAgICAgdmFsdWU6IE9iamVjdC5jcmVhdGUocGFyZW50LnByb3RvdHlwZSwgewoJICAgICAgICBjb25zdHJ1Y3RvcjogewoJICAgICAgICAgIHZhbHVlOiBDdXN0b21FcnJvciwKCSAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKCSAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICAgICAgfQoJICAgICAgfSkKCSAgICB9CgkgIH0pOwoJfQoKCXZhciBjdXN0b21FcnJvciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKCQlfX3Byb3RvX186IG51bGwsCgkJQ3VzdG9tRXJyb3I6IEN1c3RvbUVycm9yLAoJCWN1c3RvbUVycm9yRmFjdG9yeTogY3VzdG9tRXJyb3JGYWN0b3J5Cgl9KTsKCgl2YXIgcmVxdWlyZSQkMCA9IC8qQF9fUFVSRV9fKi9nZXRBdWdtZW50ZWROYW1lc3BhY2UoY3VzdG9tRXJyb3IpOwoKCXZhciBfX2V4dGVuZHMkaiA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIHRzX2N1c3RvbV9lcnJvcl8xID0gcmVxdWlyZSQkMDsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyRqKEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICAvKioKCSAgICAgKiBBbGxvd3MgRXhjZXB0aW9uIHRvIGJlIGNvbnN0cnVjdGVkIGRpcmVjdGx5CgkgICAgICogd2l0aCBzb21lIG1lc3NhZ2UgYW5kIHByb3RvdHlwZSBkZWZpbml0aW9uLgoJICAgICAqLwoJICAgIGZ1bmN0aW9uIEV4Y2VwdGlvbihtZXNzYWdlKSB7CgkgICAgICAgIGlmIChtZXNzYWdlID09PSB2b2lkIDApIHsgbWVzc2FnZSA9IHVuZGVmaW5lZDsgfQoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBFeGNlcHRpb24ucHJvdG90eXBlLmdldEtpbmQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBleCA9IHRoaXMuY29uc3RydWN0b3I7CgkgICAgICAgIHJldHVybiBleC5raW5kOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogSXQncyB0eXBlZCBhcyBzdHJpbmcgc28gaXQgY2FuIGJlIGV4dGVuZGVkIGFuZCBvdmVycmlkZW4uCgkgICAgICovCgkgICAgRXhjZXB0aW9uLmtpbmQgPSAnRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gRXhjZXB0aW9uOwoJfSh0c19jdXN0b21fZXJyb3JfMS5DdXN0b21FcnJvcikpOwoJRXhjZXB0aW9uJDEuZGVmYXVsdCA9IEV4Y2VwdGlvbjsKCgl2YXIgX19leHRlbmRzJGkgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBFeGNlcHRpb25fMSQ5ID0gRXhjZXB0aW9uJDE7CgkvKioKCSAqIEN1c3RvbSBFcnJvciBjbGFzcyBvZiB0eXBlIEV4Y2VwdGlvbi4KCSAqLwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkaShJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCkgewoJICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7CgkgICAgfQoJICAgIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5raW5kID0gJ0lsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbic7CgkgICAgcmV0dXJuIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbjsKCX0oRXhjZXB0aW9uXzEkOS5kZWZhdWx0KSk7CglJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMS5kZWZhdWx0ID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmluYXJ5Qml0bWFwJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSRhID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7Cgl2YXIgQmluYXJ5Qml0bWFwID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEJpbmFyeUJpdG1hcChiaW5hcml6ZXIpIHsKCSAgICAgICAgdGhpcy5iaW5hcml6ZXIgPSBiaW5hcml6ZXI7CgkgICAgICAgIGlmIChiaW5hcml6ZXIgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSRhLmRlZmF1bHQoJ0JpbmFyaXplciBtdXN0IGJlIG5vbi1udWxsLicpOwoJICAgICAgICB9CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gVGhlIHdpZHRoIG9mIHRoZSBiaXRtYXAuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldFdpZHRoKCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSBoZWlnaHQgb2YgdGhlIGJpdG1hcC4KCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldEhlaWdodCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29udmVydHMgb25lIHJvdyBvZiBsdW1pbmFuY2UgZGF0YSB0byAxIGJpdCBkYXRhLiBNYXkgYWN0dWFsbHkgZG8gdGhlIGNvbnZlcnNpb24sIG9yIHJldHVybgoJICAgICAqIGNhY2hlZCBkYXRhLiBDYWxsZXJzIHNob3VsZCBhc3N1bWUgdGhpcyBtZXRob2QgaXMgZXhwZW5zaXZlIGFuZCBjYWxsIGl0IGFzIHNlbGRvbSBhcyBwb3NzaWJsZS4KCSAgICAgKiBUaGlzIG1ldGhvZCBpcyBpbnRlbmRlZCBmb3IgZGVjb2RpbmcgMUQgYmFyY29kZXMgYW5kIG1heSBjaG9vc2UgdG8gYXBwbHkgc2hhcnBlbmluZy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB5IFRoZSByb3cgdG8gZmV0Y2gsIHdoaWNoIG11c3QgYmUgaW4gWzAsIGJpdG1hcCBoZWlnaHQpCgkgICAgICogQHBhcmFtIHJvdyBBbiBvcHRpb25hbCBwcmVhbGxvY2F0ZWQgYXJyYXkuIElmIG51bGwgb3IgdG9vIHNtYWxsLCBpdCB3aWxsIGJlIGlnbm9yZWQuCgkgICAgICogICAgICAgICAgICBJZiB1c2VkLCB0aGUgQmluYXJpemVyIHdpbGwgY2FsbCBCaXRBcnJheS5jbGVhcigpLiBBbHdheXMgdXNlIHRoZSByZXR1cm5lZCBvYmplY3QuCgkgICAgICogQHJldHVybiBUaGUgYXJyYXkgb2YgYml0cyBmb3IgdGhpcyByb3cgKHRydWUgbWVhbnMgYmxhY2spLgoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgcm93IGNhbid0IGJlIGJpbmFyaXplZAoJICAgICAqLwoJICAgIEJpbmFyeUJpdG1hcC5wcm90b3R5cGUuZ2V0QmxhY2tSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldEJsYWNrUm93KHksIHJvdyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDb252ZXJ0cyBhIDJEIGFycmF5IG9mIGx1bWluYW5jZSBkYXRhIHRvIDEgYml0LiBBcyBhYm92ZSwgYXNzdW1lIHRoaXMgbWV0aG9kIGlzIGV4cGVuc2l2ZQoJICAgICAqIGFuZCBkbyBub3QgY2FsbCBpdCByZXBlYXRlZGx5LiBUaGlzIG1ldGhvZCBpcyBpbnRlbmRlZCBmb3IgZGVjb2RpbmcgMkQgYmFyY29kZXMgYW5kIG1heSBvcgoJICAgICAqIG1heSBub3QgYXBwbHkgc2hhcnBlbmluZy4gVGhlcmVmb3JlLCBhIHJvdyBmcm9tIHRoaXMgbWF0cml4IG1heSBub3QgYmUgaWRlbnRpY2FsIHRvIG9uZQoJICAgICAqIGZldGNoZWQgdXNpbmcgZ2V0QmxhY2tSb3coKSwgc28gZG9uJ3QgbWl4IGFuZCBtYXRjaCBiZXR3ZWVuIHRoZW0uCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIFRoZSAyRCBhcnJheSBvZiBiaXRzIGZvciB0aGUgaW1hZ2UgKHRydWUgbWVhbnMgYmxhY2spLgoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgaW1hZ2UgY2FuJ3QgYmUgYmluYXJpemVkIHRvIG1ha2UgYSBtYXRyaXgKCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmdldEJsYWNrTWF0cml4ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBUaGUgbWF0cml4IGlzIGNyZWF0ZWQgb24gZGVtYW5kIHRoZSBmaXJzdCB0aW1lIGl0IGlzIHJlcXVlc3RlZCwgdGhlbiBjYWNoZWQuIFRoZXJlIGFyZSB0d28KCSAgICAgICAgLy8gcmVhc29ucyBmb3IgdGhpczoKCSAgICAgICAgLy8gMS4gVGhpcyB3b3JrIHdpbGwgbmV2ZXIgYmUgZG9uZSBpZiB0aGUgY2FsbGVyIG9ubHkgaW5zdGFsbHMgMUQgUmVhZGVyIG9iamVjdHMsIG9yIGlmIGEKCSAgICAgICAgLy8gICAgMUQgUmVhZGVyIGZpbmRzIGEgYmFyY29kZSBiZWZvcmUgdGhlIDJEIFJlYWRlcnMgcnVuLgoJICAgICAgICAvLyAyLiBUaGlzIHdvcmsgd2lsbCBvbmx5IGJlIGRvbmUgb25jZSBldmVuIGlmIHRoZSBjYWxsZXIgaW5zdGFsbHMgbXVsdGlwbGUgMkQgUmVhZGVycy4KCSAgICAgICAgaWYgKHRoaXMubWF0cml4ID09PSBudWxsIHx8IHRoaXMubWF0cml4ID09PSB1bmRlZmluZWQpIHsKCSAgICAgICAgICAgIHRoaXMubWF0cml4ID0gdGhpcy5iaW5hcml6ZXIuZ2V0QmxhY2tNYXRyaXgoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5tYXRyaXg7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFdoZXRoZXIgdGhpcyBiaXRtYXAgY2FuIGJlIGNyb3BwZWQuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5pc0Nyb3BTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmJpbmFyaXplci5nZXRMdW1pbmFuY2VTb3VyY2UoKS5pc0Nyb3BTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggY3JvcHBlZCBpbWFnZSBkYXRhLiBJbXBsZW1lbnRhdGlvbnMgbWF5IGtlZXAgYSByZWZlcmVuY2UgdG8gdGhlCgkgICAgICogb3JpZ2luYWwgZGF0YSByYXRoZXIgdGhhbiBhIGNvcHkuIE9ubHkgY2FsbGFibGUgaWYgaXNDcm9wU3VwcG9ydGVkKCkgaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBsZWZ0IFRoZSBsZWZ0IGNvb3JkaW5hdGUsIHdoaWNoIG11c3QgYmUgaW4gWzAsZ2V0V2lkdGgoKSkKCSAgICAgKiBAcGFyYW0gdG9wIFRoZSB0b3AgY29vcmRpbmF0ZSwgd2hpY2ggbXVzdCBiZSBpbiBbMCxnZXRIZWlnaHQoKSkKCSAgICAgKiBAcGFyYW0gd2lkdGggVGhlIHdpZHRoIG9mIHRoZSByZWN0YW5nbGUgdG8gY3JvcC4KCSAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIHJlY3RhbmdsZSB0byBjcm9wLgoJICAgICAqIEByZXR1cm4gQSBjcm9wcGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5jcm9wID0gZnVuY3Rpb24gKGxlZnQgLyppbnQqLywgdG9wIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHZhciBuZXdTb3VyY2UgPSB0aGlzLmJpbmFyaXplci5nZXRMdW1pbmFuY2VTb3VyY2UoKS5jcm9wKGxlZnQsIHRvcCwgd2lkdGgsIGhlaWdodCk7CgkgICAgICAgIHJldHVybiBuZXcgQmluYXJ5Qml0bWFwKHRoaXMuYmluYXJpemVyLmNyZWF0ZUJpbmFyaXplcihuZXdTb3VyY2UpKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIGJpdG1hcCBzdXBwb3J0cyBjb3VudGVyLWNsb2Nrd2lzZSByb3RhdGlvbi4KCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmlzUm90YXRlU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkuaXNSb3RhdGVTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggcm90YXRlZCBpbWFnZSBkYXRhIGJ5IDkwIGRlZ3JlZXMgY291bnRlcmNsb2Nrd2lzZS4KCSAgICAgKiBPbmx5IGNhbGxhYmxlIGlmIHtAbGluayAjaXNSb3RhdGVTdXBwb3J0ZWQoKX0gaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gQSByb3RhdGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3U291cmNlID0gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkucm90YXRlQ291bnRlckNsb2Nrd2lzZSgpOwoJICAgICAgICByZXR1cm4gbmV3IEJpbmFyeUJpdG1hcCh0aGlzLmJpbmFyaXplci5jcmVhdGVCaW5hcml6ZXIobmV3U291cmNlKSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIGEgbmV3IG9iamVjdCB3aXRoIHJvdGF0ZWQgaW1hZ2UgZGF0YSBieSA0NSBkZWdyZWVzIGNvdW50ZXJjbG9ja3dpc2UuCgkgICAgICogT25seSBjYWxsYWJsZSBpZiB7QGxpbmsgI2lzUm90YXRlU3VwcG9ydGVkKCl9IGlzIHRydWUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIEEgcm90YXRlZCB2ZXJzaW9uIG9mIHRoaXMgb2JqZWN0LgoJICAgICAqLwoJICAgIEJpbmFyeUJpdG1hcC5wcm90b3R5cGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3U291cmNlID0gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1KCk7CgkgICAgICAgIHJldHVybiBuZXcgQmluYXJ5Qml0bWFwKHRoaXMuYmluYXJpemVyLmNyZWF0ZUJpbmFyaXplcihuZXdTb3VyY2UpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QmxhY2tNYXRyaXgoKS50b1N0cmluZygpOwoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlIC8qOiBOb3RGb3VuZEV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICByZXR1cm4gJyc7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHJldHVybiBCaW5hcnlCaXRtYXA7Cgl9KCkpOwoJdmFyIF9kZWZhdWx0JDMgPSBCaW5hcnlCaXRtYXAkMS5kZWZhdWx0ID0gQmluYXJ5Qml0bWFwOwoKCXZhciBIeWJyaWRCaW5hcml6ZXIkMSA9IHt9OwoKCXZhciBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMSA9IHt9OwoKCXZhciBCaW5hcml6ZXIkMSA9IHt9OwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmluYXJpemVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogVGhpcyBjbGFzcyBoaWVyYXJjaHkgcHJvdmlkZXMgYSBzZXQgb2YgbWV0aG9kcyB0byBjb252ZXJ0IGx1bWluYW5jZSBkYXRhIHRvIDEgYml0IGRhdGEuCgkgKiBJdCBhbGxvd3MgdGhlIGFsZ29yaXRobSB0byB2YXJ5IHBvbHltb3JwaGljYWxseSwgZm9yIGV4YW1wbGUgYWxsb3dpbmcgYSB2ZXJ5IGV4cGVuc2l2ZQoJICogdGhyZXNob2xkaW5nIHRlY2huaXF1ZSBmb3Igc2VydmVycyBhbmQgYSBmYXN0IG9uZSBmb3IgbW9iaWxlLiBJdCBhbHNvIHBlcm1pdHMgdGhlIGltcGxlbWVudGF0aW9uCgkgKiB0byB2YXJ5LCBlLmcuIGEgSk5JIHZlcnNpb24gZm9yIEFuZHJvaWQgYW5kIGEgSmF2YSBmYWxsYmFjayB2ZXJzaW9uIGZvciBvdGhlciBwbGF0Zm9ybXMuCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqLwoJdmFyIEJpbmFyaXplciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBCaW5hcml6ZXIoc291cmNlKSB7CgkgICAgICAgIHRoaXMuc291cmNlID0gc291cmNlOwoJICAgIH0KCSAgICBCaW5hcml6ZXIucHJvdG90eXBlLmdldEx1bWluYW5jZVNvdXJjZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlOwoJICAgIH07CgkgICAgQmluYXJpemVyLnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlLmdldFdpZHRoKCk7CgkgICAgfTsKCSAgICBCaW5hcml6ZXIucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlLmdldEhlaWdodCgpOwoJICAgIH07CgkgICAgcmV0dXJuIEJpbmFyaXplcjsKCX0oKSk7CglCaW5hcml6ZXIkMS5kZWZhdWx0ID0gQmluYXJpemVyOwoKCXZhciBCaXRBcnJheSQxID0ge307CgoJdmFyIEFycmF5cyQxID0ge307CgoJdmFyIFN5c3RlbSQxID0ge307CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN5c3RlbSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3lzdGVtID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIFN5c3RlbSgpIHsKCSAgICB9CgkgICAgLy8gcHVibGljIHN0YXRpYyB2b2lkIGFycmF5Y29weShPYmplY3Qgc3JjLCBpbnQgc3JjUG9zLCBPYmplY3QgZGVzdCwgaW50IGRlc3RQb3MsIGludCBsZW5ndGgpCgkgICAgLyoqCgkgICAgICogTWFrZXMgYSBjb3B5IG9mIGEgYXJyYXkuCgkgICAgICovCgkgICAgU3lzdGVtLmFycmF5Y29weSA9IGZ1bmN0aW9uIChzcmMsIHNyY1BvcywgZGVzdCwgZGVzdFBvcywgbGVuZ3RoKSB7CgkgICAgICAgIC8vIFRPRE86IGJldHRlciB1c2Ugc3BsaXQgb3Igc2V0PwoJICAgICAgICB3aGlsZSAobGVuZ3RoLS0pIHsKCSAgICAgICAgICAgIGRlc3RbZGVzdFBvcysrXSA9IHNyY1tzcmNQb3MrK107CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIGN1cnJlbnQgdGltZSBpbiBtaWxsaXNlY29uZHMuCgkgICAgICovCgkgICAgU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gRGF0ZS5ub3coKTsKCSAgICB9OwoJICAgIHJldHVybiBTeXN0ZW07Cgl9KCkpOwoJU3lzdGVtJDEuZGVmYXVsdCA9IFN5c3RlbTsKCgl2YXIgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiQxID0ge307CgoJdmFyIF9fZXh0ZW5kcyRoID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDggPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkaChJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbi5raW5kID0gJ0luZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24nOwoJICAgIHJldHVybiBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQ4LmRlZmF1bHQpKTsKCUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMS5kZWZhdWx0ID0gSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbjsKCgl2YXIgX19leHRlbmRzJGcgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uXzEgPSBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDE7CgkvKioKCSAqIEN1c3RvbSBFcnJvciBjbGFzcyBvZiB0eXBlIEV4Y2VwdGlvbi4KCSAqLwoJdmFyIEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZyhBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uKGluZGV4LCBtZXNzYWdlKSB7CgkgICAgICAgIGlmIChpbmRleCA9PT0gdm9pZCAwKSB7IGluZGV4ID0gdW5kZWZpbmVkOyB9CgkgICAgICAgIGlmIChtZXNzYWdlID09PSB2b2lkIDApIHsgbWVzc2FnZSA9IHVuZGVmaW5lZDsgfQoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5pbmRleCA9IGluZGV4OwoJICAgICAgICBfdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24ua2luZCA9ICdBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24nOwoJICAgIHJldHVybiBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb247Cgl9KEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMS5kZWZhdWx0KSk7CglBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMS5kZWZhdWx0ID0gQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uOwoKCXZhciBfX3ZhbHVlcyQ3ID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFycmF5cyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3lzdGVtXzEkNSA9IFN5c3RlbSQxOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDkgPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMSA9IEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiQxOwoJdmFyIEFycmF5cyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBBcnJheXMoKSB7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEFzc2lnbnMgdGhlIHNwZWNpZmllZCBpbnQgdmFsdWUgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBzcGVjaWZpZWQgYXJyYXkKCSAgICAgKiBvZiBpbnRzLgoJICAgICAqCgkgICAgICogQHBhcmFtIGEgdGhlIGFycmF5IHRvIGJlIGZpbGxlZAoJICAgICAqIEBwYXJhbSB2YWwgdGhlIHZhbHVlIHRvIGJlIHN0b3JlZCBpbiBhbGwgZWxlbWVudHMgb2YgdGhlIGFycmF5CgkgICAgICovCgkgICAgQXJyYXlzLmZpbGwgPSBmdW5jdGlvbiAoYSwgdmFsKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBhLmxlbmd0aDsgaSA8IGxlbjsgaSsrKQoJICAgICAgICAgICAgYVtpXSA9IHZhbDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEFzc2lnbnMgdGhlIHNwZWNpZmllZCBpbnQgdmFsdWUgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBzcGVjaWZpZWQKCSAgICAgKiByYW5nZSBvZiB0aGUgc3BlY2lmaWVkIGFycmF5IG9mIGludHMuICBUaGUgcmFuZ2UgdG8gYmUgZmlsbGVkCgkgICAgICogZXh0ZW5kcyBmcm9tIGluZGV4IHtAY29kZSBmcm9tSW5kZXh9LCBpbmNsdXNpdmUsIHRvIGluZGV4CgkgICAgICoge0Bjb2RlIHRvSW5kZXh9LCBleGNsdXNpdmUuICAoSWYge0Bjb2RlIGZyb21JbmRleD09dG9JbmRleH0sIHRoZQoJICAgICAqIHJhbmdlIHRvIGJlIGZpbGxlZCBpcyBlbXB0eS4pCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYSB0aGUgYXJyYXkgdG8gYmUgZmlsbGVkCgkgICAgICogQHBhcmFtIGZyb21JbmRleCB0aGUgaW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgKGluY2x1c2l2ZSkgdG8gYmUKCSAgICAgKiAgICAgICAgZmlsbGVkIHdpdGggdGhlIHNwZWNpZmllZCB2YWx1ZQoJICAgICAqIEBwYXJhbSB0b0luZGV4IHRoZSBpbmRleCBvZiB0aGUgbGFzdCBlbGVtZW50IChleGNsdXNpdmUpIHRvIGJlCgkgICAgICogICAgICAgIGZpbGxlZCB3aXRoIHRoZSBzcGVjaWZpZWQgdmFsdWUKCSAgICAgKiBAcGFyYW0gdmFsIHRoZSB2YWx1ZSB0byBiZSBzdG9yZWQgaW4gYWxsIGVsZW1lbnRzIG9mIHRoZSBhcnJheQoJICAgICAqIEB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlmIHtAY29kZSBmcm9tSW5kZXggPiB0b0luZGV4fQoJICAgICAqIEB0aHJvd3MgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uIGlmIHtAY29kZSBmcm9tSW5kZXggPCAwfSBvcgoJICAgICAqICAgICAgICAge0Bjb2RlIHRvSW5kZXggPiBhLmxlbmd0aH0KCSAgICAgKi8KCSAgICBBcnJheXMuZmlsbFdpdGhpbiA9IGZ1bmN0aW9uIChhLCBmcm9tSW5kZXgsIHRvSW5kZXgsIHZhbCkgewoJICAgICAgICBBcnJheXMucmFuZ2VDaGVjayhhLmxlbmd0aCwgZnJvbUluZGV4LCB0b0luZGV4KTsKCSAgICAgICAgZm9yICh2YXIgaSA9IGZyb21JbmRleDsgaSA8IHRvSW5kZXg7IGkrKykKCSAgICAgICAgICAgIGFbaV0gPSB2YWw7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDaGVja3MgdGhhdCB7QGNvZGUgZnJvbUluZGV4fSBhbmQge0Bjb2RlIHRvSW5kZXh9IGFyZSBpbgoJICAgICAqIHRoZSByYW5nZSBhbmQgdGhyb3dzIGFuIGV4Y2VwdGlvbiBpZiB0aGV5IGFyZW4ndC4KCSAgICAgKi8KCSAgICBBcnJheXMucmFuZ2VDaGVjayA9IGZ1bmN0aW9uIChhcnJheUxlbmd0aCwgZnJvbUluZGV4LCB0b0luZGV4KSB7CgkgICAgICAgIGlmIChmcm9tSW5kZXggPiB0b0luZGV4KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkOS5kZWZhdWx0KCdmcm9tSW5kZXgoJyArIGZyb21JbmRleCArICcpID4gdG9JbmRleCgnICsgdG9JbmRleCArICcpJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGZyb21JbmRleCA8IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMS5kZWZhdWx0KGZyb21JbmRleCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRvSW5kZXggPiBhcnJheUxlbmd0aCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbl8xLmRlZmF1bHQodG9JbmRleCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIEFycmF5cy5hc0xpc3QgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBhcmdzID0gW107CgkgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7CgkgICAgICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGFyZ3M7CgkgICAgfTsKCSAgICBBcnJheXMuY3JlYXRlID0gZnVuY3Rpb24gKHJvd3MsIGNvbHMsIHZhbHVlKSB7CgkgICAgICAgIHZhciBhcnIgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiByb3dzIH0pOwoJICAgICAgICByZXR1cm4gYXJyLm1hcChmdW5jdGlvbiAoeCkgeyByZXR1cm4gQXJyYXkuZnJvbSh7IGxlbmd0aDogY29scyB9KS5maWxsKHZhbHVlKTsgfSk7CgkgICAgfTsKCSAgICBBcnJheXMuY3JlYXRlSW50MzJBcnJheSA9IGZ1bmN0aW9uIChyb3dzLCBjb2xzLCB2YWx1ZSkgewoJICAgICAgICB2YXIgYXJyID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogcm93cyB9KTsKCSAgICAgICAgcmV0dXJuIGFyci5tYXAoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIEludDMyQXJyYXkuZnJvbSh7IGxlbmd0aDogY29scyB9KS5maWxsKHZhbHVlKTsgfSk7CgkgICAgfTsKCSAgICBBcnJheXMuZXF1YWxzID0gZnVuY3Rpb24gKGZpcnN0LCBzZWNvbmQpIHsKCSAgICAgICAgaWYgKCFmaXJzdCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIGlmICghc2Vjb25kKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKCFmaXJzdC5sZW5ndGgpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoIXNlY29uZC5sZW5ndGgpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZmlyc3QubGVuZ3RoICE9PSBzZWNvbmQubGVuZ3RoKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gZmlyc3QubGVuZ3RoOyBpIDwgbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgaWYgKGZpcnN0W2ldICE9PSBzZWNvbmRbaV0pIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICBBcnJheXMuaGFzaENvZGUgPSBmdW5jdGlvbiAoYSkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgaWYgKGEgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiAwOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSAxOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgYV8xID0gX192YWx1ZXMkNyhhKSwgYV8xXzEgPSBhXzEubmV4dCgpOyAhYV8xXzEuZG9uZTsgYV8xXzEgPSBhXzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBhXzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSAzMSAqIHJlc3VsdCArIGVsZW1lbnQ7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChhXzFfMSAmJiAhYV8xXzEuZG9uZSAmJiAoX2EgPSBhXzEucmV0dXJuKSkgX2EuY2FsbChhXzEpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZmluYWxseSB7IGlmIChlXzEpIHRocm93IGVfMS5lcnJvcjsgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCSAgICBBcnJheXMuZmlsbFVpbnQ4QXJyYXkgPSBmdW5jdGlvbiAoYSwgdmFsdWUpIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgIT09IGEubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIGFbaV0gPSB2YWx1ZTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgQXJyYXlzLmNvcHlPZiA9IGZ1bmN0aW9uIChvcmlnaW5hbCwgbmV3TGVuZ3RoKSB7CgkgICAgICAgIHJldHVybiBvcmlnaW5hbC5zbGljZSgwLCBuZXdMZW5ndGgpOwoJICAgIH07CgkgICAgQXJyYXlzLmNvcHlPZlVpbnQ4QXJyYXkgPSBmdW5jdGlvbiAob3JpZ2luYWwsIG5ld0xlbmd0aCkgewoJICAgICAgICBpZiAob3JpZ2luYWwubGVuZ3RoIDw9IG5ld0xlbmd0aCkgewoJICAgICAgICAgICAgdmFyIG5ld0FycmF5ID0gbmV3IFVpbnQ4QXJyYXkobmV3TGVuZ3RoKTsKCSAgICAgICAgICAgIG5ld0FycmF5LnNldChvcmlnaW5hbCk7CgkgICAgICAgICAgICByZXR1cm4gbmV3QXJyYXk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG9yaWdpbmFsLnNsaWNlKDAsIG5ld0xlbmd0aCk7CgkgICAgfTsKCSAgICBBcnJheXMuY29weU9mUmFuZ2UgPSBmdW5jdGlvbiAob3JpZ2luYWwsIGZyb20sIHRvKSB7CgkgICAgICAgIHZhciBuZXdMZW5ndGggPSB0byAtIGZyb207CgkgICAgICAgIHZhciBjb3B5ID0gbmV3IEludDMyQXJyYXkobmV3TGVuZ3RoKTsKCSAgICAgICAgU3lzdGVtXzEkNS5kZWZhdWx0LmFycmF5Y29weShvcmlnaW5hbCwgZnJvbSwgY29weSwgMCwgbmV3TGVuZ3RoKTsKCSAgICAgICAgcmV0dXJuIGNvcHk7CgkgICAgfTsKCSAgICAvKgoJICAgICogUmV0dXJucyB0aGUgaW5kZXggb2Ygb2YgdGhlIGVsZW1lbnQgaW4gYSBzb3J0ZWQgYXJyYXkgb3IgKC1uLTEpIHdoZXJlIG4gaXMgdGhlIGluc2VydGlvbiBwb2ludAoJICAgICogZm9yIHRoZSBuZXcgZWxlbWVudC4KCSAgICAqIFBhcmFtZXRlcnM6CgkgICAgKiAgICAgYXIgLSBBIHNvcnRlZCBhcnJheQoJICAgICogICAgIGVsIC0gQW4gZWxlbWVudCB0byBzZWFyY2ggZm9yCgkgICAgKiAgICAgY29tcGFyYXRvciAtIEEgY29tcGFyYXRvciBmdW5jdGlvbi4gVGhlIGZ1bmN0aW9uIHRha2VzIHR3byBhcmd1bWVudHM6IChhLCBiKSBhbmQgcmV0dXJuczoKCSAgICAqICAgICAgICBhIG5lZ2F0aXZlIG51bWJlciAgaWYgYSBpcyBsZXNzIHRoYW4gYjsKCSAgICAqICAgICAgICAwIGlmIGEgaXMgZXF1YWwgdG8gYjsKCSAgICAqICAgICAgICBhIHBvc2l0aXZlIG51bWJlciBvZiBhIGlzIGdyZWF0ZXIgdGhhbiBiLgoJICAgICogVGhlIGFycmF5IG1heSBjb250YWluIGR1cGxpY2F0ZSBlbGVtZW50cy4gSWYgdGhlcmUgYXJlIG1vcmUgdGhhbiBvbmUgZXF1YWwgZWxlbWVudHMgaW4gdGhlIGFycmF5LAoJICAgICogdGhlIHJldHVybmVkIHZhbHVlIGNhbiBiZSB0aGUgaW5kZXggb2YgYW55IG9uZSBvZiB0aGUgZXF1YWwgZWxlbWVudHMuCgkgICAgKgoJICAgICogaHR0cDovL2pzZmlkZGxlLm5ldC9hcnl6aG92L3BrZnN0NTUwLwoJICAgICovCgkgICAgQXJyYXlzLmJpbmFyeVNlYXJjaCA9IGZ1bmN0aW9uIChhciwgZWwsIGNvbXBhcmF0b3IpIHsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gY29tcGFyYXRvcikgewoJICAgICAgICAgICAgY29tcGFyYXRvciA9IEFycmF5cy5udW1iZXJDb21wYXJhdG9yOwoJICAgICAgICB9CgkgICAgICAgIHZhciBtID0gMDsKCSAgICAgICAgdmFyIG4gPSBhci5sZW5ndGggLSAxOwoJICAgICAgICB3aGlsZSAobSA8PSBuKSB7CgkgICAgICAgICAgICB2YXIgayA9IChuICsgbSkgPj4gMTsKCSAgICAgICAgICAgIHZhciBjbXAgPSBjb21wYXJhdG9yKGVsLCBhcltrXSk7CgkgICAgICAgICAgICBpZiAoY21wID4gMCkgewoJICAgICAgICAgICAgICAgIG0gPSBrICsgMTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKGNtcCA8IDApIHsKCSAgICAgICAgICAgICAgICBuID0gayAtIDE7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gazsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gLW0gLSAxOwoJICAgIH07CgkgICAgQXJyYXlzLm51bWJlckNvbXBhcmF0b3IgPSBmdW5jdGlvbiAoYSwgYikgewoJICAgICAgICByZXR1cm4gYSAtIGI7CgkgICAgfTsKCSAgICByZXR1cm4gQXJyYXlzOwoJfSgpKTsKCUFycmF5cyQxLmRlZmF1bHQgPSBBcnJheXM7CgoJdmFyIEludGVnZXIkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbnRlZ2VyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogUG9ueWZpbGwgZm9yIEphdmEncyBJbnRlZ2VyIGNsYXNzLgoJICovCgl2YXIgSW50ZWdlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBJbnRlZ2VyKCkgewoJICAgIH0KCSAgICBJbnRlZ2VyLm51bWJlck9mVHJhaWxpbmdaZXJvcyA9IGZ1bmN0aW9uIChpKSB7CgkgICAgICAgIHZhciB5OwoJICAgICAgICBpZiAoaSA9PT0gMCkKCSAgICAgICAgICAgIHJldHVybiAzMjsKCSAgICAgICAgdmFyIG4gPSAzMTsKCSAgICAgICAgeSA9IGkgPDwgMTY7CgkgICAgICAgIGlmICh5ICE9PSAwKSB7CgkgICAgICAgICAgICBuIC09IDE2OwoJICAgICAgICAgICAgaSA9IHk7CgkgICAgICAgIH0KCSAgICAgICAgeSA9IGkgPDwgODsKCSAgICAgICAgaWYgKHkgIT09IDApIHsKCSAgICAgICAgICAgIG4gLT0gODsKCSAgICAgICAgICAgIGkgPSB5OwoJICAgICAgICB9CgkgICAgICAgIHkgPSBpIDw8IDQ7CgkgICAgICAgIGlmICh5ICE9PSAwKSB7CgkgICAgICAgICAgICBuIC09IDQ7CgkgICAgICAgICAgICBpID0geTsKCSAgICAgICAgfQoJICAgICAgICB5ID0gaSA8PCAyOwoJICAgICAgICBpZiAoeSAhPT0gMCkgewoJICAgICAgICAgICAgbiAtPSAyOwoJICAgICAgICAgICAgaSA9IHk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG4gLSAoKGkgPDwgMSkgPj4+IDMxKTsKCSAgICB9OwoJICAgIEludGVnZXIubnVtYmVyT2ZMZWFkaW5nWmVyb3MgPSBmdW5jdGlvbiAoaSkgewoJICAgICAgICAvLyBIRCwgRmlndXJlIDUtNgoJICAgICAgICBpZiAoaSA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIDMyOwoJICAgICAgICB9CgkgICAgICAgIHZhciBuID0gMTsKCSAgICAgICAgaWYgKGkgPj4+IDE2ID09PSAwKSB7CgkgICAgICAgICAgICBuICs9IDE2OwoJICAgICAgICAgICAgaSA8PD0gMTY7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGkgPj4+IDI0ID09PSAwKSB7CgkgICAgICAgICAgICBuICs9IDg7CgkgICAgICAgICAgICBpIDw8PSA4OwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID4+PiAyOCA9PT0gMCkgewoJICAgICAgICAgICAgbiArPSA0OwoJICAgICAgICAgICAgaSA8PD0gNDsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaSA+Pj4gMzAgPT09IDApIHsKCSAgICAgICAgICAgIG4gKz0gMjsKCSAgICAgICAgICAgIGkgPDw9IDI7CgkgICAgICAgIH0KCSAgICAgICAgbiAtPSBpID4+PiAzMTsKCSAgICAgICAgcmV0dXJuIG47CgkgICAgfTsKCSAgICBJbnRlZ2VyLnRvSGV4U3RyaW5nID0gZnVuY3Rpb24gKGkpIHsKCSAgICAgICAgcmV0dXJuIGkudG9TdHJpbmcoMTYpOwoJICAgIH07CgkgICAgSW50ZWdlci50b0JpbmFyeVN0cmluZyA9IGZ1bmN0aW9uIChpbnROdW1iZXIpIHsKCSAgICAgICAgcmV0dXJuIFN0cmluZyhwYXJzZUludChTdHJpbmcoaW50TnVtYmVyKSwgMikpOwoJICAgIH07CgkgICAgLy8gUmV0dXJucyB0aGUgbnVtYmVyIG9mIG9uZS1iaXRzIGluIHRoZSB0d28ncyBjb21wbGVtZW50IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3BlY2lmaWVkIGludCB2YWx1ZS4gVGhpcyBmdW5jdGlvbiBpcyBzb21ldGltZXMgcmVmZXJyZWQgdG8gYXMgdGhlIHBvcHVsYXRpb24gY291bnQuCgkgICAgLy8gUmV0dXJuczoKCSAgICAvLyB0aGUgbnVtYmVyIG9mIG9uZS1iaXRzIGluIHRoZSB0d28ncyBjb21wbGVtZW50IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3BlY2lmaWVkIGludCB2YWx1ZS4KCSAgICBJbnRlZ2VyLmJpdENvdW50ID0gZnVuY3Rpb24gKGkpIHsKCSAgICAgICAgLy8gSEQsIEZpZ3VyZSA1LTIKCSAgICAgICAgaSA9IGkgLSAoKGkgPj4+IDEpICYgMHg1NTU1NTU1NSk7CgkgICAgICAgIGkgPSAoaSAmIDB4MzMzMzMzMzMpICsgKChpID4+PiAyKSAmIDB4MzMzMzMzMzMpOwoJICAgICAgICBpID0gKGkgKyAoaSA+Pj4gNCkpICYgMHgwZjBmMGYwZjsKCSAgICAgICAgaSA9IGkgKyAoaSA+Pj4gOCk7CgkgICAgICAgIGkgPSBpICsgKGkgPj4+IDE2KTsKCSAgICAgICAgcmV0dXJuIGkgJiAweDNmOwoJICAgIH07CgkgICAgSW50ZWdlci50cnVuY0RpdmlzaW9uID0gZnVuY3Rpb24gKGRpdmlkZW5kLCBkaXZpc29yKSB7CgkgICAgICAgIHJldHVybiBNYXRoLnRydW5jKGRpdmlkZW5kIC8gZGl2aXNvcik7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDb252ZXJ0cyBBIHN0cmluZyB0byBhbiBpbnRlZ2VyLgoJICAgICAqIEBwYXJhbSBzIEEgc3RyaW5nIHRvIGNvbnZlcnQgaW50byBhIG51bWJlci4KCSAgICAgKiBAcGFyYW0gcmFkaXggQSB2YWx1ZSBiZXR3ZWVuIDIgYW5kIDM2IHRoYXQgc3BlY2lmaWVzIHRoZSBiYXNlIG9mIHRoZSBudW1iZXIgaW4gbnVtU3RyaW5nLiBJZiB0aGlzIGFyZ3VtZW50IGlzIG5vdCBzdXBwbGllZCwgc3RyaW5ncyB3aXRoIGEgcHJlZml4IG9mICcweCcgYXJlIGNvbnNpZGVyZWQgaGV4YWRlY2ltYWwuIEFsbCBvdGhlciBzdHJpbmdzIGFyZSBjb25zaWRlcmVkIGRlY2ltYWwuCgkgICAgICovCgkgICAgSW50ZWdlci5wYXJzZUludCA9IGZ1bmN0aW9uIChudW0sIHJhZGl4KSB7CgkgICAgICAgIGlmIChyYWRpeCA9PT0gdm9pZCAwKSB7IHJhZGl4ID0gdW5kZWZpbmVkOyB9CgkgICAgICAgIHJldHVybiBwYXJzZUludChudW0sIHJhZGl4KTsKCSAgICB9OwoJICAgIEludGVnZXIuTUlOX1ZBTFVFXzMyX0JJVFMgPSAtMjE0NzQ4MzY0ODsKCSAgICBJbnRlZ2VyLk1BWF9WQUxVRSA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSOwoJICAgIHJldHVybiBJbnRlZ2VyOwoJfSgpKTsKCUludGVnZXIkMS5kZWZhdWx0ID0gSW50ZWdlcjsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdEFycmF5JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5czsqLwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDggPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcnJheXNfMSQxID0gQXJyYXlzJDE7Cgl2YXIgSW50ZWdlcl8xJDIgPSBJbnRlZ2VyJDE7Cgl2YXIgU3lzdGVtXzEkNCA9IFN5c3RlbSQxOwoJLyoqCgkgKiA8cD5BIHNpbXBsZSwgZmFzdCBhcnJheSBvZiBiaXRzLCByZXByZXNlbnRlZCBjb21wYWN0bHkgYnkgYW4gYXJyYXkgb2YgaW50cyBpbnRlcm5hbGx5LjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgQml0QXJyYXkgLyppbXBsZW1lbnRzIENsb25lYWJsZSovID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3RvcigpIHsKCSAgICAvLyAgIHRoaXMuc2l6ZSA9IDAKCSAgICAvLyAgIHRoaXMuYml0cyA9IG5ldyBJbnQzMkFycmF5KDEpCgkgICAgLy8gfQoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3RvcihzaXplPzogbnVtYmVyIC8qaW50Ki8pIHsKCSAgICAvLyAgIGlmICh1bmRlZmluZWQgPT09IHNpemUpIHsKCSAgICAvLyAgICAgdGhpcy5zaXplID0gMAoJICAgIC8vICAgfSBlbHNlIHsKCSAgICAvLyAgICAgdGhpcy5zaXplID0gc2l6ZQoJICAgIC8vICAgfQoJICAgIC8vICAgdGhpcy5iaXRzID0gdGhpcy5tYWtlQXJyYXkoc2l6ZSkKCSAgICAvLyB9CgkgICAgLy8gRm9yIHRlc3Rpbmcgb25seQoJICAgIGZ1bmN0aW9uIEJpdEFycmF5KHNpemUgLyppbnQqLywgYml0cykgewoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSBzaXplKSB7CgkgICAgICAgICAgICB0aGlzLnNpemUgPSAwOwoJICAgICAgICAgICAgdGhpcy5iaXRzID0gbmV3IEludDMyQXJyYXkoMSk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICB0aGlzLnNpemUgPSBzaXplOwoJICAgICAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gYml0cyB8fCBudWxsID09PSBiaXRzKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5iaXRzID0gQml0QXJyYXkubWFrZUFycmF5KHNpemUpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhpcy5iaXRzID0gYml0czsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH0KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZ2V0U2l6ZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc2l6ZTsKCSAgICB9OwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXRTaXplSW5CeXRlcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoKHRoaXMuc2l6ZSArIDcpIC8gOCk7CgkgICAgfTsKCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZW5zdXJlQ2FwYWNpdHkgPSBmdW5jdGlvbiAoc2l6ZSAvKmludCovKSB7CgkgICAgICAgIGlmIChzaXplID4gdGhpcy5iaXRzLmxlbmd0aCAqIDMyKSB7CgkgICAgICAgICAgICB2YXIgbmV3Qml0cyA9IEJpdEFycmF5Lm1ha2VBcnJheShzaXplKTsKCSAgICAgICAgICAgIFN5c3RlbV8xJDQuZGVmYXVsdC5hcnJheWNvcHkodGhpcy5iaXRzLCAwLCBuZXdCaXRzLCAwLCB0aGlzLmJpdHMubGVuZ3RoKTsKCSAgICAgICAgICAgIHRoaXMuYml0cyA9IG5ld0JpdHM7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBpIGJpdCB0byBnZXQKCSAgICAgKiBAcmV0dXJuIHRydWUgaWZmIGJpdCBpIGlzIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoaSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiAodGhpcy5iaXRzW01hdGguZmxvb3IoaSAvIDMyKV0gJiAoMSA8PCAoaSAmIDB4MUYpKSkgIT09IDA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGJpdCBpLgoJICAgICAqCgkgICAgICogQHBhcmFtIGkgYml0IHRvIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoaSAvKmludCovKSB7CgkgICAgICAgIHRoaXMuYml0c1tNYXRoLmZsb29yKGkgLyAzMildIHw9IDEgPDwgKGkgJiAweDFGKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEZsaXBzIGJpdCBpLgoJICAgICAqCgkgICAgICogQHBhcmFtIGkgYml0IHRvIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5mbGlwID0gZnVuY3Rpb24gKGkgLyppbnQqLykgewoJICAgICAgICB0aGlzLmJpdHNbTWF0aC5mbG9vcihpIC8gMzIpXSBePSAxIDw8IChpICYgMHgxRik7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gZnJvbSBmaXJzdCBiaXQgdG8gY2hlY2sKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIGZpcnN0IGJpdCB0aGF0IGlzIHNldCwgc3RhcnRpbmcgZnJvbSB0aGUgZ2l2ZW4gaW5kZXgsIG9yIHNpemUgaWYgbm9uZSBhcmUgc2V0CgkgICAgICogIGF0IG9yIGJleW9uZCB0aGlzIGdpdmVuIGluZGV4CgkgICAgICogQHNlZSAjZ2V0TmV4dFVuc2V0KGludCkKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZ2V0TmV4dFNldCA9IGZ1bmN0aW9uIChmcm9tIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIHNpemUgPSB0aGlzLnNpemU7CgkgICAgICAgIGlmIChmcm9tID49IHNpemUpIHsKCSAgICAgICAgICAgIHJldHVybiBzaXplOwoJICAgICAgICB9CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IE1hdGguZmxvb3IoZnJvbSAvIDMyKTsKCSAgICAgICAgdmFyIGN1cnJlbnRCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgLy8gbWFzayBvZmYgbGVzc2VyIGJpdHMgZmlyc3QKCSAgICAgICAgY3VycmVudEJpdHMgJj0gfigoMSA8PCAoZnJvbSAmIDB4MUYpKSAtIDEpOwoJICAgICAgICB2YXIgbGVuZ3RoID0gYml0cy5sZW5ndGg7CgkgICAgICAgIHdoaWxlIChjdXJyZW50Qml0cyA9PT0gMCkgewoJICAgICAgICAgICAgaWYgKCsrYml0c09mZnNldCA9PT0gbGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIHNpemU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjdXJyZW50Qml0cyA9IGJpdHNbYml0c09mZnNldF07CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdCA9IChiaXRzT2Zmc2V0ICogMzIpICsgSW50ZWdlcl8xJDIuZGVmYXVsdC5udW1iZXJPZlRyYWlsaW5nWmVyb3MoY3VycmVudEJpdHMpOwoJICAgICAgICByZXR1cm4gcmVzdWx0ID4gc2l6ZSA/IHNpemUgOiByZXN1bHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gZnJvbSBpbmRleCB0byBzdGFydCBsb29raW5nIGZvciB1bnNldCBiaXQKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIG5leHQgdW5zZXQgYml0LCBvciB7QGNvZGUgc2l6ZX0gaWYgbm9uZSBhcmUgdW5zZXQgdW50aWwgdGhlIGVuZAoJICAgICAqIEBzZWUgI2dldE5leHRTZXQoaW50KQoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXROZXh0VW5zZXQgPSBmdW5jdGlvbiAoZnJvbSAvKmludCovKSB7CgkgICAgICAgIHZhciBzaXplID0gdGhpcy5zaXplOwoJICAgICAgICBpZiAoZnJvbSA+PSBzaXplKSB7CgkgICAgICAgICAgICByZXR1cm4gc2l6ZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgdmFyIGJpdHNPZmZzZXQgPSBNYXRoLmZsb29yKGZyb20gLyAzMik7CgkgICAgICAgIHZhciBjdXJyZW50Qml0cyA9IH5iaXRzW2JpdHNPZmZzZXRdOwoJICAgICAgICAvLyBtYXNrIG9mZiBsZXNzZXIgYml0cyBmaXJzdAoJICAgICAgICBjdXJyZW50Qml0cyAmPSB+KCgxIDw8IChmcm9tICYgMHgxRikpIC0gMSk7CgkgICAgICAgIHZhciBsZW5ndGggPSBiaXRzLmxlbmd0aDsKCSAgICAgICAgd2hpbGUgKGN1cnJlbnRCaXRzID09PSAwKSB7CgkgICAgICAgICAgICBpZiAoKytiaXRzT2Zmc2V0ID09PSBsZW5ndGgpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gc2l6ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGN1cnJlbnRCaXRzID0gfmJpdHNbYml0c09mZnNldF07CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdCA9IChiaXRzT2Zmc2V0ICogMzIpICsgSW50ZWdlcl8xJDIuZGVmYXVsdC5udW1iZXJPZlRyYWlsaW5nWmVyb3MoY3VycmVudEJpdHMpOwoJICAgICAgICByZXR1cm4gcmVzdWx0ID4gc2l6ZSA/IHNpemUgOiByZXN1bHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGEgYmxvY2sgb2YgMzIgYml0cywgc3RhcnRpbmcgYXQgYml0IGkuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gaSBmaXJzdCBiaXQgdG8gc2V0CgkgICAgICogQHBhcmFtIG5ld0JpdHMgdGhlIG5ldyB2YWx1ZSBvZiB0aGUgbmV4dCAzMiBiaXRzLiBOb3RlIGFnYWluIHRoYXQgdGhlIGxlYXN0LXNpZ25pZmljYW50IGJpdAoJICAgICAqIGNvcnJlc3BvbmRzIHRvIGJpdCBpLCB0aGUgbmV4dC1sZWFzdC1zaWduaWZpY2FudCB0byBpKzEsIGFuZCBzbyBvbi4KCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuc2V0QnVsayA9IGZ1bmN0aW9uIChpIC8qaW50Ki8sIG5ld0JpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLmJpdHNbTWF0aC5mbG9vcihpIC8gMzIpXSA9IG5ld0JpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGEgcmFuZ2Ugb2YgYml0cy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGFydCBzdGFydCBvZiByYW5nZSwgaW5jbHVzaXZlLgoJICAgICAqIEBwYXJhbSBlbmQgZW5kIG9mIHJhbmdlLCBleGNsdXNpdmUKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuc2V0UmFuZ2UgPSBmdW5jdGlvbiAoc3RhcnQgLyppbnQqLywgZW5kIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGVuZCA8IHN0YXJ0IHx8IHN0YXJ0IDwgMCB8fCBlbmQgPiB0aGlzLnNpemUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ4LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZW5kID09PSBzdGFydCkgewoJICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICB9CgkgICAgICAgIGVuZC0tOyAvLyB3aWxsIGJlIGVhc2llciB0byB0cmVhdCB0aGlzIGFzIHRoZSBsYXN0IGFjdHVhbGx5IHNldCBiaXQgLS0gaW5jbHVzaXZlCgkgICAgICAgIHZhciBmaXJzdEludCA9IE1hdGguZmxvb3Ioc3RhcnQgLyAzMik7CgkgICAgICAgIHZhciBsYXN0SW50ID0gTWF0aC5mbG9vcihlbmQgLyAzMik7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICBmb3IgKHZhciBpID0gZmlyc3RJbnQ7IGkgPD0gbGFzdEludDsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgZmlyc3RCaXQgPSBpID4gZmlyc3RJbnQgPyAwIDogc3RhcnQgJiAweDFGOwoJICAgICAgICAgICAgdmFyIGxhc3RCaXQgPSBpIDwgbGFzdEludCA/IDMxIDogZW5kICYgMHgxRjsKCSAgICAgICAgICAgIC8vIE9uZXMgZnJvbSBmaXJzdEJpdCB0byBsYXN0Qml0LCBpbmNsdXNpdmUKCSAgICAgICAgICAgIHZhciBtYXNrID0gKDIgPDwgbGFzdEJpdCkgLSAoMSA8PCBmaXJzdEJpdCk7CgkgICAgICAgICAgICBiaXRzW2ldIHw9IG1hc2s7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIENsZWFycyBhbGwgYml0cyAoc2V0cyB0byBmYWxzZSkuCgkgICAgICovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbWF4ID0gdGhpcy5iaXRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWF4OyBpKyspIHsKCSAgICAgICAgICAgIGJpdHNbaV0gPSAwOwoJICAgICAgICB9CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBFZmZpY2llbnQgbWV0aG9kIHRvIGNoZWNrIGlmIGEgcmFuZ2Ugb2YgYml0cyBpcyBzZXQsIG9yIG5vdCBzZXQuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gc3RhcnQgc3RhcnQgb2YgcmFuZ2UsIGluY2x1c2l2ZS4KCSAgICAgKiBAcGFyYW0gZW5kIGVuZCBvZiByYW5nZSwgZXhjbHVzaXZlCgkgICAgICogQHBhcmFtIHZhbHVlIGlmIHRydWUsIGNoZWNrcyB0aGF0IGJpdHMgaW4gcmFuZ2UgYXJlIHNldCwgb3RoZXJ3aXNlIGNoZWNrcyB0aGF0IHRoZXkgYXJlIG5vdCBzZXQKCSAgICAgKiBAcmV0dXJuIHRydWUgaWZmIGFsbCBiaXRzIGFyZSBzZXQgb3Igbm90IHNldCBpbiByYW5nZSwgYWNjb3JkaW5nIHRvIHZhbHVlIGFyZ3VtZW50CgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgZW5kIGlzIGxlc3MgdGhhbiBzdGFydCBvciB0aGUgcmFuZ2UgaXMgbm90IGNvbnRhaW5lZCBpbiB0aGUgYXJyYXkKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuaXNSYW5nZSA9IGZ1bmN0aW9uIChzdGFydCAvKmludCovLCBlbmQgLyppbnQqLywgdmFsdWUpIHsKCSAgICAgICAgaWYgKGVuZCA8IHN0YXJ0IHx8IHN0YXJ0IDwgMCB8fCBlbmQgPiB0aGlzLnNpemUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ4LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZW5kID09PSBzdGFydCkgewoJICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIGVtcHR5IHJhbmdlIG1hdGNoZXMKCSAgICAgICAgfQoJICAgICAgICBlbmQtLTsgLy8gd2lsbCBiZSBlYXNpZXIgdG8gdHJlYXQgdGhpcyBhcyB0aGUgbGFzdCBhY3R1YWxseSBzZXQgYml0IC0tIGluY2x1c2l2ZQoJICAgICAgICB2YXIgZmlyc3RJbnQgPSBNYXRoLmZsb29yKHN0YXJ0IC8gMzIpOwoJICAgICAgICB2YXIgbGFzdEludCA9IE1hdGguZmxvb3IoZW5kIC8gMzIpOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgaSA9IGZpcnN0SW50OyBpIDw9IGxhc3RJbnQ7IGkrKykgewoJICAgICAgICAgICAgdmFyIGZpcnN0Qml0ID0gaSA+IGZpcnN0SW50ID8gMCA6IHN0YXJ0ICYgMHgxRjsKCSAgICAgICAgICAgIHZhciBsYXN0Qml0ID0gaSA8IGxhc3RJbnQgPyAzMSA6IGVuZCAmIDB4MUY7CgkgICAgICAgICAgICAvLyBPbmVzIGZyb20gZmlyc3RCaXQgdG8gbGFzdEJpdCwgaW5jbHVzaXZlCgkgICAgICAgICAgICB2YXIgbWFzayA9ICgyIDw8IGxhc3RCaXQpIC0gKDEgPDwgZmlyc3RCaXQpICYgMHhGRkZGRkZGRjsKCSAgICAgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiAmIDB4RkZGRkZGRkYgYWRkZWQgdG8gZGlzY2FyZCBhbnl0aGluZyBhZnRlciAzMiBiaXRzLCBhcyBFUyBoYXMgNTMgYml0cwoJICAgICAgICAgICAgLy8gUmV0dXJuIGZhbHNlIGlmIHdlJ3JlIGxvb2tpbmcgZm9yIDFzIGFuZCB0aGUgbWFza2VkIGJpdHNbaV0gaXNuJ3QgYWxsIDFzIChpczogdGhhdCwKCSAgICAgICAgICAgIC8vIGVxdWFscyB0aGUgbWFzaywgb3Igd2UncmUgbG9va2luZyBmb3IgMHMgYW5kIHRoZSBtYXNrZWQgcG9ydGlvbiBpcyBub3QgYWxsIDBzCgkgICAgICAgICAgICBpZiAoKGJpdHNbaV0gJiBtYXNrKSAhPT0gKHZhbHVlID8gbWFzayA6IDApKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0cnVlOwoJICAgIH07CgkgICAgQml0QXJyYXkucHJvdG90eXBlLmFwcGVuZEJpdCA9IGZ1bmN0aW9uIChiaXQpIHsKCSAgICAgICAgdGhpcy5lbnN1cmVDYXBhY2l0eSh0aGlzLnNpemUgKyAxKTsKCSAgICAgICAgaWYgKGJpdCkgewoJICAgICAgICAgICAgdGhpcy5iaXRzW01hdGguZmxvb3IodGhpcy5zaXplIC8gMzIpXSB8PSAxIDw8ICh0aGlzLnNpemUgJiAweDFGKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLnNpemUrKzsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEFwcGVuZHMgdGhlIGxlYXN0LXNpZ25pZmljYW50IGJpdHMsIGZyb20gdmFsdWUsIGluIG9yZGVyIGZyb20gbW9zdC1zaWduaWZpY2FudCB0bwoJICAgICAqIGxlYXN0LXNpZ25pZmljYW50LiBGb3IgZXhhbXBsZSwgYXBwZW5kaW5nIDYgYml0cyBmcm9tIDB4MDAwMDAxRSB3aWxsIGFwcGVuZCB0aGUgYml0cwoJICAgICAqIDAsIDEsIDEsIDEsIDEsIDAgaW4gdGhhdCBvcmRlci4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB2YWx1ZSB7QGNvZGUgaW50fSBjb250YWluaW5nIGJpdHMgdG8gYXBwZW5kCgkgICAgICogQHBhcmFtIG51bUJpdHMgYml0cyBmcm9tIHZhbHVlIHRvIGFwcGVuZAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5hcHBlbmRCaXRzID0gZnVuY3Rpb24gKHZhbHVlIC8qaW50Ki8sIG51bUJpdHMgLyppbnQqLykgewoJICAgICAgICBpZiAobnVtQml0cyA8IDAgfHwgbnVtQml0cyA+IDMyKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkOC5kZWZhdWx0KCdOdW0gYml0cyBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMzInKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLmVuc3VyZUNhcGFjaXR5KHRoaXMuc2l6ZSArIG51bUJpdHMpOwoJICAgICAgICAvLyBjb25zdCBhcHBlbmRCaXQgPSB0aGlzLmFwcGVuZEJpdDsKCSAgICAgICAgZm9yICh2YXIgbnVtQml0c0xlZnQgPSBudW1CaXRzOyBudW1CaXRzTGVmdCA+IDA7IG51bUJpdHNMZWZ0LS0pIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kQml0KCgodmFsdWUgPj4gKG51bUJpdHNMZWZ0IC0gMSkpICYgMHgwMSkgPT09IDEpOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBCaXRBcnJheS5wcm90b3R5cGUuYXBwZW5kQml0QXJyYXkgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgdmFyIG90aGVyU2l6ZSA9IG90aGVyLnNpemU7CgkgICAgICAgIHRoaXMuZW5zdXJlQ2FwYWNpdHkodGhpcy5zaXplICsgb3RoZXJTaXplKTsKCSAgICAgICAgLy8gY29uc3QgYXBwZW5kQml0ID0gdGhpcy5hcHBlbmRCaXQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3RoZXJTaXplOyBpKyspIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kQml0KG90aGVyLmdldChpKSk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS54b3IgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKHRoaXMuc2l6ZSAhPT0gb3RoZXIuc2l6ZSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDguZGVmYXVsdCgnU2l6ZXMgZG9uXCd0IG1hdGNoJyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IGJpdHMubGVuZ3RoOyBpIDwgbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgLy8gVGhlIGxhc3QgaW50IGNvdWxkIGJlIGluY29tcGxldGUgKGkuZS4gbm90IGhhdmUgMzIgYml0cyBpbgoJICAgICAgICAgICAgLy8gaXQpIGJ1dCB0aGVyZSBpcyBubyBwcm9ibGVtIHNpbmNlIDAgWE9SIDAgPT0gMC4KCSAgICAgICAgICAgIGJpdHNbaV0gXj0gb3RoZXIuYml0c1tpXTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYml0T2Zmc2V0IGZpcnN0IGJpdCB0byBzdGFydCB3cml0aW5nCgkgICAgICogQHBhcmFtIGFycmF5IGFycmF5IHRvIHdyaXRlIGludG8uIEJ5dGVzIGFyZSB3cml0dGVuIG1vc3Qtc2lnbmlmaWNhbnQgYnl0ZSBmaXJzdC4gVGhpcyBpcyB0aGUgb3Bwb3NpdGUKCSAgICAgKiAgb2YgdGhlIGludGVybmFsIHJlcHJlc2VudGF0aW9uLCB3aGljaCBpcyBleHBvc2VkIGJ5IHtAbGluayAjZ2V0Qml0QXJyYXkoKX0KCSAgICAgKiBAcGFyYW0gb2Zmc2V0IHBvc2l0aW9uIGluIGFycmF5IHRvIHN0YXJ0IHdyaXRpbmcKCSAgICAgKiBAcGFyYW0gbnVtQnl0ZXMgaG93IG1hbnkgYnl0ZXMgdG8gd3JpdGUKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUudG9CeXRlcyA9IGZ1bmN0aW9uIChiaXRPZmZzZXQgLyppbnQqLywgYXJyYXksIG9mZnNldCAvKmludCovLCBudW1CeXRlcyAvKmludCovKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtQnl0ZXM7IGkrKykgewoJICAgICAgICAgICAgdmFyIHRoZUJ5dGUgPSAwOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCA4OyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5nZXQoYml0T2Zmc2V0KSkgewoJICAgICAgICAgICAgICAgICAgICB0aGVCeXRlIHw9IDEgPDwgKDcgLSBqKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgYml0T2Zmc2V0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBhcnJheVtvZmZzZXQgKyBpXSA9IC8qKGJ5dGUpKi8gdGhlQnl0ZTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB1bmRlcmx5aW5nIGFycmF5IG9mIGludHMuIFRoZSBmaXJzdCBlbGVtZW50IGhvbGRzIHRoZSBmaXJzdCAzMiBiaXRzLCBhbmQgdGhlIGxlYXN0CgkgICAgICogICAgICAgICBzaWduaWZpY2FudCBiaXQgaXMgYml0IDAuCgkgICAgICovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLmdldEJpdEFycmF5ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRzOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV2ZXJzZXMgYWxsIGJpdHMgaW4gdGhlIGFycmF5LgoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5yZXZlcnNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3Qml0cyA9IG5ldyBJbnQzMkFycmF5KHRoaXMuYml0cy5sZW5ndGgpOwoJICAgICAgICAvLyByZXZlcnNlIGFsbCBpbnQncyBmaXJzdAoJICAgICAgICB2YXIgbGVuID0gTWF0aC5mbG9vcigodGhpcy5zaXplIC0gMSkgLyAzMik7CgkgICAgICAgIHZhciBvbGRCaXRzTGVuID0gbGVuICsgMTsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2xkQml0c0xlbjsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgeCA9IGJpdHNbaV07CgkgICAgICAgICAgICB4ID0gKCh4ID4+IDEpICYgMHg1NTU1NTU1NSkgfCAoKHggJiAweDU1NTU1NTU1KSA8PCAxKTsKCSAgICAgICAgICAgIHggPSAoKHggPj4gMikgJiAweDMzMzMzMzMzKSB8ICgoeCAmIDB4MzMzMzMzMzMpIDw8IDIpOwoJICAgICAgICAgICAgeCA9ICgoeCA+PiA0KSAmIDB4MGYwZjBmMGYpIHwgKCh4ICYgMHgwZjBmMGYwZikgPDwgNCk7CgkgICAgICAgICAgICB4ID0gKCh4ID4+IDgpICYgMHgwMGZmMDBmZikgfCAoKHggJiAweDAwZmYwMGZmKSA8PCA4KTsKCSAgICAgICAgICAgIHggPSAoKHggPj4gMTYpICYgMHgwMDAwZmZmZikgfCAoKHggJiAweDAwMDBmZmZmKSA8PCAxNik7CgkgICAgICAgICAgICBuZXdCaXRzW2xlbiAtIGldID0gLyooaW50KSovIHg7CgkgICAgICAgIH0KCSAgICAgICAgLy8gbm93IGNvcnJlY3QgdGhlIGludCdzIGlmIHRoZSBiaXQgc2l6ZSBpc24ndCBhIG11bHRpcGxlIG9mIDMyCgkgICAgICAgIGlmICh0aGlzLnNpemUgIT09IG9sZEJpdHNMZW4gKiAzMikgewoJICAgICAgICAgICAgdmFyIGxlZnRPZmZzZXQgPSBvbGRCaXRzTGVuICogMzIgLSB0aGlzLnNpemU7CgkgICAgICAgICAgICB2YXIgY3VycmVudEludCA9IG5ld0JpdHNbMF0gPj4+IGxlZnRPZmZzZXQ7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IG9sZEJpdHNMZW47IGkrKykgewoJICAgICAgICAgICAgICAgIHZhciBuZXh0SW50ID0gbmV3Qml0c1tpXTsKCSAgICAgICAgICAgICAgICBjdXJyZW50SW50IHw9IG5leHRJbnQgPDwgKDMyIC0gbGVmdE9mZnNldCk7CgkgICAgICAgICAgICAgICAgbmV3Qml0c1tpIC0gMV0gPSBjdXJyZW50SW50OwoJICAgICAgICAgICAgICAgIGN1cnJlbnRJbnQgPSBuZXh0SW50ID4+PiBsZWZ0T2Zmc2V0OwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgbmV3Qml0c1tvbGRCaXRzTGVuIC0gMV0gPSBjdXJyZW50SW50OwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0cyA9IG5ld0JpdHM7CgkgICAgfTsKCSAgICBCaXRBcnJheS5tYWtlQXJyYXkgPSBmdW5jdGlvbiAoc2l6ZSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiBuZXcgSW50MzJBcnJheShNYXRoLmZsb29yKChzaXplICsgMzEpIC8gMzIpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG8pIHsKCSAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIEJpdEFycmF5KSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLnNpemUgPT09IG90aGVyLnNpemUgJiYgQXJyYXlzXzEkMS5kZWZhdWx0LmVxdWFscyh0aGlzLmJpdHMsIG90aGVyLmJpdHMpOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDMxICogdGhpcy5zaXplICsgQXJyYXlzXzEkMS5kZWZhdWx0Lmhhc2hDb2RlKHRoaXMuYml0cyk7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgcmVzdWx0ID0gJyc7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBzaXplID0gdGhpcy5zaXplOyBpIDwgc2l6ZTsgaSsrKSB7CgkgICAgICAgICAgICBpZiAoKGkgJiAweDA3KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnICc7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQgKz0gdGhpcy5nZXQoaSkgPyAnWCcgOiAnLic7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgQml0QXJyYXkodGhpcy5zaXplLCB0aGlzLmJpdHMuc2xpY2UoKSk7CgkgICAgfTsKCSAgICByZXR1cm4gQml0QXJyYXk7Cgl9KCkpOwoJQml0QXJyYXkkMS5kZWZhdWx0ID0gQml0QXJyYXk7CgoJdmFyIEJpdE1hdHJpeCQxID0ge307CgoJdmFyIFN0cmluZ0J1aWxkZXIkMSA9IHt9OwoKCXZhciBTdHJpbmdVdGlscyQxID0ge307CgoJdmFyIERlY29kZUhpbnRUeXBlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KERlY29kZUhpbnRUeXBlJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcgeyovCgkvKioKCSAqIEVuY2Fwc3VsYXRlcyBhIHR5cGUgb2YgaGludCB0aGF0IGEgY2FsbGVyIG1heSBwYXNzIHRvIGEgYmFyY29kZSByZWFkZXIgdG8gaGVscCBpdAoJICogbW9yZSBxdWlja2x5IG9yIGFjY3VyYXRlbHkgZGVjb2RlIGl0LiBJdCBpcyB1cCB0byBpbXBsZW1lbnRhdGlvbnMgdG8gZGVjaWRlIHdoYXQsCgkgKiBpZiBhbnl0aGluZywgdG8gZG8gd2l0aCB0aGUgaW5mb3JtYXRpb24gdGhhdCBpcyBzdXBwbGllZC4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBzZWUgUmVhZGVyI2RlY29kZShCaW5hcnlCaXRtYXAsamF2YS51dGlsLk1hcCkKCSAqLwoJdmFyIERlY29kZUhpbnRUeXBlOwoJKGZ1bmN0aW9uIChEZWNvZGVIaW50VHlwZSkgewoJICAgIC8qKgoJICAgICAqIFVuc3BlY2lmaWVkLCBhcHBsaWNhdGlvbi1zcGVjaWZpYyBoaW50LiBNYXBzIHRvIGFuIHVuc3BlY2lmaWVkIHtAbGluayBPYmplY3R9LgoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJPVEhFUiJdID0gMF0gPSAiT1RIRVIiOyAvKihPYmplY3QuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBJbWFnZSBpcyBhIHB1cmUgbW9ub2Nocm9tZSBpbWFnZSBvZiBhIGJhcmNvZGUuIERvZXNuJ3QgbWF0dGVyIHdoYXQgaXQgbWFwcyB0bzsKCSAgICAgKiB1c2Uge0BsaW5rIEJvb2xlYW4jVFJVRX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIlBVUkVfQkFSQ09ERSJdID0gMV0gPSAiUFVSRV9CQVJDT0RFIjsgLyooVm9pZC5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIEltYWdlIGlzIGtub3duIHRvIGJlIG9mIG9uZSBvZiBhIGZldyBwb3NzaWJsZSBmb3JtYXRzLgoJICAgICAqIE1hcHMgdG8gYSB7QGxpbmsgTGlzdH0gb2Yge0BsaW5rIEJhcmNvZGVGb3JtYXR9cy4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiUE9TU0lCTEVfRk9STUFUUyJdID0gMl0gPSAiUE9TU0lCTEVfRk9STUFUUyI7IC8qKExpc3QuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBTcGVuZCBtb3JlIHRpbWUgdG8gdHJ5IHRvIGZpbmQgYSBiYXJjb2RlOyBvcHRpbWl6ZSBmb3IgYWNjdXJhY3ksIG5vdCBzcGVlZC4KCSAgICAgKiBEb2Vzbid0IG1hdHRlciB3aGF0IGl0IG1hcHMgdG87IHVzZSB7QGxpbmsgQm9vbGVhbiNUUlVFfS4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiVFJZX0hBUkRFUiJdID0gM10gPSAiVFJZX0hBUkRFUiI7IC8qKFZvaWQuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBTcGVjaWZpZXMgd2hhdCBjaGFyYWN0ZXIgZW5jb2RpbmcgdG8gdXNlIHdoZW4gZGVjb2RpbmcsIHdoZXJlIGFwcGxpY2FibGUgKHR5cGUgU3RyaW5nKQoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJDSEFSQUNURVJfU0VUIl0gPSA0XSA9ICJDSEFSQUNURVJfU0VUIjsgLyooU3RyaW5nLmNsYXNzKSovCgkgICAgLyoqCgkgICAgICogQWxsb3dlZCBsZW5ndGhzIG9mIGVuY29kZWQgZGF0YSAtLSByZWplY3QgYW55dGhpbmcgZWxzZS4gTWFwcyB0byBhbiB7QGNvZGUgSW50MzJBcnJheX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIkFMTE9XRURfTEVOR1RIUyJdID0gNV0gPSAiQUxMT1dFRF9MRU5HVEhTIjsgLyooSW50MzJBcnJheS5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIEFzc3VtZSBDb2RlIDM5IGNvZGVzIGVtcGxveSBhIGNoZWNrIGRpZ2l0LiBEb2Vzbid0IG1hdHRlciB3aGF0IGl0IG1hcHMgdG87CgkgICAgICogdXNlIHtAbGluayBCb29sZWFuI1RSVUV9LgoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJBU1NVTUVfQ09ERV8zOV9DSEVDS19ESUdJVCJdID0gNl0gPSAiQVNTVU1FX0NPREVfMzlfQ0hFQ0tfRElHSVQiOyAvKihWb2lkLmNsYXNzKSovCgkgICAgLyoqCgkgICAgICogQXNzdW1lIHRoZSBiYXJjb2RlIGlzIGJlaW5nIHByb2Nlc3NlZCBhcyBhIEdTMSBiYXJjb2RlLCBhbmQgbW9kaWZ5IGJlaGF2aW9yIGFzIG5lZWRlZC4KCSAgICAgKiBGb3IgZXhhbXBsZSB0aGlzIGFmZmVjdHMgRk5DMSBoYW5kbGluZyBmb3IgQ29kZSAxMjggKGFrYSBHUzEtMTI4KS4gRG9lc24ndCBtYXR0ZXIgd2hhdCBpdCBtYXBzIHRvOwoJICAgICAqIHVzZSB7QGxpbmsgQm9vbGVhbiNUUlVFfS4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiQVNTVU1FX0dTMSJdID0gN10gPSAiQVNTVU1FX0dTMSI7IC8qKFZvaWQuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBJZiB0cnVlLCByZXR1cm4gdGhlIHN0YXJ0IGFuZCBlbmQgZGlnaXRzIGluIGEgQ29kYWJhciBiYXJjb2RlIGluc3RlYWQgb2Ygc3RyaXBwaW5nIHRoZW0uIFRoZXkKCSAgICAgKiBhcmUgYWxwaGEsIHdoZXJlYXMgdGhlIHJlc3QgYXJlIG51bWVyaWMuIEJ5IGRlZmF1bHQsIHRoZXkgYXJlIHN0cmlwcGVkLCBidXQgdGhpcyBjYXVzZXMgdGhlbQoJICAgICAqIHRvIG5vdCBiZS4gRG9lc24ndCBtYXR0ZXIgd2hhdCBpdCBtYXBzIHRvOyB1c2Uge0BsaW5rIEJvb2xlYW4jVFJVRX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIlJFVFVSTl9DT0RBQkFSX1NUQVJUX0VORCJdID0gOF0gPSAiUkVUVVJOX0NPREFCQVJfU1RBUlRfRU5EIjsgLyooVm9pZC5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIFRoZSBjYWxsZXIgbmVlZHMgdG8gYmUgbm90aWZpZWQgdmlhIGNhbGxiYWNrIHdoZW4gYSBwb3NzaWJsZSB7QGxpbmsgUmVzdWx0UG9pbnR9CgkgICAgICogaXMgZm91bmQuIE1hcHMgdG8gYSB7QGxpbmsgUmVzdWx0UG9pbnRDYWxsYmFja30uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIk5FRURfUkVTVUxUX1BPSU5UX0NBTExCQUNLIl0gPSA5XSA9ICJORUVEX1JFU1VMVF9QT0lOVF9DQUxMQkFDSyI7IC8qKFJlc3VsdFBvaW50Q2FsbGJhY2suY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBBbGxvd2VkIGV4dGVuc2lvbiBsZW5ndGhzIGZvciBFQU4gb3IgVVBDIGJhcmNvZGVzLiBPdGhlciBmb3JtYXRzIHdpbGwgaWdub3JlIHRoaXMuCgkgICAgICogTWFwcyB0byBhbiB7QGNvZGUgSW50MzJBcnJheX0gb2YgdGhlIGFsbG93ZWQgZXh0ZW5zaW9uIGxlbmd0aHMsIGZvciBleGFtcGxlIFsyXSwgWzVdLCBvciBbMiwgNV0uCgkgICAgICogSWYgaXQgaXMgb3B0aW9uYWwgdG8gaGF2ZSBhbiBleHRlbnNpb24sIGRvIG5vdCBzZXQgdGhpcyBoaW50LiBJZiB0aGlzIGlzIHNldCwKCSAgICAgKiBhbmQgYSBVUEMgb3IgRUFOIGJhcmNvZGUgaXMgZm91bmQgYnV0IGFuIGV4dGVuc2lvbiBpcyBub3QsIHRoZW4gbm8gcmVzdWx0IHdpbGwgYmUgcmV0dXJuZWQKCSAgICAgKiBhdCBhbGwuCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIkFMTE9XRURfRUFOX0VYVEVOU0lPTlMiXSA9IDEwXSA9ICJBTExPV0VEX0VBTl9FWFRFTlNJT05TIjsgLyooSW50MzJBcnJheS5jbGFzcykqLwoJICAgIC8vIEVuZCBvZiBlbnVtZXJhdGlvbiB2YWx1ZXMuCgkgICAgLyoqCgkgICAgICogRGF0YSB0eXBlIHRoZSBoaW50IGlzIGV4cGVjdGluZy4KCSAgICAgKiBBbW9uZyB0aGUgcG9zc2libGUgdmFsdWVzIHRoZSB7QGxpbmsgVm9pZH0gc3RhbmRzIG91dCBhcyBiZWluZyB1c2VkIGZvcgoJICAgICAqIGhpbnRzIHRoYXQgZG8gbm90IGV4cGVjdCBhIHZhbHVlIHRvIGJlIHN1cHBsaWVkIChmbGFnIGhpbnRzKS4gU3VjaCBoaW50cwoJICAgICAqIHdpbGwgcG9zc2libHkgaGF2ZSB0aGVpciB2YWx1ZSBpZ25vcmVkLCBvciByZXBsYWNlZCBieSBhCgkgICAgICoge0BsaW5rIEJvb2xlYW4jVFJVRX0uIEhpbnQgc3VwcGxpZXJzIHNob3VsZCBwcm9iYWJseSB1c2UKCSAgICAgKiB7QGxpbmsgQm9vbGVhbiNUUlVFfSBhcyBkaXJlY3RlZCBieSB0aGUgYWN0dWFsIGhpbnQgZG9jdW1lbnRhdGlvbi4KCSAgICAgKi8KCSAgICAvLyBwcml2YXRlIHZhbHVlVHlwZTogQ2xhc3M8Pz4KCSAgICAvLyBEZWNvZGVIaW50VHlwZSh2YWx1ZVR5cGU6IENsYXNzPD8+KSB7CgkgICAgLy8gICB0aGlzLnZhbHVlVHlwZSA9IHZhbHVlVHlwZQoJICAgIC8vIH0KCSAgICAvLyBwdWJsaWMgZ2V0VmFsdWVUeXBlKCk6IENsYXNzPD8+IHsKCSAgICAvLyAgIHJldHVybiB2YWx1ZVR5cGUKCSAgICAvLyB9Cgl9KShEZWNvZGVIaW50VHlwZSB8fCAoRGVjb2RlSGludFR5cGUgPSB7fSkpOwoJRGVjb2RlSGludFR5cGUkMS5kZWZhdWx0ID0gRGVjb2RlSGludFR5cGU7CgoJdmFyIENoYXJhY3RlclNldEVDSSA9IHt9OwoKCXZhciBGb3JtYXRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZiA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShGb3JtYXRFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDcgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgRm9ybWF0RXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyRmKEZvcm1hdEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBGb3JtYXRFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgRm9ybWF0RXhjZXB0aW9uLmdldEZvcm1hdEluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEZvcm1hdEV4Y2VwdGlvbigpOwoJICAgIH07CgkgICAgRm9ybWF0RXhjZXB0aW9uLmtpbmQgPSAnRm9ybWF0RXhjZXB0aW9uJzsKCSAgICByZXR1cm4gRm9ybWF0RXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQ3LmRlZmF1bHQpKTsKCUZvcm1hdEV4Y2VwdGlvbiQxLmRlZmF1bHQgPSBGb3JtYXRFeGNlcHRpb247CgoJKGZ1bmN0aW9uIChleHBvcnRzKSB7CgkvKgoJICogQ29weXJpZ2h0IDIwMDggWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCWV4cG9ydHMuQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycyA9IHZvaWQgMDsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xID0gRm9ybWF0RXhjZXB0aW9uJDE7CgkvKmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsqLwoJLyppbXBvcnQgamF2YS51dGlsLk1hcDsqLwoJdmFyIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnM7CgkoZnVuY3Rpb24gKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMpIHsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkNwNDM3Il0gPSAwXSA9ICJDcDQzNyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEiXSA9IDFdID0gIklTTzg4NTlfMSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzIiXSA9IDJdID0gIklTTzg4NTlfMiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzMiXSA9IDNdID0gIklTTzg4NTlfMyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzQiXSA9IDRdID0gIklTTzg4NTlfNCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzUiXSA9IDVdID0gIklTTzg4NTlfNSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzYiXSA9IDZdID0gIklTTzg4NTlfNiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzciXSA9IDddID0gIklTTzg4NTlfNyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzgiXSA9IDhdID0gIklTTzg4NTlfOCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzkiXSA9IDldID0gIklTTzg4NTlfOSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEwIl0gPSAxMF0gPSAiSVNPODg1OV8xMCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzExIl0gPSAxMV0gPSAiSVNPODg1OV8xMSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEzIl0gPSAxMl0gPSAiSVNPODg1OV8xMyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE0Il0gPSAxM10gPSAiSVNPODg1OV8xNCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE1Il0gPSAxNF0gPSAiSVNPODg1OV8xNSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE2Il0gPSAxNV0gPSAiSVNPODg1OV8xNiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJTSklTIl0gPSAxNl0gPSAiU0pJUyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJDcDEyNTAiXSA9IDE3XSA9ICJDcDEyNTAiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siQ3AxMjUxIl0gPSAxOF0gPSAiQ3AxMjUxIjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkNwMTI1MiJdID0gMTldID0gIkNwMTI1MiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJDcDEyNTYiXSA9IDIwXSA9ICJDcDEyNTYiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siVW5pY29kZUJpZ1VubWFya2VkIl0gPSAyMV0gPSAiVW5pY29kZUJpZ1VubWFya2VkIjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIlVURjgiXSA9IDIyXSA9ICJVVEY4IjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkFTQ0lJIl0gPSAyM10gPSAiQVNDSUkiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siQmlnNSJdID0gMjRdID0gIkJpZzUiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siR0IxODAzMCJdID0gMjVdID0gIkdCMTgwMzAiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siRVVDX0tSIl0gPSAyNl0gPSAiRVVDX0tSIjsKCX0pKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMgPSBleHBvcnRzLkNoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMgfHwgKGV4cG9ydHMuQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycyA9IHt9KSk7CgkvKioKCSAqIEVuY2Fwc3VsYXRlcyBhIENoYXJhY3RlciBTZXQgRUNJLCBhY2NvcmRpbmcgdG8gIkV4dGVuZGVkIENoYW5uZWwgSW50ZXJwcmV0YXRpb25zIiA1LjMuMS4xCgkgKiBvZiBJU08gMTgwMDQuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIENoYXJhY3RlclNldEVDSSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBDaGFyYWN0ZXJTZXRFQ0kodmFsdWVJZGVudGlmaWVyLCB2YWx1ZXNQYXJhbSwgbmFtZSkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIG90aGVyRW5jb2RpbmdOYW1lcyA9IFtdOwoJICAgICAgICBmb3IgKHZhciBfaSA9IDM7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJICAgICAgICAgICAgb3RoZXJFbmNvZGluZ05hbWVzW19pIC0gM10gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMudmFsdWVJZGVudGlmaWVyID0gdmFsdWVJZGVudGlmaWVyOwoJICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOwoJICAgICAgICBpZiAodHlwZW9mIHZhbHVlc1BhcmFtID09PSAnbnVtYmVyJykgewoJICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSBJbnQzMkFycmF5LmZyb20oW3ZhbHVlc1BhcmFtXSk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICB0aGlzLnZhbHVlcyA9IHZhbHVlc1BhcmFtOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMub3RoZXJFbmNvZGluZ05hbWVzID0gb3RoZXJFbmNvZGluZ05hbWVzOwoJICAgICAgICBDaGFyYWN0ZXJTZXRFQ0kuVkFMVUVfSURFTlRJRklFUl9UT19FQ0kuc2V0KHZhbHVlSWRlbnRpZmllciwgdGhpcyk7CgkgICAgICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSS5zZXQobmFtZSwgdGhpcyk7CgkgICAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLnZhbHVlczsKCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gdmFsdWVzLmxlbmd0aDsgaSAhPT0gbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgdmFyIHYgPSB2YWx1ZXNbaV07CgkgICAgICAgICAgICBDaGFyYWN0ZXJTZXRFQ0kuVkFMVUVTX1RPX0VDSS5zZXQodiwgdGhpcyk7CgkgICAgICAgIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIG90aGVyRW5jb2RpbmdOYW1lc18xID0gX192YWx1ZXMob3RoZXJFbmNvZGluZ05hbWVzKSwgb3RoZXJFbmNvZGluZ05hbWVzXzFfMSA9IG90aGVyRW5jb2RpbmdOYW1lc18xLm5leHQoKTsgIW90aGVyRW5jb2RpbmdOYW1lc18xXzEuZG9uZTsgb3RoZXJFbmNvZGluZ05hbWVzXzFfMSA9IG90aGVyRW5jb2RpbmdOYW1lc18xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgIHZhciBvdGhlck5hbWUgPSBvdGhlckVuY29kaW5nTmFtZXNfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSS5zZXQob3RoZXJOYW1lLCB0aGlzKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKG90aGVyRW5jb2RpbmdOYW1lc18xXzEgJiYgIW90aGVyRW5jb2RpbmdOYW1lc18xXzEuZG9uZSAmJiAoX2EgPSBvdGhlckVuY29kaW5nTmFtZXNfMS5yZXR1cm4pKSBfYS5jYWxsKG90aGVyRW5jb2RpbmdOYW1lc18xKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgIH0KCSAgICAvLyBDaGFyYWN0ZXJTZXRFQ0kodmFsdWU6IG51bWJlciAvKmludCovKSB7CgkgICAgLy8gICB0aGlzKG5ldyBJbnQzMkFycmF5IHt2YWx1ZX0pCgkgICAgLy8gfQoJICAgIC8vIENoYXJhY3RlclNldEVDSSh2YWx1ZTogbnVtYmVyIC8qaW50Ki8sIFN0cmluZy4uLiBvdGhlckVuY29kaW5nTmFtZXMpIHsKCSAgICAvLyAgIHRoaXMudmFsdWVzID0gbmV3IEludDMyQXJyYXkge3ZhbHVlfQoJICAgIC8vICAgdGhpcy5vdGhlckVuY29kaW5nTmFtZXMgPSBvdGhlckVuY29kaW5nTmFtZXMKCSAgICAvLyB9CgkgICAgLy8gQ2hhcmFjdGVyU2V0RUNJKHZhbHVlczogSW50MzJBcnJheSwgU3RyaW5nLi4uIG90aGVyRW5jb2RpbmdOYW1lcykgewoJICAgIC8vICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXMKCSAgICAvLyAgIHRoaXMub3RoZXJFbmNvZGluZ05hbWVzID0gb3RoZXJFbmNvZGluZ05hbWVzCgkgICAgLy8gfQoJICAgIENoYXJhY3RlclNldEVDSS5wcm90b3R5cGUuZ2V0VmFsdWVJZGVudGlmaWVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZUlkZW50aWZpZXI7CgkgICAgfTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kucHJvdG90eXBlLmdldE5hbWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm5hbWU7CgkgICAgfTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZXNbMF07CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gdmFsdWUgY2hhcmFjdGVyIHNldCBFQ0kgdmFsdWUKCSAgICAgKiBAcmV0dXJuIHtAY29kZSBDaGFyYWN0ZXJTZXRFQ0l9IHJlcHJlc2VudGluZyBFQ0kgb2YgZ2l2ZW4gdmFsdWUsIG9yIG51bGwgaWYgaXQgaXMgbGVnYWwgYnV0CgkgICAgICogICB1bnN1cHBvcnRlZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIEVDSSB2YWx1ZSBpcyBpbnZhbGlkCgkgICAgICovCgkgICAgQ2hhcmFjdGVyU2V0RUNJLmdldENoYXJhY3RlclNldEVDSUJ5VmFsdWUgPSBmdW5jdGlvbiAodmFsdWUgLyppbnQqLykgewoJICAgICAgICBpZiAodmFsdWUgPCAwIHx8IHZhbHVlID49IDkwMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoJ2luY29yZWN0IHZhbHVlJyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGNoYXJhY3RlclNldCA9IENoYXJhY3RlclNldEVDSS5WQUxVRVNfVE9fRUNJLmdldCh2YWx1ZSk7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGNoYXJhY3RlclNldCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoJ2luY29yZWN0IHZhbHVlJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGNoYXJhY3RlclNldDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBuYW1lIGNoYXJhY3RlciBzZXQgRUNJIGVuY29kaW5nIG5hbWUKCSAgICAgKiBAcmV0dXJuIENoYXJhY3RlclNldEVDSSByZXByZXNlbnRpbmcgRUNJIGZvciBjaGFyYWN0ZXIgZW5jb2RpbmcsIG9yIG51bGwgaWYgaXQgaXMgbGVnYWwKCSAgICAgKiAgIGJ1dCB1bnN1cHBvcnRlZAoJICAgICAqLwoJICAgIENoYXJhY3RlclNldEVDSS5nZXRDaGFyYWN0ZXJTZXRFQ0lCeU5hbWUgPSBmdW5jdGlvbiAobmFtZSkgewoJICAgICAgICB2YXIgY2hhcmFjdGVyU2V0ID0gQ2hhcmFjdGVyU2V0RUNJLk5BTUVfVE9fRUNJLmdldChuYW1lKTsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gY2hhcmFjdGVyU2V0KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgnaW5jb3JlY3QgdmFsdWUnKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gY2hhcmFjdGVyU2V0OwoJICAgIH07CgkgICAgQ2hhcmFjdGVyU2V0RUNJLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgQ2hhcmFjdGVyU2V0RUNJKSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLmdldE5hbWUoKSA9PT0gb3RoZXIuZ2V0TmFtZSgpOwoJICAgIH07CgkgICAgQ2hhcmFjdGVyU2V0RUNJLlZBTFVFX0lERU5USUZJRVJfVE9fRUNJID0gbmV3IE1hcCgpOwoJICAgIENoYXJhY3RlclNldEVDSS5WQUxVRVNfVE9fRUNJID0gbmV3IE1hcCgpOwoJICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSSA9IG5ldyBNYXAoKTsKCSAgICAvLyBFbnVtIG5hbWUgaXMgYSBKYXZhIGVuY29kaW5nIHZhbGlkIGZvciBqYXZhLmxhbmcgYW5kIGphdmEuaW8KCSAgICAvLyBUWVBFU0NSSVBUUE9SVDogY2hhbmdlZCB0aGUgbWFpbiBsYWJlbCBmb3IgSVNPIGFzIHRoZSBUZXh0RW5jb2RlciBkaWQgbm90IHJlY29nbml6ZWQgdGhlbSBpbiB0aGUgZm9ybSBmcm9tIGphdmEKCSAgICAvLyAoZWcgSVNPODg1OV8xIG11c3QgYmUgSVNPODg1OTEgb3IgSVNPODg1OS0xIG9yIElTTy04ODU5LTEpCgkgICAgLy8gbGF0ZXIgb246IHdlbGwsIGV4Y2VwdCAxNiB3aWNoIGRvZXMgbm90IHdvcmsgd2l0aCBJU084ODU5MTYgc28gdXNlZCBJU08tODg1OS0xIGZvcm0gZm9yIGRlZmF1bHQKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuQ3A0MzcgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQ3A0MzcsIEludDMyQXJyYXkuZnJvbShbMCwgMl0pLCAnQ3A0MzcnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMSwgSW50MzJBcnJheS5mcm9tKFsxLCAzXSksICdJU08tODg1OS0xJywgJ0lTTzg4NTkxJywgJ0lTTzg4NTlfMScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzIgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8yLCA0LCAnSVNPLTg4NTktMicsICdJU084ODU5MicsICdJU084ODU5XzInKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8zID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMywgNSwgJ0lTTy04ODU5LTMnLCAnSVNPODg1OTMnLCAnSVNPODg1OV8zJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfNCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzQsIDYsICdJU08tODg1OS00JywgJ0lTTzg4NTk0JywgJ0lTTzg4NTlfNCcpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV81LCA3LCAnSVNPLTg4NTktNScsICdJU084ODU5NScsICdJU084ODU5XzUnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV82ID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfNiwgOCwgJ0lTTy04ODU5LTYnLCAnSVNPODg1OTYnLCAnSVNPODg1OV82Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfNyA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzcsIDksICdJU08tODg1OS03JywgJ0lTTzg4NTk3JywgJ0lTTzg4NTlfNycpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzggPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV84LCAxMCwgJ0lTTy04ODU5LTgnLCAnSVNPODg1OTgnLCAnSVNPODg1OV84Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfOSA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzksIDExLCAnSVNPLTg4NTktOScsICdJU084ODU5OScsICdJU084ODU5XzknKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xMCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzEwLCAxMiwgJ0lTTy04ODU5LTEwJywgJ0lTTzg4NTkxMCcsICdJU084ODU5XzEwJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfMTEgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8xMSwgMTMsICdJU08tODg1OS0xMScsICdJU084ODU5MTEnLCAnSVNPODg1OV8xMScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzEzID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMTMsIDE1LCAnSVNPLTg4NTktMTMnLCAnSVNPODg1OTEzJywgJ0lTTzg4NTlfMTMnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xNCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzE0LCAxNiwgJ0lTTy04ODU5LTE0JywgJ0lTTzg4NTkxNCcsICdJU084ODU5XzE0Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfMTUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8xNSwgMTcsICdJU08tODg1OS0xNScsICdJU084ODU5MTUnLCAnSVNPODg1OV8xNScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzE2ID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMTYsIDE4LCAnSVNPLTg4NTktMTYnLCAnSVNPODg1OTE2JywgJ0lTTzg4NTlfMTYnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuU0pJUyA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5TSklTLCAyMCwgJ1NKSVMnLCAnU2hpZnRfSklTJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkNwMTI1MCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5DcDEyNTAsIDIxLCAnQ3AxMjUwJywgJ3dpbmRvd3MtMTI1MCcpOwoJICAgIENoYXJhY3RlclNldEVDSS5DcDEyNTEgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQ3AxMjUxLCAyMiwgJ0NwMTI1MScsICd3aW5kb3dzLTEyNTEnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuQ3AxMjUyID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLkNwMTI1MiwgMjMsICdDcDEyNTInLCAnd2luZG93cy0xMjUyJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkNwMTI1NiA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5DcDEyNTYsIDI0LCAnQ3AxMjU2JywgJ3dpbmRvd3MtMTI1NicpOwoJICAgIENoYXJhY3RlclNldEVDSS5Vbmljb2RlQmlnVW5tYXJrZWQgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuVW5pY29kZUJpZ1VubWFya2VkLCAyNSwgJ1VuaWNvZGVCaWdVbm1hcmtlZCcsICdVVEYtMTZCRScsICdVbmljb2RlQmlnJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLlVURjggPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuVVRGOCwgMjYsICdVVEY4JywgJ1VURi04Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkFTQ0lJID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLkFTQ0lJLCBJbnQzMkFycmF5LmZyb20oWzI3LCAxNzBdKSwgJ0FTQ0lJJywgJ1VTLUFTQ0lJJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkJpZzUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQmlnNSwgMjgsICdCaWc1Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkdCMTgwMzAgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuR0IxODAzMCwgMjksICdHQjE4MDMwJywgJ0dCMjMxMicsICdFVUNfQ04nLCAnR0JLJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkVVQ19LUiA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5FVUNfS1IsIDMwLCAnRVVDX0tSJywgJ0VVQy1LUicpOwoJICAgIHJldHVybiBDaGFyYWN0ZXJTZXRFQ0k7Cgl9KCkpOwoJZXhwb3J0cy5kZWZhdWx0ID0gQ2hhcmFjdGVyU2V0RUNJOwoKCX0oQ2hhcmFjdGVyU2V0RUNJKSk7CgoJdmFyIFN0cmluZ0VuY29kaW5nJDEgPSB7fTsKCgl2YXIgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNiA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZShVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbi5raW5kID0gJ1Vuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDYuZGVmYXVsdCkpOwoJVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24kMS5kZWZhdWx0ID0gVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb247CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZ0VuY29kaW5nJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbl8xJDEgPSBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiQxOwoJdmFyIENoYXJhY3RlclNldEVDSV8xJDIgPSBDaGFyYWN0ZXJTZXRFQ0k7CgkvKioKCSAqIFJlc3BvbnNpYmxlIGZvciBlbi9kZWNvZGluZyBzdHJpbmdzLgoJICovCgl2YXIgU3RyaW5nRW5jb2RpbmcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nRW5jb2RpbmcoKSB7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIERlY29kZXMgc29tZSBVaW50OEFycmF5IHRvIGEgc3RyaW5nIGZvcm1hdC4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5kZWNvZGUgPSBmdW5jdGlvbiAoYnl0ZXMsIGVuY29kaW5nKSB7CgkgICAgICAgIHZhciBlbmNvZGluZ05hbWUgPSB0aGlzLmVuY29kaW5nTmFtZShlbmNvZGluZyk7CgkgICAgICAgIGlmICh0aGlzLmN1c3RvbURlY29kZXIpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmN1c3RvbURlY29kZXIoYnl0ZXMsIGVuY29kaW5nTmFtZSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gSW5jcmVhc2VzIGJyb3dzZXIgc3VwcG9ydC4KCSAgICAgICAgaWYgKHR5cGVvZiBUZXh0RGVjb2RlciA9PT0gJ3VuZGVmaW5lZCcgfHwgdGhpcy5zaG91bGREZWNvZGVPbkZhbGxiYWNrKGVuY29kaW5nTmFtZSkpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUZhbGxiYWNrKGJ5dGVzLCBlbmNvZGluZ05hbWUpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgVGV4dERlY29kZXIoZW5jb2RpbmdOYW1lKS5kZWNvZGUoYnl0ZXMpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ2hlY2tzIGlmIHRoZSBkZWNvZGluZyBtZXRob2Qgc2hvdWxkIHVzZSB0aGUgZmFsbGJhY2sgZm9yIGRlY29kaW5nCgkgICAgICogb25jZSBOb2RlIFRleHREZWNvZGVyIGRvZXNuJ3Qgc3VwcG9ydCBhbGwgZW5jb2RpbmcgZm9ybWF0cy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBlbmNvZGluZ05hbWUKCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5zaG91bGREZWNvZGVPbkZhbGxiYWNrID0gZnVuY3Rpb24gKGVuY29kaW5nTmFtZSkgewoJICAgICAgICByZXR1cm4gIVN0cmluZ0VuY29kaW5nLmlzQnJvd3NlcigpICYmIGVuY29kaW5nTmFtZSA9PT0gJ0lTTy04ODU5LTEnOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRW5jb2RlcyBzb21lIHN0cmluZyBpbnRvIGEgVWludDhBcnJheS4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5lbmNvZGUgPSBmdW5jdGlvbiAocywgZW5jb2RpbmcpIHsKCSAgICAgICAgdmFyIGVuY29kaW5nTmFtZSA9IHRoaXMuZW5jb2RpbmdOYW1lKGVuY29kaW5nKTsKCSAgICAgICAgaWYgKHRoaXMuY3VzdG9tRW5jb2RlcikgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tRW5jb2RlcihzLCBlbmNvZGluZ05hbWUpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEluY3JlYXNlcyBicm93c2VyIHN1cHBvcnQuCgkgICAgICAgIGlmICh0eXBlb2YgVGV4dEVuY29kZXIgPT09ICd1bmRlZmluZWQnKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5lbmNvZGVGYWxsYmFjayhzKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBUZXh0RW5jb2RlciBvbmx5IGVuY29kZXMgdG8gVVRGOCBieSBkZWZhdWx0IGFzIHNwZWNpZmllZCBieSBlbmNvZGluZy5zcGVjLndoYXR3Zy5vcmcKCSAgICAgICAgcmV0dXJuIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShzKTsKCSAgICB9OwoJICAgIFN0cmluZ0VuY29kaW5nLmlzQnJvd3NlciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB7fS50b1N0cmluZy5jYWxsKHdpbmRvdykgPT09ICdbb2JqZWN0IFdpbmRvd10nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIHN0cmluZyB2YWx1ZSBmcm9tIHNvbWUgZW5jb2RpbmcgY2hhcmFjdGVyIHNldC4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5lbmNvZGluZ05hbWUgPSBmdW5jdGlvbiAoZW5jb2RpbmcpIHsKCSAgICAgICAgcmV0dXJuIHR5cGVvZiBlbmNvZGluZyA9PT0gJ3N0cmluZycKCSAgICAgICAgICAgID8gZW5jb2RpbmcKCSAgICAgICAgICAgIDogZW5jb2RpbmcuZ2V0TmFtZSgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV0dXJucyBjaGFyYWN0ZXIgc2V0IGZyb20gc29tZSBlbmNvZGluZyBjaGFyYWN0ZXIgc2V0LgoJICAgICAqLwoJICAgIFN0cmluZ0VuY29kaW5nLmVuY29kaW5nQ2hhcmFjdGVyU2V0ID0gZnVuY3Rpb24gKGVuY29kaW5nKSB7CgkgICAgICAgIGlmIChlbmNvZGluZyBpbnN0YW5jZW9mIENoYXJhY3RlclNldEVDSV8xJDIuZGVmYXVsdCkgewoJICAgICAgICAgICAgcmV0dXJuIGVuY29kaW5nOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuZ2V0Q2hhcmFjdGVyU2V0RUNJQnlOYW1lKGVuY29kaW5nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJ1bnMgYSBmYWxsYmFjayBmb3IgdGhlIG5hdGl2ZSBkZWNvZGluZyBmdW5jaW9uLgoJICAgICAqLwoJICAgIFN0cmluZ0VuY29kaW5nLmRlY29kZUZhbGxiYWNrID0gZnVuY3Rpb24gKGJ5dGVzLCBlbmNvZGluZykgewoJICAgICAgICB2YXIgY2hhcmFjdGVyU2V0ID0gdGhpcy5lbmNvZGluZ0NoYXJhY3RlclNldChlbmNvZGluZyk7CgkgICAgICAgIGlmIChTdHJpbmdFbmNvZGluZy5pc0RlY29kZUZhbGxiYWNrU3VwcG9ydGVkKGNoYXJhY3RlclNldCkpIHsKCSAgICAgICAgICAgIHZhciBzID0gJyc7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoXzEgPSBieXRlcy5sZW5ndGg7IGkgPCBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGggPSBieXRlc1tpXS50b1N0cmluZygxNik7CgkgICAgICAgICAgICAgICAgaWYgKGgubGVuZ3RoIDwgMikgewoJICAgICAgICAgICAgICAgICAgICBoID0gJzAnICsgaDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcyArPSAnJScgKyBoOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChzKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuVW5pY29kZUJpZ1VubWFya2VkKSkgewoJICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgbmV3IFVpbnQxNkFycmF5KGJ5dGVzLmJ1ZmZlcikpOwoJICAgICAgICB9CgkgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgiRW5jb2RpbmcgIiArIHRoaXMuZW5jb2RpbmdOYW1lKGVuY29kaW5nKSArICIgbm90IHN1cHBvcnRlZCBieSBmYWxsYmFjay4iKTsKCSAgICB9OwoJICAgIFN0cmluZ0VuY29kaW5nLmlzRGVjb2RlRmFsbGJhY2tTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoY2hhcmFjdGVyU2V0KSB7CgkgICAgICAgIHJldHVybiBjaGFyYWN0ZXJTZXQuZXF1YWxzKENoYXJhY3RlclNldEVDSV8xJDIuZGVmYXVsdC5VVEY4KSB8fAoJICAgICAgICAgICAgY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuSVNPODg1OV8xKSB8fAoJICAgICAgICAgICAgY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuQVNDSUkpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUnVucyBhIGZhbGxiYWNrIGZvciB0aGUgbmF0aXZlIGVuY29kaW5nIGZ1bmNpb24uCgkgICAgICoKCSAgICAgKiBAc2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xNzE5Mjg0NS80MzY3NjgzCgkgICAgICovCgkgICAgU3RyaW5nRW5jb2RpbmcuZW5jb2RlRmFsbGJhY2sgPSBmdW5jdGlvbiAocykgewoJICAgICAgICB2YXIgZW5jb2RlZFVSSXN0cmluZyA9IGJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHMpKSk7CgkgICAgICAgIHZhciBjaGFyTGlzdCA9IGVuY29kZWRVUklzdHJpbmcuc3BsaXQoJycpOwoJICAgICAgICB2YXIgdWludEFycmF5ID0gW107CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhckxpc3QubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHVpbnRBcnJheS5wdXNoKGNoYXJMaXN0W2ldLmNoYXJDb2RlQXQoMCkpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSh1aW50QXJyYXkpOwoJICAgIH07CgkgICAgcmV0dXJuIFN0cmluZ0VuY29kaW5nOwoJfSgpKTsKCVN0cmluZ0VuY29kaW5nJDEuZGVmYXVsdCA9IFN0cmluZ0VuY29kaW5nOwoKCS8qCgkgKiBDb3B5cmlnaHQgKEMpIDIwMTAgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZ1V0aWxzJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS5uaW8uY2hhcnNldC5DaGFyc2V0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgl2YXIgRGVjb2RlSGludFR5cGVfMSQzID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBDaGFyYWN0ZXJTZXRFQ0lfMSQxID0gQ2hhcmFjdGVyU2V0RUNJOwoJdmFyIFN0cmluZ0VuY29kaW5nXzEkMSA9IFN0cmluZ0VuY29kaW5nJDE7CgkvKioKCSAqIENvbW1vbiBzdHJpbmctcmVsYXRlZCBmdW5jdGlvbnMuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBhdXRob3IgQWxleCBEdXByZQoJICovCgl2YXIgU3RyaW5nVXRpbHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nVXRpbHMoKSB7CgkgICAgfQoJICAgIC8vIFNISUZUX0pJUy5lcXVhbHNJZ25vcmVDYXNlKFBMQVRGT1JNX0RFRkFVTFRfRU5DT0RJTkcpIHx8CgkgICAgLy8gRVVDX0pQLmVxdWFsc0lnbm9yZUNhc2UoUExBVEZPUk1fREVGQVVMVF9FTkNPRElORyk7CgkgICAgU3RyaW5nVXRpbHMuY2FzdEFzTm9uVXRmOENoYXIgPSBmdW5jdGlvbiAoY29kZSwgZW5jb2RpbmcpIHsKCSAgICAgICAgaWYgKGVuY29kaW5nID09PSB2b2lkIDApIHsgZW5jb2RpbmcgPSBudWxsOyB9CgkgICAgICAgIC8vIElTTyA4ODU5LTEgaXMgdGhlIEphdmEgZGVmYXVsdCBhcyBVVEYtOCBpcyBKYXZhU2NyaXB0cwoJICAgICAgICAvLyB5b3UgY2FuIHNlZSB0aGlzIG1ldGhvZCBhcyBhIEphdmEgdmVyc2lvbiBvZiBTdHJpbmcuZnJvbUNoYXJDb2RlCgkgICAgICAgIHZhciBlID0gZW5jb2RpbmcgPyBlbmNvZGluZy5nZXROYW1lKCkgOiB0aGlzLklTTzg4NTkxOwoJICAgICAgICAvLyB1c2UgcGFzc2VkIGZvcm1hdCAoZnJvbUNoYXJDb2RlIHdpbGwgcmV0dXJuIFVURjggZW5jb2RpbmcpCgkgICAgICAgIHJldHVybiBTdHJpbmdFbmNvZGluZ18xJDEuZGVmYXVsdC5kZWNvZGUobmV3IFVpbnQ4QXJyYXkoW2NvZGVdKSwgZSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYnl0ZXMgYnl0ZXMgZW5jb2RpbmcgYSBzdHJpbmcsIHdob3NlIGVuY29kaW5nIHNob3VsZCBiZSBndWVzc2VkCgkgICAgICogQHBhcmFtIGhpbnRzIGRlY29kZSBoaW50cyBpZiBhcHBsaWNhYmxlCgkgICAgICogQHJldHVybiBuYW1lIG9mIGd1ZXNzZWQgZW5jb2Rpbmc7IGF0IHRoZSBtb21lbnQgd2lsbCBvbmx5IGd1ZXNzIG9uZSBvZjoKCSAgICAgKiAge0BsaW5rICNTSElGVF9KSVN9LCB7QGxpbmsgI1VURjh9LCB7QGxpbmsgI0lTTzg4NTkxfSwgb3IgdGhlIHBsYXRmb3JtCgkgICAgICogIGRlZmF1bHQgZW5jb2RpbmcgaWYgbm9uZSBvZiB0aGVzZSBjYW4gcG9zc2libHkgYmUgY29ycmVjdAoJICAgICAqLwoJICAgIFN0cmluZ1V0aWxzLmd1ZXNzRW5jb2RpbmcgPSBmdW5jdGlvbiAoYnl0ZXMsIGhpbnRzKSB7CgkgICAgICAgIGlmIChoaW50cyAhPT0gbnVsbCAmJiBoaW50cyAhPT0gdW5kZWZpbmVkICYmIHVuZGVmaW5lZCAhPT0gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEkMy5kZWZhdWx0LkNIQVJBQ1RFUl9TRVQpKSB7CgkgICAgICAgICAgICByZXR1cm4gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEkMy5kZWZhdWx0LkNIQVJBQ1RFUl9TRVQpLnRvU3RyaW5nKCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRm9yIG5vdywgbWVyZWx5IHRyaWVzIHRvIGRpc3Rpbmd1aXNoIElTTy04ODU5LTEsIFVURi04IGFuZCBTaGlmdF9KSVMsCgkgICAgICAgIC8vIHdoaWNoIHNob3VsZCBiZSBieSBmYXIgdGhlIG1vc3QgY29tbW9uIGVuY29kaW5ncy4KCSAgICAgICAgdmFyIGxlbmd0aCA9IGJ5dGVzLmxlbmd0aDsKCSAgICAgICAgdmFyIGNhbkJlSVNPODg1OTEgPSB0cnVlOwoJICAgICAgICB2YXIgY2FuQmVTaGlmdEpJUyA9IHRydWU7CgkgICAgICAgIHZhciBjYW5CZVVURjggPSB0cnVlOwoJICAgICAgICB2YXIgdXRmOEJ5dGVzTGVmdCA9IDA7CgkgICAgICAgIC8vIGludCB1dGY4TG93Q2hhcnMgPSAwCgkgICAgICAgIHZhciB1dGYyQnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciB1dGYzQnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciB1dGY0Qnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciBzamlzQnl0ZXNMZWZ0ID0gMDsKCSAgICAgICAgLy8gaW50IHNqaXNMb3dDaGFycyA9IDAKCSAgICAgICAgdmFyIHNqaXNLYXRha2FuYUNoYXJzID0gMDsKCSAgICAgICAgLy8gaW50IHNqaXNEb3VibGVCeXRlc0NoYXJzID0gMAoJICAgICAgICB2YXIgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgIHZhciBzamlzQ3VyRG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gMDsKCSAgICAgICAgdmFyIHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPSAwOwoJICAgICAgICB2YXIgc2ppc01heERvdWJsZUJ5dGVzV29yZExlbmd0aCA9IDA7CgkgICAgICAgIC8vIGludCBpc29Mb3dDaGFycyA9IDAKCSAgICAgICAgLy8gaW50IGlzb0hpZ2hDaGFycyA9IDAKCSAgICAgICAgdmFyIGlzb0hpZ2hPdGhlciA9IDA7CgkgICAgICAgIHZhciB1dGY4Ym9tID0gYnl0ZXMubGVuZ3RoID4gMyAmJgoJICAgICAgICAgICAgYnl0ZXNbMF0gPT09IC8qKGJ5dGUpICovIDB4RUYgJiYKCSAgICAgICAgICAgIGJ5dGVzWzFdID09PSAvKihieXRlKSAqLyAweEJCICYmCgkgICAgICAgICAgICBieXRlc1syXSA9PT0gLyooYnl0ZSkgKi8gMHhCRjsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGggJiYgKGNhbkJlSVNPODg1OTEgfHwgY2FuQmVTaGlmdEpJUyB8fCBjYW5CZVVURjgpOyBpKyspIHsKCSAgICAgICAgICAgIHZhciB2YWx1ZSA9IGJ5dGVzW2ldICYgMHhGRjsKCSAgICAgICAgICAgIC8vIFVURi04IHN0dWZmCgkgICAgICAgICAgICBpZiAoY2FuQmVVVEY4KSB7CgkgICAgICAgICAgICAgICAgaWYgKHV0ZjhCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDgwKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgY2FuQmVVVEY4ID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0LS07CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAoKHZhbHVlICYgMHg4MCkgIT09IDApIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCh2YWx1ZSAmIDB4NDApID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjYW5CZVVURjggPSBmYWxzZTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjhCeXRlc0xlZnQrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDIwKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjJCeXRlc0NoYXJzKys7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh2YWx1ZSAmIDB4MTApID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjNCeXRlc0NoYXJzKys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDA4KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRmNEJ5dGVzQ2hhcnMrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbkJlVVRGOCA9IGZhbHNlOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfSAvLyBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyB1dGY4TG93Q2hhcnMrKwoJICAgICAgICAgICAgICAgIC8vIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIElTTy04ODU5LTEgc3R1ZmYKCSAgICAgICAgICAgIGlmIChjYW5CZUlTTzg4NTkxKSB7CgkgICAgICAgICAgICAgICAgaWYgKHZhbHVlID4gMHg3RiAmJiB2YWx1ZSA8IDB4QTApIHsKCSAgICAgICAgICAgICAgICAgICAgY2FuQmVJU084ODU5MSA9IGZhbHNlOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSA+IDB4OUYpIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlIDwgMHhDMCB8fCB2YWx1ZSA9PT0gMHhENyB8fCB2YWx1ZSA9PT0gMHhGNykgewoJICAgICAgICAgICAgICAgICAgICAgICAgaXNvSGlnaE90aGVyKys7CgkgICAgICAgICAgICAgICAgICAgIH0gLy8gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIGlzb0hpZ2hDaGFycysrCgkgICAgICAgICAgICAgICAgICAgIC8vIH0KCSAgICAgICAgICAgICAgICB9IC8vIGVsc2UgewoJICAgICAgICAgICAgICAgIC8vIGlzb0xvd0NoYXJzKysKCSAgICAgICAgICAgICAgICAvLyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBTaGlmdF9KSVMgc3R1ZmYKCSAgICAgICAgICAgIGlmIChjYW5CZVNoaWZ0SklTKSB7CgkgICAgICAgICAgICAgICAgaWYgKHNqaXNCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8IDB4NDAgfHwgdmFsdWUgPT09IDB4N0YgfHwgdmFsdWUgPiAweEZDKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjYW5CZVNoaWZ0SklTID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzamlzQnl0ZXNMZWZ0LS07CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPT09IDB4ODAgfHwgdmFsdWUgPT09IDB4QTAgfHwgdmFsdWUgPiAweEVGKSB7CgkgICAgICAgICAgICAgICAgICAgIGNhbkJlU2hpZnRKSVMgPSBmYWxzZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPiAweEEwICYmIHZhbHVlIDwgMHhFMCkgewoJICAgICAgICAgICAgICAgICAgICBzamlzS2F0YWthbmFDaGFycysrOwoJICAgICAgICAgICAgICAgICAgICBzamlzQ3VyRG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gMDsKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCsrOwoJICAgICAgICAgICAgICAgICAgICBpZiAoc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA+IHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGgpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPSBzamlzQ3VyS2F0YWthbmFXb3JkTGVuZ3RoOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlID4gMHg3RikgewoJICAgICAgICAgICAgICAgICAgICBzamlzQnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgIC8vIHNqaXNEb3VibGVCeXRlc0NoYXJzKysKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgICAgICAgICAgICAgIHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGgrKzsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGggPiBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gc2ppc0N1ckRvdWJsZUJ5dGVzV29yZExlbmd0aDsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gc2ppc0xvd0NoYXJzKysKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgICAgICAgICAgICAgIHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGggPSAwOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBpZiAoY2FuQmVVVEY4ICYmIHV0ZjhCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICBjYW5CZVVURjggPSBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY2FuQmVTaGlmdEpJUyAmJiBzamlzQnl0ZXNMZWZ0ID4gMCkgewoJICAgICAgICAgICAgY2FuQmVTaGlmdEpJUyA9IGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIEVhc3kgLS0gaWYgdGhlcmUgaXMgQk9NIG9yIGF0IGxlYXN0IDEgdmFsaWQgbm90LXNpbmdsZSBieXRlIGNoYXJhY3RlciAoYW5kIG5vIGV2aWRlbmNlIGl0IGNhbid0IGJlIFVURi04KSwgZG9uZQoJICAgICAgICBpZiAoY2FuQmVVVEY4ICYmICh1dGY4Ym9tIHx8IHV0ZjJCeXRlc0NoYXJzICsgdXRmM0J5dGVzQ2hhcnMgKyB1dGY0Qnl0ZXNDaGFycyA+IDApKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuVVRGODsKCSAgICAgICAgfQoJICAgICAgICAvLyBFYXN5IC0tIGlmIGFzc3VtaW5nIFNoaWZ0X0pJUyBvciBhdCBsZWFzdCAzIHZhbGlkIGNvbnNlY3V0aXZlIG5vdC1hc2NpaSBjaGFyYWN0ZXJzIChhbmQgbm8gZXZpZGVuY2UgaXQgY2FuJ3QgYmUpLCBkb25lCgkgICAgICAgIGlmIChjYW5CZVNoaWZ0SklTICYmIChTdHJpbmdVdGlscy5BU1NVTUVfU0hJRlRfSklTIHx8IHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPj0gMyB8fCBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoID49IDMpKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuU0hJRlRfSklTOwoJICAgICAgICB9CgkgICAgICAgIC8vIERpc3Rpbmd1aXNoaW5nIFNoaWZ0X0pJUyBhbmQgSVNPLTg4NTktMSBjYW4gYmUgYSBsaXR0bGUgdG91Z2ggZm9yIHNob3J0IHdvcmRzLiBUaGUgY3J1ZGUgaGV1cmlzdGljIGlzOgoJICAgICAgICAvLyAtIElmIHdlIHNhdwoJICAgICAgICAvLyAgIC0gb25seSB0d28gY29uc2VjdXRpdmUga2F0YWthbmEgY2hhcnMgaW4gdGhlIHdob2xlIHRleHQsIG9yCgkgICAgICAgIC8vICAgLSBhdCBsZWFzdCAxMCUgb2YgYnl0ZXMgdGhhdCBjb3VsZCBiZSAidXBwZXIiIG5vdC1hbHBoYW51bWVyaWMgTGF0aW4xLAoJICAgICAgICAvLyAtIHRoZW4gd2UgY29uY2x1ZGUgU2hpZnRfSklTLCBlbHNlIElTTy04ODU5LTEKCSAgICAgICAgaWYgKGNhbkJlSVNPODg1OTEgJiYgY2FuQmVTaGlmdEpJUykgewoJICAgICAgICAgICAgcmV0dXJuIChzamlzTWF4S2F0YWthbmFXb3JkTGVuZ3RoID09PSAyICYmIHNqaXNLYXRha2FuYUNoYXJzID09PSAyKSB8fCBpc29IaWdoT3RoZXIgKiAxMCA+PSBsZW5ndGgKCSAgICAgICAgICAgICAgICA/IFN0cmluZ1V0aWxzLlNISUZUX0pJUyA6IFN0cmluZ1V0aWxzLklTTzg4NTkxOwoJICAgICAgICB9CgkgICAgICAgIC8vIE90aGVyd2lzZSwgdHJ5IGluIG9yZGVyIElTTy04ODU5LTEsIFNoaWZ0IEpJUywgVVRGLTggYW5kIGZhbGwgYmFjayB0byBkZWZhdWx0IHBsYXRmb3JtIGVuY29kaW5nCgkgICAgICAgIGlmIChjYW5CZUlTTzg4NTkxKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuSVNPODg1OTE7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNhbkJlU2hpZnRKSVMpIHsKCSAgICAgICAgICAgIHJldHVybiBTdHJpbmdVdGlscy5TSElGVF9KSVM7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNhbkJlVVRGOCkgewoJICAgICAgICAgICAgcmV0dXJuIFN0cmluZ1V0aWxzLlVURjg7CgkgICAgICAgIH0KCSAgICAgICAgLy8gT3RoZXJ3aXNlLCB3ZSB0YWtlIGEgd2lsZCBndWVzcyB3aXRoIHBsYXRmb3JtIGVuY29kaW5nCgkgICAgICAgIHJldHVybiBTdHJpbmdVdGlscy5QTEFURk9STV9ERUZBVUxUX0VOQ09ESU5HOwoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKiBAc2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xMzQzOTcxMS80MzY3NjgzCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYXBwZW5kIFRoZSBuZXcgc3RyaW5nIHRvIGFwcGVuZC4KCSAgICAgKiBAcGFyYW0gYXJncyBBcmd1bWV0cyB2YWx1ZXMgdG8gYmUgZm9ybWF0ZWQuCgkgICAgICovCgkgICAgU3RyaW5nVXRpbHMuZm9ybWF0ID0gZnVuY3Rpb24gKGFwcGVuZCkgewoJICAgICAgICB2YXIgYXJncyA9IFtdOwoJICAgICAgICBmb3IgKHZhciBfaSA9IDE7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJICAgICAgICAgICAgYXJnc1tfaSAtIDFdID0gYXJndW1lbnRzW19pXTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgaSA9IC0xOwoJICAgICAgICBmdW5jdGlvbiBjYWxsYmFjayhleHAsIHAwLCBwMSwgcDIsIHAzLCBwNCkgewoJICAgICAgICAgICAgaWYgKGV4cCA9PT0gJyUlJykKCSAgICAgICAgICAgICAgICByZXR1cm4gJyUnOwoJICAgICAgICAgICAgaWYgKGFyZ3NbKytpXSA9PT0gdW5kZWZpbmVkKQoJICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CgkgICAgICAgICAgICBleHAgPSBwMiA/IHBhcnNlSW50KHAyLnN1YnN0cigxKSkgOiB1bmRlZmluZWQ7CgkgICAgICAgICAgICB2YXIgYmFzZSA9IHAzID8gcGFyc2VJbnQocDMuc3Vic3RyKDEpKSA6IHVuZGVmaW5lZDsKCSAgICAgICAgICAgIHZhciB2YWw7CgkgICAgICAgICAgICBzd2l0Y2ggKHA0KSB7CgkgICAgICAgICAgICAgICAgY2FzZSAncyc6CgkgICAgICAgICAgICAgICAgICAgIHZhbCA9IGFyZ3NbaV07CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ2MnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBhcmdzW2ldWzBdOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlICdmJzoKCSAgICAgICAgICAgICAgICAgICAgdmFsID0gcGFyc2VGbG9hdChhcmdzW2ldKS50b0ZpeGVkKGV4cCk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ3AnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KGFyZ3NbaV0pLnRvUHJlY2lzaW9uKGV4cCk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ2UnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KGFyZ3NbaV0pLnRvRXhwb25lbnRpYWwoZXhwKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAneCc6CgkgICAgICAgICAgICAgICAgICAgIHZhbCA9IHBhcnNlSW50KGFyZ3NbaV0pLnRvU3RyaW5nKGJhc2UgPyBiYXNlIDogMTYpOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlICdkJzoKCSAgICAgICAgICAgICAgICAgICAgdmFsID0gcGFyc2VGbG9hdChwYXJzZUludChhcmdzW2ldLCBiYXNlID8gYmFzZSA6IDEwKS50b1ByZWNpc2lvbihleHApKS50b0ZpeGVkKDApOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhbCA9IHR5cGVvZiB2YWwgPT09ICdvYmplY3QnID8gSlNPTi5zdHJpbmdpZnkodmFsKSA6ICgrdmFsKS50b1N0cmluZyhiYXNlKTsKCSAgICAgICAgICAgIHZhciBzaXplID0gcGFyc2VJbnQocDEpOyAvKiBwYWRkaW5nIHNpemUgKi8KCSAgICAgICAgICAgIHZhciBjaCA9IHAxICYmIChwMVswXSArICcnKSA9PT0gJzAnID8gJzAnIDogJyAnOyAvKiBpc251bGw/ICovCgkgICAgICAgICAgICB3aGlsZSAodmFsLmxlbmd0aCA8IHNpemUpCgkgICAgICAgICAgICAgICAgdmFsID0gcDAgIT09IHVuZGVmaW5lZCA/IHZhbCArIGNoIDogY2ggKyB2YWw7IC8qIGlzbWludXM/ICovCgkgICAgICAgICAgICByZXR1cm4gdmFsOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZWdleCA9IC8lKC0pPygwP1swLTldKyk/KFsuXVswLTldKyk/KFsjXVswLTldKyk/KFtzY2ZwZXhkJV0pL2c7CgkgICAgICAgIHJldHVybiBhcHBlbmQucmVwbGFjZShyZWdleCwgY2FsbGJhY2spOwoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKi8KCSAgICBTdHJpbmdVdGlscy5nZXRCeXRlcyA9IGZ1bmN0aW9uIChzdHIsIGVuY29kaW5nKSB7CgkgICAgICAgIHJldHVybiBTdHJpbmdFbmNvZGluZ18xJDEuZGVmYXVsdC5lbmNvZGUoc3RyLCBlbmNvZGluZyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIHRoZSBjaGFyY29kZSBhdCB0aGUgc3BlY2lmaWVkIGluZGV4IG9yIGF0IGluZGV4IHplcm8uCgkgICAgICovCgkgICAgU3RyaW5nVXRpbHMuZ2V0Q2hhckNvZGUgPSBmdW5jdGlvbiAoc3RyLCBpbmRleCkgewoJICAgICAgICBpZiAoaW5kZXggPT09IHZvaWQgMCkgeyBpbmRleCA9IDA7IH0KCSAgICAgICAgcmV0dXJuIHN0ci5jaGFyQ29kZUF0KGluZGV4KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgY2hhciBmb3IgZ2l2ZW4gY2hhcmNvZGUKCSAgICAgKi8KCSAgICBTdHJpbmdVdGlscy5nZXRDaGFyQXQgPSBmdW5jdGlvbiAoY2hhckNvZGUpIHsKCSAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY2hhckNvZGUpOwoJICAgIH07CgkgICAgU3RyaW5nVXRpbHMuU0hJRlRfSklTID0gQ2hhcmFjdGVyU2V0RUNJXzEkMS5kZWZhdWx0LlNKSVMuZ2V0TmFtZSgpOyAvLyAiU0pJUyIKCSAgICBTdHJpbmdVdGlscy5HQjIzMTIgPSAnR0IyMzEyJzsKCSAgICBTdHJpbmdVdGlscy5JU084ODU5MSA9IENoYXJhY3RlclNldEVDSV8xJDEuZGVmYXVsdC5JU084ODU5XzEuZ2V0TmFtZSgpOyAvLyAiSVNPODg1OV8xIgoJICAgIFN0cmluZ1V0aWxzLkVVQ19KUCA9ICdFVUNfSlAnOwoJICAgIFN0cmluZ1V0aWxzLlVURjggPSBDaGFyYWN0ZXJTZXRFQ0lfMSQxLmRlZmF1bHQuVVRGOC5nZXROYW1lKCk7IC8vICJVVEY4IgoJICAgIFN0cmluZ1V0aWxzLlBMQVRGT1JNX0RFRkFVTFRfRU5DT0RJTkcgPSBTdHJpbmdVdGlscy5VVEY4OyAvLyAiVVRGOCIvL0NoYXJzZXQuZGVmYXVsdENoYXJzZXQoKS5uYW1lKCkKCSAgICBTdHJpbmdVdGlscy5BU1NVTUVfU0hJRlRfSklTID0gZmFsc2U7CgkgICAgcmV0dXJuIFN0cmluZ1V0aWxzOwoJfSgpKTsKCVN0cmluZ1V0aWxzJDEuZGVmYXVsdCA9IFN0cmluZ1V0aWxzOwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmdCdWlsZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBTdHJpbmdVdGlsc18xJDEgPSBTdHJpbmdVdGlscyQxOwoJdmFyIFN0cmluZ0J1aWxkZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nQnVpbGRlcih2YWx1ZSkgewoJICAgICAgICBpZiAodmFsdWUgPT09IHZvaWQgMCkgeyB2YWx1ZSA9ICcnOyB9CgkgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKCSAgICB9CgkgICAgU3RyaW5nQnVpbGRlci5wcm90b3R5cGUuZW5hYmxlRGVjb2RpbmcgPSBmdW5jdGlvbiAoZW5jb2RpbmcpIHsKCSAgICAgICAgdGhpcy5lbmNvZGluZyA9IGVuY29kaW5nOwoJICAgICAgICByZXR1cm4gdGhpczsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmFwcGVuZCA9IGZ1bmN0aW9uIChzKSB7CgkgICAgICAgIGlmICh0eXBlb2YgcyA9PT0gJ3N0cmluZycpIHsKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gcy50b1N0cmluZygpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgaWYgKHRoaXMuZW5jb2RpbmcpIHsKCSAgICAgICAgICAgIC8vIHVzZSBwYXNzZWQgZm9ybWF0IChmcm9tQ2hhckNvZGUgd2lsbCByZXR1cm4gVVRGOCBlbmNvZGluZykKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gU3RyaW5nVXRpbHNfMSQxLmRlZmF1bHQuY2FzdEFzTm9uVXRmOENoYXIocywgdGhpcy5lbmNvZGluZyk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAvLyBjb3JyZWN0bHkgY29udmVydHMgZnJvbSBVVEYtOCwgYnV0IG5vdCBvdGhlciBlbmNvZGluZ3MKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShzKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpczsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmFwcGVuZENoYXJzID0gZnVuY3Rpb24gKHN0ciwgb2Zmc2V0LCBsZW4pIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IG9mZnNldDsgb2Zmc2V0IDwgb2Zmc2V0ICsgbGVuOyBpKyspIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kKHN0cltpXSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgfTsKCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5sZW5ndGggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLmxlbmd0aDsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmNoYXJBdCA9IGZ1bmN0aW9uIChuKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLmNoYXJBdChuKTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmRlbGV0ZUNoYXJBdCA9IGZ1bmN0aW9uIChuKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIHRoaXMudmFsdWUuc3Vic3RyaW5nKG4gKyAxKTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLnNldENoYXJBdCA9IGZ1bmN0aW9uIChuLCBjKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIGMgKyB0aGlzLnZhbHVlLnN1YnN0cihuICsgMSk7CgkgICAgfTsKCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5zdWJzdHJpbmcgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZS5zdWJzdHJpbmcoc3RhcnQsIGVuZCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAbm90ZSBoZWxwZXIgbWV0aG9kIGZvciBSU1MgRXhwYW5kZWQKCSAgICAgKi8KCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5zZXRMZW5ndGhUb1plcm8gPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSAnJzsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmluc2VydCA9IGZ1bmN0aW9uIChuLCBjKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIGMgKyB0aGlzLnZhbHVlLnN1YnN0cihuICsgYy5sZW5ndGgpOwoJICAgIH07CgkgICAgcmV0dXJuIFN0cmluZ0J1aWxkZXI7Cgl9KCkpOwoJU3RyaW5nQnVpbGRlciQxLmRlZmF1bHQgPSBTdHJpbmdCdWlsZGVyOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQml0TWF0cml4JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5czsqLwoJdmFyIEJpdEFycmF5XzEkMSA9IEJpdEFycmF5JDE7Cgl2YXIgU3lzdGVtXzEkMyA9IFN5c3RlbSQxOwoJdmFyIEFycmF5c18xID0gQXJyYXlzJDE7Cgl2YXIgU3RyaW5nQnVpbGRlcl8xJDIgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNyA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5SZXByZXNlbnRzIGEgMkQgbWF0cml4IG9mIGJpdHMuIEluIGZ1bmN0aW9uIGFyZ3VtZW50cyBiZWxvdywgYW5kIHRocm91Z2hvdXQgdGhlIGNvbW1vbgoJICogbW9kdWxlLCB4IGlzIHRoZSBjb2x1bW4gcG9zaXRpb24sIGFuZCB5IGlzIHRoZSByb3cgcG9zaXRpb24uIFRoZSBvcmRlcmluZyBpcyBhbHdheXMgeCwgeS4KCSAqIFRoZSBvcmlnaW4gaXMgYXQgdGhlIHRvcC1sZWZ0LjwvcD4KCSAqCgkgKiA8cD5JbnRlcm5hbGx5IHRoZSBiaXRzIGFyZSByZXByZXNlbnRlZCBpbiBhIDEtRCBhcnJheSBvZiAzMi1iaXQgaW50cy4gSG93ZXZlciwgZWFjaCByb3cgYmVnaW5zCgkgKiB3aXRoIGEgbmV3IGludC4gVGhpcyBpcyBkb25lIGludGVudGlvbmFsbHkgc28gdGhhdCB3ZSBjYW4gY29weSBvdXQgYSByb3cgaW50byBhIEJpdEFycmF5IHZlcnkKCSAqIGVmZmljaWVudGx5LjwvcD4KCSAqCgkgKiA8cD5UaGUgb3JkZXJpbmcgb2YgYml0cyBpcyByb3ctbWFqb3IuIFdpdGhpbiBlYWNoIGludCwgdGhlIGxlYXN0IHNpZ25pZmljYW50IGJpdHMgYXJlIHVzZWQgZmlyc3QsCgkgKiBtZWFuaW5nIHRoZXkgcmVwcmVzZW50IGxvd2VyIHggdmFsdWVzLiBUaGlzIGlzIGNvbXBhdGlibGUgd2l0aCBCaXRBcnJheSdzIGltcGxlbWVudGF0aW9uLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqLwoJdmFyIEJpdE1hdHJpeCAvKmltcGxlbWVudHMgQ2xvbmVhYmxlKi8gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQ3JlYXRlcyBhbiBlbXB0eSBzcXVhcmUge0BsaW5rIEJpdE1hdHJpeH0uCgkgICAgICoKCSAgICAgKiBAcGFyYW0gZGltZW5zaW9uIGhlaWdodCBhbmQgd2lkdGgKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IoZGltZW5zaW9uOiBudW1iZXIgLyppbnQqLykgewoJICAgIC8vICAgdGhpcyhkaW1lbnNpb24sIGRpbWVuc2lvbikKCSAgICAvLyB9CgkgICAgLyoqCgkgICAgICogQ3JlYXRlcyBhbiBlbXB0eSB7QGxpbmsgQml0TWF0cml4fS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB3aWR0aCBiaXQgbWF0cml4IHdpZHRoCgkgICAgICogQHBhcmFtIGhlaWdodCBiaXQgbWF0cml4IGhlaWdodAoJICAgICAqLwoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3Rvcih3aWR0aDogbnVtYmVyIC8qaW50Ki8sIGhlaWdodDogbnVtYmVyIC8qaW50Ki8pIHsKCSAgICAvLyAgIGlmICh3aWR0aCA8IDEgfHwgaGVpZ2h0IDwgMSkgewoJICAgIC8vICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJCb3RoIGRpbWVuc2lvbnMgbXVzdCBiZSBncmVhdGVyIHRoYW4gMCIpCgkgICAgLy8gICB9CgkgICAgLy8gICB0aGlzLndpZHRoID0gd2lkdGgKCSAgICAvLyAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0CgkgICAgLy8gICB0aGlzLnJvd1NpemUgPSAod2lkdGggKyAzMSkgLyAzMgoJICAgIC8vICAgYml0cyA9IG5ldyBpbnRbcm93U2l6ZSAqIGhlaWdodF07CgkgICAgLy8gfQoJICAgIGZ1bmN0aW9uIEJpdE1hdHJpeCh3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLywgcm93U2l6ZSAvKmludCovLCBiaXRzKSB7CgkgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDsKCSAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CgkgICAgICAgIHRoaXMucm93U2l6ZSA9IHJvd1NpemU7CgkgICAgICAgIHRoaXMuYml0cyA9IGJpdHM7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGhlaWdodCB8fCBudWxsID09PSBoZWlnaHQpIHsKCSAgICAgICAgICAgIGhlaWdodCA9IHdpZHRoOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwoJICAgICAgICBpZiAod2lkdGggPCAxIHx8IGhlaWdodCA8IDEpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ0JvdGggZGltZW5zaW9ucyBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAwJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gcm93U2l6ZSB8fCBudWxsID09PSByb3dTaXplKSB7CgkgICAgICAgICAgICByb3dTaXplID0gTWF0aC5mbG9vcigod2lkdGggKyAzMSkgLyAzMik7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yb3dTaXplID0gcm93U2l6ZTsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gYml0cyB8fCBudWxsID09PSBiaXRzKSB7CgkgICAgICAgICAgICB0aGlzLmJpdHMgPSBuZXcgSW50MzJBcnJheSh0aGlzLnJvd1NpemUgKiB0aGlzLmhlaWdodCk7CgkgICAgICAgIH0KCSAgICB9CgkgICAgLyoqCgkgICAgICogSW50ZXJwcmV0cyBhIDJEIGFycmF5IG9mIGJvb2xlYW5zIGFzIGEge0BsaW5rIEJpdE1hdHJpeH0sIHdoZXJlICJ0cnVlIiBtZWFucyBhbiAib24iIGJpdC4KCSAgICAgKgoJICAgICAqIEBmdW5jdGlvbiBwYXJzZQoJICAgICAqIEBwYXJhbSBpbWFnZSBiaXRzIG9mIHRoZSBpbWFnZSwgYXMgYSByb3ctbWFqb3IgMkQgYXJyYXkuIEVsZW1lbnRzIGFyZSBhcnJheXMgcmVwcmVzZW50aW5nIHJvd3MKCSAgICAgKiBAcmV0dXJuIHtAbGluayBCaXRNYXRyaXh9IHJlcHJlc2VudGF0aW9uIG9mIGltYWdlCgkgICAgICovCgkgICAgQml0TWF0cml4LnBhcnNlRnJvbUJvb2xlYW5BcnJheSA9IGZ1bmN0aW9uIChpbWFnZSkgewoJICAgICAgICB2YXIgaGVpZ2h0ID0gaW1hZ2UubGVuZ3RoOwoJICAgICAgICB2YXIgd2lkdGggPSBpbWFnZVswXS5sZW5ndGg7CgkgICAgICAgIHZhciBiaXRzID0gbmV3IEJpdE1hdHJpeCh3aWR0aCwgaGVpZ2h0KTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewoJICAgICAgICAgICAgdmFyIGltYWdlSSA9IGltYWdlW2ldOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB3aWR0aDsgaisrKSB7CgkgICAgICAgICAgICAgICAgaWYgKGltYWdlSVtqXSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLnNldChqLCBpKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKgoJICAgICAqIEBmdW5jdGlvbiBwYXJzZQoJICAgICAqIEBwYXJhbSBzdHJpbmdSZXByZXNlbnRhdGlvbgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcKCSAgICAgKiBAcGFyYW0gdW5zZXRTdHJpbmcKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucGFyc2VGcm9tU3RyaW5nID0gZnVuY3Rpb24gKHN0cmluZ1JlcHJlc2VudGF0aW9uLCBzZXRTdHJpbmcsIHVuc2V0U3RyaW5nKSB7CgkgICAgICAgIGlmIChzdHJpbmdSZXByZXNlbnRhdGlvbiA9PT0gbnVsbCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnc3RyaW5nUmVwcmVzZW50YXRpb24gY2Fubm90IGJlIG51bGwnKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IG5ldyBBcnJheShzdHJpbmdSZXByZXNlbnRhdGlvbi5sZW5ndGgpOwoJICAgICAgICB2YXIgYml0c1BvcyA9IDA7CgkgICAgICAgIHZhciByb3dTdGFydFBvcyA9IDA7CgkgICAgICAgIHZhciByb3dMZW5ndGggPSAtMTsKCSAgICAgICAgdmFyIG5Sb3dzID0gMDsKCSAgICAgICAgdmFyIHBvcyA9IDA7CgkgICAgICAgIHdoaWxlIChwb3MgPCBzdHJpbmdSZXByZXNlbnRhdGlvbi5sZW5ndGgpIHsKCSAgICAgICAgICAgIGlmIChzdHJpbmdSZXByZXNlbnRhdGlvbi5jaGFyQXQocG9zKSA9PT0gJ1xuJyB8fAoJICAgICAgICAgICAgICAgIHN0cmluZ1JlcHJlc2VudGF0aW9uLmNoYXJBdChwb3MpID09PSAnXHInKSB7CgkgICAgICAgICAgICAgICAgaWYgKGJpdHNQb3MgPiByb3dTdGFydFBvcykgewoJICAgICAgICAgICAgICAgICAgICBpZiAocm93TGVuZ3RoID09PSAtMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcm93TGVuZ3RoID0gYml0c1BvcyAtIHJvd1N0YXJ0UG9zOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJpdHNQb3MgLSByb3dTdGFydFBvcyAhPT0gcm93TGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdyb3cgbGVuZ3RocyBkbyBub3QgbWF0Y2gnKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICByb3dTdGFydFBvcyA9IGJpdHNQb3M7CgkgICAgICAgICAgICAgICAgICAgIG5Sb3dzKys7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHBvcysrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSBpZiAoc3RyaW5nUmVwcmVzZW50YXRpb24uc3Vic3RyaW5nKHBvcywgcG9zICsgc2V0U3RyaW5nLmxlbmd0aCkgPT09IHNldFN0cmluZykgewoJICAgICAgICAgICAgICAgIHBvcyArPSBzZXRTdHJpbmcubGVuZ3RoOwoJICAgICAgICAgICAgICAgIGJpdHNbYml0c1Bvc10gPSB0cnVlOwoJICAgICAgICAgICAgICAgIGJpdHNQb3MrKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHN0cmluZ1JlcHJlc2VudGF0aW9uLnN1YnN0cmluZyhwb3MsIHBvcyArIHVuc2V0U3RyaW5nLmxlbmd0aCkgPT09IHVuc2V0U3RyaW5nKSB7CgkgICAgICAgICAgICAgICAgcG9zICs9IHVuc2V0U3RyaW5nLmxlbmd0aDsKCSAgICAgICAgICAgICAgICBiaXRzW2JpdHNQb3NdID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgYml0c1BvcysrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnaWxsZWdhbCBjaGFyYWN0ZXIgZW5jb3VudGVyZWQ6ICcgKyBzdHJpbmdSZXByZXNlbnRhdGlvbi5zdWJzdHJpbmcocG9zKSk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gbm8gRU9MIGF0IGVuZD8KCSAgICAgICAgaWYgKGJpdHNQb3MgPiByb3dTdGFydFBvcykgewoJICAgICAgICAgICAgaWYgKHJvd0xlbmd0aCA9PT0gLTEpIHsKCSAgICAgICAgICAgICAgICByb3dMZW5ndGggPSBiaXRzUG9zIC0gcm93U3RhcnRQb3M7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIGlmIChiaXRzUG9zIC0gcm93U3RhcnRQb3MgIT09IHJvd0xlbmd0aCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ3JvdyBsZW5ndGhzIGRvIG5vdCBtYXRjaCcpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgblJvd3MrKzsKCSAgICAgICAgfQoJICAgICAgICB2YXIgbWF0cml4ID0gbmV3IEJpdE1hdHJpeChyb3dMZW5ndGgsIG5Sb3dzKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiaXRzUG9zOyBpKyspIHsKCSAgICAgICAgICAgIGlmIChiaXRzW2ldKSB7CgkgICAgICAgICAgICAgICAgbWF0cml4LnNldChNYXRoLmZsb29yKGkgJSByb3dMZW5ndGgpLCBNYXRoLmZsb29yKGkgLyByb3dMZW5ndGgpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbWF0cml4OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+R2V0cyB0aGUgcmVxdWVzdGVkIGJpdCwgd2hlcmUgdHJ1ZSBtZWFucyBibGFjay48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0geCBUaGUgaG9yaXpvbnRhbCBjb21wb25lbnQgKGkuZS4gd2hpY2ggY29sdW1uKQoJICAgICAqIEBwYXJhbSB5IFRoZSB2ZXJ0aWNhbCBjb21wb25lbnQgKGkuZS4gd2hpY2ggcm93KQoJICAgICAqIEByZXR1cm4gdmFsdWUgb2YgZ2l2ZW4gYml0IGluIG1hdHJpeAoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKHggLyppbnQqLywgeSAvKmludCovKSB7CgkgICAgICAgIHZhciBvZmZzZXQgPSB5ICogdGhpcy5yb3dTaXplICsgTWF0aC5mbG9vcih4IC8gMzIpOwoJICAgICAgICByZXR1cm4gKCh0aGlzLmJpdHNbb2Zmc2V0XSA+Pj4gKHggJiAweDFmKSkgJiAxKSAhPT0gMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlNldHMgdGhlIGdpdmVuIGJpdCB0byB0cnVlLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB4IFRoZSBob3Jpem9udGFsIGNvbXBvbmVudCAoaS5lLiB3aGljaCBjb2x1bW4pCgkgICAgICogQHBhcmFtIHkgVGhlIHZlcnRpY2FsIGNvbXBvbmVudCAoaS5lLiB3aGljaCByb3cpCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdIHw9ICgxIDw8ICh4ICYgMHgxZikpICYgMHhGRkZGRkZGRjsKCSAgICB9OwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUudW5zZXQgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdICY9IH4oKDEgPDwgKHggJiAweDFmKSkgJiAweEZGRkZGRkZGKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkZsaXBzIHRoZSBnaXZlbiBiaXQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIHggVGhlIGhvcml6b250YWwgY29tcG9uZW50IChpLmUuIHdoaWNoIGNvbHVtbikKCSAgICAgKiBAcGFyYW0geSBUaGUgdmVydGljYWwgY29tcG9uZW50IChpLmUuIHdoaWNoIHJvdykKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmZsaXAgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdIF49ICgoMSA8PCAoeCAmIDB4MWYpKSAmIDB4RkZGRkZGRkYpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRXhjbHVzaXZlLW9yIChYT1IpOiBGbGlwIHRoZSBiaXQgaW4gdGhpcyB7QGNvZGUgQml0TWF0cml4fSBpZiB0aGUgY29ycmVzcG9uZGluZwoJICAgICAqIG1hc2sgYml0IGlzIHNldC4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBtYXNrIFhPUiBtYXNrCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS54b3IgPSBmdW5jdGlvbiAobWFzaykgewoJICAgICAgICBpZiAodGhpcy53aWR0aCAhPT0gbWFzay5nZXRXaWR0aCgpIHx8IHRoaXMuaGVpZ2h0ICE9PSBtYXNrLmdldEhlaWdodCgpCgkgICAgICAgICAgICB8fCB0aGlzLnJvd1NpemUgIT09IG1hc2suZ2V0Um93U2l6ZSgpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdpbnB1dCBtYXRyaXggZGltZW5zaW9ucyBkbyBub3QgbWF0Y2gnKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcm93QXJyYXkgPSBuZXcgQml0QXJyYXlfMSQxLmRlZmF1bHQoTWF0aC5mbG9vcih0aGlzLndpZHRoIC8gMzIpICsgMSk7CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgeSA9IDAsIGhlaWdodCA9IHRoaXMuaGVpZ2h0OyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIHZhciBvZmZzZXQgPSB5ICogcm93U2l6ZTsKCSAgICAgICAgICAgIHZhciByb3cgPSBtYXNrLmdldFJvdyh5LCByb3dBcnJheSkuZ2V0Qml0QXJyYXkoKTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgcm93U2l6ZTsgeCsrKSB7CgkgICAgICAgICAgICAgICAgYml0c1tvZmZzZXQgKyB4XSBePSByb3dbeF07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIENsZWFycyBhbGwgYml0cyAoc2V0cyB0byBmYWxzZSkuCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIHZhciBtYXggPSBiaXRzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXg7IGkrKykgewoJICAgICAgICAgICAgYml0c1tpXSA9IDA7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlNldHMgYSBzcXVhcmUgcmVnaW9uIG9mIHRoZSBiaXQgbWF0cml4IHRvIHRydWUuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGxlZnQgVGhlIGhvcml6b250YWwgcG9zaXRpb24gdG8gYmVnaW4gYXQgKGluY2x1c2l2ZSkKCSAgICAgKiBAcGFyYW0gdG9wIFRoZSB2ZXJ0aWNhbCBwb3NpdGlvbiB0byBiZWdpbiBhdCAoaW5jbHVzaXZlKQoJICAgICAqIEBwYXJhbSB3aWR0aCBUaGUgd2lkdGggb2YgdGhlIHJlZ2lvbgoJICAgICAqIEBwYXJhbSBoZWlnaHQgVGhlIGhlaWdodCBvZiB0aGUgcmVnaW9uCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5zZXRSZWdpb24gPSBmdW5jdGlvbiAobGVmdCAvKmludCovLCB0b3AgLyppbnQqLywgd2lkdGggLyppbnQqLywgaGVpZ2h0IC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKHRvcCA8IDAgfHwgbGVmdCA8IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ0xlZnQgYW5kIHRvcCBtdXN0IGJlIG5vbm5lZ2F0aXZlJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGhlaWdodCA8IDEgfHwgd2lkdGggPCAxKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdIZWlnaHQgYW5kIHdpZHRoIG11c3QgYmUgYXQgbGVhc3QgMScpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByaWdodCA9IGxlZnQgKyB3aWR0aDsKCSAgICAgICAgdmFyIGJvdHRvbSA9IHRvcCArIGhlaWdodDsKCSAgICAgICAgaWYgKGJvdHRvbSA+IHRoaXMuaGVpZ2h0IHx8IHJpZ2h0ID4gdGhpcy53aWR0aCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnVGhlIHJlZ2lvbiBtdXN0IGZpdCBpbnNpZGUgdGhlIG1hdHJpeCcpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgeSA9IHRvcDsgeSA8IGJvdHRvbTsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb2Zmc2V0ID0geSAqIHJvd1NpemU7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gbGVmdDsgeCA8IHJpZ2h0OyB4KyspIHsKCSAgICAgICAgICAgICAgICBiaXRzW29mZnNldCArIE1hdGguZmxvb3IoeCAvIDMyKV0gfD0gKCgxIDw8ICh4ICYgMHgxZikpICYgMHhGRkZGRkZGRik7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEEgZmFzdCBtZXRob2QgdG8gcmV0cmlldmUgb25lIHJvdyBvZiBkYXRhIGZyb20gdGhlIG1hdHJpeCBhcyBhIEJpdEFycmF5LgoJICAgICAqCgkgICAgICogQHBhcmFtIHkgVGhlIHJvdyB0byByZXRyaWV2ZQoJICAgICAqIEBwYXJhbSByb3cgQW4gb3B0aW9uYWwgY2FsbGVyLWFsbG9jYXRlZCBCaXRBcnJheSwgd2lsbCBiZSBhbGxvY2F0ZWQgaWYgbnVsbCBvciB0b28gc21hbGwKCSAgICAgKiBAcmV0dXJuIFRoZSByZXN1bHRpbmcgQml0QXJyYXkgLSB0aGlzIHJlZmVyZW5jZSBzaG91bGQgYWx3YXlzIGJlIHVzZWQgZXZlbiB3aGVuIHBhc3NpbmcKCSAgICAgKiAgICAgICAgIHlvdXIgb3duIHJvdwoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0Um93ID0gZnVuY3Rpb24gKHkgLyppbnQqLywgcm93KSB7CgkgICAgICAgIGlmIChyb3cgPT09IG51bGwgfHwgcm93ID09PSB1bmRlZmluZWQgfHwgcm93LmdldFNpemUoKSA8IHRoaXMud2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBCaXRBcnJheV8xJDEuZGVmYXVsdCh0aGlzLndpZHRoKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHJvdy5jbGVhcigpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiByb3dTaXplOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHJvd1NpemU7IHgrKykgewoJICAgICAgICAgICAgcm93LnNldEJ1bGsoeCAqIDMyLCBiaXRzW29mZnNldCArIHhdKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcm93OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIHkgcm93IHRvIHNldAoJICAgICAqIEBwYXJhbSByb3cge0BsaW5rIEJpdEFycmF5fSB0byBjb3B5IGZyb20KCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLnNldFJvdyA9IGZ1bmN0aW9uICh5IC8qaW50Ki8sIHJvdykgewoJICAgICAgICBTeXN0ZW1fMSQzLmRlZmF1bHQuYXJyYXljb3B5KHJvdy5nZXRCaXRBcnJheSgpLCAwLCB0aGlzLmJpdHMsIHkgKiB0aGlzLnJvd1NpemUsIHRoaXMucm93U2l6ZSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBNb2RpZmllcyB0aGlzIHtAY29kZSBCaXRNYXRyaXh9IHRvIHJlcHJlc2VudCB0aGUgc2FtZSBidXQgcm90YXRlZCAxODAgZGVncmVlcwoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUucm90YXRlMTgwID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgd2lkdGggPSB0aGlzLmdldFdpZHRoKCk7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgdG9wUm93ID0gbmV3IEJpdEFycmF5XzEkMS5kZWZhdWx0KHdpZHRoKTsKCSAgICAgICAgdmFyIGJvdHRvbVJvdyA9IG5ldyBCaXRBcnJheV8xJDEuZGVmYXVsdCh3aWR0aCk7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IE1hdGguZmxvb3IoKGhlaWdodCArIDEpIC8gMik7IGkgPCBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICB0b3BSb3cgPSB0aGlzLmdldFJvdyhpLCB0b3BSb3cpOwoJICAgICAgICAgICAgYm90dG9tUm93ID0gdGhpcy5nZXRSb3coaGVpZ2h0IC0gMSAtIGksIGJvdHRvbVJvdyk7CgkgICAgICAgICAgICB0b3BSb3cucmV2ZXJzZSgpOwoJICAgICAgICAgICAgYm90dG9tUm93LnJldmVyc2UoKTsKCSAgICAgICAgICAgIHRoaXMuc2V0Um93KGksIGJvdHRvbVJvdyk7CgkgICAgICAgICAgICB0aGlzLnNldFJvdyhoZWlnaHQgLSAxIC0gaSwgdG9wUm93KTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICogVGhpcyBpcyB1c2VmdWwgaW4gZGV0ZWN0aW5nIHRoZSBlbmNsb3NpbmcgcmVjdGFuZ2xlIG9mIGEgJ3B1cmUnIGJhcmNvZGUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtAY29kZSBsZWZ0LHRvcCx3aWR0aCxoZWlnaHR9IGVuY2xvc2luZyByZWN0YW5nbGUgb2YgYWxsIDEgYml0cywgb3IgbnVsbCBpZiBpdCBpcyBhbGwgd2hpdGUKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmdldEVuY2xvc2luZ1JlY3RhbmdsZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aDsKCSAgICAgICAgdmFyIGhlaWdodCA9IHRoaXMuaGVpZ2h0OwoJICAgICAgICB2YXIgcm93U2l6ZSA9IHRoaXMucm93U2l6ZTsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIHZhciBsZWZ0ID0gd2lkdGg7CgkgICAgICAgIHZhciB0b3AgPSBoZWlnaHQ7CgkgICAgICAgIHZhciByaWdodCA9IC0xOwoJICAgICAgICB2YXIgYm90dG9tID0gLTE7CgkgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIHgzMiA9IDA7IHgzMiA8IHJvd1NpemU7IHgzMisrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHRoZUJpdHMgPSBiaXRzW3kgKiByb3dTaXplICsgeDMyXTsKCSAgICAgICAgICAgICAgICBpZiAodGhlQml0cyAhPT0gMCkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoeSA8IHRvcCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgdG9wID0geTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBpZiAoeSA+IGJvdHRvbSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgYm90dG9tID0geTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBpZiAoeDMyICogMzIgPCBsZWZ0KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYml0ID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgoKHRoZUJpdHMgPDwgKDMxIC0gYml0KSkgJiAweEZGRkZGRkZGKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdCsrOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh4MzIgKiAzMiArIGJpdCkgPCBsZWZ0KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdCA9IHgzMiAqIDMyICsgYml0OwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGlmICh4MzIgKiAzMiArIDMxID4gcmlnaHQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiaXQgPSAzMTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgodGhlQml0cyA+Pj4gYml0KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdC0tOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh4MzIgKiAzMiArIGJpdCkgPiByaWdodCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0ID0geDMyICogMzIgKyBiaXQ7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHJpZ2h0IDwgbGVmdCB8fCBib3R0b20gPCB0b3ApIHsKCSAgICAgICAgICAgIHJldHVybiBudWxsOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW2xlZnQsIHRvcCwgcmlnaHQgLSBsZWZ0ICsgMSwgYm90dG9tIC0gdG9wICsgMV0pOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogVGhpcyBpcyB1c2VmdWwgaW4gZGV0ZWN0aW5nIGEgY29ybmVyIG9mIGEgJ3B1cmUnIGJhcmNvZGUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtAY29kZSB4LHl9IGNvb3JkaW5hdGUgb2YgdG9wLWxlZnQtbW9zdCAxIGJpdCwgb3IgbnVsbCBpZiBpdCBpcyBhbGwgd2hpdGUKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmdldFRvcExlZnRPbkJpdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJvd1NpemUgPSB0aGlzLnJvd1NpemU7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IDA7CgkgICAgICAgIHdoaWxlIChiaXRzT2Zmc2V0IDwgYml0cy5sZW5ndGggJiYgYml0c1tiaXRzT2Zmc2V0XSA9PT0gMCkgewoJICAgICAgICAgICAgYml0c09mZnNldCsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChiaXRzT2Zmc2V0ID09PSBiaXRzLmxlbmd0aCkgewoJICAgICAgICAgICAgcmV0dXJuIG51bGw7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHkgPSBiaXRzT2Zmc2V0IC8gcm93U2l6ZTsKCSAgICAgICAgdmFyIHggPSAoYml0c09mZnNldCAlIHJvd1NpemUpICogMzI7CgkgICAgICAgIHZhciB0aGVCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgdmFyIGJpdCA9IDA7CgkgICAgICAgIHdoaWxlICgoKHRoZUJpdHMgPDwgKDMxIC0gYml0KSkgJiAweEZGRkZGRkZGKSA9PT0gMCkgewoJICAgICAgICAgICAgYml0Kys7CgkgICAgICAgIH0KCSAgICAgICAgeCArPSBiaXQ7CgkgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW3gsIHldKTsKCSAgICB9OwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0Qm90dG9tUmlnaHRPbkJpdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJvd1NpemUgPSB0aGlzLnJvd1NpemU7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IGJpdHMubGVuZ3RoIC0gMTsKCSAgICAgICAgd2hpbGUgKGJpdHNPZmZzZXQgPj0gMCAmJiBiaXRzW2JpdHNPZmZzZXRdID09PSAwKSB7CgkgICAgICAgICAgICBiaXRzT2Zmc2V0LS07CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGJpdHNPZmZzZXQgPCAwKSB7CgkgICAgICAgICAgICByZXR1cm4gbnVsbDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgeSA9IE1hdGguZmxvb3IoYml0c09mZnNldCAvIHJvd1NpemUpOwoJICAgICAgICB2YXIgeCA9IE1hdGguZmxvb3IoYml0c09mZnNldCAlIHJvd1NpemUpICogMzI7CgkgICAgICAgIHZhciB0aGVCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgdmFyIGJpdCA9IDMxOwoJICAgICAgICB3aGlsZSAoKHRoZUJpdHMgPj4+IGJpdCkgPT09IDApIHsKCSAgICAgICAgICAgIGJpdC0tOwoJICAgICAgICB9CgkgICAgICAgIHggKz0gYml0OwoJICAgICAgICByZXR1cm4gSW50MzJBcnJheS5mcm9tKFt4LCB5XSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSB3aWR0aCBvZiB0aGUgbWF0cml4CgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMud2lkdGg7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSBoZWlnaHQgb2YgdGhlIG1hdHJpeAoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0SGVpZ2h0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5oZWlnaHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSByb3cgc2l6ZSBvZiB0aGUgbWF0cml4CgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5nZXRSb3dTaXplID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yb3dTaXplOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG8pIHsKCSAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIEJpdE1hdHJpeCkpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgb3RoZXIgPSBvOwoJICAgICAgICByZXR1cm4gdGhpcy53aWR0aCA9PT0gb3RoZXIud2lkdGggJiYgdGhpcy5oZWlnaHQgPT09IG90aGVyLmhlaWdodCAmJiB0aGlzLnJvd1NpemUgPT09IG90aGVyLnJvd1NpemUgJiYKCSAgICAgICAgICAgIEFycmF5c18xLmRlZmF1bHQuZXF1YWxzKHRoaXMuYml0cywgb3RoZXIuYml0cyk7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGhhc2ggPSB0aGlzLndpZHRoOwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgdGhpcy53aWR0aDsKCSAgICAgICAgaGFzaCA9IDMxICogaGFzaCArIHRoaXMuaGVpZ2h0OwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgdGhpcy5yb3dTaXplOwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgQXJyYXlzXzEuZGVmYXVsdC5oYXNoQ29kZSh0aGlzLmJpdHMpOwoJICAgICAgICByZXR1cm4gaGFzaDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIHVzaW5nICJYIiBmb3Igc2V0IGFuZCAiICIgZm9yIHVuc2V0IGJpdHMKCSAgICAgKi8KCSAgICAvKkBPdmVycmlkZSovCgkgICAgLy8gcHVibGljIHRvU3RyaW5nKCk6IHN0cmluZyB7CgkgICAgLy8gICByZXR1cm4gdG9TdHJpbmcoIjogIlgsICIgICIpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBzZXQgYml0CgkgICAgICogQHBhcmFtIHVuc2V0U3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIHVuc2V0IGJpdAoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGVudGlyZSBtYXRyaXggdXRpbGl6aW5nIGdpdmVuIHN0cmluZ3MKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgdG9TdHJpbmcoc2V0U3RyaW5nOiBzdHJpbmcgPSAiWCAiLCB1bnNldFN0cmluZzogc3RyaW5nID0gIiAgIik6IHN0cmluZyB7CgkgICAgLy8gICByZXR1cm4gdGhpcy5idWlsZFRvU3RyaW5nKHNldFN0cmluZywgdW5zZXRTdHJpbmcsICJcbiIpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBzZXQgYml0CgkgICAgICogQHBhcmFtIHVuc2V0U3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIHVuc2V0IGJpdAoJICAgICAqIEBwYXJhbSBsaW5lU2VwYXJhdG9yIG5ld2xpbmUgY2hhcmFjdGVyIGluIHN0cmluZyByZXByZXNlbnRhdGlvbgoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGVudGlyZSBtYXRyaXggdXRpbGl6aW5nIGdpdmVuIHN0cmluZ3MgYW5kIGxpbmUgc2VwYXJhdG9yCgkgICAgICogQGRlcHJlY2F0ZWQgY2FsbCB7QGxpbmsgI3RvU3RyaW5nKFN0cmluZyxTdHJpbmcpfSBvbmx5LCB3aGljaCB1c2VzIFxuIGxpbmUgc2VwYXJhdG9yIGFsd2F5cwoJICAgICAqLwoJICAgIC8vIEBEZXByZWNhdGVkCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uIChzZXRTdHJpbmcsIHVuc2V0U3RyaW5nLCBsaW5lU2VwYXJhdG9yKSB7CgkgICAgICAgIGlmIChzZXRTdHJpbmcgPT09IHZvaWQgMCkgeyBzZXRTdHJpbmcgPSAnWCAnOyB9CgkgICAgICAgIGlmICh1bnNldFN0cmluZyA9PT0gdm9pZCAwKSB7IHVuc2V0U3RyaW5nID0gJyAgJzsgfQoJICAgICAgICBpZiAobGluZVNlcGFyYXRvciA9PT0gdm9pZCAwKSB7IGxpbmVTZXBhcmF0b3IgPSAnXG4nOyB9CgkgICAgICAgIHJldHVybiB0aGlzLmJ1aWxkVG9TdHJpbmcoc2V0U3RyaW5nLCB1bnNldFN0cmluZywgbGluZVNlcGFyYXRvcik7CgkgICAgfTsKCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmJ1aWxkVG9TdHJpbmcgPSBmdW5jdGlvbiAoc2V0U3RyaW5nLCB1bnNldFN0cmluZywgbGluZVNlcGFyYXRvcikgewoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1aWxkZXJfMSQyLmRlZmF1bHQoKTsKCSAgICAgICAgLy8gcmVzdWx0LmFwcGVuZChsaW5lU2VwYXJhdG9yKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDAsIGhlaWdodCA9IHRoaXMuaGVpZ2h0OyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwLCB3aWR0aCA9IHRoaXMud2lkdGg7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LmFwcGVuZCh0aGlzLmdldCh4LCB5KSA/IHNldFN0cmluZyA6IHVuc2V0U3RyaW5nKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQobGluZVNlcGFyYXRvcik7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdC50b1N0cmluZygpOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgQml0TWF0cml4KHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LCB0aGlzLnJvd1NpemUsIHRoaXMuYml0cy5zbGljZSgpKTsKCSAgICB9OwoJICAgIHJldHVybiBCaXRNYXRyaXg7Cgl9KCkpOwoJQml0TWF0cml4JDEuZGVmYXVsdCA9IEJpdE1hdHJpeDsKCgl2YXIgTm90Rm91bmRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShOb3RGb3VuZEV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNSA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBOb3RGb3VuZEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZChOb3RGb3VuZEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBOb3RGb3VuZEV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBOb3RGb3VuZEV4Y2VwdGlvbi5nZXROb3RGb3VuZEluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCk7CgkgICAgfTsKCSAgICBOb3RGb3VuZEV4Y2VwdGlvbi5raW5kID0gJ05vdEZvdW5kRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gTm90Rm91bmRFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDUuZGVmYXVsdCkpOwoJTm90Rm91bmRFeGNlcHRpb24kMS5kZWZhdWx0ID0gTm90Rm91bmRFeGNlcHRpb247CgoJLyoKCSAqIENvcHlyaWdodCAyMDA5IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMkYyA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5jb21tb24geyovCgl2YXIgQmluYXJpemVyXzEgPSBCaW5hcml6ZXIkMTsKCXZhciBCaXRBcnJheV8xID0gQml0QXJyYXkkMTsKCXZhciBCaXRNYXRyaXhfMSQ1ID0gQml0TWF0cml4JDE7Cgl2YXIgTm90Rm91bmRFeGNlcHRpb25fMSQ2ID0gTm90Rm91bmRFeGNlcHRpb24kMTsKCS8qKgoJICogVGhpcyBCaW5hcml6ZXIgaW1wbGVtZW50YXRpb24gdXNlcyB0aGUgb2xkIFpYaW5nIGdsb2JhbCBoaXN0b2dyYW0gYXBwcm9hY2guIEl0IGlzIHN1aXRhYmxlCgkgKiBmb3IgbG93LWVuZCBtb2JpbGUgZGV2aWNlcyB3aGljaCBkb24ndCBoYXZlIGVub3VnaCBDUFUgb3IgbWVtb3J5IHRvIHVzZSBhIGxvY2FsIHRocmVzaG9sZGluZwoJICogYWxnb3JpdGhtLiBIb3dldmVyLCBiZWNhdXNlIGl0IHBpY2tzIGEgZ2xvYmFsIGJsYWNrIHBvaW50LCBpdCBjYW5ub3QgaGFuZGxlIGRpZmZpY3VsdCBzaGFkb3dzCgkgKiBhbmQgZ3JhZGllbnRzLgoJICoKCSAqIEZhc3RlciBtb2JpbGUgZGV2aWNlcyBhbmQgYWxsIGRlc2t0b3AgYXBwbGljYXRpb25zIHNob3VsZCBwcm9iYWJseSB1c2UgSHlicmlkQmluYXJpemVyIGluc3RlYWQuCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGMoR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcihzb3VyY2UpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgc291cmNlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5sdW1pbmFuY2VzID0gR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkVNUFRZOwoJICAgICAgICBfdGhpcy5idWNrZXRzID0gbmV3IEludDMyQXJyYXkoR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkxVTUlOQU5DRV9CVUNLRVRTKTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICAvLyBBcHBsaWVzIHNpbXBsZSBzaGFycGVuaW5nIHRvIHRoZSByb3cgZGF0YSB0byBpbXByb3ZlIHBlcmZvcm1hbmNlIG9mIHRoZSAxRCBSZWFkZXJzLgoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIucHJvdG90eXBlLmdldEJsYWNrUm93ID0gZnVuY3Rpb24gKHkgLyppbnQqLywgcm93KSB7CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgaWYgKHJvdyA9PT0gdW5kZWZpbmVkIHx8IHJvdyA9PT0gbnVsbCB8fCByb3cuZ2V0U2l6ZSgpIDwgd2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBCaXRBcnJheV8xLmRlZmF1bHQod2lkdGgpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgcm93LmNsZWFyKCk7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5pbml0QXJyYXlzKHdpZHRoKTsKCSAgICAgICAgdmFyIGxvY2FsTHVtaW5hbmNlcyA9IHNvdXJjZS5nZXRSb3coeSwgdGhpcy5sdW1pbmFuY2VzKTsKCSAgICAgICAgdmFyIGxvY2FsQnVja2V0cyA9IHRoaXMuYnVja2V0czsKCSAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICBsb2NhbEJ1Y2tldHNbKGxvY2FsTHVtaW5hbmNlc1t4XSAmIDB4ZmYpID4+IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfU0hJRlRdKys7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGJsYWNrUG9pbnQgPSBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuZXN0aW1hdGVCbGFja1BvaW50KGxvY2FsQnVja2V0cyk7CgkgICAgICAgIGlmICh3aWR0aCA8IDMpIHsKCSAgICAgICAgICAgIC8vIFNwZWNpYWwgY2FzZSBmb3IgdmVyeSBzbWFsbCBpbWFnZXMKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgd2lkdGg7IHgrKykgewoJICAgICAgICAgICAgICAgIGlmICgobG9jYWxMdW1pbmFuY2VzW3hdICYgMHhmZikgPCBibGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgIHJvdy5zZXQoeCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdmFyIGxlZnQgPSBsb2NhbEx1bWluYW5jZXNbMF0gJiAweGZmOwoJICAgICAgICAgICAgdmFyIGNlbnRlciA9IGxvY2FsTHVtaW5hbmNlc1sxXSAmIDB4ZmY7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMTsgeCA8IHdpZHRoIC0gMTsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHJpZ2h0ID0gbG9jYWxMdW1pbmFuY2VzW3ggKyAxXSAmIDB4ZmY7CgkgICAgICAgICAgICAgICAgLy8gQSBzaW1wbGUgLTEgNCAtMSBib3ggZmlsdGVyIHdpdGggYSB3ZWlnaHQgb2YgMi4KCSAgICAgICAgICAgICAgICBpZiAoKChjZW50ZXIgKiA0KSAtIGxlZnQgLSByaWdodCkgLyAyIDwgYmxhY2tQb2ludCkgewoJICAgICAgICAgICAgICAgICAgICByb3cuc2V0KHgpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBsZWZ0ID0gY2VudGVyOwoJICAgICAgICAgICAgICAgIGNlbnRlciA9IHJpZ2h0OwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByb3c7CgkgICAgfTsKCSAgICAvLyBEb2VzIG5vdCBzaGFycGVuIHRoZSBkYXRhLCBhcyB0aGlzIGNhbGwgaXMgaW50ZW5kZWQgdG8gb25seSBiZSB1c2VkIGJ5IDJEIFJlYWRlcnMuCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5wcm90b3R5cGUuZ2V0QmxhY2tNYXRyaXggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IHNvdXJjZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIG1hdHJpeCA9IG5ldyBCaXRNYXRyaXhfMSQ1LmRlZmF1bHQod2lkdGgsIGhlaWdodCk7CgkgICAgICAgIC8vIFF1aWNrbHkgY2FsY3VsYXRlcyB0aGUgaGlzdG9ncmFtIGJ5IHNhbXBsaW5nIGZvdXIgcm93cyBmcm9tIHRoZSBpbWFnZS4gVGhpcyBwcm92ZWQgdG8gYmUKCSAgICAgICAgLy8gbW9yZSByb2J1c3Qgb24gdGhlIGJsYWNrYm94IHRlc3RzIHRoYW4gc2FtcGxpbmcgYSBkaWFnb25hbCBhcyB3ZSB1c2VkIHRvIGRvLgoJICAgICAgICB0aGlzLmluaXRBcnJheXMod2lkdGgpOwoJICAgICAgICB2YXIgbG9jYWxCdWNrZXRzID0gdGhpcy5idWNrZXRzOwoJICAgICAgICBmb3IgKHZhciB5ID0gMTsgeSA8IDU7IHkrKykgewoJICAgICAgICAgICAgdmFyIHJvdyA9IE1hdGguZmxvb3IoKGhlaWdodCAqIHkpIC8gNSk7CgkgICAgICAgICAgICB2YXIgbG9jYWxMdW1pbmFuY2VzXzEgPSBzb3VyY2UuZ2V0Um93KHJvdywgdGhpcy5sdW1pbmFuY2VzKTsKCSAgICAgICAgICAgIHZhciByaWdodCA9IE1hdGguZmxvb3IoKHdpZHRoICogNCkgLyA1KTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSBNYXRoLmZsb29yKHdpZHRoIC8gNSk7IHggPCByaWdodDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBpeGVsID0gbG9jYWxMdW1pbmFuY2VzXzFbeF0gJiAweGZmOwoJICAgICAgICAgICAgICAgIGxvY2FsQnVja2V0c1twaXhlbCA+PiBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUXSsrOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciBibGFja1BvaW50ID0gR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLmVzdGltYXRlQmxhY2tQb2ludChsb2NhbEJ1Y2tldHMpOwoJICAgICAgICAvLyBXZSBkZWxheSByZWFkaW5nIHRoZSBlbnRpcmUgaW1hZ2UgbHVtaW5hbmNlIHVudGlsIHRoZSBibGFjayBwb2ludCBlc3RpbWF0aW9uIHN1Y2NlZWRzLgoJICAgICAgICAvLyBBbHRob3VnaCB3ZSBlbmQgdXAgcmVhZGluZyBmb3VyIHJvd3MgdHdpY2UsIGl0IGlzIGNvbnNpc3RlbnQgd2l0aCBvdXIgbW90dG8gb2YKCSAgICAgICAgLy8gImZhaWwgcXVpY2tseSIgd2hpY2ggaXMgbmVjZXNzYXJ5IGZvciBjb250aW51b3VzIHNjYW5uaW5nLgoJICAgICAgICB2YXIgbG9jYWxMdW1pbmFuY2VzID0gc291cmNlLmdldE1hdHJpeCgpOwoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb2Zmc2V0ID0geSAqIHdpZHRoOwoJICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBpeGVsID0gbG9jYWxMdW1pbmFuY2VzW29mZnNldCArIHhdICYgMHhmZjsKCSAgICAgICAgICAgICAgICBpZiAocGl4ZWwgPCBibGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgIG1hdHJpeC5zZXQoeCwgeSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBtYXRyaXg7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLnByb3RvdHlwZS5jcmVhdGVCaW5hcml6ZXIgPSBmdW5jdGlvbiAoc291cmNlKSB7CgkgICAgICAgIHJldHVybiBuZXcgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyKHNvdXJjZSk7CgkgICAgfTsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIucHJvdG90eXBlLmluaXRBcnJheXMgPSBmdW5jdGlvbiAobHVtaW5hbmNlU2l6ZSAvKmludCovKSB7CgkgICAgICAgIGlmICh0aGlzLmx1bWluYW5jZXMubGVuZ3RoIDwgbHVtaW5hbmNlU2l6ZSkgewoJICAgICAgICAgICAgdGhpcy5sdW1pbmFuY2VzID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGx1bWluYW5jZVNpemUpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBidWNrZXRzID0gdGhpcy5idWNrZXRzOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQlVDS0VUUzsgeCsrKSB7CgkgICAgICAgICAgICBidWNrZXRzW3hdID0gMDsKCSAgICAgICAgfQoJICAgIH07CgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLmVzdGltYXRlQmxhY2tQb2ludCA9IGZ1bmN0aW9uIChidWNrZXRzKSB7CgkgICAgICAgIC8vIEZpbmQgdGhlIHRhbGxlc3QgcGVhayBpbiB0aGUgaGlzdG9ncmFtLgoJICAgICAgICB2YXIgbnVtQnVja2V0cyA9IGJ1Y2tldHMubGVuZ3RoOwoJICAgICAgICB2YXIgbWF4QnVja2V0Q291bnQgPSAwOwoJICAgICAgICB2YXIgZmlyc3RQZWFrID0gMDsKCSAgICAgICAgdmFyIGZpcnN0UGVha1NpemUgPSAwOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG51bUJ1Y2tldHM7IHgrKykgewoJICAgICAgICAgICAgaWYgKGJ1Y2tldHNbeF0gPiBmaXJzdFBlYWtTaXplKSB7CgkgICAgICAgICAgICAgICAgZmlyc3RQZWFrID0geDsKCSAgICAgICAgICAgICAgICBmaXJzdFBlYWtTaXplID0gYnVja2V0c1t4XTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChidWNrZXRzW3hdID4gbWF4QnVja2V0Q291bnQpIHsKCSAgICAgICAgICAgICAgICBtYXhCdWNrZXRDb3VudCA9IGJ1Y2tldHNbeF07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gRmluZCB0aGUgc2Vjb25kLXRhbGxlc3QgcGVhayB3aGljaCBpcyBzb21ld2hhdCBmYXIgZnJvbSB0aGUgdGFsbGVzdCBwZWFrLgoJICAgICAgICB2YXIgc2Vjb25kUGVhayA9IDA7CgkgICAgICAgIHZhciBzZWNvbmRQZWFrU2NvcmUgPSAwOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG51bUJ1Y2tldHM7IHgrKykgewoJICAgICAgICAgICAgdmFyIGRpc3RhbmNlVG9CaWdnZXN0ID0geCAtIGZpcnN0UGVhazsKCSAgICAgICAgICAgIC8vIEVuY291cmFnZSBtb3JlIGRpc3RhbnQgc2Vjb25kIHBlYWtzIGJ5IG11bHRpcGx5aW5nIGJ5IHNxdWFyZSBvZiBkaXN0YW5jZS4KCSAgICAgICAgICAgIHZhciBzY29yZSA9IGJ1Y2tldHNbeF0gKiBkaXN0YW5jZVRvQmlnZ2VzdCAqIGRpc3RhbmNlVG9CaWdnZXN0OwoJICAgICAgICAgICAgaWYgKHNjb3JlID4gc2Vjb25kUGVha1Njb3JlKSB7CgkgICAgICAgICAgICAgICAgc2Vjb25kUGVhayA9IHg7CgkgICAgICAgICAgICAgICAgc2Vjb25kUGVha1Njb3JlID0gc2NvcmU7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTWFrZSBzdXJlIGZpcnN0UGVhayBjb3JyZXNwb25kcyB0byB0aGUgYmxhY2sgcGVhay4KCSAgICAgICAgaWYgKGZpcnN0UGVhayA+IHNlY29uZFBlYWspIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gZmlyc3RQZWFrOwoJICAgICAgICAgICAgZmlyc3RQZWFrID0gc2Vjb25kUGVhazsKCSAgICAgICAgICAgIHNlY29uZFBlYWsgPSB0ZW1wOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHRoZXJlIGlzIHRvbyBsaXR0bGUgY29udHJhc3QgaW4gdGhlIGltYWdlIHRvIHBpY2sgYSBtZWFuaW5nZnVsIGJsYWNrIHBvaW50LCB0aHJvdyByYXRoZXIKCSAgICAgICAgLy8gdGhhbiB3YXN0ZSB0aW1lIHRyeWluZyB0byBkZWNvZGUgdGhlIGltYWdlLCBhbmQgcmlzayBmYWxzZSBwb3NpdGl2ZXMuCgkgICAgICAgIGlmIChzZWNvbmRQZWFrIC0gZmlyc3RQZWFrIDw9IG51bUJ1Y2tldHMgLyAxNikgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRmluZCBhIHZhbGxleSBiZXR3ZWVuIHRoZW0gdGhhdCBpcyBsb3cgYW5kIGNsb3NlciB0byB0aGUgd2hpdGUgcGVhay4KCSAgICAgICAgdmFyIGJlc3RWYWxsZXkgPSBzZWNvbmRQZWFrIC0gMTsKCSAgICAgICAgdmFyIGJlc3RWYWxsZXlTY29yZSA9IC0xOwoJICAgICAgICBmb3IgKHZhciB4ID0gc2Vjb25kUGVhayAtIDE7IHggPiBmaXJzdFBlYWs7IHgtLSkgewoJICAgICAgICAgICAgdmFyIGZyb21GaXJzdCA9IHggLSBmaXJzdFBlYWs7CgkgICAgICAgICAgICB2YXIgc2NvcmUgPSBmcm9tRmlyc3QgKiBmcm9tRmlyc3QgKiAoc2Vjb25kUGVhayAtIHgpICogKG1heEJ1Y2tldENvdW50IC0gYnVja2V0c1t4XSk7CgkgICAgICAgICAgICBpZiAoc2NvcmUgPiBiZXN0VmFsbGV5U2NvcmUpIHsKCSAgICAgICAgICAgICAgICBiZXN0VmFsbGV5ID0geDsKCSAgICAgICAgICAgICAgICBiZXN0VmFsbGV5U2NvcmUgPSBzY29yZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gYmVzdFZhbGxleSA8PCBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUOwoJICAgIH07CgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkxVTUlOQU5DRV9CSVRTID0gNTsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUID0gOCAtIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQklUUzsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX0JVQ0tFVFMgPSAxIDw8IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQklUUzsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuRU1QVFkgPSBVaW50OENsYW1wZWRBcnJheS5mcm9tKFswXSk7CgkgICAgcmV0dXJuIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcjsKCX0oQmluYXJpemVyXzEuZGVmYXVsdCkpOwoJR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyJDEuZGVmYXVsdCA9IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcjsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fZXh0ZW5kcyRiID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEh5YnJpZEJpbmFyaXplciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyXzEgPSBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMTsKCXZhciBCaXRNYXRyaXhfMSQ0ID0gQml0TWF0cml4JDE7CgkvKioKCSAqIFRoaXMgY2xhc3MgaW1wbGVtZW50cyBhIGxvY2FsIHRocmVzaG9sZGluZyBhbGdvcml0aG0sIHdoaWNoIHdoaWxlIHNsb3dlciB0aGFuIHRoZQoJICogR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLCBpcyBmYWlybHkgZWZmaWNpZW50IGZvciB3aGF0IGl0IGRvZXMuIEl0IGlzIGRlc2lnbmVkIGZvcgoJICogaGlnaCBmcmVxdWVuY3kgaW1hZ2VzIG9mIGJhcmNvZGVzIHdpdGggYmxhY2sgZGF0YSBvbiB3aGl0ZSBiYWNrZ3JvdW5kcy4gRm9yIHRoaXMgYXBwbGljYXRpb24sCgkgKiBpdCBkb2VzIGEgbXVjaCBiZXR0ZXIgam9iIHRoYW4gYSBnbG9iYWwgYmxhY2twb2ludCB3aXRoIHNldmVyZSBzaGFkb3dzIGFuZCBncmFkaWVudHMuCgkgKiBIb3dldmVyIGl0IHRlbmRzIHRvIHByb2R1Y2UgYXJ0aWZhY3RzIG9uIGxvd2VyIGZyZXF1ZW5jeSBpbWFnZXMgYW5kIGlzIHRoZXJlZm9yZSBub3QKCSAqIGEgZ29vZCBnZW5lcmFsIHB1cnBvc2UgYmluYXJpemVyIGZvciB1c2VzIG91dHNpZGUgWlhpbmcuCgkgKgoJICogVGhpcyBjbGFzcyBleHRlbmRzIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplciwgdXNpbmcgdGhlIG9sZGVyIGhpc3RvZ3JhbSBhcHByb2FjaCBmb3IgMUQgcmVhZGVycywKCSAqIGFuZCB0aGUgbmV3ZXIgbG9jYWwgYXBwcm9hY2ggZm9yIDJEIHJlYWRlcnMuIDFEIGRlY29kaW5nIHVzaW5nIGEgcGVyLXJvdyBoaXN0b2dyYW0gaXMgYWxyZWFkeQoJICogaW5oZXJlbnRseSBsb2NhbCwgYW5kIG9ubHkgZmFpbHMgZm9yIGhvcml6b250YWwgZ3JhZGllbnRzLiBXZSBjYW4gcmV2aXNpdCB0aGF0IHByb2JsZW0gbGF0ZXIsCgkgKiBidXQgZm9yIG5vdyBpdCB3YXMgbm90IGEgd2luIHRvIHVzZSBsb2NhbCBibG9ja3MgZm9yIDFELgoJICoKCSAqIFRoaXMgQmluYXJpemVyIGlzIHRoZSBkZWZhdWx0IGZvciB0aGUgdW5pdCB0ZXN0cyBhbmQgdGhlIHJlY29tbWVuZGVkIGNsYXNzIGZvciBsaWJyYXJ5IHVzZXJzLgoJICoKCSAqIEBhdXRob3IgZHN3aXRraW5AZ29vZ2xlLmNvbSAoRGFuaWVsIFN3aXRraW4pCgkgKi8KCXZhciBIeWJyaWRCaW5hcml6ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGIoSHlicmlkQmluYXJpemVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEh5YnJpZEJpbmFyaXplcihzb3VyY2UpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgc291cmNlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5tYXRyaXggPSBudWxsOwoJICAgICAgICByZXR1cm4gX3RoaXM7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIENhbGN1bGF0ZXMgdGhlIGZpbmFsIEJpdE1hdHJpeCBvbmNlIGZvciBhbGwgcmVxdWVzdHMuIFRoaXMgY291bGQgYmUgY2FsbGVkIG9uY2UgZnJvbSB0aGUKCSAgICAgKiBjb25zdHJ1Y3RvciBpbnN0ZWFkLCBidXQgdGhlcmUgYXJlIHNvbWUgYWR2YW50YWdlcyB0byBkb2luZyBpdCBsYXppbHksIHN1Y2ggYXMgbWFraW5nCgkgICAgICogcHJvZmlsaW5nIGVhc2llciwgYW5kIG5vdCBkb2luZyBoZWF2eSBsaWZ0aW5nIHdoZW4gY2FsbGVycyBkb24ndCBleHBlY3QgaXQuCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEh5YnJpZEJpbmFyaXplci5wcm90b3R5cGUuZ2V0QmxhY2tNYXRyaXggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLm1hdHJpeCAhPT0gbnVsbCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0cml4OwoJICAgICAgICB9CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IHNvdXJjZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgaWYgKHdpZHRoID49IEh5YnJpZEJpbmFyaXplci5NSU5JTVVNX0RJTUVOU0lPTiAmJiBoZWlnaHQgPj0gSHlicmlkQmluYXJpemVyLk1JTklNVU1fRElNRU5TSU9OKSB7CgkgICAgICAgICAgICB2YXIgbHVtaW5hbmNlcyA9IHNvdXJjZS5nZXRNYXRyaXgoKTsKCSAgICAgICAgICAgIHZhciBzdWJXaWR0aCA9IHdpZHRoID4+IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKCh3aWR0aCAmIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0spICE9PSAwKSB7CgkgICAgICAgICAgICAgICAgc3ViV2lkdGgrKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhciBzdWJIZWlnaHQgPSBoZWlnaHQgPj4gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7CgkgICAgICAgICAgICBpZiAoKGhlaWdodCAmIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0spICE9PSAwKSB7CgkgICAgICAgICAgICAgICAgc3ViSGVpZ2h0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgYmxhY2tQb2ludHMgPSBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlQmxhY2tQb2ludHMobHVtaW5hbmNlcywgc3ViV2lkdGgsIHN1YkhlaWdodCwgd2lkdGgsIGhlaWdodCk7CgkgICAgICAgICAgICB2YXIgbmV3TWF0cml4ID0gbmV3IEJpdE1hdHJpeF8xJDQuZGVmYXVsdCh3aWR0aCwgaGVpZ2h0KTsKCSAgICAgICAgICAgIEh5YnJpZEJpbmFyaXplci5jYWxjdWxhdGVUaHJlc2hvbGRGb3JCbG9jayhsdW1pbmFuY2VzLCBzdWJXaWR0aCwgc3ViSGVpZ2h0LCB3aWR0aCwgaGVpZ2h0LCBibGFja1BvaW50cywgbmV3TWF0cml4KTsKCSAgICAgICAgICAgIHRoaXMubWF0cml4ID0gbmV3TWF0cml4OwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgLy8gSWYgdGhlIGltYWdlIGlzIHRvbyBzbWFsbCwgZmFsbCBiYWNrIHRvIHRoZSBnbG9iYWwgaGlzdG9ncmFtIGFwcHJvYWNoLgoJICAgICAgICAgICAgdGhpcy5tYXRyaXggPSBfc3VwZXIucHJvdG90eXBlLmdldEJsYWNrTWF0cml4LmNhbGwodGhpcyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMubWF0cml4OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEh5YnJpZEJpbmFyaXplci5wcm90b3R5cGUuY3JlYXRlQmluYXJpemVyID0gZnVuY3Rpb24gKHNvdXJjZSkgewoJICAgICAgICByZXR1cm4gbmV3IEh5YnJpZEJpbmFyaXplcihzb3VyY2UpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRm9yIGVhY2ggYmxvY2sgaW4gdGhlIGltYWdlLCBjYWxjdWxhdGUgdGhlIGF2ZXJhZ2UgYmxhY2sgcG9pbnQgdXNpbmcgYSA1eDUgZ3JpZAoJICAgICAqIG9mIHRoZSBibG9ja3MgYXJvdW5kIGl0LiBBbHNvIGhhbmRsZXMgdGhlIGNvcm5lciBjYXNlcyAoZnJhY3Rpb25hbCBibG9ja3MgYXJlIGNvbXB1dGVkIGJhc2VkCgkgICAgICogb24gdGhlIGxhc3QgcGl4ZWxzIGluIHRoZSByb3cvY29sdW1uIHdoaWNoIGFyZSBhbHNvIHVzZWQgaW4gdGhlIHByZXZpb3VzIGJsb2NrKS4KCSAgICAgKi8KCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlVGhyZXNob2xkRm9yQmxvY2sgPSBmdW5jdGlvbiAobHVtaW5hbmNlcywgc3ViV2lkdGggLyppbnQqLywgc3ViSGVpZ2h0IC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovLCBibGFja1BvaW50cywgbWF0cml4KSB7CgkgICAgICAgIHZhciBtYXhZT2Zmc2V0ID0gaGVpZ2h0IC0gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7CgkgICAgICAgIHZhciBtYXhYT2Zmc2V0ID0gd2lkdGggLSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBzdWJIZWlnaHQ7IHkrKykgewoJICAgICAgICAgICAgdmFyIHlvZmZzZXQgPSB5IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKHlvZmZzZXQgPiBtYXhZT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgeW9mZnNldCA9IG1heFlPZmZzZXQ7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgdG9wXzEgPSBIeWJyaWRCaW5hcml6ZXIuY2FwKHksIDIsIHN1YkhlaWdodCAtIDMpOwoJICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBzdWJXaWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHhvZmZzZXQgPSB4IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgICAgIGlmICh4b2Zmc2V0ID4gbWF4WE9mZnNldCkgewoJICAgICAgICAgICAgICAgICAgICB4b2Zmc2V0ID0gbWF4WE9mZnNldDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgdmFyIGxlZnQgPSBIeWJyaWRCaW5hcml6ZXIuY2FwKHgsIDIsIHN1YldpZHRoIC0gMyk7CgkgICAgICAgICAgICAgICAgdmFyIHN1bSA9IDA7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgeiA9IC0yOyB6IDw9IDI7IHorKykgewoJICAgICAgICAgICAgICAgICAgICB2YXIgYmxhY2tSb3cgPSBibGFja1BvaW50c1t0b3BfMSArIHpdOwoJICAgICAgICAgICAgICAgICAgICBzdW0gKz0gYmxhY2tSb3dbbGVmdCAtIDJdICsgYmxhY2tSb3dbbGVmdCAtIDFdICsgYmxhY2tSb3dbbGVmdF0gKyBibGFja1Jvd1tsZWZ0ICsgMV0gKyBibGFja1Jvd1tsZWZ0ICsgMl07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHZhciBhdmVyYWdlID0gc3VtIC8gMjU7CgkgICAgICAgICAgICAgICAgSHlicmlkQmluYXJpemVyLnRocmVzaG9sZEJsb2NrKGx1bWluYW5jZXMsIHhvZmZzZXQsIHlvZmZzZXQsIGF2ZXJhZ2UsIHdpZHRoLCBtYXRyaXgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FwID0gZnVuY3Rpb24gKHZhbHVlIC8qaW50Ki8sIG1pbiAvKmludCovLCBtYXggLyppbnQqLykgewoJICAgICAgICByZXR1cm4gdmFsdWUgPCBtaW4gPyBtaW4gOiB2YWx1ZSA+IG1heCA/IG1heCA6IHZhbHVlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQXBwbGllcyBhIHNpbmdsZSB0aHJlc2hvbGQgdG8gYSBibG9jayBvZiBwaXhlbHMuCgkgICAgICovCgkgICAgSHlicmlkQmluYXJpemVyLnRocmVzaG9sZEJsb2NrID0gZnVuY3Rpb24gKGx1bWluYW5jZXMsIHhvZmZzZXQgLyppbnQqLywgeW9mZnNldCAvKmludCovLCB0aHJlc2hvbGQgLyppbnQqLywgc3RyaWRlIC8qaW50Ki8sIG1hdHJpeCkgewoJICAgICAgICBmb3IgKHZhciB5ID0gMCwgb2Zmc2V0ID0geW9mZnNldCAqIHN0cmlkZSArIHhvZmZzZXQ7IHkgPCBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsgeSsrLCBvZmZzZXQgKz0gc3RyaWRlKSB7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFOyB4KyspIHsKCSAgICAgICAgICAgICAgICAvLyBDb21wYXJpc29uIG5lZWRzIHRvIGJlIDw9IHNvIHRoYXQgYmxhY2sgPT0gMCBwaXhlbHMgYXJlIGJsYWNrIGV2ZW4gaWYgdGhlIHRocmVzaG9sZCBpcyAwLgoJICAgICAgICAgICAgICAgIGlmICgobHVtaW5hbmNlc1tvZmZzZXQgKyB4XSAmIDB4RkYpIDw9IHRocmVzaG9sZCkgewoJICAgICAgICAgICAgICAgICAgICBtYXRyaXguc2V0KHhvZmZzZXQgKyB4LCB5b2Zmc2V0ICsgeSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDYWxjdWxhdGVzIGEgc2luZ2xlIGJsYWNrIHBvaW50IGZvciBlYWNoIGJsb2NrIG9mIHBpeGVscyBhbmQgc2F2ZXMgaXQgYXdheS4KCSAgICAgKiBTZWUgdGhlIGZvbGxvd2luZyB0aHJlYWQgZm9yIGEgZGlzY3Vzc2lvbiBvZiB0aGlzIGFsZ29yaXRobToKCSAgICAgKiAgaHR0cDovL2dyb3Vwcy5nb29nbGUuY29tL2dyb3VwL3p4aW5nL2Jyb3dzZV90aHJlYWQvdGhyZWFkL2QwNmVmYTJjMzVhN2RkYzAKCSAgICAgKi8KCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlQmxhY2tQb2ludHMgPSBmdW5jdGlvbiAobHVtaW5hbmNlcywgc3ViV2lkdGggLyppbnQqLywgc3ViSGVpZ2h0IC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHZhciBtYXhZT2Zmc2V0ID0gaGVpZ2h0IC0gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7CgkgICAgICAgIHZhciBtYXhYT2Zmc2V0ID0gd2lkdGggLSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsKCSAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOndoaXRlc3BhY2UKCSAgICAgICAgdmFyIGJsYWNrUG9pbnRzID0gbmV3IEFycmF5KHN1YkhlaWdodCk7IC8vIHN1YldpZHRoCgkgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgc3ViSGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGJsYWNrUG9pbnRzW3ldID0gbmV3IEludDMyQXJyYXkoc3ViV2lkdGgpOwoJICAgICAgICAgICAgdmFyIHlvZmZzZXQgPSB5IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKHlvZmZzZXQgPiBtYXhZT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgeW9mZnNldCA9IG1heFlPZmZzZXQ7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHN1YldpZHRoOyB4KyspIHsKCSAgICAgICAgICAgICAgICB2YXIgeG9mZnNldCA9IHggPDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7CgkgICAgICAgICAgICAgICAgaWYgKHhvZmZzZXQgPiBtYXhYT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgICAgIHhvZmZzZXQgPSBtYXhYT2Zmc2V0OwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB2YXIgc3VtID0gMDsKCSAgICAgICAgICAgICAgICB2YXIgbWluID0gMHhGRjsKCSAgICAgICAgICAgICAgICB2YXIgbWF4ID0gMDsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciB5eSA9IDAsIG9mZnNldCA9IHlvZmZzZXQgKiB3aWR0aCArIHhvZmZzZXQ7IHl5IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHl5KyssIG9mZnNldCArPSB3aWR0aCkgewoJICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB4eCA9IDA7IHh4IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHh4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwaXhlbCA9IGx1bWluYW5jZXNbb2Zmc2V0ICsgeHhdICYgMHhGRjsKCSAgICAgICAgICAgICAgICAgICAgICAgIHN1bSArPSBwaXhlbDsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0aWxsIGxvb2tpbmcgZm9yIGdvb2QgY29udHJhc3QKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwaXhlbCA8IG1pbikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbiA9IHBpeGVsOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBpeGVsID4gbWF4KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4ID0gcGl4ZWw7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgLy8gc2hvcnQtY2lyY3VpdCBtaW4vbWF4IHRlc3RzIG9uY2UgZHluYW1pYyByYW5nZSBpcyBtZXQKCSAgICAgICAgICAgICAgICAgICAgaWYgKG1heCAtIG1pbiA+IEh5YnJpZEJpbmFyaXplci5NSU5fRFlOQU1JQ19SQU5HRSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmluaXNoIHRoZSByZXN0IG9mIHRoZSByb3dzIHF1aWNrbHkKCSAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoeXkrKywgb2Zmc2V0ICs9IHdpZHRoOyB5eSA8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFOyB5eSsrLCBvZmZzZXQgKz0gd2lkdGgpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB4eCA9IDA7IHh4IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHh4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VtICs9IGx1bWluYW5jZXNbb2Zmc2V0ICsgeHhdICYgMHhGRjsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgLy8gVGhlIGRlZmF1bHQgZXN0aW1hdGUgaXMgdGhlIGF2ZXJhZ2Ugb2YgdGhlIHZhbHVlcyBpbiB0aGUgYmxvY2suCgkgICAgICAgICAgICAgICAgdmFyIGF2ZXJhZ2UgPSBzdW0gPj4gKEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSICogMik7CgkgICAgICAgICAgICAgICAgaWYgKG1heCAtIG1pbiA8PSBIeWJyaWRCaW5hcml6ZXIuTUlOX0RZTkFNSUNfUkFOR0UpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gSWYgdmFyaWF0aW9uIHdpdGhpbiB0aGUgYmxvY2sgaXMgbG93LCBhc3N1bWUgdGhpcyBpcyBhIGJsb2NrIHdpdGggb25seSBsaWdodCBvciBvbmx5CgkgICAgICAgICAgICAgICAgICAgIC8vIGRhcmsgcGl4ZWxzLiBJbiB0aGF0IGNhc2Ugd2UgZG8gbm90IHdhbnQgdG8gdXNlIHRoZSBhdmVyYWdlLCBhcyBpdCB3b3VsZCBkaXZpZGUgdGhpcwoJICAgICAgICAgICAgICAgICAgICAvLyBsb3cgY29udHJhc3QgYXJlYSBpbnRvIGJsYWNrIGFuZCB3aGl0ZSBwaXhlbHMsIGVzc2VudGlhbGx5IGNyZWF0aW5nIGRhdGEgb3V0IG9mIG5vaXNlLgoJICAgICAgICAgICAgICAgICAgICAvLwoJICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZGVmYXVsdCBhc3N1bXB0aW9uIGlzIHRoYXQgdGhlIGJsb2NrIGlzIGxpZ2h0L2JhY2tncm91bmQuIFNpbmNlIG5vIGVzdGltYXRlIGZvcgoJICAgICAgICAgICAgICAgICAgICAvLyB0aGUgbGV2ZWwgb2YgZGFyayBwaXhlbHMgZXhpc3RzIGxvY2FsbHksIHVzZSBoYWxmIHRoZSBtaW4gZm9yIHRoZSBibG9jay4KCSAgICAgICAgICAgICAgICAgICAgYXZlcmFnZSA9IG1pbiAvIDI7CgkgICAgICAgICAgICAgICAgICAgIGlmICh5ID4gMCAmJiB4ID4gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29ycmVjdCB0aGUgIndoaXRlIGJhY2tncm91bmQiIGFzc3VtcHRpb24gZm9yIGJsb2NrcyB0aGF0IGhhdmUgbmVpZ2hib3JzIGJ5IGNvbXBhcmluZwoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHBpeGVscyBpbiB0aGlzIGJsb2NrIHRvIHRoZSBwcmV2aW91c2x5IGNhbGN1bGF0ZWQgYmxhY2sgcG9pbnRzLiBUaGlzIGlzIGJhc2VkIG9uCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgZmFjdCB0aGF0IGRhcmsgYmFyY29kZSBzeW1ib2xvZ3kgaXMgYWx3YXlzIHN1cnJvdW5kZWQgYnkgc29tZSBhbW91bnQgb2YgbGlnaHQKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJhY2tncm91bmQgZm9yIHdoaWNoIHJlYXNvbmFibGUgYmxhY2sgcG9pbnQgZXN0aW1hdGVzIHdlcmUgbWFkZS4gVGhlIGJwIGVzdGltYXRlZCBhdAoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGJvdW5kYXJpZXMgaXMgdXNlZCBmb3IgdGhlIGludGVyaW9yLgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIChtaW4gPCBicCkgaXMgYXJiaXRyYXJ5IGJ1dCB3b3JrcyBiZXR0ZXIgdGhhbiBvdGhlciBoZXVyaXN0aWNzIHRoYXQgd2VyZSB0cmllZC4KCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdmVyYWdlTmVpZ2hib3JCbGFja1BvaW50ID0gKGJsYWNrUG9pbnRzW3kgLSAxXVt4XSArICgyICogYmxhY2tQb2ludHNbeV1beCAtIDFdKSArIGJsYWNrUG9pbnRzW3kgLSAxXVt4IC0gMV0pIC8gNDsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtaW4gPCBhdmVyYWdlTmVpZ2hib3JCbGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZlcmFnZSA9IGF2ZXJhZ2VOZWlnaGJvckJsYWNrUG9pbnQ7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgYmxhY2tQb2ludHNbeV1beF0gPSBhdmVyYWdlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBibGFja1BvaW50czsKCSAgICB9OwoJICAgIC8vIFRoaXMgY2xhc3MgdXNlcyA1eDUgYmxvY2tzIHRvIGNvbXB1dGUgbG9jYWwgbHVtaW5hbmNlLCB3aGVyZSBlYWNoIGJsb2NrIGlzIDh4OCBwaXhlbHMuCgkgICAgLy8gU28gdGhpcyBpcyB0aGUgc21hbGxlc3QgZGltZW5zaW9uIGluIGVhY2ggYXhpcyB3ZSBjYW4gYWNjZXB0LgoJICAgIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSID0gMzsKCSAgICBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRSA9IDEgPDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7IC8vIC4uLjAxMDAuLi4wMAoJICAgIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0sgPSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRSAtIDE7IC8vIC4uLjAwMTEuLi4xMQoJICAgIEh5YnJpZEJpbmFyaXplci5NSU5JTVVNX0RJTUVOU0lPTiA9IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFICogNTsKCSAgICBIeWJyaWRCaW5hcml6ZXIuTUlOX0RZTkFNSUNfUkFOR0UgPSAyNDsKCSAgICByZXR1cm4gSHlicmlkQmluYXJpemVyOwoJfShHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXJfMS5kZWZhdWx0KSk7Cgl2YXIgX2RlZmF1bHQkMiA9IEh5YnJpZEJpbmFyaXplciQxLmRlZmF1bHQgPSBIeWJyaWRCaW5hcml6ZXI7CgoJdmFyIFJHQkx1bWluYW5jZVNvdXJjZSQxID0ge307CgoJdmFyIEludmVydGVkTHVtaW5hbmNlU291cmNlJDEgPSB7fTsKCgl2YXIgTHVtaW5hbmNlU291cmNlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEx1bWluYW5jZVNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3RyaW5nQnVpbGRlcl8xJDEgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMSA9IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uJDE7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nIHsqLwoJLyoqCgkgKiBUaGUgcHVycG9zZSBvZiB0aGlzIGNsYXNzIGhpZXJhcmNoeSBpcyB0byBhYnN0cmFjdCBkaWZmZXJlbnQgYml0bWFwIGltcGxlbWVudGF0aW9ucyBhY3Jvc3MKCSAqIHBsYXRmb3JtcyBpbnRvIGEgc3RhbmRhcmQgaW50ZXJmYWNlIGZvciByZXF1ZXN0aW5nIGdyZXlzY2FsZSBsdW1pbmFuY2UgdmFsdWVzLiBUaGUgaW50ZXJmYWNlCgkgKiBvbmx5IHByb3ZpZGVzIGltbXV0YWJsZSBtZXRob2RzOyB0aGVyZWZvcmUgY3JvcCBhbmQgcm90YXRpb24gY3JlYXRlIGNvcGllcy4gVGhpcyBpcyB0byBlbnN1cmUKCSAqIHRoYXQgb25lIFJlYWRlciBkb2VzIG5vdCBtb2RpZnkgdGhlIG9yaWdpbmFsIGx1bWluYW5jZSBzb3VyY2UgYW5kIGxlYXZlIGl0IGluIGFuIHVua25vd24gc3RhdGUKCSAqIGZvciBvdGhlciBSZWFkZXJzIGluIHRoZSBjaGFpbi4KCSAqCgkgKiBAYXV0aG9yIGRzd2l0a2luQGdvb2dsZS5jb20gKERhbmllbCBTd2l0a2luKQoJICovCgl2YXIgTHVtaW5hbmNlU291cmNlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEx1bWluYW5jZVNvdXJjZSh3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7CgkgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwoJICAgIH0KCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSB3aWR0aCBvZiB0aGUgYml0bWFwLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuZ2V0V2lkdGggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLndpZHRoOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBUaGUgaGVpZ2h0IG9mIHRoZSBiaXRtYXAuCgkgICAgICovCgkgICAgTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRIZWlnaHQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmhlaWdodDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIHN1YmNsYXNzIHN1cHBvcnRzIGNyb3BwaW5nLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNDcm9wU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIGEgbmV3IG9iamVjdCB3aXRoIGNyb3BwZWQgaW1hZ2UgZGF0YS4gSW1wbGVtZW50YXRpb25zIG1heSBrZWVwIGEgcmVmZXJlbmNlIHRvIHRoZQoJICAgICAqIG9yaWdpbmFsIGRhdGEgcmF0aGVyIHRoYW4gYSBjb3B5LiBPbmx5IGNhbGxhYmxlIGlmIGlzQ3JvcFN1cHBvcnRlZCgpIGlzIHRydWUuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gbGVmdCBUaGUgbGVmdCBjb29yZGluYXRlLCB3aGljaCBtdXN0IGJlIGluIFswLGdldFdpZHRoKCkpCgkgICAgICogQHBhcmFtIHRvcCBUaGUgdG9wIGNvb3JkaW5hdGUsIHdoaWNoIG11c3QgYmUgaW4gWzAsZ2V0SGVpZ2h0KCkpCgkgICAgICogQHBhcmFtIHdpZHRoIFRoZSB3aWR0aCBvZiB0aGUgcmVjdGFuZ2xlIHRvIGNyb3AuCgkgICAgICogQHBhcmFtIGhlaWdodCBUaGUgaGVpZ2h0IG9mIHRoZSByZWN0YW5nbGUgdG8gY3JvcC4KCSAgICAgKiBAcmV0dXJuIEEgY3JvcHBlZCB2ZXJzaW9uIG9mIHRoaXMgb2JqZWN0LgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuY3JvcCA9IGZ1bmN0aW9uIChsZWZ0IC8qaW50Ki8sIHRvcCAvKmludCovLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMS5kZWZhdWx0KCdUaGlzIGx1bWluYW5jZSBzb3VyY2UgZG9lcyBub3Qgc3VwcG9ydCBjcm9wcGluZy4nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIHN1YmNsYXNzIHN1cHBvcnRzIGNvdW50ZXItY2xvY2t3aXNlIHJvdGF0aW9uLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNSb3RhdGVTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggcm90YXRlZCBpbWFnZSBkYXRhIGJ5IDkwIGRlZ3JlZXMgY291bnRlcmNsb2Nrd2lzZS4KCSAgICAgKiBPbmx5IGNhbGxhYmxlIGlmIHtAbGluayAjaXNSb3RhdGVTdXBwb3J0ZWQoKX0gaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gQSByb3RhdGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMS5kZWZhdWx0KCdUaGlzIGx1bWluYW5jZSBzb3VyY2UgZG9lcyBub3Qgc3VwcG9ydCByb3RhdGlvbiBieSA5MCBkZWdyZWVzLicpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV0dXJucyBhIG5ldyBvYmplY3Qgd2l0aCByb3RhdGVkIGltYWdlIGRhdGEgYnkgNDUgZGVncmVlcyBjb3VudGVyY2xvY2t3aXNlLgoJICAgICAqIE9ubHkgY2FsbGFibGUgaWYge0BsaW5rICNpc1JvdGF0ZVN1cHBvcnRlZCgpfSBpcyB0cnVlLgoJICAgICAqCgkgICAgICogQHJldHVybiBBIHJvdGF0ZWQgdmVyc2lvbiBvZiB0aGlzIG9iamVjdC4KCSAgICAgKi8KCSAgICBMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLnJvdGF0ZUNvdW50ZXJDbG9ja3dpc2U0NSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uXzEuZGVmYXVsdCgnVGhpcyBsdW1pbmFuY2Ugc291cmNlIGRvZXMgbm90IHN1cHBvcnQgcm90YXRpb24gYnkgNDUgZGVncmVlcy4nKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgcm93ID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHRoaXMud2lkdGgpOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1aWxkZXJfMSQxLmRlZmF1bHQoKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCB0aGlzLmhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgc291cmNlUm93ID0gdGhpcy5nZXRSb3coeSwgcm93KTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgdGhpcy53aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGx1bWluYW5jZSA9IHNvdXJjZVJvd1t4XSAmIDB4RkY7CgkgICAgICAgICAgICAgICAgdmFyIGMgPSB2b2lkIDA7CgkgICAgICAgICAgICAgICAgaWYgKGx1bWluYW5jZSA8IDB4NDApIHsKCSAgICAgICAgICAgICAgICAgICAgYyA9ICcjJzsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAobHVtaW5hbmNlIDwgMHg4MCkgewoJICAgICAgICAgICAgICAgICAgICBjID0gJysnOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIGlmIChsdW1pbmFuY2UgPCAweEMwKSB7CgkgICAgICAgICAgICAgICAgICAgIGMgPSAnLic7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICBjID0gJyAnOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICByZXN1bHQuYXBwZW5kKGMpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZCgnXG4nKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0LnRvU3RyaW5nKCk7CgkgICAgfTsKCSAgICByZXR1cm4gTHVtaW5hbmNlU291cmNlOwoJfSgpKTsKCUx1bWluYW5jZVNvdXJjZSQxLmRlZmF1bHQgPSBMdW1pbmFuY2VTb3VyY2U7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA5IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMkYSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbnZlcnRlZEx1bWluYW5jZVNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgTHVtaW5hbmNlU291cmNlXzEkMSA9IEx1bWluYW5jZVNvdXJjZSQxOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogQSB3cmFwcGVyIGltcGxlbWVudGF0aW9uIG9mIHtAbGluayBMdW1pbmFuY2VTb3VyY2V9IHdoaWNoIGludmVydHMgdGhlIGx1bWluYW5jZXMgaXQgcmV0dXJucyAtLSBibGFjayBiZWNvbWVzCgkgKiB3aGl0ZSBhbmQgdmljZSB2ZXJzYSwgYW5kIGVhY2ggdmFsdWUgYmVjb21lcyAoMjU1LXZhbHVlKS4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGEoSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UsIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UoZGVsZWdhdGUpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgZGVsZWdhdGUuZ2V0V2lkdGgoKSwgZGVsZWdhdGUuZ2V0SGVpZ2h0KCkpIHx8IHRoaXM7CgkgICAgICAgIF90aGlzLmRlbGVnYXRlID0gZGVsZWdhdGU7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgdmFyIHNvdXJjZVJvdyA9IHRoaXMuZGVsZWdhdGUuZ2V0Um93KHksIHJvdyk7CgkgICAgICAgIHZhciB3aWR0aCA9IHRoaXMuZ2V0V2lkdGgoKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3aWR0aDsgaSsrKSB7CgkgICAgICAgICAgICBzb3VyY2VSb3dbaV0gPSAvKihieXRlKSovICgyNTUgLSAoc291cmNlUm93W2ldICYgMHhGRikpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBzb3VyY2VSb3c7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLmdldE1hdHJpeCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIG1hdHJpeCA9IHRoaXMuZGVsZWdhdGUuZ2V0TWF0cml4KCk7CgkgICAgICAgIHZhciBsZW5ndGggPSB0aGlzLmdldFdpZHRoKCkgKiB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgaW52ZXJ0ZWRNYXRyaXggPSBuZXcgVWludDhDbGFtcGVkQXJyYXkobGVuZ3RoKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewoJICAgICAgICAgICAgaW52ZXJ0ZWRNYXRyaXhbaV0gPSAvKihieXRlKSovICgyNTUgLSAobWF0cml4W2ldICYgMHhGRikpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBpbnZlcnRlZE1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNDcm9wU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5kZWxlZ2F0ZS5pc0Nyb3BTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuY3JvcCA9IGZ1bmN0aW9uIChsZWZ0IC8qaW50Ki8sIHRvcCAvKmludCovLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUuY3JvcChsZWZ0LCB0b3AsIHdpZHRoLCBoZWlnaHQpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNSb3RhdGVTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlbGVnYXRlLmlzUm90YXRlU3VwcG9ydGVkKCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIG9yaWdpbmFsIGRlbGVnYXRlIHtAbGluayBMdW1pbmFuY2VTb3VyY2V9IHNpbmNlIGludmVydCB1bmRvZXMgaXRzZWxmCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5pbnZlcnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlbGVnYXRlOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUucm90YXRlQ291bnRlckNsb2Nrd2lzZSgpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1KCkpOwoJICAgIH07CgkgICAgcmV0dXJuIEludmVydGVkTHVtaW5hbmNlU291cmNlOwoJfShMdW1pbmFuY2VTb3VyY2VfMSQxLmRlZmF1bHQpKTsKCUludmVydGVkTHVtaW5hbmNlU291cmNlJDEuZGVmYXVsdCA9IEludmVydGVkTHVtaW5hbmNlU291cmNlOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDkgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoUkdCTHVtaW5hbmNlU291cmNlJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcgeyovCgkgLy8gcmVxdWlyZWQgYmVjYXVzZSBvZiBjaXJjdWxhciBkZXBlbmRlbmNpZXMgYmV0d2VlbiBMdW1pbmFuY2VTb3VyY2UgYW5kIEludmVydGVkTHVtaW5hbmNlU291cmNlCgl2YXIgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2VfMSA9IEludmVydGVkTHVtaW5hbmNlU291cmNlJDE7Cgl2YXIgTHVtaW5hbmNlU291cmNlXzEgPSBMdW1pbmFuY2VTb3VyY2UkMTsKCXZhciBTeXN0ZW1fMSQyID0gU3lzdGVtJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNiA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBUaGlzIGNsYXNzIGlzIHVzZWQgdG8gaGVscCBkZWNvZGUgaW1hZ2VzIGZyb20gZmlsZXMgd2hpY2ggYXJyaXZlIGFzIFJHQiBkYXRhIGZyb20KCSAqIGFuIEFSR0IgcGl4ZWwgYXJyYXkuIEl0IGRvZXMgbm90IHN1cHBvcnQgcm90YXRpb24uCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBhdXRob3IgQmV0YW1pbm9zCgkgKi8KCXZhciBSR0JMdW1pbmFuY2VTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDkoUkdCTHVtaW5hbmNlU291cmNlLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIFJHQkx1bWluYW5jZVNvdXJjZShsdW1pbmFuY2VzLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLywgZGF0YVdpZHRoIC8qaW50Ki8sIGRhdGFIZWlnaHQgLyppbnQqLywgbGVmdCAvKmludCovLCB0b3AgLyppbnQqLykgewoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCB3aWR0aCwgaGVpZ2h0KSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5kYXRhV2lkdGggPSBkYXRhV2lkdGg7CgkgICAgICAgIF90aGlzLmRhdGFIZWlnaHQgPSBkYXRhSGVpZ2h0OwoJICAgICAgICBfdGhpcy5sZWZ0ID0gbGVmdDsKCSAgICAgICAgX3RoaXMudG9wID0gdG9wOwoJICAgICAgICBpZiAobHVtaW5hbmNlcy5CWVRFU19QRVJfRUxFTUVOVCA9PT0gNCkgeyAvLyBJbnQzMkFycmF5CgkgICAgICAgICAgICB2YXIgc2l6ZSA9IHdpZHRoICogaGVpZ2h0OwoJICAgICAgICAgICAgdmFyIGx1bWluYW5jZXNVaW50OEFycmF5ID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHNpemUpOwoJICAgICAgICAgICAgZm9yICh2YXIgb2Zmc2V0ID0gMDsgb2Zmc2V0IDwgc2l6ZTsgb2Zmc2V0KyspIHsKCSAgICAgICAgICAgICAgICB2YXIgcGl4ZWwgPSBsdW1pbmFuY2VzW29mZnNldF07CgkgICAgICAgICAgICAgICAgdmFyIHIgPSAocGl4ZWwgPj4gMTYpICYgMHhmZjsgLy8gcmVkCgkgICAgICAgICAgICAgICAgdmFyIGcyID0gKHBpeGVsID4+IDcpICYgMHgxZmU7IC8vIDIgKiBncmVlbgoJICAgICAgICAgICAgICAgIHZhciBiID0gcGl4ZWwgJiAweGZmOyAvLyBibHVlCgkgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGdyZWVuLWZhdm91cmluZyBhdmVyYWdlIGNoZWFwbHkKCSAgICAgICAgICAgICAgICBsdW1pbmFuY2VzVWludDhBcnJheVtvZmZzZXRdID0gLyooYnl0ZSkgKi8gKChyICsgZzIgKyBiKSAvIDQpICYgMHhGRjsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIF90aGlzLmx1bWluYW5jZXMgPSBsdW1pbmFuY2VzVWludDhBcnJheTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIF90aGlzLmx1bWluYW5jZXMgPSBsdW1pbmFuY2VzOwoJICAgICAgICB9CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGRhdGFXaWR0aCkgewoJICAgICAgICAgICAgX3RoaXMuZGF0YVdpZHRoID0gd2lkdGg7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gZGF0YUhlaWdodCkgewoJICAgICAgICAgICAgX3RoaXMuZGF0YUhlaWdodCA9IGhlaWdodDsKCSAgICAgICAgfQoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSBsZWZ0KSB7CgkgICAgICAgICAgICBfdGhpcy5sZWZ0ID0gMDsKCSAgICAgICAgfQoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSB0b3ApIHsKCSAgICAgICAgICAgIF90aGlzLnRvcCA9IDA7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKF90aGlzLmxlZnQgKyB3aWR0aCA+IF90aGlzLmRhdGFXaWR0aCB8fCBfdGhpcy50b3AgKyBoZWlnaHQgPiBfdGhpcy5kYXRhSGVpZ2h0KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNi5kZWZhdWx0KCdDcm9wIHJlY3RhbmdsZSBkb2VzIG5vdCBmaXQgd2l0aGluIGltYWdlIGRhdGEuJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICAvKkBPdmVycmlkZSovCgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgaWYgKHkgPCAwIHx8IHkgPj0gdGhpcy5nZXRIZWlnaHQoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDYuZGVmYXVsdCgnUmVxdWVzdGVkIHJvdyBpcyBvdXRzaWRlIHRoZSBpbWFnZTogJyArIHkpOwoJICAgICAgICB9CgkgICAgICAgIHZhciB3aWR0aCA9IHRoaXMuZ2V0V2lkdGgoKTsKCSAgICAgICAgaWYgKHJvdyA9PT0gbnVsbCB8fCByb3cgPT09IHVuZGVmaW5lZCB8fCByb3cubGVuZ3RoIDwgd2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBVaW50OENsYW1wZWRBcnJheSh3aWR0aCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG9mZnNldCA9ICh5ICsgdGhpcy50b3ApICogdGhpcy5kYXRhV2lkdGggKyB0aGlzLmxlZnQ7CgkgICAgICAgIFN5c3RlbV8xJDIuZGVmYXVsdC5hcnJheWNvcHkodGhpcy5sdW1pbmFuY2VzLCBvZmZzZXQsIHJvdywgMCwgd2lkdGgpOwoJICAgICAgICByZXR1cm4gcm93OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJHQkx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuZ2V0TWF0cml4ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgd2lkdGggPSB0aGlzLmdldFdpZHRoKCk7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICAvLyBJZiB0aGUgY2FsbGVyIGFza3MgZm9yIHRoZSBlbnRpcmUgdW5kZXJseWluZyBpbWFnZSwgc2F2ZSB0aGUgY29weSBhbmQgZ2l2ZSB0aGVtIHRoZQoJICAgICAgICAvLyBvcmlnaW5hbCBkYXRhLiBUaGUgZG9jcyBzcGVjaWZpY2FsbHkgd2FybiB0aGF0IHJlc3VsdC5sZW5ndGggbXVzdCBiZSBpZ25vcmVkLgoJICAgICAgICBpZiAod2lkdGggPT09IHRoaXMuZGF0YVdpZHRoICYmIGhlaWdodCA9PT0gdGhpcy5kYXRhSGVpZ2h0KSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5sdW1pbmFuY2VzOwoJICAgICAgICB9CgkgICAgICAgIHZhciBhcmVhID0gd2lkdGggKiBoZWlnaHQ7CgkgICAgICAgIHZhciBtYXRyaXggPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoYXJlYSk7CgkgICAgICAgIHZhciBpbnB1dE9mZnNldCA9IHRoaXMudG9wICogdGhpcy5kYXRhV2lkdGggKyB0aGlzLmxlZnQ7CgkgICAgICAgIC8vIElmIHRoZSB3aWR0aCBtYXRjaGVzIHRoZSBmdWxsIHdpZHRoIG9mIHRoZSB1bmRlcmx5aW5nIGRhdGEsIHBlcmZvcm0gYSBzaW5nbGUgY29weS4KCSAgICAgICAgaWYgKHdpZHRoID09PSB0aGlzLmRhdGFXaWR0aCkgewoJICAgICAgICAgICAgU3lzdGVtXzEkMi5kZWZhdWx0LmFycmF5Y29weSh0aGlzLmx1bWluYW5jZXMsIGlucHV0T2Zmc2V0LCBtYXRyaXgsIDAsIGFyZWEpOwoJICAgICAgICAgICAgcmV0dXJuIG1hdHJpeDsKCSAgICAgICAgfQoJICAgICAgICAvLyBPdGhlcndpc2UgY29weSBvbmUgY3JvcHBlZCByb3cgYXQgYSB0aW1lLgoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb3V0cHV0T2Zmc2V0ID0geSAqIHdpZHRoOwoJICAgICAgICAgICAgU3lzdGVtXzEkMi5kZWZhdWx0LmFycmF5Y29weSh0aGlzLmx1bWluYW5jZXMsIGlucHV0T2Zmc2V0LCBtYXRyaXgsIG91dHB1dE9mZnNldCwgd2lkdGgpOwoJICAgICAgICAgICAgaW5wdXRPZmZzZXQgKz0gdGhpcy5kYXRhV2lkdGg7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBSR0JMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLmlzQ3JvcFN1cHBvcnRlZCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5jcm9wID0gZnVuY3Rpb24gKGxlZnQgLyppbnQqLywgdG9wIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHJldHVybiBuZXcgUkdCTHVtaW5hbmNlU291cmNlKHRoaXMubHVtaW5hbmNlcywgd2lkdGgsIGhlaWdodCwgdGhpcy5kYXRhV2lkdGgsIHRoaXMuZGF0YUhlaWdodCwgdGhpcy5sZWZ0ICsgbGVmdCwgdGhpcy50b3AgKyB0b3ApOwoJICAgIH07CgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5pbnZlcnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2VfMS5kZWZhdWx0KHRoaXMpOwoJICAgIH07CgkgICAgcmV0dXJuIFJHQkx1bWluYW5jZVNvdXJjZTsKCX0oTHVtaW5hbmNlU291cmNlXzEuZGVmYXVsdCkpOwoJdmFyIF9kZWZhdWx0JDEgPSBSR0JMdW1pbmFuY2VTb3VyY2UkMS5kZWZhdWx0ID0gUkdCTHVtaW5hbmNlU291cmNlOwoKCXZhciBRUkNvZGVSZWFkZXIkMSA9IHt9OwoKCXZhciBCYXJjb2RlRm9ybWF0JDEgPSB7fTsKCgkvKgoJICogRGlyZWN0IHBvcnQgdG8gVHlwZVNjcmlwdCBvZiBaWGluZyBieSBBZHJpYW4gVG/ImWPEgwoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmFyY29kZUZvcm1hdCQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogRW51bWVyYXRlcyBiYXJjb2RlIGZvcm1hdHMga25vd24gdG8gdGhpcyBwYWNrYWdlLiBQbGVhc2Uga2VlcCBhbHBoYWJldGl6ZWQuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEJhcmNvZGVGb3JtYXQ7CgkoZnVuY3Rpb24gKEJhcmNvZGVGb3JtYXQpIHsKCSAgICAvKiogQXp0ZWMgMkQgYmFyY29kZSBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJBWlRFQyJdID0gMF0gPSAiQVpURUMiOwoJICAgIC8qKiBDT0RBQkFSIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREFCQVIiXSA9IDFdID0gIkNPREFCQVIiOwoJICAgIC8qKiBDb2RlIDM5IDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREVfMzkiXSA9IDJdID0gIkNPREVfMzkiOwoJICAgIC8qKiBDb2RlIDkzIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREVfOTMiXSA9IDNdID0gIkNPREVfOTMiOwoJICAgIC8qKiBDb2RlIDEyOCAxRCBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJDT0RFXzEyOCJdID0gNF0gPSAiQ09ERV8xMjgiOwoJICAgIC8qKiBEYXRhIE1hdHJpeCAyRCBiYXJjb2RlIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkRBVEFfTUFUUklYIl0gPSA1XSA9ICJEQVRBX01BVFJJWCI7CgkgICAgLyoqIEVBTi04IDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkVBTl84Il0gPSA2XSA9ICJFQU5fOCI7CgkgICAgLyoqIEVBTi0xMyAxRCBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJFQU5fMTMiXSA9IDddID0gIkVBTl8xMyI7CgkgICAgLyoqIElURiAoSW50ZXJsZWF2ZWQgVHdvIG9mIEZpdmUpIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIklURiJdID0gOF0gPSAiSVRGIjsKCSAgICAvKiogTWF4aUNvZGUgMkQgYmFyY29kZSBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJNQVhJQ09ERSJdID0gOV0gPSAiTUFYSUNPREUiOwoJICAgIC8qKiBQREY0MTcgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUERGXzQxNyJdID0gMTBdID0gIlBERl80MTciOwoJICAgIC8qKiBRUiBDb2RlIDJEIGJhcmNvZGUgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUVJfQ09ERSJdID0gMTFdID0gIlFSX0NPREUiOwoJICAgIC8qKiBSU1MgMTQgKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlJTU18xNCJdID0gMTJdID0gIlJTU18xNCI7CgkgICAgLyoqIFJTUyBFWFBBTkRFRCAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUlNTX0VYUEFOREVEIl0gPSAxM10gPSAiUlNTX0VYUEFOREVEIjsKCSAgICAvKiogVVBDLUEgMUQgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiVVBDX0EiXSA9IDE0XSA9ICJVUENfQSI7CgkgICAgLyoqIFVQQy1FIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlVQQ19FIl0gPSAxNV0gPSAiVVBDX0UiOwoJICAgIC8qKiBVUEMvRUFOIGV4dGVuc2lvbiBmb3JtYXQuIE5vdCBhIHN0YW5kLWFsb25lIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlVQQ19FQU5fRVhURU5TSU9OIl0gPSAxNl0gPSAiVVBDX0VBTl9FWFRFTlNJT04iOwoJfSkoQmFyY29kZUZvcm1hdCB8fCAoQmFyY29kZUZvcm1hdCA9IHt9KSk7CglCYXJjb2RlRm9ybWF0JDEuZGVmYXVsdCA9IEJhcmNvZGVGb3JtYXQ7CgoJdmFyIFJlc3VsdCQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZXN1bHQkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIFN5c3RlbV8xJDEgPSBTeXN0ZW0kMTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGVjb2RpbmcgYSBiYXJjb2RlIHdpdGhpbiBhbiBpbWFnZS48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFJlc3VsdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IocHJpdmF0ZSB0ZXh0OiBzdHJpbmcsCgkgICAgLy8gICAgICAgICAgICAgICBVaW50OEFycmF5IHJhd0J5dGVzLAoJICAgIC8vICAgICAgICAgICAgICAgUmVzdWx0UG9jb25zdCByZXN1bHRQb2ludHM6IEludDMyQXJyYXksCgkgICAgLy8gICAgICAgICAgICAgICBCYXJjb2RlRm9ybWF0IGZvcm1hdCkgewoJICAgIC8vICAgdGhpcyh0ZXh0LCByYXdCeXRlcywgcmVzdWx0UG9pbnRzLCBmb3JtYXQsIFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpKQoJICAgIC8vIH0KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IodGV4dDogc3RyaW5nLAoJICAgIC8vICAgICAgICAgICAgICAgVWludDhBcnJheSByYXdCeXRlcywKCSAgICAvLyAgICAgICAgICAgICAgIFJlc3VsdFBvY29uc3QgcmVzdWx0UG9pbnRzOiBJbnQzMkFycmF5LAoJICAgIC8vICAgICAgICAgICAgICAgQmFyY29kZUZvcm1hdCBmb3JtYXQsCgkgICAgLy8gICAgICAgICAgICAgICBsb25nIHRpbWVzdGFtcCkgewoJICAgIC8vICAgdGhpcyh0ZXh0LCByYXdCeXRlcywgcmF3Qnl0ZXMgPT0gbnVsbCA/IDAgOiA4ICogcmF3Qnl0ZXMubGVuZ3RoLAoJICAgIC8vICAgICAgICByZXN1bHRQb2ludHMsIGZvcm1hdCwgdGltZXN0YW1wKQoJICAgIC8vIH0KCSAgICBmdW5jdGlvbiBSZXN1bHQodGV4dCwgcmF3Qnl0ZXMsIG51bUJpdHMsIHJlc3VsdFBvaW50cywgZm9ybWF0LCB0aW1lc3RhbXApIHsKCSAgICAgICAgaWYgKG51bUJpdHMgPT09IHZvaWQgMCkgeyBudW1CaXRzID0gcmF3Qnl0ZXMgPT0gbnVsbCA/IDAgOiA4ICogcmF3Qnl0ZXMubGVuZ3RoOyB9CgkgICAgICAgIGlmICh0aW1lc3RhbXAgPT09IHZvaWQgMCkgeyB0aW1lc3RhbXAgPSBTeXN0ZW1fMSQxLmRlZmF1bHQuY3VycmVudFRpbWVNaWxsaXMoKTsgfQoJICAgICAgICB0aGlzLnRleHQgPSB0ZXh0OwoJICAgICAgICB0aGlzLnJhd0J5dGVzID0gcmF3Qnl0ZXM7CgkgICAgICAgIHRoaXMubnVtQml0cyA9IG51bUJpdHM7CgkgICAgICAgIHRoaXMucmVzdWx0UG9pbnRzID0gcmVzdWx0UG9pbnRzOwoJICAgICAgICB0aGlzLmZvcm1hdCA9IGZvcm1hdDsKCSAgICAgICAgdGhpcy50aW1lc3RhbXAgPSB0aW1lc3RhbXA7CgkgICAgICAgIHRoaXMudGV4dCA9IHRleHQ7CgkgICAgICAgIHRoaXMucmF3Qnl0ZXMgPSByYXdCeXRlczsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gbnVtQml0cyB8fCBudWxsID09PSBudW1CaXRzKSB7CgkgICAgICAgICAgICB0aGlzLm51bUJpdHMgPSAocmF3Qnl0ZXMgPT09IG51bGwgfHwgcmF3Qnl0ZXMgPT09IHVuZGVmaW5lZCkgPyAwIDogOCAqIHJhd0J5dGVzLmxlbmd0aDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHRoaXMubnVtQml0cyA9IG51bUJpdHM7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludHMgPSByZXN1bHRQb2ludHM7CgkgICAgICAgIHRoaXMuZm9ybWF0ID0gZm9ybWF0OwoJICAgICAgICB0aGlzLnJlc3VsdE1ldGFkYXRhID0gbnVsbDsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gdGltZXN0YW1wIHx8IG51bGwgPT09IHRpbWVzdGFtcCkgewoJICAgICAgICAgICAgdGhpcy50aW1lc3RhbXAgPSBTeXN0ZW1fMSQxLmRlZmF1bHQuY3VycmVudFRpbWVNaWxsaXMoKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHRoaXMudGltZXN0YW1wID0gdGltZXN0YW1wOwoJICAgICAgICB9CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcmF3IHRleHQgZW5jb2RlZCBieSB0aGUgYmFyY29kZQoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0VGV4dCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMudGV4dDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcmF3IGJ5dGVzIGVuY29kZWQgYnkgdGhlIGJhcmNvZGUsIGlmIGFwcGxpY2FibGUsIG90aGVyd2lzZSB7QGNvZGUgbnVsbH0KCSAgICAgKi8KCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFJhd0J5dGVzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yYXdCeXRlczsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaG93IG1hbnkgYml0cyBvZiB7QGxpbmsgI2dldFJhd0J5dGVzKCl9IGFyZSB2YWxpZDsgdHlwaWNhbGx5IDggdGltZXMgaXRzIGxlbmd0aAoJICAgICAqIEBzaW5jZSAzLjMuMAoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0TnVtQml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMubnVtQml0czsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcG9pbnRzIHJlbGF0ZWQgdG8gdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLiBUaGVzZSBhcmUgdHlwaWNhbGx5IHBvaW50cwoJICAgICAqICAgICAgICAgaWRlbnRpZnlpbmcgZmluZGVyIHBhdHRlcm5zIG9yIHRoZSBjb3JuZXJzIG9mIHRoZSBiYXJjb2RlLiBUaGUgZXhhY3QgbWVhbmluZyBpcwoJICAgICAqICAgICAgICAgc3BlY2lmaWMgdG8gdGhlIHR5cGUgb2YgYmFyY29kZSB0aGF0IHdhcyBkZWNvZGVkLgoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0UmVzdWx0UG9pbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRQb2ludHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHtAbGluayBCYXJjb2RlRm9ybWF0fSByZXByZXNlbnRpbmcgdGhlIGZvcm1hdCBvZiB0aGUgYmFyY29kZSB0aGF0IHdhcyBkZWNvZGVkCgkgICAgICovCgkgICAgUmVzdWx0LnByb3RvdHlwZS5nZXRCYXJjb2RlRm9ybWF0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHtAbGluayBNYXB9IG1hcHBpbmcge0BsaW5rIFJlc3VsdE1ldGFkYXRhVHlwZX0ga2V5cyB0byB2YWx1ZXMuIE1heSBiZQoJICAgICAqICAge0Bjb2RlIG51bGx9LiBUaGlzIGNvbnRhaW5zIG9wdGlvbmFsIG1ldGFkYXRhIGFib3V0IHdoYXQgd2FzIGRldGVjdGVkIGFib3V0IHRoZSBiYXJjb2RlLAoJICAgICAqICAgbGlrZSBvcmllbnRhdGlvbi4KCSAgICAgKi8KCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFJlc3VsdE1ldGFkYXRhID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRNZXRhZGF0YTsKCSAgICB9OwoJICAgIFJlc3VsdC5wcm90b3R5cGUucHV0TWV0YWRhdGEgPSBmdW5jdGlvbiAodHlwZSwgdmFsdWUpIHsKCSAgICAgICAgaWYgKHRoaXMucmVzdWx0TWV0YWRhdGEgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHRoaXMucmVzdWx0TWV0YWRhdGEgPSBuZXcgTWFwKCk7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YS5zZXQodHlwZSwgdmFsdWUpOwoJICAgIH07CgkgICAgUmVzdWx0LnByb3RvdHlwZS5wdXRBbGxNZXRhZGF0YSA9IGZ1bmN0aW9uIChtZXRhZGF0YSkgewoJICAgICAgICBpZiAobWV0YWRhdGEgIT09IG51bGwpIHsKCSAgICAgICAgICAgIGlmICh0aGlzLnJlc3VsdE1ldGFkYXRhID09PSBudWxsKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YSA9IG1ldGFkYXRhOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YSA9IG5ldyBNYXAobWV0YWRhdGEpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZXN1bHQucHJvdG90eXBlLmFkZFJlc3VsdFBvaW50cyA9IGZ1bmN0aW9uIChuZXdQb2ludHMpIHsKCSAgICAgICAgdmFyIG9sZFBvaW50cyA9IHRoaXMucmVzdWx0UG9pbnRzOwoJICAgICAgICBpZiAob2xkUG9pbnRzID09PSBudWxsKSB7CgkgICAgICAgICAgICB0aGlzLnJlc3VsdFBvaW50cyA9IG5ld1BvaW50czsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChuZXdQb2ludHMgIT09IG51bGwgJiYgbmV3UG9pbnRzLmxlbmd0aCA+IDApIHsKCSAgICAgICAgICAgIHZhciBhbGxQb2ludHMgPSBuZXcgQXJyYXkob2xkUG9pbnRzLmxlbmd0aCArIG5ld1BvaW50cy5sZW5ndGgpOwoJICAgICAgICAgICAgU3lzdGVtXzEkMS5kZWZhdWx0LmFycmF5Y29weShvbGRQb2ludHMsIDAsIGFsbFBvaW50cywgMCwgb2xkUG9pbnRzLmxlbmd0aCk7CgkgICAgICAgICAgICBTeXN0ZW1fMSQxLmRlZmF1bHQuYXJyYXljb3B5KG5ld1BvaW50cywgMCwgYWxsUG9pbnRzLCBvbGRQb2ludHMubGVuZ3RoLCBuZXdQb2ludHMubGVuZ3RoKTsKCSAgICAgICAgICAgIHRoaXMucmVzdWx0UG9pbnRzID0gYWxsUG9pbnRzOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFRpbWVzdGFtcCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMudGltZXN0YW1wOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnRleHQ7CgkgICAgfTsKCSAgICByZXR1cm4gUmVzdWx0OwoJfSgpKTsKCVJlc3VsdCQxLmRlZmF1bHQgPSBSZXN1bHQ7CgoJdmFyIFJlc3VsdE1ldGFkYXRhVHlwZSQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA4IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZXN1bHRNZXRhZGF0YVR5cGUkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogUmVwcmVzZW50cyBzb21lIHR5cGUgb2YgbWV0YWRhdGEgYWJvdXQgdGhlIHJlc3VsdCBvZiB0aGUgZGVjb2RpbmcgdGhhdCB0aGUgZGVjb2RlcgoJICogd2lzaGVzIHRvIGNvbW11bmljYXRlIGJhY2sgdG8gdGhlIGNhbGxlci4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUmVzdWx0TWV0YWRhdGFUeXBlOwoJKGZ1bmN0aW9uIChSZXN1bHRNZXRhZGF0YVR5cGUpIHsKCSAgICAvKioKCSAgICAgKiBVbnNwZWNpZmllZCwgYXBwbGljYXRpb24tc3BlY2lmaWMgbWV0YWRhdGEuIE1hcHMgdG8gYW4gdW5zcGVjaWZpZWQge0BsaW5rIE9iamVjdH0uCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiT1RIRVIiXSA9IDBdID0gIk9USEVSIjsKCSAgICAvKioKCSAgICAgKiBEZW5vdGVzIHRoZSBsaWtlbHkgYXBwcm94aW1hdGUgb3JpZW50YXRpb24gb2YgdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLiBUaGlzIHZhbHVlCgkgICAgICogaXMgZ2l2ZW4gYXMgZGVncmVlcyByb3RhdGVkIGNsb2Nrd2lzZSBmcm9tIHRoZSBub3JtYWwsIHVwcmlnaHQgb3JpZW50YXRpb24uCgkgICAgICogRm9yIGV4YW1wbGUgYSAxRCBiYXJjb2RlIHdoaWNoIHdhcyBmb3VuZCBieSByZWFkaW5nIHRvcC10by1ib3R0b20gd291bGQgYmUKCSAgICAgKiBzYWlkIHRvIGhhdmUgb3JpZW50YXRpb24gIjkwIi4gVGhpcyBrZXkgbWFwcyB0byBhbiB7QGxpbmsgSW50ZWdlcn0gd2hvc2UKCSAgICAgKiB2YWx1ZSBpcyBpbiB0aGUgcmFuZ2UgWzAsMzYwKS4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJPUklFTlRBVElPTiJdID0gMV0gPSAiT1JJRU5UQVRJT04iOwoJICAgIC8qKgoJICAgICAqIDxwPjJEIGJhcmNvZGUgZm9ybWF0cyB0eXBpY2FsbHkgZW5jb2RlIHRleHQsIGJ1dCBhbGxvdyBmb3IgYSBzb3J0IG9mICdieXRlIG1vZGUnCgkgICAgICogd2hpY2ggaXMgc29tZXRpbWVzIHVzZWQgdG8gZW5jb2RlIGJpbmFyeSBkYXRhLiBXaGlsZSB7QGxpbmsgUmVzdWx0fSBtYWtlcyBhdmFpbGFibGUKCSAgICAgKiB0aGUgY29tcGxldGUgcmF3IGJ5dGVzIGluIHRoZSBiYXJjb2RlIGZvciB0aGVzZSBmb3JtYXRzLCBpdCBkb2VzIG5vdCBvZmZlciB0aGUgYnl0ZXMKCSAgICAgKiBmcm9tIHRoZSBieXRlIHNlZ21lbnRzIGFsb25lLjwvcD4KCSAgICAgKgoJICAgICAqIDxwPlRoaXMgbWFwcyB0byBhIHtAbGluayBqYXZhLnV0aWwuTGlzdH0gb2YgYnl0ZSBhcnJheXMgY29ycmVzcG9uZGluZyB0byB0aGUKCSAgICAgKiByYXcgYnl0ZXMgaW4gdGhlIGJ5dGUgc2VnbWVudHMgaW4gdGhlIGJhcmNvZGUsIGluIG9yZGVyLjwvcD4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJCWVRFX1NFR01FTlRTIl0gPSAyXSA9ICJCWVRFX1NFR01FTlRTIjsKCSAgICAvKioKCSAgICAgKiBFcnJvciBjb3JyZWN0aW9uIGxldmVsIHVzZWQsIGlmIGFwcGxpY2FibGUuIFRoZSB2YWx1ZSB0eXBlIGRlcGVuZHMgb24gdGhlCgkgICAgICogZm9ybWF0LCBidXQgaXMgdHlwaWNhbGx5IGEgU3RyaW5nLgoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwiXSA9IDNdID0gIkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwiOwoJICAgIC8qKgoJICAgICAqIEZvciBzb21lIHBlcmlvZGljYWxzLCBpbmRpY2F0ZXMgdGhlIGlzc3VlIG51bWJlciBhcyBhbiB7QGxpbmsgSW50ZWdlcn0uCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiSVNTVUVfTlVNQkVSIl0gPSA0XSA9ICJJU1NVRV9OVU1CRVIiOwoJICAgIC8qKgoJICAgICAqIEZvciBzb21lIHByb2R1Y3RzLCBpbmRpY2F0ZXMgdGhlIHN1Z2dlc3RlZCByZXRhaWwgcHJpY2UgaW4gdGhlIGJhcmNvZGUgYXMgYQoJICAgICAqIGZvcm1hdHRlZCB7QGxpbmsgU3RyaW5nfS4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJTVUdHRVNURURfUFJJQ0UiXSA9IDVdID0gIlNVR0dFU1RFRF9QUklDRSI7CgkgICAgLyoqCgkgICAgICogRm9yIHNvbWUgcHJvZHVjdHMsIHRoZSBwb3NzaWJsZSBjb3VudHJ5IG9mIG1hbnVmYWN0dXJlIGFzIGEge0BsaW5rIFN0cmluZ30gZGVub3RpbmcgdGhlCgkgICAgICogSVNPIGNvdW50cnkgY29kZS4gU29tZSBtYXAgdG8gbXVsdGlwbGUgcG9zc2libGUgY291bnRyaWVzLCBsaWtlICJVUy9DQSIuCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiUE9TU0lCTEVfQ09VTlRSWSJdID0gNl0gPSAiUE9TU0lCTEVfQ09VTlRSWSI7CgkgICAgLyoqCgkgICAgICogRm9yIHNvbWUgcHJvZHVjdHMsIHRoZSBleHRlbnNpb24gdGV4dAoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIlVQQ19FQU5fRVhURU5TSU9OIl0gPSA3XSA9ICJVUENfRUFOX0VYVEVOU0lPTiI7CgkgICAgLyoqCgkgICAgICogUERGNDE3LXNwZWNpZmljIG1ldGFkYXRhCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiUERGNDE3X0VYVFJBX01FVEFEQVRBIl0gPSA4XSA9ICJQREY0MTdfRVhUUkFfTUVUQURBVEEiOwoJICAgIC8qKgoJICAgICAqIElmIHRoZSBjb2RlIGZvcm1hdCBzdXBwb3J0cyBzdHJ1Y3R1cmVkIGFwcGVuZCBhbmQgdGhlIGN1cnJlbnQgc2Nhbm5lZCBjb2RlIGlzIHBhcnQgb2Ygb25lIHRoZW4gdGhlCgkgICAgICogc2VxdWVuY2UgbnVtYmVyIGlzIGdpdmVuIHdpdGggaXQuCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiU1RSVUNUVVJFRF9BUFBFTkRfU0VRVUVOQ0UiXSA9IDldID0gIlNUUlVDVFVSRURfQVBQRU5EX1NFUVVFTkNFIjsKCSAgICAvKioKCSAgICAgKiBJZiB0aGUgY29kZSBmb3JtYXQgc3VwcG9ydHMgc3RydWN0dXJlZCBhcHBlbmQgYW5kIHRoZSBjdXJyZW50IHNjYW5uZWQgY29kZSBpcyBwYXJ0IG9mIG9uZSB0aGVuIHRoZQoJICAgICAqIHBhcml0eSBpcyBnaXZlbiB3aXRoIGl0LgoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIlNUUlVDVFVSRURfQVBQRU5EX1BBUklUWSJdID0gMTBdID0gIlNUUlVDVFVSRURfQVBQRU5EX1BBUklUWSI7Cgl9KShSZXN1bHRNZXRhZGF0YVR5cGUgfHwgKFJlc3VsdE1ldGFkYXRhVHlwZSA9IHt9KSk7CglSZXN1bHRNZXRhZGF0YVR5cGUkMS5kZWZhdWx0ID0gUmVzdWx0TWV0YWRhdGFUeXBlOwoKCXZhciBEZWNvZGVyJDEgPSB7fTsKCgl2YXIgQ2hlY2tzdW1FeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkOCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShDaGVja3N1bUV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNCA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBDaGVja3N1bUV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkOChDaGVja3N1bUV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBDaGVja3N1bUV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBDaGVja3N1bUV4Y2VwdGlvbi5nZXRDaGVja3N1bUluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IENoZWNrc3VtRXhjZXB0aW9uKCk7CgkgICAgfTsKCSAgICBDaGVja3N1bUV4Y2VwdGlvbi5raW5kID0gJ0NoZWNrc3VtRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gQ2hlY2tzdW1FeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDQuZGVmYXVsdCkpOwoJQ2hlY2tzdW1FeGNlcHRpb24kMS5kZWZhdWx0ID0gQ2hlY2tzdW1FeGNlcHRpb247CgoJdmFyIEdlbmVyaWNHRiQxID0ge307CgoJdmFyIEdlbmVyaWNHRlBvbHkkMSA9IHt9OwoKCXZhciBBYnN0cmFjdEdlbmVyaWNHRiQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShBYnN0cmFjdEdlbmVyaWNHRiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5UaGlzIGNsYXNzIGNvbnRhaW5zIHV0aWxpdHkgbWV0aG9kcyBmb3IgcGVyZm9ybWluZyBtYXRoZW1hdGljYWwgb3BlcmF0aW9ucyBvdmVyCgkgKiB0aGUgR2Fsb2lzIEZpZWxkcy4gT3BlcmF0aW9ucyB1c2UgYSBnaXZlbiBwcmltaXRpdmUgcG9seW5vbWlhbCBpbiBjYWxjdWxhdGlvbnMuPC9wPgoJICoKCSAqIDxwPlRocm91Z2hvdXQgdGhpcyBwYWNrYWdlLCBlbGVtZW50cyBvZiB0aGUgR0YgYXJlIHJlcHJlc2VudGVkIGFzIGFuIHtAY29kZSBpbnR9CgkgKiBmb3IgY29udmVuaWVuY2UgYW5kIHNwZWVkIChidXQgYXQgdGhlIGNvc3Qgb2YgbWVtb3J5KS4KCSAqIDwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBEYXZpZCBPbGl2aWVyCgkgKi8KCXZhciBBYnN0cmFjdEdlbmVyaWNHRiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBBYnN0cmFjdEdlbmVyaWNHRigpIHsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiAyIHRvIHRoZSBwb3dlciBvZiBhIGluIEdGKHNpemUpCgkgICAgICovCgkgICAgQWJzdHJhY3RHZW5lcmljR0YucHJvdG90eXBlLmV4cCA9IGZ1bmN0aW9uIChhKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmV4cFRhYmxlW2FdOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBiYXNlIDIgbG9nIG9mIGEgaW4gR0Yoc2l6ZSkKCSAgICAgKi8KCSAgICBBYnN0cmFjdEdlbmVyaWNHRi5wcm90b3R5cGUubG9nID0gZnVuY3Rpb24gKGEgLyppbnQqLykgewoJICAgICAgICBpZiAoYSA9PT0gMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDUuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0aGlzLmxvZ1RhYmxlW2FdOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogSW1wbGVtZW50cyBib3RoIGFkZGl0aW9uIGFuZCBzdWJ0cmFjdGlvbiAtLSB0aGV5IGFyZSB0aGUgc2FtZSBpbiBHRihzaXplKS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gc3VtL2RpZmZlcmVuY2Ugb2YgYSBhbmQgYgoJICAgICAqLwoJICAgIEFic3RyYWN0R2VuZXJpY0dGLmFkZE9yU3VidHJhY3QgPSBmdW5jdGlvbiAoYSAvKmludCovLCBiIC8qaW50Ki8pIHsKCSAgICAgICAgcmV0dXJuIGEgXiBiOwoJICAgIH07CgkgICAgcmV0dXJuIEFic3RyYWN0R2VuZXJpY0dGOwoJfSgpKTsKCUFic3RyYWN0R2VuZXJpY0dGJDEuZGVmYXVsdCA9IEFic3RyYWN0R2VuZXJpY0dGOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoR2VuZXJpY0dGUG9seSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbi5yZWVkc29sb21vbiB7Ki8KCXZhciBBYnN0cmFjdEdlbmVyaWNHRl8xJDEgPSBBYnN0cmFjdEdlbmVyaWNHRiQxOwoJdmFyIFN5c3RlbV8xID0gU3lzdGVtJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNCA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5SZXByZXNlbnRzIGEgcG9seW5vbWlhbCB3aG9zZSBjb2VmZmljaWVudHMgYXJlIGVsZW1lbnRzIG9mIGEgR0YuCgkgKiBJbnN0YW5jZXMgb2YgdGhpcyBjbGFzcyBhcmUgaW1tdXRhYmxlLjwvcD4KCSAqCgkgKiA8cD5NdWNoIGNyZWRpdCBpcyBkdWUgdG8gV2lsbGlhbSBSdWNrbGlkZ2Ugc2luY2UgcG9ydGlvbnMgb2YgdGhpcyBjb2RlIGFyZSBhbiBpbmRpcmVjdAoJICogcG9ydCBvZiBoaXMgQysrIFJlZWQtU29sb21vbiBpbXBsZW1lbnRhdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEdlbmVyaWNHRlBvbHkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGZpZWxkIHRoZSB7QGxpbmsgR2VuZXJpY0dGfSBpbnN0YW5jZSByZXByZXNlbnRpbmcgdGhlIGZpZWxkIHRvIHVzZQoJICAgICAqIHRvIHBlcmZvcm0gY29tcHV0YXRpb25zCgkgICAgICogQHBhcmFtIGNvZWZmaWNpZW50cyBjb2VmZmljaWVudHMgYXMgaW50cyByZXByZXNlbnRpbmcgZWxlbWVudHMgb2YgR0Yoc2l6ZSksIGFycmFuZ2VkCgkgICAgICogZnJvbSBtb3N0IHNpZ25pZmljYW50IChoaWdoZXN0LXBvd2VyIHRlcm0pIGNvZWZmaWNpZW50IHRvIGxlYXN0IHNpZ25pZmljYW50CgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgYXJndW1lbnQgaXMgbnVsbCBvciBlbXB0eSwKCSAgICAgKiBvciBpZiBsZWFkaW5nIGNvZWZmaWNpZW50IGlzIDAgYW5kIHRoaXMgaXMgbm90IGEKCSAgICAgKiBjb25zdGFudCBwb2x5bm9taWFsICh0aGF0IGlzLCBpdCBpcyBub3QgdGhlIG1vbm9taWFsICIwIikKCSAgICAgKi8KCSAgICBmdW5jdGlvbiBHZW5lcmljR0ZQb2x5KGZpZWxkLCBjb2VmZmljaWVudHMpIHsKCSAgICAgICAgaWYgKGNvZWZmaWNpZW50cy5sZW5ndGggPT09IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLmZpZWxkID0gZmllbGQ7CgkgICAgICAgIHZhciBjb2VmZmljaWVudHNMZW5ndGggPSBjb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICBpZiAoY29lZmZpY2llbnRzTGVuZ3RoID4gMSAmJiBjb2VmZmljaWVudHNbMF0gPT09IDApIHsKCSAgICAgICAgICAgIC8vIExlYWRpbmcgdGVybSBtdXN0IGJlIG5vbi16ZXJvIGZvciBhbnl0aGluZyBleGNlcHQgdGhlIGNvbnN0YW50IHBvbHlub21pYWwgIjAiCgkgICAgICAgICAgICB2YXIgZmlyc3ROb25aZXJvID0gMTsKCSAgICAgICAgICAgIHdoaWxlIChmaXJzdE5vblplcm8gPCBjb2VmZmljaWVudHNMZW5ndGggJiYgY29lZmZpY2llbnRzW2ZpcnN0Tm9uWmVyb10gPT09IDApIHsKCSAgICAgICAgICAgICAgICBmaXJzdE5vblplcm8rKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChmaXJzdE5vblplcm8gPT09IGNvZWZmaWNpZW50c0xlbmd0aCkgewoJICAgICAgICAgICAgICAgIHRoaXMuY29lZmZpY2llbnRzID0gSW50MzJBcnJheS5mcm9tKFswXSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICB0aGlzLmNvZWZmaWNpZW50cyA9IG5ldyBJbnQzMkFycmF5KGNvZWZmaWNpZW50c0xlbmd0aCAtIGZpcnN0Tm9uWmVybyk7CgkgICAgICAgICAgICAgICAgU3lzdGVtXzEuZGVmYXVsdC5hcnJheWNvcHkoY29lZmZpY2llbnRzLCBmaXJzdE5vblplcm8sIHRoaXMuY29lZmZpY2llbnRzLCAwLCB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdGhpcy5jb2VmZmljaWVudHMgPSBjb2VmZmljaWVudHM7CgkgICAgICAgIH0KCSAgICB9CgkgICAgR2VuZXJpY0dGUG9seS5wcm90b3R5cGUuZ2V0Q29lZmZpY2llbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGRlZ3JlZSBvZiB0aGlzIHBvbHlub21pYWwKCSAgICAgKi8KCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5nZXREZWdyZWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGggLSAxOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGlzIHBvbHlub21pYWwgaXMgdGhlIG1vbm9taWFsICIwIgoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmlzWmVybyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY29lZmZpY2llbnRzWzBdID09PSAwOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBjb2VmZmljaWVudCBvZiB4XmRlZ3JlZSB0ZXJtIGluIHRoaXMgcG9seW5vbWlhbAoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmdldENvZWZmaWNpZW50ID0gZnVuY3Rpb24gKGRlZ3JlZSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvZWZmaWNpZW50c1t0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGggLSAxIC0gZGVncmVlXTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gZXZhbHVhdGlvbiBvZiB0aGlzIHBvbHlub21pYWwgYXQgYSBnaXZlbiBwb2ludAoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmV2YWx1YXRlQXQgPSBmdW5jdGlvbiAoYSAvKmludCovKSB7CgkgICAgICAgIGlmIChhID09PSAwKSB7CgkgICAgICAgICAgICAvLyBKdXN0IHJldHVybiB0aGUgeF4wIGNvZWZmaWNpZW50CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRDb2VmZmljaWVudCgwKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgY29lZmZpY2llbnRzID0gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciByZXN1bHQ7CgkgICAgICAgIGlmIChhID09PSAxKSB7CgkgICAgICAgICAgICAvLyBKdXN0IHRoZSBzdW0gb2YgdGhlIGNvZWZmaWNpZW50cwoJICAgICAgICAgICAgcmVzdWx0ID0gMDsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IGNvZWZmaWNpZW50cy5sZW5ndGg7IGkgIT09IGxlbmd0aF8xOyBpKyspIHsKCSAgICAgICAgICAgICAgICB2YXIgY29lZmZpY2llbnQgPSBjb2VmZmljaWVudHNbaV07CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gQWJzdHJhY3RHZW5lcmljR0ZfMSQxLmRlZmF1bHQuYWRkT3JTdWJ0cmFjdChyZXN1bHQsIGNvZWZmaWNpZW50KTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0KCSAgICAgICAgcmVzdWx0ID0gY29lZmZpY2llbnRzWzBdOwoJICAgICAgICB2YXIgc2l6ZSA9IGNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgc2l6ZTsgaSsrKSB7CgkgICAgICAgICAgICByZXN1bHQgPSBBYnN0cmFjdEdlbmVyaWNHRl8xJDEuZGVmYXVsdC5hZGRPclN1YnRyYWN0KGZpZWxkLm11bHRpcGx5KGEsIHJlc3VsdCksIGNvZWZmaWNpZW50c1tpXSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmFkZE9yU3VidHJhY3QgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKCF0aGlzLmZpZWxkLmVxdWFscyhvdGhlci5maWVsZCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoJ0dlbmVyaWNHRlBvbHlzIGRvIG5vdCBoYXZlIHNhbWUgR2VuZXJpY0dGIGZpZWxkJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRoaXMuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHJldHVybiBvdGhlcjsKCSAgICAgICAgfQoJICAgICAgICBpZiAob3RoZXIuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzbWFsbGVyQ29lZmZpY2llbnRzID0gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciBsYXJnZXJDb2VmZmljaWVudHMgPSBvdGhlci5jb2VmZmljaWVudHM7CgkgICAgICAgIGlmIChzbWFsbGVyQ29lZmZpY2llbnRzLmxlbmd0aCA+IGxhcmdlckNvZWZmaWNpZW50cy5sZW5ndGgpIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gc21hbGxlckNvZWZmaWNpZW50czsKCSAgICAgICAgICAgIHNtYWxsZXJDb2VmZmljaWVudHMgPSBsYXJnZXJDb2VmZmljaWVudHM7CgkgICAgICAgICAgICBsYXJnZXJDb2VmZmljaWVudHMgPSB0ZW1wOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzdW1EaWZmID0gbmV3IEludDMyQXJyYXkobGFyZ2VyQ29lZmZpY2llbnRzLmxlbmd0aCk7CgkgICAgICAgIHZhciBsZW5ndGhEaWZmID0gbGFyZ2VyQ29lZmZpY2llbnRzLmxlbmd0aCAtIHNtYWxsZXJDb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICAvLyBDb3B5IGhpZ2gtb3JkZXIgdGVybXMgb25seSBmb3VuZCBpbiBoaWdoZXItZGVncmVlIHBvbHlub21pYWwncyBjb2VmZmljaWVudHMKCSAgICAgICAgU3lzdGVtXzEuZGVmYXVsdC5hcnJheWNvcHkobGFyZ2VyQ29lZmZpY2llbnRzLCAwLCBzdW1EaWZmLCAwLCBsZW5ndGhEaWZmKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IGxlbmd0aERpZmY7IGkgPCBsYXJnZXJDb2VmZmljaWVudHMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHN1bURpZmZbaV0gPSBBYnN0cmFjdEdlbmVyaWNHRl8xJDEuZGVmYXVsdC5hZGRPclN1YnRyYWN0KHNtYWxsZXJDb2VmZmljaWVudHNbaSAtIGxlbmd0aERpZmZdLCBsYXJnZXJDb2VmZmljaWVudHNbaV0pOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seSh0aGlzLmZpZWxkLCBzdW1EaWZmKTsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLm11bHRpcGx5ID0gZnVuY3Rpb24gKG90aGVyKSB7CgkgICAgICAgIGlmICghdGhpcy5maWVsZC5lcXVhbHMob3RoZXIuZmllbGQpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNC5kZWZhdWx0KCdHZW5lcmljR0ZQb2x5cyBkbyBub3QgaGF2ZSBzYW1lIEdlbmVyaWNHRiBmaWVsZCcpOwoJICAgICAgICB9CgkgICAgICAgIGlmICh0aGlzLmlzWmVybygpIHx8IG90aGVyLmlzWmVybygpKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5maWVsZC5nZXRaZXJvKCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGFDb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgdmFyIGFMZW5ndGggPSBhQ29lZmZpY2llbnRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGJDb2VmZmljaWVudHMgPSBvdGhlci5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciBiTGVuZ3RoID0gYkNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBwcm9kdWN0ID0gbmV3IEludDMyQXJyYXkoYUxlbmd0aCArIGJMZW5ndGggLSAxKTsKCSAgICAgICAgdmFyIGZpZWxkID0gdGhpcy5maWVsZDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhTGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHZhciBhQ29lZmYgPSBhQ29lZmZpY2llbnRzW2ldOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBiTGVuZ3RoOyBqKyspIHsKCSAgICAgICAgICAgICAgICBwcm9kdWN0W2kgKyBqXSA9IEFic3RyYWN0R2VuZXJpY0dGXzEkMS5kZWZhdWx0LmFkZE9yU3VidHJhY3QocHJvZHVjdFtpICsgal0sIGZpZWxkLm11bHRpcGx5KGFDb2VmZiwgYkNvZWZmaWNpZW50c1tqXSkpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seShmaWVsZCwgcHJvZHVjdCk7CgkgICAgfTsKCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5tdWx0aXBseVNjYWxhciA9IGZ1bmN0aW9uIChzY2FsYXIgLyppbnQqLykgewoJICAgICAgICBpZiAoc2NhbGFyID09PSAwKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5maWVsZC5nZXRaZXJvKCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHNjYWxhciA9PT0gMSkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHNpemUgPSB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIHZhciBwcm9kdWN0ID0gbmV3IEludDMyQXJyYXkoc2l6ZSk7CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKCSAgICAgICAgICAgIHByb2R1Y3RbaV0gPSBmaWVsZC5tdWx0aXBseShjb2VmZmljaWVudHNbaV0sIHNjYWxhcik7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG5ldyBHZW5lcmljR0ZQb2x5KGZpZWxkLCBwcm9kdWN0KTsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLm11bHRpcGx5QnlNb25vbWlhbCA9IGZ1bmN0aW9uIChkZWdyZWUgLyppbnQqLywgY29lZmZpY2llbnQgLyppbnQqLykgewoJICAgICAgICBpZiAoZGVncmVlIDwgMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDQuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChjb2VmZmljaWVudCA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmllbGQuZ2V0WmVybygpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgdmFyIHNpemUgPSBjb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICB2YXIgcHJvZHVjdCA9IG5ldyBJbnQzMkFycmF5KHNpemUgKyBkZWdyZWUpOwoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7IGkrKykgewoJICAgICAgICAgICAgcHJvZHVjdFtpXSA9IGZpZWxkLm11bHRpcGx5KGNvZWZmaWNpZW50c1tpXSwgY29lZmZpY2llbnQpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seShmaWVsZCwgcHJvZHVjdCk7CgkgICAgfTsKCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5kaXZpZGUgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKCF0aGlzLmZpZWxkLmVxdWFscyhvdGhlci5maWVsZCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoJ0dlbmVyaWNHRlBvbHlzIGRvIG5vdCBoYXZlIHNhbWUgR2VuZXJpY0dGIGZpZWxkJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKG90aGVyLmlzWmVybygpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNC5kZWZhdWx0KCdEaXZpZGUgYnkgMCcpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIHZhciBxdW90aWVudCA9IGZpZWxkLmdldFplcm8oKTsKCSAgICAgICAgdmFyIHJlbWFpbmRlciA9IHRoaXM7CgkgICAgICAgIHZhciBkZW5vbWluYXRvckxlYWRpbmdUZXJtID0gb3RoZXIuZ2V0Q29lZmZpY2llbnQob3RoZXIuZ2V0RGVncmVlKCkpOwoJICAgICAgICB2YXIgaW52ZXJzZURlbm9taW5hdG9yTGVhZGluZ1Rlcm0gPSBmaWVsZC5pbnZlcnNlKGRlbm9taW5hdG9yTGVhZGluZ1Rlcm0pOwoJICAgICAgICB3aGlsZSAocmVtYWluZGVyLmdldERlZ3JlZSgpID49IG90aGVyLmdldERlZ3JlZSgpICYmICFyZW1haW5kZXIuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHZhciBkZWdyZWVEaWZmZXJlbmNlID0gcmVtYWluZGVyLmdldERlZ3JlZSgpIC0gb3RoZXIuZ2V0RGVncmVlKCk7CgkgICAgICAgICAgICB2YXIgc2NhbGUgPSBmaWVsZC5tdWx0aXBseShyZW1haW5kZXIuZ2V0Q29lZmZpY2llbnQocmVtYWluZGVyLmdldERlZ3JlZSgpKSwgaW52ZXJzZURlbm9taW5hdG9yTGVhZGluZ1Rlcm0pOwoJICAgICAgICAgICAgdmFyIHRlcm0gPSBvdGhlci5tdWx0aXBseUJ5TW9ub21pYWwoZGVncmVlRGlmZmVyZW5jZSwgc2NhbGUpOwoJICAgICAgICAgICAgdmFyIGl0ZXJhdGlvblF1b3RpZW50ID0gZmllbGQuYnVpbGRNb25vbWlhbChkZWdyZWVEaWZmZXJlbmNlLCBzY2FsZSk7CgkgICAgICAgICAgICBxdW90aWVudCA9IHF1b3RpZW50LmFkZE9yU3VidHJhY3QoaXRlcmF0aW9uUXVvdGllbnQpOwoJICAgICAgICAgICAgcmVtYWluZGVyID0gcmVtYWluZGVyLmFkZE9yU3VidHJhY3QodGVybSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIFtxdW90aWVudCwgcmVtYWluZGVyXTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJlc3VsdCA9ICcnOwoJICAgICAgICBmb3IgKHZhciBkZWdyZWUgPSB0aGlzLmdldERlZ3JlZSgpOyBkZWdyZWUgPj0gMDsgZGVncmVlLS0pIHsKCSAgICAgICAgICAgIHZhciBjb2VmZmljaWVudCA9IHRoaXMuZ2V0Q29lZmZpY2llbnQoZGVncmVlKTsKCSAgICAgICAgICAgIGlmIChjb2VmZmljaWVudCAhPT0gMCkgewoJICAgICAgICAgICAgICAgIGlmIChjb2VmZmljaWVudCA8IDApIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICcgLSAnOwoJICAgICAgICAgICAgICAgICAgICBjb2VmZmljaWVudCA9IC1jb2VmZmljaWVudDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICcgKyAnOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmIChkZWdyZWUgPT09IDAgfHwgY29lZmZpY2llbnQgIT09IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGFscGhhUG93ZXIgPSB0aGlzLmZpZWxkLmxvZyhjb2VmZmljaWVudCk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChhbHBoYVBvd2VyID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gJzEnOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFscGhhUG93ZXIgPT09IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnYSc7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gJ2FeJzsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBhbHBoYVBvd2VyOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmIChkZWdyZWUgIT09IDApIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKGRlZ3JlZSA9PT0gMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICd4JzsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAneF4nOwoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGRlZ3JlZTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgcmV0dXJuIEdlbmVyaWNHRlBvbHk7Cgl9KCkpOwoJR2VuZXJpY0dGUG9seSQxLmRlZmF1bHQgPSBHZW5lcmljR0ZQb2x5OwoKCXZhciBBcml0aG1ldGljRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgX19leHRlbmRzJDcgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJpdGhtZXRpY0V4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkMyA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBBcml0aG1ldGljRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyQ3KEFyaXRobWV0aWNFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gQXJpdGhtZXRpY0V4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBBcml0aG1ldGljRXhjZXB0aW9uLmtpbmQgPSAnQXJpdGhtZXRpY0V4Y2VwdGlvbic7CgkgICAgcmV0dXJuIEFyaXRobWV0aWNFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDMuZGVmYXVsdCkpOwoJQXJpdGhtZXRpY0V4Y2VwdGlvbiQxLmRlZmF1bHQgPSBBcml0aG1ldGljRXhjZXB0aW9uOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDYgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoR2VuZXJpY0dGJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uLnJlZWRzb2xvbW9uIHsqLwoJdmFyIEdlbmVyaWNHRlBvbHlfMSQxID0gR2VuZXJpY0dGUG9seSQxOwoJdmFyIEFic3RyYWN0R2VuZXJpY0dGXzEgPSBBYnN0cmFjdEdlbmVyaWNHRiQxOwoJdmFyIEludGVnZXJfMSQxID0gSW50ZWdlciQxOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDMgPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcml0aG1ldGljRXhjZXB0aW9uXzEgPSBBcml0aG1ldGljRXhjZXB0aW9uJDE7CgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgY29udGFpbnMgdXRpbGl0eSBtZXRob2RzIGZvciBwZXJmb3JtaW5nIG1hdGhlbWF0aWNhbCBvcGVyYXRpb25zIG92ZXIKCSAqIHRoZSBHYWxvaXMgRmllbGRzLiBPcGVyYXRpb25zIHVzZSBhIGdpdmVuIHByaW1pdGl2ZSBwb2x5bm9taWFsIGluIGNhbGN1bGF0aW9ucy48L3A+CgkgKgoJICogPHA+VGhyb3VnaG91dCB0aGlzIHBhY2thZ2UsIGVsZW1lbnRzIG9mIHRoZSBHRiBhcmUgcmVwcmVzZW50ZWQgYXMgYW4ge0Bjb2RlIGludH0KCSAqIGZvciBjb252ZW5pZW5jZSBhbmQgc3BlZWQgKGJ1dCBhdCB0aGUgY29zdCBvZiBtZW1vcnkpLgoJICogPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKiBAYXV0aG9yIERhdmlkIE9saXZpZXIKCSAqLwoJdmFyIEdlbmVyaWNHRiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkNihHZW5lcmljR0YsIF9zdXBlcik7CgkgICAgLyoqCgkgICAgICogQ3JlYXRlIGEgcmVwcmVzZW50YXRpb24gb2YgR0Yoc2l6ZSkgdXNpbmcgdGhlIGdpdmVuIHByaW1pdGl2ZSBwb2x5bm9taWFsLgoJICAgICAqCgkgICAgICogQHBhcmFtIHByaW1pdGl2ZSBpcnJlZHVjaWJsZSBwb2x5bm9taWFsIHdob3NlIGNvZWZmaWNpZW50cyBhcmUgcmVwcmVzZW50ZWQgYnkKCSAgICAgKiAgdGhlIGJpdHMgb2YgYW4gaW50LCB3aGVyZSB0aGUgbGVhc3Qtc2lnbmlmaWNhbnQgYml0IHJlcHJlc2VudHMgdGhlIGNvbnN0YW50CgkgICAgICogIGNvZWZmaWNpZW50CgkgICAgICogQHBhcmFtIHNpemUgdGhlIHNpemUgb2YgdGhlIGZpZWxkCgkgICAgICogQHBhcmFtIGIgdGhlIGZhY3RvciBiIGluIHRoZSBnZW5lcmF0b3IgcG9seW5vbWlhbCBjYW4gYmUgMC0gb3IgMS1iYXNlZAoJICAgICAqICAoZyh4KSA9ICh4K2FeYikoeCthXihiKzEpKS4uLih4K2FeKGIrMnQtMSkpKS4KCSAgICAgKiAgSW4gbW9zdCBjYXNlcyBpdCBzaG91bGQgYmUgMSwgYnV0IGZvciBRUiBjb2RlIGl0IGlzIDAuCgkgICAgICovCgkgICAgZnVuY3Rpb24gR2VuZXJpY0dGKHByaW1pdGl2ZSAvKmludCovLCBzaXplIC8qaW50Ki8sIGdlbmVyYXRvckJhc2UgLyppbnQqLykgewoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5wcmltaXRpdmUgPSBwcmltaXRpdmU7CgkgICAgICAgIF90aGlzLnNpemUgPSBzaXplOwoJICAgICAgICBfdGhpcy5nZW5lcmF0b3JCYXNlID0gZ2VuZXJhdG9yQmFzZTsKCSAgICAgICAgdmFyIGV4cFRhYmxlID0gbmV3IEludDMyQXJyYXkoc2l6ZSk7CgkgICAgICAgIHZhciB4ID0gMTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKCSAgICAgICAgICAgIGV4cFRhYmxlW2ldID0geDsKCSAgICAgICAgICAgIHggKj0gMjsgLy8gd2UncmUgYXNzdW1pbmcgdGhlIGdlbmVyYXRvciBhbHBoYSBpcyAyCgkgICAgICAgICAgICBpZiAoeCA+PSBzaXplKSB7CgkgICAgICAgICAgICAgICAgeCBePSBwcmltaXRpdmU7CgkgICAgICAgICAgICAgICAgeCAmPSBzaXplIC0gMTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBfdGhpcy5leHBUYWJsZSA9IGV4cFRhYmxlOwoJICAgICAgICB2YXIgbG9nVGFibGUgPSBuZXcgSW50MzJBcnJheShzaXplKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplIC0gMTsgaSsrKSB7CgkgICAgICAgICAgICBsb2dUYWJsZVtleHBUYWJsZVtpXV0gPSBpOwoJICAgICAgICB9CgkgICAgICAgIF90aGlzLmxvZ1RhYmxlID0gbG9nVGFibGU7CgkgICAgICAgIC8vIGxvZ1RhYmxlWzBdID09IDAgYnV0IHRoaXMgc2hvdWxkIG5ldmVyIGJlIHVzZWQKCSAgICAgICAgX3RoaXMuemVybyA9IG5ldyBHZW5lcmljR0ZQb2x5XzEkMS5kZWZhdWx0KF90aGlzLCBJbnQzMkFycmF5LmZyb20oWzBdKSk7CgkgICAgICAgIF90aGlzLm9uZSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEkMS5kZWZhdWx0KF90aGlzLCBJbnQzMkFycmF5LmZyb20oWzFdKSk7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5nZXRaZXJvID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy56ZXJvOwoJICAgIH07CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5nZXRPbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm9uZTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gdGhlIG1vbm9taWFsIHJlcHJlc2VudGluZyBjb2VmZmljaWVudCAqIHheZGVncmVlCgkgICAgICovCgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5idWlsZE1vbm9taWFsID0gZnVuY3Rpb24gKGRlZ3JlZSAvKmludCovLCBjb2VmZmljaWVudCAvKmludCovKSB7CgkgICAgICAgIGlmIChkZWdyZWUgPCAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkMy5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvZWZmaWNpZW50ID09PSAwKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy56ZXJvOwoJICAgICAgICB9CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSBuZXcgSW50MzJBcnJheShkZWdyZWUgKyAxKTsKCSAgICAgICAgY29lZmZpY2llbnRzWzBdID0gY29lZmZpY2llbnQ7CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seV8xJDEuZGVmYXVsdCh0aGlzLCBjb2VmZmljaWVudHMpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBtdWx0aXBsaWNhdGl2ZSBpbnZlcnNlIG9mIGEKCSAgICAgKi8KCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmludmVyc2UgPSBmdW5jdGlvbiAoYSAvKmludCovKSB7CgkgICAgICAgIGlmIChhID09PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgQXJpdGhtZXRpY0V4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5leHBUYWJsZVt0aGlzLnNpemUgLSB0aGlzLmxvZ1RhYmxlW2FdIC0gMV07CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHByb2R1Y3Qgb2YgYSBhbmQgYiBpbiBHRihzaXplKQoJICAgICAqLwoJICAgIEdlbmVyaWNHRi5wcm90b3R5cGUubXVsdGlwbHkgPSBmdW5jdGlvbiAoYSAvKmludCovLCBiIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGEgPT09IDAgfHwgYiA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIDA7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMuZXhwVGFibGVbKHRoaXMubG9nVGFibGVbYV0gKyB0aGlzLmxvZ1RhYmxlW2JdKSAlICh0aGlzLnNpemUgLSAxKV07CgkgICAgfTsKCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmdldFNpemUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnNpemU7CgkgICAgfTsKCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmdldEdlbmVyYXRvckJhc2UgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRvckJhc2U7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICgnR0YoMHgnICsgSW50ZWdlcl8xJDEuZGVmYXVsdC50b0hleFN0cmluZyh0aGlzLnByaW1pdGl2ZSkgKyAnLCcgKyB0aGlzLnNpemUgKyAnKScpOwoJICAgIH07CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICByZXR1cm4gbyA9PT0gdGhpczsKCSAgICB9OwoJICAgIEdlbmVyaWNHRi5BWlRFQ19EQVRBXzEyID0gbmV3IEdlbmVyaWNHRigweDEwNjksIDQwOTYsIDEpOyAvLyB4XjEyICsgeF42ICsgeF41ICsgeF4zICsgMQoJICAgIEdlbmVyaWNHRi5BWlRFQ19EQVRBXzEwID0gbmV3IEdlbmVyaWNHRigweDQwOSwgMTAyNCwgMSk7IC8vIHheMTAgKyB4XjMgKyAxCgkgICAgR2VuZXJpY0dGLkFaVEVDX0RBVEFfNiA9IG5ldyBHZW5lcmljR0YoMHg0MywgNjQsIDEpOyAvLyB4XjYgKyB4ICsgMQoJICAgIEdlbmVyaWNHRi5BWlRFQ19QQVJBTSA9IG5ldyBHZW5lcmljR0YoMHgxMywgMTYsIDEpOyAvLyB4XjQgKyB4ICsgMQoJICAgIEdlbmVyaWNHRi5RUl9DT0RFX0ZJRUxEXzI1NiA9IG5ldyBHZW5lcmljR0YoMHgwMTFkLCAyNTYsIDApOyAvLyB4XjggKyB4XjQgKyB4XjMgKyB4XjIgKyAxCgkgICAgR2VuZXJpY0dGLkRBVEFfTUFUUklYX0ZJRUxEXzI1NiA9IG5ldyBHZW5lcmljR0YoMHgwMTJkLCAyNTYsIDEpOyAvLyB4XjggKyB4XjUgKyB4XjMgKyB4XjIgKyAxCgkgICAgR2VuZXJpY0dGLkFaVEVDX0RBVEFfOCA9IEdlbmVyaWNHRi5EQVRBX01BVFJJWF9GSUVMRF8yNTY7CgkgICAgR2VuZXJpY0dGLk1BWElDT0RFX0ZJRUxEXzY0ID0gR2VuZXJpY0dGLkFaVEVDX0RBVEFfNjsKCSAgICByZXR1cm4gR2VuZXJpY0dGOwoJfShBYnN0cmFjdEdlbmVyaWNHRl8xLmRlZmF1bHQpKTsKCUdlbmVyaWNHRiQxLmRlZmF1bHQgPSBHZW5lcmljR0Y7CgoJdmFyIFJlZWRTb2xvbW9uRGVjb2RlciQxID0ge307CgoJdmFyIFJlZWRTb2xvbW9uRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgX19leHRlbmRzJDUgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVlZFNvbG9tb25FeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDIgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgUmVlZFNvbG9tb25FeGNlcHRpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDUoUmVlZFNvbG9tb25FeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gUmVlZFNvbG9tb25FeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgUmVlZFNvbG9tb25FeGNlcHRpb24ua2luZCA9ICdSZWVkU29sb21vbkV4Y2VwdGlvbic7CgkgICAgcmV0dXJuIFJlZWRTb2xvbW9uRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQyLmRlZmF1bHQpKTsKCVJlZWRTb2xvbW9uRXhjZXB0aW9uJDEuZGVmYXVsdCA9IFJlZWRTb2xvbW9uRXhjZXB0aW9uOwoKCXZhciBJbGxlZ2FsU3RhdGVFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkNCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbGxlZ2FsU3RhdGVFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDEgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgSWxsZWdhbFN0YXRlRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyQ0KElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgSWxsZWdhbFN0YXRlRXhjZXB0aW9uLmtpbmQgPSAnSWxsZWdhbFN0YXRlRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gSWxsZWdhbFN0YXRlRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQxLmRlZmF1bHQpKTsKCUlsbGVnYWxTdGF0ZUV4Y2VwdGlvbiQxLmRlZmF1bHQgPSBJbGxlZ2FsU3RhdGVFeGNlcHRpb247CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZWVkU29sb21vbkRlY29kZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5jb21tb24ucmVlZHNvbG9tb24geyovCgl2YXIgR2VuZXJpY0dGXzEkMSA9IEdlbmVyaWNHRiQxOwoJdmFyIEdlbmVyaWNHRlBvbHlfMSA9IEdlbmVyaWNHRlBvbHkkMTsKCXZhciBSZWVkU29sb21vbkV4Y2VwdGlvbl8xID0gUmVlZFNvbG9tb25FeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsU3RhdGVFeGNlcHRpb25fMSA9IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5JbXBsZW1lbnRzIFJlZWQtU29sb21vbiBkZWNvZGluZywgYXMgdGhlIG5hbWUgaW1wbGllcy48L3A+CgkgKgoJICogPHA+VGhlIGFsZ29yaXRobSB3aWxsIG5vdCBiZSBleHBsYWluZWQgaGVyZSwgYnV0IHRoZSBmb2xsb3dpbmcgcmVmZXJlbmNlcyB3ZXJlIGhlbHBmdWwKCSAqIGluIGNyZWF0aW5nIHRoaXMgaW1wbGVtZW50YXRpb246PC9wPgoJICoKCSAqIDx1bD4KCSAqIDxsaT5CcnVjZSBNYWdncy4KCSAqIDxhIGhyZWY9Imh0dHA6Ly93d3cuY3MuY211LmVkdS9hZnMvY3MuY211LmVkdS9wcm9qZWN0L3BzY2ljby1ndXliL3JlYWx3b3JsZC93d3cvcnNfZGVjb2RlLnBzIj4KCSAqICJEZWNvZGluZyBSZWVkLVNvbG9tb24gQ29kZXMiPC9hPiAoc2VlIGRpc2N1c3Npb24gb2YgRm9ybmV5J3MgRm9ybXVsYSk8L2xpPgoJICogPGxpPkouSS4gSGFsbC4gPGEgaHJlZj0id3d3Lm10aC5tc3UuZWR1L35qaGFsbC9jbGFzc2VzL2NvZGVub3Rlcy9HUlMucGRmIj4KCSAqICJDaGFwdGVyIDUuIEdlbmVyYWxpemVkIFJlZWQtU29sb21vbiBDb2RlcyI8L2E+CgkgKiAoc2VlIGRpc2N1c3Npb24gb2YgRXVjbGlkZWFuIGFsZ29yaXRobSk8L2xpPgoJICogPC91bD4KCSAqCgkgKiA8cD5NdWNoIGNyZWRpdCBpcyBkdWUgdG8gV2lsbGlhbSBSdWNrbGlkZ2Ugc2luY2UgcG9ydGlvbnMgb2YgdGhpcyBjb2RlIGFyZSBhbiBpbmRpcmVjdAoJICogcG9ydCBvZiBoaXMgQysrIFJlZWQtU29sb21vbiBpbXBsZW1lbnRhdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBhdXRob3IgV2lsbGlhbSBSdWNrbGlkZ2UKCSAqIEBhdXRob3Igc2FuZm9yZHNxdWlyZXMKCSAqLwoJdmFyIFJlZWRTb2xvbW9uRGVjb2RlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBSZWVkU29sb21vbkRlY29kZXIoZmllbGQpIHsKCSAgICAgICAgdGhpcy5maWVsZCA9IGZpZWxkOwoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5EZWNvZGVzIGdpdmVuIHNldCBvZiByZWNlaXZlZCBjb2Rld29yZHMsIHdoaWNoIGluY2x1ZGUgYm90aCBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uCgkgICAgICogY29kZXdvcmRzLiBSZWFsbHksIHRoaXMgbWVhbnMgaXQgdXNlcyBSZWVkLVNvbG9tb24gdG8gZGV0ZWN0IGFuZCBjb3JyZWN0IGVycm9ycywgaW4tcGxhY2UsCgkgICAgICogaW4gdGhlIGlucHV0LjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSByZWNlaXZlZCBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcwoJICAgICAqIEBwYXJhbSB0d29TIG51bWJlciBvZiBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyBhdmFpbGFibGUKCSAgICAgKiBAdGhyb3dzIFJlZWRTb2xvbW9uRXhjZXB0aW9uIGlmIGRlY29kaW5nIGZhaWxzIGZvciBhbnkgcmVhc29uCgkgICAgICovCgkgICAgUmVlZFNvbG9tb25EZWNvZGVyLnByb3RvdHlwZS5kZWNvZGUgPSBmdW5jdGlvbiAocmVjZWl2ZWQsIHR3b1MgLyppbnQqLykgewoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICB2YXIgcG9seSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEuZGVmYXVsdChmaWVsZCwgcmVjZWl2ZWQpOwoJICAgICAgICB2YXIgc3luZHJvbWVDb2VmZmljaWVudHMgPSBuZXcgSW50MzJBcnJheSh0d29TKTsKCSAgICAgICAgdmFyIG5vRXJyb3IgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHR3b1M7IGkrKykgewoJICAgICAgICAgICAgdmFyIGV2YWxSZXN1bHQgPSBwb2x5LmV2YWx1YXRlQXQoZmllbGQuZXhwKGkgKyBmaWVsZC5nZXRHZW5lcmF0b3JCYXNlKCkpKTsKCSAgICAgICAgICAgIHN5bmRyb21lQ29lZmZpY2llbnRzW3N5bmRyb21lQ29lZmZpY2llbnRzLmxlbmd0aCAtIDEgLSBpXSA9IGV2YWxSZXN1bHQ7CgkgICAgICAgICAgICBpZiAoZXZhbFJlc3VsdCAhPT0gMCkgewoJICAgICAgICAgICAgICAgIG5vRXJyb3IgPSBmYWxzZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBpZiAobm9FcnJvcikgewoJICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzeW5kcm9tZSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEuZGVmYXVsdChmaWVsZCwgc3luZHJvbWVDb2VmZmljaWVudHMpOwoJICAgICAgICB2YXIgc2lnbWFPbWVnYSA9IHRoaXMucnVuRXVjbGlkZWFuQWxnb3JpdGhtKGZpZWxkLmJ1aWxkTW9ub21pYWwodHdvUywgMSksIHN5bmRyb21lLCB0d29TKTsKCSAgICAgICAgdmFyIHNpZ21hID0gc2lnbWFPbWVnYVswXTsKCSAgICAgICAgdmFyIG9tZWdhID0gc2lnbWFPbWVnYVsxXTsKCSAgICAgICAgdmFyIGVycm9yTG9jYXRpb25zID0gdGhpcy5maW5kRXJyb3JMb2NhdGlvbnMoc2lnbWEpOwoJICAgICAgICB2YXIgZXJyb3JNYWduaXR1ZGVzID0gdGhpcy5maW5kRXJyb3JNYWduaXR1ZGVzKG9tZWdhLCBlcnJvckxvY2F0aW9ucyk7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXJyb3JMb2NhdGlvbnMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IHJlY2VpdmVkLmxlbmd0aCAtIDEgLSBmaWVsZC5sb2coZXJyb3JMb2NhdGlvbnNbaV0pOwoJICAgICAgICAgICAgaWYgKHBvc2l0aW9uIDwgMCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBSZWVkU29sb21vbkV4Y2VwdGlvbl8xLmRlZmF1bHQoJ0JhZCBlcnJvciBsb2NhdGlvbicpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVjZWl2ZWRbcG9zaXRpb25dID0gR2VuZXJpY0dGXzEkMS5kZWZhdWx0LmFkZE9yU3VidHJhY3QocmVjZWl2ZWRbcG9zaXRpb25dLCBlcnJvck1hZ25pdHVkZXNbaV0pOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZWVkU29sb21vbkRlY29kZXIucHJvdG90eXBlLnJ1bkV1Y2xpZGVhbkFsZ29yaXRobSA9IGZ1bmN0aW9uIChhLCBiLCBSIC8qaW50Ki8pIHsKCSAgICAgICAgLy8gQXNzdW1lIGEncyBkZWdyZWUgaXMgPj0gYidzCgkgICAgICAgIGlmIChhLmdldERlZ3JlZSgpIDwgYi5nZXREZWdyZWUoKSkgewoJICAgICAgICAgICAgdmFyIHRlbXAgPSBhOwoJICAgICAgICAgICAgYSA9IGI7CgkgICAgICAgICAgICBiID0gdGVtcDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICB2YXIgckxhc3QgPSBhOwoJICAgICAgICB2YXIgciA9IGI7CgkgICAgICAgIHZhciB0TGFzdCA9IGZpZWxkLmdldFplcm8oKTsKCSAgICAgICAgdmFyIHQgPSBmaWVsZC5nZXRPbmUoKTsKCSAgICAgICAgLy8gUnVuIEV1Y2xpZGVhbiBhbGdvcml0aG0gdW50aWwgcidzIGRlZ3JlZSBpcyBsZXNzIHRoYW4gUi8yCgkgICAgICAgIHdoaWxlIChyLmdldERlZ3JlZSgpID49IChSIC8gMiB8IDApKSB7CgkgICAgICAgICAgICB2YXIgckxhc3RMYXN0ID0gckxhc3Q7CgkgICAgICAgICAgICB2YXIgdExhc3RMYXN0ID0gdExhc3Q7CgkgICAgICAgICAgICByTGFzdCA9IHI7CgkgICAgICAgICAgICB0TGFzdCA9IHQ7CgkgICAgICAgICAgICAvLyBEaXZpZGUgckxhc3RMYXN0IGJ5IHJMYXN0LCB3aXRoIHF1b3RpZW50IGluIHEgYW5kIHJlbWFpbmRlciBpbiByCgkgICAgICAgICAgICBpZiAockxhc3QuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgICAgICAvLyBPb3BzLCBFdWNsaWRlYW4gYWxnb3JpdGhtIGFscmVhZHkgdGVybWluYXRlZD8KCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmVlZFNvbG9tb25FeGNlcHRpb25fMS5kZWZhdWx0KCdyX3tpLTF9IHdhcyB6ZXJvJyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByID0gckxhc3RMYXN0OwoJICAgICAgICAgICAgdmFyIHEgPSBmaWVsZC5nZXRaZXJvKCk7CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3JMZWFkaW5nVGVybSA9IHJMYXN0LmdldENvZWZmaWNpZW50KHJMYXN0LmdldERlZ3JlZSgpKTsKCSAgICAgICAgICAgIHZhciBkbHRJbnZlcnNlID0gZmllbGQuaW52ZXJzZShkZW5vbWluYXRvckxlYWRpbmdUZXJtKTsKCSAgICAgICAgICAgIHdoaWxlIChyLmdldERlZ3JlZSgpID49IHJMYXN0LmdldERlZ3JlZSgpICYmICFyLmlzWmVybygpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRlZ3JlZURpZmYgPSByLmdldERlZ3JlZSgpIC0gckxhc3QuZ2V0RGVncmVlKCk7CgkgICAgICAgICAgICAgICAgdmFyIHNjYWxlID0gZmllbGQubXVsdGlwbHkoci5nZXRDb2VmZmljaWVudChyLmdldERlZ3JlZSgpKSwgZGx0SW52ZXJzZSk7CgkgICAgICAgICAgICAgICAgcSA9IHEuYWRkT3JTdWJ0cmFjdChmaWVsZC5idWlsZE1vbm9taWFsKGRlZ3JlZURpZmYsIHNjYWxlKSk7CgkgICAgICAgICAgICAgICAgciA9IHIuYWRkT3JTdWJ0cmFjdChyTGFzdC5tdWx0aXBseUJ5TW9ub21pYWwoZGVncmVlRGlmZiwgc2NhbGUpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHQgPSBxLm11bHRpcGx5KHRMYXN0KS5hZGRPclN1YnRyYWN0KHRMYXN0TGFzdCk7CgkgICAgICAgICAgICBpZiAoci5nZXREZWdyZWUoKSA+PSByTGFzdC5nZXREZWdyZWUoKSkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb25fMS5kZWZhdWx0KCdEaXZpc2lvbiBhbGdvcml0aG0gZmFpbGVkIHRvIHJlZHVjZSBwb2x5bm9taWFsPycpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciBzaWdtYVRpbGRlQXRaZXJvID0gdC5nZXRDb2VmZmljaWVudCgwKTsKCSAgICAgICAgaWYgKHNpZ21hVGlsZGVBdFplcm8gPT09IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBSZWVkU29sb21vbkV4Y2VwdGlvbl8xLmRlZmF1bHQoJ3NpZ21hVGlsZGUoMCkgd2FzIHplcm8nKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgaW52ZXJzZSA9IGZpZWxkLmludmVyc2Uoc2lnbWFUaWxkZUF0WmVybyk7CgkgICAgICAgIHZhciBzaWdtYSA9IHQubXVsdGlwbHlTY2FsYXIoaW52ZXJzZSk7CgkgICAgICAgIHZhciBvbWVnYSA9IHIubXVsdGlwbHlTY2FsYXIoaW52ZXJzZSk7CgkgICAgICAgIHJldHVybiBbc2lnbWEsIG9tZWdhXTsKCSAgICB9OwoJICAgIFJlZWRTb2xvbW9uRGVjb2Rlci5wcm90b3R5cGUuZmluZEVycm9yTG9jYXRpb25zID0gZnVuY3Rpb24gKGVycm9yTG9jYXRvcikgewoJICAgICAgICAvLyBUaGlzIGlzIGEgZGlyZWN0IGFwcGxpY2F0aW9uIG9mIENoaWVuJ3Mgc2VhcmNoCgkgICAgICAgIHZhciBudW1FcnJvcnMgPSBlcnJvckxvY2F0b3IuZ2V0RGVncmVlKCk7CgkgICAgICAgIGlmIChudW1FcnJvcnMgPT09IDEpIHsgLy8gc2hvcnRjdXQKCSAgICAgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW2Vycm9yTG9jYXRvci5nZXRDb2VmZmljaWVudCgxKV0pOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSBuZXcgSW50MzJBcnJheShudW1FcnJvcnMpOwoJICAgICAgICB2YXIgZSA9IDA7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgZmllbGQuZ2V0U2l6ZSgpICYmIGUgPCBudW1FcnJvcnM7IGkrKykgewoJICAgICAgICAgICAgaWYgKGVycm9yTG9jYXRvci5ldmFsdWF0ZUF0KGkpID09PSAwKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0W2VdID0gZmllbGQuaW52ZXJzZShpKTsKCSAgICAgICAgICAgICAgICBlKys7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGUgIT09IG51bUVycm9ycykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IFJlZWRTb2xvbW9uRXhjZXB0aW9uXzEuZGVmYXVsdCgnRXJyb3IgbG9jYXRvciBkZWdyZWUgZG9lcyBub3QgbWF0Y2ggbnVtYmVyIG9mIHJvb3RzJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIFJlZWRTb2xvbW9uRGVjb2Rlci5wcm90b3R5cGUuZmluZEVycm9yTWFnbml0dWRlcyA9IGZ1bmN0aW9uIChlcnJvckV2YWx1YXRvciwgZXJyb3JMb2NhdGlvbnMpIHsKCSAgICAgICAgLy8gVGhpcyBpcyBkaXJlY3RseSBhcHBseWluZyBGb3JuZXkncyBGb3JtdWxhCgkgICAgICAgIHZhciBzID0gZXJyb3JMb2NhdGlvbnMubGVuZ3RoOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IEludDMyQXJyYXkocyk7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgczsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgeGlJbnZlcnNlID0gZmllbGQuaW52ZXJzZShlcnJvckxvY2F0aW9uc1tpXSk7CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3IgPSAxOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzOyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAoaSAhPT0gaikgewoJICAgICAgICAgICAgICAgICAgICAvLyBkZW5vbWluYXRvciA9IGZpZWxkLm11bHRpcGx5KGRlbm9taW5hdG9yLAoJICAgICAgICAgICAgICAgICAgICAvLyAgICBHZW5lcmljR0YuYWRkT3JTdWJ0cmFjdCgxLCBmaWVsZC5tdWx0aXBseShlcnJvckxvY2F0aW9uc1tqXSwgeGlJbnZlcnNlKSkpCgkgICAgICAgICAgICAgICAgICAgIC8vIEFib3ZlIHNob3VsZCB3b3JrIGJ1dCBmYWlscyBvbiBzb21lIEFwcGxlIGFuZCBMaW51eCBKREtzIGR1ZSB0byBhIEhvdHNwb3QgYnVnLgoJICAgICAgICAgICAgICAgICAgICAvLyBCZWxvdyBpcyBhIGZ1bm55LWxvb2tpbmcgd29ya2Fyb3VuZCBmcm9tIFN0ZXZlbiBQYXJrZXMKCSAgICAgICAgICAgICAgICAgICAgdmFyIHRlcm0gPSBmaWVsZC5tdWx0aXBseShlcnJvckxvY2F0aW9uc1tqXSwgeGlJbnZlcnNlKTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIHRlcm1QbHVzMSA9ICh0ZXJtICYgMHgxKSA9PT0gMCA/IHRlcm0gfCAxIDogdGVybSAmIH4xOwoJICAgICAgICAgICAgICAgICAgICBkZW5vbWluYXRvciA9IGZpZWxkLm11bHRpcGx5KGRlbm9taW5hdG9yLCB0ZXJtUGx1czEpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdFtpXSA9IGZpZWxkLm11bHRpcGx5KGVycm9yRXZhbHVhdG9yLmV2YWx1YXRlQXQoeGlJbnZlcnNlKSwgZmllbGQuaW52ZXJzZShkZW5vbWluYXRvcikpOwoJICAgICAgICAgICAgaWYgKGZpZWxkLmdldEdlbmVyYXRvckJhc2UoKSAhPT0gMCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdFtpXSA9IGZpZWxkLm11bHRpcGx5KHJlc3VsdFtpXSwgeGlJbnZlcnNlKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgcmV0dXJuIFJlZWRTb2xvbW9uRGVjb2RlcjsKCX0oKSk7CglSZWVkU29sb21vbkRlY29kZXIkMS5kZWZhdWx0ID0gUmVlZFNvbG9tb25EZWNvZGVyOwoKCXZhciBCaXRNYXRyaXhQYXJzZXIkMSA9IHt9OwoKCXZhciBWZXJzaW9uJDEgPSB7fTsKCgl2YXIgRm9ybWF0SW5mb3JtYXRpb24kMSA9IHt9OwoKCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbCA9IHt9OwoKCXZhciBBcmd1bWVudEV4Y2VwdGlvbiQxID0ge307CgoJdmFyIF9fZXh0ZW5kcyQzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFyZ3VtZW50RXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBFeGNlcHRpb25fMSA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBBcmd1bWVudEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkMyhBcmd1bWVudEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBBcmd1bWVudEV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBBcmd1bWVudEV4Y2VwdGlvbi5raW5kID0gJ0FyZ3VtZW50RXhjZXB0aW9uJzsKCSAgICByZXR1cm4gQXJndW1lbnRFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xLmRlZmF1bHQpKTsKCUFyZ3VtZW50RXhjZXB0aW9uJDEuZGVmYXVsdCA9IEFyZ3VtZW50RXhjZXB0aW9uOwoKCShmdW5jdGlvbiAoZXhwb3J0cykgewoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CglleHBvcnRzLkVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzID0gdm9pZCAwOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBBcmd1bWVudEV4Y2VwdGlvbl8xID0gQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJdmFyIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzOwoJKGZ1bmN0aW9uIChFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcykgewoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzW0Vycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzWyJMIl0gPSAwXSA9ICJMIjsKCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlc1tFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlc1siTSJdID0gMV0gPSAiTSI7CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXNbRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXNbIlEiXSA9IDJdID0gIlEiOwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzW0Vycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzWyJIIl0gPSAzXSA9ICJIIjsKCX0pKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzID0gZXhwb3J0cy5FcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcyB8fCAoZXhwb3J0cy5FcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcyA9IHt9KSk7CgkvKioKCSAqIDxwPlNlZSBJU08gMTgwMDQ6MjAwNiwgNi41LjEuIFRoaXMgZW51bSBlbmNhcHN1bGF0ZXMgdGhlIGZvdXIgZXJyb3IgY29ycmVjdGlvbiBsZXZlbHMKCSAqIGRlZmluZWQgYnkgdGhlIFFSIGNvZGUgc3RhbmRhcmQuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBFcnJvckNvcnJlY3Rpb25MZXZlbCh2YWx1ZSwgc3RyaW5nVmFsdWUsIGJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuc3RyaW5nVmFsdWUgPSBzdHJpbmdWYWx1ZTsKCSAgICAgICAgdGhpcy5iaXRzID0gYml0czsKCSAgICAgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuc2V0KGJpdHMsIHRoaXMpOwoJICAgICAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5GT1JfVkFMVUUuc2V0KHZhbHVlLCB0aGlzKTsKCSAgICB9CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTsKCSAgICB9OwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsLnByb3RvdHlwZS5nZXRCaXRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRzOwoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuZnJvbVN0cmluZyA9IGZ1bmN0aW9uIChzKSB7CgkgICAgICAgIHN3aXRjaCAocykgewoJICAgICAgICAgICAgY2FzZSAnTCc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5MOwoJICAgICAgICAgICAgY2FzZSAnTSc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5NOwoJICAgICAgICAgICAgY2FzZSAnUSc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5ROwoJICAgICAgICAgICAgY2FzZSAnSCc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5IOwoJICAgICAgICAgICAgZGVmYXVsdDogdGhyb3cgbmV3IEFyZ3VtZW50RXhjZXB0aW9uXzEuZGVmYXVsdChzICsgJ25vdCBhdmFpbGFibGUnKTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdWYWx1ZTsKCSAgICB9OwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgRXJyb3JDb3JyZWN0aW9uTGV2ZWwpKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG90aGVyID0gbzsKCSAgICAgICAgcmV0dXJuIHRoaXMudmFsdWUgPT09IG90aGVyLnZhbHVlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJpdHMgaW50IGNvbnRhaW5pbmcgdGhlIHR3byBiaXRzIGVuY29kaW5nIGEgUVIgQ29kZSdzIGVycm9yIGNvcnJlY3Rpb24gbGV2ZWwKCSAgICAgKiBAcmV0dXJuIEVycm9yQ29ycmVjdGlvbkxldmVsIHJlcHJlc2VudGluZyB0aGUgZW5jb2RlZCBlcnJvciBjb3JyZWN0aW9uIGxldmVsCgkgICAgICovCgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuZm9yQml0cyA9IGZ1bmN0aW9uIChiaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGJpdHMgPCAwIHx8IGJpdHMgPj0gRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuc2l6ZSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuZ2V0KGJpdHMpOwoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMgPSBuZXcgTWFwKCk7CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX1ZBTFVFID0gbmV3IE1hcCgpOwoJICAgIC8qKiBMID0gfjclIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5MID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLkwsICdMJywgMHgwMSk7CgkgICAgLyoqIE0gPSB+MTUlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5NID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLk0sICdNJywgMHgwMCk7CgkgICAgLyoqIFEgPSB+MjUlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5RID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLlEsICdRJywgMHgwMyk7CgkgICAgLyoqIEggPSB+MzAlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5IID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLkgsICdIJywgMHgwMik7CgkgICAgcmV0dXJuIEVycm9yQ29ycmVjdGlvbkxldmVsOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IEVycm9yQ29ycmVjdGlvbkxldmVsOwoKCX0oRXJyb3JDb3JyZWN0aW9uTGV2ZWwpKTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDYgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRm9ybWF0SW5mb3JtYXRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbF8xID0gRXJyb3JDb3JyZWN0aW9uTGV2ZWw7Cgl2YXIgSW50ZWdlcl8xID0gSW50ZWdlciQxOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgYSBRUiBDb2RlJ3MgZm9ybWF0IGluZm9ybWF0aW9uLCBpbmNsdWRpbmcgdGhlIGRhdGEgbWFzayB1c2VkIGFuZAoJICogZXJyb3IgY29ycmVjdGlvbiBsZXZlbC48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBzZWUgRGF0YU1hc2sKCSAqIEBzZWUgRXJyb3JDb3JyZWN0aW9uTGV2ZWwKCSAqLwoJdmFyIEZvcm1hdEluZm9ybWF0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEZvcm1hdEluZm9ybWF0aW9uKGZvcm1hdEluZm8gLyppbnQqLykgewoJICAgICAgICAvLyBCaXRzIDMsNAoJICAgICAgICB0aGlzLmVycm9yQ29ycmVjdGlvbkxldmVsID0gRXJyb3JDb3JyZWN0aW9uTGV2ZWxfMS5kZWZhdWx0LmZvckJpdHMoKGZvcm1hdEluZm8gPj4gMykgJiAweDAzKTsKCSAgICAgICAgLy8gQm90dG9tIDMgYml0cwoJICAgICAgICB0aGlzLmRhdGFNYXNrID0gLyooYnl0ZSkgKi8gKGZvcm1hdEluZm8gJiAweDA3KTsKCSAgICB9CgkgICAgRm9ybWF0SW5mb3JtYXRpb24ubnVtQml0c0RpZmZlcmluZyA9IGZ1bmN0aW9uIChhIC8qaW50Ki8sIGIgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gSW50ZWdlcl8xLmRlZmF1bHQuYml0Q291bnQoYSBeIGIpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIG1hc2tlZEZvcm1hdEluZm8xIGZvcm1hdCBpbmZvIGluZGljYXRvciwgd2l0aCBtYXNrIHN0aWxsIGFwcGxpZWQKCSAgICAgKiBAcGFyYW0gbWFza2VkRm9ybWF0SW5mbzIgc2Vjb25kIGNvcHkgb2Ygc2FtZSBpbmZvOyBib3RoIGFyZSBjaGVja2VkIGF0IHRoZSBzYW1lIHRpbWUKCSAgICAgKiAgdG8gZXN0YWJsaXNoIGJlc3QgbWF0Y2gKCSAgICAgKiBAcmV0dXJuIGluZm9ybWF0aW9uIGFib3V0IHRoZSBmb3JtYXQgaXQgc3BlY2lmaWVzLCBvciB7QGNvZGUgbnVsbH0KCSAgICAgKiAgaWYgZG9lc24ndCBzZWVtIHRvIG1hdGNoIGFueSBrbm93biBwYXR0ZXJuCgkgICAgICovCgkgICAgRm9ybWF0SW5mb3JtYXRpb24uZGVjb2RlRm9ybWF0SW5mb3JtYXRpb24gPSBmdW5jdGlvbiAobWFza2VkRm9ybWF0SW5mbzEgLyppbnQqLywgbWFza2VkRm9ybWF0SW5mbzIgLyppbnQqLykgewoJICAgICAgICB2YXIgZm9ybWF0SW5mbyA9IEZvcm1hdEluZm9ybWF0aW9uLmRvRGVjb2RlRm9ybWF0SW5mb3JtYXRpb24obWFza2VkRm9ybWF0SW5mbzEsIG1hc2tlZEZvcm1hdEluZm8yKTsKCSAgICAgICAgaWYgKGZvcm1hdEluZm8gIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiBmb3JtYXRJbmZvOwoJICAgICAgICB9CgkgICAgICAgIC8vIFNob3VsZCByZXR1cm4gbnVsbCwgYnV0LCBzb21lIFFSIGNvZGVzIGFwcGFyZW50bHkKCSAgICAgICAgLy8gZG8gbm90IG1hc2sgdGhpcyBpbmZvLiBUcnkgYWdhaW4gYnkgYWN0dWFsbHkgbWFza2luZyB0aGUgcGF0dGVybgoJICAgICAgICAvLyBmaXJzdAoJICAgICAgICByZXR1cm4gRm9ybWF0SW5mb3JtYXRpb24uZG9EZWNvZGVGb3JtYXRJbmZvcm1hdGlvbihtYXNrZWRGb3JtYXRJbmZvMSBeIEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX01BU0tfUVIsIG1hc2tlZEZvcm1hdEluZm8yIF4gRm9ybWF0SW5mb3JtYXRpb24uRk9STUFUX0lORk9fTUFTS19RUik7CgkgICAgfTsKCSAgICBGb3JtYXRJbmZvcm1hdGlvbi5kb0RlY29kZUZvcm1hdEluZm9ybWF0aW9uID0gZnVuY3Rpb24gKG1hc2tlZEZvcm1hdEluZm8xIC8qaW50Ki8sIG1hc2tlZEZvcm1hdEluZm8yIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGVfMSwgX2E7CgkgICAgICAgIC8vIEZpbmQgdGhlIGludCBpbiBGT1JNQVRfSU5GT19ERUNPREVfTE9PS1VQIHdpdGggZmV3ZXN0IGJpdHMgZGlmZmVyaW5nCgkgICAgICAgIHZhciBiZXN0RGlmZmVyZW5jZSA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSOwoJICAgICAgICB2YXIgYmVzdEZvcm1hdEluZm8gPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgX2IgPSBfX3ZhbHVlcyQ2KEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX0RFQ09ERV9MT09LVVApLCBfYyA9IF9iLm5leHQoKTsgIV9jLmRvbmU7IF9jID0gX2IubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRlY29kZUluZm8gPSBfYy52YWx1ZTsKCSAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0SW5mbyA9IGRlY29kZUluZm9bMF07CgkgICAgICAgICAgICAgICAgaWYgKHRhcmdldEluZm8gPT09IG1hc2tlZEZvcm1hdEluZm8xIHx8IHRhcmdldEluZm8gPT09IG1hc2tlZEZvcm1hdEluZm8yKSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIEZvdW5kIGFuIGV4YWN0IG1hdGNoCgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRm9ybWF0SW5mb3JtYXRpb24oZGVjb2RlSW5mb1sxXSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHZhciBiaXRzRGlmZmVyZW5jZSA9IEZvcm1hdEluZm9ybWF0aW9uLm51bUJpdHNEaWZmZXJpbmcobWFza2VkRm9ybWF0SW5mbzEsIHRhcmdldEluZm8pOwoJICAgICAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgICAgIGJlc3RGb3JtYXRJbmZvID0gZGVjb2RlSW5mb1sxXTsKCSAgICAgICAgICAgICAgICAgICAgYmVzdERpZmZlcmVuY2UgPSBiaXRzRGlmZmVyZW5jZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKG1hc2tlZEZvcm1hdEluZm8xICE9PSBtYXNrZWRGb3JtYXRJbmZvMikgewoJICAgICAgICAgICAgICAgICAgICAvLyBhbHNvIHRyeSB0aGUgb3RoZXIgb3B0aW9uCgkgICAgICAgICAgICAgICAgICAgIGJpdHNEaWZmZXJlbmNlID0gRm9ybWF0SW5mb3JtYXRpb24ubnVtQml0c0RpZmZlcmluZyhtYXNrZWRGb3JtYXRJbmZvMiwgdGFyZ2V0SW5mbyk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBiZXN0Rm9ybWF0SW5mbyA9IGRlY29kZUluZm9bMV07CgkgICAgICAgICAgICAgICAgICAgICAgICBiZXN0RGlmZmVyZW5jZSA9IGJpdHNEaWZmZXJlbmNlOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzFfMSkgeyBlXzEgPSB7IGVycm9yOiBlXzFfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2MgJiYgIV9jLmRvbmUgJiYgKF9hID0gX2IucmV0dXJuKSkgX2EuY2FsbChfYik7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gSGFtbWluZyBkaXN0YW5jZSBvZiB0aGUgMzIgbWFza2VkIGNvZGVzIGlzIDcsIGJ5IGNvbnN0cnVjdGlvbiwgc28gPD0gMyBiaXRzCgkgICAgICAgIC8vIGRpZmZlcmluZyBtZWFucyB3ZSBmb3VuZCBhIG1hdGNoCgkgICAgICAgIGlmIChiZXN0RGlmZmVyZW5jZSA8PSAzKSB7CgkgICAgICAgICAgICByZXR1cm4gbmV3IEZvcm1hdEluZm9ybWF0aW9uKGJlc3RGb3JtYXRJbmZvKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbnVsbDsKCSAgICB9OwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLnByb3RvdHlwZS5nZXRFcnJvckNvcnJlY3Rpb25MZXZlbCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZXJyb3JDb3JyZWN0aW9uTGV2ZWw7CgkgICAgfTsKCSAgICBGb3JtYXRJbmZvcm1hdGlvbi5wcm90b3R5cGUuZ2V0RGF0YU1hc2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRhdGFNYXNrOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICh0aGlzLmVycm9yQ29ycmVjdGlvbkxldmVsLmdldEJpdHMoKSA8PCAzKSB8IHRoaXMuZGF0YU1hc2s7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgRm9ybWF0SW5mb3JtYXRpb24ucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChvKSB7CgkgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBGb3JtYXRJbmZvcm1hdGlvbikpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgb3RoZXIgPSBvOwoJICAgICAgICByZXR1cm4gdGhpcy5lcnJvckNvcnJlY3Rpb25MZXZlbCA9PT0gb3RoZXIuZXJyb3JDb3JyZWN0aW9uTGV2ZWwgJiYKCSAgICAgICAgICAgIHRoaXMuZGF0YU1hc2sgPT09IG90aGVyLmRhdGFNYXNrOwoJICAgIH07CgkgICAgRm9ybWF0SW5mb3JtYXRpb24uRk9STUFUX0lORk9fTUFTS19RUiA9IDB4NTQxMjsKCSAgICAvKioKCSAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYsIEFubmV4IEMsIFRhYmxlIEMuMQoJICAgICAqLwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX0RFQ09ERV9MT09LVVAgPSBbCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1NDEyLCAweDAwXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1MTI1LCAweDAxXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1RTdDLCAweDAyXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1QjRCLCAweDAzXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0NUY5LCAweDA0XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0MENFLCAweDA1XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0Rjk3LCAweDA2XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0QUEwLCAweDA3XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3N0M0LCAweDA4XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3MkYzLCAweDA5XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3REFBLCAweDBBXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3ODlELCAweDBCXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2NjJGLCAweDBDXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2MzE4LCAweDBEXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2QzQxLCAweDBFXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2OTc2LCAweDBGXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxNjg5LCAweDEwXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxM0JFLCAweDExXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxQ0U3LCAweDEyXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxOUQwLCAweDEzXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwNzYyLCAweDE0XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwMjU1LCAweDE1XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwRDBDLCAweDE2XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwODNCLCAweDE3XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzNTVGLCAweDE4XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzMDY4LCAweDE5XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzRjMxLCAweDFBXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzQTA2LCAweDFCXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyNEI0LCAweDFDXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyMTgzLCAweDFEXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyRURBLCAweDFFXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyQkVELCAweDFGXSksCgkgICAgXTsKCSAgICByZXR1cm4gRm9ybWF0SW5mb3JtYXRpb247Cgl9KCkpOwoJRm9ybWF0SW5mb3JtYXRpb24kMS5kZWZhdWx0ID0gRm9ybWF0SW5mb3JtYXRpb247CgoJdmFyIEVDQmxvY2tzJDEgPSB7fTsKCgl2YXIgX192YWx1ZXMkNSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX3ZhbHVlcykgfHwgZnVuY3Rpb24obykgewoJICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwOwoJICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pOwoJICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHJldHVybiB7CgkgICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7CgkgICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/ICJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLiIgOiAiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpOwoJfTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFQ0Jsb2NrcyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIHNldCBvZiBlcnJvci1jb3JyZWN0aW9uIGJsb2NrcyBpbiBvbmUgc3ltYm9sIHZlcnNpb24uIE1vc3QgdmVyc2lvbnMgd2lsbAoJICogdXNlIGJsb2NrcyBvZiBkaWZmZXJpbmcgc2l6ZXMgd2l0aGluIG9uZSB2ZXJzaW9uLCBzbywgdGhpcyBlbmNhcHN1bGF0ZXMgdGhlIHBhcmFtZXRlcnMgZm9yCgkgKiBlYWNoIHNldCBvZiBibG9ja3MuIEl0IGFsc28gaG9sZHMgdGhlIG51bWJlciBvZiBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyBwZXIgYmxvY2sgc2luY2UgaXQKCSAqIHdpbGwgYmUgdGhlIHNhbWUgYWNyb3NzIGFsbCBibG9ja3Mgd2l0aGluIG9uZSB2ZXJzaW9uLjwvcD4KCSAqLwoJdmFyIEVDQmxvY2tzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEVDQmxvY2tzKGVjQ29kZXdvcmRzUGVyQmxvY2sgLyppbnQqLykgewoJICAgICAgICB2YXIgZWNCbG9ja3MgPSBbXTsKCSAgICAgICAgZm9yICh2YXIgX2kgPSAxOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgIGVjQmxvY2tzW19pIC0gMV0gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuZWNDb2Rld29yZHNQZXJCbG9jayA9IGVjQ29kZXdvcmRzUGVyQmxvY2s7CgkgICAgICAgIHRoaXMuZWNCbG9ja3MgPSBlY0Jsb2NrczsKCSAgICB9CgkgICAgRUNCbG9ja3MucHJvdG90eXBlLmdldEVDQ29kZXdvcmRzUGVyQmxvY2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmVjQ29kZXdvcmRzUGVyQmxvY2s7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0TnVtQmxvY2tzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIHRvdGFsID0gMDsKCSAgICAgICAgdmFyIGVjQmxvY2tzID0gdGhpcy5lY0Jsb2NrczsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIGVjQmxvY2tzXzEgPSBfX3ZhbHVlcyQ1KGVjQmxvY2tzKSwgZWNCbG9ja3NfMV8xID0gZWNCbG9ja3NfMS5uZXh0KCk7ICFlY0Jsb2Nrc18xXzEuZG9uZTsgZWNCbG9ja3NfMV8xID0gZWNCbG9ja3NfMS5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZWNCbG9jayA9IGVjQmxvY2tzXzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbCArPSBlY0Jsb2NrLmdldENvdW50KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChlY0Jsb2Nrc18xXzEgJiYgIWVjQmxvY2tzXzFfMS5kb25lICYmIChfYSA9IGVjQmxvY2tzXzEucmV0dXJuKSkgX2EuY2FsbChlY0Jsb2Nrc18xKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdG90YWw7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0VG90YWxFQ0NvZGV3b3JkcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZWNDb2Rld29yZHNQZXJCbG9jayAqIHRoaXMuZ2V0TnVtQmxvY2tzKCk7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0RUNCbG9ja3MgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmVjQmxvY2tzOwoJICAgIH07CgkgICAgcmV0dXJuIEVDQmxvY2tzOwoJfSgpKTsKCUVDQmxvY2tzJDEuZGVmYXVsdCA9IEVDQmxvY2tzOwoKCXZhciBFQ0IkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFQ0IkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgdGhlIHBhcmFtZXRlcnMgZm9yIG9uZSBlcnJvci1jb3JyZWN0aW9uIGJsb2NrIGluIG9uZSBzeW1ib2wgdmVyc2lvbi4KCSAqIFRoaXMgaW5jbHVkZXMgdGhlIG51bWJlciBvZiBkYXRhIGNvZGV3b3JkcywgYW5kIHRoZSBudW1iZXIgb2YgdGltZXMgYSBibG9jayB3aXRoIHRoZXNlCgkgKiBwYXJhbWV0ZXJzIGlzIHVzZWQgY29uc2VjdXRpdmVseSBpbiB0aGUgUVIgY29kZSB2ZXJzaW9uJ3MgZm9ybWF0LjwvcD4KCSAqLwoJdmFyIEVDQiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBFQ0IoY291bnQgLyppbnQqLywgZGF0YUNvZGV3b3JkcyAvKmludCovKSB7CgkgICAgICAgIHRoaXMuY291bnQgPSBjb3VudDsKCSAgICAgICAgdGhpcy5kYXRhQ29kZXdvcmRzID0gZGF0YUNvZGV3b3JkczsKCSAgICB9CgkgICAgRUNCLnByb3RvdHlwZS5nZXRDb3VudCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY291bnQ7CgkgICAgfTsKCSAgICBFQ0IucHJvdG90eXBlLmdldERhdGFDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRhdGFDb2Rld29yZHM7CgkgICAgfTsKCSAgICByZXR1cm4gRUNCOwoJfSgpKTsKCUVDQiQxLmRlZmF1bHQgPSBFQ0I7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX3ZhbHVlcyQ0ID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFZlcnNpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBCaXRNYXRyaXhfMSQzID0gQml0TWF0cml4JDE7Cgl2YXIgRm9ybWF0SW5mb3JtYXRpb25fMSQxID0gRm9ybWF0SW5mb3JtYXRpb24kMTsKCXZhciBFQ0Jsb2Nrc18xID0gRUNCbG9ja3MkMTsKCXZhciBFQ0JfMSA9IEVDQiQxOwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xJDIgPSBGb3JtYXRFeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQyID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7CgkvKioKCSAqIFNlZSBJU08gMTgwMDQ6MjAwNiBBbm5leCBECgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFZlcnNpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gVmVyc2lvbih2ZXJzaW9uTnVtYmVyIC8qaW50Ki8sIGFsaWdubWVudFBhdHRlcm5DZW50ZXJzKSB7CgkgICAgICAgIHZhciBlXzEsIF9hOwoJICAgICAgICB2YXIgZWNCbG9ja3MgPSBbXTsKCSAgICAgICAgZm9yICh2YXIgX2kgPSAyOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgIGVjQmxvY2tzW19pIC0gMl0gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMudmVyc2lvbk51bWJlciA9IHZlcnNpb25OdW1iZXI7CgkgICAgICAgIHRoaXMuYWxpZ25tZW50UGF0dGVybkNlbnRlcnMgPSBhbGlnbm1lbnRQYXR0ZXJuQ2VudGVyczsKCSAgICAgICAgdGhpcy5lY0Jsb2NrcyA9IGVjQmxvY2tzOwoJICAgICAgICB2YXIgdG90YWwgPSAwOwoJICAgICAgICB2YXIgZWNDb2Rld29yZHMgPSBlY0Jsb2Nrc1swXS5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCk7CgkgICAgICAgIHZhciBlY2JBcnJheSA9IGVjQmxvY2tzWzBdLmdldEVDQmxvY2tzKCk7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICBmb3IgKHZhciBlY2JBcnJheV8xID0gX192YWx1ZXMkNChlY2JBcnJheSksIGVjYkFycmF5XzFfMSA9IGVjYkFycmF5XzEubmV4dCgpOyAhZWNiQXJyYXlfMV8xLmRvbmU7IGVjYkFycmF5XzFfMSA9IGVjYkFycmF5XzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGVjQmxvY2sgPSBlY2JBcnJheV8xXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgdG90YWwgKz0gZWNCbG9jay5nZXRDb3VudCgpICogKGVjQmxvY2suZ2V0RGF0YUNvZGV3b3JkcygpICsgZWNDb2Rld29yZHMpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzFfMSkgeyBlXzEgPSB7IGVycm9yOiBlXzFfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoZWNiQXJyYXlfMV8xICYmICFlY2JBcnJheV8xXzEuZG9uZSAmJiAoX2EgPSBlY2JBcnJheV8xLnJldHVybikpIF9hLmNhbGwoZWNiQXJyYXlfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy50b3RhbENvZGV3b3JkcyA9IHRvdGFsOwoJICAgIH0KCSAgICBWZXJzaW9uLnByb3RvdHlwZS5nZXRWZXJzaW9uTnVtYmVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52ZXJzaW9uTnVtYmVyOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0QWxpZ25tZW50UGF0dGVybkNlbnRlcnMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0VG90YWxDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnRvdGFsQ29kZXdvcmRzOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0RGltZW5zaW9uRm9yVmVyc2lvbiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDE3ICsgNCAqIHRoaXMudmVyc2lvbk51bWJlcjsKCSAgICB9OwoJICAgIFZlcnNpb24ucHJvdG90eXBlLmdldEVDQmxvY2tzRm9yTGV2ZWwgPSBmdW5jdGlvbiAoZWNMZXZlbCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lY0Jsb2Nrc1tlY0xldmVsLmdldFZhbHVlKCldOwoJICAgICAgICAvLyBUWVBFU0NSSVBUUE9SVDogb3JpZ2luYWwgd2FzIHVzaW5nIG9yZGluYWwsIGFuZCB1c2luZyB0aGUgb3JkZXIgb2YgbGV2ZWxzIGFzIGRlZmluZWQgaW4gRXJyb3JDb3JyZWN0aW9uTGV2ZWwgZW51bSAoTE1RSCkKCSAgICAgICAgLy8gSSB3aWxsIHVzZSB0aGUgZGlyZWN0IHZhbHVlIGZyb20gRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXMgZW51bSB3aGljaCBpbiB0eXBlc2NyaXB0IGdvZXMgdG8gYSBudW1iZXIKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkRlZHVjZXMgdmVyc2lvbiBpbmZvcm1hdGlvbiBwdXJlbHkgZnJvbSBRUiBDb2RlIGRpbWVuc2lvbnMuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGRpbWVuc2lvbiBkaW1lbnNpb24gaW4gbW9kdWxlcwoJICAgICAqIEByZXR1cm4gVmVyc2lvbiBmb3IgYSBRUiBDb2RlIG9mIHRoYXQgZGltZW5zaW9uCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgZGltZW5zaW9uIGlzIG5vdCAxIG1vZCA0CgkgICAgICovCgkgICAgVmVyc2lvbi5nZXRQcm92aXNpb25hbFZlcnNpb25Gb3JEaW1lbnNpb24gPSBmdW5jdGlvbiAoZGltZW5zaW9uIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGRpbWVuc2lvbiAlIDQgIT09IDEpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMSQyLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmVyc2lvbkZvck51bWJlcigoZGltZW5zaW9uIC0gMTcpIC8gNCk7CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlnbm9yZWQgLyo6IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEkMi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFZlcnNpb24uZ2V0VmVyc2lvbkZvck51bWJlciA9IGZ1bmN0aW9uICh2ZXJzaW9uTnVtYmVyIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKHZlcnNpb25OdW1iZXIgPCAxIHx8IHZlcnNpb25OdW1iZXIgPiA0MCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDIuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBWZXJzaW9uLlZFUlNJT05TW3ZlcnNpb25OdW1iZXIgLSAxXTsKCSAgICB9OwoJICAgIFZlcnNpb24uZGVjb2RlVmVyc2lvbkluZm9ybWF0aW9uID0gZnVuY3Rpb24gKHZlcnNpb25CaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGJlc3REaWZmZXJlbmNlID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgICAgIHZhciBiZXN0VmVyc2lvbiA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgVmVyc2lvbi5WRVJTSU9OX0RFQ09ERV9JTkZPLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgdGFyZ2V0VmVyc2lvbiA9IFZlcnNpb24uVkVSU0lPTl9ERUNPREVfSU5GT1tpXTsKCSAgICAgICAgICAgIC8vIERvIHRoZSB2ZXJzaW9uIGluZm8gYml0cyBtYXRjaCBleGFjdGx5PyBkb25lLgoJICAgICAgICAgICAgaWYgKHRhcmdldFZlcnNpb24gPT09IHZlcnNpb25CaXRzKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIFZlcnNpb24uZ2V0VmVyc2lvbkZvck51bWJlcihpICsgNyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBPdGhlcndpc2Ugc2VlIGlmIHRoaXMgaXMgdGhlIGNsb3Nlc3QgdG8gYSByZWFsIHZlcnNpb24gaW5mbyBiaXQgc3RyaW5nCgkgICAgICAgICAgICAvLyB3ZSBoYXZlIHNlZW4gc28gZmFyCgkgICAgICAgICAgICB2YXIgYml0c0RpZmZlcmVuY2UgPSBGb3JtYXRJbmZvcm1hdGlvbl8xJDEuZGVmYXVsdC5udW1CaXRzRGlmZmVyaW5nKHZlcnNpb25CaXRzLCB0YXJnZXRWZXJzaW9uKTsKCSAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgYmVzdFZlcnNpb24gPSBpICsgNzsKCSAgICAgICAgICAgICAgICBiZXN0RGlmZmVyZW5jZSA9IGJpdHNEaWZmZXJlbmNlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIFdlIGNhbiB0b2xlcmF0ZSB1cCB0byAzIGJpdHMgb2YgZXJyb3Igc2luY2Ugbm8gdHdvIHZlcnNpb24gaW5mbyBjb2Rld29yZHMgd2lsbAoJICAgICAgICAvLyBkaWZmZXIgaW4gbGVzcyB0aGFuIDggYml0cy4KCSAgICAgICAgaWYgKGJlc3REaWZmZXJlbmNlIDw9IDMpIHsKCSAgICAgICAgICAgIHJldHVybiBWZXJzaW9uLmdldFZlcnNpb25Gb3JOdW1iZXIoYmVzdFZlcnNpb24pOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHdlIGRpZG4ndCBmaW5kIGEgY2xvc2UgZW5vdWdoIG1hdGNoLCBmYWlsCgkgICAgICAgIHJldHVybiBudWxsOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogU2VlIElTTyAxODAwNDoyMDA2IEFubmV4IEUKCSAgICAgKi8KCSAgICBWZXJzaW9uLnByb3RvdHlwZS5idWlsZEZ1bmN0aW9uUGF0dGVybiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuZ2V0RGltZW5zaW9uRm9yVmVyc2lvbigpOwoJICAgICAgICB2YXIgYml0TWF0cml4ID0gbmV3IEJpdE1hdHJpeF8xJDMuZGVmYXVsdChkaW1lbnNpb24pOwoJICAgICAgICAvLyBUb3AgbGVmdCBmaW5kZXIgcGF0dGVybiArIHNlcGFyYXRvciArIGZvcm1hdAoJICAgICAgICBiaXRNYXRyaXguc2V0UmVnaW9uKDAsIDAsIDksIDkpOwoJICAgICAgICAvLyBUb3AgcmlnaHQgZmluZGVyIHBhdHRlcm4gKyBzZXBhcmF0b3IgKyBmb3JtYXQKCSAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbihkaW1lbnNpb24gLSA4LCAwLCA4LCA5KTsKCSAgICAgICAgLy8gQm90dG9tIGxlZnQgZmluZGVyIHBhdHRlcm4gKyBzZXBhcmF0b3IgKyBmb3JtYXQKCSAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbigwLCBkaW1lbnNpb24gLSA4LCA5LCA4KTsKCSAgICAgICAgLy8gQWxpZ25tZW50IHBhdHRlcm5zCgkgICAgICAgIHZhciBtYXggPSB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBtYXg7IHgrKykgewoJICAgICAgICAgICAgdmFyIGkgPSB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzW3hdIC0gMjsKCSAgICAgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgbWF4OyB5KyspIHsKCSAgICAgICAgICAgICAgICBpZiAoKHggPT09IDAgJiYgKHkgPT09IDAgfHwgeSA9PT0gbWF4IC0gMSkpIHx8ICh4ID09PSBtYXggLSAxICYmIHkgPT09IDApKSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIE5vIGFsaWdubWVudCBwYXR0ZXJucyBuZWFyIHRoZSB0aHJlZSBmaW5kZXIgcGF0dGVybnMKCSAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24odGhpcy5hbGlnbm1lbnRQYXR0ZXJuQ2VudGVyc1t5XSAtIDIsIGksIDUsIDUpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIFZlcnRpY2FsIHRpbWluZyBwYXR0ZXJuCgkgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oNiwgOSwgMSwgZGltZW5zaW9uIC0gMTcpOwoJICAgICAgICAvLyBIb3Jpem9udGFsIHRpbWluZyBwYXR0ZXJuCgkgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oOSwgNiwgZGltZW5zaW9uIC0gMTcsIDEpOwoJICAgICAgICBpZiAodGhpcy52ZXJzaW9uTnVtYmVyID4gNikgewoJICAgICAgICAgICAgLy8gVmVyc2lvbiBpbmZvLCB0b3AgcmlnaHQKCSAgICAgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oZGltZW5zaW9uIC0gMTEsIDAsIDMsIDYpOwoJICAgICAgICAgICAgLy8gVmVyc2lvbiBpbmZvLCBib3R0b20gbGVmdAoJICAgICAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbigwLCBkaW1lbnNpb24gLSAxMSwgNiwgMyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdE1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBWZXJzaW9uLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICcnICsgdGhpcy52ZXJzaW9uTnVtYmVyOwoJICAgIH07CgkgICAgLyoqCgkgICAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYgQW5uZXggRC4KCSAgICAgICAqIEVsZW1lbnQgaSByZXByZXNlbnRzIHRoZSByYXcgdmVyc2lvbiBiaXRzIHRoYXQgc3BlY2lmeSB2ZXJzaW9uIGkgKyA3CgkgICAgICAgKi8KCSAgICBWZXJzaW9uLlZFUlNJT05fREVDT0RFX0lORk8gPSBJbnQzMkFycmF5LmZyb20oWwoJICAgICAgICAweDA3Qzk0LCAweDA4NUJDLCAweDA5QTk5LCAweDBBNEQzLCAweDBCQkY2LAoJICAgICAgICAweDBDNzYyLCAweDBEODQ3LCAweDBFNjBELCAweDBGOTI4LCAweDEwQjc4LAoJICAgICAgICAweDExNDVELCAweDEyQTE3LCAweDEzNTMyLCAweDE0OUE2LCAweDE1NjgzLAoJICAgICAgICAweDE2OEM5LCAweDE3N0VDLCAweDE4RUM0LCAweDE5MUUxLCAweDFBRkFCLAoJICAgICAgICAweDFCMDhFLCAweDFDQzFBLCAweDFEMzNGLCAweDFFRDc1LCAweDFGMjUwLAoJICAgICAgICAweDIwOUQ1LCAweDIxNkYwLCAweDIyOEJBLCAweDIzNzlGLCAweDI0QjBCLAoJICAgICAgICAweDI1NDJFLCAweDI2QTY0LCAweDI3NTQxLCAweDI4QzY5CgkgICAgXSk7CgkgICAgLyoqCgkgICAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYgNi41LjEgVGFibGUgOQoJICAgICAgICovCgkgICAgVmVyc2lvbi5WRVJTSU9OUyA9IFsKCSAgICAgICAgbmV3IFZlcnNpb24oMSwgbmV3IEludDMyQXJyYXkoMCksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoNywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxMCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxMywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxNywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgOSkpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMiwgSW50MzJBcnJheS5mcm9tKFs2LCAxOF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDEwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAzNCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE2LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAyOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAyMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMywgSW50MzJBcnJheS5mcm9tKFs2LCAyMl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE1LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA1NSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA0NCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oNCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA4MCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAyNCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA5KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbig1LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDEwOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCA0MykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExKSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTIpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDYsIEludDMyQXJyYXkuZnJvbShbNiwgMzRdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgNjgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDcsIEludDMyQXJyYXkuZnJvbShbNiwgMjIsIDM4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDc4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDMxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTMpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxNCkpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oOCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNCwgNDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgOTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMzgpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzOSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxOCksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE5KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDksIEludDMyQXJyYXkuZnJvbShbNiwgMjYsIDQ2XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCAzNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDM3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTAsIEludDMyQXJyYXkuZnJvbShbNiwgMjgsIDUwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDY4KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgNjkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDMpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA0NCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxOSksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDIwKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDExLCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIwLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA4MSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA1MCksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDUxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTIpLCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTIsIEludDMyQXJyYXkuZnJvbShbNiwgMzIsIDU4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDkyKSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgOTMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMzYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAyMCksIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDEzLCBJbnQzMkFycmF5LmZyb20oWzYsIDM0LCA2Ml0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMzcpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAzOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAyMCksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDEyLCAxMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDEyKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNDYsIDY2XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA0MCksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDQxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDE3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNSwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNDgsIDcwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDg3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgODgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgNDEpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCA0MikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNiwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTAsIDc0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDk4KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgOTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNywgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCA0NikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMTkpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAyMCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTcsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU0LCA3OF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxMDcpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAxMDgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjIpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDE4LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NiwgODJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgMTIwKSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDksIDQzKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxOSwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDE5LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1OCwgODZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTEzKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTE0KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDQ0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDQ1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDE3LCAyMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDksIDEzKSwgbmV3IEVDQl8xLmRlZmF1bHQoMTYsIDE0KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyMCwgSW50MzJBcnJheS5mcm9tKFs2LCAzNCwgNjIsIDkwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDEwNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDEwOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgzLCA0MSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCA0MikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDIxLCBJbnQzMkFycmF5LmZyb20oWzYsIDI4LCA1MCwgNzIsIDk0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgNDIpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDIyLCBJbnQzMkFycmF5LmZyb20oWzYsIDI2LCA1MCwgNzQsIDk4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDExMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNywgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNiwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMzQsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyMywgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTQsIDc4LCAxMDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIxKSwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgMTIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTQsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNiwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDI0LCBJbnQzMkFycmF5LmZyb20oWzYsIDI4LCA1NCwgODAsIDEwNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMTcpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMTgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTYsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMwLCAxNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE3KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyNSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMiwgNTgsIDg0LCAxMTBdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMTA2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTA3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDgsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjIsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMjYsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU4LCA4NiwgMTE0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAxMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxMTUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjgsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMzMsIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDI3LCBJbnQzMkFycmF5LmZyb20oWzYsIDM0LCA2MiwgOTAsIDExOF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAxMjIpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjIsIDQ1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMjMpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNiwgMjQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTIsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjgsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyOCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTAsIDc0LCA5OCwgMTIyXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDExNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAxMTgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgzMSwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzEsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyOSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTQsIDc4LCAxMDIsIDEyNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCAxMTYpLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCAxMTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjEsIDQ1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjMpLCBuZXcgRUNCXzEuZGVmYXVsdCgzNywgMjQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjYsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzMCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTIsIDc4LCAxMDQsIDEzMF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAxMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMTE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCA0NyksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCA0OCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNSwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjMsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjUsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzMSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTYsIDgyLCAxMDgsIDEzNF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxMywgMTE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjksIDQ3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQyLCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIzLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDI4LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzIsIEludDMyQXJyYXkuZnJvbShbNiwgMzQsIDYwLCA4NiwgMTEyLCAxMzhdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDExNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzUsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDM1LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzMsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU4LCA4NiwgMTE0LCAxNDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMSwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjksIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQ2LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzQsIEludDMyQXJyYXkuZnJvbShbNiwgMzQsIDYyLCA5MCwgMTE4LCAxNDZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNDQsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNywgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNTksIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDM1LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NCwgNzgsIDEwMiwgMTI2LCAxNTBdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTIsIDEyMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDEyMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxMiwgNDcpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNiwgNDgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMzksIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTQsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQxLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzYsIEludDMyQXJyYXkuZnJvbShbNiwgMjQsIDUwLCA3NiwgMTAyLCAxMjgsIDE1NF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMjEpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgMTIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzQsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQ2LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDY0LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzcsIEludDMyQXJyYXkuZnJvbShbNiwgMjgsIDU0LCA4MCwgMTA2LCAxMzIsIDE1OF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgMTIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIzKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDI5LCA0NiksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCA0NykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0OSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjQsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNDYsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzOCwgSW50MzJBcnJheS5mcm9tKFs2LCAzMiwgNTgsIDg0LCAxMTAsIDEzNiwgMTYyXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDEyMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDE4LCAxMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzIsIDQ3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQ4LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0MiwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgzMiwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDM5LCBJbnQzMkFycmF5LmZyb20oWzYsIDI2LCA1NCwgODIsIDExMCwgMTM4LCAxNjZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjAsIDExNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCg0MCwgNDcpLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCA0OCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0MywgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMiwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNjcsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbig0MCwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTgsIDg2LCAxMTQsIDE0MiwgMTcwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCAxMTgpLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTgsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzEsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDM0LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDM0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgyMCwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCg2MSwgMTYpKSkKCSAgICBdOwoJICAgIHJldHVybiBWZXJzaW9uOwoJfSgpKTsKCVZlcnNpb24kMS5kZWZhdWx0ID0gVmVyc2lvbjsKCgl2YXIgRGF0YU1hc2sgPSB7fTsKCgkoZnVuY3Rpb24gKGV4cG9ydHMpIHsKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJZXhwb3J0cy5EYXRhTWFza1ZhbHVlcyA9IHZvaWQgMDsKCXZhciBEYXRhTWFza1ZhbHVlczsKCShmdW5jdGlvbiAoRGF0YU1hc2tWYWx1ZXMpIHsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzAwMCJdID0gMF0gPSAiREFUQV9NQVNLXzAwMCI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18wMDEiXSA9IDFdID0gIkRBVEFfTUFTS18wMDEiOwoJICAgIERhdGFNYXNrVmFsdWVzW0RhdGFNYXNrVmFsdWVzWyJEQVRBX01BU0tfMDEwIl0gPSAyXSA9ICJEQVRBX01BU0tfMDEwIjsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzAxMSJdID0gM10gPSAiREFUQV9NQVNLXzAxMSI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18xMDAiXSA9IDRdID0gIkRBVEFfTUFTS18xMDAiOwoJICAgIERhdGFNYXNrVmFsdWVzW0RhdGFNYXNrVmFsdWVzWyJEQVRBX01BU0tfMTAxIl0gPSA1XSA9ICJEQVRBX01BU0tfMTAxIjsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzExMCJdID0gNl0gPSAiREFUQV9NQVNLXzExMCI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18xMTEiXSA9IDddID0gIkRBVEFfTUFTS18xMTEiOwoJfSkoRGF0YU1hc2tWYWx1ZXMgPSBleHBvcnRzLkRhdGFNYXNrVmFsdWVzIHx8IChleHBvcnRzLkRhdGFNYXNrVmFsdWVzID0ge30pKTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGRhdGEgbWFza3MgZm9yIHRoZSBkYXRhIGJpdHMgaW4gYSBRUiBjb2RlLCBwZXIgSVNPIDE4MDA0OjIwMDYgNi44LiBJbXBsZW1lbnRhdGlvbnMKCSAqIG9mIHRoaXMgY2xhc3MgY2FuIHVuLW1hc2sgYSByYXcgQml0TWF0cml4LiBGb3Igc2ltcGxpY2l0eSwgdGhleSB3aWxsIHVubWFzayB0aGUgZW50aXJlIEJpdE1hdHJpeCwKCSAqIGluY2x1ZGluZyBhcmVhcyB1c2VkIGZvciBmaW5kZXIgcGF0dGVybnMsIHRpbWluZyBwYXR0ZXJucywgZXRjLiBUaGVzZSBhcmVhcyBzaG91bGQgYmUgdW51c2VkCgkgKiBhZnRlciB0aGUgcG9pbnQgdGhleSBhcmUgdW5tYXNrZWQgYW55d2F5LjwvcD4KCSAqCgkgKiA8cD5Ob3RlIHRoYXQgdGhlIGRpYWdyYW0gaW4gc2VjdGlvbiA2LjguMSBpcyBtaXNsZWFkaW5nIHNpbmNlIGl0IGluZGljYXRlcyB0aGF0IGkgaXMgY29sdW1uIHBvc2l0aW9uCgkgKiBhbmQgaiBpcyByb3cgcG9zaXRpb24uIEluIGZhY3QsIGFzIHRoZSB0ZXh0IHNheXMsIGkgaXMgcm93IHBvc2l0aW9uIGFuZCBqIGlzIGNvbHVtbiBwb3NpdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERhdGFNYXNrID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8vIFNlZSBJU08gMTgwMDQ6MjAwNiA2LjguMQoJICAgIGZ1bmN0aW9uIERhdGFNYXNrKHZhbHVlLCBpc01hc2tlZCkgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuaXNNYXNrZWQgPSBpc01hc2tlZDsKCSAgICB9CgkgICAgLy8gRW5kIG9mIGVudW0gY29uc3RhbnRzLgoJICAgIC8qKgoJICAgICAqIDxwPkltcGxlbWVudGF0aW9ucyBvZiB0aGlzIG1ldGhvZCByZXZlcnNlIHRoZSBkYXRhIG1hc2tpbmcgcHJvY2VzcyBhcHBsaWVkIHRvIGEgUVIgQ29kZSBhbmQKCSAgICAgKiBtYWtlIGl0cyBiaXRzIHJlYWR5IHRvIHJlYWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGJpdHMgcmVwcmVzZW50YXRpb24gb2YgUVIgQ29kZSBiaXRzCgkgICAgICogQHBhcmFtIGRpbWVuc2lvbiBkaW1lbnNpb24gb2YgUVIgQ29kZSwgcmVwcmVzZW50ZWQgYnkgYml0cywgYmVpbmcgdW5tYXNrZWQKCSAgICAgKi8KCSAgICBEYXRhTWFzay5wcm90b3R5cGUudW5tYXNrQml0TWF0cml4ID0gZnVuY3Rpb24gKGJpdHMsIGRpbWVuc2lvbiAvKmludCovKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGltZW5zaW9uOyBpKyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgZGltZW5zaW9uOyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5pc01hc2tlZChpLCBqKSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLmZsaXAoaiwgaSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBEYXRhTWFzay52YWx1ZXMgPSBuZXcgTWFwKFsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIDAwMDogbWFzayBiaXRzIGZvciB3aGljaCAoeCArIHkpIG1vZCAyID09IDAKCSAgICAgICAgICovCgkgICAgICAgIFtEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMDAwLCBuZXcgRGF0YU1hc2soRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAwMCwgZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovKSB7IHJldHVybiAoKGkgKyBqKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAwMDE6IG1hc2sgYml0cyBmb3Igd2hpY2ggeCBtb2QgMiA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAwMSwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMDEsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKGkgJiAweDAxKSA9PT0gMDsgfSldLAoJICAgICAgICAvKioKCSAgICAgICAgICogMDEwOiBtYXNrIGJpdHMgZm9yIHdoaWNoIHkgbW9kIDMgPT0gMAoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMTAsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMDEwLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuIGogJSAzID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAwMTE6IG1hc2sgYml0cyBmb3Igd2hpY2ggKHggKyB5KSBtb2QgMyA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAxMSwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMTEsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKGkgKyBqKSAlIDMgPT09IDA7IH0pXSwKCSAgICAgICAgLyoqCgkgICAgICAgICAqIDEwMDogbWFzayBiaXRzIGZvciB3aGljaCAoeC8yICsgeS8zKSBtb2QgMiA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzEwMCwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMDAsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKChNYXRoLmZsb29yKGkgLyAyKSArIE1hdGguZmxvb3IoaiAvIDMpKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAxMDE6IG1hc2sgYml0cyBmb3Igd2hpY2ggeHkgbW9kIDIgKyB4eSBtb2QgMyA9PSAwCgkgICAgICAgICAqIGVxdWl2YWxlbnRseSwgc3VjaCB0aGF0IHh5IG1vZCA2ID09IDAKCSAgICAgICAgICovCgkgICAgICAgIFtEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTAxLCBuZXcgRGF0YU1hc2soRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzEwMSwgZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovKSB7IHJldHVybiAoaSAqIGopICUgNiA9PT0gMDsgfSldLAoJICAgICAgICAvKioKCSAgICAgICAgICogMTEwOiBtYXNrIGJpdHMgZm9yIHdoaWNoICh4eSBtb2QgMiArIHh5IG1vZCAzKSBtb2QgMiA9PSAwCgkgICAgICAgICAqIGVxdWl2YWxlbnRseSwgc3VjaCB0aGF0IHh5IG1vZCA2IDwgMwoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMTAsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTEwLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuICgoaSAqIGopICUgNikgPCAzOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAxMTE6IG1hc2sgYml0cyBmb3Igd2hpY2ggKCh4K3kpbW9kIDIgKyB4eSBtb2QgMykgbW9kIDIgPT0gMAoJICAgICAgICAgKiBlcXVpdmFsZW50bHksIHN1Y2ggdGhhdCAoeCArIHkgKyB4eSBtb2QgMykgbW9kIDIgPT0gMAoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMTEsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTExLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuICgoaSArIGogKyAoKGkgKiBqKSAlIDMpKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgXSk7CgkgICAgcmV0dXJuIERhdGFNYXNrOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IERhdGFNYXNrOwoKCX0oRGF0YU1hc2spKTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdE1hdHJpeFBhcnNlciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgVmVyc2lvbl8xJDEgPSBWZXJzaW9uJDE7Cgl2YXIgRm9ybWF0SW5mb3JtYXRpb25fMSA9IEZvcm1hdEluZm9ybWF0aW9uJDE7Cgl2YXIgRGF0YU1hc2tfMSA9IERhdGFNYXNrOwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xJDEgPSBGb3JtYXRFeGNlcHRpb24kMTsKCS8qKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEJpdE1hdHJpeFBhcnNlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYml0TWF0cml4IHtAbGluayBCaXRNYXRyaXh9IHRvIHBhcnNlCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgZGltZW5zaW9uIGlzIG5vdCA+PSAyMSBhbmQgMSBtb2QgNAoJICAgICAqLwoJICAgIGZ1bmN0aW9uIEJpdE1hdHJpeFBhcnNlcihiaXRNYXRyaXgpIHsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IGJpdE1hdHJpeC5nZXRIZWlnaHQoKTsKCSAgICAgICAgaWYgKGRpbWVuc2lvbiA8IDIxIHx8IChkaW1lbnNpb24gJiAweDAzKSAhPT0gMSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0TWF0cml4ID0gYml0TWF0cml4OwoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5SZWFkcyBmb3JtYXQgaW5mb3JtYXRpb24gZnJvbSBvbmUgb2YgaXRzIHR3byBsb2NhdGlvbnMgd2l0aGluIHRoZSBRUiBDb2RlLjwvcD4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEZvcm1hdEluZm9ybWF0aW9ufSBlbmNhcHN1bGF0aW5nIHRoZSBRUiBDb2RlJ3MgZm9ybWF0IGluZm8KCSAgICAgKiBAdGhyb3dzIEZvcm1hdEV4Y2VwdGlvbiBpZiBib3RoIGZvcm1hdCBpbmZvcm1hdGlvbiBsb2NhdGlvbnMgY2Fubm90IGJlIHBhcnNlZCBhcwoJICAgICAqIHRoZSB2YWxpZCBlbmNvZGluZyBvZiBmb3JtYXQgaW5mb3JtYXRpb24KCSAgICAgKi8KCSAgICBCaXRNYXRyaXhQYXJzZXIucHJvdG90eXBlLnJlYWRGb3JtYXRJbmZvcm1hdGlvbiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgaWYgKHRoaXMucGFyc2VkRm9ybWF0SW5mbyAhPT0gbnVsbCAmJiB0aGlzLnBhcnNlZEZvcm1hdEluZm8gIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VkRm9ybWF0SW5mbzsKCSAgICAgICAgfQoJICAgICAgICAvLyBSZWFkIHRvcC1sZWZ0IGZvcm1hdCBpbmZvIGJpdHMKCSAgICAgICAgdmFyIGZvcm1hdEluZm9CaXRzMSA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNjsgaSsrKSB7CgkgICAgICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoaSwgOCwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgfQoJICAgICAgICAvLyAuLiBhbmQgc2tpcCBhIGJpdCBpbiB0aGUgdGltaW5nIHBhdHRlcm4gLi4uCgkgICAgICAgIGZvcm1hdEluZm9CaXRzMSA9IHRoaXMuY29weUJpdCg3LCA4LCBmb3JtYXRJbmZvQml0czEpOwoJICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoOCwgOCwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgZm9ybWF0SW5mb0JpdHMxID0gdGhpcy5jb3B5Qml0KDgsIDcsIGZvcm1hdEluZm9CaXRzMSk7CgkgICAgICAgIC8vIC4uIGFuZCBza2lwIGEgYml0IGluIHRoZSB0aW1pbmcgcGF0dGVybiAuLi4KCSAgICAgICAgZm9yICh2YXIgaiA9IDU7IGogPj0gMDsgai0tKSB7CgkgICAgICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoOCwgaiwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBSZWFkIHRoZSB0b3AtcmlnaHQvYm90dG9tLWxlZnQgcGF0dGVybiB0b28KCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgZm9ybWF0SW5mb0JpdHMyID0gMDsKCSAgICAgICAgdmFyIGpNaW4gPSBkaW1lbnNpb24gLSA3OwoJICAgICAgICBmb3IgKHZhciBqID0gZGltZW5zaW9uIC0gMTsgaiA+PSBqTWluOyBqLS0pIHsKCSAgICAgICAgICAgIGZvcm1hdEluZm9CaXRzMiA9IHRoaXMuY29weUJpdCg4LCBqLCBmb3JtYXRJbmZvQml0czIpOwoJICAgICAgICB9CgkgICAgICAgIGZvciAodmFyIGkgPSBkaW1lbnNpb24gLSA4OyBpIDwgZGltZW5zaW9uOyBpKyspIHsKCSAgICAgICAgICAgIGZvcm1hdEluZm9CaXRzMiA9IHRoaXMuY29weUJpdChpLCA4LCBmb3JtYXRJbmZvQml0czIpOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMucGFyc2VkRm9ybWF0SW5mbyA9IEZvcm1hdEluZm9ybWF0aW9uXzEuZGVmYXVsdC5kZWNvZGVGb3JtYXRJbmZvcm1hdGlvbihmb3JtYXRJbmZvQml0czEsIGZvcm1hdEluZm9CaXRzMik7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZEZvcm1hdEluZm8gIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlZEZvcm1hdEluZm87CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+UmVhZHMgdmVyc2lvbiBpbmZvcm1hdGlvbiBmcm9tIG9uZSBvZiBpdHMgdHdvIGxvY2F0aW9ucyB3aXRoaW4gdGhlIFFSIENvZGUuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiB7QGxpbmsgVmVyc2lvbn0gZW5jYXBzdWxhdGluZyB0aGUgUVIgQ29kZSdzIHZlcnNpb24KCSAgICAgKiBAdGhyb3dzIEZvcm1hdEV4Y2VwdGlvbiBpZiBib3RoIHZlcnNpb24gaW5mb3JtYXRpb24gbG9jYXRpb25zIGNhbm5vdCBiZSBwYXJzZWQgYXMKCSAgICAgKiB0aGUgdmFsaWQgZW5jb2Rpbmcgb2YgdmVyc2lvbiBpbmZvcm1hdGlvbgoJICAgICAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUucmVhZFZlcnNpb24gPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZFZlcnNpb24gIT09IG51bGwgJiYgdGhpcy5wYXJzZWRWZXJzaW9uICE9PSB1bmRlZmluZWQpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgcHJvdmlzaW9uYWxWZXJzaW9uID0gTWF0aC5mbG9vcigoZGltZW5zaW9uIC0gMTcpIC8gNCk7CgkgICAgICAgIGlmIChwcm92aXNpb25hbFZlcnNpb24gPD0gNikgewoJICAgICAgICAgICAgcmV0dXJuIFZlcnNpb25fMSQxLmRlZmF1bHQuZ2V0VmVyc2lvbkZvck51bWJlcihwcm92aXNpb25hbFZlcnNpb24pOwoJICAgICAgICB9CgkgICAgICAgIC8vIFJlYWQgdG9wLXJpZ2h0IHZlcnNpb24gaW5mbzogMyB3aWRlIGJ5IDYgdGFsbAoJICAgICAgICB2YXIgdmVyc2lvbkJpdHMgPSAwOwoJICAgICAgICB2YXIgaWpNaW4gPSBkaW1lbnNpb24gLSAxMTsKCSAgICAgICAgZm9yICh2YXIgaiA9IDU7IGogPj0gMDsgai0tKSB7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gZGltZW5zaW9uIC0gOTsgaSA+PSBpak1pbjsgaS0tKSB7CgkgICAgICAgICAgICAgICAgdmVyc2lvbkJpdHMgPSB0aGlzLmNvcHlCaXQoaSwgaiwgdmVyc2lvbkJpdHMpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciB0aGVQYXJzZWRWZXJzaW9uID0gVmVyc2lvbl8xJDEuZGVmYXVsdC5kZWNvZGVWZXJzaW9uSW5mb3JtYXRpb24odmVyc2lvbkJpdHMpOwoJICAgICAgICBpZiAodGhlUGFyc2VkVmVyc2lvbiAhPT0gbnVsbCAmJiB0aGVQYXJzZWRWZXJzaW9uLmdldERpbWVuc2lvbkZvclZlcnNpb24oKSA9PT0gZGltZW5zaW9uKSB7CgkgICAgICAgICAgICB0aGlzLnBhcnNlZFZlcnNpb24gPSB0aGVQYXJzZWRWZXJzaW9uOwoJICAgICAgICAgICAgcmV0dXJuIHRoZVBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgLy8gSG1tLCBmYWlsZWQuIFRyeSBib3R0b20gbGVmdDogNiB3aWRlIGJ5IDMgdGFsbAoJICAgICAgICB2ZXJzaW9uQml0cyA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSA1OyBpID49IDA7IGktLSkgewoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IGRpbWVuc2lvbiAtIDk7IGogPj0gaWpNaW47IGotLSkgewoJICAgICAgICAgICAgICAgIHZlcnNpb25CaXRzID0gdGhpcy5jb3B5Qml0KGksIGosIHZlcnNpb25CaXRzKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICB0aGVQYXJzZWRWZXJzaW9uID0gVmVyc2lvbl8xJDEuZGVmYXVsdC5kZWNvZGVWZXJzaW9uSW5mb3JtYXRpb24odmVyc2lvbkJpdHMpOwoJICAgICAgICBpZiAodGhlUGFyc2VkVmVyc2lvbiAhPT0gbnVsbCAmJiB0aGVQYXJzZWRWZXJzaW9uLmdldERpbWVuc2lvbkZvclZlcnNpb24oKSA9PT0gZGltZW5zaW9uKSB7CgkgICAgICAgICAgICB0aGlzLnBhcnNlZFZlcnNpb24gPSB0aGVQYXJzZWRWZXJzaW9uOwoJICAgICAgICAgICAgcmV0dXJuIHRoZVBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgQml0TWF0cml4UGFyc2VyLnByb3RvdHlwZS5jb3B5Qml0ID0gZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovLCB2ZXJzaW9uQml0cyAvKmludCovKSB7CgkgICAgICAgIHZhciBiaXQgPSB0aGlzLmlzTWlycm9yID8gdGhpcy5iaXRNYXRyaXguZ2V0KGosIGkpIDogdGhpcy5iaXRNYXRyaXguZ2V0KGksIGopOwoJICAgICAgICByZXR1cm4gYml0ID8gKHZlcnNpb25CaXRzIDw8IDEpIHwgMHgxIDogdmVyc2lvbkJpdHMgPDwgMTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlJlYWRzIHRoZSBiaXRzIGluIHRoZSB7QGxpbmsgQml0TWF0cml4fSByZXByZXNlbnRpbmcgdGhlIGZpbmRlciBwYXR0ZXJuIGluIHRoZQoJICAgICAqIGNvcnJlY3Qgb3JkZXIgaW4gb3JkZXIgdG8gcmVjb25zdHJ1Y3QgdGhlIGNvZGV3b3JkcyBieXRlcyBjb250YWluZWQgd2l0aGluIHRoZQoJICAgICAqIFFSIENvZGUuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiBieXRlcyBlbmNvZGVkIHdpdGhpbiB0aGUgUVIgQ29kZQoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIHRoZSBleGFjdCBudW1iZXIgb2YgYnl0ZXMgZXhwZWN0ZWQgaXMgbm90IHJlYWQKCSAgICAgKi8KCSAgICBCaXRNYXRyaXhQYXJzZXIucHJvdG90eXBlLnJlYWRDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBmb3JtYXRJbmZvID0gdGhpcy5yZWFkRm9ybWF0SW5mb3JtYXRpb24oKTsKCSAgICAgICAgdmFyIHZlcnNpb24gPSB0aGlzLnJlYWRWZXJzaW9uKCk7CgkgICAgICAgIC8vIEdldCB0aGUgZGF0YSBtYXNrIGZvciB0aGUgZm9ybWF0IHVzZWQgaW4gdGhpcyBRUiBDb2RlLiBUaGlzIHdpbGwgZXhjbHVkZQoJICAgICAgICAvLyBzb21lIGJpdHMgZnJvbSByZWFkaW5nIGFzIHdlIHdpbmQgdGhyb3VnaCB0aGUgYml0IG1hdHJpeC4KCSAgICAgICAgdmFyIGRhdGFNYXNrID0gRGF0YU1hc2tfMS5kZWZhdWx0LnZhbHVlcy5nZXQoZm9ybWF0SW5mby5nZXREYXRhTWFzaygpKTsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICBkYXRhTWFzay51bm1hc2tCaXRNYXRyaXgodGhpcy5iaXRNYXRyaXgsIGRpbWVuc2lvbik7CgkgICAgICAgIHZhciBmdW5jdGlvblBhdHRlcm4gPSB2ZXJzaW9uLmJ1aWxkRnVuY3Rpb25QYXR0ZXJuKCk7CgkgICAgICAgIHZhciByZWFkaW5nVXAgPSB0cnVlOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkodmVyc2lvbi5nZXRUb3RhbENvZGV3b3JkcygpKTsKCSAgICAgICAgdmFyIHJlc3VsdE9mZnNldCA9IDA7CgkgICAgICAgIHZhciBjdXJyZW50Qnl0ZSA9IDA7CgkgICAgICAgIHZhciBiaXRzUmVhZCA9IDA7CgkgICAgICAgIC8vIFJlYWQgY29sdW1ucyBpbiBwYWlycywgZnJvbSByaWdodCB0byBsZWZ0CgkgICAgICAgIGZvciAodmFyIGogPSBkaW1lbnNpb24gLSAxOyBqID4gMDsgaiAtPSAyKSB7CgkgICAgICAgICAgICBpZiAoaiA9PT0gNikgewoJICAgICAgICAgICAgICAgIC8vIFNraXAgd2hvbGUgY29sdW1uIHdpdGggdmVydGljYWwgYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgICAgICAgICAgICAvLyBzYXZlcyB0aW1lIGFuZCBtYWtlcyB0aGUgb3RoZXIgY29kZSBwcm9jZWVkIG1vcmUgY2xlYW5seQoJICAgICAgICAgICAgICAgIGotLTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIFJlYWQgYWx0ZXJuYXRpbmdseSBmcm9tIGJvdHRvbSB0byB0b3AgdGhlbiB0b3AgdG8gYm90dG9tCgkgICAgICAgICAgICBmb3IgKHZhciBjb3VudCA9IDA7IGNvdW50IDwgZGltZW5zaW9uOyBjb3VudCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGkgPSByZWFkaW5nVXAgPyBkaW1lbnNpb24gLSAxIC0gY291bnQgOiBjb3VudDsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCAyOyBjb2wrKykgewoJICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgYml0cyBjb3ZlcmVkIGJ5IHRoZSBmdW5jdGlvbiBwYXR0ZXJuCgkgICAgICAgICAgICAgICAgICAgIGlmICghZnVuY3Rpb25QYXR0ZXJuLmdldChqIC0gY29sLCBpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVhZCBhIGJpdAoJICAgICAgICAgICAgICAgICAgICAgICAgYml0c1JlYWQrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCeXRlIDw8PSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYml0TWF0cml4LmdldChqIC0gY29sLCBpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCeXRlIHw9IDE7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB3ZSd2ZSBtYWRlIGEgd2hvbGUgYnl0ZSwgc2F2ZSBpdCBvZmYKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiaXRzUmVhZCA9PT0gOCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRPZmZzZXQrK10gPSAvKihieXRlKSAqLyBjdXJyZW50Qnl0ZTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaXRzUmVhZCA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEJ5dGUgPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVhZGluZ1VwID0gIXJlYWRpbmdVcDsgLy8gcmVhZGluZ1VwIF49IHRydWU7IC8vIHJlYWRpbmdVcCA9ICFyZWFkaW5nVXA7IC8vIHN3aXRjaCBkaXJlY3Rpb25zCgkgICAgICAgIH0KCSAgICAgICAgaWYgKHJlc3VsdE9mZnNldCAhPT0gdmVyc2lvbi5nZXRUb3RhbENvZGV3b3JkcygpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEkMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldmVydCB0aGUgbWFzayByZW1vdmFsIGRvbmUgd2hpbGUgcmVhZGluZyB0aGUgY29kZSB3b3Jkcy4gVGhlIGJpdCBtYXRyaXggc2hvdWxkIHJldmVydCB0byBpdHMgb3JpZ2luYWwgc3RhdGUuCgkgICAgICovCgkgICAgQml0TWF0cml4UGFyc2VyLnByb3RvdHlwZS5yZW1hc2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZEZvcm1hdEluZm8gPT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybjsgLy8gV2UgaGF2ZSBubyBmb3JtYXQgaW5mb3JtYXRpb24sIGFuZCBoYXZlIG5vIGRhdGEgbWFzawoJICAgICAgICB9CgkgICAgICAgIHZhciBkYXRhTWFzayA9IERhdGFNYXNrXzEuZGVmYXVsdC52YWx1ZXNbdGhpcy5wYXJzZWRGb3JtYXRJbmZvLmdldERhdGFNYXNrKCldOwoJICAgICAgICB2YXIgZGltZW5zaW9uID0gdGhpcy5iaXRNYXRyaXguZ2V0SGVpZ2h0KCk7CgkgICAgICAgIGRhdGFNYXNrLnVubWFza0JpdE1hdHJpeCh0aGlzLmJpdE1hdHJpeCwgZGltZW5zaW9uKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFByZXBhcmUgdGhlIHBhcnNlciBmb3IgYSBtaXJyb3JlZCBvcGVyYXRpb24uCgkgICAgICogVGhpcyBmbGFnIGhhcyBlZmZlY3Qgb25seSBvbiB0aGUge0BsaW5rICNyZWFkRm9ybWF0SW5mb3JtYXRpb24oKX0gYW5kIHRoZQoJICAgICAqIHtAbGluayAjcmVhZFZlcnNpb24oKX0uIEJlZm9yZSBwcm9jZWVkaW5nIHdpdGgge0BsaW5rICNyZWFkQ29kZXdvcmRzKCl9IHRoZQoJICAgICAqIHtAbGluayAjbWlycm9yKCl9IG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkLgoJICAgICAqCgkgICAgICogQHBhcmFtIG1pcnJvciBXaGV0aGVyIHRvIHJlYWQgdmVyc2lvbiBhbmQgZm9ybWF0IGluZm9ybWF0aW9uIG1pcnJvcmVkLgoJICAgICAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUuc2V0TWlycm9yID0gZnVuY3Rpb24gKGlzTWlycm9yKSB7CgkgICAgICAgIHRoaXMucGFyc2VkVmVyc2lvbiA9IG51bGw7CgkgICAgICAgIHRoaXMucGFyc2VkRm9ybWF0SW5mbyA9IG51bGw7CgkgICAgICAgIHRoaXMuaXNNaXJyb3IgPSBpc01pcnJvcjsKCSAgICB9OwoJICAgIC8qKiBNaXJyb3IgdGhlIGJpdCBtYXRyaXggaW4gb3JkZXIgdG8gYXR0ZW1wdCBhIHNlY29uZCByZWFkaW5nLiAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUubWlycm9yID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgYml0TWF0cml4ID0gdGhpcy5iaXRNYXRyaXg7CgkgICAgICAgIGZvciAodmFyIHggPSAwLCB3aWR0aCA9IGJpdE1hdHJpeC5nZXRXaWR0aCgpOyB4IDwgd2lkdGg7IHgrKykgewoJICAgICAgICAgICAgZm9yICh2YXIgeSA9IHggKyAxLCBoZWlnaHQgPSBiaXRNYXRyaXguZ2V0SGVpZ2h0KCk7IHkgPCBoZWlnaHQ7IHkrKykgewoJICAgICAgICAgICAgICAgIGlmIChiaXRNYXRyaXguZ2V0KHgsIHkpICE9PSBiaXRNYXRyaXguZ2V0KHksIHgpKSB7CgkgICAgICAgICAgICAgICAgICAgIGJpdE1hdHJpeC5mbGlwKHksIHgpOwoJICAgICAgICAgICAgICAgICAgICBiaXRNYXRyaXguZmxpcCh4LCB5KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHJldHVybiBCaXRNYXRyaXhQYXJzZXI7Cgl9KCkpOwoJQml0TWF0cml4UGFyc2VyJDEuZGVmYXVsdCA9IEJpdE1hdHJpeFBhcnNlcjsKCgl2YXIgRGF0YUJsb2NrJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDMgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGF0YUJsb2NrJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQxID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIGJsb2NrIG9mIGRhdGEgd2l0aGluIGEgUVIgQ29kZS4gUVIgQ29kZXMgbWF5IHNwbGl0IHRoZWlyIGRhdGEgaW50bwoJICogbXVsdGlwbGUgYmxvY2tzLCBlYWNoIG9mIHdoaWNoIGlzIGEgdW5pdCBvZiBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3Jkcy4gRWFjaAoJICogaXMgcmVwcmVzZW50ZWQgYnkgYW4gaW5zdGFuY2Ugb2YgdGhpcyBjbGFzcy48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERhdGFCbG9jayA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBEYXRhQmxvY2sobnVtRGF0YUNvZGV3b3JkcyAvKmludCovLCBjb2Rld29yZHMpIHsKCSAgICAgICAgdGhpcy5udW1EYXRhQ29kZXdvcmRzID0gbnVtRGF0YUNvZGV3b3JkczsKCSAgICAgICAgdGhpcy5jb2Rld29yZHMgPSBjb2Rld29yZHM7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIDxwPldoZW4gUVIgQ29kZXMgdXNlIG11bHRpcGxlIGRhdGEgYmxvY2tzLCB0aGV5IGFyZSBhY3R1YWxseSBpbnRlcmxlYXZlZC4KCSAgICAgKiBUaGF0IGlzLCB0aGUgZmlyc3QgYnl0ZSBvZiBkYXRhIGJsb2NrIDEgdG8gbiBpcyB3cml0dGVuLCB0aGVuIHRoZSBzZWNvbmQgYnl0ZXMsIGFuZCBzbyBvbi4gVGhpcwoJICAgICAqIG1ldGhvZCB3aWxsIHNlcGFyYXRlIHRoZSBkYXRhIGludG8gb3JpZ2luYWwgYmxvY2tzLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSByYXdDb2Rld29yZHMgYnl0ZXMgYXMgcmVhZCBkaXJlY3RseSBmcm9tIHRoZSBRUiBDb2RlCgkgICAgICogQHBhcmFtIHZlcnNpb24gdmVyc2lvbiBvZiB0aGUgUVIgQ29kZQoJICAgICAqIEBwYXJhbSBlY0xldmVsIGVycm9yLWNvcnJlY3Rpb24gbGV2ZWwgb2YgdGhlIFFSIENvZGUKCSAgICAgKiBAcmV0dXJuIERhdGFCbG9ja3MgY29udGFpbmluZyBvcmlnaW5hbCBieXRlcywgImRlLWludGVybGVhdmVkIiBmcm9tIHJlcHJlc2VudGF0aW9uIGluIHRoZQoJICAgICAqICAgICAgICAgUVIgQ29kZQoJICAgICAqLwoJICAgIERhdGFCbG9jay5nZXREYXRhQmxvY2tzID0gZnVuY3Rpb24gKHJhd0NvZGV3b3JkcywgdmVyc2lvbiwgZWNMZXZlbCkgewoJICAgICAgICB2YXIgZV8xLCBfYSwgZV8yLCBfYjsKCSAgICAgICAgaWYgKHJhd0NvZGV3b3Jkcy5sZW5ndGggIT09IHZlcnNpb24uZ2V0VG90YWxDb2Rld29yZHMoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEZpZ3VyZSBvdXQgdGhlIG51bWJlciBhbmQgc2l6ZSBvZiBkYXRhIGJsb2NrcyB1c2VkIGJ5IHRoaXMgdmVyc2lvbiBhbmQKCSAgICAgICAgLy8gZXJyb3IgY29ycmVjdGlvbiBsZXZlbAoJICAgICAgICB2YXIgZWNCbG9ja3MgPSB2ZXJzaW9uLmdldEVDQmxvY2tzRm9yTGV2ZWwoZWNMZXZlbCk7CgkgICAgICAgIC8vIEZpcnN0IGNvdW50IHRoZSB0b3RhbCBudW1iZXIgb2YgZGF0YSBibG9ja3MKCSAgICAgICAgdmFyIHRvdGFsQmxvY2tzID0gMDsKCSAgICAgICAgdmFyIGVjQmxvY2tBcnJheSA9IGVjQmxvY2tzLmdldEVDQmxvY2tzKCk7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICBmb3IgKHZhciBlY0Jsb2NrQXJyYXlfMSA9IF9fdmFsdWVzJDMoZWNCbG9ja0FycmF5KSwgZWNCbG9ja0FycmF5XzFfMSA9IGVjQmxvY2tBcnJheV8xLm5leHQoKTsgIWVjQmxvY2tBcnJheV8xXzEuZG9uZTsgZWNCbG9ja0FycmF5XzFfMSA9IGVjQmxvY2tBcnJheV8xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgIHZhciBlY0Jsb2NrID0gZWNCbG9ja0FycmF5XzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbEJsb2NrcyArPSBlY0Jsb2NrLmdldENvdW50KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChlY0Jsb2NrQXJyYXlfMV8xICYmICFlY0Jsb2NrQXJyYXlfMV8xLmRvbmUgJiYgKF9hID0gZWNCbG9ja0FycmF5XzEucmV0dXJuKSkgX2EuY2FsbChlY0Jsb2NrQXJyYXlfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTm93IGVzdGFibGlzaCBEYXRhQmxvY2tzIG9mIHRoZSBhcHByb3ByaWF0ZSBzaXplIGFuZCBudW1iZXIgb2YgZGF0YSBjb2Rld29yZHMKCSAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBBcnJheSh0b3RhbEJsb2Nrcyk7CgkgICAgICAgIHZhciBudW1SZXN1bHRCbG9ja3MgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgZWNCbG9ja0FycmF5XzIgPSBfX3ZhbHVlcyQzKGVjQmxvY2tBcnJheSksIGVjQmxvY2tBcnJheV8yXzEgPSBlY0Jsb2NrQXJyYXlfMi5uZXh0KCk7ICFlY0Jsb2NrQXJyYXlfMl8xLmRvbmU7IGVjQmxvY2tBcnJheV8yXzEgPSBlY0Jsb2NrQXJyYXlfMi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZWNCbG9jayA9IGVjQmxvY2tBcnJheV8yXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlY0Jsb2NrLmdldENvdW50KCk7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICB2YXIgbnVtRGF0YUNvZGV3b3JkcyA9IGVjQmxvY2suZ2V0RGF0YUNvZGV3b3JkcygpOwoJICAgICAgICAgICAgICAgICAgICB2YXIgbnVtQmxvY2tDb2Rld29yZHMgPSBlY0Jsb2Nrcy5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCkgKyBudW1EYXRhQ29kZXdvcmRzOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHRbbnVtUmVzdWx0QmxvY2tzKytdID0gbmV3IERhdGFCbG9jayhudW1EYXRhQ29kZXdvcmRzLCBuZXcgVWludDhBcnJheShudW1CbG9ja0NvZGV3b3JkcykpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8yXzEpIHsgZV8yID0geyBlcnJvcjogZV8yXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGVjQmxvY2tBcnJheV8yXzEgJiYgIWVjQmxvY2tBcnJheV8yXzEuZG9uZSAmJiAoX2IgPSBlY0Jsb2NrQXJyYXlfMi5yZXR1cm4pKSBfYi5jYWxsKGVjQmxvY2tBcnJheV8yKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8yKSB0aHJvdyBlXzIuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICAvLyBBbGwgYmxvY2tzIGhhdmUgdGhlIHNhbWUgYW1vdW50IG9mIGRhdGEsIGV4Y2VwdCB0aGF0IHRoZSBsYXN0IG4KCSAgICAgICAgLy8gKHdoZXJlIG4gbWF5IGJlIDApIGhhdmUgMSBtb3JlIGJ5dGUuIEZpZ3VyZSBvdXQgd2hlcmUgdGhlc2Ugc3RhcnQuCgkgICAgICAgIHZhciBzaG9ydGVyQmxvY2tzVG90YWxDb2Rld29yZHMgPSByZXN1bHRbMF0uY29kZXdvcmRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGxvbmdlckJsb2Nrc1N0YXJ0QXQgPSByZXN1bHQubGVuZ3RoIC0gMTsKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IGNoZWNrIGxlbmd0aCBpcyBjb3JyZWN0IGhlcmUKCSAgICAgICAgd2hpbGUgKGxvbmdlckJsb2Nrc1N0YXJ0QXQgPj0gMCkgewoJICAgICAgICAgICAgdmFyIG51bUNvZGV3b3JkcyA9IHJlc3VsdFtsb25nZXJCbG9ja3NTdGFydEF0XS5jb2Rld29yZHMubGVuZ3RoOwoJICAgICAgICAgICAgaWYgKG51bUNvZGV3b3JkcyA9PT0gc2hvcnRlckJsb2Nrc1RvdGFsQ29kZXdvcmRzKSB7CgkgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBsb25nZXJCbG9ja3NTdGFydEF0LS07CgkgICAgICAgIH0KCSAgICAgICAgbG9uZ2VyQmxvY2tzU3RhcnRBdCsrOwoJICAgICAgICB2YXIgc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHMgPSBzaG9ydGVyQmxvY2tzVG90YWxDb2Rld29yZHMgLSBlY0Jsb2Nrcy5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCk7CgkgICAgICAgIC8vIFRoZSBsYXN0IGVsZW1lbnRzIG9mIHJlc3VsdCBtYXkgYmUgMSBlbGVtZW50IGxvbmdlcgoJICAgICAgICAvLyBmaXJzdCBmaWxsIG91dCBhcyBtYW55IGVsZW1lbnRzIGFzIGFsbCBvZiB0aGVtIGhhdmUKCSAgICAgICAgdmFyIHJhd0NvZGV3b3Jkc09mZnNldCA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHM7IGkrKykgewoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBudW1SZXN1bHRCbG9ja3M7IGorKykgewoJICAgICAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbaV0gPSByYXdDb2Rld29yZHNbcmF3Q29kZXdvcmRzT2Zmc2V0KytdOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIEZpbGwgb3V0IHRoZSBsYXN0IGRhdGEgYmxvY2sgaW4gdGhlIGxvbmdlciBvbmVzCgkgICAgICAgIGZvciAodmFyIGogPSBsb25nZXJCbG9ja3NTdGFydEF0OyBqIDwgbnVtUmVzdWx0QmxvY2tzOyBqKyspIHsKCSAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHNdID0gcmF3Q29kZXdvcmRzW3Jhd0NvZGV3b3Jkc09mZnNldCsrXTsKCSAgICAgICAgfQoJICAgICAgICAvLyBOb3cgYWRkIGluIGVycm9yIGNvcnJlY3Rpb24gYmxvY2tzCgkgICAgICAgIHZhciBtYXggPSByZXN1bHRbMF0uY29kZXdvcmRzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IHNob3J0ZXJCbG9ja3NOdW1EYXRhQ29kZXdvcmRzOyBpIDwgbWF4OyBpKyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbnVtUmVzdWx0QmxvY2tzOyBqKyspIHsKCSAgICAgICAgICAgICAgICB2YXIgaU9mZnNldCA9IGogPCBsb25nZXJCbG9ja3NTdGFydEF0ID8gaSA6IGkgKyAxOwoJICAgICAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbaU9mZnNldF0gPSByYXdDb2Rld29yZHNbcmF3Q29kZXdvcmRzT2Zmc2V0KytdOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCSAgICBEYXRhQmxvY2sucHJvdG90eXBlLmdldE51bURhdGFDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm51bURhdGFDb2Rld29yZHM7CgkgICAgfTsKCSAgICBEYXRhQmxvY2sucHJvdG90eXBlLmdldENvZGV3b3JkcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY29kZXdvcmRzOwoJICAgIH07CgkgICAgcmV0dXJuIERhdGFCbG9jazsKCX0oKSk7CglEYXRhQmxvY2skMS5kZWZhdWx0ID0gRGF0YUJsb2NrOwoKCXZhciBEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEgPSB7fTsKCgl2YXIgQml0U291cmNlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdFNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbiB7Ki8KCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5UaGlzIHByb3ZpZGVzIGFuIGVhc3kgYWJzdHJhY3Rpb24gdG8gcmVhZCBiaXRzIGF0IGEgdGltZSBmcm9tIGEgc2VxdWVuY2Ugb2YgYnl0ZXMsIHdoZXJlIHRoZQoJICogbnVtYmVyIG9mIGJpdHMgcmVhZCBpcyBub3Qgb2Z0ZW4gYSBtdWx0aXBsZSBvZiA4LjwvcD4KCSAqCgkgKiA8cD5UaGlzIGNsYXNzIGlzIHRocmVhZC1zYWZlIGJ1dCBub3QgcmVlbnRyYW50IC0tIHVubGVzcyB0aGUgY2FsbGVyIG1vZGlmaWVzIHRoZSBieXRlcyBhcnJheQoJICogaXQgcGFzc2VkIGluLCBpbiB3aGljaCBjYXNlIGFsbCBiZXRzIGFyZSBvZmYuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBCaXRTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJ5dGVzIGJ5dGVzIGZyb20gd2hpY2ggdGhpcyB3aWxsIHJlYWQgYml0cy4gQml0cyB3aWxsIGJlIHJlYWQgZnJvbSB0aGUgZmlyc3QgYnl0ZSBmaXJzdC4KCSAgICAgKiBCaXRzIGFyZSByZWFkIHdpdGhpbiBhIGJ5dGUgZnJvbSBtb3N0LXNpZ25pZmljYW50IHRvIGxlYXN0LXNpZ25pZmljYW50IGJpdC4KCSAgICAgKi8KCSAgICBmdW5jdGlvbiBCaXRTb3VyY2UoYnl0ZXMpIHsKCSAgICAgICAgdGhpcy5ieXRlcyA9IGJ5dGVzOwoJICAgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSAwOwoJICAgICAgICB0aGlzLmJpdE9mZnNldCA9IDA7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaW5kZXggb2YgbmV4dCBiaXQgaW4gY3VycmVudCBieXRlIHdoaWNoIHdvdWxkIGJlIHJlYWQgYnkgdGhlIG5leHQgY2FsbCB0byB7QGxpbmsgI3JlYWRCaXRzKGludCl9LgoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuZ2V0Qml0T2Zmc2V0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRPZmZzZXQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIG5leHQgYnl0ZSBpbiBpbnB1dCBieXRlIGFycmF5IHdoaWNoIHdvdWxkIGJlIHJlYWQgYnkgdGhlIG5leHQgY2FsbCB0byB7QGxpbmsgI3JlYWRCaXRzKGludCl9LgoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuZ2V0Qnl0ZU9mZnNldCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZU9mZnNldDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBudW1CaXRzIG51bWJlciBvZiBiaXRzIHRvIHJlYWQKCSAgICAgKiBAcmV0dXJuIGludCByZXByZXNlbnRpbmcgdGhlIGJpdHMgcmVhZC4gVGhlIGJpdHMgd2lsbCBhcHBlYXIgYXMgdGhlIGxlYXN0LXNpZ25pZmljYW50CgkgICAgICogICAgICAgICBiaXRzIG9mIHRoZSBpbnQKCSAgICAgKiBAdGhyb3dzIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiBpZiBudW1CaXRzIGlzbid0IGluIFsxLDMyXSBvciBtb3JlIHRoYW4gaXMgYXZhaWxhYmxlCgkgICAgICovCgkgICAgQml0U291cmNlLnByb3RvdHlwZS5yZWFkQml0cyA9IGZ1bmN0aW9uIChudW1CaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKG51bUJpdHMgPCAxIHx8IG51bUJpdHMgPiAzMiB8fCBudW1CaXRzID4gdGhpcy5hdmFpbGFibGUoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xLmRlZmF1bHQoJycgKyBudW1CaXRzKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcmVzdWx0ID0gMDsKCSAgICAgICAgdmFyIGJpdE9mZnNldCA9IHRoaXMuYml0T2Zmc2V0OwoJICAgICAgICB2YXIgYnl0ZU9mZnNldCA9IHRoaXMuYnl0ZU9mZnNldDsKCSAgICAgICAgdmFyIGJ5dGVzID0gdGhpcy5ieXRlczsKCSAgICAgICAgLy8gRmlyc3QsIHJlYWQgcmVtYWluZGVyIGZyb20gY3VycmVudCBieXRlCgkgICAgICAgIGlmIChiaXRPZmZzZXQgPiAwKSB7CgkgICAgICAgICAgICB2YXIgYml0c0xlZnQgPSA4IC0gYml0T2Zmc2V0OwoJICAgICAgICAgICAgdmFyIHRvUmVhZCA9IG51bUJpdHMgPCBiaXRzTGVmdCA/IG51bUJpdHMgOiBiaXRzTGVmdDsKCSAgICAgICAgICAgIHZhciBiaXRzVG9Ob3RSZWFkID0gYml0c0xlZnQgLSB0b1JlYWQ7CgkgICAgICAgICAgICB2YXIgbWFzayA9ICgweEZGID4+ICg4IC0gdG9SZWFkKSkgPDwgYml0c1RvTm90UmVhZDsKCSAgICAgICAgICAgIHJlc3VsdCA9IChieXRlc1tieXRlT2Zmc2V0XSAmIG1hc2spID4+IGJpdHNUb05vdFJlYWQ7CgkgICAgICAgICAgICBudW1CaXRzIC09IHRvUmVhZDsKCSAgICAgICAgICAgIGJpdE9mZnNldCArPSB0b1JlYWQ7CgkgICAgICAgICAgICBpZiAoYml0T2Zmc2V0ID09PSA4KSB7CgkgICAgICAgICAgICAgICAgYml0T2Zmc2V0ID0gMDsKCSAgICAgICAgICAgICAgICBieXRlT2Zmc2V0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTmV4dCByZWFkIHdob2xlIGJ5dGVzCgkgICAgICAgIGlmIChudW1CaXRzID4gMCkgewoJICAgICAgICAgICAgd2hpbGUgKG51bUJpdHMgPj0gOCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IChyZXN1bHQgPDwgOCkgfCAoYnl0ZXNbYnl0ZU9mZnNldF0gJiAweEZGKTsKCSAgICAgICAgICAgICAgICBieXRlT2Zmc2V0Kys7CgkgICAgICAgICAgICAgICAgbnVtQml0cyAtPSA4OwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gRmluYWxseSByZWFkIGEgcGFydGlhbCBieXRlCgkgICAgICAgICAgICBpZiAobnVtQml0cyA+IDApIHsKCSAgICAgICAgICAgICAgICB2YXIgYml0c1RvTm90UmVhZCA9IDggLSBudW1CaXRzOwoJICAgICAgICAgICAgICAgIHZhciBtYXNrID0gKDB4RkYgPj4gYml0c1RvTm90UmVhZCkgPDwgYml0c1RvTm90UmVhZDsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSAocmVzdWx0IDw8IG51bUJpdHMpIHwgKChieXRlc1tieXRlT2Zmc2V0XSAmIG1hc2spID4+IGJpdHNUb05vdFJlYWQpOwoJICAgICAgICAgICAgICAgIGJpdE9mZnNldCArPSBudW1CaXRzOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0T2Zmc2V0ID0gYml0T2Zmc2V0OwoJICAgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSBieXRlT2Zmc2V0OwoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgYml0cyB0aGF0IGNhbiBiZSByZWFkIHN1Y2Nlc3NmdWxseQoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuYXZhaWxhYmxlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gOCAqICh0aGlzLmJ5dGVzLmxlbmd0aCAtIHRoaXMuYnl0ZU9mZnNldCkgLSB0aGlzLmJpdE9mZnNldDsKCSAgICB9OwoJICAgIHJldHVybiBCaXRTb3VyY2U7Cgl9KCkpOwoJQml0U291cmNlJDEuZGVmYXVsdCA9IEJpdFNvdXJjZTsKCgl2YXIgRGVjb2RlclJlc3VsdCQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShEZWNvZGVyUmVzdWx0JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkxpc3Q7Ki8KCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGVjb2RpbmcgYSBtYXRyaXggb2YgYml0cy4gVGhpcyB0eXBpY2FsbHkKCSAqIGFwcGxpZXMgdG8gMkQgYmFyY29kZSBmb3JtYXRzLiBGb3Igbm93IGl0IGNvbnRhaW5zIHRoZSByYXcgYnl0ZXMgb2J0YWluZWQsCgkgKiBhcyB3ZWxsIGFzIGEgU3RyaW5nIGludGVycHJldGF0aW9uIG9mIHRob3NlIGJ5dGVzLCBpZiBhcHBsaWNhYmxlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGVjb2RlclJlc3VsdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IocmF3Qnl0ZXM6IFVpbnQ4QXJyYXksCgkgICAgLy8gICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyaW5nLAoJICAgIC8vICAgICAgICAgICAgICAgICAgICAgIExpc3Q8VWludDhBcnJheT4gYnl0ZVNlZ21lbnRzLAoJICAgIC8vICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyBlY0xldmVsKSB7CgkgICAgLy8gICB0aGlzKHJhd0J5dGVzLCB0ZXh0LCBieXRlU2VnbWVudHMsIGVjTGV2ZWwsIC0xLCAtMSkKCSAgICAvLyB9CgkgICAgZnVuY3Rpb24gRGVjb2RlclJlc3VsdChyYXdCeXRlcywgdGV4dCwgYnl0ZVNlZ21lbnRzLCBlY0xldmVsLCBzdHJ1Y3R1cmVkQXBwZW5kU2VxdWVuY2VOdW1iZXIsIHN0cnVjdHVyZWRBcHBlbmRQYXJpdHkpIHsKCSAgICAgICAgaWYgKHN0cnVjdHVyZWRBcHBlbmRTZXF1ZW5jZU51bWJlciA9PT0gdm9pZCAwKSB7IHN0cnVjdHVyZWRBcHBlbmRTZXF1ZW5jZU51bWJlciA9IC0xOyB9CgkgICAgICAgIGlmIChzdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5ID09PSB2b2lkIDApIHsgc3RydWN0dXJlZEFwcGVuZFBhcml0eSA9IC0xOyB9CgkgICAgICAgIHRoaXMucmF3Qnl0ZXMgPSByYXdCeXRlczsKCSAgICAgICAgdGhpcy50ZXh0ID0gdGV4dDsKCSAgICAgICAgdGhpcy5ieXRlU2VnbWVudHMgPSBieXRlU2VnbWVudHM7CgkgICAgICAgIHRoaXMuZWNMZXZlbCA9IGVjTGV2ZWw7CgkgICAgICAgIHRoaXMuc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID0gc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyOwoJICAgICAgICB0aGlzLnN0cnVjdHVyZWRBcHBlbmRQYXJpdHkgPSBzdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5OwoJICAgICAgICB0aGlzLm51bUJpdHMgPSAocmF3Qnl0ZXMgPT09IHVuZGVmaW5lZCB8fCByYXdCeXRlcyA9PT0gbnVsbCkgPyAwIDogOCAqIHJhd0J5dGVzLmxlbmd0aDsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiByYXcgYnl0ZXMgcmVwcmVzZW50aW5nIHRoZSByZXN1bHQsIG9yIHtAY29kZSBudWxsfSBpZiBub3QgYXBwbGljYWJsZQoJICAgICAqLwoJICAgIERlY29kZXJSZXN1bHQucHJvdG90eXBlLmdldFJhd0J5dGVzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yYXdCeXRlczsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaG93IG1hbnkgYml0cyBvZiB7QGxpbmsgI2dldFJhd0J5dGVzKCl9IGFyZSB2YWxpZDsgdHlwaWNhbGx5IDggdGltZXMgaXRzIGxlbmd0aAoJICAgICAqIEBzaW5jZSAzLjMuMAoJICAgICAqLwoJICAgIERlY29kZXJSZXN1bHQucHJvdG90eXBlLmdldE51bUJpdHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm51bUJpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gbnVtQml0cyBvdmVycmlkZXMgdGhlIG51bWJlciBvZiBiaXRzIHRoYXQgYXJlIHZhbGlkIGluIHtAbGluayAjZ2V0UmF3Qnl0ZXMoKX0KCSAgICAgKiBAc2luY2UgMy4zLjAKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXROdW1CaXRzID0gZnVuY3Rpb24gKG51bUJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLm51bUJpdHMgPSBudW1CaXRzOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSByZXN1bHQKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRUZXh0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50ZXh0OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBsaXN0IG9mIGJ5dGUgc2VnbWVudHMgaW4gdGhlIHJlc3VsdCwgb3Ige0Bjb2RlIG51bGx9IGlmIG5vdCBhcHBsaWNhYmxlCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0Qnl0ZVNlZ21lbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5ieXRlU2VnbWVudHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIG5hbWUgb2YgZXJyb3IgY29ycmVjdGlvbiBsZXZlbCB1c2VkLCBvciB7QGNvZGUgbnVsbH0gaWYgbm90IGFwcGxpY2FibGUKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRFQ0xldmVsID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lY0xldmVsOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgZXJyb3JzIGNvcnJlY3RlZCwgb3Ige0Bjb2RlIG51bGx9IGlmIG5vdCBhcHBsaWNhYmxlCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0RXJyb3JzQ29ycmVjdGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lcnJvcnNDb3JyZWN0ZWQ7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXRFcnJvcnNDb3JyZWN0ZWQgPSBmdW5jdGlvbiAoZXJyb3JzQ29ycmVjdGVkIC8qSW50ZWdlciovKSB7CgkgICAgICAgIHRoaXMuZXJyb3JzQ29ycmVjdGVkID0gZXJyb3JzQ29ycmVjdGVkOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgZXJhc3VyZXMgY29ycmVjdGVkLCBvciB7QGNvZGUgbnVsbH0gaWYgbm90IGFwcGxpY2FibGUKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRFcmFzdXJlcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZXJhc3VyZXM7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXRFcmFzdXJlcyA9IGZ1bmN0aW9uIChlcmFzdXJlcyAvKkludGVnZXIqLykgewoJICAgICAgICB0aGlzLmVyYXN1cmVzID0gZXJhc3VyZXM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGFyYml0cmFyeSBhZGRpdGlvbmFsIG1ldGFkYXRhCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0T3RoZXIgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm90aGVyOwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuc2V0T3RoZXIgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgdGhpcy5vdGhlciA9IG90aGVyOwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuaGFzU3RydWN0dXJlZEFwcGVuZCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc3RydWN0dXJlZEFwcGVuZFBhcml0eSA+PSAwICYmIHRoaXMuc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID49IDA7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRTdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5OwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0U3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJ1Y3R1cmVkQXBwZW5kU2VxdWVuY2VOdW1iZXI7CgkgICAgfTsKCSAgICByZXR1cm4gRGVjb2RlclJlc3VsdDsKCX0oKSk7CglEZWNvZGVyUmVzdWx0JDEuZGVmYXVsdCA9IERlY29kZXJSZXN1bHQ7CgoJdmFyIE1vZGUgPSB7fTsKCgkoZnVuY3Rpb24gKGV4cG9ydHMpIHsKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJZXhwb3J0cy5Nb2RlVmFsdWVzID0gdm9pZCAwOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7Cgl2YXIgTW9kZVZhbHVlczsKCShmdW5jdGlvbiAoTW9kZVZhbHVlcykgewoJICAgIE1vZGVWYWx1ZXNbTW9kZVZhbHVlc1siVEVSTUlOQVRPUiJdID0gMF0gPSAiVEVSTUlOQVRPUiI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJOVU1FUklDIl0gPSAxXSA9ICJOVU1FUklDIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkFMUEhBTlVNRVJJQyJdID0gMl0gPSAiQUxQSEFOVU1FUklDIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIlNUUlVDVFVSRURfQVBQRU5EIl0gPSAzXSA9ICJTVFJVQ1RVUkVEX0FQUEVORCI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJCWVRFIl0gPSA0XSA9ICJCWVRFIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkVDSSJdID0gNV0gPSAiRUNJIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIktBTkpJIl0gPSA2XSA9ICJLQU5KSSI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJGTkMxX0ZJUlNUX1BPU0lUSU9OIl0gPSA3XSA9ICJGTkMxX0ZJUlNUX1BPU0lUSU9OIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkZOQzFfU0VDT05EX1BPU0lUSU9OIl0gPSA4XSA9ICJGTkMxX1NFQ09ORF9QT1NJVElPTiI7CgkgICAgLyoqIFNlZSBHQlQgMTgyODQtMjAwMDsgIkhhbnppIiBpcyBhIHRyYW5zbGl0ZXJhdGlvbiBvZiB0aGlzIG1vZGUgbmFtZS4gKi8KCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkhBTlpJIl0gPSA5XSA9ICJIQU5aSSI7Cgl9KShNb2RlVmFsdWVzID0gZXhwb3J0cy5Nb2RlVmFsdWVzIHx8IChleHBvcnRzLk1vZGVWYWx1ZXMgPSB7fSkpOwoJLyoqCgkgKiA8cD5TZWUgSVNPIDE4MDA0OjIwMDYsIDYuNC4xLCBUYWJsZXMgMiBhbmQgMy4gVGhpcyBlbnVtIGVuY2Fwc3VsYXRlcyB0aGUgdmFyaW91cyBtb2RlcyBpbiB3aGljaAoJICogZGF0YSBjYW4gYmUgZW5jb2RlZCB0byBiaXRzIGluIHRoZSBRUiBjb2RlIHN0YW5kYXJkLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgTW9kZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBNb2RlKHZhbHVlLCBzdHJpbmdWYWx1ZSwgY2hhcmFjdGVyQ291bnRCaXRzRm9yVmVyc2lvbnMsIGJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuc3RyaW5nVmFsdWUgPSBzdHJpbmdWYWx1ZTsKCSAgICAgICAgdGhpcy5jaGFyYWN0ZXJDb3VudEJpdHNGb3JWZXJzaW9ucyA9IGNoYXJhY3RlckNvdW50Qml0c0ZvclZlcnNpb25zOwoJICAgICAgICB0aGlzLmJpdHMgPSBiaXRzOwoJICAgICAgICBNb2RlLkZPUl9CSVRTLnNldChiaXRzLCB0aGlzKTsKCSAgICAgICAgTW9kZS5GT1JfVkFMVUUuc2V0KHZhbHVlLCB0aGlzKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJpdHMgZm91ciBiaXRzIGVuY29kaW5nIGEgUVIgQ29kZSBkYXRhIG1vZGUKCSAgICAgKiBAcmV0dXJuIE1vZGUgZW5jb2RlZCBieSB0aGVzZSBiaXRzCgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgYml0cyBkbyBub3QgY29ycmVzcG9uZCB0byBhIGtub3duIG1vZGUKCSAgICAgKi8KCSAgICBNb2RlLmZvckJpdHMgPSBmdW5jdGlvbiAoYml0cyAvKmludCovKSB7CgkgICAgICAgIHZhciBtb2RlID0gTW9kZS5GT1JfQklUUy5nZXQoYml0cyk7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IG1vZGUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG1vZGU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gdmVyc2lvbiB2ZXJzaW9uIGluIHF1ZXN0aW9uCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgYml0cyB1c2VkLCBpbiB0aGlzIFFSIENvZGUgc3ltYm9sIHtAbGluayBWZXJzaW9ufSwgdG8gZW5jb2RlIHRoZQoJICAgICAqICAgICAgICAgY291bnQgb2YgY2hhcmFjdGVycyB0aGF0IHdpbGwgZm9sbG93IGVuY29kZWQgaW4gdGhpcyBNb2RlCgkgICAgICovCgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0Q2hhcmFjdGVyQ291bnRCaXRzID0gZnVuY3Rpb24gKHZlcnNpb24pIHsKCSAgICAgICAgdmFyIHZlcnNpb25OdW1iZXIgPSB2ZXJzaW9uLmdldFZlcnNpb25OdW1iZXIoKTsKCSAgICAgICAgdmFyIG9mZnNldDsKCSAgICAgICAgaWYgKHZlcnNpb25OdW1iZXIgPD0gOSkgewoJICAgICAgICAgICAgb2Zmc2V0ID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmICh2ZXJzaW9uTnVtYmVyIDw9IDI2KSB7CgkgICAgICAgICAgICBvZmZzZXQgPSAxOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgb2Zmc2V0ID0gMjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5jaGFyYWN0ZXJDb3VudEJpdHNGb3JWZXJzaW9uc1tvZmZzZXRdOwoJICAgIH07CgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlOwoJICAgIH07CgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0Qml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYml0czsKCSAgICB9OwoJICAgIE1vZGUucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChvKSB7CgkgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBNb2RlKSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlID09PSBvdGhlci52YWx1ZTsKCSAgICB9OwoJICAgIE1vZGUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdWYWx1ZTsKCSAgICB9OwoJICAgIE1vZGUuRk9SX0JJVFMgPSBuZXcgTWFwKCk7CgkgICAgTW9kZS5GT1JfVkFMVUUgPSBuZXcgTWFwKCk7CgkgICAgTW9kZS5URVJNSU5BVE9SID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5URVJNSU5BVE9SLCAnVEVSTUlOQVRPUicsIEludDMyQXJyYXkuZnJvbShbMCwgMCwgMF0pLCAweDAwKTsgLy8gTm90IHJlYWxseSBhIG1vZGUuLi4KCSAgICBNb2RlLk5VTUVSSUMgPSBuZXcgTW9kZShNb2RlVmFsdWVzLk5VTUVSSUMsICdOVU1FUklDJywgSW50MzJBcnJheS5mcm9tKFsxMCwgMTIsIDE0XSksIDB4MDEpOwoJICAgIE1vZGUuQUxQSEFOVU1FUklDID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5BTFBIQU5VTUVSSUMsICdBTFBIQU5VTUVSSUMnLCBJbnQzMkFycmF5LmZyb20oWzksIDExLCAxM10pLCAweDAyKTsKCSAgICBNb2RlLlNUUlVDVFVSRURfQVBQRU5EID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5TVFJVQ1RVUkVEX0FQUEVORCwgJ1NUUlVDVFVSRURfQVBQRU5EJywgSW50MzJBcnJheS5mcm9tKFswLCAwLCAwXSksIDB4MDMpOyAvLyBOb3Qgc3VwcG9ydGVkCgkgICAgTW9kZS5CWVRFID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5CWVRFLCAnQllURScsIEludDMyQXJyYXkuZnJvbShbOCwgMTYsIDE2XSksIDB4MDQpOwoJICAgIE1vZGUuRUNJID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5FQ0ksICdFQ0knLCBJbnQzMkFycmF5LmZyb20oWzAsIDAsIDBdKSwgMHgwNyk7IC8vIGNoYXJhY3RlciBjb3VudHMgZG9uJ3QgYXBwbHkKCSAgICBNb2RlLktBTkpJID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5LQU5KSSwgJ0tBTkpJJywgSW50MzJBcnJheS5mcm9tKFs4LCAxMCwgMTJdKSwgMHgwOCk7CgkgICAgTW9kZS5GTkMxX0ZJUlNUX1BPU0lUSU9OID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5GTkMxX0ZJUlNUX1BPU0lUSU9OLCAnRk5DMV9GSVJTVF9QT1NJVElPTicsIEludDMyQXJyYXkuZnJvbShbMCwgMCwgMF0pLCAweDA1KTsKCSAgICBNb2RlLkZOQzFfU0VDT05EX1BPU0lUSU9OID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5GTkMxX1NFQ09ORF9QT1NJVElPTiwgJ0ZOQzFfU0VDT05EX1BPU0lUSU9OJywgSW50MzJBcnJheS5mcm9tKFswLCAwLCAwXSksIDB4MDkpOwoJICAgIC8qKiBTZWUgR0JUIDE4Mjg0LTIwMDA7ICJIYW56aSIgaXMgYSB0cmFuc2xpdGVyYXRpb24gb2YgdGhpcyBtb2RlIG5hbWUuICovCgkgICAgTW9kZS5IQU5aSSA9IG5ldyBNb2RlKE1vZGVWYWx1ZXMuSEFOWkksICdIQU5aSScsIEludDMyQXJyYXkuZnJvbShbOCwgMTAsIDEyXSksIDB4MEQpOwoJICAgIHJldHVybiBNb2RlOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IE1vZGU7CgoJfShNb2RlKSk7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcucXJjb2RlLmRlY29kZXIgeyovCgl2YXIgQml0U291cmNlXzEgPSBCaXRTb3VyY2UkMTsKCXZhciBDaGFyYWN0ZXJTZXRFQ0lfMSA9IENoYXJhY3RlclNldEVDSTsKCXZhciBEZWNvZGVyUmVzdWx0XzEgPSBEZWNvZGVyUmVzdWx0JDE7Cgl2YXIgU3RyaW5nVXRpbHNfMSA9IFN0cmluZ1V0aWxzJDE7Cgl2YXIgRm9ybWF0RXhjZXB0aW9uXzEgPSBGb3JtYXRFeGNlcHRpb24kMTsKCXZhciBTdHJpbmdCdWlsZGVyXzEgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgU3RyaW5nRW5jb2RpbmdfMSA9IFN0cmluZ0VuY29kaW5nJDE7Cgl2YXIgTW9kZV8xID0gTW9kZTsKCS8qaW1wb3J0IGphdmEuaW8uVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbjsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsqLwoJLyppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlFSIENvZGVzIGNhbiBlbmNvZGUgdGV4dCBhcyBiaXRzIGluIG9uZSBvZiBzZXZlcmFsIG1vZGVzLCBhbmQgY2FuIHVzZSBtdWx0aXBsZSBtb2RlcwoJICogaW4gb25lIFFSIENvZGUuIFRoaXMgY2xhc3MgZGVjb2RlcyB0aGUgYml0cyBiYWNrIGludG8gdGV4dC48L3A+CgkgKgoJICogPHA+U2VlIElTTyAxODAwNDoyMDA2LCA2LjQuMyAtIDYuNC43PC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBEZWNvZGVkQml0U3RyZWFtUGFyc2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIERlY29kZWRCaXRTdHJlYW1QYXJzZXIoKSB7CgkgICAgfQoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlID0gZnVuY3Rpb24gKGJ5dGVzLCB2ZXJzaW9uLCBlY0xldmVsLCBoaW50cykgewoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRTb3VyY2VfMS5kZWZhdWx0KGJ5dGVzKTsKCSAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBTdHJpbmdCdWlsZGVyXzEuZGVmYXVsdCgpOwoJICAgICAgICB2YXIgYnl0ZVNlZ21lbnRzID0gbmV3IEFycmF5KCk7IC8vIDEKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IEkgZG8gbm90IHVzZSBjb25zdHJ1Y3RvciB3aXRoIHNpemUgMSBhcyBpbiBvcmlnaW5hbCBKYXZhIG1lYW5zIGNhcGFjaXR5IGFuZCB0aGUgYXJyYXkgbGVuZ3RoIGlzIGNoZWNrZWQgYmVsb3cKCSAgICAgICAgdmFyIHN5bWJvbFNlcXVlbmNlID0gLTE7CgkgICAgICAgIHZhciBwYXJpdHlEYXRhID0gLTE7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICB2YXIgY3VycmVudENoYXJhY3RlclNldEVDSSA9IG51bGw7CgkgICAgICAgICAgICB2YXIgZmMxSW5FZmZlY3QgPSBmYWxzZTsKCSAgICAgICAgICAgIHZhciBtb2RlID0gdm9pZCAwOwoJICAgICAgICAgICAgZG8gewoJICAgICAgICAgICAgICAgIC8vIFdoaWxlIHN0aWxsIGFub3RoZXIgc2VnbWVudCB0byByZWFkLi4uCgkgICAgICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCA0KSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIE9LLCBhc3N1bWUgd2UncmUgZG9uZS4gUmVhbGx5LCBhIFRFUk1JTkFUT1IgbW9kZSBzaG91bGQgaGF2ZSBiZWVuIHJlY29yZGVkIGhlcmUKCSAgICAgICAgICAgICAgICAgICAgbW9kZSA9IE1vZGVfMS5kZWZhdWx0LlRFUk1JTkFUT1I7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICB2YXIgbW9kZUJpdHMgPSBiaXRzLnJlYWRCaXRzKDQpOwoJICAgICAgICAgICAgICAgICAgICBtb2RlID0gTW9kZV8xLmRlZmF1bHQuZm9yQml0cyhtb2RlQml0cyk7IC8vIG1vZGUgaXMgZW5jb2RlZCBieSA0IGJpdHMKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgc3dpdGNoIChtb2RlKSB7CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuVEVSTUlOQVRPUjoKCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LkZOQzFfRklSU1RfUE9TSVRJT046CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuRk5DMV9TRUNPTkRfUE9TSVRJT046CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBkbyBsaXR0bGUgd2l0aCBGTkMxIGV4Y2VwdCBhbHRlciB0aGUgcGFyc2VkIHJlc3VsdCBhIGJpdCBhY2NvcmRpbmcgdG8gdGhlIHNwZWMKCSAgICAgICAgICAgICAgICAgICAgICAgIGZjMUluRWZmZWN0ID0gdHJ1ZTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LlNUUlVDVFVSRURfQVBQRU5EOgoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCAxNikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXF1ZW5jZSBudW1iZXIgYW5kIHBhcml0eSBpcyBhZGRlZCBsYXRlciB0byB0aGUgcmVzdWx0IG1ldGFkYXRhCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWFkIG5leHQgOCBiaXRzIChzeW1ib2wgc2VxdWVuY2UgIykgYW5kIDggYml0cyAoZGF0YTogcGFyaXR5KSwgdGhlbiBjb250aW51ZQoJICAgICAgICAgICAgICAgICAgICAgICAgc3ltYm9sU2VxdWVuY2UgPSBiaXRzLnJlYWRCaXRzKDgpOwoJICAgICAgICAgICAgICAgICAgICAgICAgcGFyaXR5RGF0YSA9IGJpdHMucmVhZEJpdHMoOCk7CgkgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RlXzEuZGVmYXVsdC5FQ0k6CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBDb3VudCBkb2Vzbid0IGFwcGx5IHRvIEVDSQoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5wYXJzZUVDSVZhbHVlKGJpdHMpOwoJICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENoYXJhY3RlclNldEVDSSA9IENoYXJhY3RlclNldEVDSV8xLmRlZmF1bHQuZ2V0Q2hhcmFjdGVyU2V0RUNJQnlWYWx1ZSh2YWx1ZSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudENoYXJhY3RlclNldEVDSSA9PT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RlXzEuZGVmYXVsdC5IQU5aSToKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZpcnN0IGhhbmRsZSBIYW56aSBtb2RlIHdoaWNoIGRvZXMgbm90IHN0YXJ0IHdpdGggY2hhcmFjdGVyIGNvdW50CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGluZXNlIG1vZGUgY29udGFpbnMgYSBzdWIgc2V0IGluZGljYXRvciByaWdodCBhZnRlciBtb2RlIGluZGljYXRvcgoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1YnNldCA9IGJpdHMucmVhZEJpdHMoNCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY291bnRIYW56aSA9IGJpdHMucmVhZEJpdHMobW9kZS5nZXRDaGFyYWN0ZXJDb3VudEJpdHModmVyc2lvbikpOwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1YnNldCA9PT0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5HQjIzMTJfU1VCU0VUKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVIYW56aVNlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudEhhbnppKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gIk5vcm1hbCIgUVIgY29kZSBtb2RlczoKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhvdyBtYW55IGNoYXJhY3RlcnMgd2lsbCBmb2xsb3csIGVuY29kZWQgaW4gdGhpcyBtb2RlPwoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvdW50ID0gYml0cy5yZWFkQml0cyhtb2RlLmdldENoYXJhY3RlckNvdW50Qml0cyh2ZXJzaW9uKSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG1vZGUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0Lk5VTUVSSUM6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlTnVtZXJpY1NlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuQUxQSEFOVU1FUklDOgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLmRlY29kZUFscGhhbnVtZXJpY1NlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCwgZmMxSW5FZmZlY3QpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LkJZVEU6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlQnl0ZVNlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCwgY3VycmVudENoYXJhY3RlclNldEVDSSwgYnl0ZVNlZ21lbnRzLCBoaW50cyk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuS0FOSkk6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlS2FuamlTZWdtZW50KGJpdHMsIHJlc3VsdCwgY291bnQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSB3aGlsZSAobW9kZSAhPT0gTW9kZV8xLmRlZmF1bHQuVEVSTUlOQVRPUik7CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlhZSAvKjogSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgIC8vIGZyb20gcmVhZEJpdHMoKSBjYWxscwoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbmV3IERlY29kZXJSZXN1bHRfMS5kZWZhdWx0KGJ5dGVzLCByZXN1bHQudG9TdHJpbmcoKSwgYnl0ZVNlZ21lbnRzLmxlbmd0aCA9PT0gMCA/IG51bGwgOiBieXRlU2VnbWVudHMsIGVjTGV2ZWwgPT09IG51bGwgPyBudWxsIDogZWNMZXZlbC50b1N0cmluZygpLCBzeW1ib2xTZXF1ZW5jZSwgcGFyaXR5RGF0YSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZWUgc3BlY2lmaWNhdGlvbiBHQlQgMTgyODQtMjAwMAoJICAgICAqLwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlSGFuemlTZWdtZW50ID0gZnVuY3Rpb24gKGJpdHMsIHJlc3VsdCwgY291bnQgLyppbnQqLykgewoJICAgICAgICAvLyBEb24ndCBjcmFzaCB0cnlpbmcgdG8gcmVhZCBtb3JlIGJpdHMgdGhhbiB3ZSBoYXZlIGF2YWlsYWJsZS4KCSAgICAgICAgaWYgKGNvdW50ICogMTMgPiBiaXRzLmF2YWlsYWJsZSgpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEVhY2ggY2hhcmFjdGVyIHdpbGwgcmVxdWlyZSAyIGJ5dGVzLiBSZWFkIHRoZSBjaGFyYWN0ZXJzIGFzIDItYnl0ZSBwYWlycwoJICAgICAgICAvLyBhbmQgZGVjb2RlIGFzIEdCMjMxMiBhZnRlcndhcmRzCgkgICAgICAgIHZhciBidWZmZXIgPSBuZXcgVWludDhBcnJheSgyICogY291bnQpOwoJICAgICAgICB2YXIgb2Zmc2V0ID0gMDsKCSAgICAgICAgd2hpbGUgKGNvdW50ID4gMCkgewoJICAgICAgICAgICAgLy8gRWFjaCAxMyBiaXRzIGVuY29kZXMgYSAyLWJ5dGUgY2hhcmFjdGVyCgkgICAgICAgICAgICB2YXIgdHdvQnl0ZXMgPSBiaXRzLnJlYWRCaXRzKDEzKTsKCSAgICAgICAgICAgIHZhciBhc3NlbWJsZWRUd29CeXRlcyA9ICgoKHR3b0J5dGVzIC8gMHgwNjApIDw8IDgpICYgMHhGRkZGRkZGRikgfCAodHdvQnl0ZXMgJSAweDA2MCk7CgkgICAgICAgICAgICBpZiAoYXNzZW1ibGVkVHdvQnl0ZXMgPCAweDAwM0JGKSB7CgkgICAgICAgICAgICAgICAgLy8gSW4gdGhlIDB4QTFBMSB0byAweEFBRkUgcmFuZ2UKCSAgICAgICAgICAgICAgICBhc3NlbWJsZWRUd29CeXRlcyArPSAweDBBMUExOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgLy8gSW4gdGhlIDB4QjBBMSB0byAweEZBRkUgcmFuZ2UKCSAgICAgICAgICAgICAgICBhc3NlbWJsZWRUd29CeXRlcyArPSAweDBBNkExOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgYnVmZmVyW29mZnNldF0gPSAvKihieXRlKSAqLyAoKGFzc2VtYmxlZFR3b0J5dGVzID4+IDgpICYgMHhGRik7CgkgICAgICAgICAgICBidWZmZXJbb2Zmc2V0ICsgMV0gPSAvKihieXRlKSAqLyAoYXNzZW1ibGVkVHdvQnl0ZXMgJiAweEZGKTsKCSAgICAgICAgICAgIG9mZnNldCArPSAyOwoJICAgICAgICAgICAgY291bnQtLTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChTdHJpbmdFbmNvZGluZ18xLmRlZmF1bHQuZGVjb2RlKGJ1ZmZlciwgU3RyaW5nVXRpbHNfMS5kZWZhdWx0LkdCMjMxMikpOwoJICAgICAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IFRPRE86IGltcGxlbWVudCBHQjIzMTIgZGVjb2RlLiBTdHJpbmdWaWV3IGZyb20gTUROIGNvdWxkIGJlIGEgc3RhcnRpbmcgcG9pbnQKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoaWdub3JlZCAvKjogVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdChpZ25vcmVkKTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVLYW5qaVNlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovKSB7CgkgICAgICAgIC8vIERvbid0IGNyYXNoIHRyeWluZyB0byByZWFkIG1vcmUgYml0cyB0aGFuIHdlIGhhdmUgYXZhaWxhYmxlLgoJICAgICAgICBpZiAoY291bnQgKiAxMyA+IGJpdHMuYXZhaWxhYmxlKCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRWFjaCBjaGFyYWN0ZXIgd2lsbCByZXF1aXJlIDIgYnl0ZXMuIFJlYWQgdGhlIGNoYXJhY3RlcnMgYXMgMi1ieXRlIHBhaXJzCgkgICAgICAgIC8vIGFuZCBkZWNvZGUgYXMgU2hpZnRfSklTIGFmdGVyd2FyZHMKCSAgICAgICAgdmFyIGJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KDIgKiBjb3VudCk7CgkgICAgICAgIHZhciBvZmZzZXQgPSAwOwoJICAgICAgICB3aGlsZSAoY291bnQgPiAwKSB7CgkgICAgICAgICAgICAvLyBFYWNoIDEzIGJpdHMgZW5jb2RlcyBhIDItYnl0ZSBjaGFyYWN0ZXIKCSAgICAgICAgICAgIHZhciB0d29CeXRlcyA9IGJpdHMucmVhZEJpdHMoMTMpOwoJICAgICAgICAgICAgdmFyIGFzc2VtYmxlZFR3b0J5dGVzID0gKCgodHdvQnl0ZXMgLyAweDBDMCkgPDwgOCkgJiAweEZGRkZGRkZGKSB8ICh0d29CeXRlcyAlIDB4MEMwKTsKCSAgICAgICAgICAgIGlmIChhc3NlbWJsZWRUd29CeXRlcyA8IDB4MDFGMDApIHsKCSAgICAgICAgICAgICAgICAvLyBJbiB0aGUgMHg4MTQwIHRvIDB4OUZGQyByYW5nZQoJICAgICAgICAgICAgICAgIGFzc2VtYmxlZFR3b0J5dGVzICs9IDB4MDgxNDA7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyBJbiB0aGUgMHhFMDQwIHRvIDB4RUJCRiByYW5nZQoJICAgICAgICAgICAgICAgIGFzc2VtYmxlZFR3b0J5dGVzICs9IDB4MEMxNDA7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBidWZmZXJbb2Zmc2V0XSA9IC8qKGJ5dGUpICovIChhc3NlbWJsZWRUd29CeXRlcyA+PiA4KTsKCSAgICAgICAgICAgIGJ1ZmZlcltvZmZzZXQgKyAxXSA9IC8qKGJ5dGUpICovIGFzc2VtYmxlZFR3b0J5dGVzOwoJICAgICAgICAgICAgb2Zmc2V0ICs9IDI7CgkgICAgICAgICAgICBjb3VudC0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIFNoaWZ0X0pJUyBtYXkgbm90IGJlIHN1cHBvcnRlZCBpbiBzb21lIGVudmlyb25tZW50czoKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoU3RyaW5nRW5jb2RpbmdfMS5kZWZhdWx0LmRlY29kZShidWZmZXIsIFN0cmluZ1V0aWxzXzEuZGVmYXVsdC5TSElGVF9KSVMpKTsKCSAgICAgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiBUT0RPOiBpbXBsZW1lbnQgU0hJRlRfSklTIGRlY29kZS4gU3RyaW5nVmlldyBmcm9tIE1ETiBjb3VsZCBiZSBhIHN0YXJ0aW5nIHBvaW50CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlnbm9yZWQgLyo6IFVuc3VwcG9ydGVkRW5jb2RpbmdFeGNlcHRpb24qLykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoaWdub3JlZCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlQnl0ZVNlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovLCBjdXJyZW50Q2hhcmFjdGVyU2V0RUNJLCBieXRlU2VnbWVudHMsIGhpbnRzKSB7CgkgICAgICAgIC8vIERvbid0IGNyYXNoIHRyeWluZyB0byByZWFkIG1vcmUgYml0cyB0aGFuIHdlIGhhdmUgYXZhaWxhYmxlLgoJICAgICAgICBpZiAoOCAqIGNvdW50ID4gYml0cy5hdmFpbGFibGUoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcmVhZEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoY291bnQpOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKCSAgICAgICAgICAgIHJlYWRCeXRlc1tpXSA9IC8qKGJ5dGUpICovIGJpdHMucmVhZEJpdHMoOCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGVuY29kaW5nOwoJICAgICAgICBpZiAoY3VycmVudENoYXJhY3RlclNldEVDSSA9PT0gbnVsbCkgewoJICAgICAgICAgICAgLy8gVGhlIHNwZWMgaXNuJ3QgY2xlYXIgb24gdGhpcyBtb2RlOyBzZWUKCSAgICAgICAgICAgIC8vIHNlY3Rpb24gNi40LjU6IHQgZG9lcyBub3Qgc2F5IHdoaWNoIGVuY29kaW5nIHRvIGFzc3VtaW5nCgkgICAgICAgICAgICAvLyB1cG9uIGRlY29kaW5nLiBJIGhhdmUgc2VlbiBJU08tODg1OS0xIHVzZWQgYXMgd2VsbCBhcwoJICAgICAgICAgICAgLy8gU2hpZnRfSklTIC0tIHdpdGhvdXQgYW55dGhpbmcgbGlrZSBhbiBFQ0kgZGVzaWduYXRvciB0bwoJICAgICAgICAgICAgLy8gZ2l2ZSBhIGhpbnQuCgkgICAgICAgICAgICBlbmNvZGluZyA9IFN0cmluZ1V0aWxzXzEuZGVmYXVsdC5ndWVzc0VuY29kaW5nKHJlYWRCeXRlcywgaGludHMpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgZW5jb2RpbmcgPSBjdXJyZW50Q2hhcmFjdGVyU2V0RUNJLmdldE5hbWUoKTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChTdHJpbmdFbmNvZGluZ18xLmRlZmF1bHQuZGVjb2RlKHJlYWRCeXRlcywgZW5jb2RpbmcpKTsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoaWdub3JlZCAvKjogVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdChpZ25vcmVkKTsKCSAgICAgICAgfQoJICAgICAgICBieXRlU2VnbWVudHMucHVzaChyZWFkQnl0ZXMpOwoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIgPSBmdW5jdGlvbiAodmFsdWUgLyppbnQqLykgewoJICAgICAgICBpZiAodmFsdWUgPj0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5BTFBIQU5VTUVSSUNfQ0hBUlMubGVuZ3RoKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLkFMUEhBTlVNRVJJQ19DSEFSU1t2YWx1ZV07CgkgICAgfTsKCSAgICBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLmRlY29kZUFscGhhbnVtZXJpY1NlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovLCBmYzFJbkVmZmVjdCkgewoJICAgICAgICAvLyBSZWFkIHR3byBjaGFyYWN0ZXJzIGF0IGEgdGltZQoJICAgICAgICB2YXIgc3RhcnQgPSByZXN1bHQubGVuZ3RoKCk7CgkgICAgICAgIHdoaWxlIChjb3VudCA+IDEpIHsKCSAgICAgICAgICAgIGlmIChiaXRzLmF2YWlsYWJsZSgpIDwgMTEpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIG5leHRUd29DaGFyc0JpdHMgPSBiaXRzLnJlYWRCaXRzKDExKTsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoTWF0aC5mbG9vcihuZXh0VHdvQ2hhcnNCaXRzIC8gNDUpKSk7CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKG5leHRUd29DaGFyc0JpdHMgJSA0NSkpOwoJICAgICAgICAgICAgY291bnQgLT0gMjsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY291bnQgPT09IDEpIHsKCSAgICAgICAgICAgIC8vIHNwZWNpYWwgY2FzZTogb25lIGNoYXJhY3RlciBsZWZ0CgkgICAgICAgICAgICBpZiAoYml0cy5hdmFpbGFibGUoKSA8IDYpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChEZWNvZGVkQml0U3RyZWFtUGFyc2VyLnRvQWxwaGFOdW1lcmljQ2hhcihiaXRzLnJlYWRCaXRzKDYpKSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gU2VlIHNlY3Rpb24gNi40LjguMSwgNi40LjguMgoJICAgICAgICBpZiAoZmMxSW5FZmZlY3QpIHsKCSAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gbWFzc2FnZSB0aGUgcmVzdWx0IGEgYml0IGlmIGluIGFuIEZOQzEgbW9kZToKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IHJlc3VsdC5sZW5ndGgoKTsgaSsrKSB7CgkgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5jaGFyQXQoaSkgPT09ICclJykgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaSA8IHJlc3VsdC5sZW5ndGgoKSAtIDEgJiYgcmVzdWx0LmNoYXJBdChpICsgMSkgPT09ICclJykgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gJSUgaXMgcmVuZGVyZWQgYXMgJQoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRlbGV0ZUNoYXJBdChpICsgMSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbiBhbHBoYSBtb2RlLCAlIHNob3VsZCBiZSBjb252ZXJ0ZWQgdG8gRk5DMSBzZXBhcmF0b3IgMHgxRAoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnNldENoYXJBdChpLCBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4MUQpKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVOdW1lcmljU2VnbWVudCA9IGZ1bmN0aW9uIChiaXRzLCByZXN1bHQsIGNvdW50IC8qaW50Ki8pIHsKCSAgICAgICAgLy8gUmVhZCB0aHJlZSBkaWdpdHMgYXQgYSB0aW1lCgkgICAgICAgIHdoaWxlIChjb3VudCA+PSAzKSB7CgkgICAgICAgICAgICAvLyBFYWNoIDEwIGJpdHMgZW5jb2RlcyB0aHJlZSBkaWdpdHMKCSAgICAgICAgICAgIGlmIChiaXRzLmF2YWlsYWJsZSgpIDwgMTApIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIHRocmVlRGlnaXRzQml0cyA9IGJpdHMucmVhZEJpdHMoMTApOwoJICAgICAgICAgICAgaWYgKHRocmVlRGlnaXRzQml0cyA+PSAxMDAwKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoTWF0aC5mbG9vcih0aHJlZURpZ2l0c0JpdHMgLyAxMDApKSk7CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKE1hdGguZmxvb3IodGhyZWVEaWdpdHNCaXRzIC8gMTApICUgMTApKTsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIodGhyZWVEaWdpdHNCaXRzICUgMTApKTsKCSAgICAgICAgICAgIGNvdW50IC09IDM7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvdW50ID09PSAyKSB7CgkgICAgICAgICAgICAvLyBUd28gZGlnaXRzIGxlZnQgb3ZlciB0byByZWFkLCBlbmNvZGVkIGluIDcgYml0cwoJICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCA3KSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhciB0d29EaWdpdHNCaXRzID0gYml0cy5yZWFkQml0cyg3KTsKCSAgICAgICAgICAgIGlmICh0d29EaWdpdHNCaXRzID49IDEwMCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKE1hdGguZmxvb3IodHdvRGlnaXRzQml0cyAvIDEwKSkpOwoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChEZWNvZGVkQml0U3RyZWFtUGFyc2VyLnRvQWxwaGFOdW1lcmljQ2hhcih0d29EaWdpdHNCaXRzICUgMTApKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChjb3VudCA9PT0gMSkgewoJICAgICAgICAgICAgLy8gT25lIGRpZ2l0IGxlZnQgb3ZlciB0byByZWFkCgkgICAgICAgICAgICBpZiAoYml0cy5hdmFpbGFibGUoKSA8IDQpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIGRpZ2l0Qml0cyA9IGJpdHMucmVhZEJpdHMoNCk7CgkgICAgICAgICAgICBpZiAoZGlnaXRCaXRzID49IDEwKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoZGlnaXRCaXRzKSk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIucGFyc2VFQ0lWYWx1ZSA9IGZ1bmN0aW9uIChiaXRzKSB7CgkgICAgICAgIHZhciBmaXJzdEJ5dGUgPSBiaXRzLnJlYWRCaXRzKDgpOwoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4ODApID09PSAwKSB7CgkgICAgICAgICAgICAvLyBqdXN0IG9uZSBieXRlCgkgICAgICAgICAgICByZXR1cm4gZmlyc3RCeXRlICYgMHg3RjsKCSAgICAgICAgfQoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4QzApID09PSAweDgwKSB7CgkgICAgICAgICAgICAvLyB0d28gYnl0ZXMKCSAgICAgICAgICAgIHZhciBzZWNvbmRCeXRlID0gYml0cy5yZWFkQml0cyg4KTsKCSAgICAgICAgICAgIHJldHVybiAoKChmaXJzdEJ5dGUgJiAweDNGKSA8PCA4KSAmIDB4RkZGRkZGRkYpIHwgc2Vjb25kQnl0ZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4RTApID09PSAweEMwKSB7CgkgICAgICAgICAgICAvLyB0aHJlZSBieXRlcwoJICAgICAgICAgICAgdmFyIHNlY29uZFRoaXJkQnl0ZXMgPSBiaXRzLnJlYWRCaXRzKDE2KTsKCSAgICAgICAgICAgIHJldHVybiAoKChmaXJzdEJ5dGUgJiAweDFGKSA8PCAxNikgJiAweEZGRkZGRkZGKSB8IHNlY29uZFRoaXJkQnl0ZXM7CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFNlZSBJU08gMTgwMDQ6MjAwNiwgNi40LjQgVGFibGUgNQoJICAgICAqLwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuQUxQSEFOVU1FUklDX0NIQVJTID0gJzAxMjM0NTY3ODlBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWiAkJSorLS4vOic7CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5HQjIzMTJfU1VCU0VUID0gMTsKCSAgICByZXR1cm4gRGVjb2RlZEJpdFN0cmVhbVBhcnNlcjsKCX0oKSk7CglEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEuZGVmYXVsdCA9IERlY29kZWRCaXRTdHJlYW1QYXJzZXI7CgoJdmFyIFFSQ29kZURlY29kZXJNZXRhRGF0YSQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDEzIFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShRUkNvZGVEZWNvZGVyTWV0YURhdGEkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLyoqCgkgKiBNZXRhLWRhdGEgY29udGFpbmVyIGZvciBRUiBDb2RlIGRlY29kaW5nLiBJbnN0YW5jZXMgb2YgdGhpcyBjbGFzcyBtYXkgYmUgdXNlZCB0byBjb252ZXkgaW5mb3JtYXRpb24gYmFjayB0byB0aGUKCSAqIGRlY29kaW5nIGNhbGxlci4gQ2FsbGVycyBhcmUgZXhwZWN0ZWQgdG8gcHJvY2VzcyB0aGlzLgoJICoKCSAqIEBzZWUgY29tLmdvb2dsZS56eGluZy5jb21tb24uRGVjb2RlclJlc3VsdCNnZXRPdGhlcigpCgkgKi8KCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGEgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUVJDb2RlRGVjb2Rlck1ldGFEYXRhKG1pcnJvcmVkKSB7CgkgICAgICAgIHRoaXMubWlycm9yZWQgPSBtaXJyb3JlZDsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBRUiBDb2RlIHdhcyBtaXJyb3JlZC4KCSAgICAgKi8KCSAgICBRUkNvZGVEZWNvZGVyTWV0YURhdGEucHJvdG90eXBlLmlzTWlycm9yZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm1pcnJvcmVkOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQXBwbHkgdGhlIHJlc3VsdCBwb2ludHMnIG9yZGVyIGNvcnJlY3Rpb24gZHVlIHRvIG1pcnJvcmluZy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBwb2ludHMgQXJyYXkgb2YgcG9pbnRzIHRvIGFwcGx5IG1pcnJvciBjb3JyZWN0aW9uIHRvLgoJICAgICAqLwoJICAgIFFSQ29kZURlY29kZXJNZXRhRGF0YS5wcm90b3R5cGUuYXBwbHlNaXJyb3JlZENvcnJlY3Rpb24gPSBmdW5jdGlvbiAocG9pbnRzKSB7CgkgICAgICAgIGlmICghdGhpcy5taXJyb3JlZCB8fCBwb2ludHMgPT09IG51bGwgfHwgcG9pbnRzLmxlbmd0aCA8IDMpIHsKCSAgICAgICAgICAgIHJldHVybjsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYm90dG9tTGVmdCA9IHBvaW50c1swXTsKCSAgICAgICAgcG9pbnRzWzBdID0gcG9pbnRzWzJdOwoJICAgICAgICBwb2ludHNbMl0gPSBib3R0b21MZWZ0OwoJICAgICAgICAvLyBObyBuZWVkIHRvICdmaXgnIHRvcC1sZWZ0IGFuZCBhbGlnbm1lbnQgcGF0dGVybi4KCSAgICB9OwoJICAgIHJldHVybiBRUkNvZGVEZWNvZGVyTWV0YURhdGE7Cgl9KCkpOwoJUVJDb2RlRGVjb2Rlck1ldGFEYXRhJDEuZGVmYXVsdCA9IFFSQ29kZURlY29kZXJNZXRhRGF0YTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDIgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGVjb2RlciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLnFyY29kZS5kZWNvZGVyIHsqLwoJdmFyIENoZWNrc3VtRXhjZXB0aW9uXzEgPSBDaGVja3N1bUV4Y2VwdGlvbiQxOwoJdmFyIEJpdE1hdHJpeF8xJDIgPSBCaXRNYXRyaXgkMTsKCXZhciBHZW5lcmljR0ZfMSA9IEdlbmVyaWNHRiQxOwoJdmFyIFJlZWRTb2xvbW9uRGVjb2Rlcl8xID0gUmVlZFNvbG9tb25EZWNvZGVyJDE7Cgl2YXIgQml0TWF0cml4UGFyc2VyXzEgPSBCaXRNYXRyaXhQYXJzZXIkMTsKCXZhciBEYXRhQmxvY2tfMSA9IERhdGFCbG9jayQxOwoJdmFyIERlY29kZWRCaXRTdHJlYW1QYXJzZXJfMSA9IERlY29kZWRCaXRTdHJlYW1QYXJzZXIkMTsKCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSQxID0gUVJDb2RlRGVjb2Rlck1ldGFEYXRhJDE7CgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlRoZSBtYWluIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgUVIgQ29kZSBkZWNvZGluZyAtLSBhcyBvcHBvc2VkIHRvIGxvY2F0aW5nIGFuZCBleHRyYWN0aW5nCgkgKiB0aGUgUVIgQ29kZSBmcm9tIGFuIGltYWdlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGVjb2RlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBEZWNvZGVyKCkgewoJICAgICAgICB0aGlzLnJzRGVjb2RlciA9IG5ldyBSZWVkU29sb21vbkRlY29kZXJfMS5kZWZhdWx0KEdlbmVyaWNHRl8xLmRlZmF1bHQuUVJfQ09ERV9GSUVMRF8yNTYpOwoJICAgIH0KCSAgICAvLyBwdWJsaWMgZGVjb2RlKGltYWdlOiBib29sZWFuW11bXSk6IERlY29kZXJSZXN1bHQgLyp0aHJvd3MgQ2hlY2tzdW1FeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiovIHsKCSAgICAvLyAgIHJldHVybiBkZWNvZGUoaW1hZ2UsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIDxwPkNvbnZlbmllbmNlIG1ldGhvZCB0aGF0IGNhbiBkZWNvZGUgYSBRUiBDb2RlIHJlcHJlc2VudGVkIGFzIGEgMkQgYXJyYXkgb2YgYm9vbGVhbnMuCgkgICAgICogInRydWUiIGlzIHRha2VuIHRvIG1lYW4gYSBibGFjayBtb2R1bGUuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGltYWdlIGJvb2xlYW5zIHJlcHJlc2VudGluZyB3aGl0ZS9ibGFjayBRUiBDb2RlIG1vZHVsZXMKCSAgICAgKiBAcGFyYW0gaGludHMgZGVjb2RpbmcgaGludHMgdGhhdCBzaG91bGQgYmUgdXNlZCB0byBpbmZsdWVuY2UgZGVjb2RpbmcKCSAgICAgKiBAcmV0dXJuIHRleHQgYW5kIGJ5dGVzIGVuY29kZWQgd2l0aGluIHRoZSBRUiBDb2RlCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgdGhlIFFSIENvZGUgY2Fubm90IGJlIGRlY29kZWQKCSAgICAgKiBAdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uIGlmIGVycm9yIGNvcnJlY3Rpb24gZmFpbHMKCSAgICAgKi8KCSAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGVCb29sZWFuQXJyYXkgPSBmdW5jdGlvbiAoaW1hZ2UsIGhpbnRzKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUJpdE1hdHJpeChCaXRNYXRyaXhfMSQyLmRlZmF1bHQucGFyc2VGcm9tQm9vbGVhbkFycmF5KGltYWdlKSwgaGludHMpOwoJICAgIH07CgkgICAgLy8gcHVibGljIGRlY29kZUJpdE1hdHJpeChiaXRzOiBCaXRNYXRyaXgpOiBEZWNvZGVyUmVzdWx0IC8qdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uLCBGb3JtYXRFeGNlcHRpb24qLyB7CgkgICAgLy8gICByZXR1cm4gZGVjb2RlKGJpdHMsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIDxwPkRlY29kZXMgYSBRUiBDb2RlIHJlcHJlc2VudGVkIGFzIGEge0BsaW5rIEJpdE1hdHJpeH0uIEEgMSBvciAidHJ1ZSIgaXMgdGFrZW4gdG8gbWVhbiBhIGJsYWNrIG1vZHVsZS48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0gYml0cyBib29sZWFucyByZXByZXNlbnRpbmcgd2hpdGUvYmxhY2sgUVIgQ29kZSBtb2R1bGVzCgkgICAgICogQHBhcmFtIGhpbnRzIGRlY29kaW5nIGhpbnRzIHRoYXQgc2hvdWxkIGJlIHVzZWQgdG8gaW5mbHVlbmNlIGRlY29kaW5nCgkgICAgICogQHJldHVybiB0ZXh0IGFuZCBieXRlcyBlbmNvZGVkIHdpdGhpbiB0aGUgUVIgQ29kZQoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIHRoZSBRUiBDb2RlIGNhbm5vdCBiZSBkZWNvZGVkCgkgICAgICogQHRocm93cyBDaGVja3N1bUV4Y2VwdGlvbiBpZiBlcnJvciBjb3JyZWN0aW9uIGZhaWxzCgkgICAgICovCgkgICAgRGVjb2Rlci5wcm90b3R5cGUuZGVjb2RlQml0TWF0cml4ID0gZnVuY3Rpb24gKGJpdHMsIGhpbnRzKSB7CgkgICAgICAgIC8vIENvbnN0cnVjdCBhIHBhcnNlciBhbmQgcmVhZCB2ZXJzaW9uLCBlcnJvci1jb3JyZWN0aW9uIGxldmVsCgkgICAgICAgIHZhciBwYXJzZXIgPSBuZXcgQml0TWF0cml4UGFyc2VyXzEuZGVmYXVsdChiaXRzKTsKCSAgICAgICAgdmFyIGV4ID0gbnVsbDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUJpdE1hdHJpeFBhcnNlcihwYXJzZXIsIGhpbnRzKTsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZSAvKjogRm9ybWF0RXhjZXB0aW9uLCBDaGVja3N1bUV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICBleCA9IGU7CgkgICAgICAgIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIC8vIFJldmVydCB0aGUgYml0IG1hdHJpeAoJICAgICAgICAgICAgcGFyc2VyLnJlbWFzaygpOwoJICAgICAgICAgICAgLy8gV2lsbCBiZSBhdHRlbXB0aW5nIGEgbWlycm9yZWQgcmVhZGluZyBvZiB0aGUgdmVyc2lvbiBhbmQgZm9ybWF0IGluZm8uCgkgICAgICAgICAgICBwYXJzZXIuc2V0TWlycm9yKHRydWUpOwoJICAgICAgICAgICAgLy8gUHJlZW1wdGl2ZWx5IHJlYWQgdGhlIHZlcnNpb24uCgkgICAgICAgICAgICBwYXJzZXIucmVhZFZlcnNpb24oKTsKCSAgICAgICAgICAgIC8vIFByZWVtcHRpdmVseSByZWFkIHRoZSBmb3JtYXQgaW5mb3JtYXRpb24uCgkgICAgICAgICAgICBwYXJzZXIucmVhZEZvcm1hdEluZm9ybWF0aW9uKCk7CgkgICAgICAgICAgICAvKgoJICAgICAgICAgICAgICogU2luY2Ugd2UncmUgaGVyZSwgdGhpcyBtZWFucyB3ZSBoYXZlIHN1Y2Nlc3NmdWxseSBkZXRlY3RlZCBzb21lIGtpbmQKCSAgICAgICAgICAgICAqIG9mIHZlcnNpb24gYW5kIGZvcm1hdCBpbmZvcm1hdGlvbiB3aGVuIG1pcnJvcmVkLiBUaGlzIGlzIGEgZ29vZCBzaWduLAoJICAgICAgICAgICAgICogdGhhdCB0aGUgUVIgY29kZSBtYXkgYmUgbWlycm9yZWQsIGFuZCB3ZSBzaG91bGQgdHJ5IG9uY2UgbW9yZSB3aXRoIGEKCSAgICAgICAgICAgICAqIG1pcnJvcmVkIGNvbnRlbnQuCgkgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgIC8vIFByZXBhcmUgZm9yIGEgbWlycm9yZWQgcmVhZGluZy4KCSAgICAgICAgICAgIHBhcnNlci5taXJyb3IoKTsKCSAgICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLmRlY29kZUJpdE1hdHJpeFBhcnNlcihwYXJzZXIsIGhpbnRzKTsKCSAgICAgICAgICAgIC8vIFN1Y2Nlc3MhIE5vdGlmeSB0aGUgY2FsbGVyIHRoYXQgdGhlIGNvZGUgd2FzIG1pcnJvcmVkLgoJICAgICAgICAgICAgcmVzdWx0LnNldE90aGVyKG5ldyBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSQxLmRlZmF1bHQodHJ1ZSkpOwoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZSAvKkZvcm1hdEV4Y2VwdGlvbiB8IENoZWNrc3VtRXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgIC8vIFRocm93IHRoZSBleGNlcHRpb24gZnJvbSB0aGUgb3JpZ2luYWwgcmVhZGluZwoJICAgICAgICAgICAgaWYgKGV4ICE9PSBudWxsKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgZXg7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0aHJvdyBlOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGVCaXRNYXRyaXhQYXJzZXIgPSBmdW5jdGlvbiAocGFyc2VyLCBoaW50cykgewoJICAgICAgICB2YXIgZV8xLCBfYSwgZV8yLCBfYjsKCSAgICAgICAgdmFyIHZlcnNpb24gPSBwYXJzZXIucmVhZFZlcnNpb24oKTsKCSAgICAgICAgdmFyIGVjTGV2ZWwgPSBwYXJzZXIucmVhZEZvcm1hdEluZm9ybWF0aW9uKCkuZ2V0RXJyb3JDb3JyZWN0aW9uTGV2ZWwoKTsKCSAgICAgICAgLy8gUmVhZCBjb2Rld29yZHMKCSAgICAgICAgdmFyIGNvZGV3b3JkcyA9IHBhcnNlci5yZWFkQ29kZXdvcmRzKCk7CgkgICAgICAgIC8vIFNlcGFyYXRlIGludG8gZGF0YSBibG9ja3MKCSAgICAgICAgdmFyIGRhdGFCbG9ja3MgPSBEYXRhQmxvY2tfMS5kZWZhdWx0LmdldERhdGFCbG9ja3MoY29kZXdvcmRzLCB2ZXJzaW9uLCBlY0xldmVsKTsKCSAgICAgICAgLy8gQ291bnQgdG90YWwgbnVtYmVyIG9mIGRhdGEgYnl0ZXMKCSAgICAgICAgdmFyIHRvdGFsQnl0ZXMgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgZGF0YUJsb2Nrc18xID0gX192YWx1ZXMkMihkYXRhQmxvY2tzKSwgZGF0YUJsb2Nrc18xXzEgPSBkYXRhQmxvY2tzXzEubmV4dCgpOyAhZGF0YUJsb2Nrc18xXzEuZG9uZTsgZGF0YUJsb2Nrc18xXzEgPSBkYXRhQmxvY2tzXzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRhdGFCbG9jayA9IGRhdGFCbG9ja3NfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgIHRvdGFsQnl0ZXMgKz0gZGF0YUJsb2NrLmdldE51bURhdGFDb2Rld29yZHMoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGRhdGFCbG9ja3NfMV8xICYmICFkYXRhQmxvY2tzXzFfMS5kb25lICYmIChfYSA9IGRhdGFCbG9ja3NfMS5yZXR1cm4pKSBfYS5jYWxsKGRhdGFCbG9ja3NfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkodG90YWxCeXRlcyk7CgkgICAgICAgIHZhciByZXN1bHRPZmZzZXQgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgLy8gRXJyb3ItY29ycmVjdCBhbmQgY29weSBkYXRhIGJsb2NrcyB0b2dldGhlciBpbnRvIGEgc3RyZWFtIG9mIGJ5dGVzCgkgICAgICAgICAgICBmb3IgKHZhciBkYXRhQmxvY2tzXzIgPSBfX3ZhbHVlcyQyKGRhdGFCbG9ja3MpLCBkYXRhQmxvY2tzXzJfMSA9IGRhdGFCbG9ja3NfMi5uZXh0KCk7ICFkYXRhQmxvY2tzXzJfMS5kb25lOyBkYXRhQmxvY2tzXzJfMSA9IGRhdGFCbG9ja3NfMi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZGF0YUJsb2NrID0gZGF0YUJsb2Nrc18yXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgdmFyIGNvZGV3b3JkQnl0ZXMgPSBkYXRhQmxvY2suZ2V0Q29kZXdvcmRzKCk7CgkgICAgICAgICAgICAgICAgdmFyIG51bURhdGFDb2Rld29yZHMgPSBkYXRhQmxvY2suZ2V0TnVtRGF0YUNvZGV3b3JkcygpOwoJICAgICAgICAgICAgICAgIHRoaXMuY29ycmVjdEVycm9ycyhjb2Rld29yZEJ5dGVzLCBudW1EYXRhQ29kZXdvcmRzKTsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bURhdGFDb2Rld29yZHM7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHRCeXRlc1tyZXN1bHRPZmZzZXQrK10gPSBjb2Rld29yZEJ5dGVzW2ldOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8yXzEpIHsgZV8yID0geyBlcnJvcjogZV8yXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGRhdGFCbG9ja3NfMl8xICYmICFkYXRhQmxvY2tzXzJfMS5kb25lICYmIChfYiA9IGRhdGFCbG9ja3NfMi5yZXR1cm4pKSBfYi5jYWxsKGRhdGFCbG9ja3NfMik7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMikgdGhyb3cgZV8yLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gRGVjb2RlIHRoZSBjb250ZW50cyBvZiB0aGF0IHN0cmVhbSBvZiBieXRlcwoJICAgICAgICByZXR1cm4gRGVjb2RlZEJpdFN0cmVhbVBhcnNlcl8xLmRlZmF1bHQuZGVjb2RlKHJlc3VsdEJ5dGVzLCB2ZXJzaW9uLCBlY0xldmVsLCBoaW50cyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5HaXZlbiBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyByZWNlaXZlZCwgcG9zc2libHkgY29ycnVwdGVkIGJ5IGVycm9ycywgYXR0ZW1wdHMgdG8KCSAgICAgKiBjb3JyZWN0IHRoZSBlcnJvcnMgaW4tcGxhY2UgdXNpbmcgUmVlZC1Tb2xvbW9uIGVycm9yIGNvcnJlY3Rpb24uPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGNvZGV3b3JkQnl0ZXMgZGF0YSBhbmQgZXJyb3IgY29ycmVjdGlvbiBjb2Rld29yZHMKCSAgICAgKiBAcGFyYW0gbnVtRGF0YUNvZGV3b3JkcyBudW1iZXIgb2YgY29kZXdvcmRzIHRoYXQgYXJlIGRhdGEgYnl0ZXMKCSAgICAgKiBAdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uIGlmIGVycm9yIGNvcnJlY3Rpb24gZmFpbHMKCSAgICAgKi8KCSAgICBEZWNvZGVyLnByb3RvdHlwZS5jb3JyZWN0RXJyb3JzID0gZnVuY3Rpb24gKGNvZGV3b3JkQnl0ZXMsIG51bURhdGFDb2Rld29yZHMgLyppbnQqLykgewoJICAgICAgICAvLyBjb25zdCBudW1Db2Rld29yZHMgPSBjb2Rld29yZEJ5dGVzLmxlbmd0aDsKCSAgICAgICAgLy8gRmlyc3QgcmVhZCBpbnRvIGFuIGFycmF5IG9mIGludHMKCSAgICAgICAgdmFyIGNvZGV3b3Jkc0ludHMgPSBuZXcgSW50MzJBcnJheShjb2Rld29yZEJ5dGVzKTsKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IG5vdCByZWFseSBuZWNlc3NhcnkgdG8gdHJhbnNmb3JtIHRvIGludHM/IGNvdWxkIHJlZGVzaWduIGV2ZXJ5dGhpbmcgdG8gd29yayB3aXRoIHVuc2lnbmVkIGJ5dGVzPwoJICAgICAgICAvLyBjb25zdCBjb2Rld29yZHNJbnRzID0gbmV3IEludDMyQXJyYXkobnVtQ29kZXdvcmRzKQoJICAgICAgICAvLyBmb3IgKGxldCBpID0gMDsgaSA8IG51bUNvZGV3b3JkczsgaSsrKSB7CgkgICAgICAgIC8vICAgY29kZXdvcmRzSW50c1tpXSA9IGNvZGV3b3JkQnl0ZXNbaV0gJiAweEZGCgkgICAgICAgIC8vIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHRoaXMucnNEZWNvZGVyLmRlY29kZShjb2Rld29yZHNJbnRzLCBjb2Rld29yZEJ5dGVzLmxlbmd0aCAtIG51bURhdGFDb2Rld29yZHMpOwoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChpZ25vcmVkIC8qOiBSZWVkU29sb21vbkV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgQ2hlY2tzdW1FeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29weSBiYWNrIGludG8gYXJyYXkgb2YgYnl0ZXMgLS0gb25seSBuZWVkIHRvIHdvcnJ5IGFib3V0IHRoZSBieXRlcyB0aGF0IHdlcmUgZGF0YQoJICAgICAgICAvLyBXZSBkb24ndCBjYXJlIGFib3V0IGVycm9ycyBpbiB0aGUgZXJyb3ItY29ycmVjdGlvbiBjb2Rld29yZHMKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1EYXRhQ29kZXdvcmRzOyBpKyspIHsKCSAgICAgICAgICAgIGNvZGV3b3JkQnl0ZXNbaV0gPSAvKihieXRlKSAqLyBjb2Rld29yZHNJbnRzW2ldOwoJICAgICAgICB9CgkgICAgfTsKCSAgICByZXR1cm4gRGVjb2RlcjsKCX0oKSk7CglEZWNvZGVyJDEuZGVmYXVsdCA9IERlY29kZXI7CgoJdmFyIERldGVjdG9yJDEgPSB7fTsKCgl2YXIgTWF0aFV0aWxzJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMTIgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KE1hdGhVdGlscyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbi5kZXRlY3RvciB7Ki8KCS8qKgoJICogR2VuZXJhbCBtYXRoLXJlbGF0ZWQgYW5kIG51bWVyaWMgdXRpbGl0eSBmdW5jdGlvbnMuCgkgKi8KCXZhciBNYXRoVXRpbHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gTWF0aFV0aWxzKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiBFbmRzIHVwIGJlaW5nIGEgYml0IGZhc3RlciB0aGFuIHtAbGluayBNYXRoI3JvdW5kKGZsb2F0KX0uIFRoaXMgbWVyZWx5IHJvdW5kcyBpdHMKCSAgICAgKiBhcmd1bWVudCB0byB0aGUgbmVhcmVzdCBpbnQsIHdoZXJlIHguNSByb3VuZHMgdXAgdG8geCsxLiBTZW1hbnRpY3Mgb2YgdGhpcyBzaG9ydGN1dAoJICAgICAqIGRpZmZlciBzbGlnaHRseSBmcm9tIHtAbGluayBNYXRoI3JvdW5kKGZsb2F0KX0gaW4gdGhhdCBoYWxmIHJvdW5kcyBkb3duIGZvciBuZWdhdGl2ZQoJICAgICAqIHZhbHVlcy4gLTIuNSByb3VuZHMgdG8gLTMsIG5vdCAtMi4gRm9yIHB1cnBvc2VzIGhlcmUgaXQgbWFrZXMgbm8gZGlmZmVyZW5jZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBkIHJlYWwgdmFsdWUgdG8gcm91bmQKCSAgICAgKiBAcmV0dXJuIG5lYXJlc3Qge0Bjb2RlIGludH0KCSAgICAgKi8KCSAgICBNYXRoVXRpbHMucm91bmQgPSBmdW5jdGlvbiAoZCAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE5hTiA9PT0gZCkKCSAgICAgICAgICAgIHJldHVybiAwOwoJICAgICAgICBpZiAoZCA8PSBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUikKCSAgICAgICAgICAgIHJldHVybiBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUjsKCSAgICAgICAgaWYgKGQgPj0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIpCgkgICAgICAgICAgICByZXR1cm4gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgICAgIHJldHVybiAvKihpbnQpICovIChkICsgKGQgPCAwLjAgPyAtMC41IDogMC41KSkgfCAwOwoJICAgIH07CgkgICAgLy8gVFlQRVNDUklQVFBPUlQ6IG1heWJlIHJlbW92ZSByb3VuZCBtZXRob2QgYW5kIGNhbGwgZGlyZWN0bHkgTWF0aC5yb3VuZCwgaXQgbG9va3MgbGlrZSBpdCBkb2Vzbid0IG1ha2Ugc2Vuc2UgZm9yIGpzCgkgICAgLyoqCgkgICAgICogQHBhcmFtIGFYIHBvaW50IEEgeCBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGFZIHBvaW50IEEgeSBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGJYIHBvaW50IEIgeCBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGJZIHBvaW50IEIgeSBjb29yZGluYXRlCgkgICAgICogQHJldHVybiBFdWNsaWRlYW4gZGlzdGFuY2UgYmV0d2VlbiBwb2ludHMgQSBhbmQgQgoJICAgICAqLwoJICAgIE1hdGhVdGlscy5kaXN0YW5jZSA9IGZ1bmN0aW9uIChhWCAvKmZsb2F0fGludCovLCBhWSAvKmZsb2F0fGludCovLCBiWCAvKmZsb2F0fGludCovLCBiWSAvKmZsb2F0fGludCovKSB7CgkgICAgICAgIHZhciB4RGlmZiA9IGFYIC0gYlg7CgkgICAgICAgIHZhciB5RGlmZiA9IGFZIC0gYlk7CgkgICAgICAgIHJldHVybiAvKihmbG9hdCkgKi8gTWF0aC5zcXJ0KHhEaWZmICogeERpZmYgKyB5RGlmZiAqIHlEaWZmKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBhWCBwb2ludCBBIHggY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBhWSBwb2ludCBBIHkgY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBiWCBwb2ludCBCIHggY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBiWSBwb2ludCBCIHkgY29vcmRpbmF0ZQoJICAgICAqIEByZXR1cm4gRXVjbGlkZWFuIGRpc3RhbmNlIGJldHdlZW4gcG9pbnRzIEEgYW5kIEIKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgc3RhdGljIGRpc3RhbmNlKGFYOiBudW1iZXIgLyppbnQqLywgYVk6IG51bWJlciAvKmludCovLCBiWDogbnVtYmVyIC8qaW50Ki8sIGJZOiBudW1iZXIgLyppbnQqLyk6IGZsb2F0IHsKCSAgICAvLyAgIGNvbnN0IHhEaWZmID0gYVggLSBiWAoJICAgIC8vICAgY29uc3QgeURpZmYgPSBhWSAtIGJZCgkgICAgLy8gICByZXR1cm4gKGZsb2F0KSBNYXRoLnNxcnQoeERpZmYgKiB4RGlmZiArIHlEaWZmICogeURpZmYpOwoJICAgIC8vIH0KCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYXJyYXkgdmFsdWVzIHRvIHN1bQoJICAgICAqIEByZXR1cm4gc3VtIG9mIHZhbHVlcyBpbiBhcnJheQoJICAgICAqLwoJICAgIE1hdGhVdGlscy5zdW0gPSBmdW5jdGlvbiAoYXJyYXkpIHsKCSAgICAgICAgdmFyIGNvdW50ID0gMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gYXJyYXkubGVuZ3RoOyBpICE9PSBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgYSA9IGFycmF5W2ldOwoJICAgICAgICAgICAgY291bnQgKz0gYTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gY291bnQ7CgkgICAgfTsKCSAgICByZXR1cm4gTWF0aFV0aWxzOwoJfSgpKTsKCU1hdGhVdGlscyQxLmRlZmF1bHQgPSBNYXRoVXRpbHM7CgoJdmFyIERldGVjdG9yUmVzdWx0JDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KERldGVjdG9yUmVzdWx0JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGV0ZWN0aW5nIGEgYmFyY29kZSBpbiBhbiBpbWFnZS4gVGhpcyBpbmNsdWRlcyB0aGUgcmF3CgkgKiBtYXRyaXggb2YgYmxhY2svd2hpdGUgcGl4ZWxzIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGJhcmNvZGUsIGFuZCBwb3NzaWJseSBwb2ludHMgb2YgaW50ZXJlc3QKCSAqIGluIHRoZSBpbWFnZSwgbGlrZSB0aGUgbG9jYXRpb24gb2YgZmluZGVyIHBhdHRlcm5zIG9yIGNvcm5lcnMgb2YgdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGV0ZWN0b3JSZXN1bHQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gRGV0ZWN0b3JSZXN1bHQoYml0cywgcG9pbnRzKSB7CgkgICAgICAgIHRoaXMuYml0cyA9IGJpdHM7CgkgICAgICAgIHRoaXMucG9pbnRzID0gcG9pbnRzOwoJICAgIH0KCSAgICBEZXRlY3RvclJlc3VsdC5wcm90b3R5cGUuZ2V0Qml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYml0czsKCSAgICB9OwoJICAgIERldGVjdG9yUmVzdWx0LnByb3RvdHlwZS5nZXRQb2ludHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnBvaW50czsKCSAgICB9OwoJICAgIHJldHVybiBEZXRlY3RvclJlc3VsdDsKCX0oKSk7CglEZXRlY3RvclJlc3VsdCQxLmRlZmF1bHQgPSBEZXRlY3RvclJlc3VsdDsKCgl2YXIgR3JpZFNhbXBsZXJJbnN0YW5jZSQxID0ge307CgoJdmFyIERlZmF1bHRHcmlkU2FtcGxlciQxID0ge307CgoJdmFyIEdyaWRTYW1wbGVyJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEdyaWRTYW1wbGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDUgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBJbXBsZW1lbnRhdGlvbnMgb2YgdGhpcyBjbGFzcyBjYW4sIGdpdmVuIGxvY2F0aW9ucyBvZiBmaW5kZXIgcGF0dGVybnMgZm9yIGEgUVIgY29kZSBpbiBhbgoJICogaW1hZ2UsIHNhbXBsZSB0aGUgcmlnaHQgcG9pbnRzIGluIHRoZSBpbWFnZSB0byByZWNvbnN0cnVjdCB0aGUgUVIgY29kZSwgYWNjb3VudGluZyBmb3IKCSAqIHBlcnNwZWN0aXZlIGRpc3RvcnRpb24uIEl0IGlzIGFic3RyYWN0ZWQgc2luY2UgaXQgaXMgcmVsYXRpdmVseSBleHBlbnNpdmUgYW5kIHNob3VsZCBiZSBhbGxvd2VkCgkgKiB0byB0YWtlIGFkdmFudGFnZSBvZiBwbGF0Zm9ybS1zcGVjaWZpYyBvcHRpbWl6ZWQgaW1wbGVtZW50YXRpb25zLCBsaWtlIFN1bidzIEphdmEgQWR2YW5jZWQKCSAqIEltYWdpbmcgbGlicmFyeSwgYnV0IHdoaWNoIG1heSBub3QgYmUgYXZhaWxhYmxlIGluIG90aGVyIGVudmlyb25tZW50cyBzdWNoIGFzIEoyTUUsIGFuZCB2aWNlCgkgKiB2ZXJzYS4KCSAqCgkgKiBUaGUgaW1wbGVtZW50YXRpb24gdXNlZCBjYW4gYmUgY29udHJvbGxlZCBieSBjYWxsaW5nIHtAbGluayAjc2V0R3JpZFNhbXBsZXIoR3JpZFNhbXBsZXIpfQoJICogd2l0aCBhbiBpbnN0YW5jZSBvZiBhIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgdGhpcyBpbnRlcmZhY2UuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEdyaWRTYW1wbGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEdyaWRTYW1wbGVyKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5DaGVja3MgYSBzZXQgb2YgcG9pbnRzIHRoYXQgaGF2ZSBiZWVuIHRyYW5zZm9ybWVkIHRvIHNhbXBsZSBwb2ludHMgb24gYW4gaW1hZ2UgYWdhaW5zdAoJICAgICAqIHRoZSBpbWFnZSdzIGRpbWVuc2lvbnMgdG8gc2VlIGlmIHRoZSBwb2ludCBhcmUgZXZlbiB3aXRoaW4gdGhlIGltYWdlLjwvcD4KCSAgICAgKgoJICAgICAqIDxwPlRoaXMgbWV0aG9kIHdpbGwgYWN0dWFsbHkgIm51ZGdlIiB0aGUgZW5kcG9pbnRzIGJhY2sgb250byB0aGUgaW1hZ2UgaWYgdGhleSBhcmUgZm91bmQgdG8gYmUKCSAgICAgKiBiYXJlbHkgKGxlc3MgdGhhbiAxIHBpeGVsKSBvZmYgdGhlIGltYWdlLiBUaGlzIGFjY291bnRzIGZvciBpbXBlcmZlY3QgZGV0ZWN0aW9uIG9mIGZpbmRlcgoJICAgICAqIHBhdHRlcm5zIGluIGFuIGltYWdlIHdoZXJlIHRoZSBRUiBDb2RlIHJ1bnMgYWxsIHRoZSB3YXkgdG8gdGhlIGltYWdlIGJvcmRlci48L3A+CgkgICAgICoKCSAgICAgKiA8cD5Gb3IgZWZmaWNpZW5jeSwgdGhlIG1ldGhvZCB3aWxsIGNoZWNrIHBvaW50cyBmcm9tIGVpdGhlciBlbmQgb2YgdGhlIGxpbmUgdW50aWwgb25lIGlzIGZvdW5kCgkgICAgICogdG8gYmUgd2l0aGluIHRoZSBpbWFnZS4gQmVjYXVzZSB0aGUgc2V0IG9mIHBvaW50cyBhcmUgYXNzdW1lZCB0byBiZSBsaW5lYXIsIHRoaXMgaXMgdmFsaWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGltYWdlIGltYWdlIGludG8gd2hpY2ggdGhlIHBvaW50cyBzaG91bGQgbWFwCgkgICAgICogQHBhcmFtIHBvaW50cyBhY3R1YWwgcG9pbnRzIGluIHgxLHkxLC4uLix4bix5biBmb3JtCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBhbiBlbmRwb2ludCBpcyBsaWVzIG91dHNpZGUgdGhlIGltYWdlIGJvdW5kYXJpZXMKCSAgICAgKi8KCSAgICBHcmlkU2FtcGxlci5jaGVja0FuZE51ZGdlUG9pbnRzID0gZnVuY3Rpb24gKGltYWdlLCBwb2ludHMpIHsKCSAgICAgICAgdmFyIHdpZHRoID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IGltYWdlLmdldEhlaWdodCgpOwoJICAgICAgICAvLyBDaGVjayBhbmQgbnVkZ2UgcG9pbnRzIGZyb20gc3RhcnQgdW50aWwgd2Ugc2VlIHNvbWUgdGhhdCBhcmUgT0s6CgkgICAgICAgIHZhciBudWRnZWQgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBvZmZzZXQgPSAwOyBvZmZzZXQgPCBwb2ludHMubGVuZ3RoICYmIG51ZGdlZDsgb2Zmc2V0ICs9IDIpIHsKCSAgICAgICAgICAgIHZhciB4ID0gTWF0aC5mbG9vcihwb2ludHNbb2Zmc2V0XSk7CgkgICAgICAgICAgICB2YXIgeSA9IE1hdGguZmxvb3IocG9pbnRzW29mZnNldCArIDFdKTsKCSAgICAgICAgICAgIGlmICh4IDwgLTEgfHwgeCA+IHdpZHRoIHx8IHkgPCAtMSB8fCB5ID4gaGVpZ2h0KSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBudWRnZWQgPSBmYWxzZTsKCSAgICAgICAgICAgIGlmICh4ID09PSAtMSkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXRdID0gMC4wOwoJICAgICAgICAgICAgICAgIG51ZGdlZCA9IHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIGlmICh4ID09PSB3aWR0aCkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXRdID0gd2lkdGggLSAxOwoJICAgICAgICAgICAgICAgIG51ZGdlZCA9IHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAoeSA9PT0gLTEpIHsKCSAgICAgICAgICAgICAgICBwb2ludHNbb2Zmc2V0ICsgMV0gPSAwLjA7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHkgPT09IGhlaWdodCkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXQgKyAxXSA9IGhlaWdodCAtIDE7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICAvLyBDaGVjayBhbmQgbnVkZ2UgcG9pbnRzIGZyb20gZW5kOgoJICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBvZmZzZXQgPSBwb2ludHMubGVuZ3RoIC0gMjsgb2Zmc2V0ID49IDAgJiYgbnVkZ2VkOyBvZmZzZXQgLT0gMikgewoJICAgICAgICAgICAgdmFyIHggPSBNYXRoLmZsb29yKHBvaW50c1tvZmZzZXRdKTsKCSAgICAgICAgICAgIHZhciB5ID0gTWF0aC5mbG9vcihwb2ludHNbb2Zmc2V0ICsgMV0pOwoJICAgICAgICAgICAgaWYgKHggPCAtMSB8fCB4ID4gd2lkdGggfHwgeSA8IC0xIHx8IHkgPiBoZWlnaHQpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQ1LmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIG51ZGdlZCA9IGZhbHNlOwoJICAgICAgICAgICAgaWYgKHggPT09IC0xKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldF0gPSAwLjA7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHggPT09IHdpZHRoKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldF0gPSB3aWR0aCAtIDE7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmICh5ID09PSAtMSkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXQgKyAxXSA9IDAuMDsKCSAgICAgICAgICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSBpZiAoeSA9PT0gaGVpZ2h0KSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldCArIDFdID0gaGVpZ2h0IC0gMTsKCSAgICAgICAgICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICByZXR1cm4gR3JpZFNhbXBsZXI7Cgl9KCkpOwoJR3JpZFNhbXBsZXIkMS5kZWZhdWx0ID0gR3JpZFNhbXBsZXI7CgoJdmFyIFBlcnNwZWN0aXZlVHJhbnNmb3JtJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFBlcnNwZWN0aXZlVHJhbnNmb3JtJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyoqCgkgKiA8cD5UaGlzIGNsYXNzIGltcGxlbWVudHMgYSBwZXJzcGVjdGl2ZSB0cmFuc2Zvcm0gaW4gdHdvIGRpbWVuc2lvbnMuIEdpdmVuIGZvdXIgc291cmNlIGFuZCBmb3VyCgkgKiBkZXN0aW5hdGlvbiBwb2ludHMsIGl0IHdpbGwgY29tcHV0ZSB0aGUgdHJhbnNmb3JtYXRpb24gaW1wbGllZCBiZXR3ZWVuIHRoZW0uIFRoZSBjb2RlIGlzIGJhc2VkCgkgKiBkaXJlY3RseSB1cG9uIHNlY3Rpb24gMy40LjIgb2YgR2VvcmdlIFdvbGJlcmcncyAiRGlnaXRhbCBJbWFnZSBXYXJwaW5nIjsgc2VlIHBhZ2VzIDU0LTU2LjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUGVyc3BlY3RpdmVUcmFuc2Zvcm0gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUGVyc3BlY3RpdmVUcmFuc2Zvcm0oYTExIC8qZmxvYXQqLywgYTIxIC8qZmxvYXQqLywgYTMxIC8qZmxvYXQqLywgYTEyIC8qZmxvYXQqLywgYTIyIC8qZmxvYXQqLywgYTMyIC8qZmxvYXQqLywgYTEzIC8qZmxvYXQqLywgYTIzIC8qZmxvYXQqLywgYTMzIC8qZmxvYXQqLykgewoJICAgICAgICB0aGlzLmExMSA9IGExMTsKCSAgICAgICAgdGhpcy5hMjEgPSBhMjE7CgkgICAgICAgIHRoaXMuYTMxID0gYTMxOwoJICAgICAgICB0aGlzLmExMiA9IGExMjsKCSAgICAgICAgdGhpcy5hMjIgPSBhMjI7CgkgICAgICAgIHRoaXMuYTMyID0gYTMyOwoJICAgICAgICB0aGlzLmExMyA9IGExMzsKCSAgICAgICAgdGhpcy5hMjMgPSBhMjM7CgkgICAgICAgIHRoaXMuYTMzID0gYTMzOwoJICAgIH0KCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5xdWFkcmlsYXRlcmFsVG9RdWFkcmlsYXRlcmFsID0gZnVuY3Rpb24gKHgwIC8qZmxvYXQqLywgeTAgLypmbG9hdCovLCB4MSAvKmZsb2F0Ki8sIHkxIC8qZmxvYXQqLywgeDIgLypmbG9hdCovLCB5MiAvKmZsb2F0Ki8sIHgzIC8qZmxvYXQqLywgeTMgLypmbG9hdCovLCB4MHAgLypmbG9hdCovLCB5MHAgLypmbG9hdCovLCB4MXAgLypmbG9hdCovLCB5MXAgLypmbG9hdCovLCB4MnAgLypmbG9hdCovLCB5MnAgLypmbG9hdCovLCB4M3AgLypmbG9hdCovLCB5M3AgLypmbG9hdCovKSB7CgkgICAgICAgIHZhciBxVG9TID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm0ucXVhZHJpbGF0ZXJhbFRvU3F1YXJlKHgwLCB5MCwgeDEsIHkxLCB4MiwgeTIsIHgzLCB5Myk7CgkgICAgICAgIHZhciBzVG9RID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm0uc3F1YXJlVG9RdWFkcmlsYXRlcmFsKHgwcCwgeTBwLCB4MXAsIHkxcCwgeDJwLCB5MnAsIHgzcCwgeTNwKTsKCSAgICAgICAgcmV0dXJuIHNUb1EudGltZXMocVRvUyk7CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5wcm90b3R5cGUudHJhbnNmb3JtUG9pbnRzID0gZnVuY3Rpb24gKHBvaW50cykgewoJICAgICAgICB2YXIgbWF4ID0gcG9pbnRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGExMSA9IHRoaXMuYTExOwoJICAgICAgICB2YXIgYTEyID0gdGhpcy5hMTI7CgkgICAgICAgIHZhciBhMTMgPSB0aGlzLmExMzsKCSAgICAgICAgdmFyIGEyMSA9IHRoaXMuYTIxOwoJICAgICAgICB2YXIgYTIyID0gdGhpcy5hMjI7CgkgICAgICAgIHZhciBhMjMgPSB0aGlzLmEyMzsKCSAgICAgICAgdmFyIGEzMSA9IHRoaXMuYTMxOwoJICAgICAgICB2YXIgYTMyID0gdGhpcy5hMzI7CgkgICAgICAgIHZhciBhMzMgPSB0aGlzLmEzMzsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXg7IGkgKz0gMikgewoJICAgICAgICAgICAgdmFyIHggPSBwb2ludHNbaV07CgkgICAgICAgICAgICB2YXIgeSA9IHBvaW50c1tpICsgMV07CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3IgPSBhMTMgKiB4ICsgYTIzICogeSArIGEzMzsKCSAgICAgICAgICAgIHBvaW50c1tpXSA9IChhMTEgKiB4ICsgYTIxICogeSArIGEzMSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHBvaW50c1tpICsgMV0gPSAoYTEyICogeCArIGEyMiAqIHkgKyBhMzIpIC8gZGVub21pbmF0b3I7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnByb3RvdHlwZS50cmFuc2Zvcm1Qb2ludHNXaXRoVmFsdWVzID0gZnVuY3Rpb24gKHhWYWx1ZXMsIHlWYWx1ZXMpIHsKCSAgICAgICAgdmFyIGExMSA9IHRoaXMuYTExOwoJICAgICAgICB2YXIgYTEyID0gdGhpcy5hMTI7CgkgICAgICAgIHZhciBhMTMgPSB0aGlzLmExMzsKCSAgICAgICAgdmFyIGEyMSA9IHRoaXMuYTIxOwoJICAgICAgICB2YXIgYTIyID0gdGhpcy5hMjI7CgkgICAgICAgIHZhciBhMjMgPSB0aGlzLmEyMzsKCSAgICAgICAgdmFyIGEzMSA9IHRoaXMuYTMxOwoJICAgICAgICB2YXIgYTMyID0gdGhpcy5hMzI7CgkgICAgICAgIHZhciBhMzMgPSB0aGlzLmEzMzsKCSAgICAgICAgdmFyIG4gPSB4VmFsdWVzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHsKCSAgICAgICAgICAgIHZhciB4ID0geFZhbHVlc1tpXTsKCSAgICAgICAgICAgIHZhciB5ID0geVZhbHVlc1tpXTsKCSAgICAgICAgICAgIHZhciBkZW5vbWluYXRvciA9IGExMyAqIHggKyBhMjMgKiB5ICsgYTMzOwoJICAgICAgICAgICAgeFZhbHVlc1tpXSA9IChhMTEgKiB4ICsgYTIxICogeSArIGEzMSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHlWYWx1ZXNbaV0gPSAoYTEyICogeCArIGEyMiAqIHkgKyBhMzIpIC8gZGVub21pbmF0b3I7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnNxdWFyZVRvUXVhZHJpbGF0ZXJhbCA9IGZ1bmN0aW9uICh4MCAvKmZsb2F0Ki8sIHkwIC8qZmxvYXQqLywgeDEgLypmbG9hdCovLCB5MSAvKmZsb2F0Ki8sIHgyIC8qZmxvYXQqLywgeTIgLypmbG9hdCovLCB4MyAvKmZsb2F0Ki8sIHkzIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgZHgzID0geDAgLSB4MSArIHgyIC0geDM7CgkgICAgICAgIHZhciBkeTMgPSB5MCAtIHkxICsgeTIgLSB5MzsKCSAgICAgICAgaWYgKGR4MyA9PT0gMC4wICYmIGR5MyA9PT0gMC4wKSB7CgkgICAgICAgICAgICAvLyBBZmZpbmUKCSAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc3BlY3RpdmVUcmFuc2Zvcm0oeDEgLSB4MCwgeDIgLSB4MSwgeDAsIHkxIC0geTAsIHkyIC0geTEsIHkwLCAwLjAsIDAuMCwgMS4wKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHZhciBkeDEgPSB4MSAtIHgyOwoJICAgICAgICAgICAgdmFyIGR4MiA9IHgzIC0geDI7CgkgICAgICAgICAgICB2YXIgZHkxID0geTEgLSB5MjsKCSAgICAgICAgICAgIHZhciBkeTIgPSB5MyAtIHkyOwoJICAgICAgICAgICAgdmFyIGRlbm9taW5hdG9yID0gZHgxICogZHkyIC0gZHgyICogZHkxOwoJICAgICAgICAgICAgdmFyIGExMyA9IChkeDMgKiBkeTIgLSBkeDIgKiBkeTMpIC8gZGVub21pbmF0b3I7CgkgICAgICAgICAgICB2YXIgYTIzID0gKGR4MSAqIGR5MyAtIGR4MyAqIGR5MSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc3BlY3RpdmVUcmFuc2Zvcm0oeDEgLSB4MCArIGExMyAqIHgxLCB4MyAtIHgwICsgYTIzICogeDMsIHgwLCB5MSAtIHkwICsgYTEzICogeTEsIHkzIC0geTAgKyBhMjMgKiB5MywgeTAsIGExMywgYTIzLCAxLjApOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5xdWFkcmlsYXRlcmFsVG9TcXVhcmUgPSBmdW5jdGlvbiAoeDAgLypmbG9hdCovLCB5MCAvKmZsb2F0Ki8sIHgxIC8qZmxvYXQqLywgeTEgLypmbG9hdCovLCB4MiAvKmZsb2F0Ki8sIHkyIC8qZmxvYXQqLywgeDMgLypmbG9hdCovLCB5MyAvKmZsb2F0Ki8pIHsKCSAgICAgICAgLy8gSGVyZSwgdGhlIGFkam9pbnQgc2VydmVzIGFzIHRoZSBpbnZlcnNlOgoJICAgICAgICByZXR1cm4gUGVyc3BlY3RpdmVUcmFuc2Zvcm0uc3F1YXJlVG9RdWFkcmlsYXRlcmFsKHgwLCB5MCwgeDEsIHkxLCB4MiwgeTIsIHgzLCB5MykuYnVpbGRBZGpvaW50KCk7CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5wcm90b3R5cGUuYnVpbGRBZGpvaW50ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBBZGpvaW50IGlzIHRoZSB0cmFuc3Bvc2Ugb2YgdGhlIGNvZmFjdG9yIG1hdHJpeDoKCSAgICAgICAgcmV0dXJuIG5ldyBQZXJzcGVjdGl2ZVRyYW5zZm9ybSh0aGlzLmEyMiAqIHRoaXMuYTMzIC0gdGhpcy5hMjMgKiB0aGlzLmEzMiwgdGhpcy5hMjMgKiB0aGlzLmEzMSAtIHRoaXMuYTIxICogdGhpcy5hMzMsIHRoaXMuYTIxICogdGhpcy5hMzIgLSB0aGlzLmEyMiAqIHRoaXMuYTMxLCB0aGlzLmExMyAqIHRoaXMuYTMyIC0gdGhpcy5hMTIgKiB0aGlzLmEzMywgdGhpcy5hMTEgKiB0aGlzLmEzMyAtIHRoaXMuYTEzICogdGhpcy5hMzEsIHRoaXMuYTEyICogdGhpcy5hMzEgLSB0aGlzLmExMSAqIHRoaXMuYTMyLCB0aGlzLmExMiAqIHRoaXMuYTIzIC0gdGhpcy5hMTMgKiB0aGlzLmEyMiwgdGhpcy5hMTMgKiB0aGlzLmEyMSAtIHRoaXMuYTExICogdGhpcy5hMjMsIHRoaXMuYTExICogdGhpcy5hMjIgLSB0aGlzLmExMiAqIHRoaXMuYTIxKTsKCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnByb3RvdHlwZS50aW1lcyA9IGZ1bmN0aW9uIChvdGhlcikgewoJICAgICAgICByZXR1cm4gbmV3IFBlcnNwZWN0aXZlVHJhbnNmb3JtKHRoaXMuYTExICogb3RoZXIuYTExICsgdGhpcy5hMjEgKiBvdGhlci5hMTIgKyB0aGlzLmEzMSAqIG90aGVyLmExMywgdGhpcy5hMTEgKiBvdGhlci5hMjEgKyB0aGlzLmEyMSAqIG90aGVyLmEyMiArIHRoaXMuYTMxICogb3RoZXIuYTIzLCB0aGlzLmExMSAqIG90aGVyLmEzMSArIHRoaXMuYTIxICogb3RoZXIuYTMyICsgdGhpcy5hMzEgKiBvdGhlci5hMzMsIHRoaXMuYTEyICogb3RoZXIuYTExICsgdGhpcy5hMjIgKiBvdGhlci5hMTIgKyB0aGlzLmEzMiAqIG90aGVyLmExMywgdGhpcy5hMTIgKiBvdGhlci5hMjEgKyB0aGlzLmEyMiAqIG90aGVyLmEyMiArIHRoaXMuYTMyICogb3RoZXIuYTIzLCB0aGlzLmExMiAqIG90aGVyLmEzMSArIHRoaXMuYTIyICogb3RoZXIuYTMyICsgdGhpcy5hMzIgKiBvdGhlci5hMzMsIHRoaXMuYTEzICogb3RoZXIuYTExICsgdGhpcy5hMjMgKiBvdGhlci5hMTIgKyB0aGlzLmEzMyAqIG90aGVyLmExMywgdGhpcy5hMTMgKiBvdGhlci5hMjEgKyB0aGlzLmEyMyAqIG90aGVyLmEyMiArIHRoaXMuYTMzICogb3RoZXIuYTIzLCB0aGlzLmExMyAqIG90aGVyLmEzMSArIHRoaXMuYTIzICogb3RoZXIuYTMyICsgdGhpcy5hMzMgKiBvdGhlci5hMzMpOwoJICAgIH07CgkgICAgcmV0dXJuIFBlcnNwZWN0aXZlVHJhbnNmb3JtOwoJfSgpKTsKCVBlcnNwZWN0aXZlVHJhbnNmb3JtJDEuZGVmYXVsdCA9IFBlcnNwZWN0aXZlVHJhbnNmb3JtOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDIgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGVmYXVsdEdyaWRTYW1wbGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJdmFyIEdyaWRTYW1wbGVyXzEgPSBHcmlkU2FtcGxlciQxOwoJdmFyIEJpdE1hdHJpeF8xJDEgPSBCaXRNYXRyaXgkMTsKCXZhciBQZXJzcGVjdGl2ZVRyYW5zZm9ybV8xJDEgPSBQZXJzcGVjdGl2ZVRyYW5zZm9ybSQxOwoJdmFyIE5vdEZvdW5kRXhjZXB0aW9uXzEkNCA9IE5vdEZvdW5kRXhjZXB0aW9uJDE7CgkvKioKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBEZWZhdWx0R3JpZFNhbXBsZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDIoRGVmYXVsdEdyaWRTYW1wbGVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIERlZmF1bHRHcmlkU2FtcGxlcigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICAvKkBPdmVycmlkZSovCgkgICAgRGVmYXVsdEdyaWRTYW1wbGVyLnByb3RvdHlwZS5zYW1wbGVHcmlkID0gZnVuY3Rpb24gKGltYWdlLCBkaW1lbnNpb25YIC8qaW50Ki8sIGRpbWVuc2lvblkgLyppbnQqLywgcDFUb1ggLypmbG9hdCovLCBwMVRvWSAvKmZsb2F0Ki8sIHAyVG9YIC8qZmxvYXQqLywgcDJUb1kgLypmbG9hdCovLCBwM1RvWCAvKmZsb2F0Ki8sIHAzVG9ZIC8qZmxvYXQqLywgcDRUb1ggLypmbG9hdCovLCBwNFRvWSAvKmZsb2F0Ki8sIHAxRnJvbVggLypmbG9hdCovLCBwMUZyb21ZIC8qZmxvYXQqLywgcDJGcm9tWCAvKmZsb2F0Ki8sIHAyRnJvbVkgLypmbG9hdCovLCBwM0Zyb21YIC8qZmxvYXQqLywgcDNGcm9tWSAvKmZsb2F0Ki8sIHA0RnJvbVggLypmbG9hdCovLCBwNEZyb21ZIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgdHJhbnNmb3JtID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm1fMSQxLmRlZmF1bHQucXVhZHJpbGF0ZXJhbFRvUXVhZHJpbGF0ZXJhbChwMVRvWCwgcDFUb1ksIHAyVG9YLCBwMlRvWSwgcDNUb1gsIHAzVG9ZLCBwNFRvWCwgcDRUb1ksIHAxRnJvbVgsIHAxRnJvbVksIHAyRnJvbVgsIHAyRnJvbVksIHAzRnJvbVgsIHAzRnJvbVksIHA0RnJvbVgsIHA0RnJvbVkpOwoJICAgICAgICByZXR1cm4gdGhpcy5zYW1wbGVHcmlkV2l0aFRyYW5zZm9ybShpbWFnZSwgZGltZW5zaW9uWCwgZGltZW5zaW9uWSwgdHJhbnNmb3JtKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBEZWZhdWx0R3JpZFNhbXBsZXIucHJvdG90eXBlLnNhbXBsZUdyaWRXaXRoVHJhbnNmb3JtID0gZnVuY3Rpb24gKGltYWdlLCBkaW1lbnNpb25YIC8qaW50Ki8sIGRpbWVuc2lvblkgLyppbnQqLywgdHJhbnNmb3JtKSB7CgkgICAgICAgIGlmIChkaW1lbnNpb25YIDw9IDAgfHwgZGltZW5zaW9uWSA8PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRNYXRyaXhfMSQxLmRlZmF1bHQoZGltZW5zaW9uWCwgZGltZW5zaW9uWSk7CgkgICAgICAgIHZhciBwb2ludHMgPSBuZXcgRmxvYXQzMkFycmF5KDIgKiBkaW1lbnNpb25YKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBkaW1lbnNpb25ZOyB5KyspIHsKCSAgICAgICAgICAgIHZhciBtYXggPSBwb2ludHMubGVuZ3RoOwoJICAgICAgICAgICAgdmFyIGlWYWx1ZSA9IHkgKyAwLjU7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1heDsgeCArPSAyKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW3hdID0gKHggLyAyKSArIDAuNTsKCSAgICAgICAgICAgICAgICBwb2ludHNbeCArIDFdID0gaVZhbHVlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdHJhbnNmb3JtLnRyYW5zZm9ybVBvaW50cyhwb2ludHMpOwoJICAgICAgICAgICAgLy8gUXVpY2sgY2hlY2sgdG8gc2VlIGlmIHBvaW50cyB0cmFuc2Zvcm1lZCB0byBzb21ldGhpbmcgaW5zaWRlIHRoZSBpbWFnZQoJICAgICAgICAgICAgLy8gc3VmZmljaWVudCB0byBjaGVjayB0aGUgZW5kcG9pbnRzCgkgICAgICAgICAgICBHcmlkU2FtcGxlcl8xLmRlZmF1bHQuY2hlY2tBbmROdWRnZVBvaW50cyhpbWFnZSwgcG9pbnRzKTsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBtYXg7IHggKz0gMikgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaW1hZ2UuZ2V0KE1hdGguZmxvb3IocG9pbnRzW3hdKSwgTWF0aC5mbG9vcihwb2ludHNbeCArIDFdKSkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJsYWNrKC1pc2gpIHBpeGVsCgkgICAgICAgICAgICAgICAgICAgICAgICBiaXRzLnNldCh4IC8gMiwgeSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjYXRjaCAoYWlvb2JlIC8qOiBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24qLykgewoJICAgICAgICAgICAgICAgIC8vIFRoaXMgZmVlbHMgd3JvbmcsIGJ1dCwgc29tZXRpbWVzIGlmIHRoZSBmaW5kZXIgcGF0dGVybnMgYXJlIG1pc2lkZW50aWZpZWQsIHRoZSByZXN1bHRpbmcKCSAgICAgICAgICAgICAgICAvLyB0cmFuc2Zvcm0gZ2V0cyAidHdpc3RlZCIgc3VjaCB0aGF0IGl0IG1hcHMgYSBzdHJhaWdodCBsaW5lIG9mIHBvaW50cyB0byBhIHNldCBvZiBwb2ludHMKCSAgICAgICAgICAgICAgICAvLyB3aG9zZSBlbmRwb2ludHMgYXJlIGluIGJvdW5kcywgYnV0IG90aGVycyBhcmUgbm90LiBUaGVyZSBpcyBwcm9iYWJseSBzb21lIG1hdGhlbWF0aWNhbAoJICAgICAgICAgICAgICAgIC8vIHdheSB0byBkZXRlY3QgdGhpcyBhYm91dCB0aGUgdHJhbnNmb3JtYXRpb24gdGhhdCBJIGRvbid0IGtub3cgeWV0LgoJICAgICAgICAgICAgICAgIC8vIFRoaXMgcmVzdWx0cyBpbiBhbiB1Z2x5IHJ1bnRpbWUgZXhjZXB0aW9uIGRlc3BpdGUgb3VyIGNsZXZlciBjaGVja3MgYWJvdmUgLS0gY2FuJ3QgaGF2ZQoJICAgICAgICAgICAgICAgIC8vIHRoYXQuIFdlIGNvdWxkIGNoZWNrIGVhY2ggcG9pbnQncyBjb29yZGluYXRlcyBidXQgdGhhdCBmZWVscyBkdXBsaWNhdGl2ZS4gV2Ugc2V0dGxlIGZvcgoJICAgICAgICAgICAgICAgIC8vIGNhdGNoaW5nIGFuZCB3cmFwcGluZyBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24uCgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNC5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICByZXR1cm4gRGVmYXVsdEdyaWRTYW1wbGVyOwoJfShHcmlkU2FtcGxlcl8xLmRlZmF1bHQpKTsKCURlZmF1bHRHcmlkU2FtcGxlciQxLmRlZmF1bHQgPSBEZWZhdWx0R3JpZFNhbXBsZXI7CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEdyaWRTYW1wbGVySW5zdGFuY2UkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIERlZmF1bHRHcmlkU2FtcGxlcl8xID0gRGVmYXVsdEdyaWRTYW1wbGVyJDE7Cgl2YXIgR3JpZFNhbXBsZXJJbnN0YW5jZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBHcmlkU2FtcGxlckluc3RhbmNlKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiBTZXRzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiBHcmlkU2FtcGxlciB1c2VkIGJ5IHRoZSBsaWJyYXJ5LiBPbmUgZ2xvYmFsCgkgICAgICogaW5zdGFuY2UgaXMgc3RvcmVkLCB3aGljaCBtYXkgc291bmQgcHJvYmxlbWF0aWMuIEJ1dCwgdGhlIGltcGxlbWVudGF0aW9uIHByb3ZpZGVkCgkgICAgICogb3VnaHQgdG8gYmUgYXBwcm9wcmlhdGUgZm9yIHRoZSBlbnRpcmUgcGxhdGZvcm0sIGFuZCBhbGwgdXNlcyBvZiB0aGlzIGxpYnJhcnkKCSAgICAgKiBpbiB0aGUgd2hvbGUgbGlmZXRpbWUgb2YgdGhlIEpWTS4gRm9yIGluc3RhbmNlLCBhbiBBbmRyb2lkIGFjdGl2aXR5IGNhbiBzd2FwIGluCgkgICAgICogYW4gaW1wbGVtZW50YXRpb24gdGhhdCB0YWtlcyBhZHZhbnRhZ2Ugb2YgbmF0aXZlIHBsYXRmb3JtIGxpYnJhcmllcy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBuZXdHcmlkU2FtcGxlciBUaGUgcGxhdGZvcm0tc3BlY2lmaWMgb2JqZWN0IHRvIGluc3RhbGwuCgkgICAgICovCgkgICAgR3JpZFNhbXBsZXJJbnN0YW5jZS5zZXRHcmlkU2FtcGxlciA9IGZ1bmN0aW9uIChuZXdHcmlkU2FtcGxlcikgewoJICAgICAgICBHcmlkU2FtcGxlckluc3RhbmNlLmdyaWRTYW1wbGVyID0gbmV3R3JpZFNhbXBsZXI7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHRoZSBjdXJyZW50IGltcGxlbWVudGF0aW9uIG9mIEdyaWRTYW1wbGVyCgkgICAgICovCgkgICAgR3JpZFNhbXBsZXJJbnN0YW5jZS5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIEdyaWRTYW1wbGVySW5zdGFuY2UuZ3JpZFNhbXBsZXI7CgkgICAgfTsKCSAgICBHcmlkU2FtcGxlckluc3RhbmNlLmdyaWRTYW1wbGVyID0gbmV3IERlZmF1bHRHcmlkU2FtcGxlcl8xLmRlZmF1bHQoKTsKCSAgICByZXR1cm4gR3JpZFNhbXBsZXJJbnN0YW5jZTsKCX0oKSk7CglHcmlkU2FtcGxlckluc3RhbmNlJDEuZGVmYXVsdCA9IEdyaWRTYW1wbGVySW5zdGFuY2U7CgoJdmFyIFJlc3VsdFBvaW50JDEgPSB7fTsKCgl2YXIgRmxvYXQkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShGbG9hdCQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKioKCSAqIFBvbnlmaWxsIGZvciBKYXZhJ3MgRmxvYXQgY2xhc3MuCgkgKi8KCXZhciBGbG9hdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBGbG9hdCgpIHsKCSAgICB9CgkgICAgLyoqCgkgICAgICogU2luY1RTIGhhcyBubyBkaWZmZXJlbmNlIGJldHdlZW4gaW50IGFuZCBmbG9hdCwgdGhlcmUncyBhbGwgbnVtYmVycywKCSAgICAgKiB0aGlzIGlzIHVzZWQgb25seSB0byBwb2x5ZmlsbCBKYXZhIGNvZGUuCgkgICAgICovCgkgICAgRmxvYXQuZmxvYXRUb0ludEJpdHMgPSBmdW5jdGlvbiAoZikgewoJICAgICAgICByZXR1cm4gZjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFRoZSBmbG9hdCBtYXggdmFsdWUgaW4gSlMgaXMgdGhlIG51bWJlciBtYXggdmFsdWUuCgkgICAgICovCgkgICAgRmxvYXQuTUFYX1ZBTFVFID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgcmV0dXJuIEZsb2F0OwoJfSgpKTsKCUZsb2F0JDEuZGVmYXVsdCA9IEZsb2F0OwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVzdWx0UG9pbnQkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCXZhciBNYXRoVXRpbHNfMSQxID0gTWF0aFV0aWxzJDE7Cgl2YXIgRmxvYXRfMSA9IEZsb2F0JDE7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIHBvaW50IG9mIGludGVyZXN0IGluIGFuIGltYWdlIGNvbnRhaW5pbmcgYSBiYXJjb2RlLiBUeXBpY2FsbHksIHRoaXMKCSAqIHdvdWxkIGJlIHRoZSBsb2NhdGlvbiBvZiBhIGZpbmRlciBwYXR0ZXJuIG9yIHRoZSBjb3JuZXIgb2YgdGhlIGJhcmNvZGUsIGZvciBleGFtcGxlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUmVzdWx0UG9pbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUmVzdWx0UG9pbnQoeCwgeSkgewoJICAgICAgICB0aGlzLnggPSB4OwoJICAgICAgICB0aGlzLnkgPSB5OwoJICAgIH0KCSAgICBSZXN1bHRQb2ludC5wcm90b3R5cGUuZ2V0WCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMueDsKCSAgICB9OwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5nZXRZID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy55OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2YgUmVzdWx0UG9pbnQpIHsKCSAgICAgICAgICAgIHZhciBvdGhlclBvaW50ID0gb3RoZXI7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy54ID09PSBvdGhlclBvaW50LnggJiYgdGhpcy55ID09PSBvdGhlclBvaW50Lnk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDMxICogRmxvYXRfMS5kZWZhdWx0LmZsb2F0VG9JbnRCaXRzKHRoaXMueCkgKyBGbG9hdF8xLmRlZmF1bHQuZmxvYXRUb0ludEJpdHModGhpcy55KTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBSZXN1bHRQb2ludC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiAnKCcgKyB0aGlzLnggKyAnLCcgKyB0aGlzLnkgKyAnKSc7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBPcmRlcnMgYW4gYXJyYXkgb2YgdGhyZWUgUmVzdWx0UG9pbnRzIGluIGFuIG9yZGVyIFtBLEIsQ10gc3VjaCB0aGF0IEFCIGlzIGxlc3MgdGhhbiBBQwoJICAgICAqIGFuZCBCQyBpcyBsZXNzIHRoYW4gQUMsIGFuZCB0aGUgYW5nbGUgYmV0d2VlbiBCQyBhbmQgQkEgaXMgbGVzcyB0aGFuIDE4MCBkZWdyZWVzLgoJICAgICAqCgkgICAgICogQHBhcmFtIHBhdHRlcm5zIGFycmF5IG9mIHRocmVlIHtAY29kZSBSZXN1bHRQb2ludH0gdG8gb3JkZXIKCSAgICAgKi8KCSAgICBSZXN1bHRQb2ludC5vcmRlckJlc3RQYXR0ZXJucyA9IGZ1bmN0aW9uIChwYXR0ZXJucykgewoJICAgICAgICAvLyBGaW5kIGRpc3RhbmNlcyBiZXR3ZWVuIHBhdHRlcm4gY2VudGVycwoJICAgICAgICB2YXIgemVyb09uZURpc3RhbmNlID0gdGhpcy5kaXN0YW5jZShwYXR0ZXJuc1swXSwgcGF0dGVybnNbMV0pOwoJICAgICAgICB2YXIgb25lVHdvRGlzdGFuY2UgPSB0aGlzLmRpc3RhbmNlKHBhdHRlcm5zWzFdLCBwYXR0ZXJuc1syXSk7CgkgICAgICAgIHZhciB6ZXJvVHdvRGlzdGFuY2UgPSB0aGlzLmRpc3RhbmNlKHBhdHRlcm5zWzBdLCBwYXR0ZXJuc1syXSk7CgkgICAgICAgIHZhciBwb2ludEE7CgkgICAgICAgIHZhciBwb2ludEI7CgkgICAgICAgIHZhciBwb2ludEM7CgkgICAgICAgIC8vIEFzc3VtZSBvbmUgY2xvc2VzdCB0byBvdGhlciB0d28gaXMgQjsgQSBhbmQgQyB3aWxsIGp1c3QgYmUgZ3Vlc3NlcyBhdCBmaXJzdAoJICAgICAgICBpZiAob25lVHdvRGlzdGFuY2UgPj0gemVyb09uZURpc3RhbmNlICYmIG9uZVR3b0Rpc3RhbmNlID49IHplcm9Ud29EaXN0YW5jZSkgewoJICAgICAgICAgICAgcG9pbnRCID0gcGF0dGVybnNbMF07CgkgICAgICAgICAgICBwb2ludEEgPSBwYXR0ZXJuc1sxXTsKCSAgICAgICAgICAgIHBvaW50QyA9IHBhdHRlcm5zWzJdOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgaWYgKHplcm9Ud29EaXN0YW5jZSA+PSBvbmVUd29EaXN0YW5jZSAmJiB6ZXJvVHdvRGlzdGFuY2UgPj0gemVyb09uZURpc3RhbmNlKSB7CgkgICAgICAgICAgICBwb2ludEIgPSBwYXR0ZXJuc1sxXTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBhdHRlcm5zWzBdOwoJICAgICAgICAgICAgcG9pbnRDID0gcGF0dGVybnNbMl07CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICBwb2ludEIgPSBwYXR0ZXJuc1syXTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBhdHRlcm5zWzBdOwoJICAgICAgICAgICAgcG9pbnRDID0gcGF0dGVybnNbMV07CgkgICAgICAgIH0KCSAgICAgICAgLy8gVXNlIGNyb3NzIHByb2R1Y3QgdG8gZmlndXJlIG91dCB3aGV0aGVyIEEgYW5kIEMgYXJlIGNvcnJlY3Qgb3IgZmxpcHBlZC4KCSAgICAgICAgLy8gVGhpcyBhc2tzIHdoZXRoZXIgQkMgeCBCQSBoYXMgYSBwb3NpdGl2ZSB6IGNvbXBvbmVudCwgd2hpY2ggaXMgdGhlIGFycmFuZ2VtZW50CgkgICAgICAgIC8vIHdlIHdhbnQgZm9yIEEsIEIsIEMuIElmIGl0J3MgbmVnYXRpdmUsIHRoZW4gd2UndmUgZ290IGl0IGZsaXBwZWQgYXJvdW5kIGFuZAoJICAgICAgICAvLyBzaG91bGQgc3dhcCBBIGFuZCBDLgoJICAgICAgICBpZiAodGhpcy5jcm9zc1Byb2R1Y3RaKHBvaW50QSwgcG9pbnRCLCBwb2ludEMpIDwgMC4wKSB7CgkgICAgICAgICAgICB2YXIgdGVtcCA9IHBvaW50QTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBvaW50QzsKCSAgICAgICAgICAgIHBvaW50QyA9IHRlbXA7CgkgICAgICAgIH0KCSAgICAgICAgcGF0dGVybnNbMF0gPSBwb2ludEE7CgkgICAgICAgIHBhdHRlcm5zWzFdID0gcG9pbnRCOwoJICAgICAgICBwYXR0ZXJuc1syXSA9IHBvaW50QzsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBwYXR0ZXJuMSBmaXJzdCBwYXR0ZXJuCgkgICAgICogQHBhcmFtIHBhdHRlcm4yIHNlY29uZCBwYXR0ZXJuCgkgICAgICogQHJldHVybiBkaXN0YW5jZSBiZXR3ZWVuIHR3byBwb2ludHMKCSAgICAgKi8KCSAgICBSZXN1bHRQb2ludC5kaXN0YW5jZSA9IGZ1bmN0aW9uIChwYXR0ZXJuMSwgcGF0dGVybjIpIHsKCSAgICAgICAgcmV0dXJuIE1hdGhVdGlsc18xJDEuZGVmYXVsdC5kaXN0YW5jZShwYXR0ZXJuMS54LCBwYXR0ZXJuMS55LCBwYXR0ZXJuMi54LCBwYXR0ZXJuMi55KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIHogY29tcG9uZW50IG9mIHRoZSBjcm9zcyBwcm9kdWN0IGJldHdlZW4gdmVjdG9ycyBCQyBhbmQgQkEuCgkgICAgICovCgkgICAgUmVzdWx0UG9pbnQuY3Jvc3NQcm9kdWN0WiA9IGZ1bmN0aW9uIChwb2ludEEsIHBvaW50QiwgcG9pbnRDKSB7CgkgICAgICAgIHZhciBiWCA9IHBvaW50Qi54OwoJICAgICAgICB2YXIgYlkgPSBwb2ludEIueTsKCSAgICAgICAgcmV0dXJuICgocG9pbnRDLnggLSBiWCkgKiAocG9pbnRBLnkgLSBiWSkpIC0gKChwb2ludEMueSAtIGJZKSAqIChwb2ludEEueCAtIGJYKSk7CgkgICAgfTsKCSAgICByZXR1cm4gUmVzdWx0UG9pbnQ7Cgl9KCkpOwoJUmVzdWx0UG9pbnQkMS5kZWZhdWx0ID0gUmVzdWx0UG9pbnQ7CgoJdmFyIEFsaWdubWVudFBhdHRlcm5GaW5kZXIkMSA9IHt9OwoKCXZhciBBbGlnbm1lbnRQYXR0ZXJuJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fZXh0ZW5kcyQxID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFsaWdubWVudFBhdHRlcm4kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGV0ZWN0b3IgeyovCgl2YXIgUmVzdWx0UG9pbnRfMSQzID0gUmVzdWx0UG9pbnQkMTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGFuIGFsaWdubWVudCBwYXR0ZXJuLCB3aGljaCBhcmUgdGhlIHNtYWxsZXIgc3F1YXJlIHBhdHRlcm5zIGZvdW5kIGluCgkgKiBhbGwgYnV0IHRoZSBzaW1wbGVzdCBRUiBDb2Rlcy48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEFsaWdubWVudFBhdHRlcm4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDEoQWxpZ25tZW50UGF0dGVybiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBBbGlnbm1lbnRQYXR0ZXJuKHBvc1ggLypmbG9hdCovLCBwb3NZIC8qZmxvYXQqLywgZXN0aW1hdGVkTW9kdWxlU2l6ZSAvKmZsb2F0Ki8pIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcG9zWCwgcG9zWSkgfHwgdGhpczsKCSAgICAgICAgX3RoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IGVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZXJtaW5lcyBpZiB0aGlzIGFsaWdubWVudCBwYXR0ZXJuICJhYm91dCBlcXVhbHMiIGFuIGFsaWdubWVudCBwYXR0ZXJuIGF0IHRoZSBzdGF0ZWQKCSAgICAgKiBwb3NpdGlvbiBhbmQgc2l6ZSAtLSBtZWFuaW5nLCBpdCBpcyBhdCBuZWFybHkgdGhlIHNhbWUgY2VudGVyIHdpdGggbmVhcmx5IHRoZSBzYW1lIHNpemUuPC9wPgoJICAgICAqLwoJICAgIEFsaWdubWVudFBhdHRlcm4ucHJvdG90eXBlLmFib3V0RXF1YWxzID0gZnVuY3Rpb24gKG1vZHVsZVNpemUgLypmbG9hdCovLCBpIC8qZmxvYXQqLywgaiAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE1hdGguYWJzKGkgLSB0aGlzLmdldFkoKSkgPD0gbW9kdWxlU2l6ZSAmJiBNYXRoLmFicyhqIC0gdGhpcy5nZXRYKCkpIDw9IG1vZHVsZVNpemUpIHsKCSAgICAgICAgICAgIHZhciBtb2R1bGVTaXplRGlmZiA9IE1hdGguYWJzKG1vZHVsZVNpemUgLSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVNpemVEaWZmIDw9IDEuMCB8fCBtb2R1bGVTaXplRGlmZiA8PSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29tYmluZXMgdGhpcyBvYmplY3QncyBjdXJyZW50IGVzdGltYXRlIG9mIGEgZmluZGVyIHBhdHRlcm4gcG9zaXRpb24gYW5kIG1vZHVsZSBzaXplCgkgICAgICogd2l0aCBhIG5ldyBlc3RpbWF0ZS4gSXQgcmV0dXJucyBhIG5ldyB7QGNvZGUgRmluZGVyUGF0dGVybn0gY29udGFpbmluZyBhbiBhdmVyYWdlIG9mIHRoZSB0d28uCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybi5wcm90b3R5cGUuY29tYmluZUVzdGltYXRlID0gZnVuY3Rpb24gKGkgLypmbG9hdCovLCBqIC8qZmxvYXQqLywgbmV3TW9kdWxlU2l6ZSAvKmZsb2F0Ki8pIHsKCSAgICAgICAgdmFyIGNvbWJpbmVkWCA9ICh0aGlzLmdldFgoKSArIGopIC8gMi4wOwoJICAgICAgICB2YXIgY29tYmluZWRZID0gKHRoaXMuZ2V0WSgpICsgaSkgLyAyLjA7CgkgICAgICAgIHZhciBjb21iaW5lZE1vZHVsZVNpemUgPSAodGhpcy5lc3RpbWF0ZWRNb2R1bGVTaXplICsgbmV3TW9kdWxlU2l6ZSkgLyAyLjA7CgkgICAgICAgIHJldHVybiBuZXcgQWxpZ25tZW50UGF0dGVybihjb21iaW5lZFgsIGNvbWJpbmVkWSwgY29tYmluZWRNb2R1bGVTaXplKTsKCSAgICB9OwoJICAgIHJldHVybiBBbGlnbm1lbnRQYXR0ZXJuOwoJfShSZXN1bHRQb2ludF8xJDMuZGVmYXVsdCkpOwoJQWxpZ25tZW50UGF0dGVybiQxLmRlZmF1bHQgPSBBbGlnbm1lbnRQYXR0ZXJuOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX192YWx1ZXMkMSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX3ZhbHVlcykgfHwgZnVuY3Rpb24obykgewoJICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwOwoJICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pOwoJICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHJldHVybiB7CgkgICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7CgkgICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/ICJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLiIgOiAiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpOwoJfTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShBbGlnbm1lbnRQYXR0ZXJuRmluZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBBbGlnbm1lbnRQYXR0ZXJuXzEgPSBBbGlnbm1lbnRQYXR0ZXJuJDE7Cgl2YXIgTm90Rm91bmRFeGNlcHRpb25fMSQzID0gTm90Rm91bmRFeGNlcHRpb24kMTsKCS8qaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgYXR0ZW1wdHMgdG8gZmluZCBhbGlnbm1lbnQgcGF0dGVybnMgaW4gYSBRUiBDb2RlLiBBbGlnbm1lbnQgcGF0dGVybnMgbG9vayBsaWtlIGZpbmRlcgoJICogcGF0dGVybnMgYnV0IGFyZSBzbWFsbGVyIGFuZCBhcHBlYXIgYXQgcmVndWxhciBpbnRlcnZhbHMgdGhyb3VnaG91dCB0aGUgaW1hZ2UuPC9wPgoJICoKCSAqIDxwPkF0IHRoZSBtb21lbnQgdGhpcyBvbmx5IGxvb2tzIGZvciB0aGUgYm90dG9tLXJpZ2h0IGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAqCgkgKiA8cD5UaGlzIGlzIG1vc3RseSBhIHNpbXBsaWZpZWQgY29weSBvZiB7QGxpbmsgRmluZGVyUGF0dGVybkZpbmRlcn0uIEl0IGlzIGNvcGllZCwKCSAqIHBhc3RlZCBhbmQgc3RyaXBwZWQgZG93biBoZXJlIGZvciBtYXhpbXVtIHBlcmZvcm1hbmNlIGJ1dCBkb2VzIHVuZm9ydHVuYXRlbHkgZHVwbGljYXRlCgkgKiBzb21lIGNvZGUuPC9wPgoJICoKCSAqIDxwPlRoaXMgY2xhc3MgaXMgdGhyZWFkLXNhZmUgYnV0IG5vdCByZWVudHJhbnQuIEVhY2ggdGhyZWFkIG11c3QgYWxsb2NhdGUgaXRzIG93biBvYmplY3QuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8qKgoJICAgICAqIDxwPkNyZWF0ZXMgYSBmaW5kZXIgdGhhdCB3aWxsIGxvb2sgaW4gYSBwb3J0aW9uIG9mIHRoZSB3aG9sZSBpbWFnZS48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0gaW1hZ2UgaW1hZ2UgdG8gc2VhcmNoCgkgICAgICogQHBhcmFtIHN0YXJ0WCBsZWZ0IGNvbHVtbiBmcm9tIHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZwoJICAgICAqIEBwYXJhbSBzdGFydFkgdG9wIHJvdyBmcm9tIHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZwoJICAgICAqIEBwYXJhbSB3aWR0aCB3aWR0aCBvZiByZWdpb24gdG8gc2VhcmNoCgkgICAgICogQHBhcmFtIGhlaWdodCBoZWlnaHQgb2YgcmVnaW9uIHRvIHNlYXJjaAoJICAgICAqIEBwYXJhbSBtb2R1bGVTaXplIGVzdGltYXRlZCBtb2R1bGUgc2l6ZSBzbyBmYXIKCSAgICAgKi8KCSAgICBmdW5jdGlvbiBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyKGltYWdlLCBzdGFydFggLyppbnQqLywgc3RhcnRZIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovLCBtb2R1bGVTaXplIC8qZmxvYXQqLywgcmVzdWx0UG9pbnRDYWxsYmFjaykgewoJICAgICAgICB0aGlzLmltYWdlID0gaW1hZ2U7CgkgICAgICAgIHRoaXMuc3RhcnRYID0gc3RhcnRYOwoJICAgICAgICB0aGlzLnN0YXJ0WSA9IHN0YXJ0WTsKCSAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoOwoJICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDsKCSAgICAgICAgdGhpcy5tb2R1bGVTaXplID0gbW9kdWxlU2l6ZTsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gcmVzdWx0UG9pbnRDYWxsYmFjazsKCSAgICAgICAgdGhpcy5wb3NzaWJsZUNlbnRlcnMgPSBbXTsgLy8gbmV3IEFycmF5PGFueT4oNSkpCgkgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiBhcnJheSBpbml0aWFsaXphdGlvbiB3aXRob3V0IHNpemUgYXMgdGhlIGxlbmd0aCBpcyBjaGVja2VkIGJlbG93CgkgICAgICAgIHRoaXMuY3Jvc3NDaGVja1N0YXRlQ291bnQgPSBuZXcgSW50MzJBcnJheSgzKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICogPHA+VGhpcyBtZXRob2QgYXR0ZW1wdHMgdG8gZmluZCB0aGUgYm90dG9tLXJpZ2h0IGFsaWdubWVudCBwYXR0ZXJuIGluIHRoZSBpbWFnZS4gSXQgaXMgYSBiaXQgbWVzc3kgc2luY2UKCSAgICAgKiBpdCdzIHByZXR0eSBwZXJmb3JtYW5jZS1jcml0aWNhbCBhbmQgc28gaXMgd3JpdHRlbiB0byBiZSBmYXN0IGZvcmVtb3N0LjwvcD4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEFsaWdubWVudFBhdHRlcm59IGlmIGZvdW5kCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBub3QgZm91bmQKCSAgICAgKi8KCSAgICBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgc3RhcnRYID0gdGhpcy5zdGFydFg7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmhlaWdodDsKCSAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aDsKCSAgICAgICAgdmFyIG1heEogPSBzdGFydFggKyB3aWR0aDsKCSAgICAgICAgdmFyIG1pZGRsZUkgPSB0aGlzLnN0YXJ0WSArIChoZWlnaHQgLyAyKTsKCSAgICAgICAgLy8gV2UgYXJlIGxvb2tpbmcgZm9yIGJsYWNrL3doaXRlL2JsYWNrIG1vZHVsZXMgaW4gMToxOjEgcmF0aW8KCSAgICAgICAgLy8gdGhpcyB0cmFja3MgdGhlIG51bWJlciBvZiBibGFjay93aGl0ZS9ibGFjayBtb2R1bGVzIHNlZW4gc28gZmFyCgkgICAgICAgIHZhciBzdGF0ZUNvdW50ID0gbmV3IEludDMyQXJyYXkoMyk7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIGZvciAodmFyIGlHZW4gPSAwOyBpR2VuIDwgaGVpZ2h0OyBpR2VuKyspIHsKCSAgICAgICAgICAgIC8vIFNlYXJjaCBmcm9tIG1pZGRsZSBvdXR3YXJkcwoJICAgICAgICAgICAgdmFyIGkgPSBtaWRkbGVJICsgKChpR2VuICYgMHgwMSkgPT09IDAgPyBNYXRoLmZsb29yKChpR2VuICsgMSkgLyAyKSA6IC1NYXRoLmZsb29yKChpR2VuICsgMSkgLyAyKSk7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMV0gPSAwOwoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IDA7CgkgICAgICAgICAgICB2YXIgaiA9IHN0YXJ0WDsKCSAgICAgICAgICAgIC8vIEJ1cm4gb2ZmIGxlYWRpbmcgd2hpdGUgcGl4ZWxzIGJlZm9yZSBhbnl0aGluZyBlbHNlOyBpZiB3ZSBzdGFydCBpbiB0aGUgbWlkZGxlIG9mCgkgICAgICAgICAgICAvLyBhIHdoaXRlIHJ1biwgaXQgZG9lc24ndCBtYWtlIHNlbnNlIHRvIGNvdW50IGl0cyBsZW5ndGgsIHNpbmNlIHdlIGRvbid0IGtub3cgaWYgdGhlCgkgICAgICAgICAgICAvLyB3aGl0ZSBydW4gY29udGludWVkIHRvIHRoZSBsZWZ0IG9mIHRoZSBzdGFydCBwb2ludAoJICAgICAgICAgICAgd2hpbGUgKGogPCBtYXhKICYmICFpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICBqKys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgY3VycmVudFN0YXRlID0gMDsKCSAgICAgICAgICAgIHdoaWxlIChqIDwgbWF4SikgewoJICAgICAgICAgICAgICAgIGlmIChpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gQmxhY2sgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gMSkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMV0rKzsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsgLy8gQ291bnRpbmcgd2hpdGUgcGl4ZWxzCgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFN0YXRlID09PSAyKSB7IC8vIEEgd2lubmVyPwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZvdW5kUGF0dGVybkNyb3NzKHN0YXRlQ291bnQpKSB7IC8vIFllcwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlybWVkID0gdGhpcy5oYW5kbGVQb3NzaWJsZUNlbnRlcihzdGF0ZUNvdW50LCBpLCBqKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCAhPT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpcm1lZDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gc3RhdGVDb3VudFsyXTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzFdID0gMTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzJdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsrK2N1cnJlbnRTdGF0ZV0rKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsgLy8gV2hpdGUgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gMSkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBqKys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAodGhpcy5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSkgewoJICAgICAgICAgICAgICAgIHZhciBjb25maXJtZWQgPSB0aGlzLmhhbmRsZVBvc3NpYmxlQ2VudGVyKHN0YXRlQ291bnQsIGksIG1heEopOwoJICAgICAgICAgICAgICAgIGlmIChjb25maXJtZWQgIT09IG51bGwpIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpcm1lZDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gSG1tLCBub3RoaW5nIHdlIHNhdyB3YXMgb2JzZXJ2ZWQgYW5kIGNvbmZpcm1lZCB0d2ljZS4gSWYgd2UgaGFkCgkgICAgICAgIC8vIGFueSBndWVzcyBhdCBhbGwsIHJldHVybiBpdC4KCSAgICAgICAgaWYgKHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aCAhPT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMucG9zc2libGVDZW50ZXJzWzBdOwoJICAgICAgICB9CgkgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbl8xJDMuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogR2l2ZW4gYSBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCBzZWVuIGFuZCBhbiBlbmQgcG9zaXRpb24sCgkgICAgICogZmlndXJlcyB0aGUgbG9jYXRpb24gb2YgdGhlIGNlbnRlciBvZiB0aGlzIGJsYWNrL3doaXRlL2JsYWNrIHJ1bi4KCSAgICAgKi8KCSAgICBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCwgZW5kIC8qaW50Ki8pIHsKCSAgICAgICAgcmV0dXJuIChlbmQgLSBzdGF0ZUNvdW50WzJdKSAtIHN0YXRlQ291bnRbMV0gLyAyLjA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gc3RhdGVDb3VudCBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCByZWFkCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGUgcHJvcG9ydGlvbnMgb2YgdGhlIGNvdW50cyBpcyBjbG9zZSBlbm91Z2ggdG8gdGhlIDEvMS8xIHJhdGlvcwoJICAgICAqICAgICAgICAgdXNlZCBieSBhbGlnbm1lbnQgcGF0dGVybnMgdG8gYmUgY29uc2lkZXJlZCBhIG1hdGNoCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybkZpbmRlci5wcm90b3R5cGUuZm91bmRQYXR0ZXJuQ3Jvc3MgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCkgewoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRoaXMubW9kdWxlU2l6ZTsKCSAgICAgICAgdmFyIG1heFZhcmlhbmNlID0gbW9kdWxlU2l6ZSAvIDIuMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAzOyBpKyspIHsKCSAgICAgICAgICAgIGlmIChNYXRoLmFicyhtb2R1bGVTaXplIC0gc3RhdGVDb3VudFtpXSkgPj0gbWF4VmFyaWFuY2UpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5BZnRlciBhIGhvcml6b250YWwgc2NhbiBmaW5kcyBhIHBvdGVudGlhbCBhbGlnbm1lbnQgcGF0dGVybiwgdGhpcyBtZXRob2QKCSAgICAgKiAiY3Jvc3MtY2hlY2tzIiBieSBzY2FubmluZyBkb3duIHZlcnRpY2FsbHkgdGhyb3VnaCB0aGUgY2VudGVyIG9mIHRoZSBwb3NzaWJsZQoJICAgICAqIGFsaWdubWVudCBwYXR0ZXJuIHRvIHNlZSBpZiB0aGUgc2FtZSBwcm9wb3J0aW9uIGlzIGRldGVjdGVkLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGFydEkgcm93IHdoZXJlIGFuIGFsaWdubWVudCBwYXR0ZXJuIHdhcyBkZXRlY3RlZAoJICAgICAqIEBwYXJhbSBjZW50ZXJKIGNlbnRlciBvZiB0aGUgc2VjdGlvbiB0aGF0IGFwcGVhcnMgdG8gY3Jvc3MgYW4gYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gbWF4Q291bnQgbWF4aW11bSByZWFzb25hYmxlIG51bWJlciBvZiBtb2R1bGVzIHRoYXQgc2hvdWxkIGJlCgkgICAgICogb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcmV0dXJuIHZlcnRpY2FsIGNlbnRlciBvZiBhbGlnbm1lbnQgcGF0dGVybiwgb3Ige0BsaW5rIEZsb2F0I05hTn0gaWYgbm90IGZvdW5kCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybkZpbmRlci5wcm90b3R5cGUuY3Jvc3NDaGVja1ZlcnRpY2FsID0gZnVuY3Rpb24gKHN0YXJ0SSAvKmludCovLCBjZW50ZXJKIC8qaW50Ki8sIG1heENvdW50IC8qaW50Ki8sIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZTsKCSAgICAgICAgdmFyIG1heEkgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgc3RhdGVDb3VudFsxXSA9IDA7CgkgICAgICAgIHN0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICAvLyBTdGFydCBjb3VudGluZyB1cCBmcm9tIGNlbnRlcgoJICAgICAgICB2YXIgaSA9IHN0YXJ0STsKCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIGFscmVhZHkgdG9vIG1hbnkgbW9kdWxlcyBpbiB0aGlzIHN0YXRlIG9yIHJhbiBvZmYgdGhlIGVkZ2U6CgkgICAgICAgIGlmIChpIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiAhaW1hZ2UuZ2V0KGNlbnRlckosIGkpICYmIHN0YXRlQ291bnRbMF0gPD0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMF0rKzsKCSAgICAgICAgICAgIGktLTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFswXSA+IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIC8vIE5vdyBhbHNvIGNvdW50IGRvd24gZnJvbSBjZW50ZXIKCSAgICAgICAgaSA9IHN0YXJ0SSArIDE7CgkgICAgICAgIHdoaWxlIChpIDwgbWF4SSAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJIHx8IHN0YXRlQ291bnRbMV0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaSA8IG1heEkgJiYgIWltYWdlLmdldChjZW50ZXJKLCBpKSAmJiBzdGF0ZUNvdW50WzJdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzJdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbMl0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdOwoJICAgICAgICBpZiAoNSAqIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA+PSAyICogb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkgPyBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQoc3RhdGVDb3VudCwgaSkgOiBOYU47CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5UaGlzIGlzIGNhbGxlZCB3aGVuIGEgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG9zc2libGUgYWxpZ25tZW50IHBhdHRlcm4uIEl0IHdpbGwKCSAgICAgKiBjcm9zcyBjaGVjayB3aXRoIGEgdmVydGljYWwgc2NhbiwgYW5kIGlmIHN1Y2Nlc3NmdWwsIHdpbGwgc2VlIGlmIHRoaXMgcGF0dGVybiBoYWQgYmVlbgoJICAgICAqIGZvdW5kIG9uIGEgcHJldmlvdXMgaG9yaXpvbnRhbCBzY2FuLiBJZiBzbywgd2UgY29uc2lkZXIgaXQgY29uZmlybWVkIGFuZCBjb25jbHVkZSB3ZSBoYXZlCgkgICAgICogZm91bmQgdGhlIGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGF0ZUNvdW50IHJlYWRpbmcgc3RhdGUgbW9kdWxlIGNvdW50cyBmcm9tIGhvcml6b250YWwgc2NhbgoJICAgICAqIEBwYXJhbSBpIHJvdyB3aGVyZSBhbGlnbm1lbnQgcGF0dGVybiBtYXkgYmUgZm91bmQKCSAgICAgKiBAcGFyYW0gaiBlbmQgb2YgcG9zc2libGUgYWxpZ25tZW50IHBhdHRlcm4gaW4gcm93CgkgICAgICogQHJldHVybiB7QGxpbmsgQWxpZ25tZW50UGF0dGVybn0gaWYgd2UgaGF2ZSBmb3VuZCB0aGUgc2FtZSBwYXR0ZXJuIHR3aWNlLCBvciBudWxsIGlmIG5vdAoJICAgICAqLwoJICAgIEFsaWdubWVudFBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmhhbmRsZVBvc3NpYmxlQ2VudGVyID0gZnVuY3Rpb24gKHN0YXRlQ291bnQsIGkgLyppbnQqLywgaiAvKmludCovKSB7CgkgICAgICAgIHZhciBlXzEsIF9hOwoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdOwoJICAgICAgICB2YXIgY2VudGVySiA9IEFsaWdubWVudFBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBqKTsKCSAgICAgICAgdmFyIGNlbnRlckkgPSB0aGlzLmNyb3NzQ2hlY2tWZXJ0aWNhbChpLCAvKihpbnQpICovIGNlbnRlckosIDIgKiBzdGF0ZUNvdW50WzFdLCBzdGF0ZUNvdW50VG90YWwpOwoJICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckkpKSB7CgkgICAgICAgICAgICB2YXIgZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IChzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0pIC8gMy4wOwoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBfYiA9IF9fdmFsdWVzJDEodGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfYyA9IF9iLm5leHQoKTsgIV9jLmRvbmU7IF9jID0gX2IubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgICAgIHZhciBjZW50ZXIgPSBfYy52YWx1ZTsKCSAgICAgICAgICAgICAgICAgICAgLy8gTG9vayBmb3IgYWJvdXQgdGhlIHNhbWUgY2VudGVyIGFuZCBtb2R1bGUgc2l6ZToKCSAgICAgICAgICAgICAgICAgICAgaWYgKGNlbnRlci5hYm91dEVxdWFscyhlc3RpbWF0ZWRNb2R1bGVTaXplLCBjZW50ZXJJLCBjZW50ZXJKKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNlbnRlci5jb21iaW5lRXN0aW1hdGUoY2VudGVySSwgY2VudGVySiwgZXN0aW1hdGVkTW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKF9jICYmICFfYy5kb25lICYmIChfYSA9IF9iLnJldHVybikpIF9hLmNhbGwoX2IpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBIYWRuJ3QgZm91bmQgdGhpcyBiZWZvcmU7IHNhdmUgaXQKCSAgICAgICAgICAgIHZhciBwb2ludCA9IG5ldyBBbGlnbm1lbnRQYXR0ZXJuXzEuZGVmYXVsdChjZW50ZXJKLCBjZW50ZXJJLCBlc3RpbWF0ZWRNb2R1bGVTaXplKTsKCSAgICAgICAgICAgIHRoaXMucG9zc2libGVDZW50ZXJzLnB1c2gocG9pbnQpOwoJICAgICAgICAgICAgaWYgKHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayAhPT0gbnVsbCAmJiB0aGlzLnJlc3VsdFBvaW50Q2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjay5mb3VuZFBvc3NpYmxlUmVzdWx0UG9pbnQocG9pbnQpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBudWxsOwoJICAgIH07CgkgICAgcmV0dXJuIEFsaWdubWVudFBhdHRlcm5GaW5kZXI7Cgl9KCkpOwoJQWxpZ25tZW50UGF0dGVybkZpbmRlciQxLmRlZmF1bHQgPSBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyOwoKCXZhciBGaW5kZXJQYXR0ZXJuRmluZGVyJDEgPSB7fTsKCgl2YXIgRmluZGVyUGF0dGVybiQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRmluZGVyUGF0dGVybiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLnFyY29kZS5kZXRlY3RvciB7Ki8KCXZhciBSZXN1bHRQb2ludF8xJDIgPSBSZXN1bHRQb2ludCQxOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgYSBmaW5kZXIgcGF0dGVybiwgd2hpY2ggYXJlIHRoZSB0aHJlZSBzcXVhcmUgcGF0dGVybnMgZm91bmQgaW4KCSAqIHRoZSBjb3JuZXJzIG9mIFFSIENvZGVzLiBJdCBhbHNvIGVuY2Fwc3VsYXRlcyBhIGNvdW50IG9mIHNpbWlsYXIgZmluZGVyIHBhdHRlcm5zLAoJICogYXMgYSBjb252ZW5pZW5jZSB0byB0aGUgZmluZGVyJ3MgYm9va2tlZXBpbmcuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBGaW5kZXJQYXR0ZXJuID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyhGaW5kZXJQYXR0ZXJuLCBfc3VwZXIpOwoJICAgIC8vIEZpbmRlclBhdHRlcm4ocG9zWDogbnVtYmVyLypmbG9hdCovLCBwb3NZOiBudW1iZXIvKmZsb2F0Ki8sIGVzdGltYXRlZE1vZHVsZVNpemU6IG51bWJlci8qZmxvYXQqLykgewoJICAgIC8vICAgdGhpcyhwb3NYLCBwb3NZLCBlc3RpbWF0ZWRNb2R1bGVTaXplLCAxKQoJICAgIC8vIH0KCSAgICBmdW5jdGlvbiBGaW5kZXJQYXR0ZXJuKHBvc1ggLypmbG9hdCovLCBwb3NZIC8qZmxvYXQqLywgZXN0aW1hdGVkTW9kdWxlU2l6ZSAvKmZsb2F0Ki8sIGNvdW50IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcG9zWCwgcG9zWSkgfHwgdGhpczsKCSAgICAgICAgX3RoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IGVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIF90aGlzLmNvdW50ID0gY291bnQ7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGNvdW50KSB7CgkgICAgICAgICAgICBfdGhpcy5jb3VudCA9IDE7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBGaW5kZXJQYXR0ZXJuLnByb3RvdHlwZS5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lc3RpbWF0ZWRNb2R1bGVTaXplOwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybi5wcm90b3R5cGUuZ2V0Q291bnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvdW50OwoJICAgIH07CgkgICAgLyoKCSAgICB2b2lkIGluY3JlbWVudENvdW50KCkgewoJICAgICAgdGhpcy5jb3VudCsrCgkgICAgfQoJICAgICAqLwoJICAgIC8qKgoJICAgICAqIDxwPkRldGVybWluZXMgaWYgdGhpcyBmaW5kZXIgcGF0dGVybiAiYWJvdXQgZXF1YWxzIiBhIGZpbmRlciBwYXR0ZXJuIGF0IHRoZSBzdGF0ZWQKCSAgICAgKiBwb3NpdGlvbiBhbmQgc2l6ZSAtLSBtZWFuaW5nLCBpdCBpcyBhdCBuZWFybHkgdGhlIHNhbWUgY2VudGVyIHdpdGggbmVhcmx5IHRoZSBzYW1lIHNpemUuPC9wPgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm4ucHJvdG90eXBlLmFib3V0RXF1YWxzID0gZnVuY3Rpb24gKG1vZHVsZVNpemUgLypmbG9hdCovLCBpIC8qZmxvYXQqLywgaiAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE1hdGguYWJzKGkgLSB0aGlzLmdldFkoKSkgPD0gbW9kdWxlU2l6ZSAmJiBNYXRoLmFicyhqIC0gdGhpcy5nZXRYKCkpIDw9IG1vZHVsZVNpemUpIHsKCSAgICAgICAgICAgIHZhciBtb2R1bGVTaXplRGlmZiA9IE1hdGguYWJzKG1vZHVsZVNpemUgLSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVNpemVEaWZmIDw9IDEuMCB8fCBtb2R1bGVTaXplRGlmZiA8PSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29tYmluZXMgdGhpcyBvYmplY3QncyBjdXJyZW50IGVzdGltYXRlIG9mIGEgZmluZGVyIHBhdHRlcm4gcG9zaXRpb24gYW5kIG1vZHVsZSBzaXplCgkgICAgICogd2l0aCBhIG5ldyBlc3RpbWF0ZS4gSXQgcmV0dXJucyBhIG5ldyB7QGNvZGUgRmluZGVyUGF0dGVybn0gY29udGFpbmluZyBhIHdlaWdodGVkIGF2ZXJhZ2UKCSAgICAgKiBiYXNlZCBvbiBjb3VudC4KCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuLnByb3RvdHlwZS5jb21iaW5lRXN0aW1hdGUgPSBmdW5jdGlvbiAoaSAvKmZsb2F0Ki8sIGogLypmbG9hdCovLCBuZXdNb2R1bGVTaXplIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgY29tYmluZWRDb3VudCA9IHRoaXMuY291bnQgKyAxOwoJICAgICAgICB2YXIgY29tYmluZWRYID0gKHRoaXMuY291bnQgKiB0aGlzLmdldFgoKSArIGopIC8gY29tYmluZWRDb3VudDsKCSAgICAgICAgdmFyIGNvbWJpbmVkWSA9ICh0aGlzLmNvdW50ICogdGhpcy5nZXRZKCkgKyBpKSAvIGNvbWJpbmVkQ291bnQ7CgkgICAgICAgIHZhciBjb21iaW5lZE1vZHVsZVNpemUgPSAodGhpcy5jb3VudCAqIHRoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSArIG5ld01vZHVsZVNpemUpIC8gY29tYmluZWRDb3VudDsKCSAgICAgICAgcmV0dXJuIG5ldyBGaW5kZXJQYXR0ZXJuKGNvbWJpbmVkWCwgY29tYmluZWRZLCBjb21iaW5lZE1vZHVsZVNpemUsIGNvbWJpbmVkQ291bnQpOwoJICAgIH07CgkgICAgcmV0dXJuIEZpbmRlclBhdHRlcm47Cgl9KFJlc3VsdFBvaW50XzEkMi5kZWZhdWx0KSk7CglGaW5kZXJQYXR0ZXJuJDEuZGVmYXVsdCA9IEZpbmRlclBhdHRlcm47CgoJdmFyIEZpbmRlclBhdHRlcm5JbmZvJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEZpbmRlclBhdHRlcm5JbmZvJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGluZm9ybWF0aW9uIGFib3V0IGZpbmRlciBwYXR0ZXJucyBpbiBhbiBpbWFnZSwgaW5jbHVkaW5nIHRoZSBsb2NhdGlvbiBvZgoJICogdGhlIHRocmVlIGZpbmRlciBwYXR0ZXJucywgYW5kIHRoZWlyIGVzdGltYXRlZCBtb2R1bGUgc2l6ZS48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEZpbmRlclBhdHRlcm5JbmZvID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEZpbmRlclBhdHRlcm5JbmZvKHBhdHRlcm5DZW50ZXJzKSB7CgkgICAgICAgIHRoaXMuYm90dG9tTGVmdCA9IHBhdHRlcm5DZW50ZXJzWzBdOwoJICAgICAgICB0aGlzLnRvcExlZnQgPSBwYXR0ZXJuQ2VudGVyc1sxXTsKCSAgICAgICAgdGhpcy50b3BSaWdodCA9IHBhdHRlcm5DZW50ZXJzWzJdOwoJICAgIH0KCSAgICBGaW5kZXJQYXR0ZXJuSW5mby5wcm90b3R5cGUuZ2V0Qm90dG9tTGVmdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYm90dG9tTGVmdDsKCSAgICB9OwoJICAgIEZpbmRlclBhdHRlcm5JbmZvLnByb3RvdHlwZS5nZXRUb3BMZWZ0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50b3BMZWZ0OwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybkluZm8ucHJvdG90eXBlLmdldFRvcFJpZ2h0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50b3BSaWdodDsKCSAgICB9OwoJICAgIHJldHVybiBGaW5kZXJQYXR0ZXJuSW5mbzsKCX0oKSk7CglGaW5kZXJQYXR0ZXJuSW5mbyQxLmRlZmF1bHQgPSBGaW5kZXJQYXR0ZXJuSW5mbzsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEZpbmRlclBhdHRlcm5GaW5kZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGV0ZWN0b3IgeyovCgl2YXIgRGVjb2RlSGludFR5cGVfMSQyID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBSZXN1bHRQb2ludF8xJDEgPSBSZXN1bHRQb2ludCQxOwoJdmFyIEZpbmRlclBhdHRlcm5fMSA9IEZpbmRlclBhdHRlcm4kMTsKCXZhciBGaW5kZXJQYXR0ZXJuSW5mb18xID0gRmluZGVyUGF0dGVybkluZm8kMTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDIgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJLyppbXBvcnQgamF2YS5pby5TZXJpYWxpemFibGU7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsqLwoJLyppbXBvcnQgamF2YS51dGlsLkNvbXBhcmF0b3I7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgYXR0ZW1wdHMgdG8gZmluZCBmaW5kZXIgcGF0dGVybnMgaW4gYSBRUiBDb2RlLiBGaW5kZXIgcGF0dGVybnMgYXJlIHRoZSBzcXVhcmUKCSAqIG1hcmtlcnMgYXQgdGhyZWUgY29ybmVycyBvZiBhIFFSIENvZGUuPC9wPgoJICoKCSAqIDxwPlRoaXMgY2xhc3MgaXMgdGhyZWFkLXNhZmUgYnV0IG5vdCByZWVudHJhbnQuIEVhY2ggdGhyZWFkIG11c3QgYWxsb2NhdGUgaXRzIG93biBvYmplY3QuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEZpbmRlclBhdHRlcm5GaW5kZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogPHA+Q3JlYXRlcyBhIGZpbmRlciB0aGF0IHdpbGwgc2VhcmNoIHRoZSBpbWFnZSBmb3IgdGhyZWUgZmluZGVyIHBhdHRlcm5zLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBpbWFnZSBpbWFnZSB0byBzZWFyY2gKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IoaW1hZ2U6IEJpdE1hdHJpeCkgewoJICAgIC8vICAgdGhpcyhpbWFnZSwgbnVsbCkKCSAgICAvLyB9CgkgICAgZnVuY3Rpb24gRmluZGVyUGF0dGVybkZpbmRlcihpbWFnZSwgcmVzdWx0UG9pbnRDYWxsYmFjaykgewoJICAgICAgICB0aGlzLmltYWdlID0gaW1hZ2U7CgkgICAgICAgIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayA9IHJlc3VsdFBvaW50Q2FsbGJhY2s7CgkgICAgICAgIHRoaXMucG9zc2libGVDZW50ZXJzID0gW107CgkgICAgICAgIHRoaXMuY3Jvc3NDaGVja1N0YXRlQ291bnQgPSBuZXcgSW50MzJBcnJheSg1KTsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gcmVzdWx0UG9pbnRDYWxsYmFjazsKCSAgICB9CgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuZ2V0SW1hZ2UgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmltYWdlOwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuZ2V0UG9zc2libGVDZW50ZXJzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5wb3NzaWJsZUNlbnRlcnM7CgkgICAgfTsKCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24gKGhpbnRzKSB7CgkgICAgICAgIHZhciB0cnlIYXJkZXIgPSAoaGludHMgIT09IG51bGwgJiYgaGludHMgIT09IHVuZGVmaW5lZCkgJiYgdW5kZWZpbmVkICE9PSBoaW50cy5nZXQoRGVjb2RlSGludFR5cGVfMSQyLmRlZmF1bHQuVFJZX0hBUkRFUik7CgkgICAgICAgIHZhciBwdXJlQmFyY29kZSA9IChoaW50cyAhPT0gbnVsbCAmJiBoaW50cyAhPT0gdW5kZWZpbmVkKSAmJiB1bmRlZmluZWQgIT09IGhpbnRzLmdldChEZWNvZGVIaW50VHlwZV8xJDIuZGVmYXVsdC5QVVJFX0JBUkNPREUpOwoJICAgICAgICB2YXIgaW1hZ2UgPSB0aGlzLmltYWdlOwoJICAgICAgICB2YXIgbWF4SSA9IGltYWdlLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgbWF4SiA9IGltYWdlLmdldFdpZHRoKCk7CgkgICAgICAgIC8vIFdlIGFyZSBsb29raW5nIGZvciBibGFjay93aGl0ZS9ibGFjay93aGl0ZS9ibGFjayBtb2R1bGVzIGluCgkgICAgICAgIC8vIDE6MTozOjE6MSByYXRpbzsgdGhpcyB0cmFja3MgdGhlIG51bWJlciBvZiBzdWNoIG1vZHVsZXMgc2VlbiBzbyBmYXIKCSAgICAgICAgLy8gTGV0J3MgYXNzdW1lIHRoYXQgdGhlIG1heGltdW0gdmVyc2lvbiBRUiBDb2RlIHdlIHN1cHBvcnQgdGFrZXMgdXAgMS80IHRoZSBoZWlnaHQgb2YgdGhlCgkgICAgICAgIC8vIGltYWdlLCBhbmQgdGhlbiBhY2NvdW50IGZvciB0aGUgY2VudGVyIGJlaW5nIDMgbW9kdWxlcyBpbiBzaXplLiBUaGlzIGdpdmVzIHRoZSBzbWFsbGVzdAoJICAgICAgICAvLyBudW1iZXIgb2YgcGl4ZWxzIHRoZSBjZW50ZXIgY291bGQgYmUsIHNvIHNraXAgdGhpcyBvZnRlbi4gV2hlbiB0cnlpbmcgaGFyZGVyLCBsb29rIGZvciBhbGwKCSAgICAgICAgLy8gUVIgdmVyc2lvbnMgcmVnYXJkbGVzcyBvZiBob3cgZGVuc2UgdGhleSBhcmUuCgkgICAgICAgIHZhciBpU2tpcCA9IE1hdGguZmxvb3IoKDMgKiBtYXhJKSAvICg0ICogRmluZGVyUGF0dGVybkZpbmRlci5NQVhfTU9EVUxFUykpOwoJICAgICAgICBpZiAoaVNraXAgPCBGaW5kZXJQYXR0ZXJuRmluZGVyLk1JTl9TS0lQIHx8IHRyeUhhcmRlcikgewoJICAgICAgICAgICAgaVNraXAgPSBGaW5kZXJQYXR0ZXJuRmluZGVyLk1JTl9TS0lQOwoJICAgICAgICB9CgkgICAgICAgIHZhciBkb25lID0gZmFsc2U7CgkgICAgICAgIHZhciBzdGF0ZUNvdW50ID0gbmV3IEludDMyQXJyYXkoNSk7CgkgICAgICAgIGZvciAodmFyIGkgPSBpU2tpcCAtIDE7IGkgPCBtYXhJICYmICFkb25lOyBpICs9IGlTa2lwKSB7CgkgICAgICAgICAgICAvLyBHZXQgYSByb3cgb2YgYmxhY2svd2hpdGUgdmFsdWVzCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMV0gPSAwOwoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IDA7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzNdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0gPSAwOwoJICAgICAgICAgICAgdmFyIGN1cnJlbnRTdGF0ZSA9IDA7CgkgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG1heEo7IGorKykgewoJICAgICAgICAgICAgICAgIGlmIChpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gQmxhY2sgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKChjdXJyZW50U3RhdGUgJiAxKSA9PT0gMSkgeyAvLyBDb3VudGluZyB3aGl0ZSBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsgLy8gV2hpdGUgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKChjdXJyZW50U3RhdGUgJiAxKSA9PT0gMCkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50U3RhdGUgPT09IDQpIHsgLy8gQSB3aW5uZXI/CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkpIHsgLy8gWWVzCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb25maXJtZWQgPSB0aGlzLmhhbmRsZVBvc3NpYmxlQ2VudGVyKHN0YXRlQ291bnQsIGksIGosIHB1cmVCYXJjb2RlKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCA9PT0gdHJ1ZSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgZXhhbWluaW5nIGV2ZXJ5IG90aGVyIGxpbmUuIENoZWNraW5nIGVhY2ggbGluZSB0dXJuZWQgb3V0IHRvIGJlIHRvbwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXhwZW5zaXZlIGFuZCBkaWRuJ3QgaW1wcm92ZSBwZXJmb3JtYW5jZS4KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlTa2lwID0gMjsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc1NraXBwZWQgPT09IHRydWUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gdGhpcy5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzKCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm93U2tpcCA9IHRoaXMuZmluZFJvd1NraXAoKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocm93U2tpcCA+IHN0YXRlQ291bnRbMl0pIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2tpcCByb3dzIGJldHdlZW4gcm93IG9mIGxvd2VyIGNvbmZpcm1lZCBjZW50ZXIKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW5kIHRvcCBvZiBwcmVzdW1lZCB0aGlyZCBjb25maXJtZWQgY2VudGVyCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJ1dCBiYWNrIHVwIGEgYml0IHRvIGdldCBhIGZ1bGwgY2hhbmNlIG9mIGRldGVjdGluZwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpdCwgZW50aXJlIHdpZHRoIG9mIGNlbnRlciBvZiBmaW5kZXIgcGF0dGVybgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTa2lwIGJ5IHJvd1NraXAsIGJ1dCBiYWNrIG9mZiBieSBzdGF0ZUNvdW50WzJdIChzaXplIG9mIGxhc3QgY2VudGVyCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9mIHBhdHRlcm4gd2Ugc2F3KSB0byBiZSBjb25zZXJ2YXRpdmUsIGFuZCBhbHNvIGJhY2sgb2ZmIGJ5IGlTa2lwIHdoaWNoCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlzIGFib3V0IHRvIGJlIHJlLWFkZGVkCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgKz0gcm93U2tpcCAtIHN0YXRlQ291bnRbMl0gLSBpU2tpcDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaiA9IG1heEogLSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMF0gPSBzdGF0ZUNvdW50WzJdOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsxXSA9IHN0YXRlQ291bnRbM107CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzJdID0gc3RhdGVDb3VudFs0XTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFs0XSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAzOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2xlYXIgc3RhdGUgdG8gc3RhcnQgbG9va2luZyBhZ2FpbgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsxXSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzNdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFs0XSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyAvLyBObywgc2hpZnQgY291bnRzIGJhY2sgYnkgdHdvCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMF0gPSBzdGF0ZUNvdW50WzJdOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzFdID0gc3RhdGVDb3VudFszXTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IHN0YXRlQ291bnRbNF07CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzRdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0YXRlID0gMzsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WysrY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgeyAvLyBDb3VudGluZyB3aGl0ZSBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgaWYgKEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgY29uZmlybWVkID0gdGhpcy5oYW5kbGVQb3NzaWJsZUNlbnRlcihzdGF0ZUNvdW50LCBpLCBtYXhKLCBwdXJlQmFyY29kZSk7CgkgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCA9PT0gdHJ1ZSkgewoJICAgICAgICAgICAgICAgICAgICBpU2tpcCA9IHN0YXRlQ291bnRbMF07CgkgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc1NraXBwZWQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvdW5kIGEgdGhpcmQgb25lCgkgICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gdGhpcy5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzKCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHBhdHRlcm5JbmZvID0gdGhpcy5zZWxlY3RCZXN0UGF0dGVybnMoKTsKCSAgICAgICAgUmVzdWx0UG9pbnRfMSQxLmRlZmF1bHQub3JkZXJCZXN0UGF0dGVybnMocGF0dGVybkluZm8pOwoJICAgICAgICByZXR1cm4gbmV3IEZpbmRlclBhdHRlcm5JbmZvXzEuZGVmYXVsdChwYXR0ZXJuSW5mbyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBHaXZlbiBhIGNvdW50IG9mIGJsYWNrL3doaXRlL2JsYWNrL3doaXRlL2JsYWNrIHBpeGVscyBqdXN0IHNlZW4gYW5kIGFuIGVuZCBwb3NpdGlvbiwKCSAgICAgKiBmaWd1cmVzIHRoZSBsb2NhdGlvbiBvZiB0aGUgY2VudGVyIG9mIHRoaXMgcnVuLgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZCA9IGZ1bmN0aW9uIChzdGF0ZUNvdW50LCBlbmQgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gKGVuZCAtIHN0YXRlQ291bnRbNF0gLSBzdGF0ZUNvdW50WzNdKSAtIHN0YXRlQ291bnRbMl0gLyAyLjA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gc3RhdGVDb3VudCBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCByZWFkCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGUgcHJvcG9ydGlvbnMgb2YgdGhlIGNvdW50cyBpcyBjbG9zZSBlbm91Z2ggdG8gdGhlIDEvMS8zLzEvMSByYXRpb3MKCSAgICAgKiAgICAgICAgIHVzZWQgYnkgZmluZGVyIHBhdHRlcm5zIHRvIGJlIGNvbnNpZGVyZWQgYSBtYXRjaAoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3MgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCkgewoJICAgICAgICB2YXIgdG90YWxNb2R1bGVTaXplID0gMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA1OyBpKyspIHsKCSAgICAgICAgICAgIHZhciBjb3VudCA9IHN0YXRlQ291bnRbaV07CgkgICAgICAgICAgICBpZiAoY291bnQgPT09IDApIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gY291bnQ7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRvdGFsTW9kdWxlU2l6ZSA8IDcpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRvdGFsTW9kdWxlU2l6ZSAvIDcuMDsKCSAgICAgICAgdmFyIG1heFZhcmlhbmNlID0gbW9kdWxlU2l6ZSAvIDIuMDsKCSAgICAgICAgLy8gQWxsb3cgbGVzcyB0aGFuIDUwJSB2YXJpYW5jZSBmcm9tIDEtMS0zLTEtMSBwcm9wb3J0aW9ucwoJICAgICAgICByZXR1cm4gTWF0aC5hYnMobW9kdWxlU2l6ZSAtIHN0YXRlQ291bnRbMF0pIDwgbWF4VmFyaWFuY2UgJiYKCSAgICAgICAgICAgIE1hdGguYWJzKG1vZHVsZVNpemUgLSBzdGF0ZUNvdW50WzFdKSA8IG1heFZhcmlhbmNlICYmCgkgICAgICAgICAgICBNYXRoLmFicygzLjAgKiBtb2R1bGVTaXplIC0gc3RhdGVDb3VudFsyXSkgPCAzICogbWF4VmFyaWFuY2UgJiYKCSAgICAgICAgICAgIE1hdGguYWJzKG1vZHVsZVNpemUgLSBzdGF0ZUNvdW50WzNdKSA8IG1heFZhcmlhbmNlICYmCgkgICAgICAgICAgICBNYXRoLmFicyhtb2R1bGVTaXplIC0gc3RhdGVDb3VudFs0XSkgPCBtYXhWYXJpYW5jZTsKCSAgICB9OwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgY3Jvc3NDaGVja1N0YXRlQ291bnQgPSB0aGlzLmNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgICAgICBjcm9zc0NoZWNrU3RhdGVDb3VudFswXSA9IDA7CgkgICAgICAgIGNyb3NzQ2hlY2tTdGF0ZUNvdW50WzFdID0gMDsKCSAgICAgICAgY3Jvc3NDaGVja1N0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICBjcm9zc0NoZWNrU3RhdGVDb3VudFszXSA9IDA7CgkgICAgICAgIGNyb3NzQ2hlY2tTdGF0ZUNvdW50WzRdID0gMDsKCSAgICAgICAgcmV0dXJuIGNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQWZ0ZXIgYSB2ZXJ0aWNhbCBhbmQgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG90ZW50aWFsIGZpbmRlciBwYXR0ZXJuLCB0aGlzIG1ldGhvZAoJICAgICAqICJjcm9zcy1jcm9zcy1jcm9zcy1jaGVja3MiIGJ5IHNjYW5uaW5nIGRvd24gZGlhZ29uYWxseSB0aHJvdWdoIHRoZSBjZW50ZXIgb2YgdGhlIHBvc3NpYmxlCgkgICAgICogZmluZGVyIHBhdHRlcm4gdG8gc2VlIGlmIHRoZSBzYW1lIHByb3BvcnRpb24gaXMgZGV0ZWN0ZWQuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gc3RhcnRJIHJvdyB3aGVyZSBhIGZpbmRlciBwYXR0ZXJuIHdhcyBkZXRlY3RlZAoJICAgICAqIEBwYXJhbSBjZW50ZXJKIGNlbnRlciBvZiB0aGUgc2VjdGlvbiB0aGF0IGFwcGVhcnMgdG8gY3Jvc3MgYSBmaW5kZXIgcGF0dGVybgoJICAgICAqIEBwYXJhbSBtYXhDb3VudCBtYXhpbXVtIHJlYXNvbmFibGUgbnVtYmVyIG9mIG1vZHVsZXMgdGhhdCBzaG91bGQgYmUKCSAgICAgKiAgb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcGFyYW0gb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwgVGhlIG9yaWdpbmFsIHN0YXRlIGNvdW50IHRvdGFsLgoJICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBwcm9wb3J0aW9ucyBhcmUgd2l0aGluZyBleHBlY3RlZCBsaW1pdHMKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5jcm9zc0NoZWNrRGlhZ29uYWwgPSBmdW5jdGlvbiAoc3RhcnRJIC8qaW50Ki8sIGNlbnRlckogLyppbnQqLywgbWF4Q291bnQgLyppbnQqLywgb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwgLyppbnQqLykgewoJICAgICAgICB2YXIgc3RhdGVDb3VudCA9IHRoaXMuZ2V0Q3Jvc3NDaGVja1N0YXRlQ291bnQoKTsKCSAgICAgICAgLy8gU3RhcnQgY291bnRpbmcgdXAsIGxlZnQgZnJvbSBjZW50ZXIgZmluZGluZyBibGFjayBjZW50ZXIgbWFzcwoJICAgICAgICB2YXIgaSA9IDA7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIHdoaWxlIChzdGFydEkgPj0gaSAmJiBjZW50ZXJKID49IGkgJiYgaW1hZ2UuZ2V0KGNlbnRlckogLSBpLCBzdGFydEkgLSBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGFydEkgPCBpIHx8IGNlbnRlckogPCBpKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29udGludWUgdXAsIGxlZnQgZmluZGluZyB3aGl0ZSBzcGFjZQoJICAgICAgICB3aGlsZSAoc3RhcnRJID49IGkgJiYgY2VudGVySiA+PSBpICYmICFpbWFnZS5nZXQoY2VudGVySiAtIGksIHN0YXJ0SSAtIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzFdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzFdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgLy8gSWYgYWxyZWFkeSB0b28gbWFueSBtb2R1bGVzIGluIHRoaXMgc3RhdGUgb3IgcmFuIG9mZiB0aGUgZWRnZToKCSAgICAgICAgaWYgKHN0YXJ0SSA8IGkgfHwgY2VudGVySiA8IGkgfHwgc3RhdGVDb3VudFsxXSA+IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29udGludWUgdXAsIGxlZnQgZmluZGluZyBibGFjayBib3JkZXIKCSAgICAgICAgd2hpbGUgKHN0YXJ0SSA+PSBpICYmIGNlbnRlckogPj0gaSAmJiBpbWFnZS5nZXQoY2VudGVySiAtIGksIHN0YXJ0SSAtIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbMF0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBtYXhJID0gaW1hZ2UuZ2V0SGVpZ2h0KCk7CgkgICAgICAgIHZhciBtYXhKID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgLy8gTm93IGFsc28gY291bnQgZG93biwgcmlnaHQgZnJvbSBjZW50ZXIKCSAgICAgICAgaSA9IDE7CgkgICAgICAgIHdoaWxlIChzdGFydEkgKyBpIDwgbWF4SSAmJiBjZW50ZXJKICsgaSA8IG1heEogJiYgaW1hZ2UuZ2V0KGNlbnRlckogKyBpLCBzdGFydEkgKyBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIC8vIFJhbiBvZmYgdGhlIGVkZ2U/CgkgICAgICAgIGlmIChzdGFydEkgKyBpID49IG1heEkgfHwgY2VudGVySiArIGkgPj0gbWF4SikgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChzdGFydEkgKyBpIDwgbWF4SSAmJiBjZW50ZXJKICsgaSA8IG1heEogJiYgIWltYWdlLmdldChjZW50ZXJKICsgaSwgc3RhcnRJICsgaSkgJiYKCSAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPCBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFszXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGFydEkgKyBpID49IG1heEkgfHwgY2VudGVySiArIGkgPj0gbWF4SiB8fCBzdGF0ZUNvdW50WzNdID49IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKHN0YXJ0SSArIGkgPCBtYXhJICYmIGNlbnRlckogKyBpIDwgbWF4SiAmJiBpbWFnZS5nZXQoY2VudGVySiArIGksIHN0YXJ0SSArIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0rKzsKCSAgICAgICAgICAgIGkrKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFs0XSA+PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHdlIGZvdW5kIGEgZmluZGVyLXBhdHRlcm4tbGlrZSBzZWN0aW9uLCBidXQgaXRzIHNpemUgaXMgbW9yZSB0aGFuIDEwMCUgZGlmZmVyZW50IHRoYW4KCSAgICAgICAgLy8gdGhlIG9yaWdpbmFsLCBhc3N1bWUgaXQncyBhIGZhbHNlIHBvc2l0aXZlCgkgICAgICAgIHZhciBzdGF0ZUNvdW50VG90YWwgPSBzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0gKyBzdGF0ZUNvdW50WzNdICsgc3RhdGVDb3VudFs0XTsKCSAgICAgICAgcmV0dXJuIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA8IDIgKiBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCAmJgoJICAgICAgICAgICAgRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkFmdGVyIGEgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG90ZW50aWFsIGZpbmRlciBwYXR0ZXJuLCB0aGlzIG1ldGhvZAoJICAgICAqICJjcm9zcy1jaGVja3MiIGJ5IHNjYW5uaW5nIGRvd24gdmVydGljYWxseSB0aHJvdWdoIHRoZSBjZW50ZXIgb2YgdGhlIHBvc3NpYmxlCgkgICAgICogZmluZGVyIHBhdHRlcm4gdG8gc2VlIGlmIHRoZSBzYW1lIHByb3BvcnRpb24gaXMgZGV0ZWN0ZWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIHN0YXJ0SSByb3cgd2hlcmUgYSBmaW5kZXIgcGF0dGVybiB3YXMgZGV0ZWN0ZWQKCSAgICAgKiBAcGFyYW0gY2VudGVySiBjZW50ZXIgb2YgdGhlIHNlY3Rpb24gdGhhdCBhcHBlYXJzIHRvIGNyb3NzIGEgZmluZGVyIHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gbWF4Q291bnQgbWF4aW11bSByZWFzb25hYmxlIG51bWJlciBvZiBtb2R1bGVzIHRoYXQgc2hvdWxkIGJlCgkgICAgICogb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcmV0dXJuIHZlcnRpY2FsIGNlbnRlciBvZiBmaW5kZXIgcGF0dGVybiwgb3Ige0BsaW5rIEZsb2F0I05hTn0gaWYgbm90IGZvdW5kCgkgICAgICovCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuY3Jvc3NDaGVja1ZlcnRpY2FsID0gZnVuY3Rpb24gKHN0YXJ0SSAvKmludCovLCBjZW50ZXJKIC8qaW50Ki8sIG1heENvdW50IC8qaW50Ki8sIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZTsKCSAgICAgICAgdmFyIG1heEkgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50KCk7CgkgICAgICAgIC8vIFN0YXJ0IGNvdW50aW5nIHVwIGZyb20gY2VudGVyCgkgICAgICAgIHZhciBpID0gc3RhcnRJOwoJICAgICAgICB3aGlsZSAoaSA+PSAwICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpIDwgMCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaSA+PSAwICYmICFpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIGFscmVhZHkgdG9vIG1hbnkgbW9kdWxlcyBpbiB0aGlzIHN0YXRlIG9yIHJhbiBvZmYgdGhlIGVkZ2U6CgkgICAgICAgIGlmIChpIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFswXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFswXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGF0ZUNvdW50WzBdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgLy8gTm93IGFsc28gY291bnQgZG93biBmcm9tIGNlbnRlcgoJICAgICAgICBpID0gc3RhcnRJICsgMTsKCSAgICAgICAgd2hpbGUgKGkgPCBtYXhJICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJKSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChpIDwgbWF4SSAmJiAhaW1hZ2UuZ2V0KGNlbnRlckosIGkpICYmIHN0YXRlQ291bnRbM10gPCBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFszXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJIHx8IHN0YXRlQ291bnRbM10gPj0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPCBtYXhJICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSAmJiBzdGF0ZUNvdW50WzRdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0rKzsKCSAgICAgICAgICAgIGkrKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFs0XSA+PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICAvLyBJZiB3ZSBmb3VuZCBhIGZpbmRlci1wYXR0ZXJuLWxpa2Ugc2VjdGlvbiwgYnV0IGl0cyBzaXplIGlzIG1vcmUgdGhhbiA0MCUgZGlmZmVyZW50IHRoYW4KCSAgICAgICAgLy8gdGhlIG9yaWdpbmFsLCBhc3N1bWUgaXQncyBhIGZhbHNlIHBvc2l0aXZlCgkgICAgICAgIHZhciBzdGF0ZUNvdW50VG90YWwgPSBzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0gKyBzdGF0ZUNvdW50WzNdICsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF07CgkgICAgICAgIGlmICg1ICogTWF0aC5hYnMoc3RhdGVDb3VudFRvdGFsIC0gb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwpID49IDIgKiBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSA/IEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBpKSA6IE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkxpa2Uge0BsaW5rICNjcm9zc0NoZWNrVmVydGljYWwoaW50LCBpbnQsIGludCwgaW50KX0sIGFuZCBpbiBmYWN0IGlzIGJhc2ljYWxseSBpZGVudGljYWwsCgkgICAgICogZXhjZXB0IGl0IHJlYWRzIGhvcml6b250YWxseSBpbnN0ZWFkIG9mIHZlcnRpY2FsbHkuIFRoaXMgaXMgdXNlZCB0byBjcm9zcy1jcm9zcwoJICAgICAqIGNoZWNrIGEgdmVydGljYWwgY3Jvc3MgY2hlY2sgYW5kIGxvY2F0ZSB0aGUgcmVhbCBjZW50ZXIgb2YgdGhlIGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5jcm9zc0NoZWNrSG9yaXpvbnRhbCA9IGZ1bmN0aW9uIChzdGFydEogLyppbnQqLywgY2VudGVySSAvKmludCovLCBtYXhDb3VudCAvKmludCovLCBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCAvKmludCovKSB7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIHZhciBtYXhKID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50KCk7CgkgICAgICAgIHZhciBqID0gc3RhcnRKOwoJICAgICAgICB3aGlsZSAoaiA+PSAwICYmIGltYWdlLmdldChqLCBjZW50ZXJJKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChqIDwgMCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaiA+PSAwICYmICFpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChqIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGogPj0gMCAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFswXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFswXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGF0ZUNvdW50WzBdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgaiA9IHN0YXJ0SiArIDE7CgkgICAgICAgIHdoaWxlIChqIDwgbWF4SiAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMl0rKzsKCSAgICAgICAgICAgIGorKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaiA9PT0gbWF4SikgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaiA8IG1heEogJiYgIWltYWdlLmdldChqLCBjZW50ZXJJKSAmJiBzdGF0ZUNvdW50WzNdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbM10rKzsKCSAgICAgICAgICAgIGorKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaiA9PT0gbWF4SiB8fCBzdGF0ZUNvdW50WzNdID49IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChqIDwgbWF4SiAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFs0XSA8IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdKys7CgkgICAgICAgICAgICBqKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbNF0gPj0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgLy8gSWYgd2UgZm91bmQgYSBmaW5kZXItcGF0dGVybi1saWtlIHNlY3Rpb24sIGJ1dCBpdHMgc2l6ZSBpcyBzaWduaWZpY2FudGx5IGRpZmZlcmVudCB0aGFuCgkgICAgICAgIC8vIHRoZSBvcmlnaW5hbCwgYXNzdW1lIGl0J3MgYSBmYWxzZSBwb3NpdGl2ZQoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdICsgc3RhdGVDb3VudFszXSArCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdOwoJICAgICAgICBpZiAoNSAqIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA+PSBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSA/IEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBqKSA6IE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlRoaXMgaXMgY2FsbGVkIHdoZW4gYSBob3Jpem9udGFsIHNjYW4gZmluZHMgYSBwb3NzaWJsZSBhbGlnbm1lbnQgcGF0dGVybi4gSXQgd2lsbAoJICAgICAqIGNyb3NzIGNoZWNrIHdpdGggYSB2ZXJ0aWNhbCBzY2FuLCBhbmQgaWYgc3VjY2Vzc2Z1bCwgd2lsbCwgYWgsIGNyb3NzLWNyb3NzLWNoZWNrCgkgICAgICogd2l0aCBhbm90aGVyIGhvcml6b250YWwgc2Nhbi4gVGhpcyBpcyBuZWVkZWQgcHJpbWFyaWx5IHRvIGxvY2F0ZSB0aGUgcmVhbCBob3Jpem9udGFsCgkgICAgICogY2VudGVyIG9mIHRoZSBwYXR0ZXJuIGluIGNhc2VzIG9mIGV4dHJlbWUgc2tldy4KCSAgICAgKiBBbmQgdGhlbiB3ZSBjcm9zcy1jcm9zcy1jcm9zcyBjaGVjayB3aXRoIGFub3RoZXIgZGlhZ29uYWwgc2Nhbi48L3A+CgkgICAgICoKCSAgICAgKiA8cD5JZiB0aGF0IHN1Y2NlZWRzIHRoZSBmaW5kZXIgcGF0dGVybiBsb2NhdGlvbiBpcyBhZGRlZCB0byBhIGxpc3QgdGhhdCB0cmFja3MKCSAgICAgKiB0aGUgbnVtYmVyIG9mIHRpbWVzIGVhY2ggbG9jYXRpb24gaGFzIGJlZW4gbmVhcmx5LW1hdGNoZWQgYXMgYSBmaW5kZXIgcGF0dGVybi4KCSAgICAgKiBFYWNoIGFkZGl0aW9uYWwgZmluZCBpcyBtb3JlIGV2aWRlbmNlIHRoYXQgdGhlIGxvY2F0aW9uIGlzIGluIGZhY3QgYSBmaW5kZXIKCSAgICAgKiBwYXR0ZXJuIGNlbnRlcgoJICAgICAqCgkgICAgICogQHBhcmFtIHN0YXRlQ291bnQgcmVhZGluZyBzdGF0ZSBtb2R1bGUgY291bnRzIGZyb20gaG9yaXpvbnRhbCBzY2FuCgkgICAgICogQHBhcmFtIGkgcm93IHdoZXJlIGZpbmRlciBwYXR0ZXJuIG1heSBiZSBmb3VuZAoJICAgICAqIEBwYXJhbSBqIGVuZCBvZiBwb3NzaWJsZSBmaW5kZXIgcGF0dGVybiBpbiByb3cKCSAgICAgKiBAcGFyYW0gcHVyZUJhcmNvZGUgdHJ1ZSBpZiBpbiAicHVyZSBiYXJjb2RlIiBtb2RlCgkgICAgICogQHJldHVybiB0cnVlIGlmIGEgZmluZGVyIHBhdHRlcm4gY2FuZGlkYXRlIHdhcyBmb3VuZCB0aGlzIHRpbWUKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5oYW5kbGVQb3NzaWJsZUNlbnRlciA9IGZ1bmN0aW9uIChzdGF0ZUNvdW50LCBpIC8qaW50Ki8sIGogLyppbnQqLywgcHVyZUJhcmNvZGUpIHsKCSAgICAgICAgdmFyIHN0YXRlQ291bnRUb3RhbCA9IHN0YXRlQ291bnRbMF0gKyBzdGF0ZUNvdW50WzFdICsgc3RhdGVDb3VudFsyXSArIHN0YXRlQ291bnRbM10gKwoJICAgICAgICAgICAgc3RhdGVDb3VudFs0XTsKCSAgICAgICAgdmFyIGNlbnRlckogPSBGaW5kZXJQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQoc3RhdGVDb3VudCwgaik7CgkgICAgICAgIHZhciBjZW50ZXJJID0gdGhpcy5jcm9zc0NoZWNrVmVydGljYWwoaSwgLyooaW50KSAqLyBNYXRoLmZsb29yKGNlbnRlckopLCBzdGF0ZUNvdW50WzJdLCBzdGF0ZUNvdW50VG90YWwpOwoJICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckkpKSB7CgkgICAgICAgICAgICAvLyBSZS1jcm9zcyBjaGVjawoJICAgICAgICAgICAgY2VudGVySiA9IHRoaXMuY3Jvc3NDaGVja0hvcml6b250YWwoLyooaW50KSAqLyBNYXRoLmZsb29yKGNlbnRlckopLCAvKihpbnQpICovIE1hdGguZmxvb3IoY2VudGVySSksIHN0YXRlQ291bnRbMl0sIHN0YXRlQ291bnRUb3RhbCk7CgkgICAgICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckopICYmCgkgICAgICAgICAgICAgICAgKCFwdXJlQmFyY29kZSB8fCB0aGlzLmNyb3NzQ2hlY2tEaWFnb25hbCgvKihpbnQpICovIE1hdGguZmxvb3IoY2VudGVySSksIC8qKGludCkgKi8gTWF0aC5mbG9vcihjZW50ZXJKKSwgc3RhdGVDb3VudFsyXSwgc3RhdGVDb3VudFRvdGFsKSkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IHN0YXRlQ291bnRUb3RhbCAvIDcuMDsKCSAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTsKCSAgICAgICAgICAgICAgICB2YXIgcG9zc2libGVDZW50ZXJzID0gdGhpcy5wb3NzaWJsZUNlbnRlcnM7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwLCBsZW5ndGhfMSA9IHBvc3NpYmxlQ2VudGVycy5sZW5ndGg7IGluZGV4IDwgbGVuZ3RoXzE7IGluZGV4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlciA9IHBvc3NpYmxlQ2VudGVyc1tpbmRleF07CgkgICAgICAgICAgICAgICAgICAgIC8vIExvb2sgZm9yIGFib3V0IHRoZSBzYW1lIGNlbnRlciBhbmQgbW9kdWxlIHNpemU6CgkgICAgICAgICAgICAgICAgICAgIGlmIChjZW50ZXIuYWJvdXRFcXVhbHMoZXN0aW1hdGVkTW9kdWxlU2l6ZSwgY2VudGVySSwgY2VudGVySikpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVyc1tpbmRleF0gPSBjZW50ZXIuY29tYmluZUVzdGltYXRlKGNlbnRlckksIGNlbnRlckosIGVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKCFmb3VuZCkgewoJICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnQgPSBuZXcgRmluZGVyUGF0dGVybl8xLmRlZmF1bHQoY2VudGVySiwgY2VudGVySSwgZXN0aW1hdGVkTW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVycy5wdXNoKHBvaW50KTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayAhPT0gbnVsbCAmJiB0aGlzLnJlc3VsdFBvaW50Q2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrLmZvdW5kUG9zc2libGVSZXN1bHRQb2ludChwb2ludCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2Ygcm93cyB3ZSBjb3VsZCBzYWZlbHkgc2tpcCBkdXJpbmcgc2Nhbm5pbmcsIGJhc2VkIG9uIHRoZSBmaXJzdAoJICAgICAqICAgICAgICAgdHdvIGZpbmRlciBwYXR0ZXJucyB0aGF0IGhhdmUgYmVlbiBsb2NhdGVkLiBJbiBzb21lIGNhc2VzIHRoZWlyIHBvc2l0aW9uIHdpbGwKCSAgICAgKiAgICAgICAgIGFsbG93IHVzIHRvIGluZmVyIHRoYXQgdGhlIHRoaXJkIHBhdHRlcm4gbXVzdCBsaWUgYmVsb3cgYSBjZXJ0YWluIHBvaW50IGZhcnRoZXIKCSAgICAgKiAgICAgICAgIGRvd24gaW4gdGhlIGltYWdlLgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmZpbmRSb3dTa2lwID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIG1heCA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgaWYgKG1heCA8PSAxKSB7CgkgICAgICAgICAgICByZXR1cm4gMDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgZmlyc3RDb25maXJtZWRDZW50ZXIgPSBudWxsOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgX2IgPSBfX3ZhbHVlcyh0aGlzLnBvc3NpYmxlQ2VudGVycyksIF9jID0gX2IubmV4dCgpOyAhX2MuZG9uZTsgX2MgPSBfYi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgY2VudGVyID0gX2MudmFsdWU7CgkgICAgICAgICAgICAgICAgaWYgKGNlbnRlci5nZXRDb3VudCgpID49IEZpbmRlclBhdHRlcm5GaW5kZXIuQ0VOVEVSX1FVT1JVTSkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoZmlyc3RDb25maXJtZWRDZW50ZXIgPT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RDb25maXJtZWRDZW50ZXIgPSBjZW50ZXI7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBoYXZlIHR3byBjb25maXJtZWQgY2VudGVycwoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gSG93IGZhciBkb3duIGNhbiB3ZSBza2lwIGJlZm9yZSByZXN1bWluZyBsb29raW5nIGZvciB0aGUgbmV4dAoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGF0dGVybj8gSW4gdGhlIHdvcnN0IGNhc2UsIG9ubHkgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiB0aGUKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRpZmZlcmVuY2UgaW4gdGhlIHggLyB5IGNvb3JkaW5hdGVzIG9mIHRoZSB0d28gY2VudGVycy4KCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGNhc2Ugd2hlcmUgeW91IGZpbmQgdG9wIGxlZnQgbGFzdC4KCSAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzU2tpcHBlZCA9IHRydWU7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLyooaW50KSAqLyBNYXRoLmZsb29yKChNYXRoLmFicyhmaXJzdENvbmZpcm1lZENlbnRlci5nZXRYKCkgLSBjZW50ZXIuZ2V0WCgpKSAtCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoZmlyc3RDb25maXJtZWRDZW50ZXIuZ2V0WSgpIC0gY2VudGVyLmdldFkoKSkpIC8gMik7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChfYyAmJiAhX2MuZG9uZSAmJiAoX2EgPSBfYi5yZXR1cm4pKSBfYS5jYWxsKF9iKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gdHJ1ZSBpZmYgd2UgaGF2ZSBmb3VuZCBhdCBsZWFzdCAzIGZpbmRlciBwYXR0ZXJucyB0aGF0IGhhdmUgYmVlbiBkZXRlY3RlZAoJICAgICAqICAgICAgICAgYXQgbGVhc3Qge0BsaW5rICNDRU5URVJfUVVPUlVNfSB0aW1lcyBlYWNoLCBhbmQsIHRoZSBlc3RpbWF0ZWQgbW9kdWxlIHNpemUgb2YgdGhlCgkgICAgICogICAgICAgICBjYW5kaWRhdGVzIGlzICJwcmV0dHkgc2ltaWxhciIKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8yLCBfYSwgZV8zLCBfYjsKCSAgICAgICAgdmFyIGNvbmZpcm1lZENvdW50ID0gMDsKCSAgICAgICAgdmFyIHRvdGFsTW9kdWxlU2l6ZSA9IDAuMDsKCSAgICAgICAgdmFyIG1heCA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIF9jID0gX192YWx1ZXModGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfZCA9IF9jLm5leHQoKTsgIV9kLmRvbmU7IF9kID0gX2MubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBfZC52YWx1ZTsKCSAgICAgICAgICAgICAgICBpZiAocGF0dGVybi5nZXRDb3VudCgpID49IEZpbmRlclBhdHRlcm5GaW5kZXIuQ0VOVEVSX1FVT1JVTSkgewoJICAgICAgICAgICAgICAgICAgICBjb25maXJtZWRDb3VudCsrOwoJICAgICAgICAgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gcGF0dGVybi5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzJfMSkgeyBlXzIgPSB7IGVycm9yOiBlXzJfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2QgJiYgIV9kLmRvbmUgJiYgKF9hID0gX2MucmV0dXJuKSkgX2EuY2FsbChfYyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMikgdGhyb3cgZV8yLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvbmZpcm1lZENvdW50IDwgMykgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIE9LLCB3ZSBoYXZlIGF0IGxlYXN0IDMgY29uZmlybWVkIGNlbnRlcnMsIGJ1dCwgaXQncyBwb3NzaWJsZSB0aGF0IG9uZSBpcyBhICJmYWxzZSBwb3NpdGl2ZSIKCSAgICAgICAgLy8gYW5kIHRoYXQgd2UgbmVlZCB0byBrZWVwIGxvb2tpbmcuIFdlIGRldGVjdCB0aGlzIGJ5IGFza2luZyBpZiB0aGUgZXN0aW1hdGVkIG1vZHVsZSBzaXplcwoJICAgICAgICAvLyB2YXJ5IHRvbyBtdWNoLiBXZSBhcmJpdHJhcmlseSBzYXkgdGhhdCB3aGVuIHRoZSB0b3RhbCBkZXZpYXRpb24gZnJvbSBhdmVyYWdlIGV4Y2VlZHMKCSAgICAgICAgLy8gNSUgb2YgdGhlIHRvdGFsIG1vZHVsZSBzaXplIGVzdGltYXRlcywgaXQncyB0b28gbXVjaC4KCSAgICAgICAgdmFyIGF2ZXJhZ2UgPSB0b3RhbE1vZHVsZVNpemUgLyBtYXg7CgkgICAgICAgIHZhciB0b3RhbERldmlhdGlvbiA9IDAuMDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIF9lID0gX192YWx1ZXModGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfZiA9IF9lLm5leHQoKTsgIV9mLmRvbmU7IF9mID0gX2UubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBfZi52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbERldmlhdGlvbiArPSBNYXRoLmFicyhwYXR0ZXJuLmdldEVzdGltYXRlZE1vZHVsZVNpemUoKSAtIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzNfMSkgeyBlXzMgPSB7IGVycm9yOiBlXzNfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2YgJiYgIV9mLmRvbmUgJiYgKF9iID0gX2UucmV0dXJuKSkgX2IuY2FsbChfZSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMykgdGhyb3cgZV8zLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRvdGFsRGV2aWF0aW9uIDw9IDAuMDUgKiB0b3RhbE1vZHVsZVNpemU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHRoZSAzIGJlc3Qge0BsaW5rIEZpbmRlclBhdHRlcm59cyBmcm9tIG91ciBsaXN0IG9mIGNhbmRpZGF0ZXMuIFRoZSAiYmVzdCIgYXJlCgkgICAgICogICAgICAgICB0aG9zZSB0aGF0IGhhdmUgYmVlbiBkZXRlY3RlZCBhdCBsZWFzdCB7QGxpbmsgI0NFTlRFUl9RVU9SVU19IHRpbWVzLCBhbmQgd2hvc2UgbW9kdWxlCgkgICAgICogICAgICAgICBzaXplIGRpZmZlcnMgZnJvbSB0aGUgYXZlcmFnZSBhbW9uZyB0aG9zZSBwYXR0ZXJucyB0aGUgbGVhc3QKCSAgICAgKiBAdGhyb3dzIE5vdEZvdW5kRXhjZXB0aW9uIGlmIDMgc3VjaCBmaW5kZXIgcGF0dGVybnMgZG8gbm90IGV4aXN0CgkgICAgICovCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuc2VsZWN0QmVzdFBhdHRlcm5zID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV80LCBfYSwgZV81LCBfYjsKCSAgICAgICAgdmFyIHN0YXJ0U2l6ZSA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgaWYgKHN0YXJ0U2l6ZSA8IDMpIHsKCSAgICAgICAgICAgIC8vIENvdWxkbid0IGZpbmQgZW5vdWdoIGZpbmRlciBwYXR0ZXJucwoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkMi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHBvc3NpYmxlQ2VudGVycyA9IHRoaXMucG9zc2libGVDZW50ZXJzOwoJICAgICAgICB2YXIgYXZlcmFnZTsKCSAgICAgICAgLy8gRmlsdGVyIG91dGxpZXIgcG9zc2liaWxpdGllcyB3aG9zZSBtb2R1bGUgc2l6ZSBpcyB0b28gZGlmZmVyZW50CgkgICAgICAgIGlmIChzdGFydFNpemUgPiAzKSB7CgkgICAgICAgICAgICAvLyBCdXQgd2UgY2FuIG9ubHkgYWZmb3JkIHRvIGRvIHNvIGlmIHdlIGhhdmUgYXQgbGVhc3QgNCBwb3NzaWJpbGl0aWVzIHRvIGNob29zZSBmcm9tCgkgICAgICAgICAgICB2YXIgdG90YWxNb2R1bGVTaXplID0gMC4wOwoJICAgICAgICAgICAgdmFyIHNxdWFyZSA9IDAuMDsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgX2MgPSBfX3ZhbHVlcyh0aGlzLnBvc3NpYmxlQ2VudGVycyksIF9kID0gX2MubmV4dCgpOyAhX2QuZG9uZTsgX2QgPSBfYy5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlciA9IF9kLnZhbHVlOwoJICAgICAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IGNlbnRlci5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCk7CgkgICAgICAgICAgICAgICAgICAgIHRvdGFsTW9kdWxlU2l6ZSArPSBzaXplOwoJICAgICAgICAgICAgICAgICAgICBzcXVhcmUgKz0gc2l6ZSAqIHNpemU7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgY2F0Y2ggKGVfNF8xKSB7IGVfNCA9IHsgZXJyb3I6IGVfNF8xIH07IH0KCSAgICAgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChfZCAmJiAhX2QuZG9uZSAmJiAoX2EgPSBfYy5yZXR1cm4pKSBfYS5jYWxsKF9jKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZmluYWxseSB7IGlmIChlXzQpIHRocm93IGVfNC5lcnJvcjsgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgYXZlcmFnZSA9IHRvdGFsTW9kdWxlU2l6ZSAvIHN0YXJ0U2l6ZTsKCSAgICAgICAgICAgIHZhciBzdGREZXYgPSBNYXRoLnNxcnQoc3F1YXJlIC8gc3RhcnRTaXplIC0gYXZlcmFnZSAqIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzLnNvcnQoCgkgICAgICAgICAgICAvKioKCSAgICAgICAgICAgICAqIDxwPk9yZGVycyBieSBmdXJ0aGVzdCBmcm9tIGF2ZXJhZ2U8L3A+CgkgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgIC8vIEZ1cnRoZXN0RnJvbUF2ZXJhZ2VDb21wYXJhdG9yIGltcGxlbWVudHMgQ29tcGFyYXRvcjxGaW5kZXJQYXR0ZXJuPgoJICAgICAgICAgICAgZnVuY3Rpb24gKGNlbnRlcjEsIGNlbnRlcjIpIHsKCSAgICAgICAgICAgICAgICB2YXIgZEEgPSBNYXRoLmFicyhjZW50ZXIyLmdldEVzdGltYXRlZE1vZHVsZVNpemUoKSAtIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgICAgIHZhciBkQiA9IE1hdGguYWJzKGNlbnRlcjEuZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpIC0gYXZlcmFnZSk7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGRBIDwgZEIgPyAtMSA6IGRBID4gZEIgPyAxIDogMDsKCSAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgdmFyIGxpbWl0ID0gTWF0aC5tYXgoMC4yICogYXZlcmFnZSwgc3RkRGV2KTsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcG9zc2libGVDZW50ZXJzLmxlbmd0aCAmJiBwb3NzaWJsZUNlbnRlcnMubGVuZ3RoID4gMzsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBwb3NzaWJsZUNlbnRlcnNbaV07CgkgICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHBhdHRlcm4uZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpIC0gYXZlcmFnZSkgPiBsaW1pdCkgewoJICAgICAgICAgICAgICAgICAgICBwb3NzaWJsZUNlbnRlcnMuc3BsaWNlKGksIDEpOwoJICAgICAgICAgICAgICAgICAgICBpLS07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGlmIChwb3NzaWJsZUNlbnRlcnMubGVuZ3RoID4gMykgewoJICAgICAgICAgICAgLy8gVGhyb3cgYXdheSBhbGwgYnV0IHRob3NlIGZpcnN0IHNpemUgY2FuZGlkYXRlIHBvaW50cyB3ZSBmb3VuZC4KCSAgICAgICAgICAgIHZhciB0b3RhbE1vZHVsZVNpemUgPSAwLjA7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGZvciAodmFyIHBvc3NpYmxlQ2VudGVyc18xID0gX192YWx1ZXMocG9zc2libGVDZW50ZXJzKSwgcG9zc2libGVDZW50ZXJzXzFfMSA9IHBvc3NpYmxlQ2VudGVyc18xLm5leHQoKTsgIXBvc3NpYmxlQ2VudGVyc18xXzEuZG9uZTsgcG9zc2libGVDZW50ZXJzXzFfMSA9IHBvc3NpYmxlQ2VudGVyc18xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgICAgICB2YXIgcG9zc2libGVDZW50ZXIgPSBwb3NzaWJsZUNlbnRlcnNfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gcG9zc2libGVDZW50ZXIuZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGNhdGNoIChlXzVfMSkgeyBlXzUgPSB7IGVycm9yOiBlXzVfMSB9OyB9CgkgICAgICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgICAgICBpZiAocG9zc2libGVDZW50ZXJzXzFfMSAmJiAhcG9zc2libGVDZW50ZXJzXzFfMS5kb25lICYmIChfYiA9IHBvc3NpYmxlQ2VudGVyc18xLnJldHVybikpIF9iLmNhbGwocG9zc2libGVDZW50ZXJzXzEpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfNSkgdGhyb3cgZV81LmVycm9yOyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBhdmVyYWdlID0gdG90YWxNb2R1bGVTaXplIC8gcG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVycy5zb3J0KAoJICAgICAgICAgICAgLyoqCgkgICAgICAgICAgICAgKiA8cD5PcmRlcnMgYnkge0BsaW5rIEZpbmRlclBhdHRlcm4jZ2V0Q291bnQoKX0sIGRlc2NlbmRpbmcuPC9wPgoJICAgICAgICAgICAgICovCgkgICAgICAgICAgICAvLyBDZW50ZXJDb21wYXJhdG9yIGltcGxlbWVudHMgQ29tcGFyYXRvcjxGaW5kZXJQYXR0ZXJuPgoJICAgICAgICAgICAgZnVuY3Rpb24gKGNlbnRlcjEsIGNlbnRlcjIpIHsKCSAgICAgICAgICAgICAgICBpZiAoY2VudGVyMi5nZXRDb3VudCgpID09PSBjZW50ZXIxLmdldENvdW50KCkpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGRBID0gTWF0aC5hYnMoY2VudGVyMi5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCkgLSBhdmVyYWdlKTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGRCID0gTWF0aC5hYnMoY2VudGVyMS5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCkgLSBhdmVyYWdlKTsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRBIDwgZEIgPyAxIDogZEEgPiBkQiA/IC0xIDogMDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBjZW50ZXIyLmdldENvdW50KCkgLSBjZW50ZXIxLmdldENvdW50KCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSk7CgkgICAgICAgICAgICBwb3NzaWJsZUNlbnRlcnMuc3BsaWNlKDMpOyAvLyB0aGlzIGlzIG5vdCByZWFseSBuZWNlc3NhcnkgYXMgd2Ugb25seSByZXR1cm4gZmlyc3QgMyBhbnl3YXkKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gWwoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzBdLAoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzFdLAoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzJdCgkgICAgICAgIF07CgkgICAgfTsKCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLkNFTlRFUl9RVU9SVU0gPSAyOwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuTUlOX1NLSVAgPSAzOyAvLyAxIHBpeGVsL21vZHVsZSB0aW1lcyAzIG1vZHVsZXMvY2VudGVyCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5NQVhfTU9EVUxFUyA9IDU3OyAvLyBzdXBwb3J0IHVwIHRvIHZlcnNpb24gMTAgZm9yIG1vYmlsZSBjbGllbnRzCgkgICAgcmV0dXJuIEZpbmRlclBhdHRlcm5GaW5kZXI7Cgl9KCkpOwoJRmluZGVyUGF0dGVybkZpbmRlciQxLmRlZmF1bHQgPSBGaW5kZXJQYXR0ZXJuRmluZGVyOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGV0ZWN0b3IkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIE1hdGhVdGlsc18xID0gTWF0aFV0aWxzJDE7Cgl2YXIgRGV0ZWN0b3JSZXN1bHRfMSA9IERldGVjdG9yUmVzdWx0JDE7CgkvLyBpbXBvcnQgR3JpZFNhbXBsZXIgZnJvbSAnLi4vLi4vY29tbW9uL0dyaWRTYW1wbGVyJzsKCXZhciBHcmlkU2FtcGxlckluc3RhbmNlXzEgPSBHcmlkU2FtcGxlckluc3RhbmNlJDE7Cgl2YXIgUGVyc3BlY3RpdmVUcmFuc2Zvcm1fMSA9IFBlcnNwZWN0aXZlVHJhbnNmb3JtJDE7Cgl2YXIgRGVjb2RlSGludFR5cGVfMSQxID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJdmFyIFJlc3VsdFBvaW50XzEgPSBSZXN1bHRQb2ludCQxOwoJdmFyIFZlcnNpb25fMSA9IFZlcnNpb24kMTsKCXZhciBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyXzEgPSBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyJDE7Cgl2YXIgRmluZGVyUGF0dGVybkZpbmRlcl8xID0gRmluZGVyUGF0dGVybkZpbmRlciQxOwoJLyppbXBvcnQgamF2YS51dGlsLk1hcDsqLwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgbG9naWMgdGhhdCBjYW4gZGV0ZWN0IGEgUVIgQ29kZSBpbiBhbiBpbWFnZSwgZXZlbiBpZiB0aGUgUVIgQ29kZQoJICogaXMgcm90YXRlZCBvciBza2V3ZWQsIG9yIHBhcnRpYWxseSBvYnNjdXJlZC48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERldGVjdG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIERldGVjdG9yKGltYWdlKSB7CgkgICAgICAgIHRoaXMuaW1hZ2UgPSBpbWFnZTsKCSAgICB9CgkgICAgRGV0ZWN0b3IucHJvdG90eXBlLmdldEltYWdlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5pbWFnZTsKCSAgICB9OwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5nZXRSZXN1bHRQb2ludENhbGxiYWNrID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZWN0cyBhIFFSIENvZGUgaW4gYW4gaW1hZ2UuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiB7QGxpbmsgRGV0ZWN0b3JSZXN1bHR9IGVuY2Fwc3VsYXRpbmcgcmVzdWx0cyBvZiBkZXRlY3RpbmcgYSBRUiBDb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBRUiBDb2RlIGNhbm5vdCBiZSBmb3VuZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIGEgUVIgQ29kZSBjYW5ub3QgYmUgZGVjb2RlZAoJICAgICAqLwoJICAgIC8vIHB1YmxpYyBkZXRlY3QoKTogRGV0ZWN0b3JSZXN1bHQgLyp0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiovIHsKCSAgICAvLyAgIHJldHVybiBkZXRlY3QobnVsbCkKCSAgICAvLyB9CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZWN0cyBhIFFSIENvZGUgaW4gYW4gaW1hZ2UuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGhpbnRzIG9wdGlvbmFsIGhpbnRzIHRvIGRldGVjdG9yCgkgICAgICogQHJldHVybiB7QGxpbmsgRGV0ZWN0b3JSZXN1bHR9IGVuY2Fwc3VsYXRpbmcgcmVzdWx0cyBvZiBkZXRlY3RpbmcgYSBRUiBDb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBRUiBDb2RlIGNhbm5vdCBiZSBmb3VuZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIGEgUVIgQ29kZSBjYW5ub3QgYmUgZGVjb2RlZAoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5kZXRlY3QgPSBmdW5jdGlvbiAoaGludHMpIHsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gKGhpbnRzID09PSBudWxsIHx8IGhpbnRzID09PSB1bmRlZmluZWQpID8gbnVsbCA6CgkgICAgICAgICAgICAvKihSZXN1bHRQb2ludENhbGxiYWNrKSAqLyBoaW50cy5nZXQoRGVjb2RlSGludFR5cGVfMSQxLmRlZmF1bHQuTkVFRF9SRVNVTFRfUE9JTlRfQ0FMTEJBQ0spOwoJICAgICAgICB2YXIgZmluZGVyID0gbmV3IEZpbmRlclBhdHRlcm5GaW5kZXJfMS5kZWZhdWx0KHRoaXMuaW1hZ2UsIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayk7CgkgICAgICAgIHZhciBpbmZvID0gZmluZGVyLmZpbmQoaGludHMpOwoJICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzRmluZGVyUGF0dGVybkluZm8oaW5mbyk7CgkgICAgfTsKCSAgICBEZXRlY3Rvci5wcm90b3R5cGUucHJvY2Vzc0ZpbmRlclBhdHRlcm5JbmZvID0gZnVuY3Rpb24gKGluZm8pIHsKCSAgICAgICAgdmFyIHRvcExlZnQgPSBpbmZvLmdldFRvcExlZnQoKTsKCSAgICAgICAgdmFyIHRvcFJpZ2h0ID0gaW5mby5nZXRUb3BSaWdodCgpOwoJICAgICAgICB2YXIgYm90dG9tTGVmdCA9IGluZm8uZ2V0Qm90dG9tTGVmdCgpOwoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRoaXMuY2FsY3VsYXRlTW9kdWxlU2l6ZSh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCk7CgkgICAgICAgIGlmIChtb2R1bGVTaXplIDwgMS4wKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQxLmRlZmF1bHQoJ05vIHBhdHRlcm4gZm91bmQgaW4gcHJvY2Nlc3MgZmluZGVyLicpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBkaW1lbnNpb24gPSBEZXRlY3Rvci5jb21wdXRlRGltZW5zaW9uKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIHByb3Zpc2lvbmFsVmVyc2lvbiA9IFZlcnNpb25fMS5kZWZhdWx0LmdldFByb3Zpc2lvbmFsVmVyc2lvbkZvckRpbWVuc2lvbihkaW1lbnNpb24pOwoJICAgICAgICB2YXIgbW9kdWxlc0JldHdlZW5GUENlbnRlcnMgPSBwcm92aXNpb25hbFZlcnNpb24uZ2V0RGltZW5zaW9uRm9yVmVyc2lvbigpIC0gNzsKCSAgICAgICAgdmFyIGFsaWdubWVudFBhdHRlcm4gPSBudWxsOwoJICAgICAgICAvLyBBbnl0aGluZyBhYm92ZSB2ZXJzaW9uIDEgaGFzIGFuIGFsaWdubWVudCBwYXR0ZXJuCgkgICAgICAgIGlmIChwcm92aXNpb25hbFZlcnNpb24uZ2V0QWxpZ25tZW50UGF0dGVybkNlbnRlcnMoKS5sZW5ndGggPiAwKSB7CgkgICAgICAgICAgICAvLyBHdWVzcyB3aGVyZSBhICJib3R0b20gcmlnaHQiIGZpbmRlciBwYXR0ZXJuIHdvdWxkIGhhdmUgYmVlbgoJICAgICAgICAgICAgdmFyIGJvdHRvbVJpZ2h0WCA9IHRvcFJpZ2h0LmdldFgoKSAtIHRvcExlZnQuZ2V0WCgpICsgYm90dG9tTGVmdC5nZXRYKCk7CgkgICAgICAgICAgICB2YXIgYm90dG9tUmlnaHRZID0gdG9wUmlnaHQuZ2V0WSgpIC0gdG9wTGVmdC5nZXRZKCkgKyBib3R0b21MZWZ0LmdldFkoKTsKCSAgICAgICAgICAgIC8vIEVzdGltYXRlIHRoYXQgYWxpZ25tZW50IHBhdHRlcm4gaXMgY2xvc2VyIGJ5IDMgbW9kdWxlcwoJICAgICAgICAgICAgLy8gZnJvbSAiYm90dG9tIHJpZ2h0IiB0byBrbm93biB0b3AgbGVmdCBsb2NhdGlvbgoJICAgICAgICAgICAgdmFyIGNvcnJlY3Rpb25Ub1RvcExlZnQgPSAxLjAgLSAzLjAgLyBtb2R1bGVzQmV0d2VlbkZQQ2VudGVyczsKCSAgICAgICAgICAgIHZhciBlc3RBbGlnbm1lbnRYID0gLyooaW50KSAqLyBNYXRoLmZsb29yKHRvcExlZnQuZ2V0WCgpICsgY29ycmVjdGlvblRvVG9wTGVmdCAqIChib3R0b21SaWdodFggLSB0b3BMZWZ0LmdldFgoKSkpOwoJICAgICAgICAgICAgdmFyIGVzdEFsaWdubWVudFkgPSAvKihpbnQpICovIE1hdGguZmxvb3IodG9wTGVmdC5nZXRZKCkgKyBjb3JyZWN0aW9uVG9Ub3BMZWZ0ICogKGJvdHRvbVJpZ2h0WSAtIHRvcExlZnQuZ2V0WSgpKSk7CgkgICAgICAgICAgICAvLyBLaW5kIG9mIGFyYml0cmFyeSAtLSBleHBhbmQgc2VhcmNoIHJhZGl1cyBiZWZvcmUgZ2l2aW5nIHVwCgkgICAgICAgICAgICBmb3IgKHZhciBpID0gNDsgaSA8PSAxNjsgaSA8PD0gMSkgewoJICAgICAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgICAgIGFsaWdubWVudFBhdHRlcm4gPSB0aGlzLmZpbmRBbGlnbm1lbnRJblJlZ2lvbihtb2R1bGVTaXplLCBlc3RBbGlnbm1lbnRYLCBlc3RBbGlnbm1lbnRZLCBpKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGNhdGNoIChyZSAvKk5vdEZvdW5kRXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCEocmUgaW5zdGFuY2VvZiBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IHJlOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIC8vIHRyeSBuZXh0IHJvdW5kCgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gSWYgd2UgZGlkbid0IGZpbmQgYWxpZ25tZW50IHBhdHRlcm4uLi4gd2VsbCB0cnkgYW55d2F5IHdpdGhvdXQgaXQKCSAgICAgICAgfQoJICAgICAgICB2YXIgdHJhbnNmb3JtID0gRGV0ZWN0b3IuY3JlYXRlVHJhbnNmb3JtKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBhbGlnbm1lbnRQYXR0ZXJuLCBkaW1lbnNpb24pOwoJICAgICAgICB2YXIgYml0cyA9IERldGVjdG9yLnNhbXBsZUdyaWQodGhpcy5pbWFnZSwgdHJhbnNmb3JtLCBkaW1lbnNpb24pOwoJICAgICAgICB2YXIgcG9pbnRzOwoJICAgICAgICBpZiAoYWxpZ25tZW50UGF0dGVybiA9PT0gbnVsbCkgewoJICAgICAgICAgICAgcG9pbnRzID0gW2JvdHRvbUxlZnQsIHRvcExlZnQsIHRvcFJpZ2h0XTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHBvaW50cyA9IFtib3R0b21MZWZ0LCB0b3BMZWZ0LCB0b3BSaWdodCwgYWxpZ25tZW50UGF0dGVybl07CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG5ldyBEZXRlY3RvclJlc3VsdF8xLmRlZmF1bHQoYml0cywgcG9pbnRzKTsKCSAgICB9OwoJICAgIERldGVjdG9yLmNyZWF0ZVRyYW5zZm9ybSA9IGZ1bmN0aW9uICh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCwgYWxpZ25tZW50UGF0dGVybiwgZGltZW5zaW9uIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGRpbU1pbnVzVGhyZWUgPSBkaW1lbnNpb24gLSAzLjU7CgkgICAgICAgIHZhciBib3R0b21SaWdodFg7IC8qZmxvYXQqLwoJICAgICAgICB2YXIgYm90dG9tUmlnaHRZOyAvKmZsb2F0Ki8KCSAgICAgICAgdmFyIHNvdXJjZUJvdHRvbVJpZ2h0WDsgLypmbG9hdCovCgkgICAgICAgIHZhciBzb3VyY2VCb3R0b21SaWdodFk7IC8qZmxvYXQqLwoJICAgICAgICBpZiAoYWxpZ25tZW50UGF0dGVybiAhPT0gbnVsbCkgewoJICAgICAgICAgICAgYm90dG9tUmlnaHRYID0gYWxpZ25tZW50UGF0dGVybi5nZXRYKCk7CgkgICAgICAgICAgICBib3R0b21SaWdodFkgPSBhbGlnbm1lbnRQYXR0ZXJuLmdldFkoKTsKCSAgICAgICAgICAgIHNvdXJjZUJvdHRvbVJpZ2h0WCA9IGRpbU1pbnVzVGhyZWUgLSAzLjA7CgkgICAgICAgICAgICBzb3VyY2VCb3R0b21SaWdodFkgPSBzb3VyY2VCb3R0b21SaWdodFg7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAvLyBEb24ndCBoYXZlIGFuIGFsaWdubWVudCBwYXR0ZXJuLCBqdXN0IG1ha2UgdXAgdGhlIGJvdHRvbS1yaWdodCBwb2ludAoJICAgICAgICAgICAgYm90dG9tUmlnaHRYID0gKHRvcFJpZ2h0LmdldFgoKSAtIHRvcExlZnQuZ2V0WCgpKSArIGJvdHRvbUxlZnQuZ2V0WCgpOwoJICAgICAgICAgICAgYm90dG9tUmlnaHRZID0gKHRvcFJpZ2h0LmdldFkoKSAtIHRvcExlZnQuZ2V0WSgpKSArIGJvdHRvbUxlZnQuZ2V0WSgpOwoJICAgICAgICAgICAgc291cmNlQm90dG9tUmlnaHRYID0gZGltTWludXNUaHJlZTsKCSAgICAgICAgICAgIHNvdXJjZUJvdHRvbVJpZ2h0WSA9IGRpbU1pbnVzVGhyZWU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIFBlcnNwZWN0aXZlVHJhbnNmb3JtXzEuZGVmYXVsdC5xdWFkcmlsYXRlcmFsVG9RdWFkcmlsYXRlcmFsKDMuNSwgMy41LCBkaW1NaW51c1RocmVlLCAzLjUsIHNvdXJjZUJvdHRvbVJpZ2h0WCwgc291cmNlQm90dG9tUmlnaHRZLCAzLjUsIGRpbU1pbnVzVGhyZWUsIHRvcExlZnQuZ2V0WCgpLCB0b3BMZWZ0LmdldFkoKSwgdG9wUmlnaHQuZ2V0WCgpLCB0b3BSaWdodC5nZXRZKCksIGJvdHRvbVJpZ2h0WCwgYm90dG9tUmlnaHRZLCBib3R0b21MZWZ0LmdldFgoKSwgYm90dG9tTGVmdC5nZXRZKCkpOwoJICAgIH07CgkgICAgRGV0ZWN0b3Iuc2FtcGxlR3JpZCA9IGZ1bmN0aW9uIChpbWFnZSwgdHJhbnNmb3JtLCBkaW1lbnNpb24gLyppbnQqLykgewoJICAgICAgICB2YXIgc2FtcGxlciA9IEdyaWRTYW1wbGVySW5zdGFuY2VfMS5kZWZhdWx0LmdldEluc3RhbmNlKCk7CgkgICAgICAgIHJldHVybiBzYW1wbGVyLnNhbXBsZUdyaWRXaXRoVHJhbnNmb3JtKGltYWdlLCBkaW1lbnNpb24sIGRpbWVuc2lvbiwgdHJhbnNmb3JtKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkNvbXB1dGVzIHRoZSBkaW1lbnNpb24gKG51bWJlciBvZiBtb2R1bGVzIG9uIGEgc2l6ZSkgb2YgdGhlIFFSIENvZGUgYmFzZWQgb24gdGhlIHBvc2l0aW9uCgkgICAgICogb2YgdGhlIGZpbmRlciBwYXR0ZXJucyBhbmQgZXN0aW1hdGVkIG1vZHVsZSBzaXplLjwvcD4KCSAgICAgKi8KCSAgICBEZXRlY3Rvci5jb21wdXRlRGltZW5zaW9uID0gZnVuY3Rpb24gKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBtb2R1bGVTaXplIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgdGx0ckNlbnRlcnNEaW1lbnNpb24gPSBNYXRoVXRpbHNfMS5kZWZhdWx0LnJvdW5kKFJlc3VsdFBvaW50XzEuZGVmYXVsdC5kaXN0YW5jZSh0b3BMZWZ0LCB0b3BSaWdodCkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIHRsYmxDZW50ZXJzRGltZW5zaW9uID0gTWF0aFV0aWxzXzEuZGVmYXVsdC5yb3VuZChSZXN1bHRQb2ludF8xLmRlZmF1bHQuZGlzdGFuY2UodG9wTGVmdCwgYm90dG9tTGVmdCkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IE1hdGguZmxvb3IoKHRsdHJDZW50ZXJzRGltZW5zaW9uICsgdGxibENlbnRlcnNEaW1lbnNpb24pIC8gMikgKyA3OwoJICAgICAgICBzd2l0Y2ggKGRpbWVuc2lvbiAmIDB4MDMpIHsgLy8gbW9kIDQKCSAgICAgICAgICAgIGNhc2UgMDoKCSAgICAgICAgICAgICAgICBkaW1lbnNpb24rKzsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIC8vIDE/IGRvIG5vdGhpbmcKCSAgICAgICAgICAgIGNhc2UgMjoKCSAgICAgICAgICAgICAgICBkaW1lbnNpb24tLTsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIGNhc2UgMzoKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQxLmRlZmF1bHQoJ0RpbWVuc2lvbnMgY291bGQgYmUgbm90IGZvdW5kLicpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBkaW1lbnNpb247CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5Db21wdXRlcyBhbiBhdmVyYWdlIGVzdGltYXRlZCBtb2R1bGUgc2l6ZSBiYXNlZCBvbiBlc3RpbWF0ZWQgZGVyaXZlZCBmcm9tIHRoZSBwb3NpdGlvbnMKCSAgICAgKiBvZiB0aGUgdGhyZWUgZmluZGVyIHBhdHRlcm5zLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB0b3BMZWZ0IGRldGVjdGVkIHRvcC1sZWZ0IGZpbmRlciBwYXR0ZXJuIGNlbnRlcgoJICAgICAqIEBwYXJhbSB0b3BSaWdodCBkZXRlY3RlZCB0b3AtcmlnaHQgZmluZGVyIHBhdHRlcm4gY2VudGVyCgkgICAgICogQHBhcmFtIGJvdHRvbUxlZnQgZGV0ZWN0ZWQgYm90dG9tLWxlZnQgZmluZGVyIHBhdHRlcm4gY2VudGVyCgkgICAgICogQHJldHVybiBlc3RpbWF0ZWQgbW9kdWxlIHNpemUKCSAgICAgKi8KCSAgICBEZXRlY3Rvci5wcm90b3R5cGUuY2FsY3VsYXRlTW9kdWxlU2l6ZSA9IGZ1bmN0aW9uICh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCkgewoJICAgICAgICAvLyBUYWtlIHRoZSBhdmVyYWdlCgkgICAgICAgIHJldHVybiAodGhpcy5jYWxjdWxhdGVNb2R1bGVTaXplT25lV2F5KHRvcExlZnQsIHRvcFJpZ2h0KSArCgkgICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZU1vZHVsZVNpemVPbmVXYXkodG9wTGVmdCwgYm90dG9tTGVmdCkpIC8gMi4wOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+RXN0aW1hdGVzIG1vZHVsZSBzaXplIGJhc2VkIG9uIHR3byBmaW5kZXIgcGF0dGVybnMgLS0gaXQgdXNlcwoJICAgICAqIHtAbGluayAjc2l6ZU9mQmxhY2tXaGl0ZUJsYWNrUnVuQm90aFdheXMoaW50LCBpbnQsIGludCwgaW50KX0gdG8gZmlndXJlIHRoZQoJICAgICAqIHdpZHRoIG9mIGVhY2gsIG1lYXN1cmluZyBhbG9uZyB0aGUgYXhpcyBiZXR3ZWVuIHRoZWlyIGNlbnRlcnMuPC9wPgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5jYWxjdWxhdGVNb2R1bGVTaXplT25lV2F5ID0gZnVuY3Rpb24gKHBhdHRlcm4sIG90aGVyUGF0dGVybikgewoJICAgICAgICB2YXIgbW9kdWxlU2l6ZUVzdDEgPSB0aGlzLnNpemVPZkJsYWNrV2hpdGVCbGFja1J1bkJvdGhXYXlzKC8qKGludCkgKi8gTWF0aC5mbG9vcihwYXR0ZXJuLmdldFgoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3IocGF0dGVybi5nZXRZKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKG90aGVyUGF0dGVybi5nZXRYKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKG90aGVyUGF0dGVybi5nZXRZKCkpKTsKCSAgICAgICAgdmFyIG1vZHVsZVNpemVFc3QyID0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW5Cb3RoV2F5cygvKihpbnQpICovIE1hdGguZmxvb3Iob3RoZXJQYXR0ZXJuLmdldFgoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3Iob3RoZXJQYXR0ZXJuLmdldFkoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3IocGF0dGVybi5nZXRYKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKHBhdHRlcm4uZ2V0WSgpKSk7CgkgICAgICAgIGlmIChpc05hTihtb2R1bGVTaXplRXN0MSkpIHsKCSAgICAgICAgICAgIHJldHVybiBtb2R1bGVTaXplRXN0MiAvIDcuMDsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaXNOYU4obW9kdWxlU2l6ZUVzdDIpKSB7CgkgICAgICAgICAgICByZXR1cm4gbW9kdWxlU2l6ZUVzdDEgLyA3LjA7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQXZlcmFnZSB0aGVtLCBhbmQgZGl2aWRlIGJ5IDcgc2luY2Ugd2UndmUgY291bnRlZCB0aGUgd2lkdGggb2YgMyBibGFjayBtb2R1bGVzLAoJICAgICAgICAvLyBhbmQgMSB3aGl0ZSBhbmQgMSBibGFjayBtb2R1bGUgb24gZWl0aGVyIHNpZGUuIEVyZ28sIGRpdmlkZSBzdW0gYnkgMTQuCgkgICAgICAgIHJldHVybiAobW9kdWxlU2l6ZUVzdDEgKyBtb2R1bGVTaXplRXN0MikgLyAxNC4wOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogU2VlIHtAbGluayAjc2l6ZU9mQmxhY2tXaGl0ZUJsYWNrUnVuKGludCwgaW50LCBpbnQsIGludCl9OyBjb21wdXRlcyB0aGUgdG90YWwgd2lkdGggb2YKCSAgICAgKiBhIGZpbmRlciBwYXR0ZXJuIGJ5IGxvb2tpbmcgZm9yIGEgYmxhY2std2hpdGUtYmxhY2sgcnVuIGZyb20gdGhlIGNlbnRlciBpbiB0aGUgZGlyZWN0aW9uCgkgICAgICogb2YgYW5vdGhlciBwb2ludCAoYW5vdGhlciBmaW5kZXIgcGF0dGVybiBjZW50ZXIpLCBhbmQgaW4gdGhlIG9wcG9zaXRlIGRpcmVjdGlvbiB0b28uCgkgICAgICovCgkgICAgRGV0ZWN0b3IucHJvdG90eXBlLnNpemVPZkJsYWNrV2hpdGVCbGFja1J1bkJvdGhXYXlzID0gZnVuY3Rpb24gKGZyb21YIC8qaW50Ki8sIGZyb21ZIC8qaW50Ki8sIHRvWCAvKmludCovLCB0b1kgLyppbnQqLykgewoJICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4oZnJvbVgsIGZyb21ZLCB0b1gsIHRvWSk7CgkgICAgICAgIC8vIE5vdyBjb3VudCBvdGhlciB3YXkgLS0gZG9uJ3QgcnVuIG9mZiBpbWFnZSB0aG91Z2ggb2YgY291cnNlCgkgICAgICAgIHZhciBzY2FsZSA9IDEuMDsKCSAgICAgICAgdmFyIG90aGVyVG9YID0gZnJvbVggLSAodG9YIC0gZnJvbVgpOwoJICAgICAgICBpZiAob3RoZXJUb1ggPCAwKSB7CgkgICAgICAgICAgICBzY2FsZSA9IGZyb21YIC8gLyooZmxvYXQpICovIChmcm9tWCAtIG90aGVyVG9YKTsKCSAgICAgICAgICAgIG90aGVyVG9YID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChvdGhlclRvWCA+PSB0aGlzLmltYWdlLmdldFdpZHRoKCkpIHsKCSAgICAgICAgICAgIHNjYWxlID0gKHRoaXMuaW1hZ2UuZ2V0V2lkdGgoKSAtIDEgLSBmcm9tWCkgLyAvKihmbG9hdCkgKi8gKG90aGVyVG9YIC0gZnJvbVgpOwoJICAgICAgICAgICAgb3RoZXJUb1ggPSB0aGlzLmltYWdlLmdldFdpZHRoKCkgLSAxOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlclRvWSA9IC8qKGludCkgKi8gTWF0aC5mbG9vcihmcm9tWSAtICh0b1kgLSBmcm9tWSkgKiBzY2FsZSk7CgkgICAgICAgIHNjYWxlID0gMS4wOwoJICAgICAgICBpZiAob3RoZXJUb1kgPCAwKSB7CgkgICAgICAgICAgICBzY2FsZSA9IGZyb21ZIC8gLyooZmxvYXQpICovIChmcm9tWSAtIG90aGVyVG9ZKTsKCSAgICAgICAgICAgIG90aGVyVG9ZID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChvdGhlclRvWSA+PSB0aGlzLmltYWdlLmdldEhlaWdodCgpKSB7CgkgICAgICAgICAgICBzY2FsZSA9ICh0aGlzLmltYWdlLmdldEhlaWdodCgpIC0gMSAtIGZyb21ZKSAvIC8qKGZsb2F0KSAqLyAob3RoZXJUb1kgLSBmcm9tWSk7CgkgICAgICAgICAgICBvdGhlclRvWSA9IHRoaXMuaW1hZ2UuZ2V0SGVpZ2h0KCkgLSAxOwoJICAgICAgICB9CgkgICAgICAgIG90aGVyVG9YID0gLyooaW50KSAqLyBNYXRoLmZsb29yKGZyb21YICsgKG90aGVyVG9YIC0gZnJvbVgpICogc2NhbGUpOwoJICAgICAgICByZXN1bHQgKz0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4oZnJvbVgsIGZyb21ZLCBvdGhlclRvWCwgb3RoZXJUb1kpOwoJICAgICAgICAvLyBNaWRkbGUgcGl4ZWwgaXMgZG91YmxlLWNvdW50ZWQgdGhpcyB3YXk7IHN1YnRyYWN0IDEKCSAgICAgICAgcmV0dXJuIHJlc3VsdCAtIDEuMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlRoaXMgbWV0aG9kIHRyYWNlcyBhIGxpbmUgZnJvbSBhIHBvaW50IGluIHRoZSBpbWFnZSwgaW4gdGhlIGRpcmVjdGlvbiB0b3dhcmRzIGFub3RoZXIgcG9pbnQuCgkgICAgICogSXQgYmVnaW5zIGluIGEgYmxhY2sgcmVnaW9uLCBhbmQga2VlcHMgZ29pbmcgdW50aWwgaXQgZmluZHMgd2hpdGUsIHRoZW4gYmxhY2ssIHRoZW4gd2hpdGUgYWdhaW4uCgkgICAgICogSXQgcmVwb3J0cyB0aGUgZGlzdGFuY2UgZnJvbSB0aGUgc3RhcnQgdG8gdGhpcyBwb2ludC48L3A+CgkgICAgICoKCSAgICAgKiA8cD5UaGlzIGlzIHVzZWQgd2hlbiBmaWd1cmluZyBvdXQgaG93IHdpZGUgYSBmaW5kZXIgcGF0dGVybiBpcywgd2hlbiB0aGUgZmluZGVyIHBhdHRlcm4KCSAgICAgKiBtYXkgYmUgc2tld2VkIG9yIHJvdGF0ZWQuPC9wPgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4gPSBmdW5jdGlvbiAoZnJvbVggLyppbnQqLywgZnJvbVkgLyppbnQqLywgdG9YIC8qaW50Ki8sIHRvWSAvKmludCovKSB7CgkgICAgICAgIC8vIE1pbGQgdmFyaWFudCBvZiBCcmVzZW5oYW0ncyBhbGdvcml0aG0KCSAgICAgICAgLy8gc2VlIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQnJlc2VuaGFtJ3NfbGluZV9hbGdvcml0aG0KCSAgICAgICAgdmFyIHN0ZWVwID0gTWF0aC5hYnModG9ZIC0gZnJvbVkpID4gTWF0aC5hYnModG9YIC0gZnJvbVgpOwoJICAgICAgICBpZiAoc3RlZXApIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gZnJvbVg7CgkgICAgICAgICAgICBmcm9tWCA9IGZyb21ZOwoJICAgICAgICAgICAgZnJvbVkgPSB0ZW1wOwoJICAgICAgICAgICAgdGVtcCA9IHRvWDsKCSAgICAgICAgICAgIHRvWCA9IHRvWTsKCSAgICAgICAgICAgIHRvWSA9IHRlbXA7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGR4ID0gTWF0aC5hYnModG9YIC0gZnJvbVgpOwoJICAgICAgICB2YXIgZHkgPSBNYXRoLmFicyh0b1kgLSBmcm9tWSk7CgkgICAgICAgIHZhciBlcnJvciA9IC1keCAvIDI7CgkgICAgICAgIHZhciB4c3RlcCA9IGZyb21YIDwgdG9YID8gMSA6IC0xOwoJICAgICAgICB2YXIgeXN0ZXAgPSBmcm9tWSA8IHRvWSA/IDEgOiAtMTsKCSAgICAgICAgLy8gSW4gYmxhY2sgcGl4ZWxzLCBsb29raW5nIGZvciB3aGl0ZSwgZmlyc3Qgb3Igc2Vjb25kIHRpbWUuCgkgICAgICAgIHZhciBzdGF0ZSA9IDA7CgkgICAgICAgIC8vIExvb3AgdXAgdW50aWwgeCA9PSB0b1gsIGJ1dCBub3QgYmV5b25kCgkgICAgICAgIHZhciB4TGltaXQgPSB0b1ggKyB4c3RlcDsKCSAgICAgICAgZm9yICh2YXIgeCA9IGZyb21YLCB5ID0gZnJvbVk7IHggIT09IHhMaW1pdDsgeCArPSB4c3RlcCkgewoJICAgICAgICAgICAgdmFyIHJlYWxYID0gc3RlZXAgPyB5IDogeDsKCSAgICAgICAgICAgIHZhciByZWFsWSA9IHN0ZWVwID8geCA6IHk7CgkgICAgICAgICAgICAvLyBEb2VzIGN1cnJlbnQgcGl4ZWwgbWVhbiB3ZSBoYXZlIG1vdmVkIHdoaXRlIHRvIGJsYWNrIG9yIHZpY2UgdmVyc2E/CgkgICAgICAgICAgICAvLyBTY2FubmluZyBibGFjayBpbiBzdGF0ZSAwLDIgYW5kIHdoaXRlIGluIHN0YXRlIDEsIHNvIGlmIHdlIGZpbmQgdGhlIHdyb25nCgkgICAgICAgICAgICAvLyBjb2xvciwgYWR2YW5jZSB0byBuZXh0IHN0YXRlIG9yIGVuZCBpZiB3ZSBhcmUgaW4gc3RhdGUgMiBhbHJlYWR5CgkgICAgICAgICAgICBpZiAoKHN0YXRlID09PSAxKSA9PT0gdGhpcy5pbWFnZS5nZXQocmVhbFgsIHJlYWxZKSkgewoJICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gMikgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aFV0aWxzXzEuZGVmYXVsdC5kaXN0YW5jZSh4LCB5LCBmcm9tWCwgZnJvbVkpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBzdGF0ZSsrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZXJyb3IgKz0gZHk7CgkgICAgICAgICAgICBpZiAoZXJyb3IgPiAwKSB7CgkgICAgICAgICAgICAgICAgaWYgKHkgPT09IHRvWSkgewoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgeSArPSB5c3RlcDsKCSAgICAgICAgICAgICAgICBlcnJvciAtPSBkeDsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICAvLyBGb3VuZCBibGFjay13aGl0ZS1ibGFjazsgZ2l2ZSB0aGUgYmVuZWZpdCBvZiB0aGUgZG91YnQgdGhhdCB0aGUgbmV4dCBwaXhlbCBvdXRzaWRlIHRoZSBpbWFnZQoJICAgICAgICAvLyBpcyAid2hpdGUiIHNvIHRoaXMgbGFzdCBwb2ludCBhdCAodG9YK3hTdGVwLHRvWSkgaXMgdGhlIHJpZ2h0IGVuZGluZy4gVGhpcyBpcyByZWFsbHkgYQoJICAgICAgICAvLyBzbWFsbCBhcHByb3hpbWF0aW9uOyAodG9YK3hTdGVwLHRvWSt5U3RlcCkgbWlnaHQgYmUgcmVhbGx5IGNvcnJlY3QuIElnbm9yZSB0aGlzLgoJICAgICAgICBpZiAoc3RhdGUgPT09IDIpIHsKCSAgICAgICAgICAgIHJldHVybiBNYXRoVXRpbHNfMS5kZWZhdWx0LmRpc3RhbmNlKHRvWCArIHhzdGVwLCB0b1ksIGZyb21YLCBmcm9tWSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gZWxzZSB3ZSBkaWRuJ3QgZmluZCBldmVuIGJsYWNrLXdoaXRlLWJsYWNrOyBubyBlc3RpbWF0ZSBpcyByZWFsbHkgcG9zc2libGUKCSAgICAgICAgcmV0dXJuIE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkF0dGVtcHRzIHRvIGxvY2F0ZSBhbiBhbGlnbm1lbnQgcGF0dGVybiBpbiBhIGxpbWl0ZWQgcmVnaW9uIG9mIHRoZSBpbWFnZSwgd2hpY2ggaXMKCSAgICAgKiBndWVzc2VkIHRvIGNvbnRhaW4gaXQuIFRoaXMgbWV0aG9kIHVzZXMge0BsaW5rIEFsaWdubWVudFBhdHRlcm59LjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBvdmVyYWxsRXN0TW9kdWxlU2l6ZSBlc3RpbWF0ZWQgbW9kdWxlIHNpemUgc28gZmFyCgkgICAgICogQHBhcmFtIGVzdEFsaWdubWVudFggeCBjb29yZGluYXRlIG9mIGNlbnRlciBvZiBhcmVhIHByb2JhYmx5IGNvbnRhaW5pbmcgYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gZXN0QWxpZ25tZW50WSB5IGNvb3JkaW5hdGUgb2YgYWJvdmUKCSAgICAgKiBAcGFyYW0gYWxsb3dhbmNlRmFjdG9yIG51bWJlciBvZiBwaXhlbHMgaW4gYWxsIGRpcmVjdGlvbnMgdG8gc2VhcmNoIGZyb20gdGhlIGNlbnRlcgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEFsaWdubWVudFBhdHRlcm59IGlmIGZvdW5kLCBvciBudWxsIG90aGVyd2lzZQoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgYW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnMgZHVyaW5nIGRldGVjdGlvbgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5maW5kQWxpZ25tZW50SW5SZWdpb24gPSBmdW5jdGlvbiAob3ZlcmFsbEVzdE1vZHVsZVNpemUgLypmbG9hdCovLCBlc3RBbGlnbm1lbnRYIC8qaW50Ki8sIGVzdEFsaWdubWVudFkgLyppbnQqLywgYWxsb3dhbmNlRmFjdG9yIC8qZmxvYXQqLykgewoJICAgICAgICAvLyBMb29rIGZvciBhbiBhbGlnbm1lbnQgcGF0dGVybiAoMyBtb2R1bGVzIGluIHNpemUpIGFyb3VuZCB3aGVyZSBpdAoJICAgICAgICAvLyBzaG91bGQgYmUKCSAgICAgICAgdmFyIGFsbG93YW5jZSA9IC8qKGludCkgKi8gTWF0aC5mbG9vcihhbGxvd2FuY2VGYWN0b3IgKiBvdmVyYWxsRXN0TW9kdWxlU2l6ZSk7CgkgICAgICAgIHZhciBhbGlnbm1lbnRBcmVhTGVmdFggPSBNYXRoLm1heCgwLCBlc3RBbGlnbm1lbnRYIC0gYWxsb3dhbmNlKTsKCSAgICAgICAgdmFyIGFsaWdubWVudEFyZWFSaWdodFggPSBNYXRoLm1pbih0aGlzLmltYWdlLmdldFdpZHRoKCkgLSAxLCBlc3RBbGlnbm1lbnRYICsgYWxsb3dhbmNlKTsKCSAgICAgICAgaWYgKGFsaWdubWVudEFyZWFSaWdodFggLSBhbGlnbm1lbnRBcmVhTGVmdFggPCBvdmVyYWxsRXN0TW9kdWxlU2l6ZSAqIDMpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgnQWxpZ25tZW50IHRvcCBleGNlZWRzIGVzdGltYXRlZCBtb2R1bGUgc2l6ZS4nKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYWxpZ25tZW50QXJlYVRvcFkgPSBNYXRoLm1heCgwLCBlc3RBbGlnbm1lbnRZIC0gYWxsb3dhbmNlKTsKCSAgICAgICAgdmFyIGFsaWdubWVudEFyZWFCb3R0b21ZID0gTWF0aC5taW4odGhpcy5pbWFnZS5nZXRIZWlnaHQoKSAtIDEsIGVzdEFsaWdubWVudFkgKyBhbGxvd2FuY2UpOwoJICAgICAgICBpZiAoYWxpZ25tZW50QXJlYUJvdHRvbVkgLSBhbGlnbm1lbnRBcmVhVG9wWSA8IG92ZXJhbGxFc3RNb2R1bGVTaXplICogMykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkMS5kZWZhdWx0KCdBbGlnbm1lbnQgYm90dG9tIGV4Y2VlZHMgZXN0aW1hdGVkIG1vZHVsZSBzaXplLicpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBhbGlnbm1lbnRGaW5kZXIgPSBuZXcgQWxpZ25tZW50UGF0dGVybkZpbmRlcl8xLmRlZmF1bHQodGhpcy5pbWFnZSwgYWxpZ25tZW50QXJlYUxlZnRYLCBhbGlnbm1lbnRBcmVhVG9wWSwgYWxpZ25tZW50QXJlYVJpZ2h0WCAtIGFsaWdubWVudEFyZWFMZWZ0WCwgYWxpZ25tZW50QXJlYUJvdHRvbVkgLSBhbGlnbm1lbnRBcmVhVG9wWSwgb3ZlcmFsbEVzdE1vZHVsZVNpemUsIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayk7CgkgICAgICAgIHJldHVybiBhbGlnbm1lbnRGaW5kZXIuZmluZCgpOwoJICAgIH07CgkgICAgcmV0dXJuIERldGVjdG9yOwoJfSgpKTsKCURldGVjdG9yJDEuZGVmYXVsdCA9IERldGVjdG9yOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoUVJDb2RlUmVhZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcucXJjb2RlIHsqLwoJdmFyIEJhcmNvZGVGb3JtYXRfMSA9IEJhcmNvZGVGb3JtYXQkMTsKCXZhciBCaXRNYXRyaXhfMSA9IEJpdE1hdHJpeCQxOwoJdmFyIERlY29kZUhpbnRUeXBlXzEgPSBEZWNvZGVIaW50VHlwZSQxOwoJdmFyIE5vdEZvdW5kRXhjZXB0aW9uXzEgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJdmFyIFJlc3VsdF8xID0gUmVzdWx0JDE7Cgl2YXIgUmVzdWx0TWV0YWRhdGFUeXBlXzEgPSBSZXN1bHRNZXRhZGF0YVR5cGUkMTsKCS8vIGltcG9ydCBEZXRlY3RvclJlc3VsdCBmcm9tICcuLi9jb21tb24vRGV0ZWN0b3JSZXN1bHQnOwoJdmFyIERlY29kZXJfMSA9IERlY29kZXIkMTsKCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSA9IFFSQ29kZURlY29kZXJNZXRhRGF0YSQxOwoJdmFyIERldGVjdG9yXzEgPSBEZXRlY3RvciQxOwoJLyppbXBvcnQgamF2YS51dGlsLkxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5NYXA7Ki8KCS8qKgoJICogVGhpcyBpbXBsZW1lbnRhdGlvbiBjYW4gZGV0ZWN0IGFuZCBkZWNvZGUgUVIgQ29kZXMgaW4gYW4gaW1hZ2UuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFFSQ29kZVJlYWRlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBRUkNvZGVSZWFkZXIoKSB7CgkgICAgICAgIHRoaXMuZGVjb2RlciA9IG5ldyBEZWNvZGVyXzEuZGVmYXVsdCgpOwoJICAgIH0KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLmdldERlY29kZXIgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlY29kZXI7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBMb2NhdGVzIGFuZCBkZWNvZGVzIGEgUVIgY29kZSBpbiBhbiBpbWFnZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gYSByZXByZXNlbnRpbmc6IHN0cmluZyB0aGUgY29udGVudCBlbmNvZGVkIGJ5IHRoZSBRUiBjb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBhIFFSIGNvZGUgY2Fubm90IGJlIGZvdW5kCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgYSBRUiBjb2RlIGNhbm5vdCBiZSBkZWNvZGVkCgkgICAgICogQHRocm93cyBDaGVja3N1bUV4Y2VwdGlvbiBpZiBlcnJvciBjb3JyZWN0aW9uIGZhaWxzCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIC8vIHB1YmxpYyBkZWNvZGUoaW1hZ2U6IEJpbmFyeUJpdG1hcCk6IFJlc3VsdCAvKnRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiwgQ2hlY2tzdW1FeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiAqLyB7CgkgICAgLy8gICByZXR1cm4gdGhpcy5kZWNvZGUoaW1hZ2UsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLmRlY29kZSA9IGZ1bmN0aW9uIChpbWFnZSwgaGludHMpIHsKCSAgICAgICAgdmFyIGRlY29kZXJSZXN1bHQ7CgkgICAgICAgIHZhciBwb2ludHM7CgkgICAgICAgIGlmIChoaW50cyAhPT0gdW5kZWZpbmVkICYmIGhpbnRzICE9PSBudWxsICYmIHVuZGVmaW5lZCAhPT0gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEuZGVmYXVsdC5QVVJFX0JBUkNPREUpKSB7CgkgICAgICAgICAgICB2YXIgYml0cyA9IFFSQ29kZVJlYWRlci5leHRyYWN0UHVyZUJpdHMoaW1hZ2UuZ2V0QmxhY2tNYXRyaXgoKSk7CgkgICAgICAgICAgICBkZWNvZGVyUmVzdWx0ID0gdGhpcy5kZWNvZGVyLmRlY29kZUJpdE1hdHJpeChiaXRzLCBoaW50cyk7CgkgICAgICAgICAgICBwb2ludHMgPSBRUkNvZGVSZWFkZXIuTk9fUE9JTlRTOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdmFyIGRldGVjdG9yUmVzdWx0ID0gbmV3IERldGVjdG9yXzEuZGVmYXVsdChpbWFnZS5nZXRCbGFja01hdHJpeCgpKS5kZXRlY3QoaGludHMpOwoJICAgICAgICAgICAgZGVjb2RlclJlc3VsdCA9IHRoaXMuZGVjb2Rlci5kZWNvZGVCaXRNYXRyaXgoZGV0ZWN0b3JSZXN1bHQuZ2V0Qml0cygpLCBoaW50cyk7CgkgICAgICAgICAgICBwb2ludHMgPSBkZXRlY3RvclJlc3VsdC5nZXRQb2ludHMoKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBJZiB0aGUgY29kZSB3YXMgbWlycm9yZWQ6IHN3YXAgdGhlIGJvdHRvbS1sZWZ0IGFuZCB0aGUgdG9wLXJpZ2h0IHBvaW50cy4KCSAgICAgICAgaWYgKGRlY29kZXJSZXN1bHQuZ2V0T3RoZXIoKSBpbnN0YW5jZW9mIFFSQ29kZURlY29kZXJNZXRhRGF0YV8xLmRlZmF1bHQpIHsKCSAgICAgICAgICAgIGRlY29kZXJSZXN1bHQuZ2V0T3RoZXIoKS5hcHBseU1pcnJvcmVkQ29ycmVjdGlvbihwb2ludHMpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSBuZXcgUmVzdWx0XzEuZGVmYXVsdChkZWNvZGVyUmVzdWx0LmdldFRleHQoKSwgZGVjb2RlclJlc3VsdC5nZXRSYXdCeXRlcygpLCB1bmRlZmluZWQsIHBvaW50cywgQmFyY29kZUZvcm1hdF8xLmRlZmF1bHQuUVJfQ09ERSwgdW5kZWZpbmVkKTsKCSAgICAgICAgdmFyIGJ5dGVTZWdtZW50cyA9IGRlY29kZXJSZXN1bHQuZ2V0Qnl0ZVNlZ21lbnRzKCk7CgkgICAgICAgIGlmIChieXRlU2VnbWVudHMgIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJlc3VsdC5wdXRNZXRhZGF0YShSZXN1bHRNZXRhZGF0YVR5cGVfMS5kZWZhdWx0LkJZVEVfU0VHTUVOVFMsIGJ5dGVTZWdtZW50cyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGVjTGV2ZWwgPSBkZWNvZGVyUmVzdWx0LmdldEVDTGV2ZWwoKTsKCSAgICAgICAgaWYgKGVjTGV2ZWwgIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJlc3VsdC5wdXRNZXRhZGF0YShSZXN1bHRNZXRhZGF0YVR5cGVfMS5kZWZhdWx0LkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwsIGVjTGV2ZWwpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChkZWNvZGVyUmVzdWx0Lmhhc1N0cnVjdHVyZWRBcHBlbmQoKSkgewoJICAgICAgICAgICAgcmVzdWx0LnB1dE1ldGFkYXRhKFJlc3VsdE1ldGFkYXRhVHlwZV8xLmRlZmF1bHQuU1RSVUNUVVJFRF9BUFBFTkRfU0VRVUVOQ0UsIGRlY29kZXJSZXN1bHQuZ2V0U3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyKCkpOwoJICAgICAgICAgICAgcmVzdWx0LnB1dE1ldGFkYXRhKFJlc3VsdE1ldGFkYXRhVHlwZV8xLmRlZmF1bHQuU1RSVUNUVVJFRF9BUFBFTkRfUEFSSVRZLCBkZWNvZGVyUmVzdWx0LmdldFN0cnVjdHVyZWRBcHBlbmRQYXJpdHkoKSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBkbyBub3RoaW5nCgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBUaGlzIG1ldGhvZCBkZXRlY3RzIGEgY29kZSBpbiBhICJwdXJlIiBpbWFnZSAtLSB0aGF0IGlzLCBwdXJlIG1vbm9jaHJvbWUgaW1hZ2UKCSAgICAgKiB3aGljaCBjb250YWlucyBvbmx5IGFuIHVucm90YXRlZCwgdW5za2V3ZWQsIGltYWdlIG9mIGEgY29kZSwgd2l0aCBzb21lIHdoaXRlIGJvcmRlcgoJICAgICAqIGFyb3VuZCBpdC4gVGhpcyBpcyBhIHNwZWNpYWxpemVkIG1ldGhvZCB0aGF0IHdvcmtzIGV4Y2VwdGlvbmFsbHkgZmFzdCBpbiB0aGlzIHNwZWNpYWwKCSAgICAgKiBjYXNlLgoJICAgICAqCgkgICAgICogQHNlZSBjb20uZ29vZ2xlLnp4aW5nLmRhdGFtYXRyaXguRGF0YU1hdHJpeFJlYWRlciNleHRyYWN0UHVyZUJpdHMoQml0TWF0cml4KQoJICAgICAqLwoJICAgIFFSQ29kZVJlYWRlci5leHRyYWN0UHVyZUJpdHMgPSBmdW5jdGlvbiAoaW1hZ2UpIHsKCSAgICAgICAgdmFyIGxlZnRUb3BCbGFjayA9IGltYWdlLmdldFRvcExlZnRPbkJpdCgpOwoJICAgICAgICB2YXIgcmlnaHRCb3R0b21CbGFjayA9IGltYWdlLmdldEJvdHRvbVJpZ2h0T25CaXQoKTsKCSAgICAgICAgaWYgKGxlZnRUb3BCbGFjayA9PT0gbnVsbCB8fCByaWdodEJvdHRvbUJsYWNrID09PSBudWxsKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG1vZHVsZVNpemUgPSB0aGlzLm1vZHVsZVNpemUobGVmdFRvcEJsYWNrLCBpbWFnZSk7CgkgICAgICAgIHZhciB0b3AgPSBsZWZ0VG9wQmxhY2tbMV07CgkgICAgICAgIHZhciBib3R0b20gPSByaWdodEJvdHRvbUJsYWNrWzFdOwoJICAgICAgICB2YXIgbGVmdCA9IGxlZnRUb3BCbGFja1swXTsKCSAgICAgICAgdmFyIHJpZ2h0ID0gcmlnaHRCb3R0b21CbGFja1swXTsKCSAgICAgICAgLy8gU2FuaXR5IGNoZWNrIQoJICAgICAgICBpZiAobGVmdCA+PSByaWdodCB8fCB0b3AgPj0gYm90dG9tKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGJvdHRvbSAtIHRvcCAhPT0gcmlnaHQgLSBsZWZ0KSB7CgkgICAgICAgICAgICAvLyBTcGVjaWFsIGNhc2UsIHdoZXJlIGJvdHRvbS1yaWdodCBtb2R1bGUgd2Fzbid0IGJsYWNrIHNvIHdlIGZvdW5kIHNvbWV0aGluZyBlbHNlIGluIHRoZSBsYXN0IHJvdwoJICAgICAgICAgICAgLy8gQXNzdW1lIGl0J3MgYSBzcXVhcmUsIHNvIHVzZSBoZWlnaHQgYXMgdGhlIHdpZHRoCgkgICAgICAgICAgICByaWdodCA9IGxlZnQgKyAoYm90dG9tIC0gdG9wKTsKCSAgICAgICAgICAgIGlmIChyaWdodCA+PSBpbWFnZS5nZXRXaWR0aCgpKSB7CgkgICAgICAgICAgICAgICAgLy8gQWJvcnQgaWYgdGhhdCB3b3VsZCBub3QgbWFrZSBzZW5zZSAtLSBvZmYgaW1hZ2UKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG1hdHJpeFdpZHRoID0gTWF0aC5yb3VuZCgocmlnaHQgLSBsZWZ0ICsgMSkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIG1hdHJpeEhlaWdodCA9IE1hdGgucm91bmQoKGJvdHRvbSAtIHRvcCArIDEpIC8gbW9kdWxlU2l6ZSk7CgkgICAgICAgIGlmIChtYXRyaXhXaWR0aCA8PSAwIHx8IG1hdHJpeEhlaWdodCA8PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKG1hdHJpeEhlaWdodCAhPT0gbWF0cml4V2lkdGgpIHsKCSAgICAgICAgICAgIC8vIE9ubHkgcG9zc2libHkgZGVjb2RlIHNxdWFyZSByZWdpb25zCgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gUHVzaCBpbiB0aGUgImJvcmRlciIgYnkgaGFsZiB0aGUgbW9kdWxlIHdpZHRoIHNvIHRoYXQgd2Ugc3RhcnQKCSAgICAgICAgLy8gc2FtcGxpbmcgaW4gdGhlIG1pZGRsZSBvZiB0aGUgbW9kdWxlLiBKdXN0IGluIGNhc2UgdGhlIGltYWdlIGlzIGEKCSAgICAgICAgLy8gbGl0dGxlIG9mZiwgdGhpcyB3aWxsIGhlbHAgcmVjb3Zlci4KCSAgICAgICAgdmFyIG51ZGdlID0gLyooaW50KSAqLyBNYXRoLmZsb29yKG1vZHVsZVNpemUgLyAyLjApOwoJICAgICAgICB0b3AgKz0gbnVkZ2U7CgkgICAgICAgIGxlZnQgKz0gbnVkZ2U7CgkgICAgICAgIC8vIEJ1dCBjYXJlZnVsIHRoYXQgdGhpcyBkb2VzIG5vdCBzYW1wbGUgb2ZmIHRoZSBlZGdlCgkgICAgICAgIC8vICJyaWdodCIgaXMgdGhlIGZhcnRoZXN0LXJpZ2h0IHZhbGlkIHBpeGVsIGxvY2F0aW9uIC0tIHJpZ2h0KzEgaXMgbm90IG5lY2Vzc2FyaWx5CgkgICAgICAgIC8vIFRoaXMgaXMgcG9zaXRpdmUgYnkgaG93IG11Y2ggdGhlIGlubmVyIHggbG9vcCBiZWxvdyB3b3VsZCBiZSB0b28gbGFyZ2UKCSAgICAgICAgdmFyIG51ZGdlZFRvb0ZhclJpZ2h0ID0gbGVmdCArIC8qKGludCkgKi8gTWF0aC5mbG9vcigobWF0cml4V2lkdGggLSAxKSAqIG1vZHVsZVNpemUpIC0gcmlnaHQ7CgkgICAgICAgIGlmIChudWRnZWRUb29GYXJSaWdodCA+IDApIHsKCSAgICAgICAgICAgIGlmIChudWRnZWRUb29GYXJSaWdodCA+IG51ZGdlKSB7CgkgICAgICAgICAgICAgICAgLy8gTmVpdGhlciB3YXkgZml0czsgYWJvcnQKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBsZWZ0IC09IG51ZGdlZFRvb0ZhclJpZ2h0OwoJICAgICAgICB9CgkgICAgICAgIC8vIFNlZSBsb2dpYyBhYm92ZQoJICAgICAgICB2YXIgbnVkZ2VkVG9vRmFyRG93biA9IHRvcCArIC8qKGludCkgKi8gTWF0aC5mbG9vcigobWF0cml4SGVpZ2h0IC0gMSkgKiBtb2R1bGVTaXplKSAtIGJvdHRvbTsKCSAgICAgICAgaWYgKG51ZGdlZFRvb0ZhckRvd24gPiAwKSB7CgkgICAgICAgICAgICBpZiAobnVkZ2VkVG9vRmFyRG93biA+IG51ZGdlKSB7CgkgICAgICAgICAgICAgICAgLy8gTmVpdGhlciB3YXkgZml0czsgYWJvcnQKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0b3AgLT0gbnVkZ2VkVG9vRmFyRG93bjsKCSAgICAgICAgfQoJICAgICAgICAvLyBOb3cganVzdCByZWFkIG9mZiB0aGUgYml0cwoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRNYXRyaXhfMS5kZWZhdWx0KG1hdHJpeFdpZHRoLCBtYXRyaXhIZWlnaHQpOwoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IG1hdHJpeEhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgaU9mZnNldCA9IHRvcCArIC8qKGludCkgKi8gTWF0aC5mbG9vcih5ICogbW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1hdHJpeFdpZHRoOyB4KyspIHsKCSAgICAgICAgICAgICAgICBpZiAoaW1hZ2UuZ2V0KGxlZnQgKyAvKihpbnQpICovIE1hdGguZmxvb3IoeCAqIG1vZHVsZVNpemUpLCBpT2Zmc2V0KSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLnNldCh4LCB5KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICBRUkNvZGVSZWFkZXIubW9kdWxlU2l6ZSA9IGZ1bmN0aW9uIChsZWZ0VG9wQmxhY2ssIGltYWdlKSB7CgkgICAgICAgIHZhciBoZWlnaHQgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHdpZHRoID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIHggPSBsZWZ0VG9wQmxhY2tbMF07CgkgICAgICAgIHZhciB5ID0gbGVmdFRvcEJsYWNrWzFdOwoJICAgICAgICB2YXIgaW5CbGFjayA9IHRydWU7CgkgICAgICAgIHZhciB0cmFuc2l0aW9ucyA9IDA7CgkgICAgICAgIHdoaWxlICh4IDwgd2lkdGggJiYgeSA8IGhlaWdodCkgewoJICAgICAgICAgICAgaWYgKGluQmxhY2sgIT09IGltYWdlLmdldCh4LCB5KSkgewoJICAgICAgICAgICAgICAgIGlmICgrK3RyYW5zaXRpb25zID09PSA1KSB7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBpbkJsYWNrID0gIWluQmxhY2s7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB4Kys7CgkgICAgICAgICAgICB5Kys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHggPT09IHdpZHRoIHx8IHkgPT09IGhlaWdodCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiAoeCAtIGxlZnRUb3BCbGFja1swXSkgLyA3LjA7CgkgICAgfTsKCSAgICBRUkNvZGVSZWFkZXIuTk9fUE9JTlRTID0gbmV3IEFycmF5KCk7CgkgICAgcmV0dXJuIFFSQ29kZVJlYWRlcjsKCX0oKSk7Cgl2YXIgX2RlZmF1bHQgPSBRUkNvZGVSZWFkZXIkMS5kZWZhdWx0ID0gUVJDb2RlUmVhZGVyOwoKCXZhciB0b0dyYXlzY2FsZUJ1ZmZlciA9IGZ1bmN0aW9uIHRvR3JheXNjYWxlQnVmZmVyKGltYWdlQnVmZmVyLCB3aWR0aCwgaGVpZ2h0KSB7CgkgIHZhciBncmF5c2NhbGVCdWZmZXIgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkod2lkdGggKiBoZWlnaHQpOwoKCSAgZm9yICh2YXIgaSA9IDAsIGogPSAwLCBsZW5ndGhfMSA9IGltYWdlQnVmZmVyLmxlbmd0aDsgaSA8IGxlbmd0aF8xOyBpICs9IDQsIGorKykgewoJICAgIHZhciBncmF5ID0gdm9pZCAwOwoJICAgIHZhciBhbHBoYSA9IGltYWdlQnVmZmVyW2kgKyAzXTsgLy8gVGhlIGNvbG9yIG9mIGZ1bGx5LXRyYW5zcGFyZW50IHBpeGVscyBpcyBpcnJlbGV2YW50LiBUaGV5IGFyZSBvZnRlbiwgdGVjaG5pY2FsbHksIGZ1bGx5LXRyYW5zcGFyZW50CgkgICAgLy8gYmxhY2sgKDAgYWxwaGEsIGFuZCB0aGVuIDAgUkdCKS4gVGhleSBhcmUgb2Z0ZW4gdXNlZCwgb2YgY291cnNlIGFzIHRoZSAid2hpdGUiIGFyZWEgaW4gYQoJICAgIC8vIGJhcmNvZGUgaW1hZ2UuIEZvcmNlIGFueSBzdWNoIHBpeGVsIHRvIGJlIHdoaXRlOgoKCSAgICBpZiAoYWxwaGEgPT09IDApIHsKCSAgICAgIGdyYXkgPSAweEZGOwoJICAgIH0gZWxzZSB7CgkgICAgICB2YXIgcGl4ZWxSID0gaW1hZ2VCdWZmZXJbaV07CgkgICAgICB2YXIgcGl4ZWxHID0gaW1hZ2VCdWZmZXJbaSArIDFdOwoJICAgICAgdmFyIHBpeGVsQiA9IGltYWdlQnVmZmVyW2kgKyAyXTsgLy8gLjI5OVIgKyAwLjU4N0cgKyAwLjExNEIgKFlVVi9ZSVEgZm9yIFBBTCBhbmQgTlRTQyksCgkgICAgICAvLyAoMzA2KlIpID4+IDEwIGlzIGFwcHJveGltYXRlbHkgZXF1YWwgdG8gUiowLjI5OSwgYW5kIHNvIG9uLgoJICAgICAgLy8gMHgyMDAgPj4gMTAgaXMgMC41LCBpdCBpbXBsZW1lbnRzIHJvdW5kaW5nLgoKCSAgICAgIGdyYXkgPSAzMDYgKiBwaXhlbFIgKyA2MDEgKiBwaXhlbEcgKyAxMTcgKiBwaXhlbEIgKyAweDIwMCA+PiAxMDsKCSAgICB9CgoJICAgIGdyYXlzY2FsZUJ1ZmZlcltqXSA9IGdyYXk7CgkgIH0KCgkgIHJldHVybiBncmF5c2NhbGVCdWZmZXI7Cgl9OwoKCXZhciByZWFkZXIgPSBuZXcgX2RlZmF1bHQoKTsKCXNlbGYuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChlKSB7CgkgIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzCgkgIHRyeSB7CgkgICAgdmFyIGx1bWluYW5jZXMgPSB0b0dyYXlzY2FsZUJ1ZmZlcihlLmRhdGEuZGF0YSwgZS5kYXRhLndpZHRoLCBlLmRhdGEuaGVpZ2h0KTsKCSAgICB2YXIgbHVtaW5hbmNlU291cmNlID0gbmV3IF9kZWZhdWx0JDEobHVtaW5hbmNlcywgZS5kYXRhLndpZHRoLCBlLmRhdGEuaGVpZ2h0KTsKCSAgICB2YXIgaHlicmlkQmluYXJpemVyID0gbmV3IF9kZWZhdWx0JDIobHVtaW5hbmNlU291cmNlKTsKCSAgICB2YXIgYmluYXJ5Qml0bWFwID0gbmV3IF9kZWZhdWx0JDMoaHlicmlkQmluYXJpemVyKTsKCSAgICB2YXIgZGVjb2RlZCA9IHJlYWRlci5kZWNvZGUoYmluYXJ5Qml0bWFwKTsKCSAgICBwb3N0TWVzc2FnZShkZWNvZGVkKTsKCSAgfSBjYXRjaCAoZXJyKSB7CgkgICAgcG9zdE1lc3NhZ2UobnVsbCk7CgkgIH0KCX0pOwoKfSkoKTsKCg==",null,!1),P=["constraints","onError","onLoad","onScan","resolution","qrArea"];function O(g,e){var t=Object.keys(g);if(Object.getOwnPropertySymbols){var I=Object.getOwnPropertySymbols(g);e&&(I=I.filter((function(e){return Object.getOwnPropertyDescriptor(g,e).enumerable}))),t.push.apply(t,I)}return t}function _(g){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?O(Object(t),!0).forEach((function(e){l(g,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(t)):O(Object(t)).forEach((function(e){Object.defineProperty(g,e,Object.getOwnPropertyDescriptor(t,e))}))}return g}var q=function(){return new T},$=function(g){g&&(g.getVideoTracks&&g.getAudioTracks?(g.getVideoTracks().forEach((function(e){g.removeTrack(e),e.stop()})),g.getAudioTracks().forEach((function(e){g.removeTrack(e),e.stop()}))):g.stop())},gg=function(g){var e=g.constraints,l=g.onError,C=g.onLoad,n=g.onScan,o=g.resolution,a=g.qrArea,i=d(g,P),c=t.useRef(null),A=t.useRef(null),r=t.useRef(document.createElement("canvas")),u=t.useRef(null),m=t.useRef(),b=s(t.useState(null),2),h=b[0],Z=b[1],G=t.useRef(!1),p=t.useRef();t.useEffect((function(){p.current=q();var g=p.current;return g.onmessage=function(g){n&&n(g.data?_(_({},g.data),{},{canvas:r.current}):null),G.current=!1},function(){g.terminate()}}),[n]);var y=JSON.stringify(a),B=t.useCallback((function(){var g=JSON.parse(y),e=p.current,t=A.current&&A.current.readyState===A.current.HAVE_ENOUGH_DATA;if(!G.current&&t){G.current=!0;var I,l=A.current.videoWidth,C=A.current.videoHeight,n=l>C?l:C,a=Math.floor(o/n*100)/100;C=Math.floor(a*C),l=Math.floor(a*l),r.current.width=l,r.current.height=C,u.current=r.current.getContext("2d"),u.current.drawImage(A.current,0,0,l,C),I=g&&2===g.length&&g[0]>0&&g[1]>0?u.current.getImageData(Math.floor((l-g[0])/2),Math.floor((C-g[1])/2),g[0],g[1]):u.current.getImageData(0,0,l,C),e.postMessage(I)}m.current=requestAnimationFrame(B)}),[o,y]),S=JSON.stringify(e);return t.useEffect((function(){var g=JSON.parse(S),e=!0;return navigator.mediaDevices.getUserMedia(g).then((function(g){if(e){c.current=g;try{A.current&&(A.current.srcObject=g,A.current.setAttribute("playsinline",!0))}catch(t){Z(window.URL.createObjectURL(g))}C&&C(),m.current=requestAnimationFrame(B)}else $(g)})).catch((function(g){return e?l(g):null})),function(){cancelAnimationFrame(m.current),e=!1,$(c.current),h&&window.URL.revokeObjectURL(h)}}),[B,S,l,C,h]),t.createElement("video",I({autoPlay:!0,playsInline:!0,src:h,ref:A},i))};return gg.propTypes={constraints:U.object,onError:U.func.isRequired,onLoad:U.func,onScan:U.func.isRequired,resolution:U.number,qrArea:U.array},gg.defaultProps={constraints:{audio:!1,video:!0},resolution:640,qrArea:[]},gg}(t(43))},141:function(g,e,t){var I,l;"undefined"!=typeof self&&self,g.exports=(I=t(43),l=t(950),function(){"use strict";var g={328:function(g,e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.PrintContextConsumer=e.PrintContext=void 0;var I=t(496),l=Object.prototype.hasOwnProperty.call(I,"createContext");e.PrintContext=l?I.createContext({}):null,e.PrintContextConsumer=e.PrintContext?e.PrintContext.Consumer:function(){return null}},428:function(g,e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.ReactToPrint=void 0;var I=t(316),l=t(496),C=t(190),n=t(328),o=t(940),a=function(g){function e(){var e=g.apply(this,I.__spreadArray([],I.__read(arguments),!1))||this;return e.startPrint=function(g){var t=e.props,I=t.onAfterPrint,l=t.onPrintError,C=t.print,n=t.documentTitle;setTimeout((function(){var t,o;if(g.contentWindow)if(g.contentWindow.focus(),C)C(g).then((function(){return null==I?void 0:I()})).then((function(){return e.handleRemoveIframe()})).catch((function(g){l?l("print",g):e.logMessages(["An error was thrown by the specified `print` function"])}));else{if(g.contentWindow.print){var a=null!==(o=null===(t=g.contentDocument)||void 0===t?void 0:t.title)&&void 0!==o?o:"",i=g.ownerDocument.title;n&&(g.ownerDocument.title=n,g.contentDocument&&(g.contentDocument.title=n)),g.contentWindow.print(),n&&(g.ownerDocument.title=i,g.contentDocument&&(g.contentDocument.title=a))}else e.logMessages(["Printing for this browser is not currently possible: the browser does not have a `print` method available for iframes."]);null==I||I(),e.handleRemoveIframe()}else e.logMessages(["Printing failed because the `contentWindow` of the print iframe did not load. This is possibly an error with `react-to-print`. Please file an issue: https://github.com/gregnb/react-to-print/issues/"])}),500)},e.triggerPrint=function(g){var t=e.props,I=t.onBeforePrint,l=t.onPrintError;if(I){var C=I();C&&"function"==typeof C.then?C.then((function(){e.startPrint(g)})).catch((function(g){l&&l("onBeforePrint",g)})):e.startPrint(g)}else e.startPrint(g)},e.handlePrint=function(g){var t=e.props,l=t.bodyClass,n=t.content,o=t.copyStyles,a=t.fonts,i=t.pageStyle,s=t.nonce,c="function"==typeof g?g():null;if(c&&"function"==typeof n&&e.logMessages(['"react-to-print" received a `content` prop and a content param passed the callback return by `useReactToPrint. The `content` prop will be ignored.'],"warning"),c||"function"!=typeof n||(c=n()),void 0!==c)if(null!==c){var d=document.createElement("iframe");d.width="".concat(document.documentElement.clientWidth,"px"),d.height="".concat(document.documentElement.clientHeight,"px"),d.style.position="absolute",d.style.top="-".concat(document.documentElement.clientHeight+100,"px"),d.style.left="-".concat(document.documentElement.clientWidth+100,"px"),d.id="printWindow",d.srcdoc="<!DOCTYPE html>";var A=(0,C.findDOMNode)(c);if(A){var r=A.cloneNode(!0),u=r instanceof Text,m=document.querySelectorAll("link[rel~='stylesheet'], link[as='style']"),b=u?[]:r.querySelectorAll("img"),h=u?[]:r.querySelectorAll("video"),Z=a?a.length:0;e.numResourcesToLoad=m.length+b.length+h.length+Z,e.resourcesLoaded=[],e.resourcesErrored=[];var G=function(g,t){e.resourcesLoaded.includes(g)?e.logMessages(["Tried to mark a resource that has already been handled",g],"debug"):(t?(e.logMessages(I.__spreadArray(['"react-to-print" was unable to load a resource but will continue attempting to print the page'],I.__read(t),!1)),e.resourcesErrored.push(g)):e.resourcesLoaded.push(g),e.resourcesLoaded.length+e.resourcesErrored.length===e.numResourcesToLoad&&e.triggerPrint(d))};d.onload=function(){var g,t,C,n;d.onload=null;var c=d.contentDocument||(null===(t=d.contentWindow)||void 0===t?void 0:t.document);if(c){c.body.appendChild(r),a&&((null===(C=d.contentDocument)||void 0===C?void 0:C.fonts)&&(null===(n=d.contentWindow)||void 0===n?void 0:n.FontFace)?a.forEach((function(g){var e=new FontFace(g.family,g.source,{weight:g.weight,style:g.style});d.contentDocument.fonts.add(e),e.loaded.then((function(){G(e)})).catch((function(g){G(e,["Failed loading the font:",e,"Load error:",g])}))})):(a.forEach((function(g){return G(g)})),e.logMessages(['"react-to-print" is not able to load custom fonts because the browser does not support the FontFace API but will continue attempting to print the page'])));var m="function"==typeof i?i():i;if("string"!=typeof m)e.logMessages(['"react-to-print" expected a "string" from `pageStyle` but received "'.concat(typeof m,'". Styles from `pageStyle` will not be applied.')]);else{var Z=c.createElement("style");s&&(Z.setAttribute("nonce",s),c.head.setAttribute("nonce",s)),Z.appendChild(c.createTextNode(m)),c.head.appendChild(Z)}if(l&&(g=c.body.classList).add.apply(g,I.__spreadArray([],I.__read(l.split(" ")),!1)),!u){for(var p=u?[]:A.querySelectorAll("canvas"),y=c.querySelectorAll("canvas"),B=0;B<p.length;++B){var S=p[B],W=y[B].getContext("2d");W&&W.drawImage(S,0,0)}var V=function(g){var e=b[g],t=e.getAttribute("src");if(t){var I=new Image;I.onload=function(){return G(e)},I.onerror=function(g,t,I,l,C){return G(e,["Error loading <img>",e,"Error",C])},I.src=t}else G(e,['Found an <img> tag with an empty "src" attribute. This prevents pre-loading it. The <img> is:',e])};for(B=0;B<b.length;B++)V(B);var R=function(g){var e=h[g];e.preload="auto";var t=e.getAttribute("poster");if(t){var I=new Image;I.onload=function(){return G(e)},I.onerror=function(g,I,l,C,n){return G(e,["Error loading video poster",t,"for video",e,"Error:",n])},I.src=t}else e.readyState>=2?G(e):(e.onloadeddata=function(){return G(e)},e.onerror=function(g,t,I,l,C){return G(e,["Error loading video",e,"Error",C])},e.onstalled=function(){return G(e,["Loading video stalled, skipping",e])})};for(B=0;B<h.length;B++)R(B);var X="input",J=A.querySelectorAll(X),k=c.querySelectorAll(X);for(B=0;B<J.length;B++)k[B].value=J[B].value;var f="input[type=checkbox],input[type=radio]",v=A.querySelectorAll(f),Y=c.querySelectorAll(f);for(B=0;B<v.length;B++)Y[B].checked=v[B].checked;var x="select",H=A.querySelectorAll(x),N=c.querySelectorAll(x);for(B=0;B<H.length;B++)N[B].value=H[B].value}if(o)for(var w=document.querySelectorAll("style, link[rel~='stylesheet'], link[as='style']"),F=function(g,t){var I=w[g];if("style"===I.tagName.toLowerCase()){var l=c.createElement(I.tagName),C=I.sheet;if(C){var n="";try{for(var o=C.cssRules.length,a=0;a<o;++a)"string"==typeof C.cssRules[a].cssText&&(n+="".concat(C.cssRules[a].cssText,"\r\n"))}catch(g){e.logMessages(["A stylesheet could not be accessed. This is likely due to the stylesheet having cross-origin imports, and many browsers block script access to cross-origin stylesheets. See https://github.com/gregnb/react-to-print/issues/429 for details. You may be able to load the sheet by both marking the stylesheet with the cross `crossorigin` attribute, and setting the `Access-Control-Allow-Origin` header on the server serving the stylesheet. Alternatively, host the stylesheet on your domain to avoid this issue entirely.",I],"warning")}l.setAttribute("id","react-to-print-".concat(g)),s&&l.setAttribute("nonce",s),l.appendChild(c.createTextNode(n)),c.head.appendChild(l)}}else if(I.getAttribute("href"))if(I.hasAttribute("disabled"))e.logMessages(["`react-to-print` encountered a <link> tag with a `disabled` attribute and will ignore it. Note that the `disabled` attribute is deprecated, and some browsers ignore it. You should stop using it. https://developer.mozilla.org/en-US/docs/Web/HTML/Element/link#attr-disabled. The <link> is:",I],"warning"),G(I);else{for(var i=c.createElement(I.tagName),d=(a=0,I.attributes.length);a<d;++a){var A=I.attributes[a];A&&i.setAttribute(A.nodeName,A.nodeValue||"")}i.onload=function(){return G(i)},i.onerror=function(g,e,t,I,l){return G(i,["Failed to load",i,"Error:",l])},s&&i.setAttribute("nonce",s),c.head.appendChild(i)}else e.logMessages(["`react-to-print` encountered a <link> tag with an empty `href` attribute. In addition to being invalid HTML, this can cause problems in many browsers, and so the <link> was not loaded. The <link> is:",I],"warning"),G(I)},K=(B=0,w.length);B<K;++B)F(B)}0!==e.numResourcesToLoad&&o||e.triggerPrint(d)},e.handleRemoveIframe(!0),document.body.appendChild(d)}else e.logMessages(['"react-to-print" could not locate the DOM node corresponding with the `content` prop'])}else e.logMessages(['There is nothing to print because the "content" prop returned "null". Please ensure "content" is renderable before allowing "react-to-print" to be called.']);else e.logMessages(["To print a functional component ensure it is wrapped with `React.forwardRef`, and ensure the forwarded ref is used. See the README for an example: https://github.com/gregnb/react-to-print#examples"])},e.handleRemoveIframe=function(g){var t=e.props.removeAfterPrint;if(g||t){var I=document.getElementById("printWindow");I&&document.body.removeChild(I)}},e.logMessages=function(g,t){void 0===t&&(t="error"),e.props.suppressErrors||("error"===t?console.error(g):"warning"===t?console.warn(g):"debug"===t&&console.debug(g))},e}return I.__extends(e,g),e.prototype.handleClick=function(g,e){var t=this,I=this.props,l=I.onBeforeGetContent,C=I.onPrintError;if(l){var n=l();n&&"function"==typeof n.then?n.then((function(){return t.handlePrint(e)})).catch((function(g){C&&C("onBeforeGetContent",g)})):this.handlePrint(e)}else this.handlePrint(e)},e.prototype.render=function(){var g=this.props,e=g.children,t=g.trigger;if(t)return l.cloneElement(t(),{onClick:this.handleClick.bind(this)});if(!n.PrintContext)return this.logMessages(['"react-to-print" requires React ^16.3.0 to be able to use "PrintContext"']),null;var I={handlePrint:this.handleClick.bind(this)};return l.createElement(n.PrintContext.Provider,{value:I},e)},e.defaultProps=o.defaultProps,e}(l.Component);e.ReactToPrint=a},940:function(g,e){Object.defineProperty(e,"__esModule",{value:!0}),e.defaultProps=void 0,e.defaultProps={copyStyles:!0,pageStyle:"\n        @page {\n            /* Remove browser default header (title) and footer (url) */\n            margin: 0;\n        }\n        @media print {\n            body {\n                /* Tell browsers to print background colors */\n                -webkit-print-color-adjust: exact; /* Chrome/Safari/Edge/Opera */\n                color-adjust: exact; /* Firefox */\n            }\n        }\n    ",removeAfterPrint:!1,suppressErrors:!1}},892:function(g,e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.useReactToPrint=void 0;var I=t(316),l=t(496),C=t(428),n=t(940),o=t(860),a=Object.prototype.hasOwnProperty.call(l,"useMemo")&&Object.prototype.hasOwnProperty.call(l,"useCallback");e.useReactToPrint=function(g){if(!a)return g.suppressErrors||console.error('"react-to-print" requires React ^16.8.0 to be able to use "useReactToPrint"'),function(){throw new Error('"react-to-print" requires React ^16.8.0 to be able to use "useReactToPrint"')};var e=l.useMemo((function(){return new C.ReactToPrint(I.__assign(I.__assign({},n.defaultProps),g))}),[g]);return l.useCallback((function(g,t){return(0,o.wrapCallbackWithArgs)(e,e.handleClick,t)(g)}),[e])}},860:function(g,e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.wrapCallbackWithArgs=void 0;var I=t(316);e.wrapCallbackWithArgs=function(g,e){for(var t=[],l=2;l<arguments.length;l++)t[l-2]=arguments[l];return function(){for(var l=[],C=0;C<arguments.length;C++)l[C]=arguments[C];return e.apply(g,I.__spreadArray(I.__spreadArray([],I.__read(l),!1),I.__read(t),!1))}}},496:function(g){g.exports=I},190:function(g){g.exports=l},316:function(g,e,t){t.r(e),t.d(e,{__addDisposableResource:function(){return x},__assign:function(){return C},__asyncDelegator:function(){return W},__asyncGenerator:function(){return S},__asyncValues:function(){return V},__await:function(){return B},__awaiter:function(){return r},__classPrivateFieldGet:function(){return f},__classPrivateFieldIn:function(){return Y},__classPrivateFieldSet:function(){return v},__createBinding:function(){return m},__decorate:function(){return o},__disposeResources:function(){return N},__esDecorate:function(){return i},__exportStar:function(){return b},__extends:function(){return l},__generator:function(){return u},__importDefault:function(){return k},__importStar:function(){return J},__makeTemplateObject:function(){return R},__metadata:function(){return A},__param:function(){return a},__propKey:function(){return c},__read:function(){return Z},__rest:function(){return n},__runInitializers:function(){return s},__setFunctionName:function(){return d},__spread:function(){return G},__spreadArray:function(){return y},__spreadArrays:function(){return p},__values:function(){return h}});var I=function(g,e){return I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,e){g.__proto__=e}||function(g,e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(g[t]=e[t])},I(g,e)};function l(g,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=g}I(g,e),g.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}var C=function(){return C=Object.assign||function(g){for(var e,t=1,I=arguments.length;t<I;t++)for(var l in e=arguments[t])Object.prototype.hasOwnProperty.call(e,l)&&(g[l]=e[l]);return g},C.apply(this,arguments)};function n(g,e){var t={};for(var I in g)Object.prototype.hasOwnProperty.call(g,I)&&e.indexOf(I)<0&&(t[I]=g[I]);if(null!=g&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(I=Object.getOwnPropertySymbols(g);l<I.length;l++)e.indexOf(I[l])<0&&Object.prototype.propertyIsEnumerable.call(g,I[l])&&(t[I[l]]=g[I[l]])}return t}function o(g,e,t,I){var l,C=arguments.length,n=C<3?e:null===I?I=Object.getOwnPropertyDescriptor(e,t):I;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(g,e,t,I);else for(var o=g.length-1;o>=0;o--)(l=g[o])&&(n=(C<3?l(n):C>3?l(e,t,n):l(e,t))||n);return C>3&&n&&Object.defineProperty(e,t,n),n}function a(g,e){return function(t,I){e(t,I,g)}}function i(g,e,t,I,l,C){function n(g){if(void 0!==g&&"function"!=typeof g)throw new TypeError("Function expected");return g}for(var o,a=I.kind,i="getter"===a?"get":"setter"===a?"set":"value",s=!e&&g?I.static?g:g.prototype:null,c=e||(s?Object.getOwnPropertyDescriptor(s,I.name):{}),d=!1,A=t.length-1;A>=0;A--){var r={};for(var u in I)r[u]="access"===u?{}:I[u];for(var u in I.access)r.access[u]=I.access[u];r.addInitializer=function(g){if(d)throw new TypeError("Cannot add initializers after decoration has completed");C.push(n(g||null))};var m=(0,t[A])("accessor"===a?{get:c.get,set:c.set}:c[i],r);if("accessor"===a){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(o=n(m.get))&&(c.get=o),(o=n(m.set))&&(c.set=o),(o=n(m.init))&&l.unshift(o)}else(o=n(m))&&("field"===a?l.unshift(o):c[i]=o)}s&&Object.defineProperty(s,I.name,c),d=!0}function s(g,e,t){for(var I=arguments.length>2,l=0;l<e.length;l++)t=I?e[l].call(g,t):e[l].call(g);return I?t:void 0}function c(g){return"symbol"==typeof g?g:"".concat(g)}function d(g,e,t){return"symbol"==typeof e&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(g,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function A(g,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(g,e)}function r(g,e,t,I){return new(t||(t=Promise))((function(l,C){function n(g){try{a(I.next(g))}catch(g){C(g)}}function o(g){try{a(I.throw(g))}catch(g){C(g)}}function a(g){var e;g.done?l(g.value):(e=g.value,e instanceof t?e:new t((function(g){g(e)}))).then(n,o)}a((I=I.apply(g,e||[])).next())}))}function u(g,e){var t,I,l,C,n={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return C={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(C[Symbol.iterator]=function(){return this}),C;function o(o){return function(a){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;C&&(C=0,o[0]&&(n=0)),n;)try{if(t=1,I&&(l=2&o[0]?I.return:o[0]?I.throw||((l=I.return)&&l.call(I),0):I.next)&&!(l=l.call(I,o[1])).done)return l;switch(I=0,l&&(o=[2&o[0],l.value]),o[0]){case 0:case 1:l=o;break;case 4:return n.label++,{value:o[1],done:!1};case 5:n.label++,I=o[1],o=[0];continue;case 7:o=n.ops.pop(),n.trys.pop();continue;default:if(!((l=(l=n.trys).length>0&&l[l.length-1])||6!==o[0]&&2!==o[0])){n=0;continue}if(3===o[0]&&(!l||o[1]>l[0]&&o[1]<l[3])){n.label=o[1];break}if(6===o[0]&&n.label<l[1]){n.label=l[1],l=o;break}if(l&&n.label<l[2]){n.label=l[2],n.ops.push(o);break}l[2]&&n.ops.pop(),n.trys.pop();continue}o=e.call(g,n)}catch(g){o=[6,g],I=0}finally{t=l=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var m=Object.create?function(g,e,t,I){void 0===I&&(I=t);var l=Object.getOwnPropertyDescriptor(e,t);l&&!("get"in l?!e.__esModule:l.writable||l.configurable)||(l={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(g,I,l)}:function(g,e,t,I){void 0===I&&(I=t),g[I]=e[t]};function b(g,e){for(var t in g)"default"===t||Object.prototype.hasOwnProperty.call(e,t)||m(e,g,t)}function h(g){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&g[e],I=0;if(t)return t.call(g);if(g&&"number"==typeof g.length)return{next:function(){return g&&I>=g.length&&(g=void 0),{value:g&&g[I++],done:!g}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Z(g,e){var t="function"==typeof Symbol&&g[Symbol.iterator];if(!t)return g;var I,l,C=t.call(g),n=[];try{for(;(void 0===e||e-- >0)&&!(I=C.next()).done;)n.push(I.value)}catch(g){l={error:g}}finally{try{I&&!I.done&&(t=C.return)&&t.call(C)}finally{if(l)throw l.error}}return n}function G(){for(var g=[],e=0;e<arguments.length;e++)g=g.concat(Z(arguments[e]));return g}function p(){for(var g=0,e=0,t=arguments.length;e<t;e++)g+=arguments[e].length;var I=Array(g),l=0;for(e=0;e<t;e++)for(var C=arguments[e],n=0,o=C.length;n<o;n++,l++)I[l]=C[n];return I}function y(g,e,t){if(t||2===arguments.length)for(var I,l=0,C=e.length;l<C;l++)!I&&l in e||(I||(I=Array.prototype.slice.call(e,0,l)),I[l]=e[l]);return g.concat(I||Array.prototype.slice.call(e))}function B(g){return this instanceof B?(this.v=g,this):new B(g)}function S(g,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var I,l=t.apply(g,e||[]),C=[];return I={},n("next"),n("throw"),n("return"),I[Symbol.asyncIterator]=function(){return this},I;function n(g){l[g]&&(I[g]=function(e){return new Promise((function(t,I){C.push([g,e,t,I])>1||o(g,e)}))})}function o(g,e){try{(t=l[g](e)).value instanceof B?Promise.resolve(t.value.v).then(a,i):s(C[0][2],t)}catch(g){s(C[0][3],g)}var t}function a(g){o("next",g)}function i(g){o("throw",g)}function s(g,e){g(e),C.shift(),C.length&&o(C[0][0],C[0][1])}}function W(g){var e,t;return e={},I("next"),I("throw",(function(g){throw g})),I("return"),e[Symbol.iterator]=function(){return this},e;function I(I,l){e[I]=g[I]?function(e){return(t=!t)?{value:B(g[I](e)),done:!1}:l?l(e):e}:l}}function V(g){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=g[Symbol.asyncIterator];return t?t.call(g):(g=h(g),e={},I("next"),I("throw"),I("return"),e[Symbol.asyncIterator]=function(){return this},e);function I(t){e[t]=g[t]&&function(e){return new Promise((function(I,l){!function(g,e,t,I){Promise.resolve(I).then((function(e){g({value:e,done:t})}),e)}(I,l,(e=g[t](e)).done,e.value)}))}}}function R(g,e){return Object.defineProperty?Object.defineProperty(g,"raw",{value:e}):g.raw=e,g}var X=Object.create?function(g,e){Object.defineProperty(g,"default",{enumerable:!0,value:e})}:function(g,e){g.default=e};function J(g){if(g&&g.__esModule)return g;var e={};if(null!=g)for(var t in g)"default"!==t&&Object.prototype.hasOwnProperty.call(g,t)&&m(e,g,t);return X(e,g),e}function k(g){return g&&g.__esModule?g:{default:g}}function f(g,e,t,I){if("a"===t&&!I)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?g!==e||!I:!e.has(g))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===t?I:"a"===t?I.call(g):I?I.value:e.get(g)}function v(g,e,t,I,l){if("m"===I)throw new TypeError("Private method is not writable");if("a"===I&&!l)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?g!==e||!l:!e.has(g))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===I?l.call(g,t):l?l.value=t:e.set(g,t),t}function Y(g,e){if(null===e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof g?e===g:g.has(e)}function x(g,e,t){if(null!=e){if("object"!=typeof e&&"function"!=typeof e)throw new TypeError("Object expected.");var I;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");I=e[Symbol.asyncDispose]}if(void 0===I){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");I=e[Symbol.dispose]}if("function"!=typeof I)throw new TypeError("Object not disposable.");g.stack.push({value:e,dispose:I,async:t})}else t&&g.stack.push({async:!0});return e}var H="function"==typeof SuppressedError?SuppressedError:function(g,e,t){var I=new Error(t);return I.name="SuppressedError",I.error=g,I.suppressed=e,I};function N(g){function e(e){g.error=g.hasError?new H(e,g.error,"An error was suppressed during disposal."):e,g.hasError=!0}return function t(){for(;g.stack.length;){var I=g.stack.pop();try{var l=I.dispose&&I.dispose.call(I.value);if(I.async)return Promise.resolve(l).then(t,(function(g){return e(g),t()}))}catch(g){e(g)}}if(g.hasError)throw g.error}()}e.default={__extends:l,__assign:C,__rest:n,__decorate:o,__param:a,__metadata:A,__awaiter:r,__generator:u,__createBinding:m,__exportStar:b,__values:h,__read:Z,__spread:G,__spreadArrays:p,__spreadArray:y,__await:B,__asyncGenerator:S,__asyncDelegator:W,__asyncValues:V,__makeTemplateObject:R,__importStar:J,__importDefault:k,__classPrivateFieldGet:f,__classPrivateFieldSet:v,__classPrivateFieldIn:Y,__addDisposableResource:x,__disposeResources:N}}},e={};function t(I){var l=e[I];if(void 0!==l)return l.exports;var C=e[I]={exports:{}};return g[I](C,C.exports,t),C.exports}t.d=function(g,e){for(var I in e)t.o(e,I)&&!t.o(g,I)&&Object.defineProperty(g,I,{enumerable:!0,get:e[I]})},t.o=function(g,e){return Object.prototype.hasOwnProperty.call(g,e)},t.r=function(g){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})};var C={};return function(){var g=C;Object.defineProperty(g,"__esModule",{value:!0}),g.useReactToPrint=g.ReactToPrint=g.PrintContextConsumer=void 0;var e=t(328);Object.defineProperty(g,"PrintContextConsumer",{enumerable:!0,get:function(){return e.PrintContextConsumer}});var I=t(428);Object.defineProperty(g,"ReactToPrint",{enumerable:!0,get:function(){return I.ReactToPrint}});var l=t(892);Object.defineProperty(g,"useReactToPrint",{enumerable:!0,get:function(){return l.useReactToPrint}});var n=t(428);g.default=n.ReactToPrint}(),C}())},153:(g,e,t)=>{"use strict";var I=t(43),l=Symbol.for("react.element"),C=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,o=I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function i(g,e,t){var I,C={},i=null,s=null;for(I in void 0!==t&&(i=""+t),void 0!==e.key&&(i=""+e.key),void 0!==e.ref&&(s=e.ref),e)n.call(e,I)&&!a.hasOwnProperty(I)&&(C[I]=e[I]);if(g&&g.defaultProps)for(I in e=g.defaultProps)void 0===C[I]&&(C[I]=e[I]);return{$$typeof:l,type:g,key:i,ref:s,props:C,_owner:o.current}}e.Fragment=C,e.jsx=i,e.jsxs=i},202:(g,e)=>{"use strict";var t=Symbol.for("react.element"),I=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),a=Symbol.for("react.context"),i=Symbol.for("react.forward_ref"),s=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),A=Symbol.iterator;var r={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},u=Object.assign,m={};function b(g,e,t){this.props=g,this.context=e,this.refs=m,this.updater=t||r}function h(){}function Z(g,e,t){this.props=g,this.context=e,this.refs=m,this.updater=t||r}b.prototype.isReactComponent={},b.prototype.setState=function(g,e){if("object"!==typeof g&&"function"!==typeof g&&null!=g)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,g,e,"setState")},b.prototype.forceUpdate=function(g){this.updater.enqueueForceUpdate(this,g,"forceUpdate")},h.prototype=b.prototype;var G=Z.prototype=new h;G.constructor=Z,u(G,b.prototype),G.isPureReactComponent=!0;var p=Array.isArray,y=Object.prototype.hasOwnProperty,B={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function W(g,e,I){var l,C={},n=null,o=null;if(null!=e)for(l in void 0!==e.ref&&(o=e.ref),void 0!==e.key&&(n=""+e.key),e)y.call(e,l)&&!S.hasOwnProperty(l)&&(C[l]=e[l]);var a=arguments.length-2;if(1===a)C.children=I;else if(1<a){for(var i=Array(a),s=0;s<a;s++)i[s]=arguments[s+2];C.children=i}if(g&&g.defaultProps)for(l in a=g.defaultProps)void 0===C[l]&&(C[l]=a[l]);return{$$typeof:t,type:g,key:n,ref:o,props:C,_owner:B.current}}function V(g){return"object"===typeof g&&null!==g&&g.$$typeof===t}var R=/\/+/g;function X(g,e){return"object"===typeof g&&null!==g&&null!=g.key?function(g){var e={"=":"=0",":":"=2"};return"$"+g.replace(/[=:]/g,(function(g){return e[g]}))}(""+g.key):e.toString(36)}function J(g,e,l,C,n){var o=typeof g;"undefined"!==o&&"boolean"!==o||(g=null);var a=!1;if(null===g)a=!0;else switch(o){case"string":case"number":a=!0;break;case"object":switch(g.$$typeof){case t:case I:a=!0}}if(a)return n=n(a=g),g=""===C?"."+X(a,0):C,p(n)?(l="",null!=g&&(l=g.replace(R,"$&/")+"/"),J(n,e,l,"",(function(g){return g}))):null!=n&&(V(n)&&(n=function(g,e){return{$$typeof:t,type:g.type,key:e,ref:g.ref,props:g.props,_owner:g._owner}}(n,l+(!n.key||a&&a.key===n.key?"":(""+n.key).replace(R,"$&/")+"/")+g)),e.push(n)),1;if(a=0,C=""===C?".":C+":",p(g))for(var i=0;i<g.length;i++){var s=C+X(o=g[i],i);a+=J(o,e,l,s,n)}else if(s=function(g){return null===g||"object"!==typeof g?null:"function"===typeof(g=A&&g[A]||g["@@iterator"])?g:null}(g),"function"===typeof s)for(g=s.call(g),i=0;!(o=g.next()).done;)a+=J(o=o.value,e,l,s=C+X(o,i++),n);else if("object"===o)throw e=String(g),Error("Objects are not valid as a React child (found: "+("[object Object]"===e?"object with keys {"+Object.keys(g).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function k(g,e,t){if(null==g)return g;var I=[],l=0;return J(g,I,"","",(function(g){return e.call(t,g,l++)})),I}function f(g){if(-1===g._status){var e=g._result;(e=e()).then((function(e){0!==g._status&&-1!==g._status||(g._status=1,g._result=e)}),(function(e){0!==g._status&&-1!==g._status||(g._status=2,g._result=e)})),-1===g._status&&(g._status=0,g._result=e)}if(1===g._status)return g._result.default;throw g._result}var v={current:null},Y={transition:null},x={ReactCurrentDispatcher:v,ReactCurrentBatchConfig:Y,ReactCurrentOwner:B};e.Children={map:k,forEach:function(g,e,t){k(g,(function(){e.apply(this,arguments)}),t)},count:function(g){var e=0;return k(g,(function(){e++})),e},toArray:function(g){return k(g,(function(g){return g}))||[]},only:function(g){if(!V(g))throw Error("React.Children.only expected to receive a single React element child.");return g}},e.Component=b,e.Fragment=l,e.Profiler=n,e.PureComponent=Z,e.StrictMode=C,e.Suspense=s,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=x,e.cloneElement=function(g,e,I){if(null===g||void 0===g)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+g+".");var l=u({},g.props),C=g.key,n=g.ref,o=g._owner;if(null!=e){if(void 0!==e.ref&&(n=e.ref,o=B.current),void 0!==e.key&&(C=""+e.key),g.type&&g.type.defaultProps)var a=g.type.defaultProps;for(i in e)y.call(e,i)&&!S.hasOwnProperty(i)&&(l[i]=void 0===e[i]&&void 0!==a?a[i]:e[i])}var i=arguments.length-2;if(1===i)l.children=I;else if(1<i){a=Array(i);for(var s=0;s<i;s++)a[s]=arguments[s+2];l.children=a}return{$$typeof:t,type:g.type,key:C,ref:n,props:l,_owner:o}},e.createContext=function(g){return(g={$$typeof:a,_currentValue:g,_currentValue2:g,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:g},g.Consumer=g},e.createElement=W,e.createFactory=function(g){var e=W.bind(null,g);return e.type=g,e},e.createRef=function(){return{current:null}},e.forwardRef=function(g){return{$$typeof:i,render:g}},e.isValidElement=V,e.lazy=function(g){return{$$typeof:d,_payload:{_status:-1,_result:g},_init:f}},e.memo=function(g,e){return{$$typeof:c,type:g,compare:void 0===e?null:e}},e.startTransition=function(g){var e=Y.transition;Y.transition={};try{g()}finally{Y.transition=e}},e.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},e.useCallback=function(g,e){return v.current.useCallback(g,e)},e.useContext=function(g){return v.current.useContext(g)},e.useDebugValue=function(){},e.useDeferredValue=function(g){return v.current.useDeferredValue(g)},e.useEffect=function(g,e){return v.current.useEffect(g,e)},e.useId=function(){return v.current.useId()},e.useImperativeHandle=function(g,e,t){return v.current.useImperativeHandle(g,e,t)},e.useInsertionEffect=function(g,e){return v.current.useInsertionEffect(g,e)},e.useLayoutEffect=function(g,e){return v.current.useLayoutEffect(g,e)},e.useMemo=function(g,e){return v.current.useMemo(g,e)},e.useReducer=function(g,e,t){return v.current.useReducer(g,e,t)},e.useRef=function(g){return v.current.useRef(g)},e.useState=function(g){return v.current.useState(g)},e.useSyncExternalStore=function(g,e,t){return v.current.useSyncExternalStore(g,e,t)},e.useTransition=function(){return v.current.useTransition()},e.version="18.2.0"},43:(g,e,t)=>{"use strict";g.exports=t(202)},579:(g,e,t)=>{"use strict";g.exports=t(153)},234:(g,e)=>{"use strict";function t(g,e){var t=g.length;g.push(e);g:for(;0<t;){var I=t-1>>>1,l=g[I];if(!(0<C(l,e)))break g;g[I]=e,g[t]=l,t=I}}function I(g){return 0===g.length?null:g[0]}function l(g){if(0===g.length)return null;var e=g[0],t=g.pop();if(t!==e){g[0]=t;g:for(var I=0,l=g.length,n=l>>>1;I<n;){var o=2*(I+1)-1,a=g[o],i=o+1,s=g[i];if(0>C(a,t))i<l&&0>C(s,a)?(g[I]=s,g[i]=t,I=i):(g[I]=a,g[o]=t,I=o);else{if(!(i<l&&0>C(s,t)))break g;g[I]=s,g[i]=t,I=i}}}return e}function C(g,e){var t=g.sortIndex-e.sortIndex;return 0!==t?t:g.id-e.id}if("object"===typeof performance&&"function"===typeof performance.now){var n=performance;e.unstable_now=function(){return n.now()}}else{var o=Date,a=o.now();e.unstable_now=function(){return o.now()-a}}var i=[],s=[],c=1,d=null,A=3,r=!1,u=!1,m=!1,b="function"===typeof setTimeout?setTimeout:null,h="function"===typeof clearTimeout?clearTimeout:null,Z="undefined"!==typeof setImmediate?setImmediate:null;function G(g){for(var e=I(s);null!==e;){if(null===e.callback)l(s);else{if(!(e.startTime<=g))break;l(s),e.sortIndex=e.expirationTime,t(i,e)}e=I(s)}}function p(g){if(m=!1,G(g),!u)if(null!==I(i))u=!0,Y(y);else{var e=I(s);null!==e&&x(p,e.startTime-g)}}function y(g,t){u=!1,m&&(m=!1,h(V),V=-1),r=!0;var C=A;try{for(G(t),d=I(i);null!==d&&(!(d.expirationTime>t)||g&&!J());){var n=d.callback;if("function"===typeof n){d.callback=null,A=d.priorityLevel;var o=n(d.expirationTime<=t);t=e.unstable_now(),"function"===typeof o?d.callback=o:d===I(i)&&l(i),G(t)}else l(i);d=I(i)}if(null!==d)var a=!0;else{var c=I(s);null!==c&&x(p,c.startTime-t),a=!1}return a}finally{d=null,A=C,r=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var B,S=!1,W=null,V=-1,R=5,X=-1;function J(){return!(e.unstable_now()-X<R)}function k(){if(null!==W){var g=e.unstable_now();X=g;var t=!0;try{t=W(!0,g)}finally{t?B():(S=!1,W=null)}}else S=!1}if("function"===typeof Z)B=function(){Z(k)};else if("undefined"!==typeof MessageChannel){var f=new MessageChannel,v=f.port2;f.port1.onmessage=k,B=function(){v.postMessage(null)}}else B=function(){b(k,0)};function Y(g){W=g,S||(S=!0,B())}function x(g,t){V=b((function(){g(e.unstable_now())}),t)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(g){g.callback=null},e.unstable_continueExecution=function(){u||r||(u=!0,Y(y))},e.unstable_forceFrameRate=function(g){0>g||125<g?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<g?Math.floor(1e3/g):5},e.unstable_getCurrentPriorityLevel=function(){return A},e.unstable_getFirstCallbackNode=function(){return I(i)},e.unstable_next=function(g){switch(A){case 1:case 2:case 3:var e=3;break;default:e=A}var t=A;A=e;try{return g()}finally{A=t}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(g,e){switch(g){case 1:case 2:case 3:case 4:case 5:break;default:g=3}var t=A;A=g;try{return e()}finally{A=t}},e.unstable_scheduleCallback=function(g,l,C){var n=e.unstable_now();switch("object"===typeof C&&null!==C?C="number"===typeof(C=C.delay)&&0<C?n+C:n:C=n,g){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return g={id:c++,callback:l,priorityLevel:g,startTime:C,expirationTime:o=C+o,sortIndex:-1},C>n?(g.sortIndex=C,t(s,g),null===I(i)&&g===I(s)&&(m?(h(V),V=-1):m=!0,x(p,C-n))):(g.sortIndex=o,t(i,g),u||r||(u=!0,Y(y))),g},e.unstable_shouldYield=J,e.unstable_wrapCallback=function(g){var e=A;return function(){var t=A;A=e;try{return g.apply(this,arguments)}finally{A=t}}}},853:(g,e,t)=>{"use strict";g.exports=t(234)}},e={};function t(I){var l=e[I];if(void 0!==l)return l.exports;var C=e[I]={exports:{}};return g[I].call(C.exports,C,C.exports,t),C.exports}t.n=g=>{var e=g&&g.__esModule?()=>g.default:()=>g;return t.d(e,{a:e}),e},(()=>{var g,e=Object.getPrototypeOf?g=>Object.getPrototypeOf(g):g=>g.__proto__;t.t=function(I,l){if(1&l&&(I=this(I)),8&l)return I;if("object"===typeof I&&I){if(4&l&&I.__esModule)return I;if(16&l&&"function"===typeof I.then)return I}var C=Object.create(null);t.r(C);var n={};g=g||[null,e({}),e([]),e(e)];for(var o=2&l&&I;"object"==typeof o&&!~g.indexOf(o);o=e(o))Object.getOwnPropertyNames(o).forEach((g=>n[g]=()=>I[g]));return n.default=()=>I,t.d(C,n),C}})(),t.d=(g,e)=>{for(var I in e)t.o(e,I)&&!t.o(g,I)&&Object.defineProperty(g,I,{enumerable:!0,get:e[I]})},t.o=(g,e)=>Object.prototype.hasOwnProperty.call(g,e),t.r=g=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},(()=>{"use strict";var g={};t.r(g),t.d(g,{hasBrowserEnv:()=>_i,hasStandardBrowserEnv:()=>qi,hasStandardBrowserWebWorkerEnv:()=>gs});var e,I=t(43),l=t.t(I,2),C=t(391);function n(){return n=Object.assign?Object.assign.bind():function(g){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var I in t)Object.prototype.hasOwnProperty.call(t,I)&&(g[I]=t[I])}return g},n.apply(this,arguments)}!function(g){g.Pop="POP",g.Push="PUSH",g.Replace="REPLACE"}(e||(e={}));const o="popstate";function a(g,e){if(!1===g||null===g||"undefined"===typeof g)throw new Error(e)}function i(g,e){if(!g){"undefined"!==typeof console&&console.warn(e);try{throw new Error(e)}catch(t){}}}function s(g,e){return{usr:g.state,key:g.key,idx:e}}function c(g,e,t,I){return void 0===t&&(t=null),n({pathname:"string"===typeof g?g:g.pathname,search:"",hash:""},"string"===typeof e?A(e):e,{state:t,key:e&&e.key||I||Math.random().toString(36).substr(2,8)})}function d(g){let{pathname:e="/",search:t="",hash:I=""}=g;return t&&"?"!==t&&(e+="?"===t.charAt(0)?t:"?"+t),I&&"#"!==I&&(e+="#"===I.charAt(0)?I:"#"+I),e}function A(g){let e={};if(g){let t=g.indexOf("#");t>=0&&(e.hash=g.substr(t),g=g.substr(0,t));let I=g.indexOf("?");I>=0&&(e.search=g.substr(I),g=g.substr(0,I)),g&&(e.pathname=g)}return e}function r(g,t,I,l){void 0===l&&(l={});let{window:C=document.defaultView,v5Compat:i=!1}=l,A=C.history,r=e.Pop,u=null,m=b();function b(){return(A.state||{idx:null}).idx}function h(){r=e.Pop;let g=b(),t=null==g?null:g-m;m=g,u&&u({action:r,location:G.location,delta:t})}function Z(g){let e="null"!==C.location.origin?C.location.origin:C.location.href,t="string"===typeof g?g:d(g);return t=t.replace(/ $/,"%20"),a(e,"No window.location.(origin|href) available to create URL for href: "+t),new URL(t,e)}null==m&&(m=0,A.replaceState(n({},A.state,{idx:m}),""));let G={get action(){return r},get location(){return g(C,A)},listen(g){if(u)throw new Error("A history only accepts one active listener");return C.addEventListener(o,h),u=g,()=>{C.removeEventListener(o,h),u=null}},createHref:g=>t(C,g),createURL:Z,encodeLocation(g){let e=Z(g);return{pathname:e.pathname,search:e.search,hash:e.hash}},push:function(g,t){r=e.Push;let l=c(G.location,g,t);I&&I(l,g),m=b()+1;let n=s(l,m),o=G.createHref(l);try{A.pushState(n,"",o)}catch(a){if(a instanceof DOMException&&"DataCloneError"===a.name)throw a;C.location.assign(o)}i&&u&&u({action:r,location:G.location,delta:1})},replace:function(g,t){r=e.Replace;let l=c(G.location,g,t);I&&I(l,g),m=b();let C=s(l,m),n=G.createHref(l);A.replaceState(C,"",n),i&&u&&u({action:r,location:G.location,delta:0})},go:g=>A.go(g)};return G}var u;!function(g){g.data="data",g.deferred="deferred",g.redirect="redirect",g.error="error"}(u||(u={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function m(g,e,t){void 0===t&&(t="/");let I=k(("string"===typeof e?A(e):e).pathname||"/",t);if(null==I)return null;let l=b(g);!function(g){g.sort(((g,e)=>g.score!==e.score?e.score-g.score:function(g,e){let t=g.length===e.length&&g.slice(0,-1).every(((g,t)=>g===e[t]));return t?g[g.length-1]-e[e.length-1]:0}(g.routesMeta.map((g=>g.childrenIndex)),e.routesMeta.map((g=>g.childrenIndex)))))}(l);let C=null;for(let n=0;null==C&&n<l.length;++n){let g=J(I);C=R(l[n],g)}return C}function b(g,e,t,I){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===I&&(I="");let l=(g,l,C)=>{let n={relativePath:void 0===C?g.path||"":C,caseSensitive:!0===g.caseSensitive,childrenIndex:l,route:g};n.relativePath.startsWith("/")&&(a(n.relativePath.startsWith(I),'Absolute route path "'+n.relativePath+'" nested under path "'+I+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),n.relativePath=n.relativePath.slice(I.length));let o=H([I,n.relativePath]),i=t.concat(n);g.children&&g.children.length>0&&(a(!0!==g.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),b(g.children,e,i,o)),(null!=g.path||g.index)&&e.push({path:o,score:V(o,g.index),routesMeta:i})};return g.forEach(((g,e)=>{var t;if(""!==g.path&&null!=(t=g.path)&&t.includes("?"))for(let I of h(g.path))l(g,e,I);else l(g,e)})),e}function h(g){let e=g.split("/");if(0===e.length)return[];let[t,...I]=e,l=t.endsWith("?"),C=t.replace(/\?$/,"");if(0===I.length)return l?[C,""]:[C];let n=h(I.join("/")),o=[];return o.push(...n.map((g=>""===g?C:[C,g].join("/")))),l&&o.push(...n),o.map((e=>g.startsWith("/")&&""===e?"/":e))}const Z=/^:[\w-]+$/,G=3,p=2,y=1,B=10,S=-2,W=g=>"*"===g;function V(g,e){let t=g.split("/"),I=t.length;return t.some(W)&&(I+=S),e&&(I+=p),t.filter((g=>!W(g))).reduce(((g,e)=>g+(Z.test(e)?G:""===e?y:B)),I)}function R(g,e){let{routesMeta:t}=g,I={},l="/",C=[];for(let n=0;n<t.length;++n){let g=t[n],o=n===t.length-1,a="/"===l?e:e.slice(l.length)||"/",i=X({path:g.relativePath,caseSensitive:g.caseSensitive,end:o},a);if(!i)return null;Object.assign(I,i.params);let s=g.route;C.push({params:I,pathname:H([l,i.pathname]),pathnameBase:N(H([l,i.pathnameBase])),route:s}),"/"!==i.pathnameBase&&(l=H([l,i.pathnameBase]))}return C}function X(g,e){"string"===typeof g&&(g={path:g,caseSensitive:!1,end:!0});let[t,I]=function(g,e,t){void 0===e&&(e=!1);void 0===t&&(t=!0);i("*"===g||!g.endsWith("*")||g.endsWith("/*"),'Route path "'+g+'" will be treated as if it were "'+g.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+g.replace(/\*$/,"/*")+'".');let I=[],l="^"+g.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((g,e,t)=>(I.push({paramName:e,isOptional:null!=t}),t?"/?([^\\/]+)?":"/([^\\/]+)")));g.endsWith("*")?(I.push({paramName:"*"}),l+="*"===g||"/*"===g?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?l+="\\/*$":""!==g&&"/"!==g&&(l+="(?:(?=\\/|$))");let C=new RegExp(l,e?void 0:"i");return[C,I]}(g.path,g.caseSensitive,g.end),l=e.match(t);if(!l)return null;let C=l[0],n=C.replace(/(.)\/+$/,"$1"),o=l.slice(1),a=I.reduce(((g,e,t)=>{let{paramName:I,isOptional:l}=e;if("*"===I){let g=o[t]||"";n=C.slice(0,C.length-g.length).replace(/(.)\/+$/,"$1")}const a=o[t];return g[I]=l&&!a?void 0:(a||"").replace(/%2F/g,"/"),g}),{});return{params:a,pathname:C,pathnameBase:n,pattern:g}}function J(g){try{return g.split("/").map((g=>decodeURIComponent(g).replace(/\//g,"%2F"))).join("/")}catch(e){return i(!1,'The URL path "'+g+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+e+")."),g}}function k(g,e){if("/"===e)return g;if(!g.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,I=g.charAt(t);return I&&"/"!==I?null:g.slice(t)||"/"}function f(g,e,t,I){return"Cannot include a '"+g+"' character in a manually specified `to."+e+"` field ["+JSON.stringify(I)+"].  Please separate it out to the `to."+t+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function v(g){return g.filter(((g,e)=>0===e||g.route.path&&g.route.path.length>0))}function Y(g,e){let t=v(g);return e?t.map(((e,t)=>t===g.length-1?e.pathname:e.pathnameBase)):t.map((g=>g.pathnameBase))}function x(g,e,t,I){let l;void 0===I&&(I=!1),"string"===typeof g?l=A(g):(l=n({},g),a(!l.pathname||!l.pathname.includes("?"),f("?","pathname","search",l)),a(!l.pathname||!l.pathname.includes("#"),f("#","pathname","hash",l)),a(!l.search||!l.search.includes("#"),f("#","search","hash",l)));let C,o=""===g||""===l.pathname,i=o?"/":l.pathname;if(null==i)C=t;else{let g=e.length-1;if(!I&&i.startsWith("..")){let e=i.split("/");for(;".."===e[0];)e.shift(),g-=1;l.pathname=e.join("/")}C=g>=0?e[g]:"/"}let s=function(g,e){void 0===e&&(e="/");let{pathname:t,search:I="",hash:l=""}="string"===typeof g?A(g):g,C=t?t.startsWith("/")?t:function(g,e){let t=e.replace(/\/+$/,"").split("/");return g.split("/").forEach((g=>{".."===g?t.length>1&&t.pop():"."!==g&&t.push(g)})),t.length>1?t.join("/"):"/"}(t,e):e;return{pathname:C,search:w(I),hash:F(l)}}(l,C),c=i&&"/"!==i&&i.endsWith("/"),d=(o||"."===i)&&t.endsWith("/");return s.pathname.endsWith("/")||!c&&!d||(s.pathname+="/"),s}const H=g=>g.join("/").replace(/\/\/+/g,"/"),N=g=>g.replace(/\/+$/,"").replace(/^\/*/,"/"),w=g=>g&&"?"!==g?g.startsWith("?")?g:"?"+g:"",F=g=>g&&"#"!==g?g.startsWith("#")?g:"#"+g:"";Error;function K(g){return null!=g&&"number"===typeof g.status&&"string"===typeof g.statusText&&"boolean"===typeof g.internal&&"data"in g}const z=["post","put","patch","delete"],M=(new Set(z),["get",...z]);new Set(M),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function E(){return E=Object.assign?Object.assign.bind():function(g){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var I in t)Object.prototype.hasOwnProperty.call(t,I)&&(g[I]=t[I])}return g},E.apply(this,arguments)}const Q=I.createContext(null);const U=I.createContext(null);const L=I.createContext(null);const j=I.createContext(null);const D=I.createContext({outlet:null,matches:[],isDataRoute:!1});const T=I.createContext(null);function P(){return null!=I.useContext(j)}function O(){return P()||a(!1),I.useContext(j).location}function _(g){I.useContext(L).static||I.useLayoutEffect(g)}function q(){let{isDataRoute:g}=I.useContext(D);return g?function(){let{router:g}=ag(ng.UseNavigateStable),e=sg(og.UseNavigateStable),t=I.useRef(!1);_((()=>{t.current=!0}));let l=I.useCallback((function(I,l){void 0===l&&(l={}),t.current&&("number"===typeof I?g.navigate(I):g.navigate(I,E({fromRouteId:e},l)))}),[g,e]);return l}():function(){P()||a(!1);let g=I.useContext(Q),{basename:e,future:t,navigator:l}=I.useContext(L),{matches:C}=I.useContext(D),{pathname:n}=O(),o=JSON.stringify(Y(C,t.v7_relativeSplatPath)),i=I.useRef(!1);_((()=>{i.current=!0}));let s=I.useCallback((function(t,I){if(void 0===I&&(I={}),!i.current)return;if("number"===typeof t)return void l.go(t);let C=x(t,JSON.parse(o),n,"path"===I.relative);null==g&&"/"!==e&&(C.pathname="/"===C.pathname?e:H([e,C.pathname])),(I.replace?l.replace:l.push)(C,I.state,I)}),[e,l,o,n,g]);return s}()}function $(){let{matches:g}=I.useContext(D),e=g[g.length-1];return e?e.params:{}}function gg(g,t,l,C){P()||a(!1);let{navigator:n}=I.useContext(L),{matches:o}=I.useContext(D),i=o[o.length-1],s=i?i.params:{},c=(i&&i.pathname,i?i.pathnameBase:"/");i&&i.route;let d,r=O();if(t){var u;let g="string"===typeof t?A(t):t;"/"===c||(null==(u=g.pathname)?void 0:u.startsWith(c))||a(!1),d=g}else d=r;let b=d.pathname||"/",h=b;if("/"!==c){let g=c.replace(/^\//,"").split("/");h="/"+b.replace(/^\//,"").split("/").slice(g.length).join("/")}let Z=m(g,{pathname:h});let G=Cg(Z&&Z.map((g=>Object.assign({},g,{params:Object.assign({},s,g.params),pathname:H([c,n.encodeLocation?n.encodeLocation(g.pathname).pathname:g.pathname]),pathnameBase:"/"===g.pathnameBase?c:H([c,n.encodeLocation?n.encodeLocation(g.pathnameBase).pathname:g.pathnameBase])}))),o,l,C);return t&&G?I.createElement(j.Provider,{value:{location:E({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:e.Pop}},G):G}function eg(){let g=function(){var g;let e=I.useContext(T),t=ig(og.UseRouteError),l=sg(og.UseRouteError);if(void 0!==e)return e;return null==(g=t.errors)?void 0:g[l]}(),e=K(g)?g.status+" "+g.statusText:g instanceof Error?g.message:JSON.stringify(g),t=g instanceof Error?g.stack:null,l="rgba(200,200,200, 0.5)",C={padding:"0.5rem",backgroundColor:l};return I.createElement(I.Fragment,null,I.createElement("h2",null,"Unexpected Application Error!"),I.createElement("h3",{style:{fontStyle:"italic"}},e),t?I.createElement("pre",{style:C},t):null,null)}const tg=I.createElement(eg,null);class Ig extends I.Component{constructor(g){super(g),this.state={location:g.location,revalidation:g.revalidation,error:g.error}}static getDerivedStateFromError(g){return{error:g}}static getDerivedStateFromProps(g,e){return e.location!==g.location||"idle"!==e.revalidation&&"idle"===g.revalidation?{error:g.error,location:g.location,revalidation:g.revalidation}:{error:void 0!==g.error?g.error:e.error,location:e.location,revalidation:g.revalidation||e.revalidation}}componentDidCatch(g,e){console.error("React Router caught the following error during render",g,e)}render(){return void 0!==this.state.error?I.createElement(D.Provider,{value:this.props.routeContext},I.createElement(T.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function lg(g){let{routeContext:e,match:t,children:l}=g,C=I.useContext(Q);return C&&C.static&&C.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(C.staticContext._deepestRenderedBoundaryId=t.route.id),I.createElement(D.Provider,{value:e},l)}function Cg(g,e,t,l){var C;if(void 0===e&&(e=[]),void 0===t&&(t=null),void 0===l&&(l=null),null==g){var n;if(null==(n=t)||!n.errors)return null;g=t.matches}let o=g,i=null==(C=t)?void 0:C.errors;if(null!=i){let g=o.findIndex((g=>g.route.id&&(null==i?void 0:i[g.route.id])));g>=0||a(!1),o=o.slice(0,Math.min(o.length,g+1))}let s=!1,c=-1;if(t&&l&&l.v7_partialHydration)for(let I=0;I<o.length;I++){let g=o[I];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(c=I),g.route.id){let{loaderData:e,errors:I}=t,l=g.route.loader&&void 0===e[g.route.id]&&(!I||void 0===I[g.route.id]);if(g.route.lazy||l){s=!0,o=c>=0?o.slice(0,c+1):[o[0]];break}}}return o.reduceRight(((g,l,C)=>{let n,a=!1,d=null,A=null;var r;t&&(n=i&&l.route.id?i[l.route.id]:void 0,d=l.route.errorElement||tg,s&&(c<0&&0===C?(r="route-fallback",!1||cg[r]||(cg[r]=!0),a=!0,A=null):c===C&&(a=!0,A=l.route.hydrateFallbackElement||null)));let u=e.concat(o.slice(0,C+1)),m=()=>{let e;return e=n?d:a?A:l.route.Component?I.createElement(l.route.Component,null):l.route.element?l.route.element:g,I.createElement(lg,{match:l,routeContext:{outlet:g,matches:u,isDataRoute:null!=t},children:e})};return t&&(l.route.ErrorBoundary||l.route.errorElement||0===C)?I.createElement(Ig,{location:t.location,revalidation:t.revalidation,component:d,error:n,children:m(),routeContext:{outlet:null,matches:u,isDataRoute:!0}}):m()}),null)}var ng=function(g){return g.UseBlocker="useBlocker",g.UseRevalidator="useRevalidator",g.UseNavigateStable="useNavigate",g}(ng||{}),og=function(g){return g.UseBlocker="useBlocker",g.UseLoaderData="useLoaderData",g.UseActionData="useActionData",g.UseRouteError="useRouteError",g.UseNavigation="useNavigation",g.UseRouteLoaderData="useRouteLoaderData",g.UseMatches="useMatches",g.UseRevalidator="useRevalidator",g.UseNavigateStable="useNavigate",g.UseRouteId="useRouteId",g}(og||{});function ag(g){let e=I.useContext(Q);return e||a(!1),e}function ig(g){let e=I.useContext(U);return e||a(!1),e}function sg(g){let e=function(g){let e=I.useContext(D);return e||a(!1),e}(),t=e.matches[e.matches.length-1];return t.route.id||a(!1),t.route.id}const cg={};l.startTransition;function dg(g){a(!1)}function Ag(g){let{basename:t="/",children:l=null,location:C,navigationType:n=e.Pop,navigator:o,static:i=!1,future:s}=g;P()&&a(!1);let c=t.replace(/^\/*/,"/"),d=I.useMemo((()=>({basename:c,navigator:o,static:i,future:E({v7_relativeSplatPath:!1},s)})),[c,s,o,i]);"string"===typeof C&&(C=A(C));let{pathname:r="/",search:u="",hash:m="",state:b=null,key:h="default"}=C,Z=I.useMemo((()=>{let g=k(r,c);return null==g?null:{location:{pathname:g,search:u,hash:m,state:b,key:h},navigationType:n}}),[c,r,u,m,b,h,n]);return null==Z?null:I.createElement(L.Provider,{value:d},I.createElement(j.Provider,{children:l,value:Z}))}function rg(g){let{children:e,location:t}=g;return gg(ug(e),t)}new Promise((()=>{}));I.Component;function ug(g,e){void 0===e&&(e=[]);let t=[];return I.Children.forEach(g,((g,l)=>{if(!I.isValidElement(g))return;let C=[...e,l];if(g.type===I.Fragment)return void t.push.apply(t,ug(g.props.children,C));g.type!==dg&&a(!1),g.props.index&&g.props.children&&a(!1);let n={id:g.props.id||C.join("-"),caseSensitive:g.props.caseSensitive,element:g.props.element,Component:g.props.Component,index:g.props.index,path:g.props.path,loader:g.props.loader,action:g.props.action,errorElement:g.props.errorElement,ErrorBoundary:g.props.ErrorBoundary,hasErrorBoundary:null!=g.props.ErrorBoundary||null!=g.props.errorElement,shouldRevalidate:g.props.shouldRevalidate,handle:g.props.handle,lazy:g.props.lazy};g.props.children&&(n.children=ug(g.props.children,C)),t.push(n)})),t}var mg=t(309),bg=t.n(mg),hg=t(579);const Zg=()=>{const g=q(),[e,t]=(0,I.useState)({code:"",sellingPrice:"",quantitySold:1,customerPhoneNo:"",sellerEmail:""}),[l,C]=(0,I.useState)(!1),[n,o]=(0,I.useState)(!1),[a,i]=(0,I.useState)(!1),[s,c]=(0,I.useState)(0),[d,A]=(0,I.useState)(!1),[r,u]=(0,I.useState)(""),[m,b]=(0,I.useState)(!1),[h,Z]=(0,I.useState)(!1);(0,I.useEffect)((()=>{!function(){const e=window.localStorage.getItem("userInfo");if(e){const g=JSON.parse(e);t((e=>({...e,sellerEmail:g.email||""})))}else g("/login")}()}),[g]),(0,I.useEffect)((()=>{s>0&&""!==e.sellingPrice&&parseFloat(e.sellingPrice)>0?C(!0):C(!1)}),[s,e.sellingPrice]);(0,I.useEffect)((()=>{(async()=>{try{if(7===e.code.length){A(!0);const I=await fetch("/api/availablequantity?code=".concat(e.code),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(I.ok){var{availableQuantity:t}=await I.json();c(t)}else C(!1),c(0),console.log("Failed to fetch available quantity"),401===I.status&&(window.localStorage.clear(),g("/login"));A(!1)}else c(0)}catch(I){console.log(I)}})()}),[e.code]);const G=g=>{const{name:e,value:I}=g.target;if(!("sellingPrice"===e&&parseFloat(I)<0)){if("customerPhoneNo"===e){if(!/^\d*$/.test(I))return;10===I.length||0===I.length?Z(!1):Z(!0)}t((g=>({...g,[e]:I.toUpperCase()})))}};return(0,hg.jsxs)("div",{className:"bg-white p-6 rounded shadow-lg",children:[(0,hg.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Sale"}),(0,hg.jsxs)("div",{className:"mb-4",children:[(0,hg.jsx)("label",{htmlFor:"code",className:"block text-sm font-medium text-gray-700",children:"Code"}),(0,hg.jsx)("input",{name:"code",type:"string",placeholder:"Product code",value:e.code,onChange:G,className:"mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"}),(0,hg.jsxs)("p",{className:"mb-4 text-green-500",children:["Available Quantity:"," ",d?"Fetching Quantity...":s]}),(0,hg.jsxs)("div",{className:"mb-4",children:[(0,hg.jsx)("label",{htmlFor:"sellingPrice",className:"block text-sm font-medium text-gray-700",children:"Selling Price"}),(0,hg.jsx)("input",{type:"number",placeholder:"Selling price",name:"sellingPrice",value:e.sellingPrice,onChange:G,className:"mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,hg.jsxs)("div",{className:"mb-4",children:[(0,hg.jsx)("label",{htmlFor:"customerPhoneNo",className:"block text-sm font-medium text-gray-700",children:"Customer Phone No."}),(0,hg.jsx)("input",{name:"customerPhoneNo",type:"tel",placeholder:"Customer's phone number",value:e.customerPhoneNo,onChange:G,className:"mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),h&&(0,hg.jsx)("div",{className:"mt-2 p-2 bg-red-400 text-white font-bold text-center rounded-md",children:"Invalid phone number"})]}),(0,hg.jsxs)("div",{className:"flex justify-center",children:[(0,hg.jsx)("button",{onClick:()=>{u(""),t((g=>({...g,code:""})))},className:"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded m-1",children:"Reset QR Code"}),(0,hg.jsx)("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded m-1",onClick:()=>b(!m),children:"Toggle Scanner"})]}),m&&(0,hg.jsx)(bg(),{onScan:g=>{g&&/^[A-Z]{3}\d{4}$/.test(g.text)&&(t((e=>({...e,code:g.text}))),u(g.text),b(!1))},onError:g=>{console.error("Error while scanning QR code:",g)},constraints:{audio:!1,video:{facingMode:"environment"}},style:{width:"100%"}}),r&&(0,hg.jsxs)("p",{children:["QR Code Scanned: ",r]}),a&&(0,hg.jsx)(hg.Fragment,{children:(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999},children:(0,hg.jsxs)("div",{className:"flex items-center justify-center bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative w-full m-5",role:"alert",children:[(0,hg.jsx)("strong",{className:"font-bold",children:"Product sold"}),(0,hg.jsx)("span",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",children:(0,hg.jsxs)("svg",{className:"fill-current h-6 w-6 text-green-500 cursor-pointer",role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",onClick:()=>i(!1),children:[(0,hg.jsx)("title",{children:"Close"}),(0,hg.jsx)("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})]})})]})})}),(0,hg.jsx)("button",{onClick:async()=>{o(!0),C(!1);try{const I=await fetch("/api/sell",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)},body:JSON.stringify(e)});I.ok?(t({code:"",sellingPrice:"",quantitySold:1,customerPhoneNo:"",sellerEmail:window.localStorage.getItem("userInfo").email||""}),console.log("Product sold from inventory successfully!"),i(!0),setTimeout((()=>{i(!1)}),3e3)):401===I.status?(window.localStorage.clear(),g("/login")):console.error("Failed to sell product from inventory")}catch(I){console.error("Error:",I)}finally{o(!1)}},disabled:!l||n,className:"w-full py-2 px-4 rounded focus:outline-none focus:shadow-outline-indigo active:bg-indigo-800 ".concat(l?"bg-indigo-500 text-white":"bg-gray-300 text-black opacity-50 cursor-not-allowed"),children:n?"Selling...":"Sell"})]})};var Gg,pg=Object.defineProperty,yg=Object.getOwnPropertySymbols,Bg=Object.prototype.hasOwnProperty,Sg=Object.prototype.propertyIsEnumerable,Wg=(g,e,t)=>e in g?pg(g,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):g[e]=t,Vg=(g,e)=>{for(var t in e||(e={}))Bg.call(e,t)&&Wg(g,t,e[t]);if(yg)for(var t of yg(e))Sg.call(e,t)&&Wg(g,t,e[t]);return g},Rg=(g,e)=>{var t={};for(var I in g)Bg.call(g,I)&&e.indexOf(I)<0&&(t[I]=g[I]);if(null!=g&&yg)for(var I of yg(g))e.indexOf(I)<0&&Sg.call(g,I)&&(t[I]=g[I]);return t};(g=>{const e=class{constructor(g,t,I,l){if(this.version=g,this.errorCorrectionLevel=t,this.modules=[],this.isFunction=[],g<e.MIN_VERSION||g>e.MAX_VERSION)throw new RangeError("Version value out of range");if(l<-1||l>7)throw new RangeError("Mask value out of range");this.size=4*g+17;let n=[];for(let e=0;e<this.size;e++)n.push(!1);for(let e=0;e<this.size;e++)this.modules.push(n.slice()),this.isFunction.push(n.slice());this.drawFunctionPatterns();const o=this.addEccAndInterleave(I);if(this.drawCodewords(o),-1==l){let g=1e9;for(let e=0;e<8;e++){this.applyMask(e),this.drawFormatBits(e);const t=this.getPenaltyScore();t<g&&(l=e,g=t),this.applyMask(e)}}C(0<=l&&l<=7),this.mask=l,this.applyMask(l),this.drawFormatBits(l),this.isFunction=[]}static encodeText(t,I){const l=g.QrSegment.makeSegments(t);return e.encodeSegments(l,I)}static encodeBinary(t,I){const l=g.QrSegment.makeBytes(t);return e.encodeSegments([l],I)}static encodeSegments(g,t){let l,n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,c=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if(!(e.MIN_VERSION<=a&&a<=i&&i<=e.MAX_VERSION)||s<-1||s>7)throw new RangeError("Invalid value");for(l=a;;l++){const I=8*e.getNumDataCodewords(l,t),C=o.getTotalBits(g,l);if(C<=I){n=C;break}if(l>=i)throw new RangeError("Data too long")}for(const I of[e.Ecc.MEDIUM,e.Ecc.QUARTILE,e.Ecc.HIGH])c&&n<=8*e.getNumDataCodewords(l,I)&&(t=I);let d=[];for(const e of g){I(e.mode.modeBits,4,d),I(e.numChars,e.mode.numCharCountBits(l),d);for(const g of e.getData())d.push(g)}C(d.length==n);const A=8*e.getNumDataCodewords(l,t);C(d.length<=A),I(0,Math.min(4,A-d.length),d),I(0,(8-d.length%8)%8,d),C(d.length%8==0);for(let e=236;d.length<A;e^=253)I(e,8,d);let r=[];for(;8*r.length<d.length;)r.push(0);return d.forEach(((g,e)=>r[e>>>3]|=g<<7-(7&e))),new e(l,t,r,s)}getModule(g,e){return 0<=g&&g<this.size&&0<=e&&e<this.size&&this.modules[e][g]}getModules(){return this.modules}drawFunctionPatterns(){for(let t=0;t<this.size;t++)this.setFunctionModule(6,t,t%2==0),this.setFunctionModule(t,6,t%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const g=this.getAlignmentPatternPositions(),e=g.length;for(let t=0;t<e;t++)for(let I=0;I<e;I++)0==t&&0==I||0==t&&I==e-1||t==e-1&&0==I||this.drawAlignmentPattern(g[t],g[I]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(g){const e=this.errorCorrectionLevel.formatBits<<3|g;let t=e;for(let l=0;l<10;l++)t=t<<1^1335*(t>>>9);const I=21522^(e<<10|t);C(I>>>15==0);for(let C=0;C<=5;C++)this.setFunctionModule(8,C,l(I,C));this.setFunctionModule(8,7,l(I,6)),this.setFunctionModule(8,8,l(I,7)),this.setFunctionModule(7,8,l(I,8));for(let C=9;C<15;C++)this.setFunctionModule(14-C,8,l(I,C));for(let C=0;C<8;C++)this.setFunctionModule(this.size-1-C,8,l(I,C));for(let C=8;C<15;C++)this.setFunctionModule(8,this.size-15+C,l(I,C));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let g=this.version;for(let t=0;t<12;t++)g=g<<1^7973*(g>>>11);const e=this.version<<12|g;C(e>>>18==0);for(let t=0;t<18;t++){const g=l(e,t),I=this.size-11+t%3,C=Math.floor(t/3);this.setFunctionModule(I,C,g),this.setFunctionModule(C,I,g)}}drawFinderPattern(g,e){for(let t=-4;t<=4;t++)for(let I=-4;I<=4;I++){const l=Math.max(Math.abs(I),Math.abs(t)),C=g+I,n=e+t;0<=C&&C<this.size&&0<=n&&n<this.size&&this.setFunctionModule(C,n,2!=l&&4!=l)}}drawAlignmentPattern(g,e){for(let t=-2;t<=2;t++)for(let I=-2;I<=2;I++)this.setFunctionModule(g+I,e+t,1!=Math.max(Math.abs(I),Math.abs(t)))}setFunctionModule(g,e,t){this.modules[e][g]=t,this.isFunction[e][g]=!0}addEccAndInterleave(g){const t=this.version,I=this.errorCorrectionLevel;if(g.length!=e.getNumDataCodewords(t,I))throw new RangeError("Invalid argument");const l=e.NUM_ERROR_CORRECTION_BLOCKS[I.ordinal][t],n=e.ECC_CODEWORDS_PER_BLOCK[I.ordinal][t],o=Math.floor(e.getNumRawDataModules(t)/8),a=l-o%l,i=Math.floor(o/l);let s=[];const c=e.reedSolomonComputeDivisor(n);for(let C=0,A=0;C<l;C++){let t=g.slice(A,A+i-n+(C<a?0:1));A+=t.length;const I=e.reedSolomonComputeRemainder(t,c);C<a&&t.push(0),s.push(t.concat(I))}let d=[];for(let e=0;e<s[0].length;e++)s.forEach(((g,t)=>{(e!=i-n||t>=a)&&d.push(g[e])}));return C(d.length==o),d}drawCodewords(g){if(g.length!=Math.floor(e.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let t=0;for(let e=this.size-1;e>=1;e-=2){6==e&&(e=5);for(let I=0;I<this.size;I++)for(let C=0;C<2;C++){const n=e-C,o=0==(e+1&2)?this.size-1-I:I;!this.isFunction[o][n]&&t<8*g.length&&(this.modules[o][n]=l(g[t>>>3],7-(7&t)),t++)}}C(t==8*g.length)}applyMask(g){if(g<0||g>7)throw new RangeError("Mask value out of range");for(let e=0;e<this.size;e++)for(let t=0;t<this.size;t++){let I;switch(g){case 0:I=(t+e)%2==0;break;case 1:I=e%2==0;break;case 2:I=t%3==0;break;case 3:I=(t+e)%3==0;break;case 4:I=(Math.floor(t/3)+Math.floor(e/2))%2==0;break;case 5:I=t*e%2+t*e%3==0;break;case 6:I=(t*e%2+t*e%3)%2==0;break;case 7:I=((t+e)%2+t*e%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[e][t]&&I&&(this.modules[e][t]=!this.modules[e][t])}}getPenaltyScore(){let g=0;for(let C=0;C<this.size;C++){let t=!1,I=0,l=[0,0,0,0,0,0,0];for(let n=0;n<this.size;n++)this.modules[C][n]==t?(I++,5==I?g+=e.PENALTY_N1:I>5&&g++):(this.finderPenaltyAddHistory(I,l),t||(g+=this.finderPenaltyCountPatterns(l)*e.PENALTY_N3),t=this.modules[C][n],I=1);g+=this.finderPenaltyTerminateAndCount(t,I,l)*e.PENALTY_N3}for(let C=0;C<this.size;C++){let t=!1,I=0,l=[0,0,0,0,0,0,0];for(let n=0;n<this.size;n++)this.modules[n][C]==t?(I++,5==I?g+=e.PENALTY_N1:I>5&&g++):(this.finderPenaltyAddHistory(I,l),t||(g+=this.finderPenaltyCountPatterns(l)*e.PENALTY_N3),t=this.modules[n][C],I=1);g+=this.finderPenaltyTerminateAndCount(t,I,l)*e.PENALTY_N3}for(let C=0;C<this.size-1;C++)for(let t=0;t<this.size-1;t++){const I=this.modules[C][t];I==this.modules[C][t+1]&&I==this.modules[C+1][t]&&I==this.modules[C+1][t+1]&&(g+=e.PENALTY_N2)}let t=0;for(const e of this.modules)t=e.reduce(((g,e)=>g+(e?1:0)),t);const I=this.size*this.size,l=Math.ceil(Math.abs(20*t-10*I)/I)-1;return C(0<=l&&l<=9),g+=l*e.PENALTY_N4,C(0<=g&&g<=2568888),g}getAlignmentPatternPositions(){if(1==this.version)return[];{const g=Math.floor(this.version/7)+2,e=32==this.version?26:2*Math.ceil((4*this.version+4)/(2*g-2));let t=[6];for(let I=this.size-7;t.length<g;I-=e)t.splice(1,0,I);return t}}static getNumRawDataModules(g){if(g<e.MIN_VERSION||g>e.MAX_VERSION)throw new RangeError("Version number out of range");let t=(16*g+128)*g+64;if(g>=2){const e=Math.floor(g/7)+2;t-=(25*e-10)*e-55,g>=7&&(t-=36)}return C(208<=t&&t<=29648),t}static getNumDataCodewords(g,t){return Math.floor(e.getNumRawDataModules(g)/8)-e.ECC_CODEWORDS_PER_BLOCK[t.ordinal][g]*e.NUM_ERROR_CORRECTION_BLOCKS[t.ordinal][g]}static reedSolomonComputeDivisor(g){if(g<1||g>255)throw new RangeError("Degree out of range");let t=[];for(let e=0;e<g-1;e++)t.push(0);t.push(1);let I=1;for(let l=0;l<g;l++){for(let g=0;g<t.length;g++)t[g]=e.reedSolomonMultiply(t[g],I),g+1<t.length&&(t[g]^=t[g+1]);I=e.reedSolomonMultiply(I,2)}return t}static reedSolomonComputeRemainder(g,t){let I=t.map((g=>0));for(const l of g){const g=l^I.shift();I.push(0),t.forEach(((t,l)=>I[l]^=e.reedSolomonMultiply(t,g)))}return I}static reedSolomonMultiply(g,e){if(g>>>8!=0||e>>>8!=0)throw new RangeError("Byte out of range");let t=0;for(let I=7;I>=0;I--)t=t<<1^285*(t>>>7),t^=(e>>>I&1)*g;return C(t>>>8==0),t}finderPenaltyCountPatterns(g){const e=g[1];C(e<=3*this.size);const t=e>0&&g[2]==e&&g[3]==3*e&&g[4]==e&&g[5]==e;return(t&&g[0]>=4*e&&g[6]>=e?1:0)+(t&&g[6]>=4*e&&g[0]>=e?1:0)}finderPenaltyTerminateAndCount(g,e,t){return g&&(this.finderPenaltyAddHistory(e,t),e=0),e+=this.size,this.finderPenaltyAddHistory(e,t),this.finderPenaltyCountPatterns(t)}finderPenaltyAddHistory(g,e){0==e[0]&&(g+=this.size),e.pop(),e.unshift(g)}};let t=e;function I(g,e,t){if(e<0||e>31||g>>>e!=0)throw new RangeError("Value out of range");for(let I=e-1;I>=0;I--)t.push(g>>>I&1)}function l(g,e){return 0!=(g>>>e&1)}function C(g){if(!g)throw new Error("Assertion error")}t.MIN_VERSION=1,t.MAX_VERSION=40,t.PENALTY_N1=3,t.PENALTY_N2=3,t.PENALTY_N3=40,t.PENALTY_N4=10,t.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],t.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],g.QrCode=t;const n=class{constructor(g,e,t){if(this.mode=g,this.numChars=e,this.bitData=t,e<0)throw new RangeError("Invalid argument");this.bitData=t.slice()}static makeBytes(g){let e=[];for(const t of g)I(t,8,e);return new n(n.Mode.BYTE,g.length,e)}static makeNumeric(g){if(!n.isNumeric(g))throw new RangeError("String contains non-numeric characters");let e=[];for(let t=0;t<g.length;){const l=Math.min(g.length-t,3);I(parseInt(g.substr(t,l),10),3*l+1,e),t+=l}return new n(n.Mode.NUMERIC,g.length,e)}static makeAlphanumeric(g){if(!n.isAlphanumeric(g))throw new RangeError("String contains unencodable characters in alphanumeric mode");let e,t=[];for(e=0;e+2<=g.length;e+=2){let l=45*n.ALPHANUMERIC_CHARSET.indexOf(g.charAt(e));l+=n.ALPHANUMERIC_CHARSET.indexOf(g.charAt(e+1)),I(l,11,t)}return e<g.length&&I(n.ALPHANUMERIC_CHARSET.indexOf(g.charAt(e)),6,t),new n(n.Mode.ALPHANUMERIC,g.length,t)}static makeSegments(g){return""==g?[]:n.isNumeric(g)?[n.makeNumeric(g)]:n.isAlphanumeric(g)?[n.makeAlphanumeric(g)]:[n.makeBytes(n.toUtf8ByteArray(g))]}static makeEci(g){let e=[];if(g<0)throw new RangeError("ECI assignment value out of range");if(g<128)I(g,8,e);else if(g<16384)I(2,2,e),I(g,14,e);else{if(!(g<1e6))throw new RangeError("ECI assignment value out of range");I(6,3,e),I(g,21,e)}return new n(n.Mode.ECI,0,e)}static isNumeric(g){return n.NUMERIC_REGEX.test(g)}static isAlphanumeric(g){return n.ALPHANUMERIC_REGEX.test(g)}getData(){return this.bitData.slice()}static getTotalBits(g,e){let t=0;for(const I of g){const g=I.mode.numCharCountBits(e);if(I.numChars>=1<<g)return 1/0;t+=4+g+I.bitData.length}return t}static toUtf8ByteArray(g){g=encodeURI(g);let e=[];for(let t=0;t<g.length;t++)"%"!=g.charAt(t)?e.push(g.charCodeAt(t)):(e.push(parseInt(g.substr(t+1,2),16)),t+=2);return e}};let o=n;o.NUMERIC_REGEX=/^[0-9]*$/,o.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,o.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",g.QrSegment=o})(Gg||(Gg={})),(g=>{let e;(g=>{const e=class{constructor(g,e){this.ordinal=g,this.formatBits=e}};let t=e;t.LOW=new e(0,1),t.MEDIUM=new e(1,0),t.QUARTILE=new e(2,3),t.HIGH=new e(3,2),g.Ecc=t})(e=g.QrCode||(g.QrCode={}))})(Gg||(Gg={})),(g=>{let e;(g=>{const e=class{constructor(g,e){this.modeBits=g,this.numBitsCharCount=e}numCharCountBits(g){return this.numBitsCharCount[Math.floor((g+7)/17)]}};let t=e;t.NUMERIC=new e(1,[10,12,14]),t.ALPHANUMERIC=new e(2,[9,11,13]),t.BYTE=new e(4,[8,16,16]),t.KANJI=new e(8,[8,10,12]),t.ECI=new e(7,[0,0,0]),g.Mode=t})(e=g.QrSegment||(g.QrSegment={}))})(Gg||(Gg={}));var Xg=Gg,Jg={L:Xg.QrCode.Ecc.LOW,M:Xg.QrCode.Ecc.MEDIUM,Q:Xg.QrCode.Ecc.QUARTILE,H:Xg.QrCode.Ecc.HIGH},kg=128,fg="L",vg="#FFFFFF",Yg="#000000",xg=!1,Hg=4,Ng=.1;function wg(g){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const t=[];return g.forEach((function(g,I){let l=null;g.forEach((function(C,n){if(!C&&null!==l)return t.push("M".concat(l+e," ").concat(I+e,"h").concat(n-l,"v1H").concat(l+e,"z")),void(l=null);if(n!==g.length-1)C&&null===l&&(l=n);else{if(!C)return;null===l?t.push("M".concat(n+e,",").concat(I+e," h1v1H").concat(n+e,"z")):t.push("M".concat(l+e,",").concat(I+e," h").concat(n+1-l,"v1H").concat(l+e,"z"))}}))})),t.join("")}function Fg(g,e){return g.slice().map(((g,t)=>t<e.y||t>=e.y+e.h?g:g.map(((g,t)=>(t<e.x||t>=e.x+e.w)&&g))))}function Kg(g,e,t,I){if(null==I)return null;const l=t?Hg:0,C=g.length+2*l,n=Math.floor(e*Ng),o=C/e,a=(I.width||n)*o,i=(I.height||n)*o,s=null==I.x?g.length/2-a/2:I.x*o,c=null==I.y?g.length/2-i/2:I.y*o;let d=null;if(I.excavate){let g=Math.floor(s),e=Math.floor(c);d={x:g,y:e,w:Math.ceil(a+s-g),h:Math.ceil(i+c-e)}}return{x:s,y:c,h:i,w:a,excavation:d}}var zg=function(){try{(new Path2D).addPath(new Path2D)}catch(g){return!1}return!0}();function Mg(g){const e=g,{value:t,size:l=kg,level:C=fg,bgColor:n=vg,fgColor:o=Yg,includeMargin:a=xg,style:i,imageSettings:s}=e,c=Rg(e,["value","size","level","bgColor","fgColor","includeMargin","style","imageSettings"]),d=null==s?void 0:s.src,A=(0,I.useRef)(null),r=(0,I.useRef)(null),[u,m]=(0,I.useState)(!1);(0,I.useEffect)((()=>{if(null!=A.current){const g=A.current,e=g.getContext("2d");if(!e)return;let I=Xg.QrCode.encodeText(t,Jg[C]).getModules();const i=a?Hg:0,c=I.length+2*i,d=Kg(I,l,a,s),u=r.current,m=null!=d&&null!==u&&u.complete&&0!==u.naturalHeight&&0!==u.naturalWidth;m&&null!=d.excavation&&(I=Fg(I,d.excavation));const b=window.devicePixelRatio||1;g.height=g.width=l*b;const h=l/c*b;e.scale(h,h),e.fillStyle=n,e.fillRect(0,0,c,c),e.fillStyle=o,zg?e.fill(new Path2D(wg(I,i))):I.forEach((function(g,t){g.forEach((function(g,I){g&&e.fillRect(I+i,t+i,1,1)}))})),m&&e.drawImage(u,d.x+i,d.y+i,d.w,d.h)}})),(0,I.useEffect)((()=>{m(!1)}),[d]);const b=Vg({height:l,width:l},i);let h=null;return null!=d&&(h=I.createElement("img",{src:d,key:d,style:{display:"none"},onLoad:()=>{m(!0)},ref:r})),I.createElement(I.Fragment,null,I.createElement("canvas",Vg({style:b,height:l,width:l,ref:A},c)),h)}function Eg(g){const e=g,{value:t,size:l=kg,level:C=fg,bgColor:n=vg,fgColor:o=Yg,includeMargin:a=xg,imageSettings:i}=e,s=Rg(e,["value","size","level","bgColor","fgColor","includeMargin","imageSettings"]);let c=Xg.QrCode.encodeText(t,Jg[C]).getModules();const d=a?Hg:0,A=c.length+2*d,r=Kg(c,l,a,i);let u=null;null!=i&&null!=r&&(null!=r.excavation&&(c=Fg(c,r.excavation)),u=I.createElement("image",{xlinkHref:i.src,height:r.h,width:r.w,x:r.x+d,y:r.y+d,preserveAspectRatio:"none"}));const m=wg(c,d);return I.createElement("svg",Vg({height:l,width:l,viewBox:"0 0 ".concat(A," ").concat(A)},s),I.createElement("path",{fill:n,d:"M0,0 h".concat(A,"v").concat(A,"H0z"),shapeRendering:"crispEdges"}),I.createElement("path",{fill:o,d:m,shapeRendering:"crispEdges"}),u)}var Qg=g=>{const e=g,{renderAs:t}=e,l=Rg(e,["renderAs"]);return"svg"===t?I.createElement(Eg,Vg({},l)):I.createElement(Mg,Vg({},l))},Ug=t(141);const Lg=()=>{const g=q(),e=I.useRef(),[t,l]=(0,I.useState)({brand:"",product:"",category:"",size:[],quantityBuy:1,mrp:""}),[C,n]=(0,I.useState)({products:[],categories:[],sizes:[{size:[]}]}),[o,a]=(0,I.useState)([]),[i,s]=(0,I.useState)(!1),[c,d]=(0,I.useState)(!1),[A,r]=(0,I.useState)(!1),[u,m]=(0,I.useState)(!1),[b,h]=(0,I.useState)([]),[Z,G]=(0,I.useState)(!1),[p,y]=(0,I.useState)(!1),[B,S]=(0,I.useState)("single"),[W,V]=(0,I.useState)([]),[R,X]=(0,I.useState)(!0),[J,k]=(0,I.useState)(2),f=()=>{y((g=>!g))};(0,I.useEffect)((()=>{window.localStorage.getItem("userInfo")||g("/login")}),[g]),(0,I.useEffect)((()=>{b.length>0?G(!0):G(!1)}),[b]),(0,I.useEffect)((()=>{if(b.length>1){let g=[],e=0,t=-1,I=[...b];for(;t>=I.length-1?(e++,t=0):t++,e<I[t].quantityBuy?g.push(I[t]):(I.splice(t,1),t--),0!==I.length;);V(g)}}),[b]);(0,I.useEffect)((()=>{(async()=>{try{if(window.localStorage.getItem("userInfo")){const e=await fetch("/api/dropdownoption/dropdownoptions",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(e.ok){const g=await e.json();g.products.sort(((g,e)=>g.brand.localeCompare(e.brand))),g.products.forEach((g=>{g.products.sort()})),g.categories[0].category.sort(((g,e)=>g.localeCompare(e))),n(g)}else console.error("Failed to fetch dropdown options"),window.localStorage.clear(),g("/login")}}catch(e){console.log(e)}})()}),[]),(0,I.useEffect)((()=>{(()=>{const g=Object.values(t).every((g=>""!==g))&&t.size.length>0;s(g)})()}),[t]);const v=g=>{const{name:e,value:t}=g.target;("quantityBuy"===e||"mrp"===e)&&parseFloat(t)<0||l((g=>({...g,[e]:t})))},Y=g=>{const{value:e}=g.target;let I=[...t.size];I.includes(e)?I=I.filter((g=>g!==e)):I.push(e),I.sort(((g,e)=>C.sizes[0].size.indexOf(g)-C.sizes[0].size.indexOf(e))),l((g=>({...g,size:I})))};function x(g){var e=g*J+10;return(e=100*Math.round(e/100))-4}const H=(0,Ug.useReactToPrint)({content:()=>e.current});return(0,hg.jsxs)("div",{className:"bg-white p-6 shadow-md rounded-md",children:[(0,hg.jsx)("h2",{className:"text-2xl font-semibold mb-6",children:"Purchase"}),(0,hg.jsxs)("div",{className:"flex items-center mt-4",children:[(0,hg.jsx)("label",{className:"mr-4",children:"Auto Reset:"}),(0,hg.jsx)("input",{type:"radio",name:"autoReset",value:"enabled",checked:!0===R,onChange:()=>X(!0),className:"mr-2"})," ","Enabled",(0,hg.jsx)("input",{type:"radio",name:"autoReset",value:"disabled",checked:!1===R,onChange:()=>X(!1),className:"ml-4 mr-2"})," ","Disabled"]}),u&&(p?(0,hg.jsx)(hg.Fragment,{children:(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999},children:(0,hg.jsx)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative w-full m-5",role:"alert",children:(0,hg.jsxs)("div",{className:"max-h-[80vh] overflow-y-auto hide-scrollbar",children:[(0,hg.jsx)("strong",{className:"font-bold",children:"Items added to inventory:"}),(0,hg.jsxs)("div",{className:"flex justify-center m-4",children:[(0,hg.jsx)("button",{onClick:()=>S("single"),className:"px-4 py-2 mx-2 ".concat("single"===B?"bg-indigo-700":"bg-indigo-300"," text-white rounded-md focus:outline-none"),children:"Print Single Tags"}),(0,hg.jsx)("button",{onClick:()=>S("multiple"),className:"px-4 py-2 mx-2 ".concat("multiple"===B?"bg-indigo-700":"bg-indigo-300"," text-white rounded-md focus:outline-none"),children:"Print Multiple Tags"})]}),(0,hg.jsx)("div",{className:"flex justify-center m-4",children:(0,hg.jsx)("button",{onClick:f,className:"px-4 py-2 bg-indigo-500 text-white rounded-md focus:outline-none",children:p?"Show Code and Size":"Show QR Code"})}),(0,hg.jsx)("div",{className:"flex justify-center",children:(0,hg.jsxs)("div",{style:{width:"106mm"},ref:e,className:"flex flex-wrap",children:[b.length%2!==0&&b.push({code:"",brand:"",product:"",category:"",size:"",quantityBuy:0,quantitySold:0,mrp:100,secretCode:""}),("single"===B?b:W).map(((g,e)=>(0,hg.jsx)("div",{className:"flex items-center justify-evenly",children:(0,hg.jsxs)("div",{style:{width:"50mm",height:"25mm",padding:0,marginLeft:"1.3mm",marginRight:"1.3mm"},className:"flex justify-evenly bg-white",children:[(0,hg.jsxs)("div",{className:"p-2 pr-0",children:[(0,hg.jsx)(Qg,{value:g.code,size:60}),(0,hg.jsx)("p",{className:"text-black",children:g.code})]}),(0,hg.jsxs)("div",{className:"relative font-bold text-black pt-1",children:[(0,hg.jsx)("div",{className:"flex justify-center",children:(0,hg.jsx)("img",{src:"Images/Ganesha.jpg",alt:"project",width:"25mm"})}),(0,hg.jsxs)("div",{children:[(0,hg.jsxs)("p",{children:["MRP: ",x(g.mrp),"/-"]}),(0,hg.jsxs)("p",{children:["Size: ",g.size]}),(0,hg.jsx)("div",{children:(0,hg.jsx)("p",{className:"absolute right-1 bottom-1 text-sm font-normal",children:g.secretCode})})]})]})]})},e)))]})}),(0,hg.jsx)("button",{onClick:H,disabled:!Z,className:"w-full py-2 px-4 rounded focus:outline-none focus:shadow-outline-indigo active:bg-indigo-800 ".concat(Z?"bg-indigo-500 text-white":"bg-gray-300 text-black opacity-50 cursor-not-allowed"),children:"Print"}),(0,hg.jsx)("span",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",children:(0,hg.jsxs)("svg",{className:"fill-current h-6 w-6 text-green-500 cursor-pointer",role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",onClick:()=>m(!1),children:[(0,hg.jsx)("title",{children:"Close"}),(0,hg.jsx)("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})]})})]})})})}):(0,hg.jsx)(hg.Fragment,{children:(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999},children:(0,hg.jsxs)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative w-full m-5",role:"alert",children:[(0,hg.jsx)("strong",{className:"font-bold",children:"Items added to inventory:"}),(0,hg.jsx)("div",{className:"flex justify-center m-4",children:(0,hg.jsx)("button",{onClick:f,className:"px-4 py-2 bg-indigo-500 text-white rounded-md focus:outline-none",children:p?"Show Code and Size":"Show QR Code"})}),b.map(((g,e)=>(0,hg.jsxs)("div",{className:"flex items-center justify-evenly mb-2",children:[(0,hg.jsxs)("div",{className:"rounded-md p-2 mr-2",children:[(0,hg.jsx)("span",{className:"block sm:inline font-semibold",children:"Code:"}),(0,hg.jsx)("span",{className:"block sm:inline ml-1",children:g.code})]}),(0,hg.jsxs)("div",{className:"rounded-md p-2",children:[(0,hg.jsx)("span",{className:"block sm:inline font-semibold",children:"Size:"}),(0,hg.jsx)("span",{className:"block sm:inline ml-1",children:g.size})]})]},e))),(0,hg.jsx)("span",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",children:(0,hg.jsxs)("svg",{className:"fill-current h-6 w-6 text-green-500 cursor-pointer",role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",onClick:()=>m(!1),children:[(0,hg.jsx)("title",{children:"Close"}),(0,hg.jsx)("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})]})})]})})})),(0,hg.jsxs)("select",{name:"brand",value:t.brand,onChange:g=>{var e;const{name:t,value:I}=g.target;var n=C.products.filter((g=>g.brand===I));n=(null===(e=n[0])||void 0===e?void 0:e.products)||[],a(n),l((g=>({...g,[t]:I})))},className:"w-full p-2 border rounded-md",children:[(0,hg.jsx)("option",{value:"",disabled:!0,children:"Select Brand"}),C.products.map((g=>(0,hg.jsx)("option",{value:g.brand,children:g.brand},g._id)))]}),(0,hg.jsxs)("select",{name:"product",value:t.product,onChange:v,className:"w-full mt-4 p-2 border rounded-md",children:[(0,hg.jsx)("option",{value:"",disabled:!0,children:"Select Product"}),o.map((g=>(0,hg.jsx)("option",{value:g,children:g},g)))]}),(0,hg.jsxs)("select",{name:"category",value:t.category,onChange:v,className:"w-full mt-4 p-2 border rounded-md",children:[(0,hg.jsx)("option",{value:"",disabled:!0,children:"Select Category"}),C.categories.map((g=>g.category.map((g=>(0,hg.jsx)("option",{value:g,children:g},g)))))]}),(0,hg.jsxs)("div",{className:"mt-4",children:[(0,hg.jsx)("p",{className:"font-semibold mb-1",children:"Select Size:"}),(0,hg.jsx)("div",{className:"flex flex-wrap",children:C.sizes[0].size.map(((g,e)=>(0,hg.jsxs)("div",{className:"flex items-center mr-4 mb-2",children:[(0,hg.jsx)("input",{type:"checkbox",id:g,name:g,value:g,checked:t.size.includes(g),onChange:Y,className:"mr-1"}),(0,hg.jsx)("label",{htmlFor:g,children:g})]},e)))})]}),(0,hg.jsx)("input",{type:"number",placeholder:"MRP",name:"mrp",value:t.mrp,onChange:v,className:"w-full mt-4 p-2 border rounded-md"}),(0,hg.jsx)("input",{type:"number",placeholder:"Quantity to Purchase",name:"quantityBuy",value:t.quantityBuy,onChange:v,className:"w-full mt-4 p-2 border rounded-md"}),(0,hg.jsx)("input",{type:"number",step:"0.1",placeholder:"Enter Margin (e.g. 1.8)",value:J,onChange:g=>k(parseFloat(g.target.value)||1),onWheel:g=>g.target.blur(),className:"w-full mt-4 p-2 border rounded-md"}),A&&(0,hg.jsx)("div",{className:"text-green-500 text-sm mt-2",children:"Product added to inventory"}),(0,hg.jsx)("button",{onClick:async()=>{if(i){d(!0);try{const e=await fetch("/api/purchase",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)},body:JSON.stringify(t)});if(e.ok){const{items:g}=await e.json();h(g),l(R?{brand:"",product:"",category:"",size:[],quantityBuy:1,mrp:""}:g=>({...g,mrp:"",quantityBuy:1})),m(!0),r(!0),setTimeout((()=>{r(!1)}),3e3)}else 401===e.status?(window.localStorage.clear(),g("/login")):console.error("Failed to add product to inventory")}catch(e){console.error("Error:",e)}finally{d(!1)}}},disabled:!i||c,className:"w-full mt-6 py-2 px-4 rounded focus:outline-none ".concat(i?"bg-indigo-500 text-white":"bg-gray-500 text-gray-500 opacity-50 cursor-not-allowed"),children:c?"Adding...":"Add to Inventory"}),(0,hg.jsx)("button",{onClick:()=>l({brand:"",product:"",category:"",size:[],quantityBuy:1,mrp:""}),className:"w-full mt-2 py-2 px-4 rounded bg-red-500 text-white",children:"Reset All Fields"})]})},jg=(0,I.createContext)(),Dg=()=>(0,I.useContext)(jg),Tg=g=>{let{children:e}=g;const t=q(),[l,C]=(0,I.useState)("user");return(0,I.useEffect)((()=>{(async()=>{try{if(window.localStorage.getItem("userInfo")){const g=await fetch("/api/role",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(g.ok){const e=await g.json();C(e.role)}else console.error("Failed to fetch role"),window.localStorage.clear(),t("/login")}}catch(g){console.log(g)}})()}),[]),(0,hg.jsxs)(jg.Provider,{value:[l,C],children:[" ",e]})},Pg=()=>{const g=q(),[e]=Dg();(0,I.useEffect)((()=>{window.localStorage.getItem("userInfo")||g("/login")}),[g]);var t="admin"===e,l="dev"===e;return(0,hg.jsx)(hg.Fragment,{children:(0,hg.jsx)("div",{className:"bg-gray-800 text-white h-full fixed top-0 w-full p-4 transition-all duration-300 ease-in-out z-50 max-h-screen overflow-y-auto hide-scrollbar",children:(0,hg.jsxs)("div",{children:[(0,hg.jsx)("h2",{className:"text-2xl font-bold mb-8",children:"Menu"}),(0,hg.jsx)("a",{href:"/search",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:(0,hg.jsxs)("div",{className:"flex",children:[(0,hg.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:(0,hg.jsx)("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"})}),(0,hg.jsx)("p",{className:"ml-1",children:"Search"})]})}),(t||l)&&(0,hg.jsx)("a",{href:"/dashboard",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Dashboard"}),(t||l)&&(0,hg.jsx)("a",{href:"/inventory",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Inventory"}),(0,hg.jsx)("a",{href:"/sale",className:"text-green-500 block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Sale"}),(0,hg.jsx)("a",{href:"/add-expense",className:"text-red-500 block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Add Expense"}),(0,hg.jsx)("a",{href:"/purchase",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Purchase"}),(0,hg.jsx)("a",{href:"/customer-purchase",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Customer Purchase"}),(t||l)&&(0,hg.jsx)("a",{href:"/repurchase",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Re-Purchase"}),(t||l)&&(0,hg.jsx)("a",{href:"/history",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"History"}),(t||l)&&(0,hg.jsx)("a",{href:"/sale-history",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Sale History / Return"}),l&&(0,hg.jsx)("a",{href:"/verification",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Stock Verification"}),(0,hg.jsx)("a",{href:"/expense-history",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Expense History"}),(0,hg.jsx)("a",{href:"/add-brand-product",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Add Brand and Product"}),(0,hg.jsx)("a",{href:"/add-size",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Add Size"}),(0,hg.jsx)("a",{href:"/add-category",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Add Category"}),(0,hg.jsx)("a",{href:"/add-expense-type",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Add Expense Type"}),(0,hg.jsx)("a",{href:"/print-tag",className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-700",children:"Print Tags"}),(0,hg.jsx)("a",{href:"/login",className:"font-bold block py-2 px-4 text-red-500 rounded transition duration-300 hover:bg-gray-700",onClick:function(){window.localStorage.clear(),g("/login")},children:"Log Out"})]})})})};function Og(g){return Og="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(g){return typeof g}:function(g){return g&&"function"==typeof Symbol&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},Og(g)}function _g(g){var e=function(g,e){if("object"!=Og(g)||!g)return g;var t=g[Symbol.toPrimitive];if(void 0!==t){var I=t.call(g,e||"default");if("object"!=Og(I))return I;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(g)}(g,"string");return"symbol"==Og(e)?e:String(e)}function qg(g,e,t){return(e=_g(e))in g?Object.defineProperty(g,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):g[e]=t,g}function $g(g){return g+.5|0}const ge=(g,e,t)=>Math.max(Math.min(g,t),e);function ee(g){return ge($g(2.55*g),0,255)}function te(g){return ge($g(255*g),0,255)}function Ie(g){return ge($g(g/2.55)/100,0,1)}function le(g){return ge($g(100*g),0,100)}const Ce={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},ne=[..."0123456789ABCDEF"],oe=g=>ne[15&g],ae=g=>ne[(240&g)>>4]+ne[15&g],ie=g=>(240&g)>>4===(15&g);function se(g){var e=(g=>ie(g.r)&&ie(g.g)&&ie(g.b)&&ie(g.a))(g)?oe:ae;return g?"#"+e(g.r)+e(g.g)+e(g.b)+((g,e)=>g<255?e(g):"")(g.a,e):void 0}const ce=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function de(g,e,t){const I=e*Math.min(t,1-t),l=function(e){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e+g/30)%12;return t-I*Math.max(Math.min(l-3,9-l,1),-1)};return[l(0),l(8),l(4)]}function Ae(g,e,t){const I=function(I){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(I+g/60)%6;return t-t*e*Math.max(Math.min(l,4-l,1),0)};return[I(5),I(3),I(1)]}function re(g,e,t){const I=de(g,1,.5);let l;for(e+t>1&&(l=1/(e+t),e*=l,t*=l),l=0;l<3;l++)I[l]*=1-e-t,I[l]+=e;return I}function ue(g){const e=g.r/255,t=g.g/255,I=g.b/255,l=Math.max(e,t,I),C=Math.min(e,t,I),n=(l+C)/2;let o,a,i;return l!==C&&(i=l-C,a=n>.5?i/(2-l-C):i/(l+C),o=function(g,e,t,I,l){return g===l?(e-t)/I+(e<t?6:0):e===l?(t-g)/I+2:(g-e)/I+4}(e,t,I,i,l),o=60*o+.5),[0|o,a||0,n]}function me(g,e,t,I){return(Array.isArray(e)?g(e[0],e[1],e[2]):g(e,t,I)).map(te)}function be(g,e,t){return me(de,g,e,t)}function he(g){return(g%360+360)%360}function Ze(g){const e=ce.exec(g);let t,I=255;if(!e)return;e[5]!==t&&(I=e[6]?ee(+e[5]):te(+e[5]));const l=he(+e[2]),C=+e[3]/100,n=+e[4]/100;return t="hwb"===e[1]?function(g,e,t){return me(re,g,e,t)}(l,C,n):"hsv"===e[1]?function(g,e,t){return me(Ae,g,e,t)}(l,C,n):be(l,C,n),{r:t[0],g:t[1],b:t[2],a:I}}const Ge={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},pe={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let ye;function Be(g){ye||(ye=function(){const g={},e=Object.keys(pe),t=Object.keys(Ge);let I,l,C,n,o;for(I=0;I<e.length;I++){for(n=o=e[I],l=0;l<t.length;l++)C=t[l],o=o.replace(C,Ge[C]);C=parseInt(pe[n],16),g[o]=[C>>16&255,C>>8&255,255&C]}return g}(),ye.transparent=[0,0,0,0]);const e=ye[g.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:4===e.length?e[3]:255}}const Se=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;const We=g=>g<=.0031308?12.92*g:1.055*Math.pow(g,1/2.4)-.055,Ve=g=>g<=.04045?g/12.92:Math.pow((g+.055)/1.055,2.4);function Re(g,e,t){if(g){let I=ue(g);I[e]=Math.max(0,Math.min(I[e]+I[e]*t,0===e?360:1)),I=be(I),g.r=I[0],g.g=I[1],g.b=I[2]}}function Xe(g,e){return g?Object.assign(e||{},g):g}function Je(g){var e={r:0,g:0,b:0,a:255};return Array.isArray(g)?g.length>=3&&(e={r:g[0],g:g[1],b:g[2],a:255},g.length>3&&(e.a=te(g[3]))):(e=Xe(g,{r:0,g:0,b:0,a:1})).a=te(e.a),e}function ke(g){return"r"===g.charAt(0)?function(g){const e=Se.exec(g);let t,I,l,C=255;if(e){if(e[7]!==t){const g=+e[7];C=e[8]?ee(g):ge(255*g,0,255)}return t=+e[1],I=+e[3],l=+e[5],t=255&(e[2]?ee(t):ge(t,0,255)),I=255&(e[4]?ee(I):ge(I,0,255)),l=255&(e[6]?ee(l):ge(l,0,255)),{r:t,g:I,b:l,a:C}}}(g):Ze(g)}class fe{constructor(g){if(g instanceof fe)return g;const e=typeof g;let t;"object"===e?t=Je(g):"string"===e&&(t=function(g){var e,t=g.length;return"#"===g[0]&&(4===t||5===t?e={r:255&17*Ce[g[1]],g:255&17*Ce[g[2]],b:255&17*Ce[g[3]],a:5===t?17*Ce[g[4]]:255}:7!==t&&9!==t||(e={r:Ce[g[1]]<<4|Ce[g[2]],g:Ce[g[3]]<<4|Ce[g[4]],b:Ce[g[5]]<<4|Ce[g[6]],a:9===t?Ce[g[7]]<<4|Ce[g[8]]:255})),e}(g)||Be(g)||ke(g)),this._rgb=t,this._valid=!!t}get valid(){return this._valid}get rgb(){var g=Xe(this._rgb);return g&&(g.a=Ie(g.a)),g}set rgb(g){this._rgb=Je(g)}rgbString(){return this._valid?(g=this._rgb)&&(g.a<255?"rgba(".concat(g.r,", ").concat(g.g,", ").concat(g.b,", ").concat(Ie(g.a),")"):"rgb(".concat(g.r,", ").concat(g.g,", ").concat(g.b,")")):void 0;var g}hexString(){return this._valid?se(this._rgb):void 0}hslString(){return this._valid?function(g){if(!g)return;const e=ue(g),t=e[0],I=le(e[1]),l=le(e[2]);return g.a<255?"hsla(".concat(t,", ").concat(I,"%, ").concat(l,"%, ").concat(Ie(g.a),")"):"hsl(".concat(t,", ").concat(I,"%, ").concat(l,"%)")}(this._rgb):void 0}mix(g,e){if(g){const t=this.rgb,I=g.rgb;let l;const C=e===l?.5:e,n=2*C-1,o=t.a-I.a,a=((n*o===-1?n:(n+o)/(1+n*o))+1)/2;l=1-a,t.r=255&a*t.r+l*I.r+.5,t.g=255&a*t.g+l*I.g+.5,t.b=255&a*t.b+l*I.b+.5,t.a=C*t.a+(1-C)*I.a,this.rgb=t}return this}interpolate(g,e){return g&&(this._rgb=function(g,e,t){const I=Ve(Ie(g.r)),l=Ve(Ie(g.g)),C=Ve(Ie(g.b));return{r:te(We(I+t*(Ve(Ie(e.r))-I))),g:te(We(l+t*(Ve(Ie(e.g))-l))),b:te(We(C+t*(Ve(Ie(e.b))-C))),a:g.a+t*(e.a-g.a)}}(this._rgb,g._rgb,e)),this}clone(){return new fe(this.rgb)}alpha(g){return this._rgb.a=te(g),this}clearer(g){return this._rgb.a*=1-g,this}greyscale(){const g=this._rgb,e=$g(.3*g.r+.59*g.g+.11*g.b);return g.r=g.g=g.b=e,this}opaquer(g){return this._rgb.a*=1+g,this}negate(){const g=this._rgb;return g.r=255-g.r,g.g=255-g.g,g.b=255-g.b,this}lighten(g){return Re(this._rgb,2,g),this}darken(g){return Re(this._rgb,2,-g),this}saturate(g){return Re(this._rgb,1,g),this}desaturate(g){return Re(this._rgb,1,-g),this}rotate(g){return function(g,e){var t=ue(g);t[0]=he(t[0]+e),t=be(t),g.r=t[0],g.g=t[1],g.b=t[2]}(this._rgb,g),this}}function ve(){}const Ye=(()=>{let g=0;return()=>g++})();function xe(g){return null===g||"undefined"===typeof g}function He(g){if(Array.isArray&&Array.isArray(g))return!0;const e=Object.prototype.toString.call(g);return"[object"===e.slice(0,7)&&"Array]"===e.slice(-6)}function Ne(g){return null!==g&&"[object Object]"===Object.prototype.toString.call(g)}function we(g){return("number"===typeof g||g instanceof Number)&&isFinite(+g)}function Fe(g,e){return we(g)?g:e}function Ke(g,e){return"undefined"===typeof g?e:g}const ze=(g,e)=>"string"===typeof g&&g.endsWith("%")?parseFloat(g)/100*e:+g;function Me(g,e,t){if(g&&"function"===typeof g.call)return g.apply(t,e)}function Ee(g,e,t,I){let l,C,n;if(He(g))if(C=g.length,I)for(l=C-1;l>=0;l--)e.call(t,g[l],l);else for(l=0;l<C;l++)e.call(t,g[l],l);else if(Ne(g))for(n=Object.keys(g),C=n.length,l=0;l<C;l++)e.call(t,g[n[l]],n[l])}function Qe(g,e){let t,I,l,C;if(!g||!e||g.length!==e.length)return!1;for(t=0,I=g.length;t<I;++t)if(l=g[t],C=e[t],l.datasetIndex!==C.datasetIndex||l.index!==C.index)return!1;return!0}function Ue(g){if(He(g))return g.map(Ue);if(Ne(g)){const e=Object.create(null),t=Object.keys(g),I=t.length;let l=0;for(;l<I;++l)e[t[l]]=Ue(g[t[l]]);return e}return g}function Le(g){return-1===["__proto__","prototype","constructor"].indexOf(g)}function je(g,e,t,I){if(!Le(g))return;const l=e[g],C=t[g];Ne(l)&&Ne(C)?De(l,C,I):e[g]=Ue(C)}function De(g,e,t){const I=He(e)?e:[e],l=I.length;if(!Ne(g))return g;const C=(t=t||{}).merger||je;let n;for(let o=0;o<l;++o){if(n=I[o],!Ne(n))continue;const e=Object.keys(n);for(let I=0,l=e.length;I<l;++I)C(e[I],g,n,t)}return g}function Te(g,e){return De(g,e,{merger:Pe})}function Pe(g,e,t){if(!Le(g))return;const I=e[g],l=t[g];Ne(I)&&Ne(l)?Te(I,l):Object.prototype.hasOwnProperty.call(e,g)||(e[g]=Ue(l))}const Oe={"":g=>g,x:g=>g.x,y:g=>g.y};function _e(g,e){const t=Oe[e]||(Oe[e]=function(g){const e=function(g){const e=g.split("."),t=[];let I="";for(const l of e)I+=l,I.endsWith("\\")?I=I.slice(0,-1)+".":(t.push(I),I="");return t}(g);return g=>{for(const t of e){if(""===t)break;g=g&&g[t]}return g}}(e));return t(g)}function qe(g){return g.charAt(0).toUpperCase()+g.slice(1)}const $e=g=>"undefined"!==typeof g,gt=g=>"function"===typeof g,et=(g,e)=>{if(g.size!==e.size)return!1;for(const t of g)if(!e.has(t))return!1;return!0};const tt=Math.PI,It=2*tt,lt=It+tt,Ct=Number.POSITIVE_INFINITY,nt=tt/180,ot=tt/2,at=tt/4,it=2*tt/3,st=Math.log10,ct=Math.sign;function dt(g,e,t){return Math.abs(g-e)<t}function At(g){const e=Math.round(g);g=dt(g,e,g/1e3)?e:g;const t=Math.pow(10,Math.floor(st(g))),I=g/t;return(I<=1?1:I<=2?2:I<=5?5:10)*t}function rt(g){return!isNaN(parseFloat(g))&&isFinite(g)}function ut(g,e,t){let I,l,C;for(I=0,l=g.length;I<l;I++)C=g[I][t],isNaN(C)||(e.min=Math.min(e.min,C),e.max=Math.max(e.max,C))}function mt(g){return g*(tt/180)}function bt(g){return g*(180/tt)}function ht(g){if(!we(g))return;let e=1,t=0;for(;Math.round(g*e)/e!==g;)e*=10,t++;return t}function Zt(g,e){const t=e.x-g.x,I=e.y-g.y,l=Math.sqrt(t*t+I*I);let C=Math.atan2(I,t);return C<-.5*tt&&(C+=It),{angle:C,distance:l}}function Gt(g,e){return Math.sqrt(Math.pow(e.x-g.x,2)+Math.pow(e.y-g.y,2))}function pt(g,e){return(g-e+lt)%It-tt}function yt(g){return(g%It+It)%It}function Bt(g,e,t,I){const l=yt(g),C=yt(e),n=yt(t),o=yt(C-l),a=yt(n-l),i=yt(l-C),s=yt(l-n);return l===C||l===n||I&&C===n||o>a&&i<s}function St(g,e,t){return Math.max(e,Math.min(t,g))}function Wt(g,e,t){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-6;return g>=Math.min(e,t)-I&&g<=Math.max(e,t)+I}function Vt(g,e,t){t=t||(t=>g[t]<e);let I,l=g.length-1,C=0;for(;l-C>1;)I=C+l>>1,t(I)?C=I:l=I;return{lo:C,hi:l}}const Rt=(g,e,t,I)=>Vt(g,t,I?I=>{const l=g[I][e];return l<t||l===t&&g[I+1][e]===t}:I=>g[I][e]<t),Xt=(g,e,t)=>Vt(g,t,(I=>g[I][e]>=t));const Jt=["push","pop","shift","splice","unshift"];function kt(g,e){const t=g._chartjs;if(!t)return;const I=t.listeners,l=I.indexOf(e);-1!==l&&I.splice(l,1),I.length>0||(Jt.forEach((e=>{delete g[e]})),delete g._chartjs)}function ft(g){const e=new Set(g);return e.size===g.length?g:Array.from(e)}const vt="undefined"===typeof window?function(g){return g()}:window.requestAnimationFrame;function Yt(g,e){let t=[],I=!1;return function(){for(var l=arguments.length,C=new Array(l),n=0;n<l;n++)C[n]=arguments[n];t=C,I||(I=!0,vt.call(window,(()=>{I=!1,g.apply(e,t)})))}}const xt=g=>"start"===g?"left":"end"===g?"right":"center",Ht=(g,e,t)=>"start"===g?e:"end"===g?t:(e+t)/2;function Nt(g,e,t){const I=e.length;let l=0,C=I;if(g._sorted){const{iScale:n,_parsed:o}=g,a=n.axis,{min:i,max:s,minDefined:c,maxDefined:d}=n.getUserBounds();c&&(l=St(Math.min(Rt(o,a,i).lo,t?I:Rt(e,a,n.getPixelForValue(i)).lo),0,I-1)),C=d?St(Math.max(Rt(o,n.axis,s,!0).hi+1,t?0:Rt(e,a,n.getPixelForValue(s),!0).hi+1),l,I)-l:I-l}return{start:l,count:C}}function wt(g){const{xScale:e,yScale:t,_scaleRanges:I}=g,l={xmin:e.min,xmax:e.max,ymin:t.min,ymax:t.max};if(!I)return g._scaleRanges=l,!0;const C=I.xmin!==e.min||I.xmax!==e.max||I.ymin!==t.min||I.ymax!==t.max;return Object.assign(I,l),C}const Ft=g=>0===g||1===g,Kt=(g,e,t)=>-Math.pow(2,10*(g-=1))*Math.sin((g-e)*It/t),zt=(g,e,t)=>Math.pow(2,-10*g)*Math.sin((g-e)*It/t)+1,Mt={linear:g=>g,easeInQuad:g=>g*g,easeOutQuad:g=>-g*(g-2),easeInOutQuad:g=>(g/=.5)<1?.5*g*g:-.5*(--g*(g-2)-1),easeInCubic:g=>g*g*g,easeOutCubic:g=>(g-=1)*g*g+1,easeInOutCubic:g=>(g/=.5)<1?.5*g*g*g:.5*((g-=2)*g*g+2),easeInQuart:g=>g*g*g*g,easeOutQuart:g=>-((g-=1)*g*g*g-1),easeInOutQuart:g=>(g/=.5)<1?.5*g*g*g*g:-.5*((g-=2)*g*g*g-2),easeInQuint:g=>g*g*g*g*g,easeOutQuint:g=>(g-=1)*g*g*g*g+1,easeInOutQuint:g=>(g/=.5)<1?.5*g*g*g*g*g:.5*((g-=2)*g*g*g*g+2),easeInSine:g=>1-Math.cos(g*ot),easeOutSine:g=>Math.sin(g*ot),easeInOutSine:g=>-.5*(Math.cos(tt*g)-1),easeInExpo:g=>0===g?0:Math.pow(2,10*(g-1)),easeOutExpo:g=>1===g?1:1-Math.pow(2,-10*g),easeInOutExpo:g=>Ft(g)?g:g<.5?.5*Math.pow(2,10*(2*g-1)):.5*(2-Math.pow(2,-10*(2*g-1))),easeInCirc:g=>g>=1?g:-(Math.sqrt(1-g*g)-1),easeOutCirc:g=>Math.sqrt(1-(g-=1)*g),easeInOutCirc:g=>(g/=.5)<1?-.5*(Math.sqrt(1-g*g)-1):.5*(Math.sqrt(1-(g-=2)*g)+1),easeInElastic:g=>Ft(g)?g:Kt(g,.075,.3),easeOutElastic:g=>Ft(g)?g:zt(g,.075,.3),easeInOutElastic(g){const e=.1125;return Ft(g)?g:g<.5?.5*Kt(2*g,e,.45):.5+.5*zt(2*g-1,e,.45)},easeInBack(g){const e=1.70158;return g*g*((e+1)*g-e)},easeOutBack(g){const e=1.70158;return(g-=1)*g*((e+1)*g+e)+1},easeInOutBack(g){let e=1.70158;return(g/=.5)<1?g*g*((1+(e*=1.525))*g-e)*.5:.5*((g-=2)*g*((1+(e*=1.525))*g+e)+2)},easeInBounce:g=>1-Mt.easeOutBounce(1-g),easeOutBounce(g){const e=7.5625,t=2.75;return g<1/t?e*g*g:g<2/t?e*(g-=1.5/t)*g+.75:g<2.5/t?e*(g-=2.25/t)*g+.9375:e*(g-=2.625/t)*g+.984375},easeInOutBounce:g=>g<.5?.5*Mt.easeInBounce(2*g):.5*Mt.easeOutBounce(2*g-1)+.5};function Et(g){if(g&&"object"===typeof g){const e=g.toString();return"[object CanvasPattern]"===e||"[object CanvasGradient]"===e}return!1}function Qt(g){return Et(g)?g:new fe(g)}function Ut(g){return Et(g)?g:new fe(g).saturate(.5).darken(.1).hexString()}const Lt=["x","y","borderWidth","radius","tension"],jt=["color","borderColor","backgroundColor"];const Dt=new Map;function Tt(g,e,t){return function(g,e){e=e||{};const t=g+JSON.stringify(e);let I=Dt.get(t);return I||(I=new Intl.NumberFormat(g,e),Dt.set(t,I)),I}(e,t).format(g)}const Pt={values:g=>He(g)?g:""+g,numeric(g,e,t){if(0===g)return"0";const I=this.chart.options.locale;let l,C=g;if(t.length>1){const e=Math.max(Math.abs(t[0].value),Math.abs(t[t.length-1].value));(e<1e-4||e>1e15)&&(l="scientific"),C=function(g,e){let t=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;Math.abs(t)>=1&&g!==Math.floor(g)&&(t=g-Math.floor(g));return t}(g,t)}const n=st(Math.abs(C)),o=isNaN(n)?1:Math.max(Math.min(-1*Math.floor(n),20),0),a={notation:l,minimumFractionDigits:o,maximumFractionDigits:o};return Object.assign(a,this.options.ticks.format),Tt(g,I,a)},logarithmic(g,e,t){if(0===g)return"0";const I=t[e].significand||g/Math.pow(10,Math.floor(st(g)));return[1,2,3,5,10,15].includes(I)||e>.8*t.length?Pt.numeric.call(this,g,e,t):""}};var Ot={formatters:Pt};const _t=Object.create(null),qt=Object.create(null);function $t(g,e){if(!e)return g;const t=e.split(".");for(let I=0,l=t.length;I<l;++I){const e=t[I];g=g[e]||(g[e]=Object.create(null))}return g}function gI(g,e,t){return"string"===typeof e?De($t(g,e),t):De($t(g,""),e)}class eI{constructor(g,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=g=>g.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(g,e)=>Ut(e.backgroundColor),this.hoverBorderColor=(g,e)=>Ut(e.borderColor),this.hoverColor=(g,e)=>Ut(e.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(g),this.apply(e)}set(g,e){return gI(this,g,e)}get(g){return $t(this,g)}describe(g,e){return gI(qt,g,e)}override(g,e){return gI(_t,g,e)}route(g,e,t,I){const l=$t(this,g),C=$t(this,t),n="_"+e;Object.defineProperties(l,{[n]:{value:l[e],writable:!0},[e]:{enumerable:!0,get(){const g=this[n],e=C[I];return Ne(g)?Object.assign({},e,g):Ke(g,e)},set(g){this[n]=g}}})}apply(g){g.forEach((g=>g(this)))}}var tI=new eI({_scriptable:g=>!g.startsWith("on"),_indexable:g=>"events"!==g,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[function(g){g.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),g.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:g=>"onProgress"!==g&&"onComplete"!==g&&"fn"!==g}),g.set("animations",{colors:{type:"color",properties:jt},numbers:{type:"number",properties:Lt}}),g.describe("animations",{_fallback:"animation"}),g.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:g=>0|g}}}})},function(g){g.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})},function(g){g.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(g,e)=>e.lineWidth,tickColor:(g,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Ot.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),g.route("scale.ticks","color","","color"),g.route("scale.grid","color","","borderColor"),g.route("scale.border","color","","borderColor"),g.route("scale.title","color","","color"),g.describe("scale",{_fallback:!1,_scriptable:g=>!g.startsWith("before")&&!g.startsWith("after")&&"callback"!==g&&"parser"!==g,_indexable:g=>"borderDash"!==g&&"tickBorderDash"!==g&&"dash"!==g}),g.describe("scales",{_fallback:"scale"}),g.describe("scale.ticks",{_scriptable:g=>"backdropPadding"!==g&&"callback"!==g,_indexable:g=>"backdropPadding"!==g})}]);function II(g,e,t,I,l){let C=e[l];return C||(C=e[l]=g.measureText(l).width,t.push(l)),C>I&&(I=C),I}function lI(g,e,t,I){let l=(I=I||{}).data=I.data||{},C=I.garbageCollect=I.garbageCollect||[];I.font!==e&&(l=I.data={},C=I.garbageCollect=[],I.font=e),g.save(),g.font=e;let n=0;const o=t.length;let a,i,s,c,d;for(a=0;a<o;a++)if(c=t[a],void 0===c||null===c||He(c)){if(He(c))for(i=0,s=c.length;i<s;i++)d=c[i],void 0===d||null===d||He(d)||(n=II(g,l,C,n,d))}else n=II(g,l,C,n,c);g.restore();const A=C.length/2;if(A>t.length){for(a=0;a<A;a++)delete l[C[a]];C.splice(0,A)}return n}function CI(g,e,t){const I=g.currentDevicePixelRatio,l=0!==t?Math.max(t/2,.5):0;return Math.round((e-l)*I)/I+l}function nI(g,e){(e=e||g.getContext("2d")).save(),e.resetTransform(),e.clearRect(0,0,g.width,g.height),e.restore()}function oI(g,e,t,I){aI(g,e,t,I,null)}function aI(g,e,t,I,l){let C,n,o,a,i,s,c,d;const A=e.pointStyle,r=e.rotation,u=e.radius;let m=(r||0)*nt;if(A&&"object"===typeof A&&(C=A.toString(),"[object HTMLImageElement]"===C||"[object HTMLCanvasElement]"===C))return g.save(),g.translate(t,I),g.rotate(m),g.drawImage(A,-A.width/2,-A.height/2,A.width,A.height),void g.restore();if(!(isNaN(u)||u<=0)){switch(g.beginPath(),A){default:l?g.ellipse(t,I,l/2,u,0,0,It):g.arc(t,I,u,0,It),g.closePath();break;case"triangle":s=l?l/2:u,g.moveTo(t+Math.sin(m)*s,I-Math.cos(m)*u),m+=it,g.lineTo(t+Math.sin(m)*s,I-Math.cos(m)*u),m+=it,g.lineTo(t+Math.sin(m)*s,I-Math.cos(m)*u),g.closePath();break;case"rectRounded":i=.516*u,a=u-i,n=Math.cos(m+at)*a,c=Math.cos(m+at)*(l?l/2-i:a),o=Math.sin(m+at)*a,d=Math.sin(m+at)*(l?l/2-i:a),g.arc(t-c,I-o,i,m-tt,m-ot),g.arc(t+d,I-n,i,m-ot,m),g.arc(t+c,I+o,i,m,m+ot),g.arc(t-d,I+n,i,m+ot,m+tt),g.closePath();break;case"rect":if(!r){a=Math.SQRT1_2*u,s=l?l/2:a,g.rect(t-s,I-a,2*s,2*a);break}m+=at;case"rectRot":c=Math.cos(m)*(l?l/2:u),n=Math.cos(m)*u,o=Math.sin(m)*u,d=Math.sin(m)*(l?l/2:u),g.moveTo(t-c,I-o),g.lineTo(t+d,I-n),g.lineTo(t+c,I+o),g.lineTo(t-d,I+n),g.closePath();break;case"crossRot":m+=at;case"cross":c=Math.cos(m)*(l?l/2:u),n=Math.cos(m)*u,o=Math.sin(m)*u,d=Math.sin(m)*(l?l/2:u),g.moveTo(t-c,I-o),g.lineTo(t+c,I+o),g.moveTo(t+d,I-n),g.lineTo(t-d,I+n);break;case"star":c=Math.cos(m)*(l?l/2:u),n=Math.cos(m)*u,o=Math.sin(m)*u,d=Math.sin(m)*(l?l/2:u),g.moveTo(t-c,I-o),g.lineTo(t+c,I+o),g.moveTo(t+d,I-n),g.lineTo(t-d,I+n),m+=at,c=Math.cos(m)*(l?l/2:u),n=Math.cos(m)*u,o=Math.sin(m)*u,d=Math.sin(m)*(l?l/2:u),g.moveTo(t-c,I-o),g.lineTo(t+c,I+o),g.moveTo(t+d,I-n),g.lineTo(t-d,I+n);break;case"line":n=l?l/2:Math.cos(m)*u,o=Math.sin(m)*u,g.moveTo(t-n,I-o),g.lineTo(t+n,I+o);break;case"dash":g.moveTo(t,I),g.lineTo(t+Math.cos(m)*(l?l/2:u),I+Math.sin(m)*u);break;case!1:g.closePath()}g.fill(),e.borderWidth>0&&g.stroke()}}function iI(g,e,t){return t=t||.5,!e||g&&g.x>e.left-t&&g.x<e.right+t&&g.y>e.top-t&&g.y<e.bottom+t}function sI(g,e){g.save(),g.beginPath(),g.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),g.clip()}function cI(g){g.restore()}function dI(g,e,t,I,l){if(!e)return g.lineTo(t.x,t.y);if("middle"===l){const I=(e.x+t.x)/2;g.lineTo(I,e.y),g.lineTo(I,t.y)}else"after"===l!==!!I?g.lineTo(e.x,t.y):g.lineTo(t.x,e.y);g.lineTo(t.x,t.y)}function AI(g,e,t,I){if(!e)return g.lineTo(t.x,t.y);g.bezierCurveTo(I?e.cp1x:e.cp2x,I?e.cp1y:e.cp2y,I?t.cp2x:t.cp1x,I?t.cp2y:t.cp1y,t.x,t.y)}function rI(g,e,t,I,l){if(l.strikethrough||l.underline){const C=g.measureText(I),n=e-C.actualBoundingBoxLeft,o=e+C.actualBoundingBoxRight,a=t-C.actualBoundingBoxAscent,i=t+C.actualBoundingBoxDescent,s=l.strikethrough?(a+i)/2:i;g.strokeStyle=g.fillStyle,g.beginPath(),g.lineWidth=l.decorationWidth||2,g.moveTo(n,s),g.lineTo(o,s),g.stroke()}}function uI(g,e){const t=g.fillStyle;g.fillStyle=e.color,g.fillRect(e.left,e.top,e.width,e.height),g.fillStyle=t}function mI(g,e,t,I,l){let C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const n=He(e)?e:[e],o=C.strokeWidth>0&&""!==C.strokeColor;let a,i;for(g.save(),g.font=l.string,function(g,e){e.translation&&g.translate(e.translation[0],e.translation[1]),xe(e.rotation)||g.rotate(e.rotation),e.color&&(g.fillStyle=e.color),e.textAlign&&(g.textAlign=e.textAlign),e.textBaseline&&(g.textBaseline=e.textBaseline)}(g,C),a=0;a<n.length;++a)i=n[a],C.backdrop&&uI(g,C.backdrop),o&&(C.strokeColor&&(g.strokeStyle=C.strokeColor),xe(C.strokeWidth)||(g.lineWidth=C.strokeWidth),g.strokeText(i,t,I,C.maxWidth)),g.fillText(i,t,I,C.maxWidth),rI(g,t,I,i,C),I+=Number(l.lineHeight);g.restore()}function bI(g,e){const{x:t,y:I,w:l,h:C,radius:n}=e;g.arc(t+n.topLeft,I+n.topLeft,n.topLeft,1.5*tt,tt,!0),g.lineTo(t,I+C-n.bottomLeft),g.arc(t+n.bottomLeft,I+C-n.bottomLeft,n.bottomLeft,tt,ot,!0),g.lineTo(t+l-n.bottomRight,I+C),g.arc(t+l-n.bottomRight,I+C-n.bottomRight,n.bottomRight,ot,0,!0),g.lineTo(t+l,I+n.topRight),g.arc(t+l-n.topRight,I+n.topRight,n.topRight,0,-ot,!0),g.lineTo(t+n.topLeft,I)}const hI=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,ZI=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function GI(g,e){const t=(""+g).match(hI);if(!t||"normal"===t[1])return 1.2*e;switch(g=+t[2],t[3]){case"px":return g;case"%":g/=100}return e*g}const pI=g=>+g||0;function yI(g,e){const t={},I=Ne(e),l=I?Object.keys(e):e,C=Ne(g)?I?t=>Ke(g[t],g[e[t]]):e=>g[e]:()=>g;for(const n of l)t[n]=pI(C(n));return t}function BI(g){return yI(g,{top:"y",right:"x",bottom:"y",left:"x"})}function SI(g){return yI(g,["topLeft","topRight","bottomLeft","bottomRight"])}function WI(g){const e=BI(g);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function VI(g,e){g=g||{},e=e||tI.font;let t=Ke(g.size,e.size);"string"===typeof t&&(t=parseInt(t,10));let I=Ke(g.style,e.style);I&&!(""+I).match(ZI)&&(console.warn('Invalid font style specified: "'+I+'"'),I=void 0);const l={family:Ke(g.family,e.family),lineHeight:GI(Ke(g.lineHeight,e.lineHeight),t),size:t,style:I,weight:Ke(g.weight,e.weight),string:""};return l.string=function(g){return!g||xe(g.size)||xe(g.family)?null:(g.style?g.style+" ":"")+(g.weight?g.weight+" ":"")+g.size+"px "+g.family}(l),l}function RI(g,e,t,I){let l,C,n,o=!0;for(l=0,C=g.length;l<C;++l)if(n=g[l],void 0!==n&&(void 0!==e&&"function"===typeof n&&(n=n(e),o=!1),void 0!==t&&He(n)&&(n=n[t%n.length],o=!1),void 0!==n))return I&&!o&&(I.cacheable=!1),n}function XI(g,e){return Object.assign(Object.create(g),e)}function JI(g){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[""],t=arguments.length>3?arguments[3]:void 0,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>g[0];const l=(arguments.length>2?arguments[2]:void 0)||g;"undefined"===typeof t&&(t=zI("_fallback",g));const C={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:g,_rootScopes:l,_fallback:t,_getTarget:I,override:I=>JI([I,...g],e,l,t)};return new Proxy(C,{deleteProperty:(e,t)=>(delete e[t],delete e._keys,delete g[0][t],!0),get:(t,I)=>xI(t,I,(()=>function(g,e,t,I){let l;for(const C of e)if(l=zI(vI(C,g),t),"undefined"!==typeof l)return YI(g,l)?FI(t,I,g,l):l}(I,e,g,t))),getOwnPropertyDescriptor:(g,e)=>Reflect.getOwnPropertyDescriptor(g._scopes[0],e),getPrototypeOf:()=>Reflect.getPrototypeOf(g[0]),has:(g,e)=>MI(g).includes(e),ownKeys:g=>MI(g),set(g,e,t){const l=g._storage||(g._storage=I());return g[e]=l[e]=t,delete g._keys,!0}})}function kI(g,e,t,I){const l={_cacheable:!1,_proxy:g,_context:e,_subProxy:t,_stack:new Set,_descriptors:fI(g,I),setContext:e=>kI(g,e,t,I),override:l=>kI(g.override(l),e,t,I)};return new Proxy(l,{deleteProperty:(e,t)=>(delete e[t],delete g[t],!0),get:(g,e,t)=>xI(g,e,(()=>function(g,e,t){const{_proxy:I,_context:l,_subProxy:C,_descriptors:n}=g;let o=I[e];gt(o)&&n.isScriptable(e)&&(o=function(g,e,t,I){const{_proxy:l,_context:C,_subProxy:n,_stack:o}=t;if(o.has(g))throw new Error("Recursion detected: "+Array.from(o).join("->")+"->"+g);o.add(g);let a=e(C,n||I);o.delete(g),YI(g,a)&&(a=FI(l._scopes,l,g,a));return a}(e,o,g,t));He(o)&&o.length&&(o=function(g,e,t,I){const{_proxy:l,_context:C,_subProxy:n,_descriptors:o}=t;if("undefined"!==typeof C.index&&I(g))return e[C.index%e.length];if(Ne(e[0])){const t=e,I=l._scopes.filter((g=>g!==t));e=[];for(const a of t){const t=FI(I,l,g,a);e.push(kI(t,C,n&&n[g],o))}}return e}(e,o,g,n.isIndexable));YI(e,o)&&(o=kI(o,l,C&&C[e],n));return o}(g,e,t))),getOwnPropertyDescriptor:(e,t)=>e._descriptors.allKeys?Reflect.has(g,t)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(g,t),getPrototypeOf:()=>Reflect.getPrototypeOf(g),has:(e,t)=>Reflect.has(g,t),ownKeys:()=>Reflect.ownKeys(g),set:(e,t,I)=>(g[t]=I,delete e[t],!0)})}function fI(g){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{scriptable:!0,indexable:!0};const{_scriptable:t=e.scriptable,_indexable:I=e.indexable,_allKeys:l=e.allKeys}=g;return{allKeys:l,scriptable:t,indexable:I,isScriptable:gt(t)?t:()=>t,isIndexable:gt(I)?I:()=>I}}const vI=(g,e)=>g?g+qe(e):e,YI=(g,e)=>Ne(e)&&"adapters"!==g&&(null===Object.getPrototypeOf(e)||e.constructor===Object);function xI(g,e,t){if(Object.prototype.hasOwnProperty.call(g,e))return g[e];const I=t();return g[e]=I,I}function HI(g,e,t){return gt(g)?g(e,t):g}const NI=(g,e)=>!0===g?e:"string"===typeof g?_e(e,g):void 0;function wI(g,e,t,I,l){for(const C of e){const e=NI(t,C);if(e){g.add(e);const C=HI(e._fallback,t,l);if("undefined"!==typeof C&&C!==t&&C!==I)return C}else if(!1===e&&"undefined"!==typeof I&&t!==I)return null}return!1}function FI(g,e,t,I){const l=e._rootScopes,C=HI(e._fallback,t,I),n=[...g,...l],o=new Set;o.add(I);let a=KI(o,n,t,C||t,I);return null!==a&&(("undefined"===typeof C||C===t||(a=KI(o,n,C,a,I),null!==a))&&JI(Array.from(o),[""],l,C,(()=>function(g,e,t){const I=g._getTarget();e in I||(I[e]={});const l=I[e];if(He(l)&&Ne(t))return t;return l||{}}(e,t,I))))}function KI(g,e,t,I,l){for(;t;)t=wI(g,e,t,I,l);return t}function zI(g,e){for(const t of e){if(!t)continue;const e=t[g];if("undefined"!==typeof e)return e}}function MI(g){let e=g._keys;return e||(e=g._keys=function(g){const e=new Set;for(const t of g)for(const g of Object.keys(t).filter((g=>!g.startsWith("_"))))e.add(g);return Array.from(e)}(g._scopes)),e}function EI(g,e,t,I){const{iScale:l}=g,{key:C="r"}=this._parsing,n=new Array(I);let o,a,i,s;for(o=0,a=I;o<a;++o)i=o+t,s=e[i],n[o]={r:l.parse(_e(s,C),i)};return n}const QI=Number.EPSILON||1e-14,UI=(g,e)=>e<g.length&&!g[e].skip&&g[e],LI=g=>"x"===g?"y":"x";function jI(g,e,t,I){const l=g.skip?e:g,C=e,n=t.skip?e:t,o=Gt(C,l),a=Gt(n,C);let i=o/(o+a),s=a/(o+a);i=isNaN(i)?0:i,s=isNaN(s)?0:s;const c=I*i,d=I*s;return{previous:{x:C.x-c*(n.x-l.x),y:C.y-c*(n.y-l.y)},next:{x:C.x+d*(n.x-l.x),y:C.y+d*(n.y-l.y)}}}function DI(g){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"x";const t=LI(e),I=g.length,l=Array(I).fill(0),C=Array(I);let n,o,a,i=UI(g,0);for(n=0;n<I;++n)if(o=a,a=i,i=UI(g,n+1),a){if(i){const g=i[e]-a[e];l[n]=0!==g?(i[t]-a[t])/g:0}C[n]=o?i?ct(l[n-1])!==ct(l[n])?0:(l[n-1]+l[n])/2:l[n-1]:l[n]}!function(g,e,t){const I=g.length;let l,C,n,o,a,i=UI(g,0);for(let s=0;s<I-1;++s)a=i,i=UI(g,s+1),a&&i&&(dt(e[s],0,QI)?t[s]=t[s+1]=0:(l=t[s]/e[s],C=t[s+1]/e[s],o=Math.pow(l,2)+Math.pow(C,2),o<=9||(n=3/Math.sqrt(o),t[s]=l*n*e[s],t[s+1]=C*n*e[s])))}(g,l,C),function(g,e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"x";const I=LI(t),l=g.length;let C,n,o,a=UI(g,0);for(let i=0;i<l;++i){if(n=o,o=a,a=UI(g,i+1),!o)continue;const l=o[t],s=o[I];n&&(C=(l-n[t])/3,o["cp1".concat(t)]=l-C,o["cp1".concat(I)]=s-C*e[i]),a&&(C=(a[t]-l)/3,o["cp2".concat(t)]=l+C,o["cp2".concat(I)]=s+C*e[i])}}(g,C,e)}function TI(g,e,t){return Math.max(Math.min(g,t),e)}function PI(g,e,t,I,l){let C,n,o,a;if(e.spanGaps&&(g=g.filter((g=>!g.skip))),"monotone"===e.cubicInterpolationMode)DI(g,l);else{let t=I?g[g.length-1]:g[0];for(C=0,n=g.length;C<n;++C)o=g[C],a=jI(t,o,g[Math.min(C+1,n-(I?0:1))%n],e.tension),o.cp1x=a.previous.x,o.cp1y=a.previous.y,o.cp2x=a.next.x,o.cp2y=a.next.y,t=o}e.capBezierPoints&&function(g,e){let t,I,l,C,n,o=iI(g[0],e);for(t=0,I=g.length;t<I;++t)n=C,C=o,o=t<I-1&&iI(g[t+1],e),C&&(l=g[t],n&&(l.cp1x=TI(l.cp1x,e.left,e.right),l.cp1y=TI(l.cp1y,e.top,e.bottom)),o&&(l.cp2x=TI(l.cp2x,e.left,e.right),l.cp2y=TI(l.cp2y,e.top,e.bottom)))}(g,t)}function OI(){return"undefined"!==typeof window&&"undefined"!==typeof document}function _I(g){let e=g.parentNode;return e&&"[object ShadowRoot]"===e.toString()&&(e=e.host),e}function qI(g,e,t){let I;return"string"===typeof g?(I=parseInt(g,10),-1!==g.indexOf("%")&&(I=I/100*e.parentNode[t])):I=g,I}const $I=g=>g.ownerDocument.defaultView.getComputedStyle(g,null);const gl=["top","right","bottom","left"];function el(g,e,t){const I={};t=t?"-"+t:"";for(let l=0;l<4;l++){const C=gl[l];I[C]=parseFloat(g[e+"-"+C+t])||0}return I.width=I.left+I.right,I.height=I.top+I.bottom,I}const tl=(g,e,t)=>(g>0||e>0)&&(!t||!t.shadowRoot);function Il(g,e){if("native"in g)return g;const{canvas:t,currentDevicePixelRatio:I}=e,l=$I(t),C="border-box"===l.boxSizing,n=el(l,"padding"),o=el(l,"border","width"),{x:a,y:i,box:s}=function(g,e){const t=g.touches,I=t&&t.length?t[0]:g,{offsetX:l,offsetY:C}=I;let n,o,a=!1;if(tl(l,C,g.target))n=l,o=C;else{const g=e.getBoundingClientRect();n=I.clientX-g.left,o=I.clientY-g.top,a=!0}return{x:n,y:o,box:a}}(g,t),c=n.left+(s&&o.left),d=n.top+(s&&o.top);let{width:A,height:r}=e;return C&&(A-=n.width+o.width,r-=n.height+o.height),{x:Math.round((a-c)/A*t.width/I),y:Math.round((i-d)/r*t.height/I)}}const ll=g=>Math.round(10*g)/10;function Cl(g,e,t,I){const l=$I(g),C=el(l,"margin"),n=qI(l.maxWidth,g,"clientWidth")||Ct,o=qI(l.maxHeight,g,"clientHeight")||Ct,a=function(g,e,t){let I,l;if(void 0===e||void 0===t){const C=_I(g);if(C){const g=C.getBoundingClientRect(),n=$I(C),o=el(n,"border","width"),a=el(n,"padding");e=g.width-a.width-o.width,t=g.height-a.height-o.height,I=qI(n.maxWidth,C,"clientWidth"),l=qI(n.maxHeight,C,"clientHeight")}else e=g.clientWidth,t=g.clientHeight}return{width:e,height:t,maxWidth:I||Ct,maxHeight:l||Ct}}(g,e,t);let{width:i,height:s}=a;if("content-box"===l.boxSizing){const g=el(l,"border","width"),e=el(l,"padding");i-=e.width+g.width,s-=e.height+g.height}i=Math.max(0,i-C.width),s=Math.max(0,I?i/I:s-C.height),i=ll(Math.min(i,n,a.maxWidth)),s=ll(Math.min(s,o,a.maxHeight)),i&&!s&&(s=ll(i/2));return(void 0!==e||void 0!==t)&&I&&a.height&&s>a.height&&(s=a.height,i=ll(Math.floor(s*I))),{width:i,height:s}}function nl(g,e,t){const I=e||1,l=Math.floor(g.height*I),C=Math.floor(g.width*I);g.height=Math.floor(g.height),g.width=Math.floor(g.width);const n=g.canvas;return n.style&&(t||!n.style.height&&!n.style.width)&&(n.style.height="".concat(g.height,"px"),n.style.width="".concat(g.width,"px")),(g.currentDevicePixelRatio!==I||n.height!==l||n.width!==C)&&(g.currentDevicePixelRatio=I,n.height=l,n.width=C,g.ctx.setTransform(I,0,0,I,0,0),!0)}const ol=function(){let g=!1;try{const e={get passive(){return g=!0,!1}};OI()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch(e){}return g}();function al(g,e){const t=function(g,e){return $I(g).getPropertyValue(e)}(g,e),I=t&&t.match(/^(\d+)(\.\d+)?px$/);return I?+I[1]:void 0}function il(g,e,t,I){return{x:g.x+t*(e.x-g.x),y:g.y+t*(e.y-g.y)}}function sl(g,e,t,I){return{x:g.x+t*(e.x-g.x),y:"middle"===I?t<.5?g.y:e.y:"after"===I?t<1?g.y:e.y:t>0?e.y:g.y}}function cl(g,e,t,I){const l={x:g.cp2x,y:g.cp2y},C={x:e.cp1x,y:e.cp1y},n=il(g,l,t),o=il(l,C,t),a=il(C,e,t),i=il(n,o,t),s=il(o,a,t);return il(i,s,t)}function dl(g,e,t){return g?function(g,e){return{x:t=>g+g+e-t,setWidth(g){e=g},textAlign:g=>"center"===g?g:"right"===g?"left":"right",xPlus:(g,e)=>g-e,leftForLtr:(g,e)=>g-e}}(e,t):{x:g=>g,setWidth(g){},textAlign:g=>g,xPlus:(g,e)=>g+e,leftForLtr:(g,e)=>g}}function Al(g,e){let t,I;"ltr"!==e&&"rtl"!==e||(t=g.canvas.style,I=[t.getPropertyValue("direction"),t.getPropertyPriority("direction")],t.setProperty("direction",e,"important"),g.prevTextDirection=I)}function rl(g,e){void 0!==e&&(delete g.prevTextDirection,g.canvas.style.setProperty("direction",e[0],e[1]))}function ul(g){return"angle"===g?{between:Bt,compare:pt,normalize:yt}:{between:Wt,compare:(g,e)=>g-e,normalize:g=>g}}function ml(g){let{start:e,end:t,count:I,loop:l,style:C}=g;return{start:e%I,end:t%I,loop:l&&(t-e+1)%I===0,style:C}}function bl(g,e,t){if(!t)return[g];const{property:I,start:l,end:C}=t,n=e.length,{compare:o,between:a,normalize:i}=ul(I),{start:s,end:c,loop:d,style:A}=function(g,e,t){const{property:I,start:l,end:C}=t,{between:n,normalize:o}=ul(I),a=e.length;let i,s,{start:c,end:d,loop:A}=g;if(A){for(c+=a,d+=a,i=0,s=a;i<s&&n(o(e[c%a][I]),l,C);++i)c--,d--;c%=a,d%=a}return d<c&&(d+=a),{start:c,end:d,loop:A,style:g.style}}(g,e,t),r=[];let u,m,b,h=!1,Z=null;const G=()=>h||a(l,b,u)&&0!==o(l,b),p=()=>!h||0===o(C,u)||a(C,b,u);for(let y=s,B=s;y<=c;++y)m=e[y%n],m.skip||(u=i(m[I]),u!==b&&(h=a(u,l,C),null===Z&&G()&&(Z=0===o(u,l)?y:B),null!==Z&&p()&&(r.push(ml({start:Z,end:y,loop:d,count:n,style:A})),Z=null),B=y,b=u));return null!==Z&&r.push(ml({start:Z,end:c,loop:d,count:n,style:A})),r}function hl(g,e){const t=[],I=g.segments;for(let l=0;l<I.length;l++){const C=bl(I[l],g.points,e);C.length&&t.push(...C)}return t}function Zl(g,e,t,I){return I&&I.setContext&&t?function(g,e,t,I){const l=g._chart.getContext(),C=Gl(g.options),{_datasetIndex:n,options:{spanGaps:o}}=g,a=t.length,i=[];let s=C,c=e[0].start,d=c;function A(g,e,I,l){const C=o?-1:1;if(g!==e){for(g+=a;t[g%a].skip;)g-=C;for(;t[e%a].skip;)e+=C;g%a!==e%a&&(i.push({start:g%a,end:e%a,loop:I,style:l}),s=l,c=e%a)}}for(const r of e){c=o?c:r.start;let g,e=t[c%a];for(d=c+1;d<=r.end;d++){const C=t[d%a];g=Gl(I.setContext(XI(l,{type:"segment",p0:e,p1:C,p0DataIndex:(d-1)%a,p1DataIndex:d%a,datasetIndex:n}))),pl(g,s)&&A(c,d-1,r.loop,s),e=C,s=g}c<d-1&&A(c,d-1,r.loop,s)}return i}(g,e,t,I):e}function Gl(g){return{backgroundColor:g.backgroundColor,borderCapStyle:g.borderCapStyle,borderDash:g.borderDash,borderDashOffset:g.borderDashOffset,borderJoinStyle:g.borderJoinStyle,borderWidth:g.borderWidth,borderColor:g.borderColor}}function pl(g,e){if(!e)return!1;const t=[],I=function(g,e){return Et(e)?(t.includes(e)||t.push(e),t.indexOf(e)):e};return JSON.stringify(g,I)!==JSON.stringify(e,I)}class yl{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(g,e,t,I){const l=e.listeners[I],C=e.duration;l.forEach((I=>I({chart:g,initial:e.initial,numSteps:C,currentStep:Math.min(t-e.start,C)})))}_refresh(){this._request||(this._running=!0,this._request=vt.call(window,(()=>{this._update(),this._request=null,this._running&&this._refresh()})))}_update(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),e=0;this._charts.forEach(((t,I)=>{if(!t.running||!t.items.length)return;const l=t.items;let C,n=l.length-1,o=!1;for(;n>=0;--n)C=l[n],C._active?(C._total>t.duration&&(t.duration=C._total),C.tick(g),o=!0):(l[n]=l[l.length-1],l.pop());o&&(I.draw(),this._notify(I,t,g,"progress")),l.length||(t.running=!1,this._notify(I,t,g,"complete"),t.initial=!1),e+=l.length})),this._lastDate=g,0===e&&(this._running=!1)}_getAnims(g){const e=this._charts;let t=e.get(g);return t||(t={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(g,t)),t}listen(g,e,t){this._getAnims(g).listeners[e].push(t)}add(g,e){e&&e.length&&this._getAnims(g).items.push(...e)}has(g){return this._getAnims(g).items.length>0}start(g){const e=this._charts.get(g);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce(((g,e)=>Math.max(g,e._duration)),0),this._refresh())}running(g){if(!this._running)return!1;const e=this._charts.get(g);return!!(e&&e.running&&e.items.length)}stop(g){const e=this._charts.get(g);if(!e||!e.items.length)return;const t=e.items;let I=t.length-1;for(;I>=0;--I)t[I].cancel();e.items=[],this._notify(g,e,Date.now(),"complete")}remove(g){return this._charts.delete(g)}}var Bl=new yl;const Sl="transparent",Wl={boolean:(g,e,t)=>t>.5?e:g,color(g,e,t){const I=Qt(g||Sl),l=I.valid&&Qt(e||Sl);return l&&l.valid?l.mix(I,t).hexString():e},number:(g,e,t)=>g+(e-g)*t};class Vl{constructor(g,e,t,I){const l=e[t];I=RI([g.to,I,l,g.from]);const C=RI([g.from,l,I]);this._active=!0,this._fn=g.fn||Wl[g.type||typeof C],this._easing=Mt[g.easing]||Mt.linear,this._start=Math.floor(Date.now()+(g.delay||0)),this._duration=this._total=Math.floor(g.duration),this._loop=!!g.loop,this._target=e,this._prop=t,this._from=C,this._to=I,this._promises=void 0}active(){return this._active}update(g,e,t){if(this._active){this._notify(!1);const I=this._target[this._prop],l=t-this._start,C=this._duration-l;this._start=t,this._duration=Math.floor(Math.max(C,g.duration)),this._total+=l,this._loop=!!g.loop,this._to=RI([g.to,e,I,g.from]),this._from=RI([g.from,I,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(g){const e=g-this._start,t=this._duration,I=this._prop,l=this._from,C=this._loop,n=this._to;let o;if(this._active=l!==n&&(C||e<t),!this._active)return this._target[I]=n,void this._notify(!0);e<0?this._target[I]=l:(o=e/t%2,o=C&&o>1?2-o:o,o=this._easing(Math.min(1,Math.max(0,o))),this._target[I]=this._fn(l,n,o))}wait(){const g=this._promises||(this._promises=[]);return new Promise(((e,t)=>{g.push({res:e,rej:t})}))}_notify(g){const e=g?"res":"rej",t=this._promises||[];for(let I=0;I<t.length;I++)t[I][e]()}}class Rl{constructor(g,e){this._chart=g,this._properties=new Map,this.configure(e)}configure(g){if(!Ne(g))return;const e=Object.keys(tI.animation),t=this._properties;Object.getOwnPropertyNames(g).forEach((I=>{const l=g[I];if(!Ne(l))return;const C={};for(const g of e)C[g]=l[g];(He(l.properties)&&l.properties||[I]).forEach((g=>{g!==I&&t.has(g)||t.set(g,C)}))}))}_animateOptions(g,e){const t=e.options,I=function(g,e){if(!e)return;let t=g.options;if(!t)return void(g.options=e);t.$shared&&(g.options=t=Object.assign({},t,{$shared:!1,$animations:{}}));return t}(g,t);if(!I)return[];const l=this._createAnimations(I,t);return t.$shared&&function(g,e){const t=[],I=Object.keys(e);for(let l=0;l<I.length;l++){const e=g[I[l]];e&&e.active()&&t.push(e.wait())}return Promise.all(t)}(g.options.$animations,t).then((()=>{g.options=t}),(()=>{})),l}_createAnimations(g,e){const t=this._properties,I=[],l=g.$animations||(g.$animations={}),C=Object.keys(e),n=Date.now();let o;for(o=C.length-1;o>=0;--o){const a=C[o];if("$"===a.charAt(0))continue;if("options"===a){I.push(...this._animateOptions(g,e));continue}const i=e[a];let s=l[a];const c=t.get(a);if(s){if(c&&s.active()){s.update(c,i,n);continue}s.cancel()}c&&c.duration?(l[a]=s=new Vl(c,g,a,i),I.push(s)):g[a]=i}return I}update(g,e){if(0===this._properties.size)return void Object.assign(g,e);const t=this._createAnimations(g,e);return t.length?(Bl.add(this._chart,t),!0):void 0}}function Xl(g,e){const t=g&&g.options||{},I=t.reverse,l=void 0===t.min?e:0,C=void 0===t.max?e:0;return{start:I?C:l,end:I?l:C}}function Jl(g,e){const t=[],I=g._getSortedDatasetMetas(e);let l,C;for(l=0,C=I.length;l<C;++l)t.push(I[l].index);return t}function kl(g,e,t){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const l=g.keys,C="single"===I.mode;let n,o,a,i;if(null!==e){for(n=0,o=l.length;n<o;++n){if(a=+l[n],a===t){if(I.all)continue;break}i=g.values[a],we(i)&&(C||0===e||ct(e)===ct(i))&&(e+=i)}return e}}function fl(g,e){const t=g&&g.options.stacked;return t||void 0===t&&void 0!==e.stack}function vl(g,e,t){const I=g[e]||(g[e]={});return I[t]||(I[t]={})}function Yl(g,e,t,I){for(const l of e.getMatchingVisibleMetas(I).reverse()){const e=g[l.index];if(t&&e>0||!t&&e<0)return l.index}return null}function xl(g,e){const{chart:t,_cachedMeta:I}=g,l=t._stacks||(t._stacks={}),{iScale:C,vScale:n,index:o}=I,a=C.axis,i=n.axis,s=function(g,e,t){return"".concat(g.id,".").concat(e.id,".").concat(t.stack||t.type)}(C,n,I),c=e.length;let d;for(let A=0;A<c;++A){const g=e[A],{[a]:t,[i]:C}=g;d=(g._stacks||(g._stacks={}))[i]=vl(l,s,t),d[o]=C,d._top=Yl(d,n,!0,I.type),d._bottom=Yl(d,n,!1,I.type);(d._visualValues||(d._visualValues={}))[o]=C}}function Hl(g,e){const t=g.scales;return Object.keys(t).filter((g=>t[g].axis===e)).shift()}function Nl(g,e){const t=g.controller.index,I=g.vScale&&g.vScale.axis;if(I){e=e||g._parsed;for(const g of e){const e=g._stacks;if(!e||void 0===e[I]||void 0===e[I][t])return;delete e[I][t],void 0!==e[I]._visualValues&&void 0!==e[I]._visualValues[t]&&delete e[I]._visualValues[t]}}}const wl=g=>"reset"===g||"none"===g,Fl=(g,e)=>e?g:Object.assign({},g);class Kl{constructor(g,e){this.chart=g,this._ctx=g.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const g=this._cachedMeta;this.configure(),this.linkScales(),g._stacked=fl(g.vScale,g),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(g){this.index!==g&&Nl(this._cachedMeta),this.index=g}linkScales(){const g=this.chart,e=this._cachedMeta,t=this.getDataset(),I=(g,e,t,I)=>"x"===g?e:"r"===g?I:t,l=e.xAxisID=Ke(t.xAxisID,Hl(g,"x")),C=e.yAxisID=Ke(t.yAxisID,Hl(g,"y")),n=e.rAxisID=Ke(t.rAxisID,Hl(g,"r")),o=e.indexAxis,a=e.iAxisID=I(o,l,C,n),i=e.vAxisID=I(o,C,l,n);e.xScale=this.getScaleForId(l),e.yScale=this.getScaleForId(C),e.rScale=this.getScaleForId(n),e.iScale=this.getScaleForId(a),e.vScale=this.getScaleForId(i)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(g){return this.chart.scales[g]}_getOtherScale(g){const e=this._cachedMeta;return g===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const g=this._cachedMeta;this._data&&kt(this._data,this),g._stacked&&Nl(g)}_dataCheck(){const g=this.getDataset(),e=g.data||(g.data=[]),t=this._data;if(Ne(e))this._data=function(g){const e=Object.keys(g),t=new Array(e.length);let I,l,C;for(I=0,l=e.length;I<l;++I)C=e[I],t[I]={x:C,y:g[C]};return t}(e);else if(t!==e){if(t){kt(t,this);const g=this._cachedMeta;Nl(g),g._parsed=[]}e&&Object.isExtensible(e)&&(l=this,(I=e)._chartjs?I._chartjs.listeners.push(l):(Object.defineProperty(I,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[l]}}),Jt.forEach((g=>{const e="_onData"+qe(g),t=I[g];Object.defineProperty(I,g,{configurable:!0,enumerable:!1,value(){for(var g=arguments.length,l=new Array(g),C=0;C<g;C++)l[C]=arguments[C];const n=t.apply(this,l);return I._chartjs.listeners.forEach((g=>{"function"===typeof g[e]&&g[e](...l)})),n}})})))),this._syncList=[],this._data=e}var I,l}addElements(){const g=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(g.dataset=new this.datasetElementType)}buildOrUpdateElements(g){const e=this._cachedMeta,t=this.getDataset();let I=!1;this._dataCheck();const l=e._stacked;e._stacked=fl(e.vScale,e),e.stack!==t.stack&&(I=!0,Nl(e),e.stack=t.stack),this._resyncElements(g),(I||l!==e._stacked)&&xl(this,e._parsed)}configure(){const g=this.chart.config,e=g.datasetScopeKeys(this._type),t=g.getOptionScopes(this.getDataset(),e,!0);this.options=g.createResolver(t,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(g,e){const{_cachedMeta:t,_data:I}=this,{iScale:l,_stacked:C}=t,n=l.axis;let o,a,i,s=0===g&&e===I.length||t._sorted,c=g>0&&t._parsed[g-1];if(!1===this._parsing)t._parsed=I,t._sorted=!0,i=I;else{i=He(I[g])?this.parseArrayData(t,I,g,e):Ne(I[g])?this.parseObjectData(t,I,g,e):this.parsePrimitiveData(t,I,g,e);const l=()=>null===a[n]||c&&a[n]<c[n];for(o=0;o<e;++o)t._parsed[o+g]=a=i[o],s&&(l()&&(s=!1),c=a);t._sorted=s}C&&xl(this,i)}parsePrimitiveData(g,e,t,I){const{iScale:l,vScale:C}=g,n=l.axis,o=C.axis,a=l.getLabels(),i=l===C,s=new Array(I);let c,d,A;for(c=0,d=I;c<d;++c)A=c+t,s[c]={[n]:i||l.parse(a[A],A),[o]:C.parse(e[A],A)};return s}parseArrayData(g,e,t,I){const{xScale:l,yScale:C}=g,n=new Array(I);let o,a,i,s;for(o=0,a=I;o<a;++o)i=o+t,s=e[i],n[o]={x:l.parse(s[0],i),y:C.parse(s[1],i)};return n}parseObjectData(g,e,t,I){const{xScale:l,yScale:C}=g,{xAxisKey:n="x",yAxisKey:o="y"}=this._parsing,a=new Array(I);let i,s,c,d;for(i=0,s=I;i<s;++i)c=i+t,d=e[c],a[i]={x:l.parse(_e(d,n),c),y:C.parse(_e(d,o),c)};return a}getParsed(g){return this._cachedMeta._parsed[g]}getDataElement(g){return this._cachedMeta.data[g]}applyStack(g,e,t){const I=this.chart,l=this._cachedMeta,C=e[g.axis];return kl({keys:Jl(I,!0),values:e._stacks[g.axis]._visualValues},C,l.index,{mode:t})}updateRangeFromParsed(g,e,t,I){const l=t[e.axis];let C=null===l?NaN:l;const n=I&&t._stacks[e.axis];I&&n&&(I.values=n,C=kl(I,l,this._cachedMeta.index)),g.min=Math.min(g.min,C),g.max=Math.max(g.max,C)}getMinMax(g,e){const t=this._cachedMeta,I=t._parsed,l=t._sorted&&g===t.iScale,C=I.length,n=this._getOtherScale(g),o=((g,e,t)=>g&&!e.hidden&&e._stacked&&{keys:Jl(t,!0),values:null})(e,t,this.chart),a={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:i,max:s}=function(g){const{min:e,max:t,minDefined:I,maxDefined:l}=g.getUserBounds();return{min:I?e:Number.NEGATIVE_INFINITY,max:l?t:Number.POSITIVE_INFINITY}}(n);let c,d;function A(){d=I[c];const e=d[n.axis];return!we(d[g.axis])||i>e||s<e}for(c=0;c<C&&(A()||(this.updateRangeFromParsed(a,g,d,o),!l));++c);if(l)for(c=C-1;c>=0;--c)if(!A()){this.updateRangeFromParsed(a,g,d,o);break}return a}getAllParsedValues(g){const e=this._cachedMeta._parsed,t=[];let I,l,C;for(I=0,l=e.length;I<l;++I)C=e[I][g.axis],we(C)&&t.push(C);return t}getMaxOverflow(){return!1}getLabelAndValue(g){const e=this._cachedMeta,t=e.iScale,I=e.vScale,l=this.getParsed(g);return{label:t?""+t.getLabelForValue(l[t.axis]):"",value:I?""+I.getLabelForValue(l[I.axis]):""}}_update(g){const e=this._cachedMeta;this.update(g||"default"),e._clip=function(g){let e,t,I,l;return Ne(g)?(e=g.top,t=g.right,I=g.bottom,l=g.left):e=t=I=l=g,{top:e,right:t,bottom:I,left:l,disabled:!1===g}}(Ke(this.options.clip,function(g,e,t){if(!1===t)return!1;const I=Xl(g,t),l=Xl(e,t);return{top:l.end,right:I.end,bottom:l.start,left:I.start}}(e.xScale,e.yScale,this.getMaxOverflow())))}update(g){}draw(){const g=this._ctx,e=this.chart,t=this._cachedMeta,I=t.data||[],l=e.chartArea,C=[],n=this._drawStart||0,o=this._drawCount||I.length-n,a=this.options.drawActiveElementsOnTop;let i;for(t.dataset&&t.dataset.draw(g,l,n,o),i=n;i<n+o;++i){const e=I[i];e.hidden||(e.active&&a?C.push(e):e.draw(g,l))}for(i=0;i<C.length;++i)C[i].draw(g,l)}getStyle(g,e){const t=e?"active":"default";return void 0===g&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(t):this.resolveDataElementOptions(g||0,t)}getContext(g,e,t){const I=this.getDataset();let l;if(g>=0&&g<this._cachedMeta.data.length){const e=this._cachedMeta.data[g];l=e.$context||(e.$context=function(g,e,t){return XI(g,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:t,index:e,mode:"default",type:"data"})}(this.getContext(),g,e)),l.parsed=this.getParsed(g),l.raw=I.data[g],l.index=l.dataIndex=g}else l=this.$context||(this.$context=function(g,e){return XI(g,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),l.dataset=I,l.index=l.datasetIndex=this.index;return l.active=!!e,l.mode=t,l}resolveDatasetElementOptions(g){return this._resolveElementOptions(this.datasetElementType.id,g)}resolveDataElementOptions(g,e){return this._resolveElementOptions(this.dataElementType.id,e,g)}_resolveElementOptions(g){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",t=arguments.length>2?arguments[2]:void 0;const I="active"===e,l=this._cachedDataOpts,C=g+"-"+e,n=l[C],o=this.enableOptionSharing&&$e(t);if(n)return Fl(n,o);const a=this.chart.config,i=a.datasetElementScopeKeys(this._type,g),s=I?["".concat(g,"Hover"),"hover",g,""]:[g,""],c=a.getOptionScopes(this.getDataset(),i),d=Object.keys(tI.elements[g]),A=a.resolveNamedOptions(c,d,(()=>this.getContext(t,I,e)),s);return A.$shared&&(A.$shared=o,l[C]=Object.freeze(Fl(A,o))),A}_resolveAnimations(g,e,t){const I=this.chart,l=this._cachedDataOpts,C="animation-".concat(e),n=l[C];if(n)return n;let o;if(!1!==I.options.animation){const I=this.chart.config,l=I.datasetAnimationScopeKeys(this._type,e),C=I.getOptionScopes(this.getDataset(),l);o=I.createResolver(C,this.getContext(g,t,e))}const a=new Rl(I,o&&o.animations);return o&&o._cacheable&&(l[C]=Object.freeze(a)),a}getSharedOptions(g){if(g.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},g))}includeOptions(g,e){return!e||wl(g)||this.chart._animationsDisabled}_getSharedOptions(g,e){const t=this.resolveDataElementOptions(g,e),I=this._sharedOptions,l=this.getSharedOptions(t),C=this.includeOptions(e,l)||l!==I;return this.updateSharedOptions(l,e,t),{sharedOptions:l,includeOptions:C}}updateElement(g,e,t,I){wl(I)?Object.assign(g,t):this._resolveAnimations(e,I).update(g,t)}updateSharedOptions(g,e,t){g&&!wl(e)&&this._resolveAnimations(void 0,e).update(g,t)}_setStyle(g,e,t,I){g.active=I;const l=this.getStyle(e,I);this._resolveAnimations(e,t,I).update(g,{options:!I&&this.getSharedOptions(l)||l})}removeHoverStyle(g,e,t){this._setStyle(g,t,"active",!1)}setHoverStyle(g,e,t){this._setStyle(g,t,"active",!0)}_removeDatasetHoverStyle(){const g=this._cachedMeta.dataset;g&&this._setStyle(g,void 0,"active",!1)}_setDatasetHoverStyle(){const g=this._cachedMeta.dataset;g&&this._setStyle(g,void 0,"active",!0)}_resyncElements(g){const e=this._data,t=this._cachedMeta.data;for(const[n,o,a]of this._syncList)this[n](o,a);this._syncList=[];const I=t.length,l=e.length,C=Math.min(l,I);C&&this.parse(0,C),l>I?this._insertElements(I,l-I,g):l<I&&this._removeElements(l,I-l)}_insertElements(g,e){let t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const I=this._cachedMeta,l=I.data,C=g+e;let n;const o=g=>{for(g.length+=e,n=g.length-1;n>=C;n--)g[n]=g[n-e]};for(o(l),n=g;n<C;++n)l[n]=new this.dataElementType;this._parsing&&o(I._parsed),this.parse(g,e),t&&this.updateElements(l,g,e,"reset")}updateElements(g,e,t,I){}_removeElements(g,e){const t=this._cachedMeta;if(this._parsing){const I=t._parsed.splice(g,e);t._stacked&&Nl(t,I)}t.data.splice(g,e)}_sync(g){if(this._parsing)this._syncList.push(g);else{const[e,t,I]=g;this[e](t,I)}this.chart._dataChanges.push([this.index,...g])}_onDataPush(){const g=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-g,g])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(g,e){e&&this._sync(["_removeElements",g,e]);const t=arguments.length-2;t&&this._sync(["_insertElements",g,t])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function zl(g){const e=g.iScale,t=function(g,e){if(!g._cache.$bar){const t=g.getMatchingVisibleMetas(e);let I=[];for(let e=0,l=t.length;e<l;e++)I=I.concat(t[e].controller.getAllParsedValues(g));g._cache.$bar=ft(I.sort(((g,e)=>g-e)))}return g._cache.$bar}(e,g.type);let I,l,C,n,o=e._length;const a=()=>{32767!==C&&-32768!==C&&($e(n)&&(o=Math.min(o,Math.abs(C-n)||o)),n=C)};for(I=0,l=t.length;I<l;++I)C=e.getPixelForValue(t[I]),a();for(n=void 0,I=0,l=e.ticks.length;I<l;++I)C=e.getPixelForTick(I),a();return o}function Ml(g,e,t,I){return He(g)?function(g,e,t,I){const l=t.parse(g[0],I),C=t.parse(g[1],I),n=Math.min(l,C),o=Math.max(l,C);let a=n,i=o;Math.abs(n)>Math.abs(o)&&(a=o,i=n),e[t.axis]=i,e._custom={barStart:a,barEnd:i,start:l,end:C,min:n,max:o}}(g,e,t,I):e[t.axis]=t.parse(g,I),e}function El(g,e,t,I){const l=g.iScale,C=g.vScale,n=l.getLabels(),o=l===C,a=[];let i,s,c,d;for(i=t,s=t+I;i<s;++i)d=e[i],c={},c[l.axis]=o||l.parse(n[i],i),a.push(Ml(d,c,C,i));return a}function Ql(g){return g&&void 0!==g.barStart&&void 0!==g.barEnd}function Ul(g,e,t,I){let l=e.borderSkipped;const C={};if(!l)return void(g.borderSkipped=C);if(!0===l)return void(g.borderSkipped={top:!0,right:!0,bottom:!0,left:!0});const{start:n,end:o,reverse:a,top:i,bottom:s}=function(g){let e,t,I,l,C;return g.horizontal?(e=g.base>g.x,t="left",I="right"):(e=g.base<g.y,t="bottom",I="top"),e?(l="end",C="start"):(l="start",C="end"),{start:t,end:I,reverse:e,top:l,bottom:C}}(g);"middle"===l&&t&&(g.enableBorderRadius=!0,(t._top||0)===I?l=i:(t._bottom||0)===I?l=s:(C[Ll(s,n,o,a)]=!0,l=i)),C[Ll(l,n,o,a)]=!0,g.borderSkipped=C}function Ll(g,e,t,I){var l,C,n;return I?(n=t,g=jl(g=(l=g)===(C=e)?n:l===n?C:l,t,e)):g=jl(g,e,t),g}function jl(g,e,t){return"start"===g?e:"end"===g?t:g}function Dl(g,e,t){let{inflateAmount:I}=e;g.inflateAmount="auto"===I?1===t?.33:0:I}qg(Kl,"defaults",{}),qg(Kl,"datasetElementType",null),qg(Kl,"dataElementType",null);class Tl extends Kl{parsePrimitiveData(g,e,t,I){return El(g,e,t,I)}parseArrayData(g,e,t,I){return El(g,e,t,I)}parseObjectData(g,e,t,I){const{iScale:l,vScale:C}=g,{xAxisKey:n="x",yAxisKey:o="y"}=this._parsing,a="x"===l.axis?n:o,i="x"===C.axis?n:o,s=[];let c,d,A,r;for(c=t,d=t+I;c<d;++c)r=e[c],A={},A[l.axis]=l.parse(_e(r,a),c),s.push(Ml(_e(r,i),A,C,c));return s}updateRangeFromParsed(g,e,t,I){super.updateRangeFromParsed(g,e,t,I);const l=t._custom;l&&e===this._cachedMeta.vScale&&(g.min=Math.min(g.min,l.min),g.max=Math.max(g.max,l.max))}getMaxOverflow(){return 0}getLabelAndValue(g){const e=this._cachedMeta,{iScale:t,vScale:I}=e,l=this.getParsed(g),C=l._custom,n=Ql(C)?"["+C.start+", "+C.end+"]":""+I.getLabelForValue(l[I.axis]);return{label:""+t.getLabelForValue(l[t.axis]),value:n}}initialize(){this.enableOptionSharing=!0,super.initialize();this._cachedMeta.stack=this.getDataset().stack}update(g){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,g)}updateElements(g,e,t,I){const l="reset"===I,{index:C,_cachedMeta:{vScale:n}}=this,o=n.getBasePixel(),a=n.isHorizontal(),i=this._getRuler(),{sharedOptions:s,includeOptions:c}=this._getSharedOptions(e,I);for(let d=e;d<e+t;d++){const e=this.getParsed(d),t=l||xe(e[n.axis])?{base:o,head:o}:this._calculateBarValuePixels(d),A=this._calculateBarIndexPixels(d,i),r=(e._stacks||{})[n.axis],u={horizontal:a,base:t.base,enableBorderRadius:!r||Ql(e._custom)||C===r._top||C===r._bottom,x:a?t.head:A.center,y:a?A.center:t.head,height:a?A.size:Math.abs(t.size),width:a?Math.abs(t.size):A.size};c&&(u.options=s||this.resolveDataElementOptions(d,g[d].active?"active":I));const m=u.options||g[d].options;Ul(u,m,r,C),Dl(u,m,i.ratio),this.updateElement(g[d],d,u,I)}}_getStacks(g,e){const{iScale:t}=this._cachedMeta,I=t.getMatchingVisibleMetas(this._type).filter((g=>g.controller.options.grouped)),l=t.options.stacked,C=[],n=g=>{const t=g.controller.getParsed(e),I=t&&t[g.vScale.axis];if(xe(I)||isNaN(I))return!0};for(const o of I)if((void 0===e||!n(o))&&((!1===l||-1===C.indexOf(o.stack)||void 0===l&&void 0===o.stack)&&C.push(o.stack),o.index===g))break;return C.length||C.push(void 0),C}_getStackCount(g){return this._getStacks(void 0,g).length}_getStackIndex(g,e,t){const I=this._getStacks(g,t),l=void 0!==e?I.indexOf(e):-1;return-1===l?I.length-1:l}_getRuler(){const g=this.options,e=this._cachedMeta,t=e.iScale,I=[];let l,C;for(l=0,C=e.data.length;l<C;++l)I.push(t.getPixelForValue(this.getParsed(l)[t.axis],l));const n=g.barThickness;return{min:n||zl(e),pixels:I,start:t._startPixel,end:t._endPixel,stackCount:this._getStackCount(),scale:t,grouped:g.grouped,ratio:n?1:g.categoryPercentage*g.barPercentage}}_calculateBarValuePixels(g){const{_cachedMeta:{vScale:e,_stacked:t,index:I},options:{base:l,minBarLength:C}}=this,n=l||0,o=this.getParsed(g),a=o._custom,i=Ql(a);let s,c,d=o[e.axis],A=0,r=t?this.applyStack(e,o,t):d;r!==d&&(A=r-d,r=d),i&&(d=a.barStart,r=a.barEnd-a.barStart,0!==d&&ct(d)!==ct(a.barEnd)&&(A=0),A+=d);const u=xe(l)||i?A:l;let m=e.getPixelForValue(u);if(s=this.chart.getDataVisibility(g)?e.getPixelForValue(A+r):m,c=s-m,Math.abs(c)<C){c=function(g,e,t){return 0!==g?ct(g):(e.isHorizontal()?1:-1)*(e.min>=t?1:-1)}(c,e,n)*C,d===n&&(m-=c/2);const g=e.getPixelForDecimal(0),l=e.getPixelForDecimal(1),a=Math.min(g,l),A=Math.max(g,l);m=Math.max(Math.min(m,A),a),s=m+c,t&&!i&&(o._stacks[e.axis]._visualValues[I]=e.getValueForPixel(s)-e.getValueForPixel(m))}if(m===e.getPixelForValue(n)){const g=ct(c)*e.getLineWidthForValue(n)/2;m+=g,c-=g}return{size:c,base:m,head:s,center:s+c/2}}_calculateBarIndexPixels(g,e){const t=e.scale,I=this.options,l=I.skipNull,C=Ke(I.maxBarThickness,1/0);let n,o;if(e.grouped){const t=l?this._getStackCount(g):e.stackCount,a="flex"===I.barThickness?function(g,e,t,I){const l=e.pixels,C=l[g];let n=g>0?l[g-1]:null,o=g<l.length-1?l[g+1]:null;const a=t.categoryPercentage;null===n&&(n=C-(null===o?e.end-e.start:o-C)),null===o&&(o=C+C-n);const i=C-(C-Math.min(n,o))/2*a;return{chunk:Math.abs(o-n)/2*a/I,ratio:t.barPercentage,start:i}}(g,e,I,t):function(g,e,t,I){const l=t.barThickness;let C,n;return xe(l)?(C=e.min*t.categoryPercentage,n=t.barPercentage):(C=l*I,n=1),{chunk:C/I,ratio:n,start:e.pixels[g]-C/2}}(g,e,I,t),i=this._getStackIndex(this.index,this._cachedMeta.stack,l?g:void 0);n=a.start+a.chunk*i+a.chunk/2,o=Math.min(C,a.chunk*a.ratio)}else n=t.getPixelForValue(this.getParsed(g)[t.axis],g),o=Math.min(C,e.min*e.ratio);return{base:n-o/2,head:n+o/2,center:n,size:o}}draw(){const g=this._cachedMeta,e=g.vScale,t=g.data,I=t.length;let l=0;for(;l<I;++l)null!==this.getParsed(l)[e.axis]&&t[l].draw(this._ctx)}}qg(Tl,"id","bar"),qg(Tl,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),qg(Tl,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class Pl extends Kl{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(g,e,t,I){const l=super.parsePrimitiveData(g,e,t,I);for(let C=0;C<l.length;C++)l[C]._custom=this.resolveDataElementOptions(C+t).radius;return l}parseArrayData(g,e,t,I){const l=super.parseArrayData(g,e,t,I);for(let C=0;C<l.length;C++){const g=e[t+C];l[C]._custom=Ke(g[2],this.resolveDataElementOptions(C+t).radius)}return l}parseObjectData(g,e,t,I){const l=super.parseObjectData(g,e,t,I);for(let C=0;C<l.length;C++){const g=e[t+C];l[C]._custom=Ke(g&&g.r&&+g.r,this.resolveDataElementOptions(C+t).radius)}return l}getMaxOverflow(){const g=this._cachedMeta.data;let e=0;for(let t=g.length-1;t>=0;--t)e=Math.max(e,g[t].size(this.resolveDataElementOptions(t))/2);return e>0&&e}getLabelAndValue(g){const e=this._cachedMeta,t=this.chart.data.labels||[],{xScale:I,yScale:l}=e,C=this.getParsed(g),n=I.getLabelForValue(C.x),o=l.getLabelForValue(C.y),a=C._custom;return{label:t[g]||"",value:"("+n+", "+o+(a?", "+a:"")+")"}}update(g){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,g)}updateElements(g,e,t,I){const l="reset"===I,{iScale:C,vScale:n}=this._cachedMeta,{sharedOptions:o,includeOptions:a}=this._getSharedOptions(e,I),i=C.axis,s=n.axis;for(let c=e;c<e+t;c++){const e=g[c],t=!l&&this.getParsed(c),d={},A=d[i]=l?C.getPixelForDecimal(.5):C.getPixelForValue(t[i]),r=d[s]=l?n.getBasePixel():n.getPixelForValue(t[s]);d.skip=isNaN(A)||isNaN(r),a&&(d.options=o||this.resolveDataElementOptions(c,e.active?"active":I),l&&(d.options.radius=0)),this.updateElement(e,c,d,I)}}resolveDataElementOptions(g,e){const t=this.getParsed(g);let I=super.resolveDataElementOptions(g,e);I.$shared&&(I=Object.assign({},I,{$shared:!1}));const l=I.radius;return"active"!==e&&(I.radius=0),I.radius+=Ke(t&&t._custom,l),I}}qg(Pl,"id","bubble"),qg(Pl,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),qg(Pl,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});class Ol extends Kl{constructor(g,e){super(g,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(g,e){const t=this.getDataset().data,I=this._cachedMeta;if(!1===this._parsing)I._parsed=t;else{let l,C,n=g=>+t[g];if(Ne(t[g])){const{key:g="value"}=this._parsing;n=e=>+_e(t[e],g)}for(l=g,C=g+e;l<C;++l)I._parsed[l]=n(l)}}_getRotation(){return mt(this.options.rotation-90)}_getCircumference(){return mt(this.options.circumference)}_getRotationExtents(){let g=It,e=-It;for(let t=0;t<this.chart.data.datasets.length;++t)if(this.chart.isDatasetVisible(t)&&this.chart.getDatasetMeta(t).type===this._type){const I=this.chart.getDatasetMeta(t).controller,l=I._getRotation(),C=I._getCircumference();g=Math.min(g,l),e=Math.max(e,l+C)}return{rotation:g,circumference:e-g}}update(g){const e=this.chart,{chartArea:t}=e,I=this._cachedMeta,l=I.data,C=this.getMaxBorderWidth()+this.getMaxOffset(l)+this.options.spacing,n=Math.max((Math.min(t.width,t.height)-C)/2,0),o=Math.min((a=this.options.cutout,i=n,"string"===typeof a&&a.endsWith("%")?parseFloat(a)/100:+a/i),1);var a,i;const s=this._getRingWeight(this.index),{circumference:c,rotation:d}=this._getRotationExtents(),{ratioX:A,ratioY:r,offsetX:u,offsetY:m}=function(g,e,t){let I=1,l=1,C=0,n=0;if(e<It){const o=g,a=o+e,i=Math.cos(o),s=Math.sin(o),c=Math.cos(a),d=Math.sin(a),A=(g,e,I)=>Bt(g,o,a,!0)?1:Math.max(e,e*t,I,I*t),r=(g,e,I)=>Bt(g,o,a,!0)?-1:Math.min(e,e*t,I,I*t),u=A(0,i,c),m=A(ot,s,d),b=r(tt,i,c),h=r(tt+ot,s,d);I=(u-b)/2,l=(m-h)/2,C=-(u+b)/2,n=-(m+h)/2}return{ratioX:I,ratioY:l,offsetX:C,offsetY:n}}(d,c,o),b=(t.width-C)/A,h=(t.height-C)/r,Z=Math.max(Math.min(b,h)/2,0),G=ze(this.options.radius,Z),p=(G-Math.max(G*o,0))/this._getVisibleDatasetWeightTotal();this.offsetX=u*G,this.offsetY=m*G,I.total=this.calculateTotal(),this.outerRadius=G-p*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-p*s,0),this.updateElements(l,0,l.length,g)}_circumference(g,e){const t=this.options,I=this._cachedMeta,l=this._getCircumference();return e&&t.animation.animateRotate||!this.chart.getDataVisibility(g)||null===I._parsed[g]||I.data[g].hidden?0:this.calculateCircumference(I._parsed[g]*l/It)}updateElements(g,e,t,I){const l="reset"===I,C=this.chart,n=C.chartArea,o=C.options.animation,a=(n.left+n.right)/2,i=(n.top+n.bottom)/2,s=l&&o.animateScale,c=s?0:this.innerRadius,d=s?0:this.outerRadius,{sharedOptions:A,includeOptions:r}=this._getSharedOptions(e,I);let u,m=this._getRotation();for(u=0;u<e;++u)m+=this._circumference(u,l);for(u=e;u<e+t;++u){const e=this._circumference(u,l),t=g[u],C={x:a+this.offsetX,y:i+this.offsetY,startAngle:m,endAngle:m+e,circumference:e,outerRadius:d,innerRadius:c};r&&(C.options=A||this.resolveDataElementOptions(u,t.active?"active":I)),m+=e,this.updateElement(t,u,C,I)}}calculateTotal(){const g=this._cachedMeta,e=g.data;let t,I=0;for(t=0;t<e.length;t++){const l=g._parsed[t];null===l||isNaN(l)||!this.chart.getDataVisibility(t)||e[t].hidden||(I+=Math.abs(l))}return I}calculateCircumference(g){const e=this._cachedMeta.total;return e>0&&!isNaN(g)?It*(Math.abs(g)/e):0}getLabelAndValue(g){const e=this._cachedMeta,t=this.chart,I=t.data.labels||[],l=Tt(e._parsed[g],t.options.locale);return{label:I[g]||"",value:l}}getMaxBorderWidth(g){let e=0;const t=this.chart;let I,l,C,n,o;if(!g)for(I=0,l=t.data.datasets.length;I<l;++I)if(t.isDatasetVisible(I)){C=t.getDatasetMeta(I),g=C.data,n=C.controller;break}if(!g)return 0;for(I=0,l=g.length;I<l;++I)o=n.resolveDataElementOptions(I),"inner"!==o.borderAlign&&(e=Math.max(e,o.borderWidth||0,o.hoverBorderWidth||0));return e}getMaxOffset(g){let e=0;for(let t=0,I=g.length;t<I;++t){const g=this.resolveDataElementOptions(t);e=Math.max(e,g.offset||0,g.hoverOffset||0)}return e}_getRingWeightOffset(g){let e=0;for(let t=0;t<g;++t)this.chart.isDatasetVisible(t)&&(e+=this._getRingWeight(t));return e}_getRingWeight(g){return Math.max(Ke(this.chart.data.datasets[g].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}qg(Ol,"id","doughnut"),qg(Ol,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),qg(Ol,"descriptors",{_scriptable:g=>"spacing"!==g,_indexable:g=>"spacing"!==g&&!g.startsWith("borderDash")&&!g.startsWith("hoverBorderDash")}),qg(Ol,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(g){const e=g.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:t,color:I}}=g.legend.options;return e.labels.map(((e,l)=>{const C=g.getDatasetMeta(0).controller.getStyle(l);return{text:e,fillStyle:C.backgroundColor,strokeStyle:C.borderColor,fontColor:I,lineWidth:C.borderWidth,pointStyle:t,hidden:!g.getDataVisibility(l),index:l}}))}return[]}},onClick(g,e,t){t.chart.toggleDataVisibility(e.index),t.chart.update()}}}});class _l extends Kl{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(g){const e=this._cachedMeta,{dataset:t,data:I=[],_dataset:l}=e,C=this.chart._animationsDisabled;let{start:n,count:o}=Nt(e,I,C);this._drawStart=n,this._drawCount=o,wt(e)&&(n=0,o=I.length),t._chart=this.chart,t._datasetIndex=this.index,t._decimated=!!l._decimated,t.points=I;const a=this.resolveDatasetElementOptions(g);this.options.showLine||(a.borderWidth=0),a.segment=this.options.segment,this.updateElement(t,void 0,{animated:!C,options:a},g),this.updateElements(I,n,o,g)}updateElements(g,e,t,I){const l="reset"===I,{iScale:C,vScale:n,_stacked:o,_dataset:a}=this._cachedMeta,{sharedOptions:i,includeOptions:s}=this._getSharedOptions(e,I),c=C.axis,d=n.axis,{spanGaps:A,segment:r}=this.options,u=rt(A)?A:Number.POSITIVE_INFINITY,m=this.chart._animationsDisabled||l||"none"===I,b=e+t,h=g.length;let Z=e>0&&this.getParsed(e-1);for(let G=0;G<h;++G){const t=g[G],A=m?t:{};if(G<e||G>=b){A.skip=!0;continue}const h=this.getParsed(G),p=xe(h[d]),y=A[c]=C.getPixelForValue(h[c],G),B=A[d]=l||p?n.getBasePixel():n.getPixelForValue(o?this.applyStack(n,h,o):h[d],G);A.skip=isNaN(y)||isNaN(B)||p,A.stop=G>0&&Math.abs(h[c]-Z[c])>u,r&&(A.parsed=h,A.raw=a.data[G]),s&&(A.options=i||this.resolveDataElementOptions(G,t.active?"active":I)),m||this.updateElement(t,G,A,I),Z=h}}getMaxOverflow(){const g=this._cachedMeta,e=g.dataset,t=e.options&&e.options.borderWidth||0,I=g.data||[];if(!I.length)return t;const l=I[0].size(this.resolveDataElementOptions(0)),C=I[I.length-1].size(this.resolveDataElementOptions(I.length-1));return Math.max(t,l,C)/2}draw(){const g=this._cachedMeta;g.dataset.updateControlPoints(this.chart.chartArea,g.iScale.axis),super.draw()}}qg(_l,"id","line"),qg(_l,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),qg(_l,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class ql extends Kl{constructor(g,e){super(g,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(g){const e=this._cachedMeta,t=this.chart,I=t.data.labels||[],l=Tt(e._parsed[g].r,t.options.locale);return{label:I[g]||"",value:l}}parseObjectData(g,e,t,I){return EI.bind(this)(g,e,t,I)}update(g){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,g)}getMinMax(){const g=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return g.data.forEach(((g,t)=>{const I=this.getParsed(t).r;!isNaN(I)&&this.chart.getDataVisibility(t)&&(I<e.min&&(e.min=I),I>e.max&&(e.max=I))})),e}_updateRadius(){const g=this.chart,e=g.chartArea,t=g.options,I=Math.min(e.right-e.left,e.bottom-e.top),l=Math.max(I/2,0),C=(l-Math.max(t.cutoutPercentage?l/100*t.cutoutPercentage:1,0))/g.getVisibleDatasetCount();this.outerRadius=l-C*this.index,this.innerRadius=this.outerRadius-C}updateElements(g,e,t,I){const l="reset"===I,C=this.chart,n=C.options.animation,o=this._cachedMeta.rScale,a=o.xCenter,i=o.yCenter,s=o.getIndexAngle(0)-.5*tt;let c,d=s;const A=360/this.countVisibleElements();for(c=0;c<e;++c)d+=this._computeAngle(c,I,A);for(c=e;c<e+t;c++){const e=g[c];let t=d,r=d+this._computeAngle(c,I,A),u=C.getDataVisibility(c)?o.getDistanceFromCenterForValue(this.getParsed(c).r):0;d=r,l&&(n.animateScale&&(u=0),n.animateRotate&&(t=r=s));const m={x:a,y:i,innerRadius:0,outerRadius:u,startAngle:t,endAngle:r,options:this.resolveDataElementOptions(c,e.active?"active":I)};this.updateElement(e,c,m,I)}}countVisibleElements(){const g=this._cachedMeta;let e=0;return g.data.forEach(((g,t)=>{!isNaN(this.getParsed(t).r)&&this.chart.getDataVisibility(t)&&e++})),e}_computeAngle(g,e,t){return this.chart.getDataVisibility(g)?mt(this.resolveDataElementOptions(g,e).angle||t):0}}qg(ql,"id","polarArea"),qg(ql,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),qg(ql,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(g){const e=g.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:t,color:I}}=g.legend.options;return e.labels.map(((e,l)=>{const C=g.getDatasetMeta(0).controller.getStyle(l);return{text:e,fillStyle:C.backgroundColor,strokeStyle:C.borderColor,fontColor:I,lineWidth:C.borderWidth,pointStyle:t,hidden:!g.getDataVisibility(l),index:l}}))}return[]}},onClick(g,e,t){t.chart.toggleDataVisibility(e.index),t.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class $l extends Ol{}qg($l,"id","pie"),qg($l,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class gC extends Kl{getLabelAndValue(g){const e=this._cachedMeta.vScale,t=this.getParsed(g);return{label:e.getLabels()[g],value:""+e.getLabelForValue(t[e.axis])}}parseObjectData(g,e,t,I){return EI.bind(this)(g,e,t,I)}update(g){const e=this._cachedMeta,t=e.dataset,I=e.data||[],l=e.iScale.getLabels();if(t.points=I,"resize"!==g){const e=this.resolveDatasetElementOptions(g);this.options.showLine||(e.borderWidth=0);const C={_loop:!0,_fullLoop:l.length===I.length,options:e};this.updateElement(t,void 0,C,g)}this.updateElements(I,0,I.length,g)}updateElements(g,e,t,I){const l=this._cachedMeta.rScale,C="reset"===I;for(let n=e;n<e+t;n++){const e=g[n],t=this.resolveDataElementOptions(n,e.active?"active":I),o=l.getPointPositionForValue(n,this.getParsed(n).r),a=C?l.xCenter:o.x,i=C?l.yCenter:o.y,s={x:a,y:i,angle:o.angle,skip:isNaN(a)||isNaN(i),options:t};this.updateElement(e,n,s,I)}}}qg(gC,"id","radar"),qg(gC,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),qg(gC,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class eC extends Kl{getLabelAndValue(g){const e=this._cachedMeta,t=this.chart.data.labels||[],{xScale:I,yScale:l}=e,C=this.getParsed(g),n=I.getLabelForValue(C.x),o=l.getLabelForValue(C.y);return{label:t[g]||"",value:"("+n+", "+o+")"}}update(g){const e=this._cachedMeta,{data:t=[]}=e,I=this.chart._animationsDisabled;let{start:l,count:C}=Nt(e,t,I);if(this._drawStart=l,this._drawCount=C,wt(e)&&(l=0,C=t.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:l,_dataset:C}=e;l._chart=this.chart,l._datasetIndex=this.index,l._decimated=!!C._decimated,l.points=t;const n=this.resolveDatasetElementOptions(g);n.segment=this.options.segment,this.updateElement(l,void 0,{animated:!I,options:n},g)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(t,l,C,g)}addElements(){const{showLine:g}=this.options;!this.datasetElementType&&g&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(g,e,t,I){const l="reset"===I,{iScale:C,vScale:n,_stacked:o,_dataset:a}=this._cachedMeta,i=this.resolveDataElementOptions(e,I),s=this.getSharedOptions(i),c=this.includeOptions(I,s),d=C.axis,A=n.axis,{spanGaps:r,segment:u}=this.options,m=rt(r)?r:Number.POSITIVE_INFINITY,b=this.chart._animationsDisabled||l||"none"===I;let h=e>0&&this.getParsed(e-1);for(let Z=e;Z<e+t;++Z){const e=g[Z],t=this.getParsed(Z),i=b?e:{},r=xe(t[A]),G=i[d]=C.getPixelForValue(t[d],Z),p=i[A]=l||r?n.getBasePixel():n.getPixelForValue(o?this.applyStack(n,t,o):t[A],Z);i.skip=isNaN(G)||isNaN(p)||r,i.stop=Z>0&&Math.abs(t[d]-h[d])>m,u&&(i.parsed=t,i.raw=a.data[Z]),c&&(i.options=s||this.resolveDataElementOptions(Z,e.active?"active":I)),b||this.updateElement(e,Z,i,I),h=t}this.updateSharedOptions(s,I,i)}getMaxOverflow(){const g=this._cachedMeta,e=g.data||[];if(!this.options.showLine){let g=0;for(let t=e.length-1;t>=0;--t)g=Math.max(g,e[t].size(this.resolveDataElementOptions(t))/2);return g>0&&g}const t=g.dataset,I=t.options&&t.options.borderWidth||0;if(!e.length)return I;const l=e[0].size(this.resolveDataElementOptions(0)),C=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(I,l,C)/2}}qg(eC,"id","scatter"),qg(eC,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),qg(eC,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var tC=Object.freeze({__proto__:null,BarController:Tl,BubbleController:Pl,DoughnutController:Ol,LineController:_l,PieController:$l,PolarAreaController:ql,RadarController:gC,ScatterController:eC});function IC(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class lC{static override(g){Object.assign(lC.prototype,g)}constructor(g){qg(this,"options",void 0),this.options=g||{}}init(){}formats(){return IC()}parse(){return IC()}format(){return IC()}add(){return IC()}diff(){return IC()}startOf(){return IC()}endOf(){return IC()}}var CC=lC;function nC(g,e,t,I){const{controller:l,data:C,_sorted:n}=g,o=l._cachedMeta.iScale;if(o&&e===o.axis&&"r"!==e&&n&&C.length){const g=o._reversePixels?Xt:Rt;if(!I)return g(C,e,t);if(l._sharedOptions){const I=C[0],l="function"===typeof I.getRange&&I.getRange(e);if(l){const I=g(C,e,t-l),n=g(C,e,t+l);return{lo:I.lo,hi:n.hi}}}}return{lo:0,hi:C.length-1}}function oC(g,e,t,I,l){const C=g.getSortedVisibleDatasetMetas(),n=t[e];for(let o=0,a=C.length;o<a;++o){const{index:g,data:t}=C[o],{lo:a,hi:i}=nC(C[o],e,n,l);for(let e=a;e<=i;++e){const l=t[e];l.skip||I(l,g,e)}}}function aC(g,e,t,I,l){const C=[];if(!l&&!g.isPointInArea(e))return C;return oC(g,t,e,(function(t,n,o){(l||iI(t,g.chartArea,0))&&t.inRange(e.x,e.y,I)&&C.push({element:t,datasetIndex:n,index:o})}),!0),C}function iC(g,e,t,I,l,C){let n=[];const o=function(g){const e=-1!==g.indexOf("x"),t=-1!==g.indexOf("y");return function(g,I){const l=e?Math.abs(g.x-I.x):0,C=t?Math.abs(g.y-I.y):0;return Math.sqrt(Math.pow(l,2)+Math.pow(C,2))}}(t);let a=Number.POSITIVE_INFINITY;return oC(g,t,e,(function(t,i,s){const c=t.inRange(e.x,e.y,l);if(I&&!c)return;const d=t.getCenterPoint(l);if(!(!!C||g.isPointInArea(d))&&!c)return;const A=o(e,d);A<a?(n=[{element:t,datasetIndex:i,index:s}],a=A):A===a&&n.push({element:t,datasetIndex:i,index:s})})),n}function sC(g,e,t,I,l,C){return C||g.isPointInArea(e)?"r"!==t||I?iC(g,e,t,I,l,C):function(g,e,t,I){let l=[];return oC(g,t,e,(function(g,t,C){const{startAngle:n,endAngle:o}=g.getProps(["startAngle","endAngle"],I),{angle:a}=Zt(g,{x:e.x,y:e.y});Bt(a,n,o)&&l.push({element:g,datasetIndex:t,index:C})})),l}(g,e,t,l):[]}function cC(g,e,t,I,l){const C=[],n="x"===t?"inXRange":"inYRange";let o=!1;return oC(g,t,e,((g,I,a)=>{g[n](e[t],l)&&(C.push({element:g,datasetIndex:I,index:a}),o=o||g.inRange(e.x,e.y,l))})),I&&!o?[]:C}var dC={evaluateInteractionItems:oC,modes:{index(g,e,t,I){const l=Il(e,g),C=t.axis||"x",n=t.includeInvisible||!1,o=t.intersect?aC(g,l,C,I,n):sC(g,l,C,!1,I,n),a=[];return o.length?(g.getSortedVisibleDatasetMetas().forEach((g=>{const e=o[0].index,t=g.data[e];t&&!t.skip&&a.push({element:t,datasetIndex:g.index,index:e})})),a):[]},dataset(g,e,t,I){const l=Il(e,g),C=t.axis||"xy",n=t.includeInvisible||!1;let o=t.intersect?aC(g,l,C,I,n):sC(g,l,C,!1,I,n);if(o.length>0){const e=o[0].datasetIndex,t=g.getDatasetMeta(e).data;o=[];for(let g=0;g<t.length;++g)o.push({element:t[g],datasetIndex:e,index:g})}return o},point:(g,e,t,I)=>aC(g,Il(e,g),t.axis||"xy",I,t.includeInvisible||!1),nearest(g,e,t,I){const l=Il(e,g),C=t.axis||"xy",n=t.includeInvisible||!1;return sC(g,l,C,t.intersect,I,n)},x:(g,e,t,I)=>cC(g,Il(e,g),"x",t.intersect,I),y:(g,e,t,I)=>cC(g,Il(e,g),"y",t.intersect,I)}};const AC=["left","top","right","bottom"];function rC(g,e){return g.filter((g=>g.pos===e))}function uC(g,e){return g.filter((g=>-1===AC.indexOf(g.pos)&&g.box.axis===e))}function mC(g,e){return g.sort(((g,t)=>{const I=e?t:g,l=e?g:t;return I.weight===l.weight?I.index-l.index:I.weight-l.weight}))}function bC(g,e){const t=function(g){const e={};for(const t of g){const{stack:g,pos:I,stackWeight:l}=t;if(!g||!AC.includes(I))continue;const C=e[g]||(e[g]={count:0,placed:0,weight:0,size:0});C.count++,C.weight+=l}return e}(g),{vBoxMaxWidth:I,hBoxMaxHeight:l}=e;let C,n,o;for(C=0,n=g.length;C<n;++C){o=g[C];const{fullSize:n}=o.box,a=t[o.stack],i=a&&o.stackWeight/a.weight;o.horizontal?(o.width=i?i*I:n&&e.availableWidth,o.height=l):(o.width=I,o.height=i?i*l:n&&e.availableHeight)}return t}function hC(g,e,t,I){return Math.max(g[t],e[t])+Math.max(g[I],e[I])}function ZC(g,e){g.top=Math.max(g.top,e.top),g.left=Math.max(g.left,e.left),g.bottom=Math.max(g.bottom,e.bottom),g.right=Math.max(g.right,e.right)}function GC(g,e,t,I){const{pos:l,box:C}=t,n=g.maxPadding;if(!Ne(l)){t.size&&(g[l]-=t.size);const e=I[t.stack]||{size:0,count:1};e.size=Math.max(e.size,t.horizontal?C.height:C.width),t.size=e.size/e.count,g[l]+=t.size}C.getPadding&&ZC(n,C.getPadding());const o=Math.max(0,e.outerWidth-hC(n,g,"left","right")),a=Math.max(0,e.outerHeight-hC(n,g,"top","bottom")),i=o!==g.w,s=a!==g.h;return g.w=o,g.h=a,t.horizontal?{same:i,other:s}:{same:s,other:i}}function pC(g,e){const t=e.maxPadding;function I(g){const I={left:0,top:0,right:0,bottom:0};return g.forEach((g=>{I[g]=Math.max(e[g],t[g])})),I}return I(g?["left","right"]:["top","bottom"])}function yC(g,e,t,I){const l=[];let C,n,o,a,i,s;for(C=0,n=g.length,i=0;C<n;++C){o=g[C],a=o.box,a.update(o.width||e.w,o.height||e.h,pC(o.horizontal,e));const{same:n,other:c}=GC(e,t,o,I);i|=n&&l.length,s=s||c,a.fullSize||l.push(o)}return i&&yC(l,e,t,I)||s}function BC(g,e,t,I,l){g.top=t,g.left=e,g.right=e+I,g.bottom=t+l,g.width=I,g.height=l}function SC(g,e,t,I){const l=t.padding;let{x:C,y:n}=e;for(const o of g){const g=o.box,a=I[o.stack]||{count:1,placed:0,weight:1},i=o.stackWeight/a.weight||1;if(o.horizontal){const I=e.w*i,C=a.size||g.height;$e(a.start)&&(n=a.start),g.fullSize?BC(g,l.left,n,t.outerWidth-l.right-l.left,C):BC(g,e.left+a.placed,n,I,C),a.start=n,a.placed+=I,n=g.bottom}else{const I=e.h*i,n=a.size||g.width;$e(a.start)&&(C=a.start),g.fullSize?BC(g,C,l.top,n,t.outerHeight-l.bottom-l.top):BC(g,C,e.top+a.placed,n,I),a.start=C,a.placed+=I,C=g.right}}e.x=C,e.y=n}var WC={addBox(g,e){g.boxes||(g.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(g){e.draw(g)}}]},g.boxes.push(e)},removeBox(g,e){const t=g.boxes?g.boxes.indexOf(e):-1;-1!==t&&g.boxes.splice(t,1)},configure(g,e,t){e.fullSize=t.fullSize,e.position=t.position,e.weight=t.weight},update(g,e,t,I){if(!g)return;const l=WI(g.options.layout.padding),C=Math.max(e-l.width,0),n=Math.max(t-l.height,0),o=function(g){const e=function(g){const e=[];let t,I,l,C,n,o;for(t=0,I=(g||[]).length;t<I;++t)l=g[t],({position:C,options:{stack:n,stackWeight:o=1}}=l),e.push({index:t,box:l,pos:C,horizontal:l.isHorizontal(),weight:l.weight,stack:n&&C+n,stackWeight:o});return e}(g),t=mC(e.filter((g=>g.box.fullSize)),!0),I=mC(rC(e,"left"),!0),l=mC(rC(e,"right")),C=mC(rC(e,"top"),!0),n=mC(rC(e,"bottom")),o=uC(e,"x"),a=uC(e,"y");return{fullSize:t,leftAndTop:I.concat(C),rightAndBottom:l.concat(a).concat(n).concat(o),chartArea:rC(e,"chartArea"),vertical:I.concat(l).concat(a),horizontal:C.concat(n).concat(o)}}(g.boxes),a=o.vertical,i=o.horizontal;Ee(g.boxes,(g=>{"function"===typeof g.beforeLayout&&g.beforeLayout()}));const s=a.reduce(((g,e)=>e.box.options&&!1===e.box.options.display?g:g+1),0)||1,c=Object.freeze({outerWidth:e,outerHeight:t,padding:l,availableWidth:C,availableHeight:n,vBoxMaxWidth:C/2/s,hBoxMaxHeight:n/2}),d=Object.assign({},l);ZC(d,WI(I));const A=Object.assign({maxPadding:d,w:C,h:n,x:l.left,y:l.top},l),r=bC(a.concat(i),c);yC(o.fullSize,A,c,r),yC(a,A,c,r),yC(i,A,c,r)&&yC(a,A,c,r),function(g){const e=g.maxPadding;function t(t){const I=Math.max(e[t]-g[t],0);return g[t]+=I,I}g.y+=t("top"),g.x+=t("left"),t("right"),t("bottom")}(A),SC(o.leftAndTop,A,c,r),A.x+=A.w,A.y+=A.h,SC(o.rightAndBottom,A,c,r),g.chartArea={left:A.left,top:A.top,right:A.left+A.w,bottom:A.top+A.h,height:A.h,width:A.w},Ee(o.chartArea,(e=>{const t=e.box;Object.assign(t,g.chartArea),t.update(A.w,A.h,{left:0,top:0,right:0,bottom:0})}))}};class VC{acquireContext(g,e){}releaseContext(g){return!1}addEventListener(g,e,t){}removeEventListener(g,e,t){}getDevicePixelRatio(){return 1}getMaximumSize(g,e,t,I){return e=Math.max(0,e||g.width),t=t||g.height,{width:e,height:Math.max(0,I?Math.floor(e/I):t)}}isAttached(g){return!0}updateConfig(g){}}class RC extends VC{acquireContext(g){return g&&g.getContext&&g.getContext("2d")||null}updateConfig(g){g.options.animation=!1}}const XC="$chartjs",JC={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},kC=g=>null===g||""===g;const fC=!!ol&&{passive:!0};function vC(g,e,t){g.canvas.removeEventListener(e,t,fC)}function YC(g,e){for(const t of g)if(t===e||t.contains(e))return!0}function xC(g,e,t){const I=g.canvas,l=new MutationObserver((g=>{let e=!1;for(const t of g)e=e||YC(t.addedNodes,I),e=e&&!YC(t.removedNodes,I);e&&t()}));return l.observe(document,{childList:!0,subtree:!0}),l}function HC(g,e,t){const I=g.canvas,l=new MutationObserver((g=>{let e=!1;for(const t of g)e=e||YC(t.removedNodes,I),e=e&&!YC(t.addedNodes,I);e&&t()}));return l.observe(document,{childList:!0,subtree:!0}),l}const NC=new Map;let wC=0;function FC(){const g=window.devicePixelRatio;g!==wC&&(wC=g,NC.forEach(((e,t)=>{t.currentDevicePixelRatio!==g&&e()})))}function KC(g,e,t){const I=g.canvas,l=I&&_I(I);if(!l)return;const C=Yt(((g,e)=>{const I=l.clientWidth;t(g,e),I<l.clientWidth&&t()}),window),n=new ResizeObserver((g=>{const e=g[0],t=e.contentRect.width,I=e.contentRect.height;0===t&&0===I||C(t,I)}));return n.observe(l),function(g,e){NC.size||window.addEventListener("resize",FC),NC.set(g,e)}(g,C),n}function zC(g,e,t){t&&t.disconnect(),"resize"===e&&function(g){NC.delete(g),NC.size||window.removeEventListener("resize",FC)}(g)}function MC(g,e,t){const I=g.canvas,l=Yt((e=>{null!==g.ctx&&t(function(g,e){const t=JC[g.type]||g.type,{x:I,y:l}=Il(g,e);return{type:t,chart:e,native:g,x:void 0!==I?I:null,y:void 0!==l?l:null}}(e,g))}),g);return function(g,e,t){g.addEventListener(e,t,fC)}(I,e,l),l}class EC extends VC{acquireContext(g,e){const t=g&&g.getContext&&g.getContext("2d");return t&&t.canvas===g?(function(g,e){const t=g.style,I=g.getAttribute("height"),l=g.getAttribute("width");if(g[XC]={initial:{height:I,width:l,style:{display:t.display,height:t.height,width:t.width}}},t.display=t.display||"block",t.boxSizing=t.boxSizing||"border-box",kC(l)){const e=al(g,"width");void 0!==e&&(g.width=e)}if(kC(I))if(""===g.style.height)g.height=g.width/(e||2);else{const e=al(g,"height");void 0!==e&&(g.height=e)}}(g,e),t):null}releaseContext(g){const e=g.canvas;if(!e[XC])return!1;const t=e[XC].initial;["height","width"].forEach((g=>{const I=t[g];xe(I)?e.removeAttribute(g):e.setAttribute(g,I)}));const I=t.style||{};return Object.keys(I).forEach((g=>{e.style[g]=I[g]})),e.width=e.width,delete e[XC],!0}addEventListener(g,e,t){this.removeEventListener(g,e);const I=g.$proxies||(g.$proxies={}),l={attach:xC,detach:HC,resize:KC}[e]||MC;I[e]=l(g,e,t)}removeEventListener(g,e){const t=g.$proxies||(g.$proxies={}),I=t[e];if(!I)return;({attach:zC,detach:zC,resize:zC}[e]||vC)(g,e,I),t[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(g,e,t,I){return Cl(g,e,t,I)}isAttached(g){const e=_I(g);return!(!e||!e.isConnected)}}class QC{constructor(){qg(this,"x",void 0),qg(this,"y",void 0),qg(this,"active",!1),qg(this,"options",void 0),qg(this,"$animations",void 0)}tooltipPosition(g){const{x:e,y:t}=this.getProps(["x","y"],g);return{x:e,y:t}}hasValue(){return rt(this.x)&&rt(this.y)}getProps(g,e){const t=this.$animations;if(!e||!t)return this;const I={};return g.forEach((g=>{I[g]=t[g]&&t[g].active()?t[g]._to:this[g]})),I}}function UC(g,e){const t=g.options.ticks,I=function(g){const e=g.options.offset,t=g._tickSize(),I=g._length/t+(e?0:1),l=g._maxLength/t;return Math.floor(Math.min(I,l))}(g),l=Math.min(t.maxTicksLimit||I,I),C=t.major.enabled?function(g){const e=[];let t,I;for(t=0,I=g.length;t<I;t++)g[t].major&&e.push(t);return e}(e):[],n=C.length,o=C[0],a=C[n-1],i=[];if(n>l)return function(g,e,t,I){let l,C=0,n=t[0];for(I=Math.ceil(I),l=0;l<g.length;l++)l===n&&(e.push(g[l]),C++,n=t[C*I])}(e,i,C,n/l),i;const s=function(g,e,t){const I=function(g){const e=g.length;let t,I;if(e<2)return!1;for(I=g[0],t=1;t<e;++t)if(g[t]-g[t-1]!==I)return!1;return I}(g),l=e.length/t;if(!I)return Math.max(l,1);const C=function(g){const e=[],t=Math.sqrt(g);let I;for(I=1;I<t;I++)g%I===0&&(e.push(I),e.push(g/I));return t===(0|t)&&e.push(t),e.sort(((g,e)=>g-e)).pop(),e}(I);for(let n=0,o=C.length-1;n<o;n++){const g=C[n];if(g>l)return g}return Math.max(l,1)}(C,e,l);if(n>0){let g,t;const I=n>1?Math.round((a-o)/(n-1)):null;for(LC(e,i,s,xe(I)?0:o-I,o),g=0,t=n-1;g<t;g++)LC(e,i,s,C[g],C[g+1]);return LC(e,i,s,a,xe(I)?e.length:a+I),i}return LC(e,i,s),i}function LC(g,e,t,I,l){const C=Ke(I,0),n=Math.min(Ke(l,g.length),g.length);let o,a,i,s=0;for(t=Math.ceil(t),l&&(o=l-I,t=o/Math.floor(o/t)),i=C;i<0;)s++,i=Math.round(C+s*t);for(a=Math.max(C,0);a<n;a++)a===i&&(e.push(g[a]),s++,i=Math.round(C+s*t))}qg(QC,"defaults",{}),qg(QC,"defaultRoutes",void 0);const jC=(g,e,t)=>"top"===e||"left"===e?g[e]+t:g[e]-t,DC=(g,e)=>Math.min(e||g,g);function TC(g,e){const t=[],I=g.length/e,l=g.length;let C=0;for(;C<l;C+=I)t.push(g[Math.floor(C)]);return t}function PC(g,e,t){const I=g.ticks.length,l=Math.min(e,I-1),C=g._startPixel,n=g._endPixel,o=1e-6;let a,i=g.getPixelForTick(l);if(!(t&&(a=1===I?Math.max(i-C,n-i):0===e?(g.getPixelForTick(1)-i)/2:(i-g.getPixelForTick(l-1))/2,i+=l<e?a:-a,i<C-o||i>n+o)))return i}function OC(g){return g.drawTicks?g.tickLength:0}function _C(g,e){if(!g.display)return 0;const t=VI(g.font,e),I=WI(g.padding);return(He(g.text)?g.text.length:1)*t.lineHeight+I.height}function qC(g,e,t){let I=xt(g);return(t&&"right"!==e||!t&&"right"===e)&&(I=(g=>"left"===g?"right":"right"===g?"left":g)(I)),I}class $C extends QC{constructor(g){super(),this.id=g.id,this.type=g.type,this.options=void 0,this.ctx=g.ctx,this.chart=g.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(g){this.options=g.setContext(this.getContext()),this.axis=g.axis,this._userMin=this.parse(g.min),this._userMax=this.parse(g.max),this._suggestedMin=this.parse(g.suggestedMin),this._suggestedMax=this.parse(g.suggestedMax)}parse(g,e){return g}getUserBounds(){let{_userMin:g,_userMax:e,_suggestedMin:t,_suggestedMax:I}=this;return g=Fe(g,Number.POSITIVE_INFINITY),e=Fe(e,Number.NEGATIVE_INFINITY),t=Fe(t,Number.POSITIVE_INFINITY),I=Fe(I,Number.NEGATIVE_INFINITY),{min:Fe(g,t),max:Fe(e,I),minDefined:we(g),maxDefined:we(e)}}getMinMax(g){let e,{min:t,max:I,minDefined:l,maxDefined:C}=this.getUserBounds();if(l&&C)return{min:t,max:I};const n=this.getMatchingVisibleMetas();for(let o=0,a=n.length;o<a;++o)e=n[o].controller.getMinMax(this,g),l||(t=Math.min(t,e.min)),C||(I=Math.max(I,e.max));return t=C&&t>I?I:t,I=l&&t>I?t:I,{min:Fe(t,Fe(I,t)),max:Fe(I,Fe(t,I))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const g=this.chart.data;return this.options.labels||(this.isHorizontal()?g.xLabels:g.yLabels)||g.labels||[]}getLabelItems(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.chart.chartArea;return this._labelItems||(this._labelItems=this._computeLabelItems(g))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Me(this.options.beforeUpdate,[this])}update(g,e,t){const{beginAtZero:I,grace:l,ticks:C}=this.options,n=C.sampleSize;this.beforeUpdate(),this.maxWidth=g,this.maxHeight=e,this._margins=t=Object.assign({left:0,right:0,top:0,bottom:0},t),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+t.left+t.right:this.height+t.top+t.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(g,e,t){const{min:I,max:l}=g,C=ze(e,(l-I)/2),n=(g,e)=>t&&0===g?0:g+e;return{min:n(I,-Math.abs(C)),max:n(l,C)}}(this,l,I),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const o=n<this.ticks.length;this._convertTicksToLabels(o?TC(this.ticks,n):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),C.display&&(C.autoSkip||"auto"===C.source)&&(this.ticks=UC(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),o&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let g,e,t=this.options.reverse;this.isHorizontal()?(g=this.left,e=this.right):(g=this.top,e=this.bottom,t=!t),this._startPixel=g,this._endPixel=e,this._reversePixels=t,this._length=e-g,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Me(this.options.afterUpdate,[this])}beforeSetDimensions(){Me(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Me(this.options.afterSetDimensions,[this])}_callHooks(g){this.chart.notifyPlugins(g,this.getContext()),Me(this.options[g],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Me(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(g){const e=this.options.ticks;let t,I,l;for(t=0,I=g.length;t<I;t++)l=g[t],l.label=Me(e.callback,[l.value,t,g],this)}afterTickToLabelConversion(){Me(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Me(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const g=this.options,e=g.ticks,t=DC(this.ticks.length,g.ticks.maxTicksLimit),I=e.minRotation||0,l=e.maxRotation;let C,n,o,a=I;if(!this._isVisible()||!e.display||I>=l||t<=1||!this.isHorizontal())return void(this.labelRotation=I);const i=this._getLabelSizes(),s=i.widest.width,c=i.highest.height,d=St(this.chart.width-s,0,this.maxWidth);C=g.offset?this.maxWidth/t:d/(t-1),s+6>C&&(C=d/(t-(g.offset?.5:1)),n=this.maxHeight-OC(g.grid)-e.padding-_C(g.title,this.chart.options.font),o=Math.sqrt(s*s+c*c),a=bt(Math.min(Math.asin(St((i.highest.height+6)/C,-1,1)),Math.asin(St(n/o,-1,1))-Math.asin(St(c/o,-1,1)))),a=Math.max(I,Math.min(l,a))),this.labelRotation=a}afterCalculateLabelRotation(){Me(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Me(this.options.beforeFit,[this])}fit(){const g={width:0,height:0},{chart:e,options:{ticks:t,title:I,grid:l}}=this,C=this._isVisible(),n=this.isHorizontal();if(C){const C=_C(I,e.options.font);if(n?(g.width=this.maxWidth,g.height=OC(l)+C):(g.height=this.maxHeight,g.width=OC(l)+C),t.display&&this.ticks.length){const{first:e,last:I,widest:l,highest:C}=this._getLabelSizes(),o=2*t.padding,a=mt(this.labelRotation),i=Math.cos(a),s=Math.sin(a);if(n){const e=t.mirror?0:s*l.width+i*C.height;g.height=Math.min(this.maxHeight,g.height+e+o)}else{const e=t.mirror?0:i*l.width+s*C.height;g.width=Math.min(this.maxWidth,g.width+e+o)}this._calculatePadding(e,I,s,i)}}this._handleMargins(),n?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=g.height):(this.width=g.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(g,e,t,I){const{ticks:{align:l,padding:C},position:n}=this.options,o=0!==this.labelRotation,a="top"!==n&&"x"===this.axis;if(this.isHorizontal()){const n=this.getPixelForTick(0)-this.left,i=this.right-this.getPixelForTick(this.ticks.length-1);let s=0,c=0;o?a?(s=I*g.width,c=t*e.height):(s=t*g.height,c=I*e.width):"start"===l?c=e.width:"end"===l?s=g.width:"inner"!==l&&(s=g.width/2,c=e.width/2),this.paddingLeft=Math.max((s-n+C)*this.width/(this.width-n),0),this.paddingRight=Math.max((c-i+C)*this.width/(this.width-i),0)}else{let t=e.height/2,I=g.height/2;"start"===l?(t=0,I=g.height):"end"===l&&(t=e.height,I=0),this.paddingTop=t+C,this.paddingBottom=I+C}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Me(this.options.afterFit,[this])}isHorizontal(){const{axis:g,position:e}=this.options;return"top"===e||"bottom"===e||"x"===g}isFullSize(){return this.options.fullSize}_convertTicksToLabels(g){let e,t;for(this.beforeTickToLabelConversion(),this.generateTickLabels(g),e=0,t=g.length;e<t;e++)xe(g[e].label)&&(g.splice(e,1),t--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let g=this._labelSizes;if(!g){const e=this.options.ticks.sampleSize;let t=this.ticks;e<t.length&&(t=TC(t,e)),this._labelSizes=g=this._computeLabelSizes(t,t.length,this.options.ticks.maxTicksLimit)}return g}_computeLabelSizes(g,e,t){const{ctx:I,_longestTextCache:l}=this,C=[],n=[],o=Math.floor(e/DC(e,t));let a,i,s,c,d,A,r,u,m,b,h,Z=0,G=0;for(a=0;a<e;a+=o){if(c=g[a].label,d=this._resolveTickFontOptions(a),I.font=A=d.string,r=l[A]=l[A]||{data:{},gc:[]},u=d.lineHeight,m=b=0,xe(c)||He(c)){if(He(c))for(i=0,s=c.length;i<s;++i)h=c[i],xe(h)||He(h)||(m=II(I,r.data,r.gc,m,h),b+=u)}else m=II(I,r.data,r.gc,m,c),b=u;C.push(m),n.push(b),Z=Math.max(m,Z),G=Math.max(b,G)}!function(g,e){Ee(g,(g=>{const t=g.gc,I=t.length/2;let l;if(I>e){for(l=0;l<I;++l)delete g.data[t[l]];t.splice(0,I)}}))}(l,e);const p=C.indexOf(Z),y=n.indexOf(G),B=g=>({width:C[g]||0,height:n[g]||0});return{first:B(0),last:B(e-1),widest:B(p),highest:B(y),widths:C,heights:n}}getLabelForValue(g){return g}getPixelForValue(g,e){return NaN}getValueForPixel(g){}getPixelForTick(g){const e=this.ticks;return g<0||g>e.length-1?null:this.getPixelForValue(e[g].value)}getPixelForDecimal(g){this._reversePixels&&(g=1-g);const e=this._startPixel+g*this._length;return St(this._alignToPixels?CI(this.chart,e,0):e,-32768,32767)}getDecimalForPixel(g){const e=(g-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:g,max:e}=this;return g<0&&e<0?e:g>0&&e>0?g:0}getContext(g){const e=this.ticks||[];if(g>=0&&g<e.length){const t=e[g];return t.$context||(t.$context=function(g,e,t){return XI(g,{tick:t,index:e,type:"tick"})}(this.getContext(),g,t))}return this.$context||(this.$context=XI(this.chart.getContext(),{scale:this,type:"scale"}))}_tickSize(){const g=this.options.ticks,e=mt(this.labelRotation),t=Math.abs(Math.cos(e)),I=Math.abs(Math.sin(e)),l=this._getLabelSizes(),C=g.autoSkipPadding||0,n=l?l.widest.width+C:0,o=l?l.highest.height+C:0;return this.isHorizontal()?o*t>n*I?n/t:o/I:o*I<n*t?o/t:n/I}_isVisible(){const g=this.options.display;return"auto"!==g?!!g:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(g){const e=this.axis,t=this.chart,I=this.options,{grid:l,position:C,border:n}=I,o=l.offset,a=this.isHorizontal(),i=this.ticks.length+(o?1:0),s=OC(l),c=[],d=n.setContext(this.getContext()),A=d.display?d.width:0,r=A/2,u=function(g){return CI(t,g,A)};let m,b,h,Z,G,p,y,B,S,W,V,R;if("top"===C)m=u(this.bottom),p=this.bottom-s,B=m-r,W=u(g.top)+r,R=g.bottom;else if("bottom"===C)m=u(this.top),W=g.top,R=u(g.bottom)-r,p=m+r,B=this.top+s;else if("left"===C)m=u(this.right),G=this.right-s,y=m-r,S=u(g.left)+r,V=g.right;else if("right"===C)m=u(this.left),S=g.left,V=u(g.right)-r,G=m+r,y=this.left+s;else if("x"===e){if("center"===C)m=u((g.top+g.bottom)/2+.5);else if(Ne(C)){const g=Object.keys(C)[0],e=C[g];m=u(this.chart.scales[g].getPixelForValue(e))}W=g.top,R=g.bottom,p=m+r,B=p+s}else if("y"===e){if("center"===C)m=u((g.left+g.right)/2);else if(Ne(C)){const g=Object.keys(C)[0],e=C[g];m=u(this.chart.scales[g].getPixelForValue(e))}G=m-r,y=G-s,S=g.left,V=g.right}const X=Ke(I.ticks.maxTicksLimit,i),J=Math.max(1,Math.ceil(i/X));for(b=0;b<i;b+=J){const g=this.getContext(b),e=l.setContext(g),I=n.setContext(g),C=e.lineWidth,i=e.color,s=I.dash||[],d=I.dashOffset,A=e.tickWidth,r=e.tickColor,u=e.tickBorderDash||[],m=e.tickBorderDashOffset;h=PC(this,b,o),void 0!==h&&(Z=CI(t,h,C),a?G=y=S=V=Z:p=B=W=R=Z,c.push({tx1:G,ty1:p,tx2:y,ty2:B,x1:S,y1:W,x2:V,y2:R,width:C,color:i,borderDash:s,borderDashOffset:d,tickWidth:A,tickColor:r,tickBorderDash:u,tickBorderDashOffset:m}))}return this._ticksLength=i,this._borderValue=m,c}_computeLabelItems(g){const e=this.axis,t=this.options,{position:I,ticks:l}=t,C=this.isHorizontal(),n=this.ticks,{align:o,crossAlign:a,padding:i,mirror:s}=l,c=OC(t.grid),d=c+i,A=s?-i:d,r=-mt(this.labelRotation),u=[];let m,b,h,Z,G,p,y,B,S,W,V,R,X="middle";if("top"===I)p=this.bottom-A,y=this._getXAxisLabelAlignment();else if("bottom"===I)p=this.top+A,y=this._getXAxisLabelAlignment();else if("left"===I){const g=this._getYAxisLabelAlignment(c);y=g.textAlign,G=g.x}else if("right"===I){const g=this._getYAxisLabelAlignment(c);y=g.textAlign,G=g.x}else if("x"===e){if("center"===I)p=(g.top+g.bottom)/2+d;else if(Ne(I)){const g=Object.keys(I)[0],e=I[g];p=this.chart.scales[g].getPixelForValue(e)+d}y=this._getXAxisLabelAlignment()}else if("y"===e){if("center"===I)G=(g.left+g.right)/2-d;else if(Ne(I)){const g=Object.keys(I)[0],e=I[g];G=this.chart.scales[g].getPixelForValue(e)}y=this._getYAxisLabelAlignment(c).textAlign}"y"===e&&("start"===o?X="top":"end"===o&&(X="bottom"));const J=this._getLabelSizes();for(m=0,b=n.length;m<b;++m){h=n[m],Z=h.label;const g=l.setContext(this.getContext(m));B=this.getPixelForTick(m)+l.labelOffset,S=this._resolveTickFontOptions(m),W=S.lineHeight,V=He(Z)?Z.length:1;const e=V/2,t=g.color,o=g.textStrokeColor,i=g.textStrokeWidth;let c,d=y;if(C?(G=B,"inner"===y&&(d=m===b-1?this.options.reverse?"left":"right":0===m?this.options.reverse?"right":"left":"center"),R="top"===I?"near"===a||0!==r?-V*W+W/2:"center"===a?-J.highest.height/2-e*W+W:-J.highest.height+W/2:"near"===a||0!==r?W/2:"center"===a?J.highest.height/2-e*W:J.highest.height-V*W,s&&(R*=-1),0===r||g.showLabelBackdrop||(G+=W/2*Math.sin(r))):(p=B,R=(1-V)*W/2),g.showLabelBackdrop){const e=WI(g.backdropPadding),t=J.heights[m],I=J.widths[m];let l=R-e.top,C=0-e.left;switch(X){case"middle":l-=t/2;break;case"bottom":l-=t}switch(y){case"center":C-=I/2;break;case"right":C-=I;break;case"inner":m===b-1?C-=I:m>0&&(C-=I/2)}c={left:C,top:l,width:I+e.width,height:t+e.height,color:g.backdropColor}}u.push({label:Z,font:S,textOffset:R,options:{rotation:r,color:t,strokeColor:o,strokeWidth:i,textAlign:d,textBaseline:X,translation:[G,p],backdrop:c}})}return u}_getXAxisLabelAlignment(){const{position:g,ticks:e}=this.options;if(-mt(this.labelRotation))return"top"===g?"left":"right";let t="center";return"start"===e.align?t="left":"end"===e.align?t="right":"inner"===e.align&&(t="inner"),t}_getYAxisLabelAlignment(g){const{position:e,ticks:{crossAlign:t,mirror:I,padding:l}}=this.options,C=g+l,n=this._getLabelSizes().widest.width;let o,a;return"left"===e?I?(a=this.right+l,"near"===t?o="left":"center"===t?(o="center",a+=n/2):(o="right",a+=n)):(a=this.right-C,"near"===t?o="right":"center"===t?(o="center",a-=n/2):(o="left",a=this.left)):"right"===e?I?(a=this.left+l,"near"===t?o="right":"center"===t?(o="center",a-=n/2):(o="left",a-=n)):(a=this.left+C,"near"===t?o="left":"center"===t?(o="center",a+=n/2):(o="right",a=this.right)):o="right",{textAlign:o,x:a}}_computeLabelArea(){if(this.options.ticks.mirror)return;const g=this.chart,e=this.options.position;return"left"===e||"right"===e?{top:0,left:this.left,bottom:g.height,right:this.right}:"top"===e||"bottom"===e?{top:this.top,left:0,bottom:this.bottom,right:g.width}:void 0}drawBackground(){const{ctx:g,options:{backgroundColor:e},left:t,top:I,width:l,height:C}=this;e&&(g.save(),g.fillStyle=e,g.fillRect(t,I,l,C),g.restore())}getLineWidthForValue(g){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const t=this.ticks.findIndex((e=>e.value===g));if(t>=0){return e.setContext(this.getContext(t)).lineWidth}return 0}drawGrid(g){const e=this.options.grid,t=this.ctx,I=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(g));let l,C;const n=(g,e,I)=>{I.width&&I.color&&(t.save(),t.lineWidth=I.width,t.strokeStyle=I.color,t.setLineDash(I.borderDash||[]),t.lineDashOffset=I.borderDashOffset,t.beginPath(),t.moveTo(g.x,g.y),t.lineTo(e.x,e.y),t.stroke(),t.restore())};if(e.display)for(l=0,C=I.length;l<C;++l){const g=I[l];e.drawOnChartArea&&n({x:g.x1,y:g.y1},{x:g.x2,y:g.y2},g),e.drawTicks&&n({x:g.tx1,y:g.ty1},{x:g.tx2,y:g.ty2},{color:g.tickColor,width:g.tickWidth,borderDash:g.tickBorderDash,borderDashOffset:g.tickBorderDashOffset})}}drawBorder(){const{chart:g,ctx:e,options:{border:t,grid:I}}=this,l=t.setContext(this.getContext()),C=t.display?l.width:0;if(!C)return;const n=I.setContext(this.getContext(0)).lineWidth,o=this._borderValue;let a,i,s,c;this.isHorizontal()?(a=CI(g,this.left,C)-C/2,i=CI(g,this.right,n)+n/2,s=c=o):(s=CI(g,this.top,C)-C/2,c=CI(g,this.bottom,n)+n/2,a=i=o),e.save(),e.lineWidth=l.width,e.strokeStyle=l.color,e.beginPath(),e.moveTo(a,s),e.lineTo(i,c),e.stroke(),e.restore()}drawLabels(g){if(!this.options.ticks.display)return;const e=this.ctx,t=this._computeLabelArea();t&&sI(e,t);const I=this.getLabelItems(g);for(const l of I){const g=l.options,t=l.font;mI(e,l.label,0,l.textOffset,t,g)}t&&cI(e)}drawTitle(){const{ctx:g,options:{position:e,title:t,reverse:I}}=this;if(!t.display)return;const l=VI(t.font),C=WI(t.padding),n=t.align;let o=l.lineHeight/2;"bottom"===e||"center"===e||Ne(e)?(o+=C.bottom,He(t.text)&&(o+=l.lineHeight*(t.text.length-1))):o+=C.top;const{titleX:a,titleY:i,maxWidth:s,rotation:c}=function(g,e,t,I){const{top:l,left:C,bottom:n,right:o,chart:a}=g,{chartArea:i,scales:s}=a;let c,d,A,r=0;const u=n-l,m=o-C;if(g.isHorizontal()){if(d=Ht(I,C,o),Ne(t)){const g=Object.keys(t)[0],I=t[g];A=s[g].getPixelForValue(I)+u-e}else A="center"===t?(i.bottom+i.top)/2+u-e:jC(g,t,e);c=o-C}else{if(Ne(t)){const g=Object.keys(t)[0],I=t[g];d=s[g].getPixelForValue(I)-m+e}else d="center"===t?(i.left+i.right)/2-m+e:jC(g,t,e);A=Ht(I,n,l),r="left"===t?-ot:ot}return{titleX:d,titleY:A,maxWidth:c,rotation:r}}(this,o,e,n);mI(g,t.text,0,0,l,{color:t.color,maxWidth:s,rotation:c,textAlign:qC(n,e,I),textBaseline:"middle",translation:[a,i]})}draw(g){this._isVisible()&&(this.drawBackground(),this.drawGrid(g),this.drawBorder(),this.drawTitle(),this.drawLabels(g))}_layers(){const g=this.options,e=g.ticks&&g.ticks.z||0,t=Ke(g.grid&&g.grid.z,-1),I=Ke(g.border&&g.border.z,0);return this._isVisible()&&this.draw===$C.prototype.draw?[{z:t,draw:g=>{this.drawBackground(),this.drawGrid(g),this.drawTitle()}},{z:I,draw:()=>{this.drawBorder()}},{z:e,draw:g=>{this.drawLabels(g)}}]:[{z:e,draw:g=>{this.draw(g)}}]}getMatchingVisibleMetas(g){const e=this.chart.getSortedVisibleDatasetMetas(),t=this.axis+"AxisID",I=[];let l,C;for(l=0,C=e.length;l<C;++l){const C=e[l];C[t]!==this.id||g&&C.type!==g||I.push(C)}return I}_resolveTickFontOptions(g){return VI(this.options.ticks.setContext(this.getContext(g)).font)}_maxDigits(){const g=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/g}}class gn{constructor(g,e,t){this.type=g,this.scope=e,this.override=t,this.items=Object.create(null)}isForType(g){return Object.prototype.isPrototypeOf.call(this.type.prototype,g.prototype)}register(g){const e=Object.getPrototypeOf(g);let t;(function(g){return"id"in g&&"defaults"in g})(e)&&(t=this.register(e));const I=this.items,l=g.id,C=this.scope+"."+l;if(!l)throw new Error("class does not have id: "+g);return l in I||(I[l]=g,function(g,e,t){const I=De(Object.create(null),[t?tI.get(t):{},tI.get(e),g.defaults]);tI.set(e,I),g.defaultRoutes&&function(g,e){Object.keys(e).forEach((t=>{const I=t.split("."),l=I.pop(),C=[g].concat(I).join("."),n=e[t].split("."),o=n.pop(),a=n.join(".");tI.route(C,l,a,o)}))}(e,g.defaultRoutes);g.descriptors&&tI.describe(e,g.descriptors)}(g,C,t),this.override&&tI.override(g.id,g.overrides)),C}get(g){return this.items[g]}unregister(g){const e=this.items,t=g.id,I=this.scope;t in e&&delete e[t],I&&t in tI[I]&&(delete tI[I][t],this.override&&delete _t[t])}}class en{constructor(){this.controllers=new gn(Kl,"datasets",!0),this.elements=new gn(QC,"elements"),this.plugins=new gn(Object,"plugins"),this.scales=new gn($C,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(){for(var g=arguments.length,e=new Array(g),t=0;t<g;t++)e[t]=arguments[t];this._each("register",e)}remove(){for(var g=arguments.length,e=new Array(g),t=0;t<g;t++)e[t]=arguments[t];this._each("unregister",e)}addControllers(){for(var g=arguments.length,e=new Array(g),t=0;t<g;t++)e[t]=arguments[t];this._each("register",e,this.controllers)}addElements(){for(var g=arguments.length,e=new Array(g),t=0;t<g;t++)e[t]=arguments[t];this._each("register",e,this.elements)}addPlugins(){for(var g=arguments.length,e=new Array(g),t=0;t<g;t++)e[t]=arguments[t];this._each("register",e,this.plugins)}addScales(){for(var g=arguments.length,e=new Array(g),t=0;t<g;t++)e[t]=arguments[t];this._each("register",e,this.scales)}getController(g){return this._get(g,this.controllers,"controller")}getElement(g){return this._get(g,this.elements,"element")}getPlugin(g){return this._get(g,this.plugins,"plugin")}getScale(g){return this._get(g,this.scales,"scale")}removeControllers(){for(var g=arguments.length,e=new Array(g),t=0;t<g;t++)e[t]=arguments[t];this._each("unregister",e,this.controllers)}removeElements(){for(var g=arguments.length,e=new Array(g),t=0;t<g;t++)e[t]=arguments[t];this._each("unregister",e,this.elements)}removePlugins(){for(var g=arguments.length,e=new Array(g),t=0;t<g;t++)e[t]=arguments[t];this._each("unregister",e,this.plugins)}removeScales(){for(var g=arguments.length,e=new Array(g),t=0;t<g;t++)e[t]=arguments[t];this._each("unregister",e,this.scales)}_each(g,e,t){[...e].forEach((e=>{const I=t||this._getRegistryForType(e);t||I.isForType(e)||I===this.plugins&&e.id?this._exec(g,I,e):Ee(e,(e=>{const I=t||this._getRegistryForType(e);this._exec(g,I,e)}))}))}_exec(g,e,t){const I=qe(g);Me(t["before"+I],[],t),e[g](t),Me(t["after"+I],[],t)}_getRegistryForType(g){for(let e=0;e<this._typedRegistries.length;e++){const t=this._typedRegistries[e];if(t.isForType(g))return t}return this.plugins}_get(g,e,t){const I=e.get(g);if(void 0===I)throw new Error('"'+g+'" is not a registered '+t+".");return I}}var tn=new en;class In{constructor(){this._init=[]}notify(g,e,t,I){"beforeInit"===e&&(this._init=this._createDescriptors(g,!0),this._notify(this._init,g,"install"));const l=I?this._descriptors(g).filter(I):this._descriptors(g),C=this._notify(l,g,e,t);return"afterDestroy"===e&&(this._notify(l,g,"stop"),this._notify(this._init,g,"uninstall")),C}_notify(g,e,t,I){I=I||{};for(const l of g){const g=l.plugin;if(!1===Me(g[t],[e,I,l.options],g)&&I.cancelable)return!1}return!0}invalidate(){xe(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(g){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(g);return this._notifyStateChanges(g),e}_createDescriptors(g,e){const t=g&&g.config,I=Ke(t.options&&t.options.plugins,{}),l=function(g){const e={},t=[],I=Object.keys(tn.plugins.items);for(let C=0;C<I.length;C++)t.push(tn.getPlugin(I[C]));const l=g.plugins||[];for(let C=0;C<l.length;C++){const g=l[C];-1===t.indexOf(g)&&(t.push(g),e[g.id]=!0)}return{plugins:t,localIds:e}}(t);return!1!==I||e?function(g,e,t,I){let{plugins:l,localIds:C}=e;const n=[],o=g.getContext();for(const a of l){const e=a.id,l=ln(t[e],I);null!==l&&n.push({plugin:a,options:Cn(g.config,{plugin:a,local:C[e]},l,o)})}return n}(g,l,I,e):[]}_notifyStateChanges(g){const e=this._oldCache||[],t=this._cache,I=(g,e)=>g.filter((g=>!e.some((e=>g.plugin.id===e.plugin.id))));this._notify(I(e,t),g,"stop"),this._notify(I(t,e),g,"start")}}function ln(g,e){return e||!1!==g?!0===g?{}:g:null}function Cn(g,e,t,I){let{plugin:l,local:C}=e;const n=g.pluginScopeKeys(l),o=g.getOptionScopes(t,n);return C&&l.defaults&&o.push(l.defaults),g.createResolver(o,I,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function nn(g,e){const t=tI.datasets[g]||{};return((e.datasets||{})[g]||{}).indexAxis||e.indexAxis||t.indexAxis||"x"}function on(g){if("x"===g||"y"===g||"r"===g)return g}function an(g){if(on(g))return g;for(var e=arguments.length,t=new Array(e>1?e-1:0),I=1;I<e;I++)t[I-1]=arguments[I];for(const C of t){const e=C.axis||("top"===(l=C.position)||"bottom"===l?"x":"left"===l||"right"===l?"y":void 0)||g.length>1&&on(g[0].toLowerCase());if(e)return e}var l;throw new Error("Cannot determine type of '".concat(g,"' axis. Please provide 'axis' or 'position' option."))}function sn(g,e,t){if(t[e+"AxisID"]===g)return{axis:e}}function cn(g,e){const t=_t[g.type]||{scales:{}},I=e.scales||{},l=nn(g.type,e),C=Object.create(null);return Object.keys(I).forEach((e=>{const n=I[e];if(!Ne(n))return console.error("Invalid scale configuration for scale: ".concat(e));if(n._proxy)return console.warn("Ignoring resolver passed as options for scale: ".concat(e));const o=an(e,n,function(g,e){if(e.data&&e.data.datasets){const t=e.data.datasets.filter((e=>e.xAxisID===g||e.yAxisID===g));if(t.length)return sn(g,"x",t[0])||sn(g,"y",t[0])}return{}}(e,g),tI.scales[n.type]),a=function(g,e){return g===e?"_index_":"_value_"}(o,l),i=t.scales||{};C[e]=Te(Object.create(null),[{axis:o},n,i[o],i[a]])})),g.data.datasets.forEach((t=>{const l=t.type||g.type,n=t.indexAxis||nn(l,e),o=(_t[l]||{}).scales||{};Object.keys(o).forEach((g=>{const e=function(g,e){let t=g;return"_index_"===g?t=e:"_value_"===g&&(t="x"===e?"y":"x"),t}(g,n),l=t[e+"AxisID"]||e;C[l]=C[l]||Object.create(null),Te(C[l],[{axis:e},I[l],o[g]])}))})),Object.keys(C).forEach((g=>{const e=C[g];Te(e,[tI.scales[e.type],tI.scale])})),C}function dn(g){const e=g.options||(g.options={});e.plugins=Ke(e.plugins,{}),e.scales=cn(g,e)}function An(g){return(g=g||{}).datasets=g.datasets||[],g.labels=g.labels||[],g}const rn=new Map,un=new Set;function mn(g,e){let t=rn.get(g);return t||(t=e(),rn.set(g,t),un.add(t)),t}const bn=(g,e,t)=>{const I=_e(e,t);void 0!==I&&g.add(I)};class hn{constructor(g){this._config=function(g){return(g=g||{}).data=An(g.data),dn(g),g}(g),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(g){this._config.type=g}get data(){return this._config.data}set data(g){this._config.data=An(g)}get options(){return this._config.options}set options(g){this._config.options=g}get plugins(){return this._config.plugins}update(){const g=this._config;this.clearCache(),dn(g)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(g){return mn(g,(()=>[["datasets.".concat(g),""]]))}datasetAnimationScopeKeys(g,e){return mn("".concat(g,".transition.").concat(e),(()=>[["datasets.".concat(g,".transitions.").concat(e),"transitions.".concat(e)],["datasets.".concat(g),""]]))}datasetElementScopeKeys(g,e){return mn("".concat(g,"-").concat(e),(()=>[["datasets.".concat(g,".elements.").concat(e),"datasets.".concat(g),"elements.".concat(e),""]]))}pluginScopeKeys(g){const e=g.id,t=this.type;return mn("".concat(t,"-plugin-").concat(e),(()=>[["plugins.".concat(e),...g.additionalOptionScopes||[]]]))}_cachedScopes(g,e){const t=this._scopeCache;let I=t.get(g);return I&&!e||(I=new Map,t.set(g,I)),I}getOptionScopes(g,e,t){const{options:I,type:l}=this,C=this._cachedScopes(g,t),n=C.get(e);if(n)return n;const o=new Set;e.forEach((e=>{g&&(o.add(g),e.forEach((e=>bn(o,g,e)))),e.forEach((g=>bn(o,I,g))),e.forEach((g=>bn(o,_t[l]||{},g))),e.forEach((g=>bn(o,tI,g))),e.forEach((g=>bn(o,qt,g)))}));const a=Array.from(o);return 0===a.length&&a.push(Object.create(null)),un.has(e)&&C.set(e,a),a}chartOptionScopes(){const{options:g,type:e}=this;return[g,_t[e]||{},tI.datasets[e]||{},{type:e},tI,qt]}resolveNamedOptions(g,e,t){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[""];const l={$shared:!0},{resolver:C,subPrefixes:n}=Zn(this._resolverCache,g,I);let o=C;if(function(g,e){const{isScriptable:t,isIndexable:I}=fI(g);for(const l of e){const e=t(l),C=I(l),n=(C||e)&&g[l];if(e&&(gt(n)||Gn(n))||C&&He(n))return!0}return!1}(C,e)){l.$shared=!1;o=kI(C,t=gt(t)?t():t,this.createResolver(g,t,n))}for(const a of e)l[a]=o[a];return l}createResolver(g,e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[""],I=arguments.length>3?arguments[3]:void 0;const{resolver:l}=Zn(this._resolverCache,g,t);return Ne(e)?kI(l,e,void 0,I):l}}function Zn(g,e,t){let I=g.get(e);I||(I=new Map,g.set(e,I));const l=t.join();let C=I.get(l);if(!C){C={resolver:JI(e,t),subPrefixes:t.filter((g=>!g.toLowerCase().includes("hover")))},I.set(l,C)}return C}const Gn=g=>Ne(g)&&Object.getOwnPropertyNames(g).some((e=>gt(g[e])));const pn=["top","bottom","left","right","chartArea"];function yn(g,e){return"top"===g||"bottom"===g||-1===pn.indexOf(g)&&"x"===e}function Bn(g,e){return function(t,I){return t[g]===I[g]?t[e]-I[e]:t[g]-I[g]}}function Sn(g){const e=g.chart,t=e.options.animation;e.notifyPlugins("afterRender"),Me(t&&t.onComplete,[g],e)}function Wn(g){const e=g.chart,t=e.options.animation;Me(t&&t.onProgress,[g],e)}function Vn(g){return OI()&&"string"===typeof g?g=document.getElementById(g):g&&g.length&&(g=g[0]),g&&g.canvas&&(g=g.canvas),g}const Rn={},Xn=g=>{const e=Vn(g);return Object.values(Rn).filter((g=>g.canvas===e)).pop()};function Jn(g,e,t){const I=Object.keys(g);for(const l of I){const I=+l;if(I>=e){const C=g[l];delete g[l],(t>0||I>e)&&(g[I+t]=C)}}}function kn(g,e,t){return g.options.clip?g[t]:e[t]}class fn{static register(){tn.add(...arguments),vn()}static unregister(){tn.remove(...arguments),vn()}constructor(g,e){const t=this.config=new hn(e),I=Vn(g),l=Xn(I);if(l)throw new Error("Canvas is already in use. Chart with ID '"+l.id+"' must be destroyed before the canvas with ID '"+l.canvas.id+"' can be reused.");const C=t.createResolver(t.chartOptionScopes(),this.getContext());this.platform=new(t.platform||function(g){return!OI()||"undefined"!==typeof OffscreenCanvas&&g instanceof OffscreenCanvas?RC:EC}(I)),this.platform.updateConfig(t);const n=this.platform.acquireContext(I,C.aspectRatio),o=n&&n.canvas,a=o&&o.height,i=o&&o.width;this.id=Ye(),this.ctx=n,this.canvas=o,this.width=i,this.height=a,this._options=C,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new In,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(g,e){let t;return function(){for(var I=arguments.length,l=new Array(I),C=0;C<I;C++)l[C]=arguments[C];return e?(clearTimeout(t),t=setTimeout(g,e,l)):g.apply(this,l),e}}((g=>this.update(g)),C.resizeDelay||0),this._dataChanges=[],Rn[this.id]=this,n&&o?(Bl.listen(this,"complete",Sn),Bl.listen(this,"progress",Wn),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:g,maintainAspectRatio:e},width:t,height:I,_aspectRatio:l}=this;return xe(g)?e&&l?l:I?t/I:null:g}get data(){return this.config.data}set data(g){this.config.data=g}get options(){return this._options}set options(g){this.config.options=g}get registry(){return tn}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():nl(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return nI(this.canvas,this.ctx),this}stop(){return Bl.stop(this),this}resize(g,e){Bl.running(this)?this._resizeBeforeDraw={width:g,height:e}:this._resize(g,e)}_resize(g,e){const t=this.options,I=this.canvas,l=t.maintainAspectRatio&&this.aspectRatio,C=this.platform.getMaximumSize(I,g,e,l),n=t.devicePixelRatio||this.platform.getDevicePixelRatio(),o=this.width?"resize":"attach";this.width=C.width,this.height=C.height,this._aspectRatio=this.aspectRatio,nl(this,n,!0)&&(this.notifyPlugins("resize",{size:C}),Me(t.onResize,[this,C],this),this.attached&&this._doResize(o)&&this.render())}ensureScalesHaveIDs(){Ee(this.options.scales||{},((g,e)=>{g.id=e}))}buildOrUpdateScales(){const g=this.options,e=g.scales,t=this.scales,I=Object.keys(t).reduce(((g,e)=>(g[e]=!1,g)),{});let l=[];e&&(l=l.concat(Object.keys(e).map((g=>{const t=e[g],I=an(g,t),l="r"===I,C="x"===I;return{options:t,dposition:l?"chartArea":C?"bottom":"left",dtype:l?"radialLinear":C?"category":"linear"}})))),Ee(l,(e=>{const l=e.options,C=l.id,n=an(C,l),o=Ke(l.type,e.dtype);void 0!==l.position&&yn(l.position,n)===yn(e.dposition)||(l.position=e.dposition),I[C]=!0;let a=null;if(C in t&&t[C].type===o)a=t[C];else{a=new(tn.getScale(o))({id:C,type:o,ctx:this.ctx,chart:this}),t[a.id]=a}a.init(l,g)})),Ee(I,((g,e)=>{g||delete t[e]})),Ee(t,(g=>{WC.configure(this,g,g.options),WC.addBox(this,g)}))}_updateMetasets(){const g=this._metasets,e=this.data.datasets.length,t=g.length;if(g.sort(((g,e)=>g.index-e.index)),t>e){for(let g=e;g<t;++g)this._destroyDatasetMeta(g);g.splice(e,t-e)}this._sortedMetasets=g.slice(0).sort(Bn("order","index"))}_removeUnreferencedMetasets(){const{_metasets:g,data:{datasets:e}}=this;g.length>e.length&&delete this._stacks,g.forEach(((g,t)=>{0===e.filter((e=>e===g._dataset)).length&&this._destroyDatasetMeta(t)}))}buildOrUpdateControllers(){const g=[],e=this.data.datasets;let t,I;for(this._removeUnreferencedMetasets(),t=0,I=e.length;t<I;t++){const I=e[t];let l=this.getDatasetMeta(t);const C=I.type||this.config.type;if(l.type&&l.type!==C&&(this._destroyDatasetMeta(t),l=this.getDatasetMeta(t)),l.type=C,l.indexAxis=I.indexAxis||nn(C,this.options),l.order=I.order||0,l.index=t,l.label=""+I.label,l.visible=this.isDatasetVisible(t),l.controller)l.controller.updateIndex(t),l.controller.linkScales();else{const e=tn.getController(C),{datasetElementType:I,dataElementType:n}=tI.datasets[C];Object.assign(e,{dataElementType:tn.getElement(n),datasetElementType:I&&tn.getElement(I)}),l.controller=new e(this,t),g.push(l.controller)}}return this._updateMetasets(),g}_resetElements(){Ee(this.data.datasets,((g,e)=>{this.getDatasetMeta(e).controller.reset()}),this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(g){const e=this.config;e.update();const t=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),I=this._animationsDisabled=!t.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:g,cancelable:!0}))return;const l=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let C=0;for(let a=0,i=this.data.datasets.length;a<i;a++){const{controller:g}=this.getDatasetMeta(a),e=!I&&-1===l.indexOf(g);g.buildOrUpdateElements(e),C=Math.max(+g.getMaxOverflow(),C)}C=this._minPadding=t.layout.autoPadding?C:0,this._updateLayout(C),I||Ee(l,(g=>{g.reset()})),this._updateDatasets(g),this.notifyPlugins("afterUpdate",{mode:g}),this._layers.sort(Bn("z","_idx"));const{_active:n,_lastEvent:o}=this;o?this._eventHandler(o,!0):n.length&&this._updateHoverStyles(n,n,!0),this.render()}_updateScales(){Ee(this.scales,(g=>{WC.removeBox(this,g)})),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const g=this.options,e=new Set(Object.keys(this._listeners)),t=new Set(g.events);et(e,t)&&!!this._responsiveListeners===g.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:g}=this,e=this._getUniformDataChanges()||[];for(const{method:t,start:I,count:l}of e){Jn(g,I,"_removeElements"===t?-l:l)}}_getUniformDataChanges(){const g=this._dataChanges;if(!g||!g.length)return;this._dataChanges=[];const e=this.data.datasets.length,t=e=>new Set(g.filter((g=>g[0]===e)).map(((g,e)=>e+","+g.splice(1).join(",")))),I=t(0);for(let l=1;l<e;l++)if(!et(I,t(l)))return;return Array.from(I).map((g=>g.split(","))).map((g=>({method:g[1],start:+g[2],count:+g[3]})))}_updateLayout(g){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;WC.update(this,this.width,this.height,g);const e=this.chartArea,t=e.width<=0||e.height<=0;this._layers=[],Ee(this.boxes,(g=>{t&&"chartArea"===g.position||(g.configure&&g.configure(),this._layers.push(...g._layers()))}),this),this._layers.forEach(((g,e)=>{g._idx=e})),this.notifyPlugins("afterLayout")}_updateDatasets(g){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:g,cancelable:!0})){for(let g=0,e=this.data.datasets.length;g<e;++g)this.getDatasetMeta(g).controller.configure();for(let e=0,t=this.data.datasets.length;e<t;++e)this._updateDataset(e,gt(g)?g({datasetIndex:e}):g);this.notifyPlugins("afterDatasetsUpdate",{mode:g})}}_updateDataset(g,e){const t=this.getDatasetMeta(g),I={meta:t,index:g,mode:e,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",I)&&(t.controller._update(e),I.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",I))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(Bl.has(this)?this.attached&&!Bl.running(this)&&Bl.start(this):(this.draw(),Sn({chart:this})))}draw(){let g;if(this._resizeBeforeDraw){const{width:g,height:e}=this._resizeBeforeDraw;this._resize(g,e),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0)return;if(!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const e=this._layers;for(g=0;g<e.length&&e[g].z<=0;++g)e[g].draw(this.chartArea);for(this._drawDatasets();g<e.length;++g)e[g].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(g){const e=this._sortedMetasets,t=[];let I,l;for(I=0,l=e.length;I<l;++I){const l=e[I];g&&!l.visible||t.push(l)}return t}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const g=this.getSortedVisibleDatasetMetas();for(let e=g.length-1;e>=0;--e)this._drawDataset(g[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(g){const e=this.ctx,t=g._clip,I=!t.disabled,l=function(g,e){const{xScale:t,yScale:I}=g;return t&&I?{left:kn(t,e,"left"),right:kn(t,e,"right"),top:kn(I,e,"top"),bottom:kn(I,e,"bottom")}:e}(g,this.chartArea),C={meta:g,index:g.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",C)&&(I&&sI(e,{left:!1===t.left?0:l.left-t.left,right:!1===t.right?this.width:l.right+t.right,top:!1===t.top?0:l.top-t.top,bottom:!1===t.bottom?this.height:l.bottom+t.bottom}),g.controller.draw(),I&&cI(e),C.cancelable=!1,this.notifyPlugins("afterDatasetDraw",C))}isPointInArea(g){return iI(g,this.chartArea,this._minPadding)}getElementsAtEventForMode(g,e,t,I){const l=dC.modes[e];return"function"===typeof l?l(this,g,t,I):[]}getDatasetMeta(g){const e=this.data.datasets[g],t=this._metasets;let I=t.filter((g=>g&&g._dataset===e)).pop();return I||(I={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:g,_dataset:e,_parsed:[],_sorted:!1},t.push(I)),I}getContext(){return this.$context||(this.$context=XI(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(g){const e=this.data.datasets[g];if(!e)return!1;const t=this.getDatasetMeta(g);return"boolean"===typeof t.hidden?!t.hidden:!e.hidden}setDatasetVisibility(g,e){this.getDatasetMeta(g).hidden=!e}toggleDataVisibility(g){this._hiddenIndices[g]=!this._hiddenIndices[g]}getDataVisibility(g){return!this._hiddenIndices[g]}_updateVisibility(g,e,t){const I=t?"show":"hide",l=this.getDatasetMeta(g),C=l.controller._resolveAnimations(void 0,I);$e(e)?(l.data[e].hidden=!t,this.update()):(this.setDatasetVisibility(g,t),C.update(l,{visible:t}),this.update((e=>e.datasetIndex===g?I:void 0)))}hide(g,e){this._updateVisibility(g,e,!1)}show(g,e){this._updateVisibility(g,e,!0)}_destroyDatasetMeta(g){const e=this._metasets[g];e&&e.controller&&e.controller._destroy(),delete this._metasets[g]}_stop(){let g,e;for(this.stop(),Bl.remove(this),g=0,e=this.data.datasets.length;g<e;++g)this._destroyDatasetMeta(g)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:g,ctx:e}=this;this._stop(),this.config.clearCache(),g&&(this.unbindEvents(),nI(g,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete Rn[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(){return this.canvas.toDataURL(...arguments)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const g=this._listeners,e=this.platform,t=(t,I)=>{e.addEventListener(this,t,I),g[t]=I},I=(g,e,t)=>{g.offsetX=e,g.offsetY=t,this._eventHandler(g)};Ee(this.options.events,(g=>t(g,I)))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const g=this._responsiveListeners,e=this.platform,t=(t,I)=>{e.addEventListener(this,t,I),g[t]=I},I=(t,I)=>{g[t]&&(e.removeEventListener(this,t,I),delete g[t])},l=(g,e)=>{this.canvas&&this.resize(g,e)};let C;const n=()=>{I("attach",n),this.attached=!0,this.resize(),t("resize",l),t("detach",C)};C=()=>{this.attached=!1,I("resize",l),this._stop(),this._resize(0,0),t("attach",n)},e.isAttached(this.canvas)?n():C()}unbindEvents(){Ee(this._listeners,((g,e)=>{this.platform.removeEventListener(this,e,g)})),this._listeners={},Ee(this._responsiveListeners,((g,e)=>{this.platform.removeEventListener(this,e,g)})),this._responsiveListeners=void 0}updateHoverStyle(g,e,t){const I=t?"set":"remove";let l,C,n,o;for("dataset"===e&&(l=this.getDatasetMeta(g[0].datasetIndex),l.controller["_"+I+"DatasetHoverStyle"]()),n=0,o=g.length;n<o;++n){C=g[n];const e=C&&this.getDatasetMeta(C.datasetIndex).controller;e&&e[I+"HoverStyle"](C.element,C.datasetIndex,C.index)}}getActiveElements(){return this._active||[]}setActiveElements(g){const e=this._active||[],t=g.map((g=>{let{datasetIndex:e,index:t}=g;const I=this.getDatasetMeta(e);if(!I)throw new Error("No dataset found at index "+e);return{datasetIndex:e,element:I.data[t],index:t}}));!Qe(t,e)&&(this._active=t,this._lastEvent=null,this._updateHoverStyles(t,e))}notifyPlugins(g,e,t){return this._plugins.notify(this,g,e,t)}isPluginEnabled(g){return 1===this._plugins._cache.filter((e=>e.plugin.id===g)).length}_updateHoverStyles(g,e,t){const I=this.options.hover,l=(g,e)=>g.filter((g=>!e.some((e=>g.datasetIndex===e.datasetIndex&&g.index===e.index)))),C=l(e,g),n=t?g:l(g,e);C.length&&this.updateHoverStyle(C,I.mode,!1),n.length&&I.mode&&this.updateHoverStyle(n,I.mode,!0)}_eventHandler(g,e){const t={event:g,replay:e,cancelable:!0,inChartArea:this.isPointInArea(g)},I=e=>(e.options.events||this.options.events).includes(g.native.type);if(!1===this.notifyPlugins("beforeEvent",t,I))return;const l=this._handleEvent(g,e,t.inChartArea);return t.cancelable=!1,this.notifyPlugins("afterEvent",t,I),(l||t.changed)&&this.render(),this}_handleEvent(g,e,t){const{_active:I=[],options:l}=this,C=e,n=this._getActiveElements(g,I,t,C),o=function(g){return"mouseup"===g.type||"click"===g.type||"contextmenu"===g.type}(g),a=function(g,e,t,I){return t&&"mouseout"!==g.type?I?e:g:null}(g,this._lastEvent,t,o);t&&(this._lastEvent=null,Me(l.onHover,[g,n,this],this),o&&Me(l.onClick,[g,n,this],this));const i=!Qe(n,I);return(i||e)&&(this._active=n,this._updateHoverStyles(n,I,e)),this._lastEvent=a,i}_getActiveElements(g,e,t,I){if("mouseout"===g.type)return[];if(!t)return e;const l=this.options.hover;return this.getElementsAtEventForMode(g,l.mode,l,I)}}function vn(){return Ee(fn.instances,(g=>g._plugins.invalidate()))}function Yn(g,e,t,I){const l=yI(g.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]);const C=(t-e)/2,n=Math.min(C,I*e/2),o=g=>{const e=(t-Math.min(C,g))*I/2;return St(g,0,Math.min(C,e))};return{outerStart:o(l.outerStart),outerEnd:o(l.outerEnd),innerStart:St(l.innerStart,0,n),innerEnd:St(l.innerEnd,0,n)}}function xn(g,e,t,I){return{x:t+g*Math.cos(e),y:I+g*Math.sin(e)}}function Hn(g,e,t,I,l,C){const{x:n,y:o,startAngle:a,pixelMargin:i,innerRadius:s}=e,c=Math.max(e.outerRadius+I+t-i,0),d=s>0?s+I+t+i:0;let A=0;const r=l-a;if(I){const g=((s>0?s-I:0)+(c>0?c-I:0))/2;A=(r-(0!==g?r*g/(g+I):r))/2}const u=(r-Math.max(.001,r*c-t/tt)/c)/2,m=a+u+A,b=l-u-A,{outerStart:h,outerEnd:Z,innerStart:G,innerEnd:p}=Yn(e,d,c,b-m),y=c-h,B=c-Z,S=m+h/y,W=b-Z/B,V=d+G,R=d+p,X=m+G/V,J=b-p/R;if(g.beginPath(),C){const e=(S+W)/2;if(g.arc(n,o,c,S,e),g.arc(n,o,c,e,W),Z>0){const e=xn(B,W,n,o);g.arc(e.x,e.y,Z,W,b+ot)}const t=xn(R,b,n,o);if(g.lineTo(t.x,t.y),p>0){const e=xn(R,J,n,o);g.arc(e.x,e.y,p,b+ot,J+Math.PI)}const I=(b-p/d+(m+G/d))/2;if(g.arc(n,o,d,b-p/d,I,!0),g.arc(n,o,d,I,m+G/d,!0),G>0){const e=xn(V,X,n,o);g.arc(e.x,e.y,G,X+Math.PI,m-ot)}const l=xn(y,m,n,o);if(g.lineTo(l.x,l.y),h>0){const e=xn(y,S,n,o);g.arc(e.x,e.y,h,m-ot,S)}}else{g.moveTo(n,o);const e=Math.cos(S)*c+n,t=Math.sin(S)*c+o;g.lineTo(e,t);const I=Math.cos(W)*c+n,l=Math.sin(W)*c+o;g.lineTo(I,l)}g.closePath()}function Nn(g,e,t,I,l){const{fullCircles:C,startAngle:n,circumference:o,options:a}=e,{borderWidth:i,borderJoinStyle:s,borderDash:c,borderDashOffset:d}=a,A="inner"===a.borderAlign;if(!i)return;g.setLineDash(c||[]),g.lineDashOffset=d,A?(g.lineWidth=2*i,g.lineJoin=s||"round"):(g.lineWidth=i,g.lineJoin=s||"bevel");let r=e.endAngle;if(C){Hn(g,e,t,I,r,l);for(let e=0;e<C;++e)g.stroke();isNaN(o)||(r=n+(o%It||It))}A&&function(g,e,t){const{startAngle:I,pixelMargin:l,x:C,y:n,outerRadius:o,innerRadius:a}=e;let i=l/o;g.beginPath(),g.arc(C,n,o,I-i,t+i),a>l?(i=l/a,g.arc(C,n,a,t+i,I-i,!0)):g.arc(C,n,l,t+ot,I-ot),g.closePath(),g.clip()}(g,e,r),C||(Hn(g,e,t,I,r,l),g.stroke())}qg(fn,"defaults",tI),qg(fn,"instances",Rn),qg(fn,"overrides",_t),qg(fn,"registry",tn),qg(fn,"version","4.4.1"),qg(fn,"getChart",Xn);class wn extends QC{constructor(g){super(),qg(this,"circumference",void 0),qg(this,"endAngle",void 0),qg(this,"fullCircles",void 0),qg(this,"innerRadius",void 0),qg(this,"outerRadius",void 0),qg(this,"pixelMargin",void 0),qg(this,"startAngle",void 0),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,g&&Object.assign(this,g)}inRange(g,e,t){const I=this.getProps(["x","y"],t),{angle:l,distance:C}=Zt(I,{x:g,y:e}),{startAngle:n,endAngle:o,innerRadius:a,outerRadius:i,circumference:s}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],t),c=(this.options.spacing+this.options.borderWidth)/2,d=Ke(s,o-n)>=It||Bt(l,n,o),A=Wt(C,a+c,i+c);return d&&A}getCenterPoint(g){const{x:e,y:t,startAngle:I,endAngle:l,innerRadius:C,outerRadius:n}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],g),{offset:o,spacing:a}=this.options,i=(I+l)/2,s=(C+n+a+o)/2;return{x:e+Math.cos(i)*s,y:t+Math.sin(i)*s}}tooltipPosition(g){return this.getCenterPoint(g)}draw(g){const{options:e,circumference:t}=this,I=(e.offset||0)/4,l=(e.spacing||0)/2,C=e.circular;if(this.pixelMargin="inner"===e.borderAlign?.33:0,this.fullCircles=t>It?Math.floor(t/It):0,0===t||this.innerRadius<0||this.outerRadius<0)return;g.save();const n=(this.startAngle+this.endAngle)/2;g.translate(Math.cos(n)*I,Math.sin(n)*I);const o=I*(1-Math.sin(Math.min(tt,t||0)));g.fillStyle=e.backgroundColor,g.strokeStyle=e.borderColor,function(g,e,t,I,l){const{fullCircles:C,startAngle:n,circumference:o}=e;let a=e.endAngle;if(C){Hn(g,e,t,I,a,l);for(let e=0;e<C;++e)g.fill();isNaN(o)||(a=n+(o%It||It))}Hn(g,e,t,I,a,l),g.fill()}(g,this,o,l,C),Nn(g,this,o,l,C),g.restore()}}function Fn(g,e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;g.lineCap=Ke(t.borderCapStyle,e.borderCapStyle),g.setLineDash(Ke(t.borderDash,e.borderDash)),g.lineDashOffset=Ke(t.borderDashOffset,e.borderDashOffset),g.lineJoin=Ke(t.borderJoinStyle,e.borderJoinStyle),g.lineWidth=Ke(t.borderWidth,e.borderWidth),g.strokeStyle=Ke(t.borderColor,e.borderColor)}function Kn(g,e,t){g.lineTo(t.x,t.y)}function zn(g,e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const I=g.length,{start:l=0,end:C=I-1}=t,{start:n,end:o}=e,a=Math.max(l,n),i=Math.min(C,o),s=l<n&&C<n||l>o&&C>o;return{count:I,start:a,loop:e.loop,ilen:i<a&&!s?I+i-a:i-a}}function Mn(g,e,t,I){const{points:l,options:C}=e,{count:n,start:o,loop:a,ilen:i}=zn(l,t,I),s=function(g){return g.stepped?dI:g.tension||"monotone"===g.cubicInterpolationMode?AI:Kn}(C);let c,d,A,{move:r=!0,reverse:u}=I||{};for(c=0;c<=i;++c)d=l[(o+(u?i-c:c))%n],d.skip||(r?(g.moveTo(d.x,d.y),r=!1):s(g,A,d,u,C.stepped),A=d);return a&&(d=l[(o+(u?i:0))%n],s(g,A,d,u,C.stepped)),!!a}function En(g,e,t,I){const l=e.points,{count:C,start:n,ilen:o}=zn(l,t,I),{move:a=!0,reverse:i}=I||{};let s,c,d,A,r,u,m=0,b=0;const h=g=>(n+(i?o-g:g))%C,Z=()=>{A!==r&&(g.lineTo(m,r),g.lineTo(m,A),g.lineTo(m,u))};for(a&&(c=l[h(0)],g.moveTo(c.x,c.y)),s=0;s<=o;++s){if(c=l[h(s)],c.skip)continue;const e=c.x,t=c.y,I=0|e;I===d?(t<A?A=t:t>r&&(r=t),m=(b*m+e)/++b):(Z(),g.lineTo(e,t),d=I,b=0,A=r=t),u=t}Z()}function Qn(g){const e=g.options,t=e.borderDash&&e.borderDash.length;return!g._decimated&&!g._loop&&!e.tension&&"monotone"!==e.cubicInterpolationMode&&!e.stepped&&!t?En:Mn}qg(wn,"id","arc"),qg(wn,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),qg(wn,"defaultRoutes",{backgroundColor:"backgroundColor"}),qg(wn,"descriptors",{_scriptable:!0,_indexable:g=>"borderDash"!==g});const Un="function"===typeof Path2D;function Ln(g,e,t,I){Un&&!e.options.segment?function(g,e,t,I){let l=e._path;l||(l=e._path=new Path2D,e.path(l,t,I)&&l.closePath()),Fn(g,e.options),g.stroke(l)}(g,e,t,I):function(g,e,t,I){const{segments:l,options:C}=e,n=Qn(e);for(const o of l)Fn(g,C,o.style),g.beginPath(),n(g,e,o,{start:t,end:t+I-1})&&g.closePath(),g.stroke()}(g,e,t,I)}class jn extends QC{constructor(g){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,g&&Object.assign(this,g)}updateControlPoints(g,e){const t=this.options;if((t.tension||"monotone"===t.cubicInterpolationMode)&&!t.stepped&&!this._pointsUpdated){const I=t.spanGaps?this._loop:this._fullLoop;PI(this._points,t,g,I,e),this._pointsUpdated=!0}}set points(g){this._points=g,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(g,e){const t=g.points,I=g.options.spanGaps,l=t.length;if(!l)return[];const C=!!g._loop,{start:n,end:o}=function(g,e,t,I){let l=0,C=e-1;if(t&&!I)for(;l<e&&!g[l].skip;)l++;for(;l<e&&g[l].skip;)l++;for(l%=e,t&&(C+=l);C>l&&g[C%e].skip;)C--;return C%=e,{start:l,end:C}}(t,l,C,I);return Zl(g,!0===I?[{start:n,end:o,loop:C}]:function(g,e,t,I){const l=g.length,C=[];let n,o=e,a=g[e];for(n=e+1;n<=t;++n){const t=g[n%l];t.skip||t.stop?a.skip||(I=!1,C.push({start:e%l,end:(n-1)%l,loop:I}),e=o=t.stop?n:null):(o=n,a.skip&&(e=n)),a=t}return null!==o&&C.push({start:e%l,end:o%l,loop:I}),C}(t,n,o<n?o+l:o,!!g._fullLoop&&0===n&&o===l-1),t,e)}(this,this.options.segment))}first(){const g=this.segments,e=this.points;return g.length&&e[g[0].start]}last(){const g=this.segments,e=this.points,t=g.length;return t&&e[g[t-1].end]}interpolate(g,e){const t=this.options,I=g[e],l=this.points,C=hl(this,{property:e,start:I,end:I});if(!C.length)return;const n=[],o=function(g){return g.stepped?sl:g.tension||"monotone"===g.cubicInterpolationMode?cl:il}(t);let a,i;for(a=0,i=C.length;a<i;++a){const{start:i,end:s}=C[a],c=l[i],d=l[s];if(c===d){n.push(c);continue}const A=o(c,d,Math.abs((I-c[e])/(d[e]-c[e])),t.stepped);A[e]=g[e],n.push(A)}return 1===n.length?n[0]:n}pathSegment(g,e,t){return Qn(this)(g,this,e,t)}path(g,e,t){const I=this.segments,l=Qn(this);let C=this._loop;e=e||0,t=t||this.points.length-e;for(const n of I)C&=l(g,this,n,{start:e,end:e+t-1});return!!C}draw(g,e,t,I){const l=this.options||{};(this.points||[]).length&&l.borderWidth&&(g.save(),Ln(g,this,t,I),g.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function Dn(g,e,t,I){const l=g.options,{[t]:C}=g.getProps([t],I);return Math.abs(e-C)<l.radius+l.hitRadius}qg(jn,"id","line"),qg(jn,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),qg(jn,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),qg(jn,"descriptors",{_scriptable:!0,_indexable:g=>"borderDash"!==g&&"fill"!==g});class Tn extends QC{constructor(g){super(),qg(this,"parsed",void 0),qg(this,"skip",void 0),qg(this,"stop",void 0),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,g&&Object.assign(this,g)}inRange(g,e,t){const I=this.options,{x:l,y:C}=this.getProps(["x","y"],t);return Math.pow(g-l,2)+Math.pow(e-C,2)<Math.pow(I.hitRadius+I.radius,2)}inXRange(g,e){return Dn(this,g,"x",e)}inYRange(g,e){return Dn(this,g,"y",e)}getCenterPoint(g){const{x:e,y:t}=this.getProps(["x","y"],g);return{x:e,y:t}}size(g){let e=(g=g||this.options||{}).radius||0;e=Math.max(e,e&&g.hoverRadius||0);return 2*(e+(e&&g.borderWidth||0))}draw(g,e){const t=this.options;this.skip||t.radius<.1||!iI(this,e,this.size(t)/2)||(g.strokeStyle=t.borderColor,g.lineWidth=t.borderWidth,g.fillStyle=t.backgroundColor,oI(g,t,this.x,this.y))}getRange(){const g=this.options||{};return g.radius+g.hitRadius}}function Pn(g,e){const{x:t,y:I,base:l,width:C,height:n}=g.getProps(["x","y","base","width","height"],e);let o,a,i,s,c;return g.horizontal?(c=n/2,o=Math.min(t,l),a=Math.max(t,l),i=I-c,s=I+c):(c=C/2,o=t-c,a=t+c,i=Math.min(I,l),s=Math.max(I,l)),{left:o,top:i,right:a,bottom:s}}function On(g,e,t,I){return g?0:St(e,t,I)}function _n(g){const e=Pn(g),t=e.right-e.left,I=e.bottom-e.top,l=function(g,e,t){const I=g.options.borderWidth,l=g.borderSkipped,C=BI(I);return{t:On(l.top,C.top,0,t),r:On(l.right,C.right,0,e),b:On(l.bottom,C.bottom,0,t),l:On(l.left,C.left,0,e)}}(g,t/2,I/2),C=function(g,e,t){const{enableBorderRadius:I}=g.getProps(["enableBorderRadius"]),l=g.options.borderRadius,C=SI(l),n=Math.min(e,t),o=g.borderSkipped,a=I||Ne(l);return{topLeft:On(!a||o.top||o.left,C.topLeft,0,n),topRight:On(!a||o.top||o.right,C.topRight,0,n),bottomLeft:On(!a||o.bottom||o.left,C.bottomLeft,0,n),bottomRight:On(!a||o.bottom||o.right,C.bottomRight,0,n)}}(g,t/2,I/2);return{outer:{x:e.left,y:e.top,w:t,h:I,radius:C},inner:{x:e.left+l.l,y:e.top+l.t,w:t-l.l-l.r,h:I-l.t-l.b,radius:{topLeft:Math.max(0,C.topLeft-Math.max(l.t,l.l)),topRight:Math.max(0,C.topRight-Math.max(l.t,l.r)),bottomLeft:Math.max(0,C.bottomLeft-Math.max(l.b,l.l)),bottomRight:Math.max(0,C.bottomRight-Math.max(l.b,l.r))}}}}function qn(g,e,t,I){const l=null===e,C=null===t,n=g&&!(l&&C)&&Pn(g,I);return n&&(l||Wt(e,n.left,n.right))&&(C||Wt(t,n.top,n.bottom))}function $n(g,e){g.rect(e.x,e.y,e.w,e.h)}function go(g,e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const I=g.x!==t.x?-e:0,l=g.y!==t.y?-e:0,C=(g.x+g.w!==t.x+t.w?e:0)-I,n=(g.y+g.h!==t.y+t.h?e:0)-l;return{x:g.x+I,y:g.y+l,w:g.w+C,h:g.h+n,radius:g.radius}}qg(Tn,"id","point"),qg(Tn,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),qg(Tn,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});class eo extends QC{constructor(g){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,g&&Object.assign(this,g)}draw(g){const{inflateAmount:e,options:{borderColor:t,backgroundColor:I}}=this,{inner:l,outer:C}=_n(this),n=(o=C.radius).topLeft||o.topRight||o.bottomLeft||o.bottomRight?bI:$n;var o;g.save(),C.w===l.w&&C.h===l.h||(g.beginPath(),n(g,go(C,e,l)),g.clip(),n(g,go(l,-e,C)),g.fillStyle=t,g.fill("evenodd")),g.beginPath(),n(g,go(l,e)),g.fillStyle=I,g.fill(),g.restore()}inRange(g,e,t){return qn(this,g,e,t)}inXRange(g,e){return qn(this,g,null,e)}inYRange(g,e){return qn(this,null,g,e)}getCenterPoint(g){const{x:e,y:t,base:I,horizontal:l}=this.getProps(["x","y","base","horizontal"],g);return{x:l?(e+I)/2:e,y:l?t:(t+I)/2}}getRange(g){return"x"===g?this.width/2:this.height/2}}qg(eo,"id","bar"),qg(eo,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),qg(eo,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var to=Object.freeze({__proto__:null,ArcElement:wn,BarElement:eo,LineElement:jn,PointElement:Tn});const Io=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],lo=Io.map((g=>g.replace("rgb(","rgba(").replace(")",", 0.5)")));function Co(g){return Io[g%Io.length]}function no(g){return lo[g%lo.length]}function oo(g){let e=0;return(t,I)=>{const l=g.getDatasetMeta(I).controller;l instanceof Ol?e=function(g,e){return g.backgroundColor=g.data.map((()=>Co(e++))),e}(t,e):l instanceof ql?e=function(g,e){return g.backgroundColor=g.data.map((()=>no(e++))),e}(t,e):l&&(e=function(g,e){return g.borderColor=Co(e),g.backgroundColor=no(e),++e}(t,e))}}function ao(g){let e;for(e in g)if(g[e].borderColor||g[e].backgroundColor)return!0;return!1}var io={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(g,e,t){if(!t.enabled)return;const{data:{datasets:I},options:l}=g.config,{elements:C}=l;if(!t.forceOverride&&(ao(I)||(n=l)&&(n.borderColor||n.backgroundColor)||C&&ao(C)))return;var n;const o=oo(g);I.forEach(o)}};function so(g){if(g._decimated){const e=g._data;delete g._decimated,delete g._data,Object.defineProperty(g,"data",{configurable:!0,enumerable:!0,writable:!0,value:e})}}function co(g){g.data.datasets.forEach((g=>{so(g)}))}var Ao={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(g,e,t)=>{if(!t.enabled)return void co(g);const I=g.width;g.data.datasets.forEach(((e,l)=>{const{_data:C,indexAxis:n}=e,o=g.getDatasetMeta(l),a=C||e.data;if("y"===RI([n,g.options.indexAxis]))return;if(!o.controller.supportsDecimation)return;const i=g.scales[o.xAxisID];if("linear"!==i.type&&"time"!==i.type)return;if(g.options.parsing)return;let{start:s,count:c}=function(g,e){const t=e.length;let I,l=0;const{iScale:C}=g,{min:n,max:o,minDefined:a,maxDefined:i}=C.getUserBounds();return a&&(l=St(Rt(e,C.axis,n).lo,0,t-1)),I=i?St(Rt(e,C.axis,o).hi+1,l,t)-l:t-l,{start:l,count:I}}(o,a);if(c<=(t.threshold||4*I))return void so(e);let d;switch(xe(C)&&(e._data=a,delete e.data,Object.defineProperty(e,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(g){this._data=g}})),t.algorithm){case"lttb":d=function(g,e,t,I,l){const C=l.samples||I;if(C>=t)return g.slice(e,e+t);const n=[],o=(t-2)/(C-2);let a=0;const i=e+t-1;let s,c,d,A,r,u=e;for(n[a++]=g[u],s=0;s<C-2;s++){let I,l=0,C=0;const i=Math.floor((s+1)*o)+1+e,m=Math.min(Math.floor((s+2)*o)+1,t)+e,b=m-i;for(I=i;I<m;I++)l+=g[I].x,C+=g[I].y;l/=b,C/=b;const h=Math.floor(s*o)+1+e,Z=Math.min(Math.floor((s+1)*o)+1,t)+e,{x:G,y:p}=g[u];for(d=A=-1,I=h;I<Z;I++)A=.5*Math.abs((G-l)*(g[I].y-p)-(G-g[I].x)*(C-p)),A>d&&(d=A,c=g[I],r=I);n[a++]=c,u=r}return n[a++]=g[i],n}(a,s,c,I,t);break;case"min-max":d=function(g,e,t,I){let l,C,n,o,a,i,s,c,d,A,r=0,u=0;const m=[],b=e+t-1,h=g[e].x,Z=g[b].x-h;for(l=e;l<e+t;++l){C=g[l],n=(C.x-h)/Z*I,o=C.y;const e=0|n;if(e===a)o<d?(d=o,i=l):o>A&&(A=o,s=l),r=(u*r+C.x)/++u;else{const t=l-1;if(!xe(i)&&!xe(s)){const e=Math.min(i,s),I=Math.max(i,s);e!==c&&e!==t&&m.push({...g[e],x:r}),I!==c&&I!==t&&m.push({...g[I],x:r})}l>0&&t!==c&&m.push(g[t]),m.push(C),a=e,u=0,d=A=o,i=s=c=l}}return m}(a,s,c,I);break;default:throw new Error("Unsupported decimation algorithm '".concat(t.algorithm,"'"))}e._decimated=d}))},destroy(g){co(g)}};function ro(g,e,t,I){if(I)return;let l=e[g],C=t[g];return"angle"===g&&(l=yt(l),C=yt(C)),{property:g,start:l,end:C}}function uo(g,e,t){for(;e>g;e--){const g=t[e];if(!isNaN(g.x)&&!isNaN(g.y))break}return e}function mo(g,e,t,I){return g&&e?I(g[t],e[t]):g?g[t]:e?e[t]:0}function bo(g,e){let t=[],I=!1;return He(g)?(I=!0,t=g):t=function(g,e){const{x:t=null,y:I=null}=g||{},l=e.points,C=[];return e.segments.forEach((g=>{let{start:e,end:n}=g;n=uo(e,n,l);const o=l[e],a=l[n];null!==I?(C.push({x:o.x,y:I}),C.push({x:a.x,y:I})):null!==t&&(C.push({x:t,y:o.y}),C.push({x:t,y:a.y}))})),C}(g,e),t.length?new jn({points:t,options:{tension:0},_loop:I,_fullLoop:I}):null}function ho(g){return g&&!1!==g.fill}function Zo(g,e,t){let I=g[e].fill;const l=[e];let C;if(!t)return I;for(;!1!==I&&-1===l.indexOf(I);){if(!we(I))return I;if(C=g[I],!C)return!1;if(C.visible)return I;l.push(I),I=C.fill}return!1}function Go(g,e,t){const I=function(g){const e=g.options,t=e.fill;let I=Ke(t&&t.target,t);void 0===I&&(I=!!e.backgroundColor);if(!1===I||null===I)return!1;if(!0===I)return"origin";return I}(g);if(Ne(I))return!isNaN(I.value)&&I;let l=parseFloat(I);return we(l)&&Math.floor(l)===l?function(g,e,t,I){"-"!==g&&"+"!==g||(t=e+t);if(t===e||t<0||t>=I)return!1;return t}(I[0],e,l,t):["origin","start","end","stack","shape"].indexOf(I)>=0&&I}function po(g,e,t){const I=[];for(let l=0;l<t.length;l++){const C=t[l],{first:n,last:o,point:a}=yo(C,e,"x");if(!(!a||n&&o))if(n)I.unshift(a);else if(g.push(a),!o)break}g.push(...I)}function yo(g,e,t){const I=g.interpolate(e,t);if(!I)return{};const l=I[t],C=g.segments,n=g.points;let o=!1,a=!1;for(let i=0;i<C.length;i++){const g=C[i],e=n[g.start][t],I=n[g.end][t];if(Wt(l,e,I)){o=l===e,a=l===I;break}}return{first:o,last:a,point:I}}class Bo{constructor(g){this.x=g.x,this.y=g.y,this.radius=g.radius}pathSegment(g,e,t){const{x:I,y:l,radius:C}=this;return e=e||{start:0,end:It},g.arc(I,l,C,e.end,e.start,!0),!t.bounds}interpolate(g){const{x:e,y:t,radius:I}=this,l=g.angle;return{x:e+Math.cos(l)*I,y:t+Math.sin(l)*I,angle:l}}}function So(g){const{chart:e,fill:t,line:I}=g;if(we(t))return function(g,e){const t=g.getDatasetMeta(e),I=t&&g.isDatasetVisible(e);return I?t.dataset:null}(e,t);if("stack"===t)return function(g){const{scale:e,index:t,line:I}=g,l=[],C=I.segments,n=I.points,o=function(g,e){const t=[],I=g.getMatchingVisibleMetas("line");for(let l=0;l<I.length;l++){const g=I[l];if(g.index===e)break;g.hidden||t.unshift(g.dataset)}return t}(e,t);o.push(bo({x:null,y:e.bottom},I));for(let a=0;a<C.length;a++){const g=C[a];for(let e=g.start;e<=g.end;e++)po(l,n[e],o)}return new jn({points:l,options:{}})}(g);if("shape"===t)return!0;const l=function(g){const e=g.scale||{};if(e.getPointPositionForValue)return function(g){const{scale:e,fill:t}=g,I=e.options,l=e.getLabels().length,C=I.reverse?e.max:e.min,n=function(g,e,t){let I;return I="start"===g?t:"end"===g?e.options.reverse?e.min:e.max:Ne(g)?g.value:e.getBaseValue(),I}(t,e,C),o=[];if(I.grid.circular){const g=e.getPointPositionForValue(0,C);return new Bo({x:g.x,y:g.y,radius:e.getDistanceFromCenterForValue(n)})}for(let a=0;a<l;++a)o.push(e.getPointPositionForValue(a,n));return o}(g);return function(g){const{scale:e={},fill:t}=g,I=function(g,e){let t=null;return"start"===g?t=e.bottom:"end"===g?t=e.top:Ne(g)?t=e.getPixelForValue(g.value):e.getBasePixel&&(t=e.getBasePixel()),t}(t,e);if(we(I)){const g=e.isHorizontal();return{x:g?I:null,y:g?null:I}}return null}(g)}(g);return l instanceof Bo?l:bo(l,I)}function Wo(g,e,t){const I=So(e),{line:l,scale:C,axis:n}=e,o=l.options,a=o.fill,i=o.backgroundColor,{above:s=i,below:c=i}=a||{};I&&l.points.length&&(sI(g,t),function(g,e){const{line:t,target:I,above:l,below:C,area:n,scale:o}=e,a=t._loop?"angle":e.axis;g.save(),"x"===a&&C!==l&&(Vo(g,I,n.top),Ro(g,{line:t,target:I,color:l,scale:o,property:a}),g.restore(),g.save(),Vo(g,I,n.bottom));Ro(g,{line:t,target:I,color:C,scale:o,property:a}),g.restore()}(g,{line:l,target:I,above:s,below:c,area:t,scale:C,axis:n}),cI(g))}function Vo(g,e,t){const{segments:I,points:l}=e;let C=!0,n=!1;g.beginPath();for(const o of I){const{start:I,end:a}=o,i=l[I],s=l[uo(I,a,l)];C?(g.moveTo(i.x,i.y),C=!1):(g.lineTo(i.x,t),g.lineTo(i.x,i.y)),n=!!e.pathSegment(g,o,{move:n}),n?g.closePath():g.lineTo(s.x,t)}g.lineTo(e.first().x,t),g.closePath(),g.clip()}function Ro(g,e){const{line:t,target:I,property:l,color:C,scale:n}=e,o=function(g,e,t){const I=g.segments,l=g.points,C=e.points,n=[];for(const o of I){let{start:g,end:I}=o;I=uo(g,I,l);const a=ro(t,l[g],l[I],o.loop);if(!e.segments){n.push({source:o,target:a,start:l[g],end:l[I]});continue}const i=hl(e,a);for(const e of i){const g=ro(t,C[e.start],C[e.end],e.loop),I=bl(o,l,g);for(const l of I)n.push({source:l,target:e,start:{[t]:mo(a,g,"start",Math.max)},end:{[t]:mo(a,g,"end",Math.min)}})}}return n}(t,I,l);for(const{source:a,target:i,start:s,end:c}of o){const{style:{backgroundColor:e=C}={}}=a,o=!0!==I;g.save(),g.fillStyle=e,Xo(g,n,o&&ro(l,s,c)),g.beginPath();const d=!!t.pathSegment(g,a);let A;if(o){d?g.closePath():Jo(g,I,c,l);const e=!!I.pathSegment(g,i,{move:d,reverse:!0});A=d&&e,A||Jo(g,I,s,l)}g.closePath(),g.fill(A?"evenodd":"nonzero"),g.restore()}}function Xo(g,e,t){const{top:I,bottom:l}=e.chart.chartArea,{property:C,start:n,end:o}=t||{};"x"===C&&(g.beginPath(),g.rect(n,I,o-n,l-I),g.clip())}function Jo(g,e,t,I){const l=e.interpolate(t,I);l&&g.lineTo(l.x,l.y)}var ko={id:"filler",afterDatasetsUpdate(g,e,t){const I=(g.data.datasets||[]).length,l=[];let C,n,o,a;for(n=0;n<I;++n)C=g.getDatasetMeta(n),o=C.dataset,a=null,o&&o.options&&o instanceof jn&&(a={visible:g.isDatasetVisible(n),index:n,fill:Go(o,n,I),chart:g,axis:C.controller.options.indexAxis,scale:C.vScale,line:o}),C.$filler=a,l.push(a);for(n=0;n<I;++n)a=l[n],a&&!1!==a.fill&&(a.fill=Zo(l,n,t.propagate))},beforeDraw(g,e,t){const I="beforeDraw"===t.drawTime,l=g.getSortedVisibleDatasetMetas(),C=g.chartArea;for(let n=l.length-1;n>=0;--n){const e=l[n].$filler;e&&(e.line.updateControlPoints(C,e.axis),I&&e.fill&&Wo(g.ctx,e,C))}},beforeDatasetsDraw(g,e,t){if("beforeDatasetsDraw"!==t.drawTime)return;const I=g.getSortedVisibleDatasetMetas();for(let l=I.length-1;l>=0;--l){const e=I[l].$filler;ho(e)&&Wo(g.ctx,e,g.chartArea)}},beforeDatasetDraw(g,e,t){const I=e.meta.$filler;ho(I)&&"beforeDatasetDraw"===t.drawTime&&Wo(g.ctx,I,g.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const fo=(g,e)=>{let{boxHeight:t=e,boxWidth:I=e}=g;return g.usePointStyle&&(t=Math.min(t,e),I=g.pointStyleWidth||Math.min(I,e)),{boxWidth:I,boxHeight:t,itemHeight:Math.max(e,t)}};class vo extends QC{constructor(g){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=g.chart,this.options=g.options,this.ctx=g.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(g,e,t){this.maxWidth=g,this.maxHeight=e,this._margins=t,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const g=this.options.labels||{};let e=Me(g.generateLabels,[this.chart],this)||[];g.filter&&(e=e.filter((e=>g.filter(e,this.chart.data)))),g.sort&&(e=e.sort(((e,t)=>g.sort(e,t,this.chart.data)))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:g,ctx:e}=this;if(!g.display)return void(this.width=this.height=0);const t=g.labels,I=VI(t.font),l=I.size,C=this._computeTitleHeight(),{boxWidth:n,itemHeight:o}=fo(t,l);let a,i;e.font=I.string,this.isHorizontal()?(a=this.maxWidth,i=this._fitRows(C,l,n,o)+10):(i=this.maxHeight,a=this._fitCols(C,I,n,o)+10),this.width=Math.min(a,g.maxWidth||this.maxWidth),this.height=Math.min(i,g.maxHeight||this.maxHeight)}_fitRows(g,e,t,I){const{ctx:l,maxWidth:C,options:{labels:{padding:n}}}=this,o=this.legendHitBoxes=[],a=this.lineWidths=[0],i=I+n;let s=g;l.textAlign="left",l.textBaseline="middle";let c=-1,d=-i;return this.legendItems.forEach(((g,A)=>{const r=t+e/2+l.measureText(g.text).width;(0===A||a[a.length-1]+r+2*n>C)&&(s+=i,a[a.length-(A>0?0:1)]=0,d+=i,c++),o[A]={left:0,top:d,row:c,width:r,height:I},a[a.length-1]+=r+n})),s}_fitCols(g,e,t,I){const{ctx:l,maxHeight:C,options:{labels:{padding:n}}}=this,o=this.legendHitBoxes=[],a=this.columnSizes=[],i=C-g;let s=n,c=0,d=0,A=0,r=0;return this.legendItems.forEach(((g,C)=>{const{itemWidth:u,itemHeight:m}=function(g,e,t,I,l){const C=function(g,e,t,I){let l=g.text;l&&"string"!==typeof l&&(l=l.reduce(((g,e)=>g.length>e.length?g:e)));return e+t.size/2+I.measureText(l).width}(I,g,e,t),n=function(g,e,t){let I=g;"string"!==typeof e.text&&(I=Yo(e,t));return I}(l,I,e.lineHeight);return{itemWidth:C,itemHeight:n}}(t,e,l,g,I);C>0&&d+m+2*n>i&&(s+=c+n,a.push({width:c,height:d}),A+=c+n,r++,c=d=0),o[C]={left:A,top:d,col:r,width:u,height:m},c=Math.max(c,u),d+=m+n})),s+=c,a.push({width:c,height:d}),s}adjustHitBoxes(){if(!this.options.display)return;const g=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:t,labels:{padding:I},rtl:l}}=this,C=dl(l,this.left,this.width);if(this.isHorizontal()){let l=0,n=Ht(t,this.left+I,this.right-this.lineWidths[l]);for(const o of e)l!==o.row&&(l=o.row,n=Ht(t,this.left+I,this.right-this.lineWidths[l])),o.top+=this.top+g+I,o.left=C.leftForLtr(C.x(n),o.width),n+=o.width+I}else{let l=0,n=Ht(t,this.top+g+I,this.bottom-this.columnSizes[l].height);for(const o of e)o.col!==l&&(l=o.col,n=Ht(t,this.top+g+I,this.bottom-this.columnSizes[l].height)),o.top=n,o.left+=this.left+I,o.left=C.leftForLtr(C.x(o.left),o.width),n+=o.height+I}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const g=this.ctx;sI(g,this),this._draw(),cI(g)}}_draw(){const{options:g,columnSizes:e,lineWidths:t,ctx:I}=this,{align:l,labels:C}=g,n=tI.color,o=dl(g.rtl,this.left,this.width),a=VI(C.font),{padding:i}=C,s=a.size,c=s/2;let d;this.drawTitle(),I.textAlign=o.textAlign("left"),I.textBaseline="middle",I.lineWidth=.5,I.font=a.string;const{boxWidth:A,boxHeight:r,itemHeight:u}=fo(C,s),m=this.isHorizontal(),b=this._computeTitleHeight();d=m?{x:Ht(l,this.left+i,this.right-t[0]),y:this.top+i+b,line:0}:{x:this.left+i,y:Ht(l,this.top+b+i,this.bottom-e[0].height),line:0},Al(this.ctx,g.textDirection);const h=u+i;this.legendItems.forEach(((Z,G)=>{I.strokeStyle=Z.fontColor,I.fillStyle=Z.fontColor;const p=I.measureText(Z.text).width,y=o.textAlign(Z.textAlign||(Z.textAlign=C.textAlign)),B=A+c+p;let S=d.x,W=d.y;o.setWidth(this.width),m?G>0&&S+B+i>this.right&&(W=d.y+=h,d.line++,S=d.x=Ht(l,this.left+i,this.right-t[d.line])):G>0&&W+h>this.bottom&&(S=d.x=S+e[d.line].width+i,d.line++,W=d.y=Ht(l,this.top+b+i,this.bottom-e[d.line].height));if(function(g,e,t){if(isNaN(A)||A<=0||isNaN(r)||r<0)return;I.save();const l=Ke(t.lineWidth,1);if(I.fillStyle=Ke(t.fillStyle,n),I.lineCap=Ke(t.lineCap,"butt"),I.lineDashOffset=Ke(t.lineDashOffset,0),I.lineJoin=Ke(t.lineJoin,"miter"),I.lineWidth=l,I.strokeStyle=Ke(t.strokeStyle,n),I.setLineDash(Ke(t.lineDash,[])),C.usePointStyle){const n={radius:r*Math.SQRT2/2,pointStyle:t.pointStyle,rotation:t.rotation,borderWidth:l},a=o.xPlus(g,A/2);aI(I,n,a,e+c,C.pointStyleWidth&&A)}else{const C=e+Math.max((s-r)/2,0),n=o.leftForLtr(g,A),a=SI(t.borderRadius);I.beginPath(),Object.values(a).some((g=>0!==g))?bI(I,{x:n,y:C,w:A,h:r,radius:a}):I.rect(n,C,A,r),I.fill(),0!==l&&I.stroke()}I.restore()}(o.x(S),W,Z),S=((g,e,t,I)=>g===(I?"left":"right")?t:"center"===g?(e+t)/2:e)(y,S+A+c,m?S+B:this.right,g.rtl),function(g,e,t){mI(I,t.text,g,e+u/2,a,{strikethrough:t.hidden,textAlign:o.textAlign(t.textAlign)})}(o.x(S),W,Z),m)d.x+=B+i;else if("string"!==typeof Z.text){const g=a.lineHeight;d.y+=Yo(Z,g)+i}else d.y+=h})),rl(this.ctx,g.textDirection)}drawTitle(){const g=this.options,e=g.title,t=VI(e.font),I=WI(e.padding);if(!e.display)return;const l=dl(g.rtl,this.left,this.width),C=this.ctx,n=e.position,o=t.size/2,a=I.top+o;let i,s=this.left,c=this.width;if(this.isHorizontal())c=Math.max(...this.lineWidths),i=this.top+a,s=Ht(g.align,s,this.right-c);else{const e=this.columnSizes.reduce(((g,e)=>Math.max(g,e.height)),0);i=a+Ht(g.align,this.top,this.bottom-e-g.labels.padding-this._computeTitleHeight())}const d=Ht(n,s,s+c);C.textAlign=l.textAlign(xt(n)),C.textBaseline="middle",C.strokeStyle=e.color,C.fillStyle=e.color,C.font=t.string,mI(C,e.text,d,i,t)}_computeTitleHeight(){const g=this.options.title,e=VI(g.font),t=WI(g.padding);return g.display?e.lineHeight+t.height:0}_getLegendItemAt(g,e){let t,I,l;if(Wt(g,this.left,this.right)&&Wt(e,this.top,this.bottom))for(l=this.legendHitBoxes,t=0;t<l.length;++t)if(I=l[t],Wt(g,I.left,I.left+I.width)&&Wt(e,I.top,I.top+I.height))return this.legendItems[t];return null}handleEvent(g){const e=this.options;if(!function(g,e){if(("mousemove"===g||"mouseout"===g)&&(e.onHover||e.onLeave))return!0;if(e.onClick&&("click"===g||"mouseup"===g))return!0;return!1}(g.type,e))return;const t=this._getLegendItemAt(g.x,g.y);if("mousemove"===g.type||"mouseout"===g.type){const C=this._hoveredItem,n=(l=t,null!==(I=C)&&null!==l&&I.datasetIndex===l.datasetIndex&&I.index===l.index);C&&!n&&Me(e.onLeave,[g,C,this],this),this._hoveredItem=t,t&&!n&&Me(e.onHover,[g,t,this],this)}else t&&Me(e.onClick,[g,t,this],this);var I,l}}function Yo(g,e){return e*(g.text?g.text.length:0)}var xo={id:"legend",_element:vo,start(g,e,t){const I=g.legend=new vo({ctx:g.ctx,options:t,chart:g});WC.configure(g,I,t),WC.addBox(g,I)},stop(g){WC.removeBox(g,g.legend),delete g.legend},beforeUpdate(g,e,t){const I=g.legend;WC.configure(g,I,t),I.options=t},afterUpdate(g){const e=g.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(g,e){e.replay||g.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(g,e,t){const I=e.datasetIndex,l=t.chart;l.isDatasetVisible(I)?(l.hide(I),e.hidden=!0):(l.show(I),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:g=>g.chart.options.color,boxWidth:40,padding:10,generateLabels(g){const e=g.data.datasets,{labels:{usePointStyle:t,pointStyle:I,textAlign:l,color:C,useBorderRadius:n,borderRadius:o}}=g.legend.options;return g._getSortedDatasetMetas().map((g=>{const a=g.controller.getStyle(t?0:void 0),i=WI(a.borderWidth);return{text:e[g.index].label,fillStyle:a.backgroundColor,fontColor:C,hidden:!g.visible,lineCap:a.borderCapStyle,lineDash:a.borderDash,lineDashOffset:a.borderDashOffset,lineJoin:a.borderJoinStyle,lineWidth:(i.width+i.height)/4,strokeStyle:a.borderColor,pointStyle:I||a.pointStyle,rotation:a.rotation,textAlign:l||a.textAlign,borderRadius:n&&(o||a.borderRadius),datasetIndex:g.index}}),this)}},title:{color:g=>g.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:g=>!g.startsWith("on"),labels:{_scriptable:g=>!["generateLabels","filter","sort"].includes(g)}}};class Ho extends QC{constructor(g){super(),this.chart=g.chart,this.options=g.options,this.ctx=g.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(g,e){const t=this.options;if(this.left=0,this.top=0,!t.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=g,this.height=this.bottom=e;const I=He(t.text)?t.text.length:1;this._padding=WI(t.padding);const l=I*VI(t.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=l:this.width=l}isHorizontal(){const g=this.options.position;return"top"===g||"bottom"===g}_drawArgs(g){const{top:e,left:t,bottom:I,right:l,options:C}=this,n=C.align;let o,a,i,s=0;return this.isHorizontal()?(a=Ht(n,t,l),i=e+g,o=l-t):("left"===C.position?(a=t+g,i=Ht(n,I,e),s=-.5*tt):(a=l-g,i=Ht(n,e,I),s=.5*tt),o=I-e),{titleX:a,titleY:i,maxWidth:o,rotation:s}}draw(){const g=this.ctx,e=this.options;if(!e.display)return;const t=VI(e.font),I=t.lineHeight/2+this._padding.top,{titleX:l,titleY:C,maxWidth:n,rotation:o}=this._drawArgs(I);mI(g,e.text,0,0,t,{color:e.color,maxWidth:n,rotation:o,textAlign:xt(e.align),textBaseline:"middle",translation:[l,C]})}}var No={id:"title",_element:Ho,start(g,e,t){!function(g,e){const t=new Ho({ctx:g.ctx,options:e,chart:g});WC.configure(g,t,e),WC.addBox(g,t),g.titleBlock=t}(g,t)},stop(g){const e=g.titleBlock;WC.removeBox(g,e),delete g.titleBlock},beforeUpdate(g,e,t){const I=g.titleBlock;WC.configure(g,I,t),I.options=t},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const wo=new WeakMap;var Fo={id:"subtitle",start(g,e,t){const I=new Ho({ctx:g.ctx,options:t,chart:g});WC.configure(g,I,t),WC.addBox(g,I),wo.set(g,I)},stop(g){WC.removeBox(g,wo.get(g)),wo.delete(g)},beforeUpdate(g,e,t){const I=wo.get(g);WC.configure(g,I,t),I.options=t},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Ko={average(g){if(!g.length)return!1;let e,t,I=0,l=0,C=0;for(e=0,t=g.length;e<t;++e){const t=g[e].element;if(t&&t.hasValue()){const g=t.tooltipPosition();I+=g.x,l+=g.y,++C}}return{x:I/C,y:l/C}},nearest(g,e){if(!g.length)return!1;let t,I,l,C=e.x,n=e.y,o=Number.POSITIVE_INFINITY;for(t=0,I=g.length;t<I;++t){const I=g[t].element;if(I&&I.hasValue()){const g=Gt(e,I.getCenterPoint());g<o&&(o=g,l=I)}}if(l){const g=l.tooltipPosition();C=g.x,n=g.y}return{x:C,y:n}}};function zo(g,e){return e&&(He(e)?Array.prototype.push.apply(g,e):g.push(e)),g}function Mo(g){return("string"===typeof g||g instanceof String)&&g.indexOf("\n")>-1?g.split("\n"):g}function Eo(g,e){const{element:t,datasetIndex:I,index:l}=e,C=g.getDatasetMeta(I).controller,{label:n,value:o}=C.getLabelAndValue(l);return{chart:g,label:n,parsed:C.getParsed(l),raw:g.data.datasets[I].data[l],formattedValue:o,dataset:C.getDataset(),dataIndex:l,datasetIndex:I,element:t}}function Qo(g,e){const t=g.chart.ctx,{body:I,footer:l,title:C}=g,{boxWidth:n,boxHeight:o}=e,a=VI(e.bodyFont),i=VI(e.titleFont),s=VI(e.footerFont),c=C.length,d=l.length,A=I.length,r=WI(e.padding);let u=r.height,m=0,b=I.reduce(((g,e)=>g+e.before.length+e.lines.length+e.after.length),0);if(b+=g.beforeBody.length+g.afterBody.length,c&&(u+=c*i.lineHeight+(c-1)*e.titleSpacing+e.titleMarginBottom),b){u+=A*(e.displayColors?Math.max(o,a.lineHeight):a.lineHeight)+(b-A)*a.lineHeight+(b-1)*e.bodySpacing}d&&(u+=e.footerMarginTop+d*s.lineHeight+(d-1)*e.footerSpacing);let h=0;const Z=function(g){m=Math.max(m,t.measureText(g).width+h)};return t.save(),t.font=i.string,Ee(g.title,Z),t.font=a.string,Ee(g.beforeBody.concat(g.afterBody),Z),h=e.displayColors?n+2+e.boxPadding:0,Ee(I,(g=>{Ee(g.before,Z),Ee(g.lines,Z),Ee(g.after,Z)})),h=0,t.font=s.string,Ee(g.footer,Z),t.restore(),m+=r.width,{width:m,height:u}}function Uo(g,e,t,I){const{x:l,width:C}=t,{width:n,chartArea:{left:o,right:a}}=g;let i="center";return"center"===I?i=l<=(o+a)/2?"left":"right":l<=C/2?i="left":l>=n-C/2&&(i="right"),function(g,e,t,I){const{x:l,width:C}=I,n=t.caretSize+t.caretPadding;return"left"===g&&l+C+n>e.width||"right"===g&&l-C-n<0||void 0}(i,g,e,t)&&(i="center"),i}function Lo(g,e,t){const I=t.yAlign||e.yAlign||function(g,e){const{y:t,height:I}=e;return t<I/2?"top":t>g.height-I/2?"bottom":"center"}(g,t);return{xAlign:t.xAlign||e.xAlign||Uo(g,e,t,I),yAlign:I}}function jo(g,e,t,I){const{caretSize:l,caretPadding:C,cornerRadius:n}=g,{xAlign:o,yAlign:a}=t,i=l+C,{topLeft:s,topRight:c,bottomLeft:d,bottomRight:A}=SI(n);let r=function(g,e){let{x:t,width:I}=g;return"right"===e?t-=I:"center"===e&&(t-=I/2),t}(e,o);const u=function(g,e,t){let{y:I,height:l}=g;return"top"===e?I+=t:I-="bottom"===e?l+t:l/2,I}(e,a,i);return"center"===a?"left"===o?r+=i:"right"===o&&(r-=i):"left"===o?r-=Math.max(s,d)+l:"right"===o&&(r+=Math.max(c,A)+l),{x:St(r,0,I.width-e.width),y:St(u,0,I.height-e.height)}}function Do(g,e,t){const I=WI(t.padding);return"center"===e?g.x+g.width/2:"right"===e?g.x+g.width-I.right:g.x+I.left}function To(g){return zo([],Mo(g))}function Po(g,e){const t=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return t?g.override(t):g}const Oo={beforeTitle:ve,title(g){if(g.length>0){const e=g[0],t=e.chart.data.labels,I=t?t.length:0;if(this&&this.options&&"dataset"===this.options.mode)return e.dataset.label||"";if(e.label)return e.label;if(I>0&&e.dataIndex<I)return t[e.dataIndex]}return""},afterTitle:ve,beforeBody:ve,beforeLabel:ve,label(g){if(this&&this.options&&"dataset"===this.options.mode)return g.label+": "+g.formattedValue||g.formattedValue;let e=g.dataset.label||"";e&&(e+=": ");const t=g.formattedValue;return xe(t)||(e+=t),e},labelColor(g){const e=g.chart.getDatasetMeta(g.datasetIndex).controller.getStyle(g.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(g){const e=g.chart.getDatasetMeta(g.datasetIndex).controller.getStyle(g.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:ve,afterBody:ve,beforeFooter:ve,footer:ve,afterFooter:ve};function _o(g,e,t,I){const l=g[e].call(t,I);return"undefined"===typeof l?Oo[e].call(t,I):l}class qo extends QC{constructor(g){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=g.chart,this.options=g.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(g){this.options=g,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const g=this._cachedAnimations;if(g)return g;const e=this.chart,t=this.options.setContext(this.getContext()),I=t.enabled&&e.options.animation&&t.animations,l=new Rl(this.chart,I);return I._cacheable&&(this._cachedAnimations=Object.freeze(l)),l}getContext(){return this.$context||(this.$context=(g=this.chart.getContext(),e=this,t=this._tooltipItems,XI(g,{tooltip:e,tooltipItems:t,type:"tooltip"})));var g,e,t}getTitle(g,e){const{callbacks:t}=e,I=_o(t,"beforeTitle",this,g),l=_o(t,"title",this,g),C=_o(t,"afterTitle",this,g);let n=[];return n=zo(n,Mo(I)),n=zo(n,Mo(l)),n=zo(n,Mo(C)),n}getBeforeBody(g,e){return To(_o(e.callbacks,"beforeBody",this,g))}getBody(g,e){const{callbacks:t}=e,I=[];return Ee(g,(g=>{const e={before:[],lines:[],after:[]},l=Po(t,g);zo(e.before,Mo(_o(l,"beforeLabel",this,g))),zo(e.lines,_o(l,"label",this,g)),zo(e.after,Mo(_o(l,"afterLabel",this,g))),I.push(e)})),I}getAfterBody(g,e){return To(_o(e.callbacks,"afterBody",this,g))}getFooter(g,e){const{callbacks:t}=e,I=_o(t,"beforeFooter",this,g),l=_o(t,"footer",this,g),C=_o(t,"afterFooter",this,g);let n=[];return n=zo(n,Mo(I)),n=zo(n,Mo(l)),n=zo(n,Mo(C)),n}_createItems(g){const e=this._active,t=this.chart.data,I=[],l=[],C=[];let n,o,a=[];for(n=0,o=e.length;n<o;++n)a.push(Eo(this.chart,e[n]));return g.filter&&(a=a.filter(((e,I,l)=>g.filter(e,I,l,t)))),g.itemSort&&(a=a.sort(((e,I)=>g.itemSort(e,I,t)))),Ee(a,(e=>{const t=Po(g.callbacks,e);I.push(_o(t,"labelColor",this,e)),l.push(_o(t,"labelPointStyle",this,e)),C.push(_o(t,"labelTextColor",this,e))})),this.labelColors=I,this.labelPointStyles=l,this.labelTextColors=C,this.dataPoints=a,a}update(g,e){const t=this.options.setContext(this.getContext()),I=this._active;let l,C=[];if(I.length){const g=Ko[t.position].call(this,I,this._eventPosition);C=this._createItems(t),this.title=this.getTitle(C,t),this.beforeBody=this.getBeforeBody(C,t),this.body=this.getBody(C,t),this.afterBody=this.getAfterBody(C,t),this.footer=this.getFooter(C,t);const e=this._size=Qo(this,t),n=Object.assign({},g,e),o=Lo(this.chart,t,n),a=jo(t,n,o,this.chart);this.xAlign=o.xAlign,this.yAlign=o.yAlign,l={opacity:1,x:a.x,y:a.y,width:e.width,height:e.height,caretX:g.x,caretY:g.y}}else 0!==this.opacity&&(l={opacity:0});this._tooltipItems=C,this.$context=void 0,l&&this._resolveAnimations().update(this,l),g&&t.external&&t.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(g,e,t,I){const l=this.getCaretPosition(g,t,I);e.lineTo(l.x1,l.y1),e.lineTo(l.x2,l.y2),e.lineTo(l.x3,l.y3)}getCaretPosition(g,e,t){const{xAlign:I,yAlign:l}=this,{caretSize:C,cornerRadius:n}=t,{topLeft:o,topRight:a,bottomLeft:i,bottomRight:s}=SI(n),{x:c,y:d}=g,{width:A,height:r}=e;let u,m,b,h,Z,G;return"center"===l?(Z=d+r/2,"left"===I?(u=c,m=u-C,h=Z+C,G=Z-C):(u=c+A,m=u+C,h=Z-C,G=Z+C),b=u):(m="left"===I?c+Math.max(o,i)+C:"right"===I?c+A-Math.max(a,s)-C:this.caretX,"top"===l?(h=d,Z=h-C,u=m-C,b=m+C):(h=d+r,Z=h+C,u=m+C,b=m-C),G=h),{x1:u,x2:m,x3:b,y1:h,y2:Z,y3:G}}drawTitle(g,e,t){const I=this.title,l=I.length;let C,n,o;if(l){const a=dl(t.rtl,this.x,this.width);for(g.x=Do(this,t.titleAlign,t),e.textAlign=a.textAlign(t.titleAlign),e.textBaseline="middle",C=VI(t.titleFont),n=t.titleSpacing,e.fillStyle=t.titleColor,e.font=C.string,o=0;o<l;++o)e.fillText(I[o],a.x(g.x),g.y+C.lineHeight/2),g.y+=C.lineHeight+n,o+1===l&&(g.y+=t.titleMarginBottom-n)}}_drawColorBox(g,e,t,I,l){const C=this.labelColors[t],n=this.labelPointStyles[t],{boxHeight:o,boxWidth:a}=l,i=VI(l.bodyFont),s=Do(this,"left",l),c=I.x(s),d=o<i.lineHeight?(i.lineHeight-o)/2:0,A=e.y+d;if(l.usePointStyle){const e={radius:Math.min(a,o)/2,pointStyle:n.pointStyle,rotation:n.rotation,borderWidth:1},t=I.leftForLtr(c,a)+a/2,i=A+o/2;g.strokeStyle=l.multiKeyBackground,g.fillStyle=l.multiKeyBackground,oI(g,e,t,i),g.strokeStyle=C.borderColor,g.fillStyle=C.backgroundColor,oI(g,e,t,i)}else{g.lineWidth=Ne(C.borderWidth)?Math.max(...Object.values(C.borderWidth)):C.borderWidth||1,g.strokeStyle=C.borderColor,g.setLineDash(C.borderDash||[]),g.lineDashOffset=C.borderDashOffset||0;const e=I.leftForLtr(c,a),t=I.leftForLtr(I.xPlus(c,1),a-2),n=SI(C.borderRadius);Object.values(n).some((g=>0!==g))?(g.beginPath(),g.fillStyle=l.multiKeyBackground,bI(g,{x:e,y:A,w:a,h:o,radius:n}),g.fill(),g.stroke(),g.fillStyle=C.backgroundColor,g.beginPath(),bI(g,{x:t,y:A+1,w:a-2,h:o-2,radius:n}),g.fill()):(g.fillStyle=l.multiKeyBackground,g.fillRect(e,A,a,o),g.strokeRect(e,A,a,o),g.fillStyle=C.backgroundColor,g.fillRect(t,A+1,a-2,o-2))}g.fillStyle=this.labelTextColors[t]}drawBody(g,e,t){const{body:I}=this,{bodySpacing:l,bodyAlign:C,displayColors:n,boxHeight:o,boxWidth:a,boxPadding:i}=t,s=VI(t.bodyFont);let c=s.lineHeight,d=0;const A=dl(t.rtl,this.x,this.width),r=function(t){e.fillText(t,A.x(g.x+d),g.y+c/2),g.y+=c+l},u=A.textAlign(C);let m,b,h,Z,G,p,y;for(e.textAlign=C,e.textBaseline="middle",e.font=s.string,g.x=Do(this,u,t),e.fillStyle=t.bodyColor,Ee(this.beforeBody,r),d=n&&"right"!==u?"center"===C?a/2+i:a+2+i:0,Z=0,p=I.length;Z<p;++Z){for(m=I[Z],b=this.labelTextColors[Z],e.fillStyle=b,Ee(m.before,r),h=m.lines,n&&h.length&&(this._drawColorBox(e,g,Z,A,t),c=Math.max(s.lineHeight,o)),G=0,y=h.length;G<y;++G)r(h[G]),c=s.lineHeight;Ee(m.after,r)}d=0,c=s.lineHeight,Ee(this.afterBody,r),g.y-=l}drawFooter(g,e,t){const I=this.footer,l=I.length;let C,n;if(l){const o=dl(t.rtl,this.x,this.width);for(g.x=Do(this,t.footerAlign,t),g.y+=t.footerMarginTop,e.textAlign=o.textAlign(t.footerAlign),e.textBaseline="middle",C=VI(t.footerFont),e.fillStyle=t.footerColor,e.font=C.string,n=0;n<l;++n)e.fillText(I[n],o.x(g.x),g.y+C.lineHeight/2),g.y+=C.lineHeight+t.footerSpacing}}drawBackground(g,e,t,I){const{xAlign:l,yAlign:C}=this,{x:n,y:o}=g,{width:a,height:i}=t,{topLeft:s,topRight:c,bottomLeft:d,bottomRight:A}=SI(I.cornerRadius);e.fillStyle=I.backgroundColor,e.strokeStyle=I.borderColor,e.lineWidth=I.borderWidth,e.beginPath(),e.moveTo(n+s,o),"top"===C&&this.drawCaret(g,e,t,I),e.lineTo(n+a-c,o),e.quadraticCurveTo(n+a,o,n+a,o+c),"center"===C&&"right"===l&&this.drawCaret(g,e,t,I),e.lineTo(n+a,o+i-A),e.quadraticCurveTo(n+a,o+i,n+a-A,o+i),"bottom"===C&&this.drawCaret(g,e,t,I),e.lineTo(n+d,o+i),e.quadraticCurveTo(n,o+i,n,o+i-d),"center"===C&&"left"===l&&this.drawCaret(g,e,t,I),e.lineTo(n,o+s),e.quadraticCurveTo(n,o,n+s,o),e.closePath(),e.fill(),I.borderWidth>0&&e.stroke()}_updateAnimationTarget(g){const e=this.chart,t=this.$animations,I=t&&t.x,l=t&&t.y;if(I||l){const t=Ko[g.position].call(this,this._active,this._eventPosition);if(!t)return;const C=this._size=Qo(this,g),n=Object.assign({},t,this._size),o=Lo(e,g,n),a=jo(g,n,o,e);I._to===a.x&&l._to===a.y||(this.xAlign=o.xAlign,this.yAlign=o.yAlign,this.width=C.width,this.height=C.height,this.caretX=t.x,this.caretY=t.y,this._resolveAnimations().update(this,a))}}_willRender(){return!!this.opacity}draw(g){const e=this.options.setContext(this.getContext());let t=this.opacity;if(!t)return;this._updateAnimationTarget(e);const I={width:this.width,height:this.height},l={x:this.x,y:this.y};t=Math.abs(t)<.001?0:t;const C=WI(e.padding),n=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&n&&(g.save(),g.globalAlpha=t,this.drawBackground(l,g,I,e),Al(g,e.textDirection),l.y+=C.top,this.drawTitle(l,g,e),this.drawBody(l,g,e),this.drawFooter(l,g,e),rl(g,e.textDirection),g.restore())}getActiveElements(){return this._active||[]}setActiveElements(g,e){const t=this._active,I=g.map((g=>{let{datasetIndex:e,index:t}=g;const I=this.chart.getDatasetMeta(e);if(!I)throw new Error("Cannot find a dataset at index "+e);return{datasetIndex:e,element:I.data[t],index:t}})),l=!Qe(t,I),C=this._positionChanged(I,e);(l||C)&&(this._active=I,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(g,e){let t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const I=this.options,l=this._active||[],C=this._getActiveElements(g,l,e,t),n=this._positionChanged(C,g),o=e||!Qe(C,l)||n;return o&&(this._active=C,(I.enabled||I.external)&&(this._eventPosition={x:g.x,y:g.y},this.update(!0,e))),o}_getActiveElements(g,e,t,I){const l=this.options;if("mouseout"===g.type)return[];if(!I)return e.filter((g=>this.chart.data.datasets[g.datasetIndex]&&void 0!==this.chart.getDatasetMeta(g.datasetIndex).controller.getParsed(g.index)));const C=this.chart.getElementsAtEventForMode(g,l.mode,l,t);return l.reverse&&C.reverse(),C}_positionChanged(g,e){const{caretX:t,caretY:I,options:l}=this,C=Ko[l.position].call(this,g,e);return!1!==C&&(t!==C.x||I!==C.y)}}qg(qo,"positioners",Ko);var $o={id:"tooltip",_element:qo,positioners:Ko,afterInit(g,e,t){t&&(g.tooltip=new qo({chart:g,options:t}))},beforeUpdate(g,e,t){g.tooltip&&g.tooltip.initialize(t)},reset(g,e,t){g.tooltip&&g.tooltip.initialize(t)},afterDraw(g){const e=g.tooltip;if(e&&e._willRender()){const t={tooltip:e};if(!1===g.notifyPlugins("beforeTooltipDraw",{...t,cancelable:!0}))return;e.draw(g.ctx),g.notifyPlugins("afterTooltipDraw",t)}},afterEvent(g,e){if(g.tooltip){const t=e.replay;g.tooltip.handleEvent(e.event,t,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(g,e)=>e.bodyFont.size,boxWidth:(g,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Oo},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:g=>"filter"!==g&&"itemSort"!==g&&"external"!==g,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},ga=Object.freeze({__proto__:null,Colors:io,Decimation:Ao,Filler:ko,Legend:xo,SubTitle:Fo,Title:No,Tooltip:$o});function ea(g,e,t,I){const l=g.indexOf(e);if(-1===l)return((g,e,t,I)=>("string"===typeof e?(t=g.push(e)-1,I.unshift({index:t,label:e})):isNaN(e)&&(t=null),t))(g,e,t,I);return l!==g.lastIndexOf(e)?t:l}function ta(g){const e=this.getLabels();return g>=0&&g<e.length?e[g]:g}class Ia extends $C{constructor(g){super(g),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(g){const e=this._addedLabels;if(e.length){const g=this.getLabels();for(const{index:t,label:I}of e)g[t]===I&&g.splice(t,1);this._addedLabels=[]}super.init(g)}parse(g,e){if(xe(g))return null;const t=this.getLabels();return((g,e)=>null===g?null:St(Math.round(g),0,e))(e=isFinite(e)&&t[e]===g?e:ea(t,g,Ke(e,g),this._addedLabels),t.length-1)}determineDataLimits(){const{minDefined:g,maxDefined:e}=this.getUserBounds();let{min:t,max:I}=this.getMinMax(!0);"ticks"===this.options.bounds&&(g||(t=0),e||(I=this.getLabels().length-1)),this.min=t,this.max=I}buildTicks(){const g=this.min,e=this.max,t=this.options.offset,I=[];let l=this.getLabels();l=0===g&&e===l.length-1?l:l.slice(g,e+1),this._valueRange=Math.max(l.length-(t?0:1),1),this._startValue=this.min-(t?.5:0);for(let C=g;C<=e;C++)I.push({value:C});return I}getLabelForValue(g){return ta.call(this,g)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(g){return"number"!==typeof g&&(g=this.parse(g)),null===g?NaN:this.getPixelForDecimal((g-this._startValue)/this._valueRange)}getPixelForTick(g){const e=this.ticks;return g<0||g>e.length-1?null:this.getPixelForValue(e[g].value)}getValueForPixel(g){return Math.round(this._startValue+this.getDecimalForPixel(g)*this._valueRange)}getBasePixel(){return this.bottom}}function la(g,e){const t=[],{bounds:I,step:l,min:C,max:n,precision:o,count:a,maxTicks:i,maxDigits:s,includeBounds:c}=g,d=l||1,A=i-1,{min:r,max:u}=e,m=!xe(C),b=!xe(n),h=!xe(a),Z=(u-r)/(s+1);let G,p,y,B,S=At((u-r)/A/d)*d;if(S<1e-14&&!m&&!b)return[{value:r},{value:u}];B=Math.ceil(u/S)-Math.floor(r/S),B>A&&(S=At(B*S/A/d)*d),xe(o)||(G=Math.pow(10,o),S=Math.ceil(S*G)/G),"ticks"===I?(p=Math.floor(r/S)*S,y=Math.ceil(u/S)*S):(p=r,y=u),m&&b&&l&&function(g,e){const t=Math.round(g);return t-e<=g&&t+e>=g}((n-C)/l,S/1e3)?(B=Math.round(Math.min((n-C)/S,i)),S=(n-C)/B,p=C,y=n):h?(p=m?C:p,y=b?n:y,B=a-1,S=(y-p)/B):(B=(y-p)/S,B=dt(B,Math.round(B),S/1e3)?Math.round(B):Math.ceil(B));const W=Math.max(ht(S),ht(p));G=Math.pow(10,xe(o)?W:o),p=Math.round(p*G)/G,y=Math.round(y*G)/G;let V=0;for(m&&(c&&p!==C?(t.push({value:C}),p<C&&V++,dt(Math.round((p+V*S)*G)/G,C,Ca(C,Z,g))&&V++):p<C&&V++);V<B;++V){const g=Math.round((p+V*S)*G)/G;if(b&&g>n)break;t.push({value:g})}return b&&c&&y!==n?t.length&&dt(t[t.length-1].value,n,Ca(n,Z,g))?t[t.length-1].value=n:t.push({value:n}):b&&y!==n||t.push({value:y}),t}function Ca(g,e,t){let{horizontal:I,minRotation:l}=t;const C=mt(l),n=(I?Math.sin(C):Math.cos(C))||.001,o=.75*e*(""+g).length;return Math.min(e/n,o)}qg(Ia,"id","category"),qg(Ia,"defaults",{ticks:{callback:ta}});class na extends $C{constructor(g){super(g),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(g,e){return xe(g)||("number"===typeof g||g instanceof Number)&&!isFinite(+g)?null:+g}handleTickRangeOptions(){const{beginAtZero:g}=this.options,{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:I,max:l}=this;const C=g=>I=e?I:g,n=g=>l=t?l:g;if(g){const g=ct(I),e=ct(l);g<0&&e<0?n(0):g>0&&e>0&&C(0)}if(I===l){let e=0===l?1:Math.abs(.05*l);n(l+e),g||C(I-e)}this.min=I,this.max=l}getTickLimit(){const g=this.options.ticks;let e,{maxTicksLimit:t,stepSize:I}=g;return I?(e=Math.ceil(this.max/I)-Math.floor(this.min/I)+1,e>1e3&&(console.warn("scales.".concat(this.id,".ticks.stepSize: ").concat(I," would result generating up to ").concat(e," ticks. Limiting to 1000.")),e=1e3)):(e=this.computeTickLimit(),t=t||11),t&&(e=Math.min(t,e)),e}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const g=this.options,e=g.ticks;let t=this.getTickLimit();t=Math.max(2,t);const I=la({maxTicks:t,bounds:g.bounds,min:g.min,max:g.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:!1!==e.includeBounds},this._range||this);return"ticks"===g.bounds&&ut(I,this,"value"),g.reverse?(I.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),I}configure(){const g=this.ticks;let e=this.min,t=this.max;if(super.configure(),this.options.offset&&g.length){const I=(t-e)/Math.max(g.length-1,1)/2;e-=I,t+=I}this._startValue=e,this._endValue=t,this._valueRange=t-e}getLabelForValue(g){return Tt(g,this.chart.options.locale,this.options.ticks.format)}}class oa extends na{determineDataLimits(){const{min:g,max:e}=this.getMinMax(!0);this.min=we(g)?g:0,this.max=we(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const g=this.isHorizontal(),e=g?this.width:this.height,t=mt(this.options.ticks.minRotation),I=(g?Math.sin(t):Math.cos(t))||.001,l=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,l.lineHeight/I))}getPixelForValue(g){return null===g?NaN:this.getPixelForDecimal((g-this._startValue)/this._valueRange)}getValueForPixel(g){return this._startValue+this.getDecimalForPixel(g)*this._valueRange}}qg(oa,"id","linear"),qg(oa,"defaults",{ticks:{callback:Ot.formatters.numeric}});const aa=g=>Math.floor(st(g)),ia=(g,e)=>Math.pow(10,aa(g)+e);function sa(g){return 1===g/Math.pow(10,aa(g))}function ca(g,e,t){const I=Math.pow(10,t),l=Math.floor(g/I);return Math.ceil(e/I)-l}function da(g,e){let{min:t,max:I}=e;t=Fe(g.min,t);const l=[],C=aa(t);let n=function(g,e){let t=aa(e-g);for(;ca(g,e,t)>10;)t++;for(;ca(g,e,t)<10;)t--;return Math.min(t,aa(g))}(t,I),o=n<0?Math.pow(10,Math.abs(n)):1;const a=Math.pow(10,n),i=C>n?Math.pow(10,C):0,s=Math.round((t-i)*o)/o,c=Math.floor((t-i)/a/10)*a*10;let d=Math.floor((s-c)/Math.pow(10,n)),A=Fe(g.min,Math.round((i+c+d*Math.pow(10,n))*o)/o);for(;A<I;)l.push({value:A,major:sa(A),significand:d}),d>=10?d=d<15?15:20:d++,d>=20&&(n++,d=2,o=n>=0?1:o),A=Math.round((i+c+d*Math.pow(10,n))*o)/o;const r=Fe(g.max,A);return l.push({value:r,major:sa(r),significand:d}),l}class Aa extends $C{constructor(g){super(g),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(g,e){const t=na.prototype.parse.apply(this,[g,e]);if(0!==t)return we(t)&&t>0?t:null;this._zero=!0}determineDataLimits(){const{min:g,max:e}=this.getMinMax(!0);this.min=we(g)?Math.max(0,g):null,this.max=we(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!we(this._userMin)&&(this.min=g===ia(this.min,0)?ia(this.min,-1):ia(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:g,maxDefined:e}=this.getUserBounds();let t=this.min,I=this.max;const l=e=>t=g?t:e,C=g=>I=e?I:g;t===I&&(t<=0?(l(1),C(10)):(l(ia(t,-1)),C(ia(I,1)))),t<=0&&l(ia(I,-1)),I<=0&&C(ia(t,1)),this.min=t,this.max=I}buildTicks(){const g=this.options,e=da({min:this._userMin,max:this._userMax},this);return"ticks"===g.bounds&&ut(e,this,"value"),g.reverse?(e.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),e}getLabelForValue(g){return void 0===g?"0":Tt(g,this.chart.options.locale,this.options.ticks.format)}configure(){const g=this.min;super.configure(),this._startValue=st(g),this._valueRange=st(this.max)-st(g)}getPixelForValue(g){return void 0!==g&&0!==g||(g=this.min),null===g||isNaN(g)?NaN:this.getPixelForDecimal(g===this.min?0:(st(g)-this._startValue)/this._valueRange)}getValueForPixel(g){const e=this.getDecimalForPixel(g);return Math.pow(10,this._startValue+e*this._valueRange)}}function ra(g){const e=g.ticks;if(e.display&&g.display){const g=WI(e.backdropPadding);return Ke(e.font&&e.font.size,tI.font.size)+g.height}return 0}function ua(g,e,t,I,l){return g===I||g===l?{start:e-t/2,end:e+t/2}:g<I||g>l?{start:e-t,end:e}:{start:e,end:e+t}}function ma(g){const e={l:g.left+g._padding.left,r:g.right-g._padding.right,t:g.top+g._padding.top,b:g.bottom-g._padding.bottom},t=Object.assign({},e),I=[],l=[],C=g._pointLabels.length,n=g.options.pointLabels,o=n.centerPointLabels?tt/C:0;for(let c=0;c<C;c++){const C=n.setContext(g.getPointLabelContext(c));l[c]=C.padding;const d=g.getPointPosition(c,g.drawingArea+l[c],o),A=VI(C.font),r=(a=g.ctx,i=A,s=He(s=g._pointLabels[c])?s:[s],{w:lI(a,i.string,s),h:s.length*i.lineHeight});I[c]=r;const u=yt(g.getIndexAngle(c)+o),m=Math.round(bt(u));ba(t,e,u,ua(m,d.x,r.w,0,180),ua(m,d.y,r.h,90,270))}var a,i,s;g.setCenterPoint(e.l-t.l,t.r-e.r,e.t-t.t,t.b-e.b),g._pointLabelItems=function(g,e,t){const I=[],l=g._pointLabels.length,C=g.options,{centerPointLabels:n,display:o}=C.pointLabels,a={extra:ra(C)/2,additionalAngle:n?tt/l:0};let i;for(let s=0;s<l;s++){a.padding=t[s],a.size=e[s];const l=ha(g,s,a);I.push(l),"auto"===o&&(l.visible=Za(l,i),l.visible&&(i=l))}return I}(g,I,l)}function ba(g,e,t,I,l){const C=Math.abs(Math.sin(t)),n=Math.abs(Math.cos(t));let o=0,a=0;I.start<e.l?(o=(e.l-I.start)/C,g.l=Math.min(g.l,e.l-o)):I.end>e.r&&(o=(I.end-e.r)/C,g.r=Math.max(g.r,e.r+o)),l.start<e.t?(a=(e.t-l.start)/n,g.t=Math.min(g.t,e.t-a)):l.end>e.b&&(a=(l.end-e.b)/n,g.b=Math.max(g.b,e.b+a))}function ha(g,e,t){const I=g.drawingArea,{extra:l,additionalAngle:C,padding:n,size:o}=t,a=g.getPointPosition(e,I+l+n,C),i=Math.round(bt(yt(a.angle+ot))),s=function(g,e,t){90===t||270===t?g-=e/2:(t>270||t<90)&&(g-=e);return g}(a.y,o.h,i),c=function(g){if(0===g||180===g)return"center";if(g<180)return"left";return"right"}(i),d=function(g,e,t){"right"===t?g-=e:"center"===t&&(g-=e/2);return g}(a.x,o.w,c);return{visible:!0,x:a.x,y:s,textAlign:c,left:d,top:s,right:d+o.w,bottom:s+o.h}}function Za(g,e){if(!e)return!0;const{left:t,top:I,right:l,bottom:C}=g;return!(iI({x:t,y:I},e)||iI({x:t,y:C},e)||iI({x:l,y:I},e)||iI({x:l,y:C},e))}function Ga(g,e,t){const{left:I,top:l,right:C,bottom:n}=t,{backdropColor:o}=e;if(!xe(o)){const t=SI(e.borderRadius),a=WI(e.backdropPadding);g.fillStyle=o;const i=I-a.left,s=l-a.top,c=C-I+a.width,d=n-l+a.height;Object.values(t).some((g=>0!==g))?(g.beginPath(),bI(g,{x:i,y:s,w:c,h:d,radius:t}),g.fill()):g.fillRect(i,s,c,d)}}function pa(g,e,t,I){const{ctx:l}=g;if(t)l.arc(g.xCenter,g.yCenter,e,0,It);else{let t=g.getPointPosition(0,e);l.moveTo(t.x,t.y);for(let C=1;C<I;C++)t=g.getPointPosition(C,e),l.lineTo(t.x,t.y)}}qg(Aa,"id","logarithmic"),qg(Aa,"defaults",{ticks:{callback:Ot.formatters.logarithmic,major:{enabled:!0}}});class ya extends na{constructor(g){super(g),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const g=this._padding=WI(ra(this.options)/2),e=this.width=this.maxWidth-g.width,t=this.height=this.maxHeight-g.height;this.xCenter=Math.floor(this.left+e/2+g.left),this.yCenter=Math.floor(this.top+t/2+g.top),this.drawingArea=Math.floor(Math.min(e,t)/2)}determineDataLimits(){const{min:g,max:e}=this.getMinMax(!1);this.min=we(g)&&!isNaN(g)?g:0,this.max=we(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/ra(this.options))}generateTickLabels(g){na.prototype.generateTickLabels.call(this,g),this._pointLabels=this.getLabels().map(((g,e)=>{const t=Me(this.options.pointLabels.callback,[g,e],this);return t||0===t?t:""})).filter(((g,e)=>this.chart.getDataVisibility(e)))}fit(){const g=this.options;g.display&&g.pointLabels.display?ma(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(g,e,t,I){this.xCenter+=Math.floor((g-e)/2),this.yCenter+=Math.floor((t-I)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(g,e,t,I))}getIndexAngle(g){return yt(g*(It/(this._pointLabels.length||1))+mt(this.options.startAngle||0))}getDistanceFromCenterForValue(g){if(xe(g))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-g)*e:(g-this.min)*e}getValueForDistanceFromCenter(g){if(xe(g))return NaN;const e=g/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(g){const e=this._pointLabels||[];if(g>=0&&g<e.length){const t=e[g];return function(g,e,t){return XI(g,{label:t,index:e,type:"pointLabel"})}(this.getContext(),g,t)}}getPointPosition(g,e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const I=this.getIndexAngle(g)-ot+t;return{x:Math.cos(I)*e+this.xCenter,y:Math.sin(I)*e+this.yCenter,angle:I}}getPointPositionForValue(g,e){return this.getPointPosition(g,this.getDistanceFromCenterForValue(e))}getBasePosition(g){return this.getPointPositionForValue(g||0,this.getBaseValue())}getPointLabelPosition(g){const{left:e,top:t,right:I,bottom:l}=this._pointLabelItems[g];return{left:e,top:t,right:I,bottom:l}}drawBackground(){const{backgroundColor:g,grid:{circular:e}}=this.options;if(g){const t=this.ctx;t.save(),t.beginPath(),pa(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),t.closePath(),t.fillStyle=g,t.fill(),t.restore()}}drawGrid(){const g=this.ctx,e=this.options,{angleLines:t,grid:I,border:l}=e,C=this._pointLabels.length;let n,o,a;if(e.pointLabels.display&&function(g,e){const{ctx:t,options:{pointLabels:I}}=g;for(let l=e-1;l>=0;l--){const e=g._pointLabelItems[l];if(!e.visible)continue;const C=I.setContext(g.getPointLabelContext(l));Ga(t,C,e);const n=VI(C.font),{x:o,y:a,textAlign:i}=e;mI(t,g._pointLabels[l],o,a+n.lineHeight/2,n,{color:C.color,textAlign:i,textBaseline:"middle"})}}(this,C),I.display&&this.ticks.forEach(((g,e)=>{if(0!==e){o=this.getDistanceFromCenterForValue(g.value);const t=this.getContext(e),n=I.setContext(t),a=l.setContext(t);!function(g,e,t,I,l){const C=g.ctx,n=e.circular,{color:o,lineWidth:a}=e;!n&&!I||!o||!a||t<0||(C.save(),C.strokeStyle=o,C.lineWidth=a,C.setLineDash(l.dash),C.lineDashOffset=l.dashOffset,C.beginPath(),pa(g,t,n,I),C.closePath(),C.stroke(),C.restore())}(this,n,o,C,a)}})),t.display){for(g.save(),n=C-1;n>=0;n--){const I=t.setContext(this.getPointLabelContext(n)),{color:l,lineWidth:C}=I;C&&l&&(g.lineWidth=C,g.strokeStyle=l,g.setLineDash(I.borderDash),g.lineDashOffset=I.borderDashOffset,o=this.getDistanceFromCenterForValue(e.ticks.reverse?this.min:this.max),a=this.getPointPosition(n,o),g.beginPath(),g.moveTo(this.xCenter,this.yCenter),g.lineTo(a.x,a.y),g.stroke())}g.restore()}}drawBorder(){}drawLabels(){const g=this.ctx,e=this.options,t=e.ticks;if(!t.display)return;const I=this.getIndexAngle(0);let l,C;g.save(),g.translate(this.xCenter,this.yCenter),g.rotate(I),g.textAlign="center",g.textBaseline="middle",this.ticks.forEach(((I,n)=>{if(0===n&&!e.reverse)return;const o=t.setContext(this.getContext(n)),a=VI(o.font);if(l=this.getDistanceFromCenterForValue(this.ticks[n].value),o.showLabelBackdrop){g.font=a.string,C=g.measureText(I.label).width,g.fillStyle=o.backdropColor;const e=WI(o.backdropPadding);g.fillRect(-C/2-e.left,-l-a.size/2-e.top,C+e.width,a.size+e.height)}mI(g,I.label,0,-l,a,{color:o.color,strokeColor:o.textStrokeColor,strokeWidth:o.textStrokeWidth})})),g.restore()}drawTitle(){}}qg(ya,"id","radialLinear"),qg(ya,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Ot.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:g=>g,padding:5,centerPointLabels:!1}}),qg(ya,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),qg(ya,"descriptors",{angleLines:{_fallback:"grid"}});const Ba={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Sa=Object.keys(Ba);function Wa(g,e){return g-e}function Va(g,e){if(xe(e))return null;const t=g._adapter,{parser:I,round:l,isoWeekday:C}=g._parseOpts;let n=e;return"function"===typeof I&&(n=I(n)),we(n)||(n="string"===typeof I?t.parse(n,I):t.parse(n)),null===n?null:(l&&(n="week"!==l||!rt(C)&&!0!==C?t.startOf(n,l):t.startOf(n,"isoWeek",C)),+n)}function Ra(g,e,t,I){const l=Sa.length;for(let C=Sa.indexOf(g);C<l-1;++C){const g=Ba[Sa[C]],l=g.steps?g.steps:Number.MAX_SAFE_INTEGER;if(g.common&&Math.ceil((t-e)/(l*g.size))<=I)return Sa[C]}return Sa[l-1]}function Xa(g,e,t){if(t){if(t.length){const{lo:I,hi:l}=Vt(t,e);g[t[I]>=e?t[I]:t[l]]=!0}}else g[e]=!0}function Ja(g,e,t){const I=[],l={},C=e.length;let n,o;for(n=0;n<C;++n)o=e[n],l[o]=n,I.push({value:o,major:!1});return 0!==C&&t?function(g,e,t,I){const l=g._adapter,C=+l.startOf(e[0].value,I),n=e[e.length-1].value;let o,a;for(o=C;o<=n;o=+l.add(o,1,I))a=t[o],a>=0&&(e[a].major=!0);return e}(g,I,l,t):I}class ka extends $C{constructor(g){super(g),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(g){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const t=g.time||(g.time={}),I=this._adapter=new CC(g.adapters.date);I.init(e),Te(t.displayFormats,I.formats()),this._parseOpts={parser:t.parser,round:t.round,isoWeekday:t.isoWeekday},super.init(g),this._normalized=e.normalized}parse(g,e){return void 0===g?null:Va(this,g)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const g=this.options,e=this._adapter,t=g.time.unit||"day";let{min:I,max:l,minDefined:C,maxDefined:n}=this.getUserBounds();function o(g){C||isNaN(g.min)||(I=Math.min(I,g.min)),n||isNaN(g.max)||(l=Math.max(l,g.max))}C&&n||(o(this._getLabelBounds()),"ticks"===g.bounds&&"labels"===g.ticks.source||o(this.getMinMax(!1))),I=we(I)&&!isNaN(I)?I:+e.startOf(Date.now(),t),l=we(l)&&!isNaN(l)?l:+e.endOf(Date.now(),t)+1,this.min=Math.min(I,l-1),this.max=Math.max(I+1,l)}_getLabelBounds(){const g=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY;return g.length&&(e=g[0],t=g[g.length-1]),{min:e,max:t}}buildTicks(){const g=this.options,e=g.time,t=g.ticks,I="labels"===t.source?this.getLabelTimestamps():this._generate();"ticks"===g.bounds&&I.length&&(this.min=this._userMin||I[0],this.max=this._userMax||I[I.length-1]);const l=this.min,C=function(g,e,t){let I=0,l=g.length;for(;I<l&&g[I]<e;)I++;for(;l>I&&g[l-1]>t;)l--;return I>0||l<g.length?g.slice(I,l):g}(I,l,this.max);return this._unit=e.unit||(t.autoSkip?Ra(e.minUnit,this.min,this.max,this._getLabelCapacity(l)):function(g,e,t,I,l){for(let C=Sa.length-1;C>=Sa.indexOf(t);C--){const t=Sa[C];if(Ba[t].common&&g._adapter.diff(l,I,t)>=e-1)return t}return Sa[t?Sa.indexOf(t):0]}(this,C.length,e.minUnit,this.min,this.max)),this._majorUnit=t.major.enabled&&"year"!==this._unit?function(g){for(let e=Sa.indexOf(g)+1,t=Sa.length;e<t;++e)if(Ba[Sa[e]].common)return Sa[e]}(this._unit):void 0,this.initOffsets(I),g.reverse&&C.reverse(),Ja(this,C,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map((g=>+g.value)))}initOffsets(){let g,e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],I=0,l=0;this.options.offset&&t.length&&(g=this.getDecimalForValue(t[0]),I=1===t.length?1-g:(this.getDecimalForValue(t[1])-g)/2,e=this.getDecimalForValue(t[t.length-1]),l=1===t.length?e:(e-this.getDecimalForValue(t[t.length-2]))/2);const C=t.length<3?.5:.25;I=St(I,0,C),l=St(l,0,C),this._offsets={start:I,end:l,factor:1/(I+1+l)}}_generate(){const g=this._adapter,e=this.min,t=this.max,I=this.options,l=I.time,C=l.unit||Ra(l.minUnit,e,t,this._getLabelCapacity(e)),n=Ke(I.ticks.stepSize,1),o="week"===C&&l.isoWeekday,a=rt(o)||!0===o,i={};let s,c,d=e;if(a&&(d=+g.startOf(d,"isoWeek",o)),d=+g.startOf(d,a?"day":C),g.diff(t,e,C)>1e5*n)throw new Error(e+" and "+t+" are too far apart with stepSize of "+n+" "+C);const A="data"===I.ticks.source&&this.getDataTimestamps();for(s=d,c=0;s<t;s=+g.add(s,n,C),c++)Xa(i,s,A);return s!==t&&"ticks"!==I.bounds&&1!==c||Xa(i,s,A),Object.keys(i).sort(Wa).map((g=>+g))}getLabelForValue(g){const e=this._adapter,t=this.options.time;return t.tooltipFormat?e.format(g,t.tooltipFormat):e.format(g,t.displayFormats.datetime)}format(g,e){const t=this.options.time.displayFormats,I=this._unit,l=e||t[I];return this._adapter.format(g,l)}_tickFormatFunction(g,e,t,I){const l=this.options,C=l.ticks.callback;if(C)return Me(C,[g,e,t],this);const n=l.time.displayFormats,o=this._unit,a=this._majorUnit,i=o&&n[o],s=a&&n[a],c=t[e],d=a&&s&&c&&c.major;return this._adapter.format(g,I||(d?s:i))}generateTickLabels(g){let e,t,I;for(e=0,t=g.length;e<t;++e)I=g[e],I.label=this._tickFormatFunction(I.value,e,g)}getDecimalForValue(g){return null===g?NaN:(g-this.min)/(this.max-this.min)}getPixelForValue(g){const e=this._offsets,t=this.getDecimalForValue(g);return this.getPixelForDecimal((e.start+t)*e.factor)}getValueForPixel(g){const e=this._offsets,t=this.getDecimalForPixel(g)/e.factor-e.end;return this.min+t*(this.max-this.min)}_getLabelSize(g){const e=this.options.ticks,t=this.ctx.measureText(g).width,I=mt(this.isHorizontal()?e.maxRotation:e.minRotation),l=Math.cos(I),C=Math.sin(I),n=this._resolveTickFontOptions(0).size;return{w:t*l+n*C,h:t*C+n*l}}_getLabelCapacity(g){const e=this.options.time,t=e.displayFormats,I=t[e.unit]||t.millisecond,l=this._tickFormatFunction(g,0,Ja(this,[g],this._majorUnit),I),C=this._getLabelSize(l),n=Math.floor(this.isHorizontal()?this.width/C.w:this.height/C.h)-1;return n>0?n:1}getDataTimestamps(){let g,e,t=this._cache.data||[];if(t.length)return t;const I=this.getMatchingVisibleMetas();if(this._normalized&&I.length)return this._cache.data=I[0].controller.getAllParsedValues(this);for(g=0,e=I.length;g<e;++g)t=t.concat(I[g].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const g=this._cache.labels||[];let e,t;if(g.length)return g;const I=this.getLabels();for(e=0,t=I.length;e<t;++e)g.push(Va(this,I[e]));return this._cache.labels=this._normalized?g:this.normalize(g)}normalize(g){return ft(g.sort(Wa))}}function fa(g,e,t){let I,l,C,n,o=0,a=g.length-1;t?(e>=g[o].pos&&e<=g[a].pos&&({lo:o,hi:a}=Rt(g,"pos",e)),({pos:I,time:C}=g[o]),({pos:l,time:n}=g[a])):(e>=g[o].time&&e<=g[a].time&&({lo:o,hi:a}=Rt(g,"time",e)),({time:I,pos:C}=g[o]),({time:l,pos:n}=g[a]));const i=l-I;return i?C+(n-C)*(e-I)/i:C}qg(ka,"id","time"),qg(ka,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});class va extends ka{constructor(g){super(g),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const g=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(g);this._minPos=fa(e,this.min),this._tableRange=fa(e,this.max)-this._minPos,super.initOffsets(g)}buildLookupTable(g){const{min:e,max:t}=this,I=[],l=[];let C,n,o,a,i;for(C=0,n=g.length;C<n;++C)a=g[C],a>=e&&a<=t&&I.push(a);if(I.length<2)return[{time:e,pos:0},{time:t,pos:1}];for(C=0,n=I.length;C<n;++C)i=I[C+1],o=I[C-1],a=I[C],Math.round((i+o)/2)!==a&&l.push({time:a,pos:C/(n-1)});return l}_generate(){const g=this.min,e=this.max;let t=super.getDataTimestamps();return t.includes(g)&&t.length||t.splice(0,0,g),t.includes(e)&&1!==t.length||t.push(e),t.sort(((g,e)=>g-e))}_getTimestampsForTable(){let g=this._cache.all||[];if(g.length)return g;const e=this.getDataTimestamps(),t=this.getLabelTimestamps();return g=e.length&&t.length?this.normalize(e.concat(t)):e.length?e:t,g=this._cache.all=g,g}getDecimalForValue(g){return(fa(this._table,g)-this._minPos)/this._tableRange}getValueForPixel(g){const e=this._offsets,t=this.getDecimalForPixel(g)/e.factor-e.end;return fa(this._table,t*this._tableRange+this._minPos,!0)}}qg(va,"id","timeseries"),qg(va,"defaults",ka.defaults);const Ya=[tC,to,ga,Object.freeze({__proto__:null,CategoryScale:Ia,LinearScale:oa,LogarithmicScale:Aa,RadialLinearScale:ya,TimeScale:ka,TimeSeriesScale:va})],xa="label";function Ha(g,e){"function"===typeof g?g(e):g&&(g.current=e)}function Na(g,e){g.labels=e}function wa(g,e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:xa;const I=[];g.datasets=e.map((e=>{const l=g.datasets.find((g=>g[t]===e[t]));return l&&e.data&&!I.includes(l)?(I.push(l),Object.assign(l,e),l):{...e}}))}function Fa(g){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xa;const t={labels:[],datasets:[]};return Na(t,g.labels),wa(t,g.datasets,e),t}function Ka(g,e){const{height:t=150,width:l=300,redraw:C=!1,datasetIdKey:n,type:o,data:a,options:i,plugins:s=[],fallbackContent:c,updateMode:d,...A}=g,r=(0,I.useRef)(null),u=(0,I.useRef)(),m=()=>{r.current&&(u.current=new fn(r.current,{type:o,data:Fa(a,n),options:i&&{...i},plugins:s}),Ha(e,u.current))},b=()=>{Ha(e,null),u.current&&(u.current.destroy(),u.current=null)};return(0,I.useEffect)((()=>{!C&&u.current&&i&&function(g,e){const t=g.options;t&&e&&Object.assign(t,e)}(u.current,i)}),[C,i]),(0,I.useEffect)((()=>{!C&&u.current&&Na(u.current.config.data,a.labels)}),[C,a.labels]),(0,I.useEffect)((()=>{!C&&u.current&&a.datasets&&wa(u.current.config.data,a.datasets,n)}),[C,a.datasets]),(0,I.useEffect)((()=>{u.current&&(C?(b(),setTimeout(m)):u.current.update(d))}),[C,i,a.labels,a.datasets,d]),(0,I.useEffect)((()=>{u.current&&(b(),setTimeout(m))}),[o]),(0,I.useEffect)((()=>(m(),()=>b())),[]),I.createElement("canvas",Object.assign({ref:r,role:"img",height:t,width:l},A),c)}const za=(0,I.forwardRef)(Ka);function Ma(g,e){return fn.register(e),(0,I.forwardRef)(((e,t)=>I.createElement(za,Object.assign({},e,{ref:t,type:g}))))}const Ea=Ma("line",_l),Qa=Ma("bar",Tl),Ua=Ma("doughnut",Ol);fn.register(...Ya);const La=()=>(0,hg.jsxs)(hg.Fragment,{children:[(0,hg.jsx)("style",{children:"\n    @keyframes spin {\n      0% { transform: rotate(0deg); }\n      100% { transform: rotate(360deg); }\n    }\n  "}),(0,hg.jsx)("div",{style:{border:"10px solid #f3f3f3",borderTop:"10px solid #3498db",borderRadius:"50%",width:"80px",height:"80px",animation:"spin 1s linear infinite"}})]}),ja=()=>{const g=q(),[e,t]=(0,I.useState)(),[l,C]=(0,I.useState)(),[n,o]=(0,I.useState)(1),[a,i]=(0,I.useState)(null),[s,c]=(0,I.useState)({}),[d,A]=(0,I.useState)(0),[r,u]=(0,I.useState)({}),[m,b]=(0,I.useState)({}),[h,Z]=(0,I.useState)(0),[G,p]=(0,I.useState)(0),[y,B]=(0,I.useState)(0),[S,W]=(0,I.useState)(!1),[V,R]=(0,I.useState)(!1),[X,J]=(0,I.useState)(!0),k=["January","February","March","April","May","June","July","August","September","October","November","December"],[f,v]=(0,I.useState)(!0);(0,I.useEffect)((()=>{window.localStorage.getItem("userInfo")||g("/login")}),[g]);(0,I.useEffect)((()=>{(async()=>{if(window.localStorage.getItem("userInfo")){W(!0);try{v(!0);const[e,I]=await Promise.all([fetch("/api/saleslog/1year",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}}),fetch("/api/expenselog/totalexpense/1year",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}})]);if(!e.ok)return console.error("Failed to fetch sales data"),window.localStorage.clear(),void g("/login");const l=await e.json();if(t(l),I.ok){const g=await I.json();C(g)}else console.error("Failed to fetch expenses data")}catch(e){console.log(e)}finally{v(!1)}}})()}),[]),(0,I.useEffect)((()=>{(()=>{const g=new Date;g.setDate(g.getDate()-n),g.setHours(0,0,0,0);const t=null===e||void 0===e?void 0:e.filter((e=>new Date(e.soldAt).setHours(0,0,0,0)>g)),I=null===l||void 0===l?void 0:l.filter((e=>new Date(e.date).setHours(0,0,0,0)>g)),C=null===t||void 0===t?void 0:t.reduce(((g,e)=>{const t=new Date(e.soldAt).toLocaleDateString();return g[t]=(g[t]||0)+e.sellingPrice,g}),{});c(C||{});const o=null===t||void 0===t?void 0:t.reduce(((g,e)=>g+e.sellingPrice),0);A(o||0);const a=null===t||void 0===t?void 0:t.reduce(((g,e)=>{const t=e.product;return g[t]=(g[t]||0)+1,g}),{});u(a||{});const i=null===t||void 0===t?void 0:t.reduce(((g,e)=>{const t=e.brand;return g[t]||(g[t]={sellingPrice:0,profit:0}),g[t].sellingPrice+=e.sellingPrice,g[t].profit+=e.sellingPrice-e.mrp,g}),{});b(i||{});let s=0;for(let e in i)i.hasOwnProperty(e)&&(s+=i[e].profit);B(s);const d=null===I||void 0===I?void 0:I.reduce(((g,e)=>g+e.expenseAmount),0),r=null===I||void 0===I?void 0:I.reduce(((g,e)=>!0===e.goodsPayment?g+e.expenseAmount:g),0);Z(d||0),p(r||0),W(!1)})()}),[n,e,l]);(0,I.useEffect)((()=>{null!==a&&V&&(()=>{const g=(new Date).getFullYear(),t=null===e||void 0===e?void 0:e.filter((e=>{const t=new Date(e.soldAt);return t.getMonth()===a&&t.getFullYear()===g})),I=null===l||void 0===l?void 0:l.filter((e=>{const t=new Date(e.date);return t.getMonth()===a&&t.getFullYear()===g})),C=null===t||void 0===t?void 0:t.reduce(((g,e)=>{const t=new Date(e.soldAt).toLocaleDateString();return g[t]=(g[t]||0)+e.sellingPrice,g}),{});c(C||{});const n=null===t||void 0===t?void 0:t.reduce(((g,e)=>g+e.sellingPrice),0);A(n||0);const o=null===t||void 0===t?void 0:t.reduce(((g,e)=>{const t=e.product;return g[t]=(g[t]||0)+1,g}),{});u(o||{});const i=null===t||void 0===t?void 0:t.reduce(((g,e)=>{const t=e.brand;return g[t]||(g[t]={sellingPrice:0,profit:0}),g[t].sellingPrice+=e.sellingPrice,g[t].profit+=e.sellingPrice-e.mrp,g}),{});b(i||{});let s=0;for(let e in i)i.hasOwnProperty(e)&&(s+=i[e].profit);B(s);const d=null===I||void 0===I?void 0:I.reduce(((g,e)=>g+e.expenseAmount),0),r=null===I||void 0===I?void 0:I.reduce(((g,e)=>!0===e.goodsPayment?g+e.expenseAmount:g),0);Z(d||0),p(r||0),W(!1)})()}),[a,V]);const Y=g=>{const e=["rgba(255, 99, 132, 0.7)","rgba(54, 162, 235, 0.7)","rgba(255, 206, 86, 0.7)","rgba(75, 192, 192, 0.7)","rgba(192, 192, 192, 0.7)","rgba(153, 102, 255, 0.7)","rgba(255, 159, 64, 0.7)","rgba(255, 99, 255, 0.7)","rgba(54, 235, 162, 0.7)","rgba(206, 86, 255, 0.7)","rgba(192, 75, 192, 0.7)","rgba(99, 255, 132, 0.7)","rgba(235, 54, 162, 0.7)","rgba(86, 255, 206, 0.7)","rgba(255, 192, 75, 0.7)","rgba(99, 132, 255, 0.7)","rgba(162, 54, 235, 0.7)"];for(let t=e.length;t<g;t++){const g="rgba(".concat(Math.floor(256*Math.random()),", ").concat(Math.floor(256*Math.random()),", ").concat(Math.floor(256*Math.random()),", 0.7)");e.push(g)}return e.slice(0,g)},x={labels:Object.keys(s),datasets:[{label:"Daily Sales Sum",data:Object.values(s),fill:!0,backgroundColor:"rgba(75,192,192,0.2)",borderColor:"rgba(75,192,192,1)"}]},H={labels:Object.keys(r),datasets:[{label:"Products Sold",data:Object.values(r),backgroundColor:Y(Object.keys(r).length),borderWidth:1}]},N={labels:Object.keys(m),datasets:[{label:"Selling Price",data:Object.keys(m).map((g=>m[g].sellingPrice)),backgroundColor:Y(Object.keys(m).length),borderWidth:1},{label:"Profit",data:Object.keys(m).map((g=>m[g].profit)),backgroundColor:Y(Object.keys(m).length).map((g=>g.replace("0.7","0.3"))),borderWidth:1}]};return(0,hg.jsxs)("div",{className:"p-4 bg-gray-100 rounded-md shadow-md",children:[f&&(0,hg.jsx)(hg.Fragment,{children:(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999},children:(0,hg.jsx)(La,{})})}),(0,hg.jsx)("h2",{className:"text-3xl font-bold mb-4",children:"Sales Dashboard"}),(0,hg.jsxs)("div",{className:"mb-4",children:[(0,hg.jsx)("label",{className:"block mb-2 text-lg",children:"Select Days:"}),(0,hg.jsx)("select",{value:n,onChange:g=>{o(parseInt(g.target.value,10)),J(!0)},className:"border p-2 rounded-md",children:[1,2,3,4,5,6,7,15,20,25,30,60,90,120,150,180,365].map((g=>(0,hg.jsx)("option",{value:g,children:"".concat(g," Day").concat(g>1?"s":"")},g)))})]}),(0,hg.jsxs)("div",{className:"mb-4",children:[(0,hg.jsx)("label",{className:"block mb-2 text-lg",children:"Select Month:"}),(0,hg.jsxs)("select",{value:null===a?"":a,onChange:g=>{i(parseInt(g.target.value,10)),R(!0),J(!1)},className:"border p-2 rounded-md",children:[(0,hg.jsx)("option",{value:"",children:"-"}),Array.from({length:12}).map(((g,e)=>(0,hg.jsx)("option",{value:e,children:new Date((new Date).getFullYear(),e,1).toLocaleString("default",{month:"long"})},e)))]})]}),(0,hg.jsxs)("div",{className:"mb-8",children:[(0,hg.jsxs)("h3",{className:"text-lg font-semibold mb-2",children:["Total Sales in"," ",X?n+" days ":k[a]," :"]}),(0,hg.jsxs)("div",{className:"text-xl font-bold",children:["\u20b9",S?" Calculating.....":d.toLocaleString("hi")]})]}),(0,hg.jsxs)("div",{className:"mb-8",children:[(0,hg.jsxs)("h3",{className:"text-lg font-semibold mb-2",children:["Gross Profit in"," ",X?n+" days ":k[a],":"]}),(0,hg.jsxs)("div",{className:"text-xl font-bold",children:["\u20b9",S?" Calculating.....":y.toLocaleString("hi")]})]}),(0,hg.jsxs)("div",{className:"mb-8",children:[(0,hg.jsxs)("h3",{className:"text-lg font-semibold mb-2",children:["Avg Profit % in"," ",X?n+" days ":k[a],":"]}),(0,hg.jsx)("div",{className:"text-xl font-bold",children:S?" Calculating.....":(y&&d?Math.round(y/d*100*100)/100:0)+"%"}),(0,hg.jsxs)("h3",{className:"text-lg font-semibold mb-2",children:["Gross ROI in"," ",X?n+" days ":k[a],":"]}),(0,hg.jsx)("div",{className:"text-xl font-bold",children:S?" Calculating.....":(y&&d?Math.round(y/(d-y)*100*100)/100:0)+"%"}),(0,hg.jsxs)("h3",{className:"text-lg font-semibold mb-2",children:["NET ROI in"," ",X?n+" days ":k[a],":"]}),(0,hg.jsx)("div",{className:"text-xl font-bold",children:S?" Calculating.....":(y&&d?Math.round((y-(h-G))/(d-y)*100*100)/100:0)+"%"}),(0,hg.jsxs)("h3",{className:"text-lg font-semibold mb-2",children:["Net Profit in"," ",X?n+" days ":k[a],":"]}),(0,hg.jsxs)("div",{className:"text-xl font-bold",children:["\u20b9",S?" Calculating.....":(y-(h-G)).toLocaleString("hi")]})]}),(0,hg.jsxs)("div",{children:[(0,hg.jsxs)("h3",{className:"text-lg font-semibold mb-2",children:["Total Expenses in"," ",X?n+" days ":k[a],":"]}),(0,hg.jsxs)("div",{className:"text-xl font-bold",children:["\u20b9",S?" Calculating.....":(h-G).toLocaleString("hi")]}),X&&n?(0,hg.jsxs)(hg.Fragment,{children:[(0,hg.jsxs)("h3",{className:"text-lg font-semibold mb-2",children:["Avg Expenses per day over ",n," days"]}),(0,hg.jsxs)("div",{className:"text-xl font-bold",children:["\u20b9",S?"Calculating.....":((h-G)/n).toLocaleString("hi")]})]}):null,(0,hg.jsxs)("div",{children:[(0,hg.jsxs)("h3",{className:"text-lg font-semibold mb-2",children:["Total Payment in"," ",X?n+" days ":k[a],":"]}),(0,hg.jsxs)("div",{className:"text-xl font-bold",children:["\u20b9",S?" Calculating.....":G.toLocaleString("hi")]})]})]}),(0,hg.jsxs)("div",{className:"mb-8",children:[(0,hg.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Sales Over Time"}),(0,hg.jsx)(Ea,{data:x,height:150})]}),(0,hg.jsxs)("div",{className:"mb-8 w-full h-screen",children:[(0,hg.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Products Sold"}),(0,hg.jsx)(Qa,{data:H,options:{maintainAspectRatio:!1}})]}),(0,hg.jsxs)("div",{className:"mb-8 w-full h-screen",children:[(0,hg.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Profits by Brand"}),(0,hg.jsx)(Qa,{data:N,options:{maintainAspectRatio:!1}})]})]})},Da=()=>(0,hg.jsx)(hg.Fragment,{children:(0,hg.jsx)("div",{className:"fixed top-0 right-0 p-4",children:(0,hg.jsx)("a",{href:"/menu",className:"text-black hover:text-gray-300",children:"Menu"})})}),Ta=()=>{const g=q(),[e,t]=(0,I.useState)([]),[l,C]=(0,I.useState)(""),[n,o]=(0,I.useState)([]),[a,i]=(0,I.useState)(!1),[s,c]=(0,I.useState)(!1);function d(g){return g.sort(((g,e)=>g.brand.localeCompare(e.brand))),g.forEach((g=>{g.products.sort(((g,e)=>g.localeCompare(e)))})),g}(0,I.useEffect)((()=>{(async()=>{try{const e=await fetch("/api/dropdownoption/products",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(e.ok){const g=await e.json();d(g),t(g)}else 401===e.status?(window.localStorage.clear(),g("/login")):console.error("Failed to fetch brands and products")}catch(e){console.log(e)}})()}),[g]),(0,I.useEffect)((()=>{d(e)}),[e]);const A=""===l.trim();return(0,hg.jsxs)("div",{className:"p-4 bg-gray-100",children:[(0,hg.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Add Brand and Product"}),(0,hg.jsxs)("div",{className:"mb-4",children:[(0,hg.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Brands and Products"}),e.map(((g,I)=>(0,hg.jsxs)("div",{className:"mb-2 bg-white p-4 rounded shadow-md",children:[(0,hg.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>(g=>{const I=[...e];I[g].expanded=!I[g].expanded,t(I)})(I),children:[(0,hg.jsx)("strong",{children:g.brand}),(0,hg.jsx)("p",{className:"transition transform ".concat(g.expanded?"":"rotate-180"),children:"^"})]}),g.expanded&&(0,hg.jsx)("ul",{className:"list-disc ml-6",children:g.products.map(((g,e)=>(0,hg.jsx)("li",{className:"block py-2 px-4 rounded transition duration-300 hover:bg-gray-200",children:g},e)))})]},I)))]}),(0,hg.jsxs)("div",{className:"mb-4 bg-white p-4 rounded shadow-md",children:[(0,hg.jsx)("label",{className:"block mb-2",children:"Add New Brand:"}),(0,hg.jsx)("input",{type:"text",placeholder:"Enter New Brand",value:l,onChange:g=>{C(g.target.value.toUpperCase())},className:"border p-2 w-full mb-2"}),(0,hg.jsx)("textarea",{placeholder:"Enter Products (comma-separated)",value:n.join(", "),onChange:g=>{o(g.target.value.split(",").map((g=>g.trim())))},className:"border p-2 w-full"}),a&&(0,hg.jsx)("div",{className:"text-green-500 mt-2",children:"Brand added successfully!"}),(0,hg.jsx)("button",{onClick:async()=>{if(""!==l.trim())try{c(!0);if((await fetch("/api/dropdownoption/products",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)},body:JSON.stringify({brand:l,products:n})})).ok){const g=[...e];g.push({brand:l,products:n}),t(g),C(""),o([]),i(!0),setTimeout((()=>{i(!1)}),3e3),c(!1)}else console.error("Failed to add brand")}catch(g){console.error("Error:",g)}},disabled:A,className:"bg-green-500 text-white py-2 px-4 rounded focus:outline-none ".concat(A?"opacity-50 cursor-not-allowed":"hover:bg-green-700"),children:s?"Adding...":"Add Brand"})]})]})},Pa=()=>{const g=q(),[e,t]=(0,I.useState)([]),[l,C]=(0,I.useState)([]),[n,o]=(0,I.useState)(""),[a,i]=(0,I.useState)(!0),[s,c]=(0,I.useState)(!1),[d,A]=(0,I.useState)(!1);(0,I.useEffect)((()=>{window.localStorage.getItem("userInfo")||g("/login")}),[g]),(0,I.useEffect)((()=>{(async()=>{if(window.localStorage.getItem("userInfo"))try{const e=await fetch("/api/dropdownoption/categories",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(e.ok){const g=await e.json();g[0].category.sort(((g,e)=>g.localeCompare(e))),t(g[0].category)}else 401===e.status?(window.localStorage.clear(),g("/login")):console.error("Failed to fetch categories")}catch(e){console.log(e)}})()}),[]);const r=""===n.trim();return(0,hg.jsxs)("div",{className:"p-4",children:[(0,hg.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Add Category"}),(0,hg.jsxs)("div",{className:"flex border p-2",children:[(0,hg.jsxs)("div",{className:"w-1/3 pr-4",children:[(0,hg.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Categories"}),(0,hg.jsx)("ul",{className:"space-y-2",children:e.map(((g,e)=>(0,hg.jsx)("li",{className:"cursor-pointer border-b py-2",children:(0,hg.jsx)("div",{className:"border-b pb-1",children:g},e)},e)))})]}),(0,hg.jsx)("div",{className:"w-2/3 pl-4",children:(0,hg.jsxs)("div",{className:"mt-8",children:[(0,hg.jsx)("label",{className:"block mb-2",children:"Add New Category:"}),(0,hg.jsx)("input",{type:"text",placeholder:"Enter New Category",value:n,onChange:g=>{o(g.target.value)},className:"border p-2 w-full"}),(0,hg.jsx)("button",{onClick:()=>{t([...e,n.trim()]),C([...l,n.trim()]),o(""),i(!1)},disabled:r,className:"bg-green-500 text-white py-2 px-4 rounded focus:outline-none hover:bg-green-700 ".concat(r?"cursor-not-allowed opacity-50":""),children:"Add Category"})]})})]}),(0,hg.jsxs)("div",{className:"mt-2",children:[s&&(0,hg.jsx)("div",{className:"text-green-500 mt-0",children:"Data saved successfully!"}),(0,hg.jsx)("button",{onClick:async()=>{try{A(!0);const e=await fetch("/api/dropdownoption/categories",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)},body:JSON.stringify({category:l})});e.ok?(o(""),C([]),i(!0),c(!0),setTimeout((()=>{c(!1)}),3e3)):401===e.status?(window.localStorage.clear(),g("/login")):console.error("Failed to save category")}catch(e){console.error("Error:",e)}finally{A(!1)}},disabled:a,className:"py-2 px-4 rounded focus:outline-none ".concat(a?"bg-gray-500 opacity-50 cursor-not-allowed text-black":"bg-indigo-500 hover:bg-indigo-700 text-white"),children:d?"Saving...":"Save"})]})]})},Oa=()=>{const g=q(),[e,t]=(0,I.useState)([]),[l,C]=(0,I.useState)([]),[n,o]=(0,I.useState)(""),[a,i]=(0,I.useState)(!0),[s,c]=(0,I.useState)(!1),[d,A]=(0,I.useState)(!1);(0,I.useEffect)((()=>{window.localStorage.getItem("userInfo")||g("/login")}),[g]),(0,I.useEffect)((()=>{(async()=>{if(window.localStorage.getItem("userInfo"))try{const e=await fetch("/api/dropdownoption/sizes",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(e.ok){const g=await e.json();t(g[0].size)}else 401===e.status?(window.localStorage.clear(),g("/login")):console.error("Failed to fetch sizes")}catch(e){console.log(e)}})()}),[]);const r=""===n.trim();return(0,hg.jsxs)("div",{className:"p-4",children:[(0,hg.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Add Size"}),(0,hg.jsxs)("div",{className:"flex border p-2",children:[(0,hg.jsxs)("div",{className:"w-1/3 pr-4",children:[(0,hg.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Sizes"}),(0,hg.jsx)("ul",{className:"space-y-2",children:e.map(((g,e)=>(0,hg.jsx)("li",{className:"cursor-pointer border-b py-2",children:(0,hg.jsx)("div",{className:"border-b pb-1",children:g},e)},e)))})]}),(0,hg.jsx)("div",{className:"w-2/3 pl-4",children:(0,hg.jsxs)("div",{className:"mt-8",children:[(0,hg.jsx)("label",{className:"block mb-2",children:"Add New Size:"}),(0,hg.jsx)("input",{type:"text",placeholder:"Enter New Size",value:n,onChange:g=>{o(g.target.value)},className:"border p-2 w-full"}),(0,hg.jsx)("button",{onClick:()=>{t([...e,n.trim()]),C([...l,n.trim()]),o(""),i(!1)},disabled:r,className:"bg-green-500 text-white py-2 px-4 rounded focus:outline-none hover:bg-green-700 ".concat(r?"cursor-not-allowed opacity-50":""),children:"Add Size"})]})})]}),(0,hg.jsxs)("div",{className:"mt-2",children:[s&&(0,hg.jsx)("div",{className:"text-green-500 mt-0",children:"Data saved successfully!"}),(0,hg.jsx)("button",{onClick:async()=>{try{A(!0);const e=await fetch("/api/dropdownoption/sizes",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)},body:JSON.stringify({size:l})});e.ok?(o(""),C([]),i(!0),c(!0),setTimeout((()=>{c(!1)}),3e3)):401===e.status?(window.localStorage.clear(),g("/login")):console.error("Failed to save size")}catch(e){console.error("Error:",e)}finally{A(!1)}},disabled:a,className:"py-2 px-4 rounded focus:outline-none ".concat(a?"bg-gray-500 opacity-50 cursor-not-allowed text-black":"bg-indigo-500 hover:bg-indigo-700 text-white"),children:d?"Saving...":"Save"})]})]})},_a=()=>{const g=q(),[e,t]=(0,I.useState)([]),[l,C]=(0,I.useState)({expenseType:"",expenseAmount:"",goodsPayment:!1,description:""}),[n,o]=(0,I.useState)(!1),[a,i]=(0,I.useState)({message:"",type:""});(0,I.useEffect)((()=>{(async()=>{try{const g=await fetch("/api/expenseTypes",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(!g.ok)throw new Error("Failed to fetch expense types");const e=await g.json();t(e.map((g=>g.name)))}catch(g){console.error("Error fetching expense types:",g)}})()}),[]);const s=()=>l.expenseType&&!isNaN(l.expenseAmount)&&l.expenseAmount>0;return(0,I.useEffect)((()=>{window.localStorage.getItem("userInfo")||g("/login")}),[g]),(0,hg.jsxs)("div",{className:"p-4",children:[n&&(0,hg.jsx)(hg.Fragment,{children:(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999},children:(0,hg.jsx)(La,{})})}),(0,hg.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Add Expense"}),(0,hg.jsxs)("div",{className:"mb-4",children:[(0,hg.jsx)("label",{className:"block mb-2",children:"Expense Type:"}),(0,hg.jsxs)("select",{value:l.expenseType,onChange:g=>C({...l,expenseType:g.target.value}),className:"border p-2 w-full",children:[(0,hg.jsx)("option",{value:"",children:"Select Expense Type"}),e.map((g=>(0,hg.jsx)("option",{value:g,children:g},g)))]})]}),(0,hg.jsxs)("div",{className:"mb-4",children:[(0,hg.jsx)("label",{className:"block mb-2",children:"Expense Amount:"}),(0,hg.jsx)("input",{type:"number",value:l.expenseAmount,onChange:g=>C({...l,expenseAmount:Math.max(0,g.target.value)}),className:"border p-2 w-full"})]}),(0,hg.jsxs)("div",{className:"mb-4",children:[(0,hg.jsx)("label",{className:"block mb-2",children:"Goods Payment:"}),(0,hg.jsxs)("select",{value:l.goodsPayment,onChange:g=>C({...l,goodsPayment:"true"===g.target.value}),className:"border p-2 w-full",children:[(0,hg.jsx)("option",{value:"false",children:"No"}),(0,hg.jsx)("option",{value:"true",children:"Yes"})]})]}),(0,hg.jsxs)("div",{className:"mb-4",children:[(0,hg.jsx)("label",{className:"block mb-2",children:"Description:"}),(0,hg.jsx)("textarea",{value:l.description,onChange:g=>C({...l,description:g.target.value}),className:"border p-2 w-full",placeholder:"Enter a description (optional)"})]}),a.message&&(0,hg.jsx)("div",{className:"mt-4 p-2 rounded text-white text-center ".concat("success"===a.type?"bg-green-500":"error"===a.type?"bg-red-500":"bg-yellow-500"),children:a.message}),(0,hg.jsx)("button",{onClick:async()=>{if(!s())return i({message:"Please enter a valid expense type and amount!",type:"warning"}),void setTimeout((()=>i({message:"",type:""})),3e3);o(!0);try{const e=await fetch("/api/expenseLog",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)},body:JSON.stringify(l)});e.ok?(C({expenseType:"",expenseAmount:"",goodsPayment:!1,description:""}),i({message:"Expense added successfully!",type:"success"})):401===e.status?(window.localStorage.clear(),g("/login")):i({message:"Failed to add expense. Try again!",type:"error"})}catch(e){console.error("Error:",e),i({message:"Something went wrong. Please try again!",type:"error"})}finally{o(!1),setTimeout((()=>i({message:"",type:""})),3e3)}},className:"bg-blue-500 text-white py-2 px-4 rounded focus:outline-none hover:bg-blue-700 ".concat(!s()&&"opacity-50 cursor-not-allowed"),disabled:!s(),children:n?"Adding...":"Add Expense"})]})};function qa(g,e){return function(){return g.apply(e,arguments)}}const{toString:$a}=Object.prototype,{getPrototypeOf:gi}=Object,ei=(ti=Object.create(null),g=>{const e=$a.call(g);return ti[e]||(ti[e]=e.slice(8,-1).toLowerCase())});var ti;const Ii=g=>(g=g.toLowerCase(),e=>ei(e)===g),li=g=>e=>typeof e===g,{isArray:Ci}=Array,ni=li("undefined");const oi=Ii("ArrayBuffer");const ai=li("string"),ii=li("function"),si=li("number"),ci=g=>null!==g&&"object"===typeof g,di=g=>{if("object"!==ei(g))return!1;const e=gi(g);return(null===e||e===Object.prototype||null===Object.getPrototypeOf(e))&&!(Symbol.toStringTag in g)&&!(Symbol.iterator in g)},Ai=Ii("Date"),ri=Ii("File"),ui=Ii("Blob"),mi=Ii("FileList"),bi=Ii("URLSearchParams");function hi(g,e){let t,I,{allOwnKeys:l=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==g&&"undefined"!==typeof g)if("object"!==typeof g&&(g=[g]),Ci(g))for(t=0,I=g.length;t<I;t++)e.call(null,g[t],t,g);else{const I=l?Object.getOwnPropertyNames(g):Object.keys(g),C=I.length;let n;for(t=0;t<C;t++)n=I[t],e.call(null,g[n],n,g)}}function Zi(g,e){e=e.toLowerCase();const t=Object.keys(g);let I,l=t.length;for(;l-- >0;)if(I=t[l],e===I.toLowerCase())return I;return null}const Gi="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global,pi=g=>!ni(g)&&g!==Gi;const yi=(Bi="undefined"!==typeof Uint8Array&&gi(Uint8Array),g=>Bi&&g instanceof Bi);var Bi;const Si=Ii("HTMLFormElement"),Wi=(g=>{let{hasOwnProperty:e}=g;return(g,t)=>e.call(g,t)})(Object.prototype),Vi=Ii("RegExp"),Ri=(g,e)=>{const t=Object.getOwnPropertyDescriptors(g),I={};hi(t,((t,l)=>{let C;!1!==(C=e(t,l,g))&&(I[l]=C||t)})),Object.defineProperties(g,I)},Xi="abcdefghijklmnopqrstuvwxyz",Ji="0123456789",ki={DIGIT:Ji,ALPHA:Xi,ALPHA_DIGIT:Xi+Xi.toUpperCase()+Ji};const fi=Ii("AsyncFunction"),vi={isArray:Ci,isArrayBuffer:oi,isBuffer:function(g){return null!==g&&!ni(g)&&null!==g.constructor&&!ni(g.constructor)&&ii(g.constructor.isBuffer)&&g.constructor.isBuffer(g)},isFormData:g=>{let e;return g&&("function"===typeof FormData&&g instanceof FormData||ii(g.append)&&("formdata"===(e=ei(g))||"object"===e&&ii(g.toString)&&"[object FormData]"===g.toString()))},isArrayBufferView:function(g){let e;return e="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(g):g&&g.buffer&&oi(g.buffer),e},isString:ai,isNumber:si,isBoolean:g=>!0===g||!1===g,isObject:ci,isPlainObject:di,isUndefined:ni,isDate:Ai,isFile:ri,isBlob:ui,isRegExp:Vi,isFunction:ii,isStream:g=>ci(g)&&ii(g.pipe),isURLSearchParams:bi,isTypedArray:yi,isFileList:mi,forEach:hi,merge:function g(){const{caseless:e}=pi(this)&&this||{},t={},I=(I,l)=>{const C=e&&Zi(t,l)||l;di(t[C])&&di(I)?t[C]=g(t[C],I):di(I)?t[C]=g({},I):Ci(I)?t[C]=I.slice():t[C]=I};for(let l=0,C=arguments.length;l<C;l++)arguments[l]&&hi(arguments[l],I);return t},extend:function(g,e,t){let{allOwnKeys:I}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return hi(e,((e,I)=>{t&&ii(e)?g[I]=qa(e,t):g[I]=e}),{allOwnKeys:I}),g},trim:g=>g.trim?g.trim():g.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:g=>(65279===g.charCodeAt(0)&&(g=g.slice(1)),g),inherits:(g,e,t,I)=>{g.prototype=Object.create(e.prototype,I),g.prototype.constructor=g,Object.defineProperty(g,"super",{value:e.prototype}),t&&Object.assign(g.prototype,t)},toFlatObject:(g,e,t,I)=>{let l,C,n;const o={};if(e=e||{},null==g)return e;do{for(l=Object.getOwnPropertyNames(g),C=l.length;C-- >0;)n=l[C],I&&!I(n,g,e)||o[n]||(e[n]=g[n],o[n]=!0);g=!1!==t&&gi(g)}while(g&&(!t||t(g,e))&&g!==Object.prototype);return e},kindOf:ei,kindOfTest:Ii,endsWith:(g,e,t)=>{g=String(g),(void 0===t||t>g.length)&&(t=g.length),t-=e.length;const I=g.indexOf(e,t);return-1!==I&&I===t},toArray:g=>{if(!g)return null;if(Ci(g))return g;let e=g.length;if(!si(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=g[e];return t},forEachEntry:(g,e)=>{const t=(g&&g[Symbol.iterator]).call(g);let I;for(;(I=t.next())&&!I.done;){const t=I.value;e.call(g,t[0],t[1])}},matchAll:(g,e)=>{let t;const I=[];for(;null!==(t=g.exec(e));)I.push(t);return I},isHTMLForm:Si,hasOwnProperty:Wi,hasOwnProp:Wi,reduceDescriptors:Ri,freezeMethods:g=>{Ri(g,((e,t)=>{if(ii(g)&&-1!==["arguments","caller","callee"].indexOf(t))return!1;const I=g[t];ii(I)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")}))}))},toObjectSet:(g,e)=>{const t={},I=g=>{g.forEach((g=>{t[g]=!0}))};return Ci(g)?I(g):I(String(g).split(e)),t},toCamelCase:g=>g.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(g,e,t){return e.toUpperCase()+t})),noop:()=>{},toFiniteNumber:(g,e)=>(g=+g,Number.isFinite(g)?g:e),findKey:Zi,global:Gi,isContextDefined:pi,ALPHABET:ki,generateString:function(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ki.ALPHA_DIGIT,t="";const{length:I}=e;for(;g--;)t+=e[Math.random()*I|0];return t},isSpecCompliantForm:function(g){return!!(g&&ii(g.append)&&"FormData"===g[Symbol.toStringTag]&&g[Symbol.iterator])},toJSONObject:g=>{const e=new Array(10),t=(g,I)=>{if(ci(g)){if(e.indexOf(g)>=0)return;if(!("toJSON"in g)){e[I]=g;const l=Ci(g)?[]:{};return hi(g,((g,e)=>{const C=t(g,I+1);!ni(C)&&(l[e]=C)})),e[I]=void 0,l}}return g};return t(g,0)},isAsyncFn:fi,isThenable:g=>g&&(ci(g)||ii(g))&&ii(g.then)&&ii(g.catch)};function Yi(g,e,t,I,l){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=g,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),I&&(this.request=I),l&&(this.response=l)}vi.inherits(Yi,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:vi.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const xi=Yi.prototype,Hi={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((g=>{Hi[g]={value:g}})),Object.defineProperties(Yi,Hi),Object.defineProperty(xi,"isAxiosError",{value:!0}),Yi.from=(g,e,t,I,l,C)=>{const n=Object.create(xi);return vi.toFlatObject(g,n,(function(g){return g!==Error.prototype}),(g=>"isAxiosError"!==g)),Yi.call(n,g.message,e,t,I,l),n.cause=g,n.name=g.name,C&&Object.assign(n,C),n};const Ni=Yi;function wi(g){return vi.isPlainObject(g)||vi.isArray(g)}function Fi(g){return vi.endsWith(g,"[]")?g.slice(0,-2):g}function Ki(g,e,t){return g?g.concat(e).map((function(g,e){return g=Fi(g),!t&&e?"["+g+"]":g})).join(t?".":""):e}const zi=vi.toFlatObject(vi,{},null,(function(g){return/^is[A-Z]/.test(g)}));const Mi=function(g,e,t){if(!vi.isObject(g))throw new TypeError("target must be an object");e=e||new FormData;const I=(t=vi.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(g,e){return!vi.isUndefined(e[g])}))).metaTokens,l=t.visitor||i,C=t.dots,n=t.indexes,o=(t.Blob||"undefined"!==typeof Blob&&Blob)&&vi.isSpecCompliantForm(e);if(!vi.isFunction(l))throw new TypeError("visitor must be a function");function a(g){if(null===g)return"";if(vi.isDate(g))return g.toISOString();if(!o&&vi.isBlob(g))throw new Ni("Blob is not supported. Use a Buffer instead.");return vi.isArrayBuffer(g)||vi.isTypedArray(g)?o&&"function"===typeof Blob?new Blob([g]):Buffer.from(g):g}function i(g,t,l){let o=g;if(g&&!l&&"object"===typeof g)if(vi.endsWith(t,"{}"))t=I?t:t.slice(0,-2),g=JSON.stringify(g);else if(vi.isArray(g)&&function(g){return vi.isArray(g)&&!g.some(wi)}(g)||(vi.isFileList(g)||vi.endsWith(t,"[]"))&&(o=vi.toArray(g)))return t=Fi(t),o.forEach((function(g,I){!vi.isUndefined(g)&&null!==g&&e.append(!0===n?Ki([t],I,C):null===n?t:t+"[]",a(g))})),!1;return!!wi(g)||(e.append(Ki(l,t,C),a(g)),!1)}const s=[],c=Object.assign(zi,{defaultVisitor:i,convertValue:a,isVisitable:wi});if(!vi.isObject(g))throw new TypeError("data must be an object");return function g(t,I){if(!vi.isUndefined(t)){if(-1!==s.indexOf(t))throw Error("Circular reference detected in "+I.join("."));s.push(t),vi.forEach(t,(function(t,C){!0===(!(vi.isUndefined(t)||null===t)&&l.call(e,t,vi.isString(C)?C.trim():C,I,c))&&g(t,I?I.concat(C):[C])})),s.pop()}}(g),e};function Ei(g){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(g).replace(/[!'()~]|%20|%00/g,(function(g){return e[g]}))}function Qi(g,e){this._pairs=[],g&&Mi(g,this,e)}const Ui=Qi.prototype;Ui.append=function(g,e){this._pairs.push([g,e])},Ui.toString=function(g){const e=g?function(e){return g.call(this,e,Ei)}:Ei;return this._pairs.map((function(g){return e(g[0])+"="+e(g[1])}),"").join("&")};const Li=Qi;function ji(g){return encodeURIComponent(g).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Di(g,e,t){if(!e)return g;const I=t&&t.encode||ji,l=t&&t.serialize;let C;if(C=l?l(e,t):vi.isURLSearchParams(e)?e.toString():new Li(e,t).toString(I),C){const e=g.indexOf("#");-1!==e&&(g=g.slice(0,e)),g+=(-1===g.indexOf("?")?"?":"&")+C}return g}const Ti=class{constructor(){this.handlers=[]}use(g,e,t){return this.handlers.push({fulfilled:g,rejected:e,synchronous:!!t&&t.synchronous,runWhen:t?t.runWhen:null}),this.handlers.length-1}eject(g){this.handlers[g]&&(this.handlers[g]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(g){vi.forEach(this.handlers,(function(e){null!==e&&g(e)}))}},Pi={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Oi={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:Li,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},_i="undefined"!==typeof window&&"undefined"!==typeof document,qi=($i="undefined"!==typeof navigator&&navigator.product,_i&&["ReactNative","NativeScript","NS"].indexOf($i)<0);var $i;const gs="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,es={...g,...Oi};const ts=function(g){function e(g,t,I,l){let C=g[l++];if("__proto__"===C)return!0;const n=Number.isFinite(+C),o=l>=g.length;if(C=!C&&vi.isArray(I)?I.length:C,o)return vi.hasOwnProp(I,C)?I[C]=[I[C],t]:I[C]=t,!n;I[C]&&vi.isObject(I[C])||(I[C]=[]);return e(g,t,I[C],l)&&vi.isArray(I[C])&&(I[C]=function(g){const e={},t=Object.keys(g);let I;const l=t.length;let C;for(I=0;I<l;I++)C=t[I],e[C]=g[C];return e}(I[C])),!n}if(vi.isFormData(g)&&vi.isFunction(g.entries)){const t={};return vi.forEachEntry(g,((g,I)=>{e(function(g){return vi.matchAll(/\w+|\[(\w*)]/g,g).map((g=>"[]"===g[0]?"":g[1]||g[0]))}(g),I,t,0)})),t}return null};const Is={transitional:Pi,adapter:["xhr","http"],transformRequest:[function(g,e){const t=e.getContentType()||"",I=t.indexOf("application/json")>-1,l=vi.isObject(g);l&&vi.isHTMLForm(g)&&(g=new FormData(g));if(vi.isFormData(g))return I?JSON.stringify(ts(g)):g;if(vi.isArrayBuffer(g)||vi.isBuffer(g)||vi.isStream(g)||vi.isFile(g)||vi.isBlob(g))return g;if(vi.isArrayBufferView(g))return g.buffer;if(vi.isURLSearchParams(g))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),g.toString();let C;if(l){if(t.indexOf("application/x-www-form-urlencoded")>-1)return function(g,e){return Mi(g,new es.classes.URLSearchParams,Object.assign({visitor:function(g,e,t,I){return es.isNode&&vi.isBuffer(g)?(this.append(e,g.toString("base64")),!1):I.defaultVisitor.apply(this,arguments)}},e))}(g,this.formSerializer).toString();if((C=vi.isFileList(g))||t.indexOf("multipart/form-data")>-1){const e=this.env&&this.env.FormData;return Mi(C?{"files[]":g}:g,e&&new e,this.formSerializer)}}return l||I?(e.setContentType("application/json",!1),function(g,e,t){if(vi.isString(g))try{return(e||JSON.parse)(g),vi.trim(g)}catch(I){if("SyntaxError"!==I.name)throw I}return(t||JSON.stringify)(g)}(g)):g}],transformResponse:[function(g){const e=this.transitional||Is.transitional,t=e&&e.forcedJSONParsing,I="json"===this.responseType;if(g&&vi.isString(g)&&(t&&!this.responseType||I)){const t=!(e&&e.silentJSONParsing)&&I;try{return JSON.parse(g)}catch(l){if(t){if("SyntaxError"===l.name)throw Ni.from(l,Ni.ERR_BAD_RESPONSE,this,null,this.response);throw l}}}return g}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:es.classes.FormData,Blob:es.classes.Blob},validateStatus:function(g){return g>=200&&g<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};vi.forEach(["delete","get","head","post","put","patch"],(g=>{Is.headers[g]={}}));const ls=Is,Cs=vi.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ns=Symbol("internals");function os(g){return g&&String(g).trim().toLowerCase()}function as(g){return!1===g||null==g?g:vi.isArray(g)?g.map(as):String(g)}function is(g,e,t,I,l){return vi.isFunction(I)?I.call(this,e,t):(l&&(e=t),vi.isString(e)?vi.isString(I)?-1!==e.indexOf(I):vi.isRegExp(I)?I.test(e):void 0:void 0)}class ss{constructor(g){g&&this.set(g)}set(g,e,t){const I=this;function l(g,e,t){const l=os(e);if(!l)throw new Error("header name must be a non-empty string");const C=vi.findKey(I,l);(!C||void 0===I[C]||!0===t||void 0===t&&!1!==I[C])&&(I[C||e]=as(g))}const C=(g,e)=>vi.forEach(g,((g,t)=>l(g,t,e)));return vi.isPlainObject(g)||g instanceof this.constructor?C(g,e):vi.isString(g)&&(g=g.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(g.trim())?C((g=>{const e={};let t,I,l;return g&&g.split("\n").forEach((function(g){l=g.indexOf(":"),t=g.substring(0,l).trim().toLowerCase(),I=g.substring(l+1).trim(),!t||e[t]&&Cs[t]||("set-cookie"===t?e[t]?e[t].push(I):e[t]=[I]:e[t]=e[t]?e[t]+", "+I:I)})),e})(g),e):null!=g&&l(e,g,t),this}get(g,e){if(g=os(g)){const t=vi.findKey(this,g);if(t){const g=this[t];if(!e)return g;if(!0===e)return function(g){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let I;for(;I=t.exec(g);)e[I[1]]=I[2];return e}(g);if(vi.isFunction(e))return e.call(this,g,t);if(vi.isRegExp(e))return e.exec(g);throw new TypeError("parser must be boolean|regexp|function")}}}has(g,e){if(g=os(g)){const t=vi.findKey(this,g);return!(!t||void 0===this[t]||e&&!is(0,this[t],t,e))}return!1}delete(g,e){const t=this;let I=!1;function l(g){if(g=os(g)){const l=vi.findKey(t,g);!l||e&&!is(0,t[l],l,e)||(delete t[l],I=!0)}}return vi.isArray(g)?g.forEach(l):l(g),I}clear(g){const e=Object.keys(this);let t=e.length,I=!1;for(;t--;){const l=e[t];g&&!is(0,this[l],l,g,!0)||(delete this[l],I=!0)}return I}normalize(g){const e=this,t={};return vi.forEach(this,((I,l)=>{const C=vi.findKey(t,l);if(C)return e[C]=as(I),void delete e[l];const n=g?function(g){return g.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((g,e,t)=>e.toUpperCase()+t))}(l):String(l).trim();n!==l&&delete e[l],e[n]=as(I),t[n]=!0})),this}concat(){for(var g=arguments.length,e=new Array(g),t=0;t<g;t++)e[t]=arguments[t];return this.constructor.concat(this,...e)}toJSON(g){const e=Object.create(null);return vi.forEach(this,((t,I)=>{null!=t&&!1!==t&&(e[I]=g&&vi.isArray(t)?t.join(", "):t)})),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((g=>{let[e,t]=g;return e+": "+t})).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(g){return g instanceof this?g:new this(g)}static concat(g){const e=new this(g);for(var t=arguments.length,I=new Array(t>1?t-1:0),l=1;l<t;l++)I[l-1]=arguments[l];return I.forEach((g=>e.set(g))),e}static accessor(g){const e=(this[ns]=this[ns]={accessors:{}}).accessors,t=this.prototype;function I(g){const I=os(g);e[I]||(!function(g,e){const t=vi.toCamelCase(" "+e);["get","set","has"].forEach((I=>{Object.defineProperty(g,I+t,{value:function(g,t,l){return this[I].call(this,e,g,t,l)},configurable:!0})}))}(t,g),e[I]=!0)}return vi.isArray(g)?g.forEach(I):I(g),this}}ss.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),vi.reduceDescriptors(ss.prototype,((g,e)=>{let{value:t}=g,I=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(g){this[I]=g}}})),vi.freezeMethods(ss);const cs=ss;function ds(g,e){const t=this||ls,I=e||t,l=cs.from(I.headers);let C=I.data;return vi.forEach(g,(function(g){C=g.call(t,C,l.normalize(),e?e.status:void 0)})),l.normalize(),C}function As(g){return!(!g||!g.__CANCEL__)}function rs(g,e,t){Ni.call(this,null==g?"canceled":g,Ni.ERR_CANCELED,e,t),this.name="CanceledError"}vi.inherits(rs,Ni,{__CANCEL__:!0});const us=rs;const ms=es.hasStandardBrowserEnv?{write(g,e,t,I,l,C){const n=[g+"="+encodeURIComponent(e)];vi.isNumber(t)&&n.push("expires="+new Date(t).toGMTString()),vi.isString(I)&&n.push("path="+I),vi.isString(l)&&n.push("domain="+l),!0===C&&n.push("secure"),document.cookie=n.join("; ")},read(g){const e=document.cookie.match(new RegExp("(^|;\\s*)("+g+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(g){this.write(g,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function bs(g,e){return g&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)?function(g,e){return e?g.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):g}(g,e):e}const hs=es.hasStandardBrowserEnv?function(){const g=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let t;function I(t){let I=t;return g&&(e.setAttribute("href",I),I=e.href),e.setAttribute("href",I),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:"/"===e.pathname.charAt(0)?e.pathname:"/"+e.pathname}}return t=I(window.location.href),function(g){const e=vi.isString(g)?I(g):g;return e.protocol===t.protocol&&e.host===t.host}}():function(){return!0};const Zs=function(g,e){g=g||10;const t=new Array(g),I=new Array(g);let l,C=0,n=0;return e=void 0!==e?e:1e3,function(o){const a=Date.now(),i=I[n];l||(l=a),t[C]=o,I[C]=a;let s=n,c=0;for(;s!==C;)c+=t[s++],s%=g;if(C=(C+1)%g,C===n&&(n=(n+1)%g),a-l<e)return;const d=i&&a-i;return d?Math.round(1e3*c/d):void 0}};function Gs(g,e){let t=0;const I=Zs(50,250);return l=>{const C=l.loaded,n=l.lengthComputable?l.total:void 0,o=C-t,a=I(o);t=C;const i={loaded:C,total:n,progress:n?C/n:void 0,bytes:o,rate:a||void 0,estimated:a&&n&&C<=n?(n-C)/a:void 0,event:l};i[e?"download":"upload"]=!0,g(i)}}const ps="undefined"!==typeof XMLHttpRequest&&function(g){return new Promise((function(e,t){let I=g.data;const l=cs.from(g.headers).normalize();let C,n,{responseType:o,withXSRFToken:a}=g;function i(){g.cancelToken&&g.cancelToken.unsubscribe(C),g.signal&&g.signal.removeEventListener("abort",C)}if(vi.isFormData(I))if(es.hasStandardBrowserEnv||es.hasStandardBrowserWebWorkerEnv)l.setContentType(!1);else if(!1!==(n=l.getContentType())){const[g,...e]=n?n.split(";").map((g=>g.trim())).filter(Boolean):[];l.setContentType([g||"multipart/form-data",...e].join("; "))}let s=new XMLHttpRequest;if(g.auth){const e=g.auth.username||"",t=g.auth.password?unescape(encodeURIComponent(g.auth.password)):"";l.set("Authorization","Basic "+btoa(e+":"+t))}const c=bs(g.baseURL,g.url);function d(){if(!s)return;const I=cs.from("getAllResponseHeaders"in s&&s.getAllResponseHeaders());!function(g,e,t){const I=t.config.validateStatus;t.status&&I&&!I(t.status)?e(new Ni("Request failed with status code "+t.status,[Ni.ERR_BAD_REQUEST,Ni.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t)):g(t)}((function(g){e(g),i()}),(function(g){t(g),i()}),{data:o&&"text"!==o&&"json"!==o?s.response:s.responseText,status:s.status,statusText:s.statusText,headers:I,config:g,request:s}),s=null}if(s.open(g.method.toUpperCase(),Di(c,g.params,g.paramsSerializer),!0),s.timeout=g.timeout,"onloadend"in s?s.onloadend=d:s.onreadystatechange=function(){s&&4===s.readyState&&(0!==s.status||s.responseURL&&0===s.responseURL.indexOf("file:"))&&setTimeout(d)},s.onabort=function(){s&&(t(new Ni("Request aborted",Ni.ECONNABORTED,g,s)),s=null)},s.onerror=function(){t(new Ni("Network Error",Ni.ERR_NETWORK,g,s)),s=null},s.ontimeout=function(){let e=g.timeout?"timeout of "+g.timeout+"ms exceeded":"timeout exceeded";const I=g.transitional||Pi;g.timeoutErrorMessage&&(e=g.timeoutErrorMessage),t(new Ni(e,I.clarifyTimeoutError?Ni.ETIMEDOUT:Ni.ECONNABORTED,g,s)),s=null},es.hasStandardBrowserEnv&&(a&&vi.isFunction(a)&&(a=a(g)),a||!1!==a&&hs(c))){const e=g.xsrfHeaderName&&g.xsrfCookieName&&ms.read(g.xsrfCookieName);e&&l.set(g.xsrfHeaderName,e)}void 0===I&&l.setContentType(null),"setRequestHeader"in s&&vi.forEach(l.toJSON(),(function(g,e){s.setRequestHeader(e,g)})),vi.isUndefined(g.withCredentials)||(s.withCredentials=!!g.withCredentials),o&&"json"!==o&&(s.responseType=g.responseType),"function"===typeof g.onDownloadProgress&&s.addEventListener("progress",Gs(g.onDownloadProgress,!0)),"function"===typeof g.onUploadProgress&&s.upload&&s.upload.addEventListener("progress",Gs(g.onUploadProgress)),(g.cancelToken||g.signal)&&(C=e=>{s&&(t(!e||e.type?new us(null,g,s):e),s.abort(),s=null)},g.cancelToken&&g.cancelToken.subscribe(C),g.signal&&(g.signal.aborted?C():g.signal.addEventListener("abort",C)));const A=function(g){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(g);return e&&e[1]||""}(c);A&&-1===es.protocols.indexOf(A)?t(new Ni("Unsupported protocol "+A+":",Ni.ERR_BAD_REQUEST,g)):s.send(I||null)}))},ys={http:null,xhr:ps};vi.forEach(ys,((g,e)=>{if(g){try{Object.defineProperty(g,"name",{value:e})}catch(t){}Object.defineProperty(g,"adapterName",{value:e})}}));const Bs=g=>"- ".concat(g),Ss=g=>vi.isFunction(g)||null===g||!1===g,Ws=g=>{g=vi.isArray(g)?g:[g];const{length:e}=g;let t,I;const l={};for(let C=0;C<e;C++){let e;if(t=g[C],I=t,!Ss(t)&&(I=ys[(e=String(t)).toLowerCase()],void 0===I))throw new Ni("Unknown adapter '".concat(e,"'"));if(I)break;l[e||"#"+C]=I}if(!I){const g=Object.entries(l).map((g=>{let[e,t]=g;return"adapter ".concat(e," ")+(!1===t?"is not supported by the environment":"is not available in the build")}));let t=e?g.length>1?"since :\n"+g.map(Bs).join("\n"):" "+Bs(g[0]):"as no adapter specified";throw new Ni("There is no suitable adapter to dispatch the request "+t,"ERR_NOT_SUPPORT")}return I};function Vs(g){if(g.cancelToken&&g.cancelToken.throwIfRequested(),g.signal&&g.signal.aborted)throw new us(null,g)}function Rs(g){Vs(g),g.headers=cs.from(g.headers),g.data=ds.call(g,g.transformRequest),-1!==["post","put","patch"].indexOf(g.method)&&g.headers.setContentType("application/x-www-form-urlencoded",!1);return Ws(g.adapter||ls.adapter)(g).then((function(e){return Vs(g),e.data=ds.call(g,g.transformResponse,e),e.headers=cs.from(e.headers),e}),(function(e){return As(e)||(Vs(g),e&&e.response&&(e.response.data=ds.call(g,g.transformResponse,e.response),e.response.headers=cs.from(e.response.headers))),Promise.reject(e)}))}const Xs=g=>g instanceof cs?g.toJSON():g;function Js(g,e){e=e||{};const t={};function I(g,e,t){return vi.isPlainObject(g)&&vi.isPlainObject(e)?vi.merge.call({caseless:t},g,e):vi.isPlainObject(e)?vi.merge({},e):vi.isArray(e)?e.slice():e}function l(g,e,t){return vi.isUndefined(e)?vi.isUndefined(g)?void 0:I(void 0,g,t):I(g,e,t)}function C(g,e){if(!vi.isUndefined(e))return I(void 0,e)}function n(g,e){return vi.isUndefined(e)?vi.isUndefined(g)?void 0:I(void 0,g):I(void 0,e)}function o(t,l,C){return C in e?I(t,l):C in g?I(void 0,t):void 0}const a={url:C,method:C,data:C,baseURL:n,transformRequest:n,transformResponse:n,paramsSerializer:n,timeout:n,timeoutMessage:n,withCredentials:n,withXSRFToken:n,adapter:n,responseType:n,xsrfCookieName:n,xsrfHeaderName:n,onUploadProgress:n,onDownloadProgress:n,decompress:n,maxContentLength:n,maxBodyLength:n,beforeRedirect:n,transport:n,httpAgent:n,httpsAgent:n,cancelToken:n,socketPath:n,responseEncoding:n,validateStatus:o,headers:(g,e)=>l(Xs(g),Xs(e),!0)};return vi.forEach(Object.keys(Object.assign({},g,e)),(function(I){const C=a[I]||l,n=C(g[I],e[I],I);vi.isUndefined(n)&&C!==o||(t[I]=n)})),t}const ks="1.6.7",fs={};["object","boolean","number","function","string","symbol"].forEach(((g,e)=>{fs[g]=function(t){return typeof t===g||"a"+(e<1?"n ":" ")+g}}));const vs={};fs.transitional=function(g,e,t){function I(g,e){return"[Axios v1.6.7] Transitional option '"+g+"'"+e+(t?". "+t:"")}return(t,l,C)=>{if(!1===g)throw new Ni(I(l," has been removed"+(e?" in "+e:"")),Ni.ERR_DEPRECATED);return e&&!vs[l]&&(vs[l]=!0,console.warn(I(l," has been deprecated since v"+e+" and will be removed in the near future"))),!g||g(t,l,C)}};const Ys={assertOptions:function(g,e,t){if("object"!==typeof g)throw new Ni("options must be an object",Ni.ERR_BAD_OPTION_VALUE);const I=Object.keys(g);let l=I.length;for(;l-- >0;){const C=I[l],n=e[C];if(n){const e=g[C],t=void 0===e||n(e,C,g);if(!0!==t)throw new Ni("option "+C+" must be "+t,Ni.ERR_BAD_OPTION_VALUE)}else if(!0!==t)throw new Ni("Unknown option "+C,Ni.ERR_BAD_OPTION)}},validators:fs},xs=Ys.validators;class Hs{constructor(g){this.defaults=g,this.interceptors={request:new Ti,response:new Ti}}async request(g,e){try{return await this._request(g,e)}catch(t){if(t instanceof Error){let g;Error.captureStackTrace?Error.captureStackTrace(g={}):g=new Error;const e=g.stack?g.stack.replace(/^.+\n/,""):"";t.stack?e&&!String(t.stack).endsWith(e.replace(/^.+\n.+\n/,""))&&(t.stack+="\n"+e):t.stack=e}throw t}}_request(g,e){"string"===typeof g?(e=e||{}).url=g:e=g||{},e=Js(this.defaults,e);const{transitional:t,paramsSerializer:I,headers:l}=e;void 0!==t&&Ys.assertOptions(t,{silentJSONParsing:xs.transitional(xs.boolean),forcedJSONParsing:xs.transitional(xs.boolean),clarifyTimeoutError:xs.transitional(xs.boolean)},!1),null!=I&&(vi.isFunction(I)?e.paramsSerializer={serialize:I}:Ys.assertOptions(I,{encode:xs.function,serialize:xs.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase();let C=l&&vi.merge(l.common,l[e.method]);l&&vi.forEach(["delete","get","head","post","put","patch","common"],(g=>{delete l[g]})),e.headers=cs.concat(C,l);const n=[];let o=!0;this.interceptors.request.forEach((function(g){"function"===typeof g.runWhen&&!1===g.runWhen(e)||(o=o&&g.synchronous,n.unshift(g.fulfilled,g.rejected))}));const a=[];let i;this.interceptors.response.forEach((function(g){a.push(g.fulfilled,g.rejected)}));let s,c=0;if(!o){const g=[Rs.bind(this),void 0];for(g.unshift.apply(g,n),g.push.apply(g,a),s=g.length,i=Promise.resolve(e);c<s;)i=i.then(g[c++],g[c++]);return i}s=n.length;let d=e;for(c=0;c<s;){const g=n[c++],e=n[c++];try{d=g(d)}catch(A){e.call(this,A);break}}try{i=Rs.call(this,d)}catch(A){return Promise.reject(A)}for(c=0,s=a.length;c<s;)i=i.then(a[c++],a[c++]);return i}getUri(g){return Di(bs((g=Js(this.defaults,g)).baseURL,g.url),g.params,g.paramsSerializer)}}vi.forEach(["delete","get","head","options"],(function(g){Hs.prototype[g]=function(e,t){return this.request(Js(t||{},{method:g,url:e,data:(t||{}).data}))}})),vi.forEach(["post","put","patch"],(function(g){function e(e){return function(t,I,l){return this.request(Js(l||{},{method:g,headers:e?{"Content-Type":"multipart/form-data"}:{},url:t,data:I}))}}Hs.prototype[g]=e(),Hs.prototype[g+"Form"]=e(!0)}));const Ns=Hs;class ws{constructor(g){if("function"!==typeof g)throw new TypeError("executor must be a function.");let e;this.promise=new Promise((function(g){e=g}));const t=this;this.promise.then((g=>{if(!t._listeners)return;let e=t._listeners.length;for(;e-- >0;)t._listeners[e](g);t._listeners=null})),this.promise.then=g=>{let e;const I=new Promise((g=>{t.subscribe(g),e=g})).then(g);return I.cancel=function(){t.unsubscribe(e)},I},g((function(g,I,l){t.reason||(t.reason=new us(g,I,l),e(t.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(g){this.reason?g(this.reason):this._listeners?this._listeners.push(g):this._listeners=[g]}unsubscribe(g){if(!this._listeners)return;const e=this._listeners.indexOf(g);-1!==e&&this._listeners.splice(e,1)}static source(){let g;return{token:new ws((function(e){g=e})),cancel:g}}}const Fs=ws;const Ks={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ks).forEach((g=>{let[e,t]=g;Ks[t]=e}));const zs=Ks;const Ms=function g(e){const t=new Ns(e),I=qa(Ns.prototype.request,t);return vi.extend(I,Ns.prototype,t,{allOwnKeys:!0}),vi.extend(I,t,null,{allOwnKeys:!0}),I.create=function(t){return g(Js(e,t))},I}(ls);Ms.Axios=Ns,Ms.CanceledError=us,Ms.CancelToken=Fs,Ms.isCancel=As,Ms.VERSION=ks,Ms.toFormData=Mi,Ms.AxiosError=Ni,Ms.Cancel=Ms.CanceledError,Ms.all=function(g){return Promise.all(g)},Ms.spread=function(g){return function(e){return g.apply(null,e)}},Ms.isAxiosError=function(g){return vi.isObject(g)&&!0===g.isAxiosError},Ms.mergeConfig=Js,Ms.AxiosHeaders=cs,Ms.formToJSON=g=>ts(vi.isHTMLForm(g)?new FormData(g):g),Ms.getAdapter=Ws,Ms.HttpStatusCode=zs,Ms.default=Ms;const Es=Ms,Qs=()=>{const g=q(),[e,t]=Dg();(0,I.useEffect)((()=>{window.localStorage.getItem("userInfo")&&g("/")}),[]);const[l,C]=(0,I.useState)({email:"",password:""}),[n,o]=(0,I.useState)({email:"",password:""}),[a,i]=(0,I.useState)(!1),[s,c]=(0,I.useState)(!1),d=()=>{const{email:g,password:e}=l;let t={};return g&&/\S+@\S+\.\S+/.test(g)?!(!e||e.length<8)||(t.password="Please enter full password",o(t),!1):(t.email="Please enter a valid email address",o(t),!1)},A=g=>{const{name:e,value:t}=g.target;C({...l,[e]:t}),n[e]&&o({...n,[e]:""})};return(0,hg.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,hg.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,hg.jsx)("div",{children:(0,hg.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Login"})}),(0,hg.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:async e=>{if(e.preventDefault(),i(!0),d())try{const e={headers:{"Content-type":"application/json"}},{data:I}=await Es.post("/login",{email:l.email,password:l.password},e);"object"===typeof I?(window.localStorage.setItem("userInfo",JSON.stringify(I)),t(I.role),g("/")):I&&(c(!0),setTimeout((()=>{c(!1)}),3e3))}catch(I){console.error(I)}finally{C({email:"",password:""})}i(!1)},children:[(0,hg.jsxs)("div",{className:"rounded-md shadow-sm -space-y-px",children:[(0,hg.jsxs)("div",{children:[(0,hg.jsx)("label",{htmlFor:"email",className:"sr-only",children:"Email address"}),(0,hg.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:l.email,onChange:A,className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"Email address"}),n.email&&(0,hg.jsx)("p",{className:"text-red-500 text-sm mt-1",children:n.email})]}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("label",{htmlFor:"password",className:"sr-only",children:"Password"}),(0,hg.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:l.password,onChange:A,className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"Password"}),n.password&&(0,hg.jsx)("p",{className:"text-red-500 text-sm mt-1",children:n.password})]})]}),s&&(0,hg.jsx)("div",{className:"mt-2 p-2 bg-red-500 text-white text-center rounded-md",children:"Wrong credentials. Please try again."}),(0,hg.jsx)("div",{children:(0,hg.jsx)("button",{type:"submit",className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-500 hover:bg-indigo-700 ",children:a?"Loading...":"Login"})})]})]})})},Us=()=>{const g=q(),[e,t]=(0,I.useState)([]),[l,C]=(0,I.useState)(0),[n,o]=(0,I.useState)([]),[a,i]=(0,I.useState)([]),[s,c]=(0,I.useState)(""),[d,A]=(0,I.useState)([]);(0,I.useEffect)((()=>{(async()=>{try{const e=await fetch("/api/item",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(!e.ok)return console.error("Failed to fetch inventory data"),window.localStorage.clear(),void g("/login");const I=await e.json();t(I);const l=(g=>g.reduce(((g,e)=>{const t=e.brand,I=g.find((g=>g.brand===t));return I?(I.quantityBuy+=e.quantityBuy,I.quantitySold+=e.quantitySold,I.totalValue+=(e.quantityBuy-e.quantitySold)*e.mrp,I.totalValueBuy+=e.quantityBuy*e.mrp,I.totalValueSold+=e.quantitySold*e.mrp):g.push({brand:t,quantityBuy:e.quantityBuy,quantitySold:e.quantitySold,totalValue:(e.quantityBuy-e.quantitySold)*e.mrp,totalValueBuy:e.quantityBuy*e.mrp,totalValueSold:e.quantitySold*e.mrp}),g}),[]))(I),n=(g=>{const e=g.reduce(((g,e)=>{const t=e.product,I=g.find((g=>g.product===t));return I?(I.totalValue+=(e.quantityBuy-e.quantitySold)*e.mrp,I.totalPieces+=e.quantityBuy-e.quantitySold,I.quantityBuy+=e.quantityBuy,I.quantitySold+=e.quantitySold):g.push({product:t,totalValue:(e.quantityBuy-e.quantitySold)*e.mrp,totalPieces:e.quantityBuy-e.quantitySold,quantityBuy:e.quantityBuy,quantitySold:e.quantitySold}),g}),[]);return e})(I);o(l),i(n);const a=I.reduce(((g,e)=>g+(e.quantityBuy-e.quantitySold)*e.mrp),0);C(a)}catch(e){console.log(e)}})()}),[]);const r=g=>{const e=["rgba(255, 99, 132, 0.7)","rgba(54, 162, 235, 0.7)","rgba(255, 206, 86, 0.7)","rgba(75, 192, 192, 0.7)","rgba(192, 192, 192, 0.7)","rgba(153, 102, 255, 0.7)","rgba(255, 159, 64, 0.7)","rgba(255, 99, 255, 0.7)","rgba(54, 235, 162, 0.7)","rgba(206, 86, 255, 0.7)","rgba(192, 75, 192, 0.7)","rgba(99, 255, 132, 0.7)","rgba(235, 54, 162, 0.7)","rgba(86, 255, 206, 0.7)","rgba(255, 192, 75, 0.7)","rgba(99, 132, 255, 0.7)","rgba(162, 54, 235, 0.7)"];for(let t=4;t<g;t++){const g="rgba(".concat(Math.floor(256*Math.random()),", ").concat(Math.floor(256*Math.random()),", ").concat(Math.floor(256*Math.random()),", 0.7)");e.push(g)}return e.slice(0,g)},u=r(n.length),m={labels:n.map((g=>g.brand)),datasets:[{data:n.map((g=>g.totalValue)),backgroundColor:u,borderWidth:1,label:"Worth"},{data:n.map((g=>g.totalValueSold)),backgroundColor:u.map((g=>g.replace("0.7","0.3"))),borderWidth:1,label:"Total Value Sold"},{data:n.map((g=>g.totalValueBuy)),backgroundColor:u.map((g=>g.replace("0.3","1"))),borderWidth:1,label:"Total Buy"}]},b={labels:a.map((g=>g.product)),datasets:[{data:a.map((g=>g.quantityBuy)),backgroundColor:r(a.length),borderWidth:1,label:"Quantity Buy"},{data:a.map((g=>g.quantitySold)),backgroundColor:r(a.length).map((g=>g.replace("0.7","0.3"))),borderWidth:1,label:"Quantity Sold"}]},h={labels:d.map((g=>g.size)),datasets:[{data:d.map((g=>g.quantity)),backgroundColor:r(d.length),borderWidth:1,label:"Quantity Available"}]},Z=r(n.length),G={labels:n.map((g=>g.brand)),datasets:[{data:n.map((g=>g.quantityBuy)),backgroundColor:Z,borderWidth:1,label:"Quantity Buy"},{data:n.map((g=>g.quantitySold)),backgroundColor:Z.map((g=>g.replace("0.7","0.3"))),borderWidth:1,label:"Quantity Sold"}]};return(0,hg.jsxs)("div",{className:"p-4 bg-gray-100 rounded-md shadow-md",children:[(0,hg.jsx)("h2",{className:"text-3xl font-bold mb-4",children:"Inventory"}),(0,hg.jsxs)("div",{className:"mb-8",children:[(0,hg.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Total Inventory Value:"}),(0,hg.jsxs)("div",{className:"text-xl font-bold",children:["\u20b9",l?l.toLocaleString("hi"):"  Calculating......."]})]}),(0,hg.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Inventory by Brand"}),(0,hg.jsx)("div",{className:"flex items-center justify-center ",children:(0,hg.jsx)("div",{className:"w-screen h-screen",children:(0,hg.jsx)(Ua,{data:m,options:{maintainAspectRatio:!1}})})}),(0,hg.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Inventory by Product"}),(0,hg.jsx)("div",{className:"flex items-center justify-center",children:(0,hg.jsx)("div",{className:"w-screen h-screen",children:(0,hg.jsx)(Ua,{data:b,options:{maintainAspectRatio:!1}})})}),(0,hg.jsxs)("select",{value:s,onChange:g=>(g=>{c(g);const t=e.filter((e=>e.product===g)),I=t.reduce(((g,e)=>{const t=e.size,I=g.find((g=>g.size===t));return I?I.quantity+=e.quantityBuy-e.quantitySold:g.push({size:t,quantity:e.quantityBuy-e.quantitySold}),g}),[]);A(I)})(g.target.value),className:"mt-4 p-2 border rounded",children:[(0,hg.jsx)("option",{value:"",disabled:!0,children:"Select a Product"}),a.map((g=>(0,hg.jsx)("option",{value:g.product,children:g.product},g.product)))]}),s&&(0,hg.jsxs)("div",{children:[(0,hg.jsxs)("h3",{className:"text-lg font-semibold mb-2",children:["Sizes and Quantity for ",s]}),(0,hg.jsx)("div",{className:"flex items-center justify-center",children:(0,hg.jsx)("div",{className:"w-auto",children:(0,hg.jsx)(Ua,{data:h,height:100})})})]}),(0,hg.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Quantity Bought and Sold by Brand"}),(0,hg.jsx)("div",{className:"flex items-center justify-center",children:(0,hg.jsx)("div",{className:"w-screen h-screen",children:(0,hg.jsx)(Qa,{data:G,options:{maintainAspectRatio:!1}})})})]})},Ls=()=>{const g=q(),[e,t]=(0,I.useState)([]),[l,C]=(0,I.useState)(null),[n,o]=(0,I.useState)(!1),[a,i]=(0,I.useState)(!1),[s,c]=(0,I.useState)(!1),[d,A]=(0,I.useState)(1),[r,u]=(0,I.useState)(null),[m,b]=(0,I.useState)(""),[h,Z]=(0,I.useState)("Code"),[G,p]=(0,I.useState)(!1),[y,B]=(0,I.useState)([]),S=g=>{u((e=>e===g?null:g))};(0,I.useEffect)((()=>{V()}),[d]);const W=async(g,e)=>{c(!0);try{const t=await fetch("/api/item/".concat(G?"exact-search":"search","/").concat(g,"/").concat(e),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(t.ok){const g=await t.json();C(g),o(!1)}else 401===t.status?(window.localStorage.clear(),C(null),o(!0),c(!1)):(C(null),o(!0),c(!1))}catch(t){}finally{c(!1)}},V=async()=>{i(!0);try{const e=await fetch("/api/item/paginate?page=".concat(d,"&limit=10"),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(e.ok){const g=await e.json();t(1===d?g.items:e=>[...e,...g.items])}else console.error("Failed to fetch items"),window.localStorage.clear(),g("/login")}catch(e){console.error("Error fetching items:",e)}finally{i(!1)}};(0,I.useEffect)((()=>{W(h,m)}),[h,G]);const R=e=>{g("/edit-item/".concat(e))},X=g=>{B((e=>e.includes(g)?e.filter((e=>e!==g)):[...e,g]))};return(0,hg.jsxs)("div",{children:[(0,hg.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"Purchase History"}),(0,hg.jsxs)("form",{onSubmit:g=>{g.preventDefault(),""===m.trim()?(C(null),o(!1)):W(h,m),b("")},className:"mb-4 flex items-center",children:[(0,hg.jsxs)("select",{value:h,onChange:g=>{Z(g.target.value)},className:"border border-gray-300 rounded-l px-4 py-2 w-1/4",children:[(0,hg.jsx)("option",{value:"Code",children:"Code"}),(0,hg.jsx)("option",{value:"Brand",children:"Brand"}),(0,hg.jsx)("option",{value:"Product",children:"Product"}),(0,hg.jsx)("option",{value:"Category",children:"Category"}),(0,hg.jsx)("option",{value:"Size",children:"Size"}),(0,hg.jsx)("option",{value:"mrp>=",children:"MRP Gt"}),(0,hg.jsx)("option",{value:"mrp<=",children:"MRP Ls"})]}),(0,hg.jsx)("input",{type:"text",value:m,onChange:g=>{const e=g.target.value;/^[a-zA-Z0-9\s]*$/.test(e)&&(b(e.toUpperCase()),""===e?(C(null),o(!1)):W(h,e))},placeholder:"Search by code",className:"border border-gray-300 rounded-l px-4 py-2 w-2/4"}),(0,hg.jsx)("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-r w-1/4",children:s?"Serahcing":"Search"})]}),(0,hg.jsx)("div",{className:"flex justify-center",children:(0,hg.jsx)("button",{onClick:g=>{g.preventDefault(),p((g=>!g))},className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded ".concat(G?"bg-blue-500 hover:bg-blue-700 text-white":""),children:G?"Exact Match Search On":"Exact Match Search Off"})}),s&&(0,hg.jsx)("p",{className:"text-green-500 text-center font-semibold",children:" Searching"}),y.length>0&&(0,hg.jsx)("div",{className:"flex justify-center mt-4",children:(0,hg.jsx)("button",{onClick:()=>{g("/edit-selected-items",{state:{selectedItems:y}})},className:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded",children:"Edit Selected Items"})}),l?(0,hg.jsxs)("div",{children:[(0,hg.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Searched Item"}),(0,hg.jsxs)("p",{children:["Number of result = ",l.length]}),l.map((g=>(0,hg.jsxs)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative ".concat(g.quantityBuy-g.quantitySold<=0?"bg-red-100 border border-red-400 text-red-700":""),children:[(0,hg.jsxs)("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>S(g._id),children:[(0,hg.jsxs)("div",{children:[(0,hg.jsxs)("p",{className:"font-semibold text-lg",children:["Code: ",g.code]}),(0,hg.jsxs)("p",{className:"text-black",children:["Brand: ",g.brand]})]}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("input",{type:"checkbox",checked:y.includes(g),onChange:()=>X(g),className:"mr-2"}),(0,hg.jsx)("svg",{className:"h-6 w-6 ".concat(r===g._id?"transform rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,hg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),r===g._id&&(0,hg.jsx)("div",{className:"flex items-center justify-evenly border-t border-gray-500 mt-4 pt-4 ".concat(g.quantityBuy-g.quantitySold<=0?"bg-red-100  text-red-700":""),children:(0,hg.jsxs)("div",{className:"text-black",children:[(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Product: ",g.product]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Category: ",g.category]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Size: ",g.size]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Quantity Available: ",g.quantityBuy-g.quantitySold]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Quantity Sold: ",g.quantitySold]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["MRP: ",g.mrp]}),(0,hg.jsx)("div",{className:"flex justify-center",children:(0,hg.jsx)("button",{onClick:()=>R(g.code),className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-1 mr-2",children:"Edit"})})]})})]},g._id)))]}):n&&(0,hg.jsx)("div",{className:"mt-2 p-2 bg-red-500 text-white text-center rounded-md",children:"No product found with this code."}),(0,hg.jsx)("hr",{className:"my-8 border-t border-gray-300"}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"All Items"}),e.map((g=>(0,hg.jsxs)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative",children:[(0,hg.jsxs)("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>S(g._id),children:[(0,hg.jsxs)("div",{children:[(0,hg.jsxs)("p",{className:"font-semibold text-lg",children:["Code: ",g.code]}),(0,hg.jsxs)("p",{className:"text-black",children:["Brand: ",g.brand]})]}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("input",{type:"checkbox",checked:y.includes(g),onChange:()=>X(g),className:"mr-2"}),(0,hg.jsx)("svg",{className:"h-6 w-6 ".concat(r===g._id?"transform rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,hg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),r===g._id&&(0,hg.jsx)("div",{className:"flex items-center justify-evenly border-t border-gray-300 mt-4 pt-4",children:(0,hg.jsxs)("div",{className:"text-black",children:[(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Product: ",g.product]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Category: ",g.category]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Size: ",g.size]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Quantity Available: ",g.quantityBuy-g.quantitySold]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Quantity Sold: ",g.quantitySold]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["MRP: ",g.mrp]}),(0,hg.jsx)("div",{className:"flex justify-center",children:(0,hg.jsx)("button",{onClick:()=>R(g.code),className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-1 mr-2",children:"Edit"})})]})})]},g._id))),(0,hg.jsx)("div",{className:"flex justify-center",children:(0,hg.jsx)("button",{onClick:()=>{A((g=>g+1))},className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-1",children:a?"loading....":"Load More"})})]})]})},js=()=>{const g=q(),{code:e}=$(),[t,l]=(0,I.useState)({brand:"",product:"",category:"",size:"",mrp:"",quantityBuy:""}),[C,n]=(0,I.useState)({...t}),[o,a]=(0,I.useState)({products:[],categories:[],sizes:[{size:[]}]}),[i,s]=(0,I.useState)(!1),[c,d]=(0,I.useState)(!1),[A,r]=(0,I.useState)(!1),[u,m]=(0,I.useState)(!1),[b,h]=(0,I.useState)(!1),[Z,G]=(0,I.useState)(!1),[p,y]=(0,I.useState)(!1),[B,S]=(0,I.useState)(""),[W,V]=(0,I.useState)(!1);(0,I.useEffect)((()=>{window.localStorage.getItem("userInfo")||g("/login")}),[g]);(0,I.useEffect)((()=>{(()=>{var g=Object.keys(t).some((g=>t[g]!=C[g]))&&""!==C.mrp&&""!==C.quantityBuy;s(g)})()}),[C]),(0,I.useEffect)((()=>{(async()=>{try{if(r(!0),!window.localStorage.getItem("userInfo"))throw new Error("User not logged in");const[g,t]=await Promise.all([fetch("/api/item/code/".concat(e),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}}),fetch("/api/dropdownoption/dropdownoptions",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}})]);if(!g.ok)throw new Error("Failed to fetch item details");const I=await g.json();if(l(I),n(I),!t.ok)throw new Error("Failed to fetch dropdown options");const C=await t.json(),o=C.products.filter((g=>g.brand===I.brand));o.forEach((g=>{g.products.sort()})),C.categories[0].category.sort(((g,e)=>g.localeCompare(e))),a({...C,products:o})}catch(t){console.error("Error fetching dropdown options and item details:",t),window.localStorage.clear(),g("/login")}finally{r(!1)}})()}),[]);const R=g=>{const{name:e,value:t}=g.target;"mrp"===e&&parseFloat(t)<0||"quantityBuy"===e&&parseFloat(t)<0||n((g=>({...g,[e]:t})))};return(0,hg.jsxs)("div",{className:"bg-white p-6 shadow-md rounded-md",children:[W&&(0,hg.jsx)(hg.Fragment,{children:(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999},children:(0,hg.jsx)(La,{})})}),(0,hg.jsx)("h2",{className:"text-2xl font-semibold mb-6",children:"Edit Page"}),Z&&(0,hg.jsx)(hg.Fragment,{children:(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999},children:(0,hg.jsxs)("div",{className:"bg-white border  px-4 py-3 rounded relative w-full m-5",role:"alert",children:[(0,hg.jsx)("strong",{className:"font-bold text-center",children:"Are you sure ?"}),(0,hg.jsx)("div",{children:(0,hg.jsx)("button",{className:"w-full mt-6 py-2 px-4 rounded focus:outline-none ".concat(i?"bg-indigo-500 text-white":"bg-gray-500 text-gray-500 opacity-50 cursor-not-allowed"),onClick:async()=>{d(!0);try{V(!0);const I=Object.entries(C).reduce(((g,e)=>{let[I,l]=e;return t[I]!==l&&(g[I]=l),g}),{});(await fetch("/api/item/".concat(e),{method:"PATCH",headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token),"Content-Type":"application/json"},body:JSON.stringify(I)})).ok?g("/history"):(console.error("Failed to update purchase"),m(!0),setTimeout((()=>{m(!1)}),3e3))}catch(I){console.error("Error:",I)}finally{d(!1),V(!1)}},children:"Confirm"})}),(0,hg.jsx)("span",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",children:(0,hg.jsxs)("svg",{className:"fill-current h-6 w-6  cursor-pointer",role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",onClick:()=>G(!1),children:[(0,hg.jsx)("title",{children:"Close"}),(0,hg.jsx)("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})]})})]})})}),A?(0,hg.jsx)("h1",{className:"text-green-500 text-center text-2xl font-semibold mb-6",children:"Loading...."}):(0,hg.jsxs)(hg.Fragment,{children:[(0,hg.jsx)("select",{name:"brand",value:C.brand,disabled:!0,className:"w-full p-2 border rounded-md",children:(0,hg.jsx)("option",{value:C.brand,children:C.brand})}),(0,hg.jsxs)("select",{name:"product",value:C.product,onChange:R,className:"w-full mt-4 p-2 border rounded-md",children:[(0,hg.jsx)("option",{value:"",disabled:!0,children:"Select Product"}),o.products.map((g=>g.products.map((g=>(0,hg.jsx)("option",{value:g,children:g},g)))))]}),(0,hg.jsxs)("select",{name:"category",value:C.category,onChange:R,className:"w-full mt-4 p-2 border rounded-md",children:[(0,hg.jsx)("option",{value:"",disabled:!0,children:"Select Category"}),o.categories.map((g=>g.category.map((g=>(0,hg.jsx)("option",{value:g,children:g},g)))))]}),(0,hg.jsxs)("select",{name:"size",value:C.size,onChange:R,className:"w-full mt-4 p-2 border rounded-md",children:[(0,hg.jsx)("option",{value:"",disabled:!0,children:"Select Size"}),o.sizes.map((g=>g.size.map((g=>(0,hg.jsx)("option",{value:g,children:g},g)))))]}),(0,hg.jsx)("input",{type:"number",placeholder:"MRP",name:"mrp",value:C.mrp,onChange:R,className:"w-full mt-4 p-2 border rounded-md"}),(0,hg.jsx)("input",{type:"number",placeholder:"Quantity Buy",name:"quantityBuy",value:C.quantityBuy,onChange:R,className:"w-full mt-4 p-2 border rounded-md"})]}),u&&(0,hg.jsx)("div",{className:"text-red-500 text-center text-sm mt-2",children:"Error while updating try again"}),(0,hg.jsx)("button",{onClick:()=>{G(!0)},disabled:!i||c,className:"w-full mt-6 py-2 px-4 rounded focus:outline-none ".concat(i?"bg-indigo-500 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:c?"Updating...":"Update"}),b&&(0,hg.jsx)("div",{className:"text-red-500 text-center text-sm mt-2",children:"Error while Deleting try again.."}),(0,hg.jsx)("button",{onClick:()=>{y(!0)},className:"w-full mt-6 py-2 px-4 rounded focus:outline-none bg-red-500 text-white",children:"Delete This Product"}),p&&(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:(0,hg.jsxs)("div",{className:"bg-white p-6 rounded-md",children:[(0,hg.jsx)("p",{className:"mb-4",children:"Type 'CONFIRM' to delete this item:"}),(0,hg.jsx)("div",{className:"flex justify-center",children:(0,hg.jsx)("input",{type:"text",value:B,onChange:g=>{S(g.target.value.toUpperCase())},className:"border border-gray-300 p-2 rounded-md mb-4 text-center"})}),(0,hg.jsxs)("div",{className:"flex justify-between",children:[(0,hg.jsx)("button",{onClick:()=>{S(""),y(!1)},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md mr-2",children:"Cancel"}),(0,hg.jsx)("button",{disabled:"CONFIRM"!==B,onClick:async()=>{if("CONFIRM"===B)try{V(!0);(await fetch("/api/item/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}})).ok?g("/history"):(console.error("Failed to delete item"),y(!1),h(!0),setTimeout((()=>{h(!1)}),3e3))}catch(t){console.error("Error:",t)}finally{V(!1)}},className:"px-4 py-2 rounded-md ".concat("CONFIRM"!==B?"bg-gray-300 text-gray-700 cursor-not-allowed":"bg-red-500 text-white"),children:"Confirm"})]})]})})]})},Ds=()=>{const[g,e]=(0,I.useState)([]),[t,l]=(0,I.useState)(null),[C,n]=(0,I.useState)(!1),[o,a]=(0,I.useState)(!1),[i,s]=(0,I.useState)(!1),[c,d]=(0,I.useState)(1),[A,r]=(0,I.useState)(null),[u,m]=(0,I.useState)(""),[b,h]=(0,I.useState)("Code"),[Z,G]=(0,I.useState)(!1),[p,y]=(0,I.useState)(!1),[B,S]=(0,I.useState)(""),[W,V]=(0,I.useState)(!1),[R,X]=(0,I.useState)(""),[J,k]=(0,I.useState)(!1),[f,v]=(0,I.useState)({}),[Y,x]=(0,I.useState)(!1),[H,N]=(0,I.useState)(!1),w=g=>{r((e=>e===g?null:g))};(0,I.useEffect)((()=>{K()}),[c]);const F=async(g,e)=>{if(""!==e){s(!0);try{const t=await fetch("/api/saleslog/".concat(Z?"exact-search":"search","/").concat(g,"/").concat(e),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(t.ok){const g=await t.json();l(g),n(!1)}else 401===t.status?(window.localStorage.clear(),l(null),n(!0),s(!1)):(l(null),n(!0),s(!1))}catch(t){}finally{s(!1)}}else n(!1)},K=async()=>{a(!0);try{const g=await fetch("/api/saleslog/paginate?page=".concat(c,"&limit=10"),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(g.ok){const t=await g.json();e(1===c?t.sales:g=>[...g,...t.sales])}else console.error("Failed to fetch sales")}catch(g){console.error("Error fetching sales:",g)}finally{a(!1)}};(0,I.useEffect)((()=>{F(b,u)}),[b,Z,J]);const z=g=>{y(!0),X(g)};return(0,I.useEffect)((()=>{v((()=>{const e={};return g.forEach((g=>{const t=new Date(g.soldAt).toLocaleDateString();e[t]||(e[t]=[]),e[t].push(g)})),e})())}),[g]),(0,hg.jsxs)("div",{children:[H&&(0,hg.jsx)(hg.Fragment,{children:(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999},children:(0,hg.jsx)(La,{})})}),(0,hg.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"Sale History"}),(0,hg.jsxs)("form",{onSubmit:g=>{g.preventDefault(),""===u.trim()?(l(null),n(!1)):F(b,u),m("")},className:"mb-4 flex items-center",children:[(0,hg.jsxs)("select",{value:b,onChange:g=>{h(g.target.value)},className:"border border-gray-300 rounded-l px-4 py-2 w-1/4",children:[(0,hg.jsx)("option",{value:"Sale Code",children:"Code"}),(0,hg.jsx)("option",{value:"Customer Name",children:"Brand"}),(0,hg.jsx)("option",{value:"Product",children:"Product"}),(0,hg.jsx)("option",{value:"Category",children:"Category"}),(0,hg.jsx)("option",{value:"Sale Date",children:"Size"})]}),(0,hg.jsx)("input",{type:"text",value:u,onChange:g=>{const e=g.target.value;/^[a-zA-Z0-9\s]*$/.test(e)&&(m(e.toUpperCase()),""===e?(l(null),n(!1)):F(b,e))},placeholder:"Search by code",className:"border border-gray-300 rounded-l px-4 py-2 w-2/4"}),(0,hg.jsx)("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-r w-1/4",children:i?"Searching":"Search"})]}),(0,hg.jsx)("div",{className:"flex justify-center",children:(0,hg.jsx)("button",{onClick:g=>{g.preventDefault(),G((g=>!g))},className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded ".concat(Z?"bg-blue-500 hover:bg-blue-700 text-white":""),children:Z?"Exact Match Search On":"Exact Match Search Off"})}),i&&(0,hg.jsx)("p",{className:"text-green-500 text-center font-semibold",children:"Searching"}),t?(0,hg.jsxs)("div",{children:[(0,hg.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Searched Sales"}),(0,hg.jsxs)("p",{children:["Number of results: ",t.length]}),t.map((g=>(0,hg.jsxs)("div",{className:"bg-gray-200 border border-black text-black px-4 py-3 rounded relative",children:[(0,hg.jsxs)("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>w(g._id),children:[(0,hg.jsxs)("div",{children:[(0,hg.jsxs)("p",{className:"font-semibold text-lg",children:["Code: ",g.code]}),(0,hg.jsxs)("p",{className:"text-black",children:["Brand: ",g.brand]})]}),(0,hg.jsxs)("div",{children:[new Date(g.soldAt).toLocaleString(),(0,hg.jsx)("svg",{className:"h-6 w-6 ".concat(A===g._id?"transform rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,hg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),A===g._id&&(0,hg.jsx)("div",{className:"flex items-center justify-evenly border-t border-gray-300 mt-4 pt-4",children:(0,hg.jsxs)("div",{className:"text-black",children:[(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Product: ",g.product]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Category: ",g.category]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Selling Price: ",g.sellingPrice]}),g.sellingPrice-g.mrp>=0?(0,hg.jsxs)("p",{className:"font-semibold py-1 text-green-500",children:["Profit : ",g.sellingPrice-g.mrp]}):(0,hg.jsxs)("p",{className:"font-semibold py-1 text-red-500",children:["Loss : ",g.sellingPrice-g.mrp]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Sold by: ",g.soldBy]}),W&&(0,hg.jsx)("div",{className:"text-red-500 text-center text-sm mt-2",children:"Error while Deleting try again.."}),(0,hg.jsx)("button",{onClick:()=>{z(g._id)},className:"w-full mt-6 py-2 px-4 rounded focus:outline-none bg-red-500 text-white",children:"Return"})]})})]},g._id)))]}):C&&(0,hg.jsx)("div",{className:"mt-2 p-2 bg-red-500 text-white text-center rounded-md",children:"No sale found with this criteria."}),(0,hg.jsx)("hr",{className:"my-8 border-t border-gray-300"}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"All Sales"}),Object.keys(f).sort(((g,e)=>new Date(e)-new Date(g))).map((g=>{const e=f[g],t=e.reduce(((g,e)=>g+e.sellingPrice),0),l=e.reduce(((g,e)=>g+(e.sellingPrice-e.mrp)),0);return(0,hg.jsxs)(I.Fragment,{children:[(0,hg.jsxs)("div",{className:"bg-green-200 border border-black text-black px-4 py-3 rounded relative flex justify-between items-center cursor-pointer font-semibold",children:[(0,hg.jsx)("p",{children:new Date(e[0].soldAt).toLocaleDateString()}),(0,hg.jsxs)("p",{children:["Sale - ",t]}),l>=0?(0,hg.jsxs)("p",{className:"font-semibold py-1 text-black",children:["Profit : ",l]}):(0,hg.jsxs)("p",{className:"font-semibold py-1 text-red-500",children:["Loss : ",l]})]}),e.map((g=>(0,hg.jsxs)("div",{className:"bg-gray-200 border border-black text-black px-4 py-3 rounded relative",children:[(0,hg.jsxs)("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>w(g._id),children:[(0,hg.jsxs)("div",{children:[(0,hg.jsxs)("p",{className:"font-semibold text-lg",children:["Code: ",g.code]}),(0,hg.jsxs)("p",{className:"text-black",children:["Brand : ",g.brand]})]}),(0,hg.jsxs)("div",{className:"flex",children:[new Date(g.soldAt).toLocaleString(),(0,hg.jsx)("svg",{className:"h-6 w-6 ml-2 ".concat(A===g._id?"transform rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,hg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),A===g._id&&(0,hg.jsx)("div",{className:"flex items-center justify-evenly border-t border-gray-300 mt-4 pt-4",children:(0,hg.jsxs)("div",{className:"text-black",children:[(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Product: ",g.product]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Category: ",g.category]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Selling Price: ",g.sellingPrice]}),g.sellingPrice-g.mrp>=0?(0,hg.jsxs)("p",{className:"font-semibold py-1 text-green-500",children:["Profit : ",g.sellingPrice-g.mrp]}):(0,hg.jsxs)("p",{className:"font-semibold py-1 text-red-500",children:["Loss : ",g.sellingPrice-g.mrp]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Sold by: ",g.soldBy]}),W&&(0,hg.jsx)("div",{className:"text-red-500 text-center text-sm mt-2",children:"Error while Deleting try again.."}),(0,hg.jsx)("button",{onClick:()=>{z(g._id)},className:"w-full mt-6 py-2 px-4 rounded focus:outline-none bg-red-500 text-white",children:"Return"})]})})]},g._id)))]},g)})),(0,hg.jsx)("div",{className:"flex justify-center",children:(0,hg.jsx)("button",{onClick:()=>{d((g=>g+1))},className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-1",children:o?"Loading...":"Load More"})})]}),p&&(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:(0,hg.jsxs)("div",{className:"bg-white p-6 rounded-md",children:[(0,hg.jsx)("p",{className:"mb-4",children:"Type 'CONFIRM' to delete this item:"}),(0,hg.jsx)("div",{className:"flex justify-center",children:(0,hg.jsx)("input",{type:"text",value:B,onChange:g=>{S(g.target.value.toUpperCase())},className:"border border-gray-300 p-2 rounded-md text-center"})}),(0,hg.jsx)("div",{className:"mb-2",children:W&&(0,hg.jsx)("div",{className:"text-red-500 text-center text-sm mt-2",children:"Error while Deleting try again.."})}),(0,hg.jsxs)("div",{className:"flex justify-between",children:[(0,hg.jsx)("button",{onClick:()=>{S(""),y(!1)},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md mr-2",children:"Cancel"}),(0,hg.jsx)("button",{disabled:"CONFIRM"!==B,onClick:async()=>{if("CONFIRM"===B)try{N(!0);(await fetch("/api/saleslog/".concat(R),{method:"DELETE",headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}})).ok?(await K(),k(!J),X(""),x(!0),setTimeout((()=>{x(!1)}),3e3),y(!1),S("")):(console.error("Failed to delete "),S(""),V(!0),setTimeout((()=>{V(!1)}),3e3))}catch(g){console.error("Error:",g)}finally{N(!1)}},className:"px-4 py-2 rounded-md ".concat("CONFIRM"!==B?"bg-gray-300 text-gray-700 cursor-not-allowed":"bg-red-500 text-white"),children:"Confirm"})]})]})}),Y&&(0,hg.jsx)(hg.Fragment,{children:(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999},children:(0,hg.jsxs)("div",{className:"flex items-center justify-center bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative w-full m-5",role:"alert",children:[(0,hg.jsx)("strong",{className:"font-bold",children:"Product Returned"}),(0,hg.jsx)("span",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",children:(0,hg.jsxs)("svg",{className:"fill-current h-6 w-6 text-green-500 cursor-pointer",role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",onClick:()=>x(!1),children:[(0,hg.jsx)("title",{children:"Close"}),(0,hg.jsx)("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})]})})]})})})]})},Ts=()=>{const g=I.useRef(),[e,t]=(0,I.useState)([]),[l,C]=(0,I.useState)(!1),[n,o]=(0,I.useState)(1),[a,i]=(0,I.useState)([]),[s,c]=(0,I.useState)(null),[d,A]=(0,I.useState)(!1),[r,u]=(0,I.useState)("single"),[m,b]=(0,I.useState)([]),[h,Z]=(0,I.useState)("Code"),[G,p]=(0,I.useState)(!1),[y,B]=(0,I.useState)(null),[S,W]=(0,I.useState)(!1),[V,R]=(0,I.useState)(!1),[X,J]=(0,I.useState)(""),[k,f]=(0,I.useState)(2);function v(g){var e=g*k+10;return(e=100*Math.round(e/100))-4}(0,I.useEffect)((()=>{if(e.length>1){let g=[],t=0,I=-1,l=[...e];for(;I>=l.length-1?(t++,I=0):I++,t<l[I].quantityBuy?g.push(l[I]):(l.splice(I,1),I--),0!==l.length;);b(g)}}),[e]);const Y=async(g,e)=>{R(!0);try{const t=await fetch("/api/item/".concat(G?"exact-search":"search","/").concat(g,"/").concat(e),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(t.ok){const g=await t.json();B(g),W(!1)}else 401===t.status?(window.localStorage.clear(),B(null),W(!0),R(!1)):(B(null),W(!0),R(!1))}catch(t){}finally{R(!1)}};(0,I.useEffect)((()=>{(async()=>{C(!0);try{const g=await fetch("/api/item/paginate?page=".concat(n,"&limit=10"),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(g.ok){const e=await g.json();i(1===n?e.items:g=>[...g,...e.items])}else console.error("Failed to fetch items")}catch(g){console.error("Error fetching items:",g)}finally{C(!1)}})()}),[n]);const x=g=>{t((e=>-1!==e.findIndex((e=>e._id===g._id))?e.filter((e=>e._id!==g._id)):[...e,g]))},H=g=>{c((e=>e===g?null:g))},N=(0,Ug.useReactToPrint)({content:()=>g.current});(0,I.useEffect)((()=>{Y(h,X)}),[h,G]);return(0,hg.jsxs)("div",{children:[(0,hg.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"Print Tags"}),(0,hg.jsxs)("form",{onSubmit:g=>{g.preventDefault(),""===X.trim()?(B(null),W(!1)):Y(h,X),J("")},className:"mb-4 flex items-center",children:[(0,hg.jsxs)("select",{value:h,onChange:g=>{Z(g.target.value)},className:"border border-gray-300 rounded-l px-4 py-2 w-1/4",children:[(0,hg.jsx)("option",{value:"Code",children:"Code"}),(0,hg.jsx)("option",{value:"Brand",children:"Brand"}),(0,hg.jsx)("option",{value:"Product",children:"Product"}),(0,hg.jsx)("option",{value:"Category",children:"Category"}),(0,hg.jsx)("option",{value:"Size",children:"Size"}),(0,hg.jsx)("option",{value:"mrp>=",children:"MRP Gt"}),(0,hg.jsx)("option",{value:"mrp<=",children:"MRP Ls"})]}),(0,hg.jsx)("input",{type:"text",value:X,onChange:g=>{const e=g.target.value;/^[a-zA-Z0-9\s]*$/.test(e)&&(J(e.toUpperCase()),""===e?(B(null),W(!1)):Y(h,e))},placeholder:"Search by code",className:"border border-gray-300 rounded-l px-4 py-2 w-2/4"}),(0,hg.jsx)("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-r w-1/4",children:V?"Serahcing":"Search"})]}),(0,hg.jsxs)("div",{className:"flex justify-center",children:[(0,hg.jsx)("button",{onClick:g=>{g.preventDefault(),p((g=>!g))},className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded ".concat(G?"bg-blue-500 hover:bg-blue-700 text-white":""),children:G?"Exact Match Search On":"Exact Match Search Off"}),(0,hg.jsx)("input",{type:"number",step:"0.1",placeholder:"Enter Margin (e.g. 1.8)",value:k,onChange:g=>f(parseFloat(g.target.value)||1),onWheel:g=>g.target.blur(),className:"w-full mt-4 p-2 border rounded-md"})]}),V&&(0,hg.jsx)("p",{className:"text-green-500 text-center font-semibold",children:" Searching"}),y?(0,hg.jsxs)("div",{children:[(0,hg.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Searched Item"}),(0,hg.jsxs)("p",{children:["Number of result = ",y.length]}),y.map((g=>(0,hg.jsxs)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative ".concat(g.quantityBuy-g.quantitySold<=0?"bg-red-100 border border-red-400 text-red-700":""),children:[(0,hg.jsxs)("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>H(g._id),children:[(0,hg.jsxs)("div",{children:[(0,hg.jsxs)("p",{className:"font-semibold text-lg",children:["Code: ",g.code]}),(0,hg.jsxs)("p",{className:"text-black",children:["Brand: ",g.brand]})]}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("input",{type:"checkbox",checked:e.includes(g),onChange:()=>x(g),className:"mr-2"}),(0,hg.jsx)("svg",{className:"h-6 w-6 ".concat(s===g._id?"transform rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,hg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),s===g._id&&(0,hg.jsx)("div",{className:"flex items-center justify-evenly border-t border-gray-500 mt-4 pt-4 ".concat(g.quantityBuy-g.quantitySold<=0?"bg-red-100  text-red-700":""),children:(0,hg.jsxs)("div",{className:"text-black",children:[(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Product: ",g.product]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Category: ",g.category]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Size: ",g.size]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Quantity Available: ",g.quantityBuy-g.quantitySold]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Quantity Sold: ",g.quantitySold]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["MRP: ",g.mrp]})]})})]},g._id)))]}):S&&(0,hg.jsx)("div",{className:"mt-2 p-2 bg-red-500 text-white text-center rounded-md",children:"No product found with this code."}),(0,hg.jsx)("hr",{className:"my-8 border-t border-gray-300"}),(0,hg.jsx)("div",{className:"flex justify-center",children:(0,hg.jsx)("button",{onClick:()=>{A(!0)},disabled:0===e.length,className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-1 mr-2 ".concat(0===e.length?"opacity-50 cursor-not-allowed":""),children:"Print Selected"})}),d&&(0,hg.jsx)(hg.Fragment,{children:(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999},children:(0,hg.jsx)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative w-full m-5",role:"alert",contentEditable:!0,children:(0,hg.jsxs)("div",{className:"max-h-[80vh] overflow-y-auto hide-scrollbar",children:[(0,hg.jsx)("strong",{className:"font-bold",children:"Items added to inventory:"}),(0,hg.jsxs)("div",{className:"flex justify-center m-4",children:[(0,hg.jsx)("button",{onClick:()=>u("single"),className:"px-4 py-2 mx-2 ".concat("single"===r?"bg-indigo-700":"bg-indigo-300"," text-white rounded-md focus:outline-none"),children:"Print Single Tags"}),(0,hg.jsx)("button",{onClick:()=>u("multiple"),className:"px-4 py-2 mx-2 ".concat("multiple"===r?"bg-indigo-700":"bg-indigo-300"," text-white rounded-md focus:outline-none"),children:"Print Multiple Tags"})]}),(0,hg.jsx)("div",{className:"flex justify-center",children:(0,hg.jsxs)("div",{style:{width:"106mm"},ref:g,className:"flex flex-wrap",children:[e.length%2!==0&&e.push(e[e.length-1]),("single"===r?e:m).map(((g,e)=>(0,hg.jsx)("div",{className:"flex items-center justify-evenly",children:(0,hg.jsxs)("div",{style:{width:"50mm",height:"25mm",padding:0,marginLeft:"1.3mm",marginRight:"1.3mm"},className:"flex justify-evenly bg-white",children:[(0,hg.jsxs)("div",{className:"p-2 pr-0",children:[(0,hg.jsx)(Qg,{value:g.code,size:60}),(0,hg.jsx)("p",{className:"text-black",children:g.code})]}),(0,hg.jsxs)("div",{className:"relative font-bold text-black pt-1",children:[(0,hg.jsx)("div",{className:"flex justify-center",children:(0,hg.jsx)("img",{src:"Images/Ganesha.jpg",alt:"project",width:"25mm"})}),(0,hg.jsxs)("div",{children:[(0,hg.jsxs)("p",{children:["MRP: ",v(g.mrp),"/-"]}),(0,hg.jsxs)("p",{children:["Size: ",g.size]}),(0,hg.jsx)("div",{children:(0,hg.jsx)("p",{className:"absolute right-1 bottom-1 text-sm font-normal",children:g.secretCode})})]})]})]})},e)))]})}),(0,hg.jsx)("button",{onClick:N,disabled:0===e.length,className:"w-full py-2 px-4 rounded focus:outline-none focus:shadow-outline-indigo active:bg-indigo-800 ".concat(0!==e.length?"bg-indigo-500 text-white":"bg-gray-300 text-black opacity-50 cursor-not-allowed"),children:"Print"}),(0,hg.jsx)("span",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",children:(0,hg.jsxs)("svg",{className:"fill-current h-6 w-6 text-green-500 cursor-pointer",role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",onClick:()=>A(!1),children:[(0,hg.jsx)("title",{children:"Close"}),(0,hg.jsx)("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})]})})]})})})}),(0,hg.jsx)("div",{children:a.map((g=>(0,hg.jsx)("div",{children:(0,hg.jsxs)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative",children:[(0,hg.jsxs)("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>H(g._id),children:[(0,hg.jsxs)("div",{children:[(0,hg.jsxs)("p",{className:"font-semibold text-lg",children:["Code: ",g.code]}),(0,hg.jsxs)("p",{className:"text-black",children:["Brand: ",g.brand]})]}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("input",{type:"checkbox",checked:e.includes(g),onChange:()=>x(g)}),(0,hg.jsx)("svg",{className:"h-6 w-6 ".concat(s===g._id?"transform rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"})]})]}),s===g._id&&(0,hg.jsx)("div",{className:"flex items-center justify-evenly border-t border-gray-300 mt-4 pt-4",children:(0,hg.jsxs)("div",{className:"text-black",children:[(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Product: ",g.product]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Category: ",g.category]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Size: ",g.size]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Quantity Available: ",g.quantityBuy-g.quantitySold]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["MRP: ",g.mrp]})]})})]},g._id)},g._id)))}),(0,hg.jsx)("div",{className:"flex justify-center",children:(0,hg.jsx)("button",{onClick:()=>{o((g=>g+1))},className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-1",children:l?"Loading...":"Load More"})})]})},Ps=()=>{const g=q(),[e,t]=(0,I.useState)([]),[l,C]=(0,I.useState)(!1),[n,o]=(0,I.useState)(1),[a,i]=(0,I.useState)({}),[s,c]=(0,I.useState)([]),[d,A]=(0,I.useState)(""),[r,u]=(0,I.useState)([]),[m,b]=(0,I.useState)({}),[h,Z]=(0,I.useState)(!1);(0,I.useEffect)((()=>{i((g=>{const e={};return g.forEach((g=>{const t=new Date(g.date).toLocaleDateString();e[t]||(e[t]=[]),e[t].push(g)})),e})(e))}),[e]),(0,I.useEffect)((()=>{b((g=>{const e={};return g.forEach((g=>{const t=new Date(g.date),I=t.toLocaleString("default",{month:"long"}),l=t.getFullYear(),C="".concat(I," ").concat(l);e[C]||(e[C]=[]),e[C].push(g)})),e})(r))}),[r]),(0,I.useEffect)((()=>{G()}),[n]),(0,I.useEffect)((()=>{p()}),[]);const G=async()=>{C(!0);try{const g=await fetch("/api/expenselog/paginate?page=".concat(n,"&limit=10"),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(g.ok){const e=await g.json();t(1===n?e.expenses:g=>[...g,...e.expenses])}else console.error("Failed to fetch expenses")}catch(g){console.error("Error fetching expenses:",g)}finally{C(!1)}},p=async()=>{try{const g=await fetch("/api/expenseTypes",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(g.ok){const e=await g.json();c(e.map((g=>g.name)))}else console.error("Failed to fetch expense types")}catch(g){console.error("Error fetching expense types:",g)}},y=e=>{g("/edit-expense/".concat(e))};return(0,hg.jsxs)("div",{children:[h&&(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:(0,hg.jsx)(La,{})}),(0,hg.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"Expense History"}),(0,hg.jsxs)("div",{className:"mb-4",children:[(0,hg.jsx)("label",{className:"block mb-2 font-semibold",children:"Filter by Expense Type:"}),(0,hg.jsxs)("select",{value:d,onChange:g=>{const e=g.target.value;A(e),e?(async g=>{Z(!0);try{const e=await fetch("/api/expenselog/type?expenseType=".concat(g),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(e.ok){const g=await e.json();u(g.expenses)}else console.error("Failed to fetch expenses for type:",g)}catch(e){console.error("Error fetching filtered expenses:",e)}finally{Z(!1)}})(e):(u([]),b({}))},className:"border p-2 w-full",children:[(0,hg.jsx)("option",{value:"",children:"All Expense Types"}),s.map((g=>(0,hg.jsx)("option",{value:g,children:g},g)))]})]}),d&&(0,hg.jsxs)("div",{children:[(0,hg.jsxs)("h2",{className:"text-xl font-semibold mb-2",children:["Total Expense for ",d,":"," ",r.reduce(((g,e)=>g+e.expenseAmount),0)]}),Object.keys(m).sort(((g,e)=>new Date(e)-new Date(g))).map((g=>(0,hg.jsx)(I.Fragment,{children:(0,hg.jsxs)("div",{children:[(0,hg.jsxs)("div",{className:"bg-blue-100 border border-black text-black rounded flex justify-between items-center p-2 font-semibold",children:[(0,hg.jsx)("h3",{className:"text-lg font-semibold",children:g}),(0,hg.jsxs)("p",{className:"font-semibold",children:["Total Expense:"," ",Array.isArray(m[g])?m[g].reduce(((g,e)=>g+e.expenseAmount),0):0]})]}),Array.isArray(m[g])&&m[g].map((g=>(0,hg.jsxs)("div",{className:"flex justify-between items-center px-4 py-3 rounded border border-black ".concat(g.goodsPayment?"bg-purple-100":"bg-gray-100"),children:[(0,hg.jsxs)("span",{className:"font-semibold",children:[g.expenseType," ",new Date(g.date).toLocaleDateString()]}),(0,hg.jsxs)("span",{className:"text-red-500",children:[g.expenseAmount,(0,hg.jsx)("button",{onClick:()=>y(g._id),className:"ml-5 bg-blue-500 hover:bg-blue-700 text-white  px-1 rounded ",children:"Edit"})]})]},g._id)))]})},g))),h&&(0,hg.jsx)("p",{className:"text-center",children:"Loading filtered expenses..."})]}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("h2",{className:"text-xl font-semibold mb-2 text-center mt-10",children:"All Expenses"}),Object.keys(a).sort(((g,e)=>new Date(e)-new Date(g))).map((g=>(0,hg.jsx)(I.Fragment,{children:(0,hg.jsxs)("div",{children:[(0,hg.jsxs)("div",{className:"bg-red-100 border border-black text-black rounded flex justify-between items-center p-2 font-semibold",children:[(0,hg.jsx)("h3",{className:"text-lg font-semibold",children:g}),(0,hg.jsxs)("p",{className:"font-semibold",children:["Total Expense:"," ",Array.isArray(a[g])?a[g].reduce(((g,e)=>g+e.expenseAmount),0):0]})]}),Array.isArray(a[g])&&a[g].map((g=>(0,hg.jsxs)("div",{className:"flex justify-between items-center px-4 py-3 rounded border border-black ".concat(g.goodsPayment?"bg-purple-100":"bg-gray-100"),children:[(0,hg.jsx)("span",{className:"font-semibold",children:g.expenseType}),(0,hg.jsxs)("span",{className:"text-red-500",children:[g.expenseAmount,(0,hg.jsx)("button",{onClick:()=>y(g._id),className:"ml-5 bg-blue-500 hover:bg-blue-700 text-white  px-1 rounded ",children:"Edit"})]})]},g._id)))]})},g))),l&&(0,hg.jsx)("p",{className:"text-center",children:"Loading expenses..."}),e.length>0&&(0,hg.jsx)("div",{className:"flex justify-center",children:(0,hg.jsx)("button",{onClick:()=>{o((g=>g+1))},className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-4",children:l?"Loading...":"Load More"})})]})]})},Os=()=>{const g=q(),[e,t]=(0,I.useState)(""),[l,C]=(0,I.useState)(null),[n,o]=(0,I.useState)({value:"",isValid:!1}),[a,i]=(0,I.useState)(!1),[s,c]=(0,I.useState)(!1),[d,A]=(0,I.useState)(""),[r,u]=(0,I.useState)(!1);(0,I.useEffect)((()=>{window.localStorage.getItem("userInfo")||g("/login")}),[g]);return(0,hg.jsxs)("div",{className:"bg-white p-6 shadow-md rounded-md",children:[r&&(0,hg.jsx)(hg.Fragment,{children:(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999},children:(0,hg.jsx)(La,{})})}),(0,hg.jsx)("h2",{className:"text-2xl font-semibold mb-6",children:"Increase Quantity to Buy"}),(0,hg.jsxs)("div",{className:"flex mb-4",children:[(0,hg.jsx)("input",{type:"text",placeholder:"Enter Code",value:e,onChange:g=>t(g.target.value.toUpperCase()),className:"w-full p-2 border rounded-md mr-2"}),(0,hg.jsx)("button",{onClick:async()=>{try{c(!0);const g=await fetch("/api/item/code/".concat(e),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(!g.ok)throw new Error("Failed to fetch item details");const t=await g.json();C(t),A("")}catch(d){A("No Product found or Error..."),C(null)}finally{c(!1)}},disabled:s,className:"px-4 py-2 bg-indigo-500 text-white rounded-md focus:outline-none ".concat(s?"opacity-50 cursor-not-allowed":""),children:s?"Searching...":"Search"})]}),l&&(0,hg.jsxs)(hg.Fragment,{children:[(0,hg.jsx)("div",{className:"flex items-center justify-evenly border-t border-gray-300 mt-4 pt-4",children:(0,hg.jsxs)("div",{className:"text-black",children:[(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Product: ",l.product]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Category: ",l.category]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Size: ",l.size]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Quantity Available: ",l.quantityBuy-l.quantitySold]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Quantity Sold: ",l.quantitySold]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["MRP: ",l.mrp]})]})}),(0,hg.jsx)("input",{type:"number",placeholder:"Enter New Quantity",value:n.value,onChange:g=>{const e=g.target.value;if(parseFloat(e)<0)return;const t=!isNaN(e)&&""!==e&&parseInt(e)>=0;o({value:e,isValid:t})},className:"w-full p-2 border rounded-md mb-4"}),(0,hg.jsx)("button",{onClick:async()=>{if(l&&n.isValid){i(!0);try{u(!0);const g=parseInt(l.quantityBuy,10)+parseInt(n.value,10);(await fetch("/api/item/".concat(e),{method:"PATCH",headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token),"Content-Type":"application/json"},body:JSON.stringify({quantityBuy:g})})).ok?(C((e=>({...e,quantityBuy:g}))),A(""),o({...n,value:"",isValid:!1})):A("Failed to update quantity")}catch(d){A("Error updating quantity")}finally{i(!1),u(!1)}}},disabled:!n.isValid||a,className:"w-full py-2 px-4 rounded-md focus:outline-none ".concat(!n.isValid||a?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-indigo-500 text-white"),children:a?"Updating...":"Increase Quantity"})]}),d&&(0,hg.jsx)("p",{className:"text-red-500 text-center",children:d})]})},_s=()=>{const g=q(),[e,t]=(0,I.useState)({phoneNo:"",name:""}),[l,C]=(0,I.useState)([]),[n,o]=(0,I.useState)({code:"",quantitySold:1,sellingPrice:""}),[a,i]=(0,I.useState)(!1),[s,c]=(0,I.useState)(!1),[d,A]=(0,I.useState)(0),[r,u]=(0,I.useState)(!1),[m,b]=(0,I.useState)(!1),[h,Z]=(0,I.useState)(!1),[G,p]=(0,I.useState)(!0),[y,B]=(0,I.useState)("");(0,I.useEffect)((()=>{!function(){const e=window.localStorage.getItem("userInfo");if(e){const g=JSON.parse(e);B(g.email)}else g("/login")}()}),[g]),(0,I.useEffect)((()=>{S()}),[n.code]);const S=async()=>{try{if(7===n.code.length){u(!0);const t=await fetch("/api/availablequantity?code=".concat(n.code),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(t.ok){var{availableQuantity:e}=await t.json();A(e)}else A(0),console.log("Failed to fetch available quantity"),401===t.status&&(window.localStorage.clear(),g("/login"));u(!1)}else A(0)}catch(t){console.log(t)}};(0,I.useEffect)((()=>{d>0&&""!==n.sellingPrice&&parseFloat(n.sellingPrice)>0&&(10===e.phoneNo.length||0===e.phoneNo.length)?p(!1):p(!0)}),[d,n,e]);const W=g=>{const{name:e,value:I}=g.target;if("phoneNo"===e){if(!/^\d*$/.test(I))return;10===I.length||0===I.length?Z(!1):Z(!0)}t((g=>({...g,[e]:I})))},V=g=>{const{name:e,value:t}=g.target;"sellingPrice"===e&&parseFloat(t)<0||o((g=>({...g,[e]:t.toUpperCase()})))};return(0,hg.jsxs)("div",{className:"bg-white p-6 rounded shadow-lg",children:[a&&(0,hg.jsx)(hg.Fragment,{children:(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999},children:(0,hg.jsx)(La,{})})}),(0,hg.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Customer Purchase"}),(0,hg.jsxs)("div",{className:"mb-4",children:[(0,hg.jsx)("label",{htmlFor:"phoneNo",className:"block text-sm font-medium text-gray-700",children:"Customer Phone No."}),(0,hg.jsx)("input",{name:"phoneNo",type:"tel",placeholder:"Customer's phone number",value:e.phoneNo,onChange:W,className:"mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"}),h&&(0,hg.jsx)("div",{className:"mt-2 p-2 bg-red-400 text-white font-bold text-center rounded-md",children:"Invalid phone number"})]}),(0,hg.jsxs)("div",{className:"mb-4",children:[(0,hg.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Customer Name"}),(0,hg.jsx)("input",{name:"name",type:"text",placeholder:"Customer's name",value:e.name,onChange:W,className:"mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,hg.jsxs)("div",{className:"mb-4",children:[(0,hg.jsx)("label",{htmlFor:"code",className:"block text-sm font-medium text-gray-700",children:"Product Code"}),(0,hg.jsx)("input",{name:"code",type:"text",placeholder:"Product code",value:n.code,onChange:V,className:"mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"}),(0,hg.jsxs)("p",{className:"mt-2 text-green-500",children:["Available Quantity:"," ",r?"Fetching Quantity...":d]})]}),(0,hg.jsxs)("div",{className:"mb-4",children:[(0,hg.jsx)("label",{htmlFor:"sellingPrice",className:"block text-sm font-medium text-gray-700",children:"Selling Price"}),(0,hg.jsx)("input",{type:"number",name:"sellingPrice",placeholder:"Selling price",value:n.sellingPrice,onChange:V,className:"mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,hg.jsx)("button",{onClick:()=>{n.code&&n.sellingPrice&&parseFloat(n.sellingPrice)>0&&n.quantitySold>0&&(C((g=>[...g,n])),o({code:"",quantitySold:1,sellingPrice:""}),A(0))},disabled:G||a,className:"w-full py-2 px-4 rounded focus:outline-none focus:shadow-outline-indigo active:bg-indigo-800 ".concat(G?"bg-gray-300 text-black opacity-50 cursor-not-allowed":"bg-indigo-500 text-white"),children:"Add Item"}),(0,hg.jsxs)("div",{className:"mt-6",children:[(0,hg.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Purchase List"}),0===l.length?(0,hg.jsx)("p",{children:"No items added"}):(0,hg.jsxs)(hg.Fragment,{children:[(0,hg.jsx)("div",{children:(0,hg.jsxs)("li",{className:"py-4 flex justify-between items-center text-lg font-semibold",children:[(0,hg.jsx)("div",{className:"ml-5",children:(0,hg.jsx)("p",{children:"Code"})}),(0,hg.jsx)("div",{className:"flex",children:(0,hg.jsx)("p",{className:"text-gray-600 mr-10",children:"Selling Price"})})]})}),(0,hg.jsx)("ul",{className:"divide-y divide-gray-200 ",children:l.map(((g,e)=>(0,hg.jsxs)("li",{className:"py-4 flex justify-between items-center mb-2 bg-white p-4 rounded shadow-md transition duration-300 hover:bg-gray-100",children:[(0,hg.jsx)("div",{className:"",children:(0,hg.jsxs)("p",{children:[e+1,". Code: ",g.code]})}),(0,hg.jsxs)("div",{className:"flex",children:[(0,hg.jsxs)("p",{className:"text-gray-600 mr-5",children:["Selling Price: \u20b9",g.sellingPrice.toLocaleString("hi")]}),(0,hg.jsx)("button",{onClick:()=>(g=>{C((e=>e.filter(((e,t)=>t!==g))))})(e),className:"text-red bg-red-500 hover:bg-red-600 px-3 py-1 rounded-full transition duration-300",children:(0,hg.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-trash3",viewBox:"0 0 16 16",children:(0,hg.jsx)("path",{d:"M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47M8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5"})})})]})]},e)))}),(0,hg.jsx)("div",{children:(0,hg.jsxs)("li",{className:"py-4 flex justify-between items-center text-lg font-semibold",children:[(0,hg.jsx)("div",{className:"ml-5",children:(0,hg.jsxs)("p",{children:["Items : ",l.length]})}),(0,hg.jsx)("div",{className:"flex",children:(0,hg.jsxs)("p",{className:"text-gray-600 mr-10",children:["Total :  \u20b9 ",(()=>{let g=0;return l.forEach((e=>{g+=parseFloat(e.sellingPrice)})),g})().toLocaleString("en-IN")]})})]})})]})]}),(0,hg.jsxs)("div",{className:"flex justify-center mt-6",children:[(0,hg.jsx)("button",{onClick:()=>{o((g=>({...g,code:""})))},className:"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded m-1",children:"Reset QR Code"}),(0,hg.jsx)("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded m-1",onClick:()=>b(!m),children:"Toggle Scanner"})]}),m&&(0,hg.jsx)(bg(),{onScan:g=>{g&&/^[A-Z]{3}\d{4}$/.test(g.text)&&(o((e=>({...e,code:g.text}))),b(!1))},onError:g=>{console.error("Error while scanning QR code:",g)},constraints:{audio:!1,video:{facingMode:"environment"}},style:{width:"100%"}}),s&&(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999},children:(0,hg.jsxs)("div",{className:"flex items-center justify-center bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative w-full m-5",role:"alert",children:[(0,hg.jsx)("strong",{className:"font-bold",children:"Purchase recorded successfully"}),(0,hg.jsx)("span",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",children:(0,hg.jsxs)("svg",{className:"fill-current h-6 w-6 text-green-500 cursor-pointer",role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",onClick:()=>c(!1),children:[(0,hg.jsx)("title",{children:"Close"}),(0,hg.jsx)("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})]})})]})}),(0,hg.jsx)("button",{onClick:async()=>{i(!0);try{const I=await fetch("/api/sell/customerpurchase",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)},body:JSON.stringify({...e,purchaseList:l,sellerEmail:y})});I.ok?(t({phoneNo:"",name:""}),C([]),c(!0),setTimeout((()=>{c(!1)}),3e3)):401===I.status?(window.localStorage.clear(),g("/login")):console.error("Failed to process customer purchase")}catch(I){console.error("Error:",I)}finally{i(!1)}},disabled:0===l.length||a,className:"w-full py-2 px-4 rounded focus:outline-none focus:shadow-outline-indigo active:bg-indigo-800 ".concat(l.length>0?"bg-indigo-500 text-white":"bg-gray-300 text-black opacity-50 cursor-not-allowed"),children:a?"Processing...":"Complete Purchase"})]})},qs=()=>{const g=q(),e=O(),{selectedItems:t}=e.state,[l,C]=(0,I.useState)({brand:"",product:"",category:"",size:"",mrp:"",quantityBuy:""}),[n,o]=(0,I.useState)({}),[a,i]=(0,I.useState)([]),[s,c]=(0,I.useState)({products:[],categories:[],sizes:[{size:[]}]}),[d,A]=(0,I.useState)([]),[r,u]=(0,I.useState)(!0),[m,b]=(0,I.useState)({status:!1,color:"",message:""}),[h,Z]=(0,I.useState)(!1),[G,p]=(0,I.useState)({from:"",to:""});(0,I.useEffect)((()=>{(async()=>{try{if(window.localStorage.getItem("userInfo")){const e=await fetch("/api/dropdownoption/dropdownoptions",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(e.ok){const g=await e.json();g.products.sort(((g,e)=>g.brand.localeCompare(e.brand))),g.products.forEach((g=>{g.products.sort()})),g.categories[0].category.sort(((g,e)=>g.localeCompare(e))),c(g)}else console.error("Failed to fetch dropdown options"),window.localStorage.clear(),g("/login")}}catch(e){console.log(e)}})()}),[]),(0,I.useEffect)((()=>{if(t&&t.length>0){const g=t[0],e={brand:g.brand,product:g.product,category:g.category,size:g.size,mrp:g.mrp,quantityBuy:g.quantityBuy};t.forEach((g=>{Object.keys(e).forEach((t=>{e[t]!==g[t]&&(e[t]="")}))})),C(e),o(e);const I=Object.keys(e).filter((g=>""!==e[g]));i(I)}}),[t]),(0,I.useEffect)((()=>{if(l.brand){const g=s.products.find((g=>g.brand===l.brand));A(g?g.products:[])}else A([])}),[l.brand,s.products]);const y=g=>{const{name:e,value:t}=g.target;"mrp"===e&&parseFloat(t)<0||"quantityBuy"===e&&parseFloat(t)<0||(p({from:n[e],to:t}),C((g=>({...g,[e]:t}))))};(0,I.useEffect)((()=>{(()=>{var g=Object.keys(n).some((g=>n[g]!=l[g]))&&""!==l.mrp&&""!==l.quantityBuy;u(!g)})()}),[l]);return(0,hg.jsxs)("div",{children:[(0,hg.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"Update Common Details"}),h&&(0,hg.jsx)(hg.Fragment,{children:(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999},children:(0,hg.jsxs)("div",{className:"bg-white border  px-4 py-3 rounded relative w-full m-5",role:"alert",children:[(0,hg.jsx)("div",{className:"flex justify-center",children:(0,hg.jsx)("strong",{className:"font-bold text-center",children:"Are you sure ?"})}),(0,hg.jsx)("div",{className:"text-sm mt-4",children:Object.keys(G).length>0&&(0,hg.jsxs)("p",{className:"text-center",children:[G.from," -----\u2192 ",G.to]})}),(0,hg.jsx)("div",{children:(0,hg.jsx)("button",{className:"w-full mt-6 py-2 px-4 rounded focus:outline-none ".concat(r?"bg-gray-500 text-gray-500 opacity-50 cursor-not-allowed":"bg-indigo-500 text-white"),onClick:r?null:async e=>{e.preventDefault();const I={};if(Object.keys(l).forEach((g=>{l[g]!==n[g]&&(I[g]=l[g])})),Object.keys(I).length>0){const e=t.map((g=>({code:g.code,updateFields:I})));try{const t=await fetch("/api/item/updateAll",{method:"PATCH",headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token),"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok){await t.json();b({status:!0,color:"green",message:"Updated Successfully"}),setTimeout((()=>{b({status:!1,color:"",message:""}),g("/history")}),1e3)}else console.error("Failed to update items"),b({status:!0,color:"red",message:"Failed to update item"}),setTimeout((()=>{b({status:!1,color:"",message:""})}),3e3)}catch(C){console.error("Error updating items:",C),b({status:!0,color:"red",message:"Failed to update item"}),setTimeout((()=>{b({status:!1,color:"",message:""})}),3e3)}}else b({status:!0,color:"red",message:"No field changed"}),setTimeout((()=>{b({status:!1,color:"",message:""})}),3e3)},children:"Confirm"})}),(0,hg.jsx)("span",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",children:(0,hg.jsxs)("svg",{className:"fill-current h-6 w-6  cursor-pointer",role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",onClick:()=>Z(!1),children:[(0,hg.jsx)("title",{children:"Close"}),(0,hg.jsx)("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})]})})]})})}),(0,hg.jsxs)("div",{className:"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded relative mb-4",children:[(0,hg.jsx)("h2",{className:"font-semibold text-lg",children:"Common Details"}),(0,hg.jsxs)(hg.Fragment,{children:[a.includes("brand")&&(0,hg.jsxs)("select",{name:"brand",value:l.brand,onChange:y,className:"w-full p-2 border rounded-md",children:[(0,hg.jsx)("option",{value:"",disabled:!0,children:"Select Brand"}),s.products.map((g=>(0,hg.jsx)("option",{value:g.brand,children:g.brand},g.brand)))]}),a.includes("product")&&(0,hg.jsxs)("select",{name:"product",value:l.product,onChange:y,className:"w-full mt-4 p-2 border rounded-md",disabled:!l.brand,children:[(0,hg.jsx)("option",{value:"",disabled:!0,children:"Select Product"}),d.map((g=>(0,hg.jsx)("option",{value:g,children:g},g)))]}),a.includes("category")&&(0,hg.jsxs)("select",{name:"category",value:l.category,onChange:y,className:"w-full mt-4 p-2 border rounded-md",children:[(0,hg.jsx)("option",{value:"",disabled:!0,children:"Select Category"}),s.categories.map((g=>g.category.map((g=>(0,hg.jsx)("option",{value:g,children:g},g)))))]}),a.includes("size")&&(0,hg.jsxs)("select",{name:"size",value:l.size,onChange:y,className:"w-full mt-4 p-2 border rounded-md",children:[(0,hg.jsx)("option",{value:"",disabled:!0,children:"Select Size"}),s.sizes.map((g=>g.size.map((g=>(0,hg.jsx)("option",{value:g,children:g},g)))))]}),a.includes("mrp")&&(0,hg.jsx)("input",{type:"number",placeholder:"MRP",name:"mrp",value:l.mrp,onChange:y,className:"w-full mt-4 p-2 border rounded-md"}),a.includes("quantityBuy")&&(0,hg.jsx)("input",{type:"number",placeholder:"Quantity Buy",name:"quantityBuy",value:l.quantityBuy,onChange:y,className:"w-full mt-4 p-2 border rounded-md"}),(0,hg.jsx)("div",{className:"flex justify-center",children:(0,hg.jsx)("button",{type:"submit",className:"px-4 py-2 rounded mt-4 ".concat(r?"bg-gray-500":"bg-green-500"," text-white"),disabled:r,onClick:()=>{Z(!0)},children:"Update Items"})})]})]}),t.map((g=>(0,hg.jsxs)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4",children:[(0,hg.jsx)("div",{className:"flex justify-between items-center cursor-pointer",children:(0,hg.jsxs)("div",{children:[(0,hg.jsxs)("p",{className:"font-semibold text-lg",children:["Code: ",g.code]}),(0,hg.jsxs)("p",{className:"text-black",children:["Brand: ",g.brand]})]})}),(0,hg.jsx)("div",{className:"flex items-center justify-evenly border-t border-gray-300 mt-4 pt-4",children:(0,hg.jsxs)("div",{className:"text-black",children:[(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Product: ",g.product]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Category: ",g.category]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Size: ",g.size]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Quantity Available: ",g.quantityBuy-g.quantitySold]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Quantity Sold: ",g.quantitySold]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["MRP: ",g.mrp]})]})})]},g._id))),m.status&&(0,hg.jsx)(hg.Fragment,{children:(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999},children:(0,hg.jsxs)("div",{className:"flex items-center justify-center px-4 py-3 rounded relative w-full m-5 border-2 ".concat("red"===m.color?"bg-red-100 border-red-700 text-red-700":"bg-green-100 border-green-700 text-green-700"),role:"alert",children:[(0,hg.jsx)("strong",{className:"font-bold",children:m.message}),(0,hg.jsx)("span",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",children:(0,hg.jsxs)("svg",{className:"fill-current h-6 w-6 cursor-pointer ".concat("red"===m.color?"text-red-500":"text-green-500"),role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",onClick:()=>b(!1),children:[(0,hg.jsx)("title",{children:"Close"}),(0,hg.jsx)("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})]})})]})})})]})},$s=()=>{const[g,e]=(0,I.useState)(null),[t,l]=(0,I.useState)(!1),[C,n]=(0,I.useState)(!1),[o,a]=(0,I.useState)(null),[i,s]=(0,I.useState)(""),[c,d]=(0,I.useState)(""),[A,r]=(0,I.useState)(!1),u=async g=>{if(g.length>=3){n(!0);try{const t=await fetch("/api/item/search/Code/".concat(g),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(t.ok){const g=await t.json();e(g),l(!1)}else 401===t.status?(window.localStorage.clear(),e(null),l(!0),n(!1)):(e(null),l(!0),n(!1))}catch(t){}finally{n(!1)}}};(0,I.useEffect)((()=>{u(i)}),[c]);return(0,hg.jsxs)(hg.Fragment,{children:[(0,hg.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"Search"}),(0,hg.jsxs)("form",{onSubmit:g=>{g.preventDefault(),""===i.trim()?(e(null),l(!1)):u(i),s("")},className:"mb-4 flex items-center",children:[(0,hg.jsx)("input",{type:"text",value:i,onChange:g=>{const t=g.target.value;/^[a-zA-Z0-9\s]*$/.test(t)&&(s(t.toUpperCase()),""===t?(e(null),l(!1)):u(t))},placeholder:"Search by code",className:"border border-gray-300 rounded-l px-4 py-2 w-3/4"}),(0,hg.jsx)("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-r w-1/4",children:C?"Serahcing":"Search"})]}),(0,hg.jsx)("div",{className:"flex justify-center",children:(0,hg.jsx)("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded m-1",onClick:()=>r(!A),children:"Toggle Scanner"})}),A&&(0,hg.jsx)(bg(),{onScan:g=>{g&&/^[A-Z]{3}\d{4}$/.test(g.text)&&(s(g.text.substring(0,4)),d(g.text),r(!1))},onError:g=>{console.error("Error while scanning QR code:",g)},constraints:{audio:!1,video:{facingMode:"environment"}},style:{width:"100%"}}),c&&(0,hg.jsxs)("p",{children:["QR Code Scanned: ",c]}),C&&(0,hg.jsx)("p",{className:"text-green-500 text-center font-semibold",children:" Searching"}),g?(0,hg.jsxs)("div",{children:[(0,hg.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Searched Item"}),(0,hg.jsxs)("p",{children:["Number of result = ",g.length]}),g.map((g=>(0,hg.jsxs)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative ".concat(g.quantityBuy-g.quantitySold<=0?"bg-red-100 border border-red-400 text-red-700":""),children:[(0,hg.jsx)("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>{return e=g._id,void a((g=>g===e?null:e));var e},children:(0,hg.jsxs)("div",{children:[(0,hg.jsxs)("p",{className:"font-semibold text-lg",children:["Code: ",g.code]}),(0,hg.jsxs)("p",{className:"font-semibold text-lg",children:["Size: ",g.size]}),(0,hg.jsxs)("p",{className:"text-black",children:["Brand: ",g.brand]})]})}),o===g._id&&(0,hg.jsx)("div",{className:"flex items-center justify-evenly border-t border-gray-500 mt-4 pt-4 ".concat(g.quantityBuy-g.quantitySold<=0?"bg-red-100  text-red-700":""),children:(0,hg.jsxs)("div",{className:"text-black",children:[(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Product: ",g.product]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Category: ",g.category]}),(0,hg.jsxs)("p",{className:"font-semibold py-1 ".concat(g.quantityBuy-g.quantitySold<=0?"text-red-700":"text-green-700"),children:["Quantity Available: ",g.quantityBuy-g.quantitySold]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["Quantity Sold: ",g.quantitySold]}),(0,hg.jsxs)("p",{className:"font-semibold py-1",children:["MRP: ",g.mrp]})]})})]},g._id)))]}):t&&(0,hg.jsx)("div",{className:"mt-2 p-2 bg-red-500 text-white text-center rounded-md",children:"No product found with this code."})]})},gc=()=>{const g=q(),[e,t]=(0,I.useState)(""),[l,C]=(0,I.useState)([]),[n,o]=(0,I.useState)(!1),[a,i]=(0,I.useState)(!1),[s,c]=(0,I.useState)(""),[d,A]=(0,I.useState)("text-green-500");(0,I.useEffect)((()=>{window.localStorage.getItem("userInfo")||g("/login")}),[g]),(0,I.useEffect)((()=>{(async()=>{o(!0);try{const g=await fetch("/api/expenseTypes",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}}),e=await g.json();C([...new Set(e.map((g=>g.name)))])}catch(g){console.error("Error fetching expense types:",g)}finally{o(!1)}})()}),[]);const r=(g,e)=>{c(g),A(e?"text-green-500":"text-red-500"),i(!0),setTimeout((()=>{i(!1),c("")}),3e3)};return(0,hg.jsxs)("div",{className:"p-4",children:[n&&(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:(0,hg.jsx)(La,{})}),(0,hg.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Manage Expense Types"}),(0,hg.jsxs)("div",{className:"mb-4",children:[(0,hg.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Available Expense Types:"}),(0,hg.jsx)("ul",{className:"space-y-2",children:l.length>0?l.map(((g,e)=>(0,hg.jsx)("li",{className:"border-b pb-1",children:g},e))):(0,hg.jsx)("p",{className:"text-gray-500",children:"No expense types added yet."})})]}),(0,hg.jsxs)("div",{className:"mb-4",children:[(0,hg.jsx)("label",{className:"block mb-2 text-lg font-semibold",children:"New Expense Type:"}),(0,hg.jsx)("input",{type:"text",value:e,onChange:g=>t(g.target.value.toUpperCase()),className:"border p-2 w-full rounded",placeholder:"Enter expense type"})]}),a&&(0,hg.jsx)("div",{className:"".concat(d," mt-2 font-semibold"),children:s}),(0,hg.jsx)("button",{onClick:async()=>{if(e.trim())if(l.includes(e))r("Expense Type already exists!",!1);else{o(!0);try{const g=await fetch("/api/expenseTypes",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)},body:JSON.stringify({name:e})});if(g.ok)C([...l,e]),t(""),r("Expense Type added successfully!",!0);else{const e=await g.json();r(e.error||"Failed to add expense type",!1)}}catch(g){console.error("Error:",g),r("Something went wrong!",!1)}finally{o(!1)}}},className:"py-2 px-4 rounded text-white ".concat(e.trim()?"bg-green-500 hover:bg-green-700":"bg-gray-400 cursor-not-allowed"),disabled:!e.trim(),children:"Add Expense Type"})]})},ec=()=>{const g=q(),{id:e}=$(),[t,l]=(0,I.useState)([]),[C,n]=(0,I.useState)({expenseType:"",expenseAmount:"",description:"",date:"",goodsPayment:!1}),[o,a]=(0,I.useState)({...C}),[i,s]=(0,I.useState)(!1),[c,d]=(0,I.useState)(!1),[A,r]=(0,I.useState)(!1),[u,m]=(0,I.useState)(!1),[b,h]=(0,I.useState)(!1),[Z,G]=(0,I.useState)(!1),[p,y]=(0,I.useState)(""),[B,S]=(0,I.useState)(!1),[W,V]=(0,I.useState)(!1),[R,X]=(0,I.useState)("");(0,I.useEffect)((()=>{window.localStorage.getItem("userInfo")||g("/login")}),[g]),(0,I.useEffect)((()=>{(async()=>{try{const g=await fetch("/api/expenseTypes",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(g.ok){const e=await g.json();l(e.map((g=>g.name)))}else console.error("Failed to fetch expense types")}catch(g){console.error("Error fetching expense types:",g)}})()}),[]);(0,I.useEffect)((()=>{(()=>{const g=Object.keys(C).some((g=>C[g]!==o[g]))&&""!==o.expenseType.trim()&&Number(o.expenseAmount)>0&&""!==o.date.trim();s(g)})()}),[o]),(0,I.useEffect)((()=>{(async()=>{try{r(!0);const g=await fetch("/api/expenselog/".concat(e),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(!g.ok)throw new Error("Failed to fetch expense details");const t=await g.json(),I=new Date(t.date).toISOString().substring(0,10);t.date=I,n(t),a(t)}catch(g){console.error("Error fetching expense details:",g)}finally{r(!1)}})()}),[]);const J=g=>{const{name:e,value:t}=g.target;if("expenseAmount"!==e)a("goodsPayment"!==e?g=>({...g,[e]:t}):g=>({...g,[e]:"true"===t}));else{if(parseFloat(t)<0)return;a((g=>({...g,[e]:t})))}};return(0,hg.jsxs)("div",{className:"bg-white p-6 shadow-md rounded-md",children:[B&&(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:(0,hg.jsx)(La,{})}),(0,hg.jsx)("h2",{className:"text-2xl font-semibold mb-6",children:"Edit Expense"}),A?(0,hg.jsx)("h1",{className:"text-green-500 text-center text-2xl font-semibold mb-6",children:"Loading..."}):(0,hg.jsxs)(hg.Fragment,{children:[(0,hg.jsxs)("div",{className:"mb-4",children:[(0,hg.jsx)("label",{className:"block mb-2",children:"Expense Type:"}),(0,hg.jsxs)("select",{name:"expenseType",value:o.expenseType,onChange:J,className:"w-full p-2 border rounded-md",children:[(0,hg.jsx)("option",{value:"",children:"Select Expense Type"}),t.map((g=>(0,hg.jsx)("option",{value:g,children:g},g)))]})]}),(0,hg.jsx)("input",{type:"number",name:"expenseAmount",placeholder:"Amount",value:o.expenseAmount,onChange:J,className:"w-full mt-4 p-2 border rounded-md"}),(0,hg.jsx)("input",{type:"date",name:"date",value:o.date,onChange:J,className:"w-full mt-4 p-2 border rounded-md"}),(0,hg.jsx)("textarea",{name:"description",placeholder:"Description",value:o.description,onChange:J,className:"w-full mt-4 p-2 border rounded-md"}),(0,hg.jsxs)("div",{className:"mt-4",children:[(0,hg.jsx)("label",{className:"block mb-2",children:"Goods Payment:"}),(0,hg.jsxs)("select",{name:"goodsPayment",value:o.goodsPayment.toString(),onChange:J,className:"w-full p-2 border rounded-md",children:[(0,hg.jsx)("option",{value:"false",children:"No"}),(0,hg.jsx)("option",{value:"true",children:"Yes"})]})]})]}),u&&(0,hg.jsx)("div",{className:"text-red-500 text-center text-sm mt-2",children:"Error while updating, try again."}),(0,hg.jsx)("button",{onClick:()=>{V(!0)},disabled:!i||c,className:"w-full mt-6 py-2 px-4 rounded focus:outline-none ".concat(i?"bg-indigo-500 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:c?"Updating...":"Update"}),b&&(0,hg.jsx)("div",{className:"text-red-500 text-center text-sm mt-2",children:"Error while deleting, try again."}),(0,hg.jsx)("button",{onClick:()=>{G(!0)},className:"w-full mt-6 py-2 px-4 rounded focus:outline-none bg-red-500 text-white",children:"Delete This Expense"}),W&&(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:(0,hg.jsxs)("div",{className:"bg-white p-6 rounded-md",children:[(0,hg.jsx)("p",{className:"mb-4",children:"Type 'CONFIRM' to update this expense:"}),(0,hg.jsxs)("div",{className:"flex flex-col justify-center",children:[(0,hg.jsx)("input",{type:"text",value:R,onChange:g=>{X(g.target.value.toUpperCase())},className:"border p-2 rounded-md text-center"}),(0,hg.jsxs)("div",{className:"mt-4 flex justify-between",children:[(0,hg.jsx)("button",{onClick:()=>{X(""),V(!1)},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md mr-2",children:"Cancel"}),(0,hg.jsx)("button",{onClick:()=>{(async()=>{d(!0),S(!0);try{const t=Object.entries(o).reduce(((g,e)=>{let[t,I]=e;return C[t]!==I&&(g[t]=I),g}),{});t.expenseAmount&&(t.expenseAmount=Number(t.expenseAmount)),t.date&&(t.date=new Date(t.date).getTime()),(await fetch("/api/expenselog/".concat(e),{method:"PATCH",headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token),"Content-Type":"application/json"},body:JSON.stringify(t)})).ok?g("/expense-history"):(console.error("Failed to update expense"),m(!0),setTimeout((()=>{m(!1)}),3e3))}catch(t){console.error("Error:",t)}finally{d(!1),S(!1)}})(),V(!1)},disabled:"CONFIRM"!==R,className:"px-4 py-2 rounded-md ".concat("CONFIRM"!==R?"bg-gray-300 text-gray-700 cursor-not-allowed":"bg-indigo-500 text-white"),children:"Confirm Update"})]})]})]})}),Z&&(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:(0,hg.jsxs)("div",{className:"bg-white p-6 rounded-md",children:[(0,hg.jsx)("p",{className:"mb-4",children:"Type 'CONFIRM' to delete this expense:"}),(0,hg.jsxs)("div",{className:"flex flex-col justify-center",children:[(0,hg.jsx)("input",{type:"text",value:p,onChange:g=>{y(g.target.value.toUpperCase())},className:"border p-2 rounded-md text-center"}),B&&(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:(0,hg.jsx)(La,{})}),(0,hg.jsxs)("div",{className:"mt-4 flex justify-between",children:[(0,hg.jsx)("button",{onClick:()=>{y(""),G(!1)},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md mr-2",children:"Cancel"}),(0,hg.jsx)("button",{onClick:async()=>{if("CONFIRM"===p)try{S(!0);(await fetch("/api/expenselog/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}})).ok?g("/expense-history"):(console.error("Failed to delete expense"),G(!1),h(!0),setTimeout((()=>{h(!1)}),3e3))}catch(t){console.error("Error:",t)}finally{S(!1)}},disabled:"CONFIRM"!==p,className:"px-4 py-2 rounded-md ".concat("CONFIRM"!==p?"bg-gray-300 text-gray-700 cursor-not-allowed":"bg-red-500 text-white"),children:"Confirm"})]})]})]})})]})},tc=g=>{let{message:e,type:t="info",onClose:I}=g;const l={success:"bg-green-500",error:"bg-red-500",warning:"bg-yellow-500",info:"bg-blue-500"}[t];return(0,hg.jsxs)("div",{className:"".concat(l," text-white p-4 rounded-md shadow-lg flex justify-between items-center min-w-64"),children:[(0,hg.jsx)("span",{children:e}),(0,hg.jsx)("button",{onClick:I,className:"text-white ml-4",children:"\xd7"})]})},Ic=()=>{const g=q(),[e,t]=(0,I.useState)([]),[l,C]=(0,I.useState)(!1),[n,o]=(0,I.useState)(!1),[a,i]=(0,I.useState)(null),[s,c]=(0,I.useState)(""),[d,A]=(0,I.useState)({sessionName:"",sessionType:"full",categories:[],notes:""}),[r,u]=(0,I.useState)({categories:[]}),[m,b]=(0,I.useState)([]),[h,Z]=(0,I.useState)({create:!1,delete:!1,fetch:!1}),G=(0,I.useCallback)((function(g){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";const t=Date.now();b((I=>[...I,{id:t,message:g,type:e}])),setTimeout((()=>{b((g=>g.filter((g=>g.id!==t))))}),5e3)}),[]);(0,I.useEffect)((()=>{p(),y(),B()}),[]);const p=()=>{window.localStorage.getItem("userInfo")||g("/login")},y=async()=>{try{Z((g=>({...g,fetch:!0})));const g=await fetch("/api/verification/sessions",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(g.ok){const e=await g.json();t(e)}else G("Failed to fetch sessions","error")}catch(g){console.error("Error fetching sessions:",g),G("Error fetching sessions","error")}finally{Z((g=>({...g,fetch:!1})))}},B=async()=>{try{const g=await fetch("/api/dropdownoption/dropdownoptions",{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(g.ok){const e=await g.json();u(e)}}catch(g){console.error("Error fetching dropdown options:",g),G("Error loading categories","warning")}},S=g=>new Date(g).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),W=g=>{switch(g){case"active":return"bg-green-100 text-green-800 border border-green-200";case"paused":return"bg-yellow-100 text-yellow-800 border border-yellow-200";case"completed":return"bg-blue-100 text-blue-800 border border-blue-200";case"cancelled":return"bg-red-100 text-red-800 border border-red-200";default:return"bg-gray-100 text-gray-800 border border-gray-200"}},V="confirm"===s.toLowerCase(),R=Object.values(h).some((g=>g));return(0,hg.jsxs)(hg.Fragment,{children:[(0,hg.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:m.map((g=>(0,hg.jsx)(tc,{message:g.message,type:g.type,onClose:()=>b((e=>e.filter((e=>e.id!==g.id))))},g.id)))}),R&&(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-30 z-50",children:(0,hg.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg flex flex-col items-center",children:[(0,hg.jsx)(La,{}),(0,hg.jsxs)("p",{className:"mt-2 text-gray-700",children:[h.create&&"Creating session...",h.delete&&"Deleting session...",h.fetch&&"Loading sessions..."]})]})}),(0,hg.jsxs)("div",{className:"bg-white p-6 shadow-md rounded-lg border border-gray-200",children:[(0,hg.jsxs)("div",{className:"flex justify-between items-center m-8",children:[(0,hg.jsxs)("div",{children:[(0,hg.jsx)("h2",{className:"text-3xl font-bold text-gray-900",children:"Stock Verification"}),(0,hg.jsx)("p",{className:"text-gray-600 mt-1",children:"Manage and track your inventory verification sessions"})]}),(0,hg.jsxs)("button",{onClick:()=>C(!0),className:"bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 flex items-center space-x-2",disabled:h.create,children:[(0,hg.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,hg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})}),(0,hg.jsx)("span",{children:"Start New Verification"})]})]}),e.length>0&&(0,hg.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[(0,hg.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:(0,hg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,hg.jsx)("p",{className:"text-blue-600 text-sm",children:"Total Sessions"}),(0,hg.jsx)("p",{className:"text-2xl font-bold text-blue-700",children:e.length})]})}),(0,hg.jsx)("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:(0,hg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,hg.jsx)("p",{className:"text-green-600 text-sm",children:"Active"}),(0,hg.jsx)("p",{className:"text-2xl font-bold text-green-700",children:e.filter((g=>"active"===g.status)).length})]})}),(0,hg.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:(0,hg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,hg.jsx)("p",{className:"text-blue-600 text-sm",children:"Completed"}),(0,hg.jsx)("p",{className:"text-2xl font-bold text-blue-700",children:e.filter((g=>"completed"===g.status)).length})]})}),(0,hg.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:(0,hg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,hg.jsx)("p",{className:"text-gray-600 text-sm",children:"Paused"}),(0,hg.jsx)("p",{className:"text-2xl font-bold text-gray-700",children:e.filter((g=>"paused"===g.status)).length})]})})]}),l&&(0,hg.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-40",children:(0,hg.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,hg.jsxs)("div",{className:"mt-3",children:[(0,hg.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,hg.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Create New Session"}),(0,hg.jsx)("button",{onClick:()=>C(!1),className:"text-gray-400 hover:text-gray-600",disabled:h.create,children:(0,hg.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,hg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,hg.jsxs)("div",{className:"space-y-4",children:[(0,hg.jsxs)("div",{children:[(0,hg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Session Name *"}),(0,hg.jsx)("input",{type:"text",value:d.sessionName,onChange:g=>A({...d,sessionName:g.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"e.g., Monthly Stock Check - Jan 2025"})]}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Verification Type"}),(0,hg.jsxs)("select",{value:d.sessionType,onChange:g=>A({...d,sessionType:g.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[(0,hg.jsx)("option",{value:"full",children:"Full Inventory"}),(0,hg.jsx)("option",{value:"category",children:"Category Specific"})]})]}),"category"===d.sessionType&&(0,hg.jsxs)("div",{children:[(0,hg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Categories *"}),(0,hg.jsx)("div",{className:"max-h-32 overflow-y-auto border border-gray-300 rounded-lg p-3",children:0===r.categories.length?(0,hg.jsx)("p",{className:"text-gray-500 text-sm",children:"Loading categories..."}):r.categories.map((g=>g.category.map((g=>(0,hg.jsxs)("div",{className:"flex items-center mb-2",children:[(0,hg.jsx)("input",{type:"checkbox",id:g,checked:d.categories.includes(g),onChange:()=>(g=>{const e=d.categories.includes(g)?d.categories.filter((e=>e!==g)):[...d.categories,g];A({...d,categories:e})})(g),className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),(0,hg.jsx)("label",{htmlFor:g,className:"ml-2 text-sm text-gray-700",children:g})]},g)))))}),d.categories.length>0&&(0,hg.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Selected: ",d.categories.join(", ")]})]}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),(0,hg.jsx)("textarea",{value:d.notes,onChange:g=>A({...d,notes:g.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",rows:"3",placeholder:"Additional notes about this verification session..."})]}),(0,hg.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,hg.jsx)("button",{onClick:()=>C(!1),disabled:h.create,className:"w-1/3 px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors disabled:opacity-50",children:"Cancel"}),(0,hg.jsx)("button",{onClick:async()=>{if(d.sessionName.trim())if("category"!==d.sessionType||0!==d.categories.length){Z((g=>({...g,create:!0})));try{const g=await fetch("/api/verification/session",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)},body:JSON.stringify(d)});if(g.ok)G('Session "'.concat(d.sessionName,'" created successfully!'),"success"),C(!1),A({sessionName:"",sessionType:"full",categories:[],notes:""}),y();else{const e=await g.json();G(e.message||"Failed to create session","error")}}catch(g){console.error("Error creating session:",g),G("Error creating session","error")}finally{Z((g=>({...g,create:!1})))}}else G("Please select at least one category","warning");else G("Please enter a session name","warning")},disabled:h.create,className:"w-2/3 px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 flex items-center justify-center space-x-2",children:h.create?(0,hg.jsx)(hg.Fragment,{children:(0,hg.jsx)("span",{children:"Creating..."})}):(0,hg.jsxs)(hg.Fragment,{children:[(0,hg.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,hg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),(0,hg.jsx)("span",{children:"Create Session"})]})})]})]})]})})}),n&&a&&(0,hg.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-40",children:(0,hg.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,hg.jsxs)("div",{className:"mt-3",children:[(0,hg.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4",children:(0,hg.jsx)("svg",{className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,hg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,hg.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2 text-center",children:"Delete Verification Session"}),(0,hg.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4",children:(0,hg.jsxs)("p",{className:"text-sm text-red-700 text-center",children:["Are you sure you want to delete ",(0,hg.jsxs)("strong",{children:['"',a.sessionName,'"']}),"? This action cannot be undone and will permanently delete all associated data."]})}),(0,hg.jsxs)("div",{className:"mb-4",children:[(0,hg.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Type ",(0,hg.jsx)("span",{className:"font-mono text-red-600 bg-red-50 px-1 rounded",children:"confirm"})," to proceed:"]}),(0,hg.jsx)("input",{type:"text",value:s,onChange:g=>c(g.target.value.toUpperCase()),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 text-center",placeholder:"Type 'confirm' here"})]}),(0,hg.jsxs)("div",{className:"flex justify-center space-x-3",children:[(0,hg.jsx)("button",{onClick:()=>{o(!1),i(null),c("")},disabled:h.delete,className:"w-1/3 px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors disabled:opacity-50",children:"Cancel"}),(0,hg.jsx)("button",{onClick:async()=>{if(a){Z((g=>({...g,delete:!0})));try{const g=await fetch("/api/verification/session/".concat(a.sessionId),{method:"DELETE",headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(g.ok)G('Session "'.concat(a.sessionName,'" deleted successfully'),"success"),o(!1),i(null),c(""),y();else{const e=await g.json();G(e.message||"Failed to delete session","error")}}catch(g){console.error("Error deleting session:",g),G("Error deleting session","error")}finally{Z((g=>({...g,delete:!1})))}}},disabled:!V||h.delete,className:"w-2/3 px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:h.delete?(0,hg.jsx)(hg.Fragment,{children:(0,hg.jsx)("span",{children:"Deleting..."})}):(0,hg.jsxs)(hg.Fragment,{children:[(0,hg.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,hg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),(0,hg.jsx)("span",{children:"Delete Session"})]})})]})]})})}),(0,hg.jsxs)("div",{children:[(0,hg.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,hg.jsxs)("h3",{className:"text-xl font-semibold text-gray-900",children:["Verification Sessions (",e.length,")"]}),e.length>0&&(0,hg.jsxs)("div",{className:"text-sm text-gray-600",children:["Sorted by: ",(0,hg.jsx)("span",{className:"font-medium",children:"Most Recent"})]})]}),0===e.length?(0,hg.jsxs)("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 rounded-lg",children:[(0,hg.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No verification sessions found"}),(0,hg.jsx)("p",{className:"text-gray-600 mb-4",children:"Get started by creating your first verification session"}),(0,hg.jsx)("button",{onClick:()=>C(!0),className:"bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors",children:"Create First Session"})]}):(0,hg.jsx)("div",{className:"grid gap-4",children:e.map((e=>{var t,I;return(0,hg.jsxs)("div",{className:"border border-gray-200 rounded-lg p-6 hover:shadow-md transition-all duration-200 cursor-pointer bg-white relative group",onClick:()=>g("/verification/".concat(e.sessionId)),children:[(0,hg.jsx)("button",{onClick:g=>((g,e)=>{e.stopPropagation(),i(g),o(!0)})(e,g),className:"absolute top-4 right-4 p-2 text-gray-400 hover:text-red-600 transition-colors",title:"Delete session",children:(0,hg.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,hg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),(0,hg.jsx)("div",{className:"flex justify-between items-start mb-4",children:(0,hg.jsxs)("div",{className:"flex-1",children:[(0,hg.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,hg.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:e.sessionName}),(0,hg.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat(W(e.status)),children:e.status.toUpperCase()})]}),(0,hg.jsxs)("p",{className:"text-sm text-gray-600 font-mono bg-gray-50 px-2 py-1 rounded inline-block",children:["ID: ",e.sessionId]})]})}),(0,hg.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6 text-sm mb-4",children:[(0,hg.jsxs)("div",{children:[(0,hg.jsx)("p",{className:"text-gray-600 text-xs uppercase tracking-wide font-medium",children:"Type"}),(0,hg.jsx)("p",{className:"font-semibold text-gray-900 capitalize",children:e.sessionType})]}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("p",{className:"text-gray-600 text-xs uppercase tracking-wide font-medium",children:"Progress"}),(0,hg.jsxs)("p",{className:"font-semibold text-gray-900",children:[e.totalVerifiedItems," / ",e.totalExpectedItems,(0,hg.jsxs)("span",{className:"text-gray-500 text-xs ml-1",children:["(",e.totalExpectedItems>0?Math.round(e.totalVerifiedItems/e.totalExpectedItems*100):0,"%)"]})]})]}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("p",{className:"text-gray-600 text-xs uppercase tracking-wide font-medium",children:"Discrepancies"}),(0,hg.jsx)("p",{className:"font-semibold ".concat(e.totalDiscrepancies>0?"text-red-600":"text-green-600"),children:e.totalDiscrepancies})]}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("p",{className:"text-gray-600 text-xs uppercase tracking-wide font-medium",children:"Started"}),(0,hg.jsx)("p",{className:"font-semibold text-gray-900",children:S(e.startedAt)})]})]}),"completed"===e.status&&(0,hg.jsxs)("div",{className:"pt-4 border-t border-gray-200 grid grid-cols-2 gap-6 text-sm",children:[(0,hg.jsxs)("div",{children:[(0,hg.jsx)("p",{className:"text-gray-600 text-xs uppercase tracking-wide font-medium",children:"Expected Value"}),(0,hg.jsxs)("p",{className:"font-semibold text-gray-900",children:["\u20b9",null===(t=e.expectedFinancialValue)||void 0===t?void 0:t.toLocaleString("en-IN")]})]}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("p",{className:"text-gray-600 text-xs uppercase tracking-wide font-medium",children:"Variance"}),(0,hg.jsxs)("p",{className:"font-semibold ".concat(e.varianceValue>=0?"text-green-600":"text-red-600"),children:["\u20b9",null===(I=e.varianceValue)||void 0===I?void 0:I.toLocaleString("en-IN")]})]})]}),(0,hg.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,hg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,hg.jsxs)("span",{className:"text-xs text-gray-500",children:["Last updated: ",S(e.updatedAt||e.startedAt)]}),(0,hg.jsxs)("button",{onClick:()=>g("/verification/".concat(e.sessionId)),className:"text-indigo-600 hover:text-indigo-800 text-sm font-medium flex items-center space-x-1",children:[(0,hg.jsx)("span",{children:"View Details"}),(0,hg.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,hg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})]})]})})]},e.sessionId)}))})]})]})]})},lc=g=>{let{sessionId:e,isOpen:t,onClose:l,onLogDeleted:C}=g;const n=q(),[o,a]=(0,I.useState)([]),[i,s]=(0,I.useState)("all"),[c,d]=(0,I.useState)(""),[A,r]=(0,I.useState)("timestamp"),[u,m]=(0,I.useState)("desc"),[b,h]=(0,I.useState)([]),[Z,G]=(0,I.useState)({fetch:!1,delete:!1}),[p,y]=(0,I.useState)(!1),[B,S]=(0,I.useState)(""),[W,V]=(0,I.useState)(null),R=(0,I.useCallback)((function(g){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";const t=Date.now();h((I=>[...I,{id:t,message:g,type:e}])),setTimeout((()=>{h((g=>g.filter((g=>g.id!==t))))}),5e3)}),[]);(0,I.useEffect)((()=>{t&&X()}),[t,e]);const X=async()=>{G((g=>({...g,fetch:!0})));try{const g=await fetch("/api/verification/logs/".concat(e),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(g.ok){const e=await g.json();a(e)}else 401===g.status?n("/login"):R("Failed to fetch logs","error")}catch(g){console.error("Error fetching logs:",g),R("Error fetching logs","error")}finally{G((g=>({...g,fetch:!1})))}},J=g=>!["session_start","session_complete"].includes(g.action),k=()=>{S(""),y(!1),V(null)},f=o.filter((g=>{const e="all"===i||g.action===i,t=!c||g.action.toLowerCase().includes(c.toLowerCase())||g.details.toLowerCase().includes(c.toLowerCase())||g.itemCode&&g.itemCode.toLowerCase().includes(c.toLowerCase());return e&&t})).sort(((g,e)=>{let t,I;switch(A){case"timestamp":default:t=g.timestamp,I=e.timestamp;break;case"action":t=g.action,I=e.action;break;case"itemCode":t=g.itemCode||"",I=e.itemCode||""}return"desc"===u?I>t?1:-1:t>I?1:-1})),v=f.filter((g=>J(g))),Y="CONFIRM"===B.toUpperCase(),x=Object.values(Z).some((g=>g));return t?(0,hg.jsxs)(hg.Fragment,{children:[(0,hg.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:b.map((g=>(0,hg.jsx)(tc,{message:g.message,type:g.type,onClose:()=>h((e=>e.filter((e=>e.id!==g.id))))},g.id)))}),x&&(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-30 z-50",children:(0,hg.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg flex flex-col items-center",children:[(0,hg.jsx)(La,{}),(0,hg.jsxs)("p",{className:"mt-2 text-gray-700",children:[Z.fetch&&"Loading logs...",Z.delete&&"Deleting log..."]})]})}),(0,hg.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-40",children:(0,hg.jsxs)("div",{className:"relative top-10 mx-auto p-6 border w-11/12 max-w-7xl shadow-lg rounded-lg bg-white",children:[(0,hg.jsxs)("div",{className:"flex justify-between items-center mb-6 pb-4 border-b border-gray-200",children:[(0,hg.jsxs)("div",{children:[(0,hg.jsx)("h3",{className:"text-2xl font-bold text-gray-900",children:"Log Management"}),(0,hg.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Session: ",(0,hg.jsx)("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:e})]})]}),(0,hg.jsx)("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 text-2xl font-bold p-2 rounded-full hover:bg-gray-100",children:"\xd7"})]}),(0,hg.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,hg.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:(0,hg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,hg.jsx)("p",{className:"text-blue-600 text-sm",children:"Total Logs"}),(0,hg.jsx)("p",{className:"text-2xl font-bold text-blue-700",children:o.length})]})}),(0,hg.jsx)("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:(0,hg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,hg.jsx)("p",{className:"text-green-600 text-sm",children:"QR Scans"}),(0,hg.jsx)("p",{className:"text-2xl font-bold text-green-700",children:o.filter((g=>"scan"===g.action)).length})]})}),(0,hg.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:(0,hg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,hg.jsx)("p",{className:"text-blue-600 text-sm",children:"Manual Entries"}),(0,hg.jsx)("p",{className:"text-2xl font-bold text-blue-700",children:o.filter((g=>"manual_entry"===g.action)).length})]})}),(0,hg.jsx)("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:(0,hg.jsxs)("div",{className:"flex items-center justify-between",children:[(0,hg.jsx)("p",{className:"text-red-600 text-sm",children:"Deletable"}),(0,hg.jsx)("p",{className:"text-2xl font-bold text-red-700",children:v.length})]})})]}),(0,hg.jsxs)("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[(0,hg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[(0,hg.jsxs)("div",{children:[(0,hg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Action"}),(0,hg.jsxs)("select",{value:i,onChange:g=>s(g.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[(0,hg.jsx)("option",{value:"all",children:"All Actions"}),(0,hg.jsx)("option",{value:"scan",children:"QR Scans"}),(0,hg.jsx)("option",{value:"manual_entry",children:"Manual Entries"}),(0,hg.jsx)("option",{value:"deletion",children:"Deletions"}),(0,hg.jsx)("option",{value:"session_start",children:"Session Start"}),(0,hg.jsx)("option",{value:"session_complete",children:"Session Complete"})]})]}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search Logs"}),(0,hg.jsx)("input",{type:"text",value:c,onChange:g=>d(g.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Search by action, details, or item code..."})]}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort By"}),(0,hg.jsxs)("select",{value:A,onChange:g=>r(g.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[(0,hg.jsx)("option",{value:"timestamp",children:"Timestamp"}),(0,hg.jsx)("option",{value:"action",children:"Action"}),(0,hg.jsx)("option",{value:"itemCode",children:"Item Code"})]})]}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sort Order"}),(0,hg.jsxs)("select",{value:u,onChange:g=>m(g.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[(0,hg.jsx)("option",{value:"desc",children:"Newest First"}),(0,hg.jsx)("option",{value:"asc",children:"Oldest First"})]})]})]}),(0,hg.jsxs)("div",{className:"flex justify-between items-center",children:[(0,hg.jsxs)("div",{className:"text-sm text-gray-600",children:["Showing ",f.length," of ",o.length," logs",c&&(0,hg.jsxs)("span",{className:"ml-2 text-indigo-600",children:['(filtered by "',c,'")']})]}),(0,hg.jsxs)("div",{className:"flex space-x-3",children:[(0,hg.jsx)("button",{onClick:()=>{s("all"),d(""),r("timestamp"),m("desc")},className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Reset Filters"}),(0,hg.jsxs)("button",{onClick:X,className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors flex items-center space-x-2",disabled:Z.fetch,children:[(0,hg.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,hg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),(0,hg.jsx)("span",{children:"Refresh"})]})]})]})]}),(0,hg.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,hg.jsx)("div",{className:"bg-gray-50 px-6 py-3 border-b border-gray-200",children:(0,hg.jsxs)("div",{className:"grid grid-cols-12 gap-4 text-xs font-medium text-gray-600 uppercase tracking-wide",children:[(0,hg.jsx)("div",{className:"col-span-2",children:"Action"}),(0,hg.jsx)("div",{className:"col-span-2",children:"Item Code"}),(0,hg.jsx)("div",{className:"col-span-4",children:"Details"}),(0,hg.jsx)("div",{className:"col-span-2",children:"Timestamp"}),(0,hg.jsx)("div",{className:"col-span-2 text-center",children:"Actions"})]})}),(0,hg.jsx)("div",{className:"max-h-96 overflow-y-auto",children:Z.fetch?(0,hg.jsx)("div",{className:"flex justify-center items-center h-32",children:(0,hg.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"})}):0===f.length?(0,hg.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,hg.jsx)("div",{className:"text-4xl mb-4",children:"\ud83d\udcdd"}),(0,hg.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No logs found"}),(0,hg.jsx)("p",{className:"text-gray-600",children:c||"all"!==i?"Try adjusting your filters or search terms":"No logs available for this session"})]}):(0,hg.jsx)("div",{className:"divide-y divide-gray-100",children:f.map((g=>{return(0,hg.jsxs)("div",{className:"px-6 py-4 hover:bg-gray-50 transition-colors",children:[(0,hg.jsxs)("div",{className:"grid grid-cols-12 gap-4 items-center",children:[(0,hg.jsx)("div",{className:"col-span-2",children:(0,hg.jsx)("div",{className:"flex items-center space-x-2",children:(0,hg.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat((e=g.action,{scan:"bg-green-100 text-green-800 border border-green-200",manual_entry:"bg-blue-100 text-blue-800 border border-blue-200",deletion:"bg-red-100 text-red-800 border border-red-200",session_start:"bg-purple-100 text-purple-800 border border-purple-200",session_complete:"bg-gray-100 text-gray-800 border border-gray-200"}[e]||"bg-gray-100 text-gray-800 border border-gray-200")),children:g.action.replace("_"," ").toUpperCase()})})}),(0,hg.jsx)("div",{className:"col-span-2",children:g.itemCode?(0,hg.jsx)("span",{className:"font-mono text-blue-600 bg-blue-50 px-2 py-1 rounded text-sm",children:g.itemCode}):(0,hg.jsx)("span",{className:"text-gray-400 text-sm",children:"-"})}),(0,hg.jsxs)("div",{className:"col-span-4",children:[(0,hg.jsx)("p",{className:"text-sm text-gray-700 line-clamp-2",children:g.details}),(void 0!==g.previousQuantity||void 0!==g.newQuantity)&&(0,hg.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Qty: ",g.previousQuantity||0," \u2192 ",g.newQuantity||0]})]}),(0,hg.jsxs)("div",{className:"col-span-2",children:[(0,hg.jsx)("p",{className:"text-sm text-gray-600",children:new Date(g.timestamp).toLocaleDateString()}),(0,hg.jsx)("p",{className:"text-xs text-gray-400",children:new Date(g.timestamp).toLocaleTimeString()})]}),(0,hg.jsx)("div",{className:"col-span-2 text-center",children:J(g)?(0,hg.jsxs)("button",{onClick:()=>(g=>{V(g),y(!0),S("")})(g),className:"bg-red-500 hover:bg-red-600 text-white text-xs px-3 py-2 rounded-lg transition-colors flex items-center space-x-1 mx-auto",title:"Delete this log",disabled:Z.delete,children:[(0,hg.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,hg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),(0,hg.jsx)("span",{children:"Delete"})]}):(0,hg.jsx)("span",{className:"text-xs text-gray-400 italic px-2 py-1 bg-gray-100 rounded",children:"Protected"})})]}),(0,hg.jsx)("div",{className:"mt-2 pt-2 border-t border-gray-100",children:(0,hg.jsxs)("p",{className:"text-xs text-gray-500",children:[(0,hg.jsx)("strong",{children:"Performed by:"})," ",g.performedBy]})})]},g._id);var e}))})})]}),(0,hg.jsxs)("div",{className:"flex justify-between items-center mt-6 pt-4 border-t border-gray-200",children:[(0,hg.jsxs)("div",{className:"text-sm text-gray-600",children:["Deletable logs: ",(0,hg.jsx)("span",{className:"font-semibold",children:v.length})," of ",(0,hg.jsx)("span",{className:"font-semibold",children:f.length})," shown"]}),(0,hg.jsx)("div",{className:"flex space-x-3",children:(0,hg.jsx)("button",{onClick:l,className:"px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Close"})})]})]})}),p&&W&&(0,hg.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-40",children:(0,hg.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-lg bg-white",children:(0,hg.jsxs)("div",{className:"mt-3",children:[(0,hg.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4",children:(0,hg.jsx)("svg",{className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,hg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,hg.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2 text-center",children:"Delete Log Entry"}),(0,hg.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4",children:[(0,hg.jsxs)("p",{className:"text-sm text-red-700 text-center",children:["Are you sure you want to delete this ",W.action," log? This action cannot be undone."]}),W.itemCode&&(0,hg.jsxs)("p",{className:"text-sm text-red-700 text-center mt-1 font-medium",children:["Item: ",W.itemCode]})]}),(0,hg.jsxs)("div",{className:"mb-4",children:[(0,hg.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Type ",(0,hg.jsx)("span",{className:"font-mono text-red-600 bg-red-50 px-1 rounded",children:"confirm"})," to proceed:"]}),(0,hg.jsx)("input",{type:"text",value:B,onChange:g=>S(g.target.value.toUpperCase()),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 text-center",placeholder:"Type 'confirm' here"})]}),(0,hg.jsxs)("div",{className:"flex justify-center space-x-3",children:[(0,hg.jsx)("button",{onClick:k,disabled:Z.delete,className:"w-1/3 px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors disabled:opacity-50",children:"Cancel"}),(0,hg.jsx)("button",{onClick:async()=>{if(W&&"CONFIRM"===B.toUpperCase()){G((g=>({...g,delete:!0})));try{const g=await fetch("/api/verification/log/".concat(W._id),{method:"DELETE",headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(g.ok)R("Log deleted successfully","success"),X(),C&&C(),k();else{const e=await g.json();R(e.message||"Error deleting log","error")}}catch(g){console.error("Error deleting log:",g),R("Error deleting log","error")}finally{G((g=>({...g,delete:!1})))}}},disabled:!Y||Z.delete,className:"w-2/3 px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:Z.delete?(0,hg.jsx)("span",{children:"Deleting..."}):(0,hg.jsxs)(hg.Fragment,{children:[(0,hg.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,hg.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),(0,hg.jsx)("span",{children:"Delete Log"})]})})]})]})})})]}):null},Cc=()=>{const{sessionId:g}=$(),e=q(),[t,l]=(0,I.useState)(null),[C,n]=(0,I.useState)([]),[o,a]=(0,I.useState)({}),[i,s]=(0,I.useState)(!0),[c,d]=(0,I.useState)(!1),[A,r]=(0,I.useState)({code:"",verifiedQuantity:1,notes:""}),[u,m]=(0,I.useState)("all"),[b,h]=(0,I.useState)(""),[Z,G]=(0,I.useState)(!1),[p,y]=(0,I.useState)(!1),[B,S]=(0,I.useState)([]),[W,V]=(0,I.useState)(!1),[R,X]=(0,I.useState)(null),[J,k]=(0,I.useState)(null),[f,v]=(0,I.useState)([]),[Y,x]=(0,I.useState)({verify:!1,complete:!1,delete:!1,logs:!1,bulkDelete:!1,loadMore:!1}),[H,N]=(0,I.useState)({currentPage:1,totalPages:1,totalItems:0,hasNextPage:!1,hasPrevPage:!1}),[w,F]=(0,I.useState)(!1),[K,z]=(0,I.useState)(""),[M,E]=(0,I.useState)(!1),Q=(0,I.useCallback)((function(g){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";const t=Date.now();v((I=>[...I,{id:t,message:g,type:e}])),setTimeout((()=>{v((g=>g.filter((g=>g.id!==t))))}),5e3)}),[]);(0,I.useEffect)((()=>{U(),L(),j(1,!1)}),[g]);const U=()=>{window.localStorage.getItem("userInfo")||e("/login")},L=async()=>{try{s(!0);const t=await fetch("/api/verification/session/".concat(g),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(t.ok){const g=await t.json();l(g.session),a(g.summary)}else e("/verification")}catch(t){console.error("Error fetching session data:",t),Q("Error fetching session data","error")}finally{s(!1)}},j=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{t&&(x((g=>({...g,loadMore:!0}))),Q("Loading more items...","info"));const I="/api/verification/session/".concat(g,"/items?page=").concat(e,"&limit=10").concat(b?"&search=".concat(encodeURIComponent(b)):""),l=await fetch(I,{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(l.ok){const g=await l.json();n(t&&!b?e=>[...e,...g.items]:g.items),N(g.pagination),a(g.summary)}else Q("Failed to fetch items","error")}catch(I){console.error("Error fetching items:",I),Q("Error fetching items","error")}finally{x((g=>({...g,loadMore:!1}))),G(!1)}},D=(0,I.useMemo)((()=>((g,e)=>{let t;return function(){for(var I=arguments.length,l=new Array(I),C=0;C<I;C++)l[C]=arguments[C];clearTimeout(t),t=setTimeout((()=>g.apply(null,l)),e)}})((e=>{(async e=>{if(""===e.trim())return h(""),void j(1,!1);try{G(!0),h(e);const t=await fetch("/api/verification/session/".concat(g,"/items?page=1&limit=50&search=").concat(encodeURIComponent(e)),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(t.ok){const g=await t.json();n(g.items),N({...g.pagination,hasNextPage:g.items.length>=50})}}catch(t){console.error("Error searching items:",t),Q("Error searching items","error")}finally{G(!1)}})(e)}),500)),[g]),T=async()=>{try{x((g=>({...g,logs:!0})));const e=await fetch("/api/verification/logs/".concat(g),{headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(e.ok){const g=await e.json();S(g)}else Q("Failed to fetch logs","error")}catch(e){console.error("Error fetching logs:",e),Q("Error fetching logs","error")}finally{x((g=>({...g,logs:!1})))}},P=async()=>{if(!J)return;const g=B.find((g=>g._id===J));g&&(V(!1),await(async(g,e)=>{try{x((g=>({...g,delete:!0})));const e=await fetch("/api/verification/log/".concat(g),{method:"DELETE",headers:{Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)}});if(e.ok)Q("Log deleted successfully!","success"),T(),L(),j(H.currentPage,!1);else{const g=await e.json();Q(g.message||"Error deleting log","error")}}catch(t){console.error("Error deleting log:",t),Q("Error deleting log","error")}finally{x((g=>({...g,delete:!1})))}})(J),k(null),X(null))},O=g=>{switch(g){case"verified":return"bg-green-100 text-green-800";case"discrepancy":return"bg-red-100 text-red-800";case"overage":return"bg-blue-100 text-blue-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};return t||i?(0,hg.jsxs)(hg.Fragment,{children:[(0,hg.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:f.map((g=>(0,hg.jsx)(tc,{message:g.message,type:g.type,onClose:()=>v((e=>e.filter((e=>e.id!==g.id))))},g.id)))}),(i||Object.values(Y).some((g=>g)))&&(0,hg.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-30 z-50",children:(0,hg.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg flex flex-col items-center",children:[(0,hg.jsx)(La,{}),(0,hg.jsxs)("p",{className:"mt-2 text-gray-700",children:[Z&&"Searching...",Y.verify&&"Verifying item...",Y.complete&&"Completing session...",Y.delete&&"Processing deletion...",Y.bulkDelete&&"Processing bulk deletion...",Y.logs&&"Loading logs...",Y.loadMore&&"Loading more items...",i&&"Loading session data..."]})]})}),(0,hg.jsxs)("div",{className:"bg-white p-6 shadow-md rounded-md",children:[(0,hg.jsxs)("div",{className:"flex justify-between items-center m-6",children:[(0,hg.jsxs)("div",{children:[(0,hg.jsx)("h2",{className:"text-2xl font-semibold",children:null===t||void 0===t?void 0:t.sessionName}),(0,hg.jsxs)("p",{className:"text-gray-600",children:["Session ID: ",null===t||void 0===t?void 0:t.sessionId]})]}),(0,hg.jsxs)("div",{className:"flex space-x-2",children:[(0,hg.jsx)("button",{onClick:()=>{y(!0),T()},className:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded",children:"View Logs"}),"active"===(null===t||void 0===t?void 0:t.status)&&(0,hg.jsx)("button",{onClick:()=>F(!0),className:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded",disabled:Y.complete,children:"Complete Session"})]})]}),(0,hg.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6 p-4 bg-gray-50 rounded-lg",children:[(0,hg.jsxs)("div",{className:"text-center",children:[(0,hg.jsx)("p",{className:"text-2xl font-bold text-indigo-600",children:o.totalItems||0}),(0,hg.jsx)("p",{className:"text-gray-600",children:"Total Items"})]}),(0,hg.jsxs)("div",{className:"text-center",children:[(0,hg.jsx)("p",{className:"text-2xl font-bold text-green-600",children:o.verifiedItems||0}),(0,hg.jsx)("p",{className:"text-gray-600",children:"Verified"})]}),(0,hg.jsxs)("div",{className:"text-center",children:[(0,hg.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:o.pendingItems||0}),(0,hg.jsx)("p",{className:"text-gray-600",children:"Pending"})]}),(0,hg.jsxs)("div",{className:"text-center",children:[(0,hg.jsx)("p",{className:"text-2xl font-bold text-red-600",children:o.discrepancyItems||0}),(0,hg.jsx)("p",{className:"text-gray-600",children:"Discrepancies"})]}),(0,hg.jsxs)("div",{className:"text-center",children:[(0,hg.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:o.overageItems||0}),(0,hg.jsx)("p",{className:"text-gray-600",children:"Overusage"})]})]}),"active"===(null===t||void 0===t?void 0:t.status)&&(0,hg.jsxs)("div",{className:"mb-6 p-4 border rounded-lg bg-blue-50",children:[(0,hg.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Verify Item"}),(0,hg.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,hg.jsxs)("div",{children:[(0,hg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Item Code"}),(0,hg.jsx)("input",{type:"text",value:A.code,onChange:g=>{r({...A,code:g.target.value.toUpperCase()}),E(!1)},className:"w-full p-2 border rounded-md",placeholder:"Enter item code"})]}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Verified Quantity"}),(0,hg.jsx)("input",{type:"number",value:A.verifiedQuantity,onWheel:g=>g.target.blur(),onChange:g=>r({...A,verifiedQuantity:g.target.value}),className:"w-full p-2 border rounded-md",placeholder:"Quantity found",min:"1"})]}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (Optional)"}),(0,hg.jsx)("input",{type:"text",value:A.notes,onChange:g=>r({...A,notes:g.target.value}),className:"w-full p-2 border rounded-md",placeholder:"Additional notes"})]})]}),(0,hg.jsxs)("div",{className:"flex flex-wrap gap-2 mb-4",children:[(0,hg.jsx)("button",{onClick:()=>d(!c),className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded","aria-label":c?"Hide QR Scanner":"Show QR Scanner",children:c?"Hide Scanner":"Scan QR Code"}),(0,hg.jsx)("button",{onClick:async()=>{if(A.code&&A.verifiedQuantity)try{x((g=>({...g,verify:!0})));const e=M?"/api/verification/verify/scan":"/api/verification/verify/manual",t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)},body:JSON.stringify({sessionId:g,itemCode:A.code,verifiedQuantity:parseInt(A.verifiedQuantity),notes:A.notes})});if(t.ok){const g=await t.json();Q(g.message,"success"),r({code:"",verifiedQuantity:1,notes:""}),E(!1),L(),j(H.currentPage,!1)}else{const g=await t.json();Q(g.message||"Error verifying item","error")}}catch(e){console.error("Error verifying item:",e),Q("Error verifying item","error")}finally{x((g=>({...g,verify:!1})))}else Q("Please enter item code and verified quantity","warning")},className:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded",disabled:Y.verify,children:Y.verify?"Verifying...":"Enter"}),(0,hg.jsx)("button",{onClick:()=>{r({code:"",verifiedQuantity:1,notes:""}),E(!1)},className:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded",children:"Clear"})]}),c&&(0,hg.jsx)("div",{className:"mb-4",children:(0,hg.jsx)(bg(),{onScan:g=>{g&&/^[A-Z]{3}\d{4}$/.test(g.text)&&(r({...A,code:g.text,verifiedQuantity:1}),d(!1),E(!0))},onError:g=>console.error("Scanner error:",g),constraints:{audio:!1,video:{facingMode:"environment"}},style:{width:"100%"}})})]}),(0,hg.jsxs)("div",{className:"flex flex-wrap gap-4 mb-4",children:[(0,hg.jsxs)("div",{children:[(0,hg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Filter by Status"}),(0,hg.jsxs)("select",{value:u,onChange:g=>m(g.target.value),className:"p-2 border rounded-md",children:[(0,hg.jsx)("option",{value:"all",children:"All Items"}),(0,hg.jsx)("option",{value:"pending",children:"Pending"}),(0,hg.jsx)("option",{value:"verified",children:"Verified"}),(0,hg.jsx)("option",{value:"discrepancy",children:"Discrepancies"}),(0,hg.jsx)("option",{value:"overage",children:"Overusage"})]})]}),(0,hg.jsxs)("div",{className:"flex-1 min-w-[200px]",children:[(0,hg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:Z?"Searching...":"Search"}),(0,hg.jsxs)("div",{className:"relative",children:[(0,hg.jsx)("input",{type:"text",value:b,onChange:g=>{const e=g.target.value;h(e),D(e)},className:"w-full p-2 border rounded-md pr-10",placeholder:"Search by code, brand, or product"}),b&&!Z&&(0,hg.jsx)("button",{onClick:()=>{h(""),j(1,!1)},className:"absolute right-3 top-2 text-gray-500 hover:text-gray-700",children:"\u2715"})]})]})]}),(0,hg.jsxs)("div",{className:"space-y-2",children:[(0,hg.jsxs)("h3",{className:"text-lg font-medium",children:[b?"Search Results":"Items"," (",C.length," of ",b?H.totalItems:o.totalItems||0,")",b&&(0,hg.jsxs)("span",{className:"text-sm text-gray-600 ml-2",children:['(searching for: "',b,'")']})]}),0===C.length?(0,hg.jsx)("div",{className:"text-center py-8 text-gray-500",children:b?"No items found matching your search":"No items found"}):(0,hg.jsxs)(hg.Fragment,{children:[(0,hg.jsx)("div",{className:"max-h-96 overflow-y-auto",children:C.map((g=>{var e;return(0,hg.jsxs)("div",{className:"border rounded-lg p-4 hover:bg-gray-50 mb-2",children:[(0,hg.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,hg.jsxs)("div",{children:[(0,hg.jsx)("h4",{className:"font-medium",children:g.itemCode}),(0,hg.jsxs)("p",{className:"text-sm text-gray-600",children:[g.originalDetails.brand," -"," ",g.originalDetails.product," -"," ",g.originalDetails.size]})]}),(0,hg.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(O(g.verificationStatus)),children:g.verificationStatus.toUpperCase()})]}),(0,hg.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,hg.jsxs)("div",{children:[(0,hg.jsx)("p",{className:"text-gray-600",children:"Expected"}),(0,hg.jsx)("p",{className:"font-medium",children:g.expectedQuantity})]}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("p",{className:"text-gray-600",children:"Verified"}),(0,hg.jsx)("p",{className:"font-medium",children:g.verifiedQuantity})]}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("p",{className:"text-gray-600",children:"Variance"}),(0,hg.jsxs)("p",{className:"font-medium ".concat(g.varianceQuantity>=0?"text-green-600":"text-red-600"),children:[g.varianceQuantity>0?"+":"",g.varianceQuantity]})]}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("p",{className:"text-gray-600",children:"Value Impact"}),(0,hg.jsxs)("p",{className:"font-medium ".concat(g.varianceValue>=0?"text-green-600":"text-red-600"),children:["\u20b9",null===(e=g.varianceValue)||void 0===e?void 0:e.toLocaleString("en-IN")]})]})]}),g.notes&&(0,hg.jsxs)("div",{className:"mt-2 p-2 bg-yellow-50 rounded text-sm",children:[(0,hg.jsx)("strong",{children:"Notes:"})," ",g.notes]})]},g._id)}))}),H.hasNextPage&&!Z&&(0,hg.jsx)("div",{className:"flex justify-center mt-4",children:(0,hg.jsx)("button",{onClick:()=>{H.hasNextPage&&j(H.currentPage+1,!0)},disabled:Y.loadMore,className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded disabled:bg-blue-300",children:Y.loadMore?"Loading...":"Load More"})})]})]}),p&&(0,hg.jsx)(lc,{sessionId:g,isOpen:p,onClose:()=>y(!1),onLogDeleted:()=>{T(),L(),j(H.currentPage,!1)}}),w&&(0,hg.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-40",children:(0,hg.jsx)("div",{className:"relative top-32 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,hg.jsxs)("div",{className:"mt-3",children:[(0,hg.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Confirm Session Completion"}),(0,hg.jsxs)("div",{className:"space-y-3",children:[(0,hg.jsx)("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-3",children:(0,hg.jsx)("p",{className:"text-sm",children:"Are you sure you want to complete this verification session? This action cannot be undone."})}),(0,hg.jsxs)("div",{children:[(0,hg.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:'Type "confirm" to proceed:'}),(0,hg.jsx)("input",{type:"text",value:K,onChange:g=>z(g.target.value.toUpperCase()),className:"w-full p-2 border rounded-md text-center",placeholder:"Type 'confirm' here"})]}),(0,hg.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,hg.jsx)("button",{onClick:()=>{F(!1),z("")},className:"w-1/3 px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600",children:"Cancel"}),(0,hg.jsx)("button",{onClick:async()=>{if("confirm"===K.toLowerCase())try{x((g=>({...g,complete:!0})));const t=await fetch("/api/verification/session/".concat(g,"/complete"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(JSON.parse(window.localStorage.getItem("userInfo")).token)},body:JSON.stringify({notes:""})});if(t.ok)Q("Session completed successfully!","success"),F(!1),z(""),e("/verification");else{const g=await t.json();Q(g.message||"Error completing session","error")}}catch(t){console.error("Error completing session:",t),Q("Error completing session","error")}finally{x((g=>({...g,complete:!1})))}else Q("Please type 'confirm' to complete the session","warning")},className:"w-2/3 px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 disabled:bg-green-300",disabled:Y.complete||"confirm"!==K.toLowerCase(),children:Y.complete?"Completing...":"Confirm Complete"})]})]})]})})}),W&&(0,hg.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-40",children:(0,hg.jsx)("div",{className:"relative top-32 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,hg.jsxs)("div",{className:"mt-3",children:[(0,hg.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Deletion Impact Preview"}),R&&(0,hg.jsxs)("div",{className:"space-y-3",children:[(0,hg.jsx)("div",{className:"p-3 rounded ".concat(R.canDelete?"bg-yellow-50 border-l-4 border-yellow-400":"bg-red-50 border-l-4 border-red-400"),children:(0,hg.jsx)("div",{className:"flex",children:(0,hg.jsxs)("div",{className:"ml-3",children:[(0,hg.jsxs)("p",{className:"text-sm",children:[(0,hg.jsx)("strong",{children:"Action:"})," ",R.logType]}),R.affectedItem&&(0,hg.jsxs)("p",{className:"text-sm",children:[(0,hg.jsx)("strong",{children:"Item:"})," ",R.affectedItem]}),(0,hg.jsxs)("p",{className:"text-sm mt-2",children:[(0,hg.jsx)("strong",{children:"Impact:"})," ",R.impact]}),!R.canDelete&&R.reason&&(0,hg.jsxs)("p",{className:"text-sm text-red-600 mt-2",children:[(0,hg.jsx)("strong",{children:"Reason:"})," ",R.reason]})]})})}),(0,hg.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,hg.jsx)("button",{onClick:()=>V(!1),className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600",children:"Cancel"}),R.canDelete&&(0,hg.jsx)("button",{onClick:()=>P(),className:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600",disabled:Y.delete,children:Y.delete?"Deleting...":"Confirm Deletion"})]})]})]})})})]})]}):(0,hg.jsx)("div",{className:"text-center text-red-500",children:"Session not found"})},nc=()=>{const[g]=Dg(),e="admin"===g;var t="dev"===g;return(0,hg.jsxs)(hg.Fragment,{children:[(0,hg.jsx)(Da,{}),(0,hg.jsxs)(rg,{children:[(0,hg.jsx)(dg,{path:"/login",element:(0,hg.jsx)(Qs,{})}),(0,hg.jsx)(dg,{path:"/menu",element:(0,hg.jsx)(Pg,{})}),(0,hg.jsx)(dg,{path:"/sale",element:(0,hg.jsx)(Zg,{})}),(0,hg.jsx)(dg,{path:"/customer-purchase",element:(0,hg.jsx)(_s,{})}),(0,hg.jsx)(dg,{path:"/purchase",element:(0,hg.jsx)(Lg,{})}),(0,hg.jsx)(dg,{path:"/print-tag",element:(0,hg.jsx)(Ts,{})}),(e||t)&&(0,hg.jsx)(dg,{path:"/dashboard",element:(0,hg.jsx)(ja,{})}),(0,hg.jsx)(dg,{path:"/add-brand-product",element:(0,hg.jsx)(Ta,{})}),(0,hg.jsx)(dg,{path:"/add-category",element:(0,hg.jsx)(Pa,{})}),(0,hg.jsx)(dg,{path:"/add-size",element:(0,hg.jsx)(Oa,{})}),(0,hg.jsx)(dg,{path:"/add-expense-type",element:(0,hg.jsx)(gc,{})}),(e||t)&&(0,hg.jsx)(dg,{path:"/inventory",element:(0,hg.jsx)(Us,{})}),(0,hg.jsx)(dg,{path:"/add-expense",element:(0,hg.jsx)(_a,{})}),(e||t)&&(0,hg.jsx)(dg,{path:"/history",element:(0,hg.jsx)(Ls,{})}),(e||t)&&(0,hg.jsx)(dg,{path:"/repurchase",element:(0,hg.jsx)(Os,{})}),(e||t)&&(0,hg.jsx)(dg,{path:"/search",element:(0,hg.jsx)($s,{})}),(e||t)&&(0,hg.jsx)(dg,{path:"/sale-history",element:(0,hg.jsx)(Ds,{})}),t&&(0,hg.jsx)(dg,{path:"/sale-history/:code",element:(0,hg.jsx)(Ds,{})}),t&&(0,hg.jsx)(dg,{path:"/edit-selected-items",element:(0,hg.jsx)(qs,{})}),t&&(0,hg.jsx)(dg,{path:"/verification",element:(0,hg.jsx)(Ic,{})}),t&&(0,hg.jsx)(dg,{path:"/verification/:sessionId",element:(0,hg.jsx)(Cc,{})}),(0,hg.jsx)(dg,{path:"/expense-history",element:(0,hg.jsx)(Ps,{})}),t&&(0,hg.jsx)(dg,{path:"/edit-item/:code",element:(0,hg.jsx)(js,{})}),t&&(0,hg.jsx)(dg,{path:"/edit-expense/:id",element:(0,hg.jsx)(ec,{})}),(0,hg.jsx)(dg,{path:"*",element:(0,hg.jsx)(Pg,{})})]})]})};var oc=t(950),ac=t.t(oc,2);new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);try{window.__reactRouterVersion="6"}catch(rc){}new Map;const ic=l.startTransition;ac.flushSync,l.useId;function sc(g){let{basename:e,children:t,future:l,window:C}=g,n=I.useRef();var o;null==n.current&&(n.current=(void 0===(o={window:C,v5Compat:!0})&&(o={}),r((function(g,e){let{pathname:t,search:I,hash:l}=g.location;return c("",{pathname:t,search:I,hash:l},e.state&&e.state.usr||null,e.state&&e.state.key||"default")}),(function(g,e){return"string"===typeof e?e:d(e)}),null,o)));let a=n.current,[i,s]=I.useState({action:a.action,location:a.location}),{v7_startTransition:A}=l||{},u=I.useCallback((g=>{A&&ic?ic((()=>s(g))):s(g)}),[s,A]);return I.useLayoutEffect((()=>a.listen(u)),[a,u]),I.createElement(Ag,{basename:e,children:t,location:i.location,navigationType:i.action,navigator:a,future:l})}"undefined"!==typeof window&&"undefined"!==typeof window.document&&window.document.createElement;var cc,dc;(function(g){g.UseScrollRestoration="useScrollRestoration",g.UseSubmit="useSubmit",g.UseSubmitFetcher="useSubmitFetcher",g.UseFetcher="useFetcher",g.useViewTransitionState="useViewTransitionState"})(cc||(cc={})),function(g){g.UseFetcher="useFetcher",g.UseFetchers="useFetchers",g.UseScrollRestoration="useScrollRestoration"}(dc||(dc={}));const Ac=()=>(0,hg.jsx)(sc,{children:(0,hg.jsx)(Tg,{children:(0,hg.jsx)(nc,{})})});C.createRoot(document.getElementById("root")).render((0,hg.jsx)(I.StrictMode,{children:(0,hg.jsx)(Ac,{})}))})()})();
//# sourceMappingURL=main.bc67b340.js.map